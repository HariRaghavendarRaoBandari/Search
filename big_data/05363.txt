6
1
0
2

 
r
a

 

M
7
1

 
 
]

.

O
C
h
p
-
o
r
t
s
a
[
 
 

1
v
3
6
3
5
0

.

3
0
6
1
:
v
i
X
r
a

Kriging Interpolating Cosmic Velocity Field - II: Improvement from More Delicate

Kriging

Yu Yu,1, ∗ Jun Zhang,2, 3 Yipeng Jing,2, 3 and Pengjie Zhang2, 3, 1, †

1Key laboratory for research in galaxies and cosmology, Shanghai Astronomical Observatory,

Chinese Academy of Sciences, 80 Nandan Road, Shanghai, China, 200030

2Center for Astronomy and Astrophysics, Department of Physics and Astronomy,

3IFSA Collaborative Innovation Center, Shanghai Jiao Tong University, Shanghai, China, 200240

Shanghai Jiao Tong University, Shanghai, 200240

Measuring the large-scale volume-weighted peculiar velocity statistics from galaxy and simulated
In
halo/particle velocity data suﬀers sampling artifacts from the velocity assignment methods.
previous work [Y. Yu, J. Zhang, Y. Jing, and P. Zhang, Phys. Rev. D 92, 083527 (2015)], we
proposed Kriging interpolation to obtain the volume-weighted velocity ﬁeld and found that the
most straightforward Kriging does not perform over the existing methods in the literature. In this
work we improve the Kriging performance by considering more delicate Kriging. The improvement
mainly comes from considering the anisotropy in the input variogram prior for Kriging. We ﬁnd
that the improvement is obvious for low sampling density cases (nP . 6 × 10−3(h−1Mpc)−3), in
the sense of the alleviation of severe power spectrum suppression in small scales.
It pushes the
scale of reliable measurement by a factor ∼ 1.6. Furthermore, the dependence on variogram prior
is signiﬁcantly weakened. Comparing to the most straightforward Kriging, the more delicate one
reduces the impact of variogram priors by a factor of ∼ 2 for nP . 6×10−4(h−1Mpc)−3. We conclude
that the improvement from the more delicate Kriging is a notable step forward. Nevertheless, to
reach the precision of Stage-IV Dark Energy projects, further improvement is still required.

PACS numbers: 98.80.-k, 95.36.+x, 98.80.Bp

I.

INTRODUCTION

Peculiar velocity probes the growth rate of the Uni-
verse, making it powerful to separate diﬀerent gravity
and dark energy models (e.g., Refs.
[1–15]). To in-
terpret the measurement of kinetic Sunyaev-Zel’dovich
eﬀect, understanding the statistics of the momentum
(mass/observed number density-weighted velocity) ﬁeld
is important. Theoretical modelling of these statistics
suﬀers from uncertainties in galaxy density bias. How-
ever, obtaining the observed number density-weighted
and mass-weighted velocity is straightforward from
galaxy velocity data and simulations.

For the cosmological measurement of redshift-space
distortions (RSD), understanding the statistics of the
volume-weighted velocity is the key [16]. For theoret-
ically motivated questions regarding the formation and
dynamics of the cosmic large-scale structure, it is also
important to understand the space-ﬁlling velocity ﬁeld.
The volume-weighted velocity statistics is free of uncer-
tainties from galaxy bias. However, it could only be de-
rived indirectly from the velocity of a particle/halo set in
simulation (a mass-weighted sample). Thus, modelling
of the volume-weighted velocity is nontrivial due to the
sampling artifacts induced by velocity assignment meth-
ods (e.g., Refs. [17–21]).

These sampling artifacts arise from the fact that the
observed sample (particles/haloes in simulation or galax-

∗ yuyu22@shao.ac.cn
† zhangpj@sjtu.edu.cn

ies in observation) distributes highly nonuniformly. The
induced bias in simulation measurement hampers the
theoretical understanding of the velocity ﬁeld. A biased
theoretical understanding can lead to biased cosmologi-
cal constraints, even the velocity measurements are unbi-
ased like the one inferred from RSD measurement. Thus,
understanding and quantifying the sampling artifacts or
exploration of good velocity assignment method is im-
portant.

In the literature, several methods have been pro-
posed to obtain the volume-weighted velocity ﬁeld. The
Voronoi tessellation (VT) method [17] is a zeroth-order
interpolation scheme. One constructs the Voronoi tessel-
lation from a set of nodes (i.e., particles/haloes). The
velocity inside a tessellation element (i.e.
the Voronoi
polyhedral) is approximated as the velocity of the only
particle inside. One obtains the velocity on regular grids
by smoothing this space-ﬁlling velocity ﬁeld. The De-
launay tessellation (DT) method [18] is a linear inter-
polation scheme. One ﬁrst constructs the Delaunay tes-
sellation, which is the dual of Voronoi tessellation. The
velocity gradient inside a Delaunay tessellation element
(i.e.
the Delaunay tetrahedron) is approximated as a
constant and is determined by the velocity of the four
vertices. Also, the volume-weighted quantities are deter-
mined by smoothing the interpolated velocity ﬁeld.
In
the works by Zheng et al. [22] and Koda et al. [19], the
nearest-particle (NP) method was proposed and applied.
It assigns the velocity of a regular grid point as the veloc-
ity of the nearest particle to it. The sampling artifacts for
the NP method are modelled (see Ref. [20]) and quanti-
ﬁed in simulation (see Ref. [21]).

In our previous work [23] (Hereafter, Paper I), the most
straightforward Kriging method was proposed to derive
the volume-weighted velocity and the performance was
quantiﬁed. The Kriging method models the interpolated
values by a Gaussian process governed by prior covari-
ances. It can be understood as a linear prediction or a
form of Bayesian inference. With a set of positions ob-
served, a new value can be predicted at any new spatial
location by combining the Gaussian prior with a Gaus-
sian likelihood function for each of the observed values.
In the case that the velocity ﬁeld is Gaussian, it gives the
most likely velocity at the interpolated position based on
the position of points with known velocity.

However, no existing method has demonstrated the ca-
pability to match the stringent requirement (1% mod-
elling accuracy) of Stage IV dark energy projects. (1) In
the work by Jennings et al. [24], a signiﬁcant sampling
bias is reported in the velocity divergence power spectra
obtained by the DT method. At z = 0 and 0.7, the sam-
pling artifact decreases the measured velocity power by
approximately 20 percent at k = 0.1hMpc−1 for a sample
with mean number density of nP = 2×10−3(h−1Mpc)−3.
This sampling bias increases to ∼ 40 per cent for a nP =
1.2 × 10−4(h−1Mpc)−3 sample at k = 0.07hMpc−1. (2)
On the other hand, the NP method causes ∼ 12 percent
underestimation of the velocity power spectrum at k =
0.1hMpc−1 for a sample with nP ∼ 6 × 10−4(hMpc−1)−3
(see Ref.
[21]). (3) In Paper I, we found that the most
straightforward Kriging performs only at a comparable
level to the NP method. However, as discussed in Paper
I, potential improvement could be made by more deli-
cate version of Kriging. The key ingredient in Kriging is
the input variogram prior. The resulting velocity power
spectrum is quite sensitive to the variogram prior when
the sampling fraction is low, as reported in Paper I. This
paper presents our try to improve the Kriging method by
considering more delicate variogram priors.

In Sec.

This paper is organized as follows.

II, we
brieﬂy introduce the general idea of Kriging and the most
straightforward Kriging method adopted in Paper I. The
more delicate variogram to improve the Kriging is also
proposed in this section. The simulation we use and
the most concerned statistics, the E-mode velocity power
spectrum obtained from the Kriging method, is brieﬂy
described in Sec. III. We present the performance test of
the more delicate version of the Kriging method in Sec.
IV. We conclude and discuss in Sec. V.

II. KRIGING INTERPOLATION

A. General idea of Kriging

values at known positions,

y∗ = Xi

Wiyi .

2

(1)

By minimizing the error with respect to the data accord-
ing to the mean-square variation, the weighting W is
determined. Therefore, Kriging relies on the variogram
of the ﬁeld as a prior to interpolate. The variogram is
the mean-square variation of ﬁeld values as a function of
the separation.

γ(r) =

1
2

h[y(x + r) − y(x)]2i ,

(2)

in which the ensemble average is over all spatial posi-
tions. In Paper I, we assumed that the velocity variogram
only depends on the distance under the assumption of
isotropy.

Usually in the limit r → 0, the variogram function
approaches to zero. In this case, Kriging honors the ob-
served values at observed positions. However, for some
cases, ﬁeld values could change signiﬁcantly even for
small separation. This could happen when there exists
measurement error in observation. In this case the ob-
served values diﬀer for multiple observation even at the
same point. One physical example in cosmology is the
nonlinearly evolved velocity ﬁeld. After shell crossing,
multistreams exist in cosmic ﬂow,
leading to nonzero
variogram at r = 0. This variogram behavior is called
the nugget eﬀect.
It describes the uncertainties exist-
ing within inﬁnitesimal distance. Thus, the nugget eﬀect
generally results to an extra smoothing in Kriging to sup-
press the impact from these uncertainties. Also due to
these uncertainties inferred by the nugget eﬀect, Krig-
ing allows the deviation of the predicted value from the
observed value even that the interpolated position is ob-
served.

With the variogram prior speciﬁed, the weighting W

is solved from the following Kriging system,

µ (cid:21) = (cid:20) γij 1
(cid:20) W

1T 0 (cid:21)−1(cid:20) γi∗

1 (cid:21) .

(3)

Here γij is the matrix containing the variogram values
between observed points, with γij = γ(rij) = γ(|xi −
It has a dimension of nk × nk. Unity vector 1T
xj|).

is set for the unbiased condition Pi Wi = 1. γi∗ is the

vector containing variograms between the interpolated
point and the observed points. µ is Laplacian multiplier.
We refer the readers to the appendix of Paper I for the
derivation of the Kriging system.

We want to estimate the ﬁeld value at a given position
x∗ based on the nk observed points at xi with values of
yi = y(xi). Kriging predicts the value of the ﬁeld at this
position as a weighted linear combination of the nearby

B. Performance of the most straightforward

Kriging on the cosmic velocity ﬁeld

In Paper I, we applied the most straightforward Krig-
ing. The direction-averaged variogram from linear theory

was adopted as the input prior to Kriging interpolate the
cosmic velocity ﬁeld. Namely,

ξvv(r) = H 2Z d ln k

∆2
θθ
k2

sin(kr)

kr

,

γ(r) = 1 − ξvv(r)/ξvv(0) .

(4)

(5)

Here, H is the Hubble parameter and ∆2
θθ(k) =
k3Pθθ(k)/2π2 is the velocity divergence power spectrum.
ξvv(r) and γ(r) is the isotropic velocity correlation func-
tion and variogram.

In RSD measurement, the growth rate is probed by the
velocity power spectrum inferred from the anisotropic
clustering. Thus we concern the Kriging performance
on the velocity power spectrum, especially the E-mode
component which contains the most cosmological infor-
mation. To understand the Kriging method, the depen-
dence of the performance on the variogram prior γ(r),
the number nk of the nearby particles to interpolate, and
the mean number density nP of the observed sample is
studied.

The main conclusion of Paper I is that the most
straightforward Kriging induces 1% and 3% systemat-
ics at k ∼ 0.1hMpc−1 when nP ∼ 6 × 10−2(h−1Mpc)−3
and nP ∼ 6×10−3(h−1Mpc)−3, respectively. The bias in-
creases for decreasing sample density and decreasing scale
(increasing k), as expected. Kriging fails when the ob-
served sample is too sparse (nP . 6 × 10−4(h−1Mpc)−3).
In these cases, a heavy smoothing eﬀect dominates small
scales.

The behavior by increasing nk from 1 to 200 helps to
understand the Kriging method. We found that Kriging
is dominated by smoothing eﬀect when nk is small. Fur-
ther increasing nk helps to recover the small-scale power.
However, for nP . 6 × 10−4(h−1Mpc)−3 cases, the ob-
served sample is too sparse that the recovery is limited.

Finally, the sensitivity of the resulting power spectrum
on the theoretically predicted variogram is studied by
adopting two inconsistent variogram priors. Kriging is
found to be more sensitive to the variogram prior for
a lower sample density. This limits the application of
Kriging to cosmology.

The most straightforward application of Kriging on the
cosmic velocity ﬁeld does not show obvious advantages
over other existing velocity assignment methods in the
literature. This strongly motivates us to develop a more
delicate version of Kriging. For a given observed velocity
sample, the variogram prior is the only ingredient af-
fecting the Kriging performance when suﬃcient particles
are used in interpolation. As stated in Paper I and the
following section, the velocity correlation/variogram is
anisotropic on all scales. Thus, improving the variogram
prior by considering this anisotropy is the ﬁrst try.

3

FIG. 1. The theoretically predicted two velocity correla-
tion functions ψ⊥(r) (solid line) and ψk(r) (dotted line) that
form the anisotropic velocity correlation function (Eq. 6).
The direction-averaged velocity correlation function (Eq. 10)
adopted in the most straightforward Kriging is presented
in dashed line. The direction-averaged velocity correlation
between diﬀerent velocity components is presented in dot-
dashed line.

C. More delicate variogram prior

The velocity correlation ξαβ(r) ≡ hvα(r1)vβ(r2)i be-
tween the αth velocity component at position r1 and βth
component at r2 = r1 + r can be decomposed into two
isotropic correlation functions ψ⊥(r) and ψk(r) (see Ref.
[25]),

ξαβ (r) = ψ⊥(r)δαβ + [ψk(r) − ψ⊥(r)]

rαrβ
r2

.

(6)

Here α, β = x, y, z indicates the velocity components

in Cartesian coordinate. δαβ is the Kronecker delta.

For the approximation that velocity is a potential ﬂow,

we have the textbook result (see [25])

ψ⊥(r) = 3H 2Z d ln k

∆2
θθ

k2 (cid:20) sin(kr)
(kr)3 −

cos(kr)

(kr)2 (cid:21) ,

(7)

ψk(r) = 3H 2Z d ln k

∆2
θθ

k2 (cid:20) sin(kr)

kr

− 2

sin(kr)
(kr)3 + 2

cos(kr)

(kr)2 (cid:21) .

(8)
ψk and ψ⊥ are not independent. One can easily ﬁnd the
consistency relation,

ψk(r) =

d(rψ⊥(r))

dr

.

(9)

Theoretically predicted (normalized) ψ⊥ and ψk are pre-
sented in Fig. 1. Also, averaged over the directions of r,
one obtains the relation with the isotropic velocity cor-
relation function adopted in Paper I,

ξvv(r) =

1
3

(ψk(r) + 2ψ⊥(r)) .

(10)

4

FIG. 2. The theoretically predicted velocity correlation function between the same x component ξxx(r) and between x-y
component ξxy(r) is presented in the left and right panel, respectively. Strong anisotropy can be seen in the velocity correlation
function. For x velocity component, the correlation ξxx(r) is stronger in the perpendicular y direction and smaller in the
parallel x direction.

From Eq. 6, we can see that for one speciﬁc velocity

component vα, the velocity correlation is

ξαα(r) = ψ⊥(r) + [ψk(r) − ψ⊥(r)]

r2
α
r2 ,

(11)

which is anisotropic on all scales (also see Fig. 7 and re-
lated description in Ref. [22]). For visualization, we plot
the anisotropic velocity correlation function ξxx(r) in the
left panel of Fig. 2. Strong anisotropy is observed in this
velocity correlation function. This physical anisotropy
implies that, to interpolate one speciﬁc velocity compo-
nent, the optimal weighting diﬀers for particles at diﬀer-
ent directions. It also implies that for a given position,
the weighting for each velocity component is diﬀerent.

Since traditionally we use the variogram instead of
covariance in the Kriging system, we denote γαα(r) ≡
1 − ξαα(r)/ξαα(0), γ⊥(r) ≡ 1 − ψ⊥(r)/ψ⊥(0) and γk(r) ≡
1 − ψk(r)/ψk(0). The corresponding anisotropic vari-
ogram is

γαα(r) = γ⊥(r) + [γk(r) − γ⊥(r)]

r2
α
r2 .

(12)

Notice that in Paper I, since the isotropic variogram
γ(r) is adopted, all the velocity components are Kriging
interpolated in the exactly same way.
In other words,
for one point in space, the Kriging system only need to

be solved once to obtain a set of weightings for the ob-
served positions. Each velocity component is the same
weighted combination of the same velocity component at
other positions, i.e.,

vx,∗ = Xi

Wivx,i , vy,∗ = Xi

Wivy,i , vz,∗ = Xi

Wivz,i .

(13)
When considering the anisotropy in the variogram prior,
the Kriging system for each velocity component is diﬀer-
ent, i.e., Wα 6= Wβ for α 6= β. Thus we need to solve
the Kriging system for each individual component. The
computational expense is tripled.

The correlation function between two velocity compo-

nents is

ξαβ(r) = [ψk(r) − ψ⊥(r)]

rαrβ
r2

for α 6= β .

(14)

We also present the velocity correlation function ξxy(r)
in the right panel of Fig. 2 for visualization. Although it
is zero when averaged over directions, the typical ampli-
tude is (ψk(r) − ψ⊥(r))/3, which is also presented in Fig.
1. Obviously, the (anti-)correlation between diﬀerent ve-
locity components is too weak to make the information
valuable in Kriging. Thus, we discard this information
and only Kriging interpolate one velocity component by
the same velocity component at other positions.

5

FIG. 3. E-mode velocity power spectrum from the Kriging method in which we arbitrarily choose the nugget value to be 0,
0.001 and 0.005 (dotted, dashed and solid lines, respectively). For f = 100% and 10%, the estimated power without nugget
eﬀect is boosted up in small scales, due to the instability in the Kriging system. Taking the nugget eﬀect into consideration
alleviates this problem, but smooths the power a little in small scales. We also plot the ratio to the reference cases in the right
panel to better show the nugget eﬀect.

III. SIMULATION SPECIFICATION

A. Simulation

We test the performance of this more delicate version
of Kriging on the same simulation data used in Paper
I. The simulation is run by a particle-particle-particle-
mesh code adopting the standard ﬂat Lambda Cold Dark
Matter (ΛCDM) model, with cosmological parameters
Ωm = 0.268, ΩΛ = 0.732, σ8 = 0.85, ns = 1 and h = 0.71
(see Ref. [26]). The dark matter (DM) particle number
is 10243 and the box size is 1200h−1Mpc. The statis-
tics (the E-mode velocity power spectrum) of the velocity
ﬁeld constructed from the full dark matter sample is veri-
ﬁed to be correct on the scale we concern, k . 0.1hMpc−1
(see Paper I). Therefore, without correct halo velocity
ﬁeld, we do not study the velocity constructed from simu-
lated halo sample. Instead, we randomly sample the DM
particles with fraction of 10%, 1%, 0.1%, 0.03% and 0.01%
to check the dependence of the velocity statistics upon
the sample density, and treat the results from f = 100%
cases as the reference cases. The sample density nP scales
with f as

Speciﬁcally, f = 0.1% and 1% correspond to the
number density of nP ∼ 6 × 10−4(h−1Mpc)−3 and
6 × 10−3(h−1Mpc)−3. Future wide spectroscopic survey
like Euclid [27] and DESI [28] could reach this number
density. Thus, the performance of the more delicate Krig-
ing for these two cases is of particular interest.

B. Statistics

Any vector ﬁeld could be decomposed into an E-mode
(gradient) and a B-mode (curl) component. Same as Pa-
per I, we focus on the E-mode velocity component, which
contains most of the cosmological information. First, we
Kriging interpolate the volume-weighted velocity ﬁeld on
regular grids. Then, we decompose the interpolated ve-
locity ﬁeld into an E-mode and a B-mode component,

v∗ = vE + vB ,

by using a fast Fourier Transform,

vE =

(v∗ · k)k

k2

,

vB = v∗ − vE .

(16)

(17)

(18)

nP =

10243
12003 f (h−1Mpc)−3 .

(15)

Traditionally, we present the E-mode velocity power
spectrum

Notice that we add f = 0.03% in this work, since the
most straightforward application of Kriging to the cos-
mic velocity ﬁeld suddenly fails between f = 0.1% and
0.01% (see Paper I). For each case, we interpolate veloci-
ties on 2563 uniform grid by the Kriging method from the
nearest nk = 200 observed points. This corresponds to
the grid size of 4.7h−1Mpc, which is safe to do analysis on
the most concerned scale, k ∼ 0.1hMpc−1. nk = 200 is
also suﬃciently large for the Kriging system to converge
(see Paper I).

Pvv(k) = hvE vE

∗i ,

(19)

in the form of ∆2

vv(k) = k3Pvv(k)/2π2.

We also obtain the same statistics for the velocity ﬁeld
derived by the Kriging method adopting isotropic var-
iogram. We compare these two results to see whether
there is improvement by considering the anisotropy in
the variogram.

We also perform the same analysis on three simulation
snapshots, z = 0, 1.07 and 1.87, to quantify the redshift
dependence of the Kriging method.

σD

f = 100% f = 10% f = 1% f = 0.1% f = 0.03% f = 0.01%

z = 0.00
z = 1.07
z = 1.87

LP

1.026
0.846
0.765

1.17

2.086
1.803
1.685

2.52

4.018
3.603
3.448

5.44

7.770
7.280
7.122

11.7

11.112
10.645
10.499

17.5

15.548
15.133
15.016

25.3

Lv
6.64
6.00
5.83

h−1Mpc

6

TABLE I. The r.m.s of the displacement ﬁeld, σD, for diﬀerent sampling fraction f and redshift z is presented in the top-left
corner of the table. The characteristic length describing the variation in velocity ﬁeld, Lv, for diﬀerent redshift is presented in
the last column. The mean particle separation, LP , for diﬀerent f is presented in the last row. They are all in unit of comoving
length h−1Mpc.

FIG. 4. E-mode velocity power spectrum from the Kriging
method is presented. The power from the more delicate Krig-
ing method in which the anisotropic variogram is adopted is
presented in solid lines, while the result of the most straight-
forward Kriging proposed in Paper I is presented in dotted
lines. Obvious improvement is observed. From top to bot-
tom, the result for z = 0, 1.07, 1.87 is presented.

FIG. 5. The ratio of velocity power spectrum to the reference
cases for f = 0.1%, 0.03% and 0.01% is presented from top to
bottom, respectively. Both the most straightforward Kriging
and the delicate one perform better for lower redshift for all
f cases.

B.

Introducing the nugget eﬀect

7

First, we Kriging interpolate the cosmic velocity ﬁeld
for z = 0 by adopting the linearly predicted anisotropic
variogram. The result is presented in the dotted line in
Fig. 3. We found that for the highest two sampling
fraction cases (i.e., f = 100% and 10%), the resulting
E-mode power boosts up at small scales. In these two
cases, the Kriging system is found to be unstable for a
large amount of grid points. For these grid points, the

resulting weighting does satisfy Pi Wi = 1. However,

each single Wi is abnormally large. This implies that the
Kriging system is almost degenerated for some velocity
component(s) on these grid points. We also check the
condition number for the matrix in Eq. 3, and it also
implies that the matrix is ill-conditioned.

Notice that this behavior only appears in the two high-
est sampling fraction cases. Adopting the anisotropic
variogram in the Kriging system may lead to inconsistent
solution from diﬀerent directions. This makes the Krig-
ing system degenerated. As described in Section II A, the
nugget eﬀect describes the uncertainties within inﬁnites-
imal distance. We expect that introducing the nugget
eﬀect allows the Kriging system to tolerate this inconsis-
tency from diﬀerent directions. Thus, we try to include
the nugget eﬀect to alleviate this problem.

Including the nugget eﬀect is straightforward to imple-
ment. We just add the nugget value into the normalized
variogram, γ → γ + nugget. We arbitrarily choose the
nugget value of 0.001 and 0.005 to see which value could
avoid the problem. From Fig. 3, we found that a nugget
value of 0.001 solves the problem for f = 10%, but the
power of f = 100% case still boosts up. A nugget value
of 0.005 fully solves the problem for all the cases we con-
sider. Meanwhile, we also found the resulting powers
are suppressed at small scales due to the nugget eﬀect.
The suppression is larger for larger nugget value. This
is expected for the fact that the nugget value is a prior
for uncertainties for the observed points. Including the
nugget eﬀect makes Kriging to apply an extra smoothing
to suppress this uncertainties. Fortunately, the suppres-
sion due to the extra nugget eﬀect is only at mild level.
It does not aﬀect the performance of Kriging crucially.
Notice that for f = 1% and 0.1%, of which we are most
concerned, the Kriging system without the nugget eﬀect
is stable and it is not compulsive to include the nugget
eﬀect for these two cases. The main focus of this work is
to see whether including the anisotropy in the variogram
improves the Kriging method. A mild suppression only
aﬀects the detailed number quantifying the level of im-
provement, but does not aﬀect the conclusion whether
there is an obvious improvement. Thus, to keep the re-
sults for diﬀerent cases comparable, we still include the
nugget eﬀect with a value of 0.005 for all the cases in the
following analysis.

FIG. 6. E-mode velocity power spectrum deviations induced
by adopting two inconsistent variograms predicted from a
Ωm = 0.3 and Ωm = 0.236 ﬂat universe. The vertical dotted
line indicates the most concerned scale k = 0.1hMpc−1. Com-
pared to the result in Paper I, the deviation is suppressed by
considering more reasonable variogram. For f = 0.1%, 0.03%
and 0.01%, the deviation is controlled at 1%, 3% and 5% level
at k = 0.1hMpc−1. The sensitivity on the variogram prior is
weakened compared to the result in Paper I.

IV. PERFORMANCE OF KRIGING

A. Anisotropy in the variogram

We use the CLASS code [29] to generate linear velocity
divergence power spectrum ∆2
θθ. Adopting Eq. 7 & 8,
the two velocity correlation functions ψ⊥(r) and ψk(r)
are derived, which is presented in Fig. 1. We calculate
the two-dimensional anisotropic correlation function for
one velocity component, ξxx(r), according to Eq. 11,
and the two-dimensional anisotropic correlation function
between two velocity components, ξxy(r), according to
Eq. 14. They are presented in the left and right panel of
Fig. 2, respectively. We can see that for the x velocity
component, the correlation length is larger along the
perpendicular y direction and smaller along the parallel
x direction. This could be understood as follows: One
can imagine the isotropic in-falling scenario. The matter
elements at diﬀerent radial position experience diﬀerent
potential gradient, but the matter elements adjacent
along tangential direction experience same potential
gradient. Thus, for one speciﬁc velocity component, the
correlation function shows strong anisotropy. In Kriging
interpolation, we expect larger contribution from the
observed points in the perpendicular direction than the
ones in parallel direction.

C.

Improvements

An immediate ﬁnding

We redo the analysis on the Kriging interpolated cos-
mic velocity ﬁeld with both the anisotropy and the nugget
eﬀect with a value of 0.005 in the variogram prior. The
E-mode velocity power spectrum of z = 0 is presented in
the top panel of Fig. 4 in solid lines. The result from Pa-
per I (the most straightforward Kriging) is also presented
in dotted lines for comparison.
is

considering the
anisotropy in the variogram indeed obviously improve
the Kriging method. The severe small-scale suppression
in the most straightforward Kriging is alleviated much
for f = 0.1%, 0.03% and 0.01%. The scale at which the
resulting power deviates from the reference case moves
towards small-scale by a factor ∼ 1.6 for z = 0. Thus,
the reliable region for the statistics of the Kriging inter-
polated cosmic velocity ﬁeld is extended by considering
the anisotropy in the variogram prior. Also, due to this
improvement, we are more conﬁdent on applying Kriging
to samples with lower number density.

that

Same as Paper I, we adopt two inconsistent variogram
priors to check the behavior of the resulting power. We
choose the variogram priors predicted by a Ωm = 0.3
and 0.236 Universe while keeping the Universe ﬂat. The
ratio of the resulting power from adopting inconsistent
variograms to the one adopting the correct variogram is
presented in Fig. 6. Compared to the right panel of Fig.
5 in Paper I, we ﬁnd that for all cases, the deviation am-
plitude is suppressed. At k = 0.1hMpc−1, the deviation
amplitude is reduced from 2% to 1% and from 8% to 5%
for f = 0.1% and 0.01%, respectively. Thus, the sensitiv-
ity to the variogram prior is weakened. This is of crucial
importance, since the manually chosen variogram prior
is the main limiting factor that hamper applying Kriging
on cosmology.

These improvements above imply that the variogram
prior has a great impact on the statistics of the inter-
polated cosmic velocity ﬁeld. A good variogram prior
could improve the Kriging performance a lot, especially
for the low sampling fraction cases. The ultimate goal
is to make the Kriging interpolated velocity applicable
on cosmology. As discussed in Paper I, towards this ul-
timate goal, an iterative process is an approach. In the
iterative method, an accurate variogram model is the key,
which relies on the understanding of the velocity itself.
Thus, the observed improvement by the more delicate
variogram prior is a notable step forward.

D. Redshift dependence

We also repeat the above analysis on two arbitrarily
chosen redshifts, z = 1.07 and 1.87. To clearly show
the performance, we plot the ratio to the reference for
each case. The results are presented in Fig. 5. Since
we care more about the performance when the sampling
fraction is low, the result for f = 0.1%, 0.03% and 0.01%

8

is presented from top to bottom. For each f case, the
ratio is plotted in red, green and blue lines for z = 0,
1.07 and 1.87, respectively. Again, the result for the more
delicate Kriging is presented in solid lines and the one for
the most straightforward Kriging is presented in dotted
lines.

For all redshifts, both the most straightforward Krig-
ing (dotted lines) and the delicate one (solid lines) be-
have similarly. After detailed comparison among the re-
sults for diﬀerent redshifts, we ﬁnd a larger suppression
in power at small scales and a larger scale at which the re-
sulting power deviates from the reference towards higher
redshift. This worse performance for higher redshift is
observed both for the most straightforward Kriging and
the delicate one.

Same as Paper I, we measure the characteristic length

for the velocity ﬁeld of the reference cases,

Lv = (cid:18) h(∇ · v)2i

hv2i (cid:19)− 1

2

.

(20)

This characteristic length describes the length on which
the velocity ﬁeld varies signiﬁcantly. The measured Lv
is presented in last column of Tab. I. The mean particle
separation,

LP =

1200
1024

f −1/3 h−1Mpc ,

(21)

for diﬀerent sampling fractions is also listed in the last
row of Tab. I. We ﬁnd that the Lv dependence on the
redshift is weak. All Lv’s locate between the mean par-
ticle separation LP for f = 1% and 0.1%. This explains
that for all redshifts, the Kriging method suddenly fails
for f . 0.1%. In detail, a decreasing Lv = 6.64hMpc−1,
6.00hMpc−1 and 5.83hMpc−1 is observed for increasing
redshift, z = 0, 1.07 and 1.87. This implies that, for
higher redshift, the velocity varies signiﬁcantly at smaller
comoving distance. Thus, to catch this variation equally
well, a higher sampling fraction is needed for higher red-
shift. However, the simulation has a ﬁxed number of
particles at all redshifts for a given sampling fraction
f , leading to worse Kriging performance both for the
most straightforward Kriging and the delicate one to-
wards higher redshift.

Another source aﬀecting the performance of Kriging
is the intrinsic large-scale clustering. Due to the non-
linear evolution, the distance of the nearest-particle to a
grid point in overdense region decreases, and increases for
the grid point in underdense region. But for lower red-
shift, void region occupies larger volume fraction. This
leads to increasing mean distance of the nearest-particle
to a grid point for increasing clustering. Thus, the mean
distance of the nearest-particle to a grid point is a mea-
sure of intrinsic large-scale clustering. Here, we introduce
the deﬁnition of the displacement ﬁeld in the modelling
of the sampling artifacts for the NP method (see Ref.
[30]). The displacement ﬁeld D is a vector ﬁeld start-
ing at a grid point and pointing to the nearest-particle

to it. Thus, the mean distance of the nearest-particle to
a grid point is just the r.m.s. of the D ﬁeld, σD. The
measured value of σD for diﬀerent sampling fraction f
and redshift z is listed in the top-left corner of Tab. I.
For a given sampling fraction f , σD is larger for lower
redshift, indicating that the particle distribution is more
inhomogeneous. Thus, in overdense region, the parti-
cles are denser towards lower redshift. However, adding
more sampling points in small region will not improve
the Kriging much. On the contrary, a larger intrinsic
clustering also means that there is fewer particles in the
underdense region. This implies that in the underdense
region, towards lower redshift the velocity ﬁeld is even
worse sampled. From this argument, we expect that the
intrinsic large-scale clustering eﬀect trends to make Krig-
ing performance better towards higher redshift.

The above two eﬀects are competing. Thus, it is not
easy to estimate the redshift dependence of the Krig-
ing method. From the simulation result, we found that
the former overwhelms the later, leading to worse per-
formance for higher redshift. Notice that for the NP
method, the redshift dependence is diﬀerent for diﬀer-
ent sampling fraction f (see Fig. 3-5 in [21] and relevant
discussions), while the Kriging method performs better
for lower redshift for all the sampling fractions.

V. CONCLUSION AND DISCUSSION

We improved the Kriging method proposed in Pa-
per I by adopting more delicate variogram prior, aim-
ing to better obtain the volume-weighted cosmic velocity
ﬁeld from N-body simulation. The improvement mainly
comes from correctly considering the anisotropy in the
variogram prior. The performance of this more delicate
version of Kriging was quantiﬁed by the E-mode veloc-
ity power spectrum, and the dependence on the sampling
fraction f and redshift z was studied. Compared to Paper
I, we add the analysis for f = 0.03%, since the perfor-
mance deteriorates rapidly towards low sampling fraction
f . 1%. Meanwhile, these cases are of particular concern
since they correspond to the observed halo number den-
sity in our Universe in current and future observations.
Firstly, we reported that this anisotropy in the vari-
ogram makes the Kriging system unstable in high sample
fraction case f = 100% and 10%. Including the nugget
eﬀect with a value of 0.005 in the variogram can avoid this
problem, although an extra mild smoothing eﬀect is also
introduced in the resulting power. This extra smoothing
eﬀect did not change the main conclusion of this work.

We found the performance of Kriging has obvious im-
provement in two aspects for the low sampling fraction
cases f = 0.1%, 0.03% and 0.01% when the anisotropy
in the variogram is considered. The main result is pre-
sented in Fig. 4 and Fig. 6. For one aspect, the severe
suppression in the E-mode velocity power spectrum for
these low sampling fraction cases is greatly alleviated.
This improvement reduces the systematics induced by

9

the Kriging method as a velocity assignment method, es-
pecially for the low sampling fraction cases. Thus, the
reliable region was extended to smaller scale. This also
implies that for a given systematic error requirement, the
applicability is extended to lower f cases. Furthermore,
the impact from adopting inconsistent variogram priors
is weakened compared to the most straightforward Krig-
ing. This improvement is important towards applying
Kriging on cosmology.

Considering the anisotropy in the variogram greatly
improves the Kriging performance. This indicates that a
good variogram prior is the key to the Kriging method.
For some cases, for example f & 0.03% at z = 0, overes-
timated power is still observed at the scale slightly larger
than the smoothing dominating scale. As discussed in
Paper I, this may be induced by adopting the linear var-
iogram prediction.

In this work we only Kriging interpolate one of the
velocity components by the same component of nearby
particles. Thus, only the velocity correlation (variogram)
between the same component, ξαα (γαα), is used. One
may ask whether prior information from the correlation
between diﬀerent velocity components helps. Actually,
Kriging could make use of this information. Notice that
Kriging interpolation is also called Kolmogorov-Wiener
prediction. Thus, any data that correlates with the target
data could be used to help the prediction. This is called
co-Kriging. In the ideal case that the velocity is a gra-
dient ﬁeld and the velocity ﬁeld is well sampled, one can
reconstruct one of the velocity components from another
component equally as well as from the same component.
However, this idea is impractical in reality, due to the
weak correlation between diﬀerent velocity components,
and the limited number of observed points. We also tried
to extend the Kriging to interpolate one of the velocity
component from all the velocity components of nearby
particles. This extension is straightforward by extend-
ing the variogram matrix to include all the correlation
functions ξαβ for all α, β. However, we found this pro-
cess is extremely unstable. For most of the grid points,
the Kriging system is degenerated, unless extremely low
nk ∼ 5 is adopted. However, for such a low nk, the
smoothing eﬀect of Kriging dominates, leading to a large
suppression in the resulting power, as reported in Paper I.
Thus, adding this prior information from the correlation
between diﬀerent velocity components does not help.

The velocity ﬁeld is correlated with dark matter den-
sity ﬁeld. Under the linear evolution, the two are fully
correlated. Although the correlation is weakened by the
B-mode and stochastic E-mode component produced by
the late time nonlinear evolution, it is expected to be
strong enough to provide useful information to Kriging.
It is also suggested that the velocity component that cor-
relates with the density ﬁeld (a part of the E-mode com-
ponent, i.e. the vδ component in Refs.
[22, 30]) is the
one really responsible for the large-scale Kaiser eﬀect [1].
Thus, taking the prior information between the velocity
and density ﬁeld may help to construct the velocity com-

10

ponent that correlates with the density ﬁeld. We leave
this conﬁrmation in the future work.

ACKNOWLEDGMENTS

We thank Yi Zheng and Han Miao for useful dis-
cussions. This work was supported by National Ba-
sic Research Program of China (973 Programs No.
2013CB834900 and No. 2015CB857001), the National
Science Foundation of China (Grants No.
11403071,
No. 11025316, No. 11320101002, No. 11433001, and

No. 11273018), the Strategic Priority Research Program
“The Emergence of Cosmological Structures” of the Chi-
nese Academy of Sciences (Grant No. XDB09000000),
and the key laboratory grant from the Oﬃce of Sci-
ence and Technology, Shanghai Municipal Government
(Grant No. 11DZ2260700). J.Z. is supported by the
national Thousand Talents Program for distinguished
young scholars and the T.D. Lee Scholarship from the
High Energy Physics Center of Peking University. This
work made use of the High Performance Computing Re-
source in the Core Facility for Advanced Research Com-
puting at Shanghai Astronomical Observatory.

[1] N. Kaiser, Mon. Not. R. Astron. Soc. 227, 1 (1987).
[2] J. A. Peacock, S. Cole, P. Norberg, C. M. Baugh,
J. Bland-Hawthorn, T. Bridges, R. D. Cannon, M. Col-
less, C. Collins, W. Couch, G. Dalton, K. Deeley, R. De
Propris, S. P. Driver, G. Efstathiou, R. S. Ellis, C. S.
Frenk, K. Glazebrook, C. Jackson, O. Lahav, I. Lewis,
S. Lumsden, S. Maddox, W. J. Percival, B. A. Peterson,
I. Price, W. Sutherland, and K. Taylor, Nature (London)
410, 169 (2001), astro-ph/0103143.

[3] E.

V.

Linder

and

A.

Jenkins,

Mon. Not. R. Astron. Soc. 346, 573 (2003),
astro-ph/0305286.

[4] P. Zhang, M. Liguori, R. Bean,

and S. Dodelson,

Phys. Rev. Lett. 99, 141302 (2007), arXiv:0704.1932.

[5] L. Guzzo, M. Pierleoni, B. Meneux, E. Branchini, O. Le
F`evre, C. Marinoni, B. Garilli, J. Blaizot, G. De Lu-
cia, A. Pollo, H. J. McCracken, D. Bottini, V. Le Brun,
D. Maccagni, J. P. Picat, R. Scaramella, M. Scodeg-
gio, L. Tresse, G. Vettolani, A. Zanichelli, C. Adami,
S. Arnouts, S. Bardelli, M. Bolzonella, A. Bongiorno,
A. Cappi, S. Charlot, P. Ciliegi, T. Contini, O. Cucciati,
S. de la Torre, K. Dolag, S. Foucaud, P. Franzetti, I. Gav-
ignaud, O. Ilbert, A. Iovino, F. Lamareille, B. Marano,
A. Mazure, P. Memeo, R. Merighi, L. Moscardini,
S. Paltani, R. Pell`o, E. Perez-Montero, L. Pozzetti,
M. Radovich, D. Vergani, G. Zamorani, and E. Zucca,
Nature (London) 451, 541 (2008), arXiv:0802.1944.

[6] B. Jain and P. Zhang, Phys. Rev. D 78, 063503 (2008),

arXiv:0709.2375.

[7] Y. Wang, J. Cosmol. Astropart. Phys. 5, 021 (2008),

arXiv:0710.3885.

[8] R. Reyes, R. Mandelbaum, U. Seljak, T. Bal-
and R. E.
Nature (London) 464, 256 (2010),

dauf,
Smith,
arXiv:1003.2185 [astro-ph.CO].

J. E. Gunn, L. Lombriser,

[9] M. Li, X.-D. Li,

and Y. Wang,
Communications in Theoretical Physics 56, 525 (2011),
arXiv:1103.5870.

S. Wang,

[10] T. Clifton, P. G. Ferreira, A. Padilla,

and
Physics Reports 513, 1 (2012),

C.
arXiv:1106.2476 [astro-ph.CO].

Skordis,

[11] B. A. Reid, L. Samushia, M. White, W. J. Per-
cival, M. Manera, N. Padmanabhan, A. J. Ross,
A. G. S´anchez, S. Bailey, D. Bizyaev, A. S. Bolton,
H. Brewington, J. Brinkmann, J. R. Brownstein, A. J.
Cuesta, D. J. Eisenstein, J. E. Gunn, K. Honscheid,

E. Malanushenko, V. Malanushenko, C. Maraston, C. K.
McBride, D. Muna, R. C. Nichol, D. Oravetz, K. Pan,
R. de Putter, N. A. Roe, N. P. Ross, D. J. Schlegel,
D. P. Schneider, H.-J. Seo, A. Shelden, E. S. Sheldon,
A. Simmons, R. A. Skibba, S. Snedden, M. E. C. Swan-
son, D. Thomas, J. Tinker, R. Tojeiro, L. Verde, D. A.
Wake, B. A. Weaver, D. H. Weinberg, I. Zehavi, and G.-
B. Zhao, Mon. Not. R. Astron. Soc. 426, 2719 (2012),
arXiv:1203.6641 [astro-ph.CO].

[12] R. Tojeiro, W. J. Percival, J. Brinkmann, J. R.
Brownstein, D. J. Eisenstein, M. Manera, C. Maras-
ton, C. K. McBride, D. Muna, B. Reid, A. J.
Ross, N. P. Ross, L. Samushia, N. Padmanab-
han, D. P. Schneider, R. Skibba, A. G. S´anchez,
J. L. Tinker,
M. E. C. Swanson, D. Thomas,
L. Verde, D. A. Wake, B. A. Weaver,
and G.-
B. Zhao, Mon. Not. R. Astron. Soc. 424, 2339 (2012),
arXiv:1203.6565 [astro-ph.CO].

[13] D. H. Weinberg, M.
C. Hirata,

Eisenstein,
E.
arXiv:1201.2434 [astro-ph.CO].

Rozo,

J. Mortonson, D.
A. G. Riess,

J.
and
Physics Reports 530, 87 (2013),

[14] A. Joyce, B. Jain, J. Khoury,

and M. Trodden,

Physics Reports 568, 1 (2015), arXiv:1407.0059.

[15] K. Koyama, ArXiv e-prints (2015), arXiv:1504.04623.
[16] In the RSD measurement, the velocity power spectrum
is inferred indirectly and statistically from the redshift
space galaxy clustering. Since the clustering measure-
ment is unbiased, these velocity measurements them-
selves do not suﬀer from the sampling artifact [20].

[17] F. Bernardeau and R. van de Weygaert, Mon. Not. R.

Astron. Soc. 279, 693 (1996).

[18] W. E. Schaap and R. van de Weygaert, Astron. Astro-

phys. 363, L29 (2000), astro-ph/0011007.

Springob, M.

[19] J. Koda, C. Blake, T. Davis, C. Magoulas,
John-
Staveley-Smith,

C. M.
son, G. B. Poole,
Mon. Not. R. Astron. Soc. 445, 4267 (2014),
arXiv:1312.1022 [astro-ph.CO].

Scrimgeour,
and L.

A.

[20] P.

Zhang,

Y.

Zheng,

and

Y.

Jing,

Phys. Rev. D 91, 043522 (2015), arXiv:1405.7125.

[21] Y.

Zheng,

P.

Zhang,

and

Y.

Jing,

Phys. Rev. D 91, 043523 (2015), arXiv:1409.6809.

[22] Y.

Zheng,

and
arXiv:1308.0886 [astro-ph.CO].

J.

P.
Pan,

Zhang,

Lin,
Phys. Rev. D 88, 103510 (2013),

Jing, W.

Y.

[23] Y. Yu,

J. Zhang, Y. Jing,

and P. Zhang,

Phys. Rev. D 92, 083527 (2015), arXiv:1505.06827.

[24] E.

Jennings, C. M. Baugh,

and D. Hatt,

Mon. Not. R. Astron. Soc. 446, 793 (2015),
arXiv:1407.7296.

[25] P. J. E. Peebles, Research supported by the National Sci-
ence Foundation. Princeton, N.J., Princeton University
Press, 1980. 435 p. (Princeton University Press, NJ,
1980).

[26] Y. P.

Jing,

Y.

Suto,

and H.

J. Mo,

Astrophys. J. 657, 664 (2007), astro-ph/0610099.

11

[27] Http://sci.esa.int/euclid/.
[28] Desi.lbl.gov/.
[29] Http://class-code.net/.
[30] P.

Zhang,

J.

Pan,

Phys. Rev. D 87, 063526 (2013),
arXiv:1207.2722 [astro-ph.CO].

and

Y.

Zheng,

