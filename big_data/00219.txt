MNRAS 000, 1–14 (2016)

Preprint 2 March 2016

Compiled using MNRAS LATEX style ﬁle v3.0

The data processing pipeline for the Herschel SPIRE
Fourier Transform Spectrometer (cid:63)

T. Fulton1,2†, D. A. Naylor1 E. T. Polehampton1,3, I. Valtchanov4,
R. Hopwood5, N. Lu6,7,8, J.-P. Baluteau9, G. Mainetti10,
C. Pearson3, A. Papageorgiou11, S. Guest3, L. Zhang8,
P. Imhof1,2, B. M. Swinyard3,12, M. J. Griﬃn11, T. L. Lim3
1Institute for Space Imaging Science, Department of Physics & Astronomy, University of Lethbridge, Lethbridge, Alberta, T1K 3M4, Canada
2Blue Sky Spectroscopy, 9, 740 4 Ave S, Lethbridge, Alberta, T1J 0N9, Canada
3RAL Space, Rutherford Appleton Laboratory, Didcot OX11 0QX, UK
4European Space Astronomy Centre, Herschel Science Centre, ESA, 28691 Villanueva de la Ca˜nada, Spain
5Physics Department, Imperial College London, South Kensington Campus, SW7 2AZ, UK
6National Astronomical Observatories of China, Chinese Academy of Sciences, Beijing 100012, China
7China-Chile Joint Center for Astronomy, Chinese Academy of Sciences, Camino El Observatorio, 1515 Las Condes, Santiago, Chile
8NASA Herschel Science Centre, IPAC, Pasadena, California, USA
9Laboratoire d’Astrophysique de Marseille - LAM, Universit´e d’Aix-Marseille & CNRS, UMR7326, 38 rue F. Jolit-Curie, 13388 Marseille Cedex 13, France
10Laboratoire AIM, CEA/DSM - CNRS - Irfu/Service d’Astrophysique, CEA Saclay, 91191 Gif-sur-Yvette, France
11Cardiﬀ University, The Parade, Cardiﬀ, UK
12University College London, Deptartment of Physics and Astronomy, London WC1E 6BT, United Kingdom

Accepted.. Received..; in original form ..

ABSTRACT
We present the data processing pipeline to generate calibrated data products from
the Spectral and Photometric Imaging Receiver (SPIRE) imaging Fourier Transform
Spectrometer on the Herschel Space Observatory. The pipeline processes telemetry
from SPIRE observations and produces calibrated spectra for all resolution modes.
The spectrometer pipeline shares some elements with the SPIRE photometer pipeline,
including the conversion of telemetry packets into data timelines and calculation of
bolometer voltages. We present the following fundamental processing steps unique
to the spectrometer: temporal and spatial interpolation of the scan mechanism and
detector data to create interferograms; Fourier transformation; apodization; and cre-
ation of a data cube. We also describe the corrections for various instrumental eﬀects
including ﬁrst- and second-level glitch identiﬁcation and removal, correction of the
eﬀects due to emission from the Herschel telescope and from within the spectrometer
instrument, interferogram baseline correction, temporal and spatial phase correction,
non-linear response of the bolometers, and variation of instrument performance across
the focal plane arrays. Astronomical calibration is based on combinations of observa-
tions of standard astronomical sources and regions of space known to contain minimal
emission.

Key words: methods: data analysis – techniques: spectroscopic – space vehicles:
instruments

1 INTRODUCTION

The Spectral and Photometric Imaging Receiver (SPIRE;
Griﬃn et al. 2010) Fourier Transform Spectrometer (FTS)

(cid:63) Herschel is an ESA space observatory with science instruments
provided by European-led Principal Investigator consortia and
with important participation from NASA.
† E-mail: trevor.fulton@uleth.ca

c(cid:13) 2016 The Authors

is a sub-mm imaging spectrometer that operated on board
the Herschel Space Observatory (Pilbratt et al. 2010) be-
tween May 2009 and April 2013. In an FTS, the incident ra-
diation is separated by a beam splitter into two beams that
travel diﬀerent optical paths before recombining. A moving
mirror changes the optical path diﬀerence (OPD) between
the recombining beams. The detector signal measured as a
function of OPD is known as the interferogram, which is
the inverse Fourier transform of the radiation incident on

6
1
0
2

 
r
a

M
 
1

 
 
]

M

I
.

h
p
-
o
r
t
s
a
[
 
 

1
v
9
1
2
0
0

.

3
0
6
1
:
v
i
X
r
a

2

T. Fulton et al.

Table 1. SPIRE Spectrometer spectral resolution options.

Table 2. SPIRE Spectrometer spatial sampling options.

Spectral

Resolution

Scan Length
(OPD) [cm]

Spectral Resolution
[cm−1]
[GHz]

Spatial
Sampling

Number of Positions
Tel. BSM Total

Pixel Size

[”]

SSW SLW

N/A
19.0
9.5
38.0
19.0
9.5

N/A
35.0
17.5
70.0
35.0
17.5

Single, Sparse
Single, Intermediate
Single, Full
Raster, Sparse
Raster, Intermediate
Raster, Full

1
1
1
n
n
n

1
4
16
1
4
16

1
4
16
n
4n
16n

(a)

(b)

Low
High

0.60
12.56

24.98
1.198

0.83

0.0398

spectrometer and includes contributions from the telescope,
the instrument and the source spectrum. The spectrum is
computed by Fourier transformation of the measured inter-
ferogram. The design of the FTS is described in more detail
in Ade et al. (1999), Dohlen et al. (2000), and Swinyard
et al. (2010).

This paper describes the pipeline processing steps neces-
sary to convert the measured interferogram signal into a cal-
ibrated astronomical spectrum. The operation and calibra-
tion of the instrument is described in the SPIRE Handbook
(2016) and by Swinyard et al. (2014). This paper describes
in detail the algorithms used for each pipeline step and pro-
vides a thorough description of the end-to-end processing
of the FTS data. Section 2 brieﬂy summarises the observing
modes of the instrument, as they are relevant to the pipeline,
Section 3 introduces the pipeline in terms of three data do-
mains: the time domain (processing timelines from the de-
tectors), the interferogram domain (signal in terms of OPD
position), and culminates in the spectral domain. Each step
of the pipeline is then described in detail. Section 5 presents
the conclusions and lessons learned. The pipeline described
here has been implemented in Java as part of the Herschel
Interactive Processing Environment (HIPE; Ott 2010).

2 OBSERVING MODES OF THE SPIRE FTS

The SPIRE FTS contains two bolometer detector arrays:
the Short Wavelength array (SSW), nominally covering the
spectral range between 958 to 1546 GHz (313 to 194 µm),
and the Long Wavelength array (SLW) that covers the range
from 447 to 990 GHz (671 to 303 µm). The two detector
arrays overlap on the sky as shown in the FTS footprint in
Fig. 1a. The outer ring of detectors is partially vignetted by
the instrument aperture and so the nominal “unvignetted”
ﬁeld of view of the instrument has a diameter of 2(cid:48). The
interferograms are produced by scanning the spectrometer
mechanism (SMEC), the moving mirror that modulates the
OPD. SPIRE also contains a Beam Steering Mirror (BSM)
which is used to redirect the beam for mapping observations.
Observations with the SPIRE FTS were designed us-
ing astronomical observation templates (AOTs), which are
described in detail in the SPIRE Handbook (2016). Each
observation consists of a number of simple operations, such
as conﬁguring the instrument, initialisation and science data
taking. These operations are referred to as “building blocks”.
The science data building block is the one used by the FTS
pipeline and is deﬁned as a set of equal-length scans of the
SMEC at a single pointing position of the Herschel tele-
scope and BSM. The spectral resolution is determined by
the maximum OPD, which is determined by the displace-
ment of the SMEC. The spectral resolution options available
to observers are shown in Table 1.

(c)

Figure 1. Astronomical footprint of the SPIRE detector ar-
rays for the image sampling modes (SPIRE Handbook 2016). (a)
sparse spatial sampling, (b) intermediate and (c) full sampling
(see Table 2). SSW detectors are represented by the small circles,
SLW detectors are represented by the larger circles. The single
large circle in each plot represents the 2(cid:48)diameter ﬁeld of view
that is covered by the unvignetted detectors.

The spatial sampling of the observation depends on the
number of FTS footprint positions, which are selected by
moving the BSM in a predeﬁned jiggle pattern. The sim-
plest “sparse” observation consists of a single BSM position,
and leads to detectors separated by two beam widths on the
sky (Fig. 1). A list of the spatial sampling options avail-
able is given in Table 2 and shown in Fig. 1. In addition
to jiggling the BSM, the Herschel telescope could also be
moved to cover a wider area with a raster pattern. The num-
ber of Herschel telescope pointing positions, n, depended on
the observing area requested and was limited by the maxi-
mum observing time for an observation (18 hours, see SPIRE
Handbook 2016).

The sensitivity of an observation was governed by the
number of scan repetitions requested by the observer. Each
repetition is a pair of forward and reverse SMEC scans and
all repetitions at a particular jiggle and telescope position
make up one science building block.

3 SPIRE SPECTROMETER PIPELINE

The SPIRE spectrometer data processing pipeline consists
of six major processing groups as shown in Fig. 2.

MNRAS 000, 1–14 (2016)

SPIRE Spectrometer Pipeline

3

Figure 3. Timeline modiﬁcation section of the SPIRE Spectrom-
eter building block pipeline.

3.1 Detector Timeline Modiﬁcations

After application of the processing steps common to
both the photometer and spectrometer detectors (Dowell
et al. 2010), the raw samples for each one of the 66 spec-
trometer detectors, denoted i, have been converted into RMS
voltage timelines, VRM S−i(t). These quantities are contained
in the Level 0.5 Spectrometer Detector Timeline Product
(SDT).

The processing modules described in the following sec-
tions are applied to the timelines for each spectrometer de-
tector. Each of the processing steps contained in this pro-
cessing block (see Fig. 3) accepts a Level-0.5 SDT product
as input and delivers an SDT product as output.

3.1.1 First level deglitching

The ﬁrst level deglitching task is used to remove the ef-
fects of cosmic ray hits on the detectors (see Fig. 5). Strong
glitches must be removed at the beginning of the pipeline
as their eﬀect can be spread into neighbouring data samples
by some of the downstream pipeline tasks (in particular, the
time-domain phase correction or the baseline correction). If
a glitch remains untreated, its eﬀect on the resulting spec-
trum depends on its location relative to zero optical path
diﬀerence (ZPD). A glitch at a particular value of OPD,
xglitch, will lead to a sinusoidal artefact in the spectral do-
main with a period of 1/xglitch.

In order to identify glitches, the pipeline employs an al-
gorithm which is based on a continuous wavelet transform
with a Mexican Hat wavelet and subsequent processing for
a local regularity analysis (Ord´enovic et al. 2008). The al-
gorithm uses the H¨older exponent, which describes the lo-
cal regularity of a function (Struzik 1999), and the analy-
sis of the local maxima of the wavelet transform modulus
(Mallat & Hwang 1992). The general assumption is that the
eﬀect of the glitch is similar to that of a Dirac delta func-
tion, although adjustments are made for the case of clipped
glitches. Various parameters can be used to tune the algo-
rithm, and these have been set conservatively for the stan-

Figure 2. SPIRE FTS data processing block diagram.

(i) Common Photometer/Spectrometer Process-
ing modules. These processing steps are common to both
the SPIRE spectrometer and photometer pipelines (Dowell
et al. 2010).

(ii) Modify Timelines. These processing modules per-
form operations on detector signals that are time-dependent.
The descriptions of the modules in this category are pre-
sented in Section 3.1.

(iii) Create Interferograms. This processing step
merges the timelines of the spectrometer detectors and spec-
trometer mechanism to produce interferograms. This step
produces a Level-1 Spectrometer Detector Interferogram
(SDI) product and is described in Section 3.2.

(iv) Modify Interferograms. The processing modules
in this group perform operations on the spectrometer detec-
tor interferograms. These operations diﬀer from those in the
”Modify Timelines” group in that they are designed to act
on signals that are a function of OPD rather than signals
that are a function of time. These processing modules are
described in Section 3.3.

(v) Transform Interferograms. This processing step
transforms the interferograms into a set of spectra. This step
is described in Section 3.4.

(vi) Modify Spectra. The processing modules in this
group perform operations on spectra. The steps in this cat-
egory combine to produce a Level-2 Spectrometer Detector
Spectrum (SDS) product and are described in Section 3.5.

MNRAS 000, 1–14 (2016)

4

T. Fulton et al.

(a)

(b)

(c)

Figure 4. Building Block Timelines. a) Spectrometer Detector
Signal, b) Spectrometer Mechanism, c) Scan counter

dard pipeline to avoid any distortion of the ZPD region
of the interferogram where the signal is naturally heavily
modulated, or locations in the interferogram where chan-
nel fringes are present(Naylor et al. 1988). The conservative
parameter settings adopted means that some glitches will
be missed. However, 2nd level deglitching (Section 3.3.2)
identiﬁes and removes glitches not identiﬁed in the timeline,
ensuring that they do not aﬀect the quality of the Level-2
spectra.

The task proceeds in two stages: the ﬁrst step detects
glitch signatures in the interferogram and the second step
locally reconstructs the signal. Data samples that have been

identiﬁed as glitches must be replaced so that the corrected
interferograms contain values at equal increments of OPD.

The detection algorithm parameters are as follows:

• The range and interval of wavelet scales used in ﬁtting
the wavelet transform modulus maxima lines. As the range
in scales directly aﬀects the execution time, it is set to keep
the number of elements to a minimum. The pipeline uses a
scale minimum of 1, maximum of 8 and interval of 5.
• The range in H¨older exponent values, which sets the
range of slopes that are interpreted as glitches and so aﬀects
the sensitivity of the detection algorithm. The pipeline uses
a minimum of −1.4 and maximum of −0.6.
• The correlation threshold used to enforce a minimum
goodness of ﬁt to each wavelet transform modulus maxima
line. It relates to the square of the correlation coeﬃcient of
the linear ﬁt to each line. The pipeline uses a value of 0.85.
The sensitivity of the glitch detection algorithm increases
for lower values of the threshold.

The glitch detection algorithm makes special accom-
modation for clipped glitches as they deviate systematically
from the Dirac shape. The range for the continuous wavelet
analysis is restricted by increasing the minimum scale value
by 1.

The reconstruction algorithm used by the standard
pipeline adopts an adaptive method that depends on the
size of the glitch. If fewer than 6 samples after the glitch are
aﬀected, a 6th order polynomial ﬁt is carried out, otherwise
a linear ﬁt is used (LeLeu et al. 2012). If a glitch is clipped,
then the linear ﬁt is used, extended over 10 samples after
the glitch peak.

Typically, for high resolution observations, the glitch
detection algorithm ﬂags about 1% of all data samples as
glitches and corrects them. Even fewer glitches will be iden-
tiﬁed for observations in low spectral resolution or bright-
source modes (Lu et al. 2014).

3.1.2 Detector non-linearity

The SPIRE bolometers respond linearly to absorbed power
only over a limited range of power, and therefore a correction
for non-linearity is required. The procedure to correct for
non-linearity is similar to that adopted for the SPIRE pho-
tometer (see Bendo et al. 2013; Swinyard et al. 2014), with
the linearisation carried out by integrating over the inverse
bolometer (non-linear) response function, f (V ), between a
ﬁxed reference voltage, V0, and the measured voltage, Vm;

Vm(cid:90)

V0

S =

f (V ) dV,

(1)

where S is a measure of the optical load on the detector.
This equation is normalised to the response at the reference
voltage, and approximated using three constants speciﬁc to
each bolometer, K1, K2 and K3. The linearised signal is
given by (Swinyard et al. 2014)

(cid:48)

= K1(Vm − V0) + K2 ln

V

.

(2)

(cid:19)

(cid:18) Vm − K3

V0 − K3

Note that the value of the reference voltage, V0, does not
aﬀect the ﬁnal spectrum, which depends only on the mod-
ulation of the interferogram about the baseline and not on

MNRAS 000, 1–14 (2016)

SPIRE Spectrometer Pipeline

5

reset at the beginning of each observation (except in bright-
source mode mapping observations, where it is reset more
frequently). If the measured interferogram is not centred in
the dynamic range, or has very strong modulation, some
samples may lie outside the edges of the dynamic range.
Such samples are referred to as “clipped” and ﬂagged in the
mask table attached to the data as “TRUNCATED’ (see
Fig. 6).

This clipping is most likely to occur near ZPD, where
the modulation is highest, or at high OPD, in particular
for the partially vignetted detectors at the edge of the ar-
ray whose interferogram baselines have signiﬁcant curvature.
Clipping near ZPD changes the spectral shape and so the
data from that detector should either be corrected or re-
moved.

The clipping correction task reconstructs the data sam-
ples ﬂagged as “TRUNCATED” using an 8th order polyno-
mial ﬁt to the surrounding unclipped samples. By default,
ﬁve data samples on either side of the clipped region are
ﬁtted with the polynomial. In tests where the interferogram
was artiﬁcially clipped such that the 4th lobe from ZPD was
aﬀected, the spectrum was corrected to better than 3%. A
level of clipping greater than this is not seen in normal ob-
servations (Polehampton et al. 2011).

If the source brightness changes signiﬁcantly in map-
ping observations between consecutive jiggle positions, how-
ever, it is possible that some detectors may have signiﬁcantly
worse clipping and in the worst case, the entire interferogram
may be truncated. If more than eight consecutive samples
are clipped, or if there does not exist at least ﬁve consecu-
tive unclipped samples on either side of the clipped sample,
then the 8th order polynomial cannot be used to reconstruct
that portion of the timeline and these samples also marked
as “TRUNCATED UNCORR” by the task.

The uncorrected samples are removed later in the
pipeline at the “create interferogram” stage (Section 3.2).
Flagged samples at the high OPD end of the interferogram
are removed, which eﬀectively reduces the spectral resolu-
tion of the scans for that detector. If there are no unclipped
samples left, the entire interferogram (i.e. one scan) is re-
moved for that detector. If all scans are removed, the de-
tector no longer appears in the output product. Finally, in
the baseline correction task (Section 3.3.1), any remaining
scans with fewer than 100 samples in the interferogram are
removed.

3.1.4 Time Domain Phase Correction

The SPIRE spectrometer detector chain contains a 6-
pole Bessel low pass ﬁlter (LPF) as well as single-pole RC
LPF (Cara 2005). In addition to the electronic LPFs, the
thermal behavior of the SPIRE bolometers can be modeled
as a simple RC LPF with a detector-speciﬁc time constant,
τ .

These two eﬀects may be combined into a single detec-

tor transfer function:

(a)

(b)

Figure 5. Example of a glitch in a Spectrometer Detector Time-
line. a) Full scan, b) Glitch region

its absolute value (Swinyard et al. 2014). Therefore, V0 was
simply set to the mean voltage in one observation of dark
sky.

For the nominal mode of the FTS, the values of K1, K2
and K3 between two limiting voltages Vmin and Vmax, were
calculated using a bolometer model (Mather 1982; Sudi-
wala et al. 2002), which is based on the bolometer ther-
mometry measured in the laboratory, and heat conductance
parameters measured in ﬂight (Nguyen et al. 2004). The
K-parameter values, the reference voltage, and the limit-
ing voltages are stored in a calibration product which is
ingested by the task. However, due to the much larger dy-
namic range required for the bright-source mode of the FTS,
and complications associated with de-phasing the analogue
ampliﬁer, the bright mode K-parameters were determined
directly from a ﬁt to observed data (see Lu et al. 2014)1.

3.1.3 Clipping Correction

A 16-bit Analogue-to-Digital Converter (ADC) is used
to digitise the output of the bolometer signal processing
chain (see Swinyard et al. 2014). The dynamic range of the
ADC for each detector is set inside the electronics by sub-
tracting a constant DC oﬀset level, which is measured and

1 At low detector temperatures, there are also small deviations
from the model in the nominal mode (on the order of ∼0.1%),
which may be corrected empirically in a future version of HIPE

HTotal−i(ω) = HLPF−i(ω) + HThermal−i(ω).

(3)

The overall transfer function shown above will aﬀect
both the magnitude and the phase of the signal recorded by

MNRAS 000, 1–14 (2016)

6

T. Fulton et al.

(a)

(b)

Figure 6. Example of a clipped Spectrometer Detector Timeline.
a) Full scan, b) Clipped region

the SPIRE detectors. The resulting phase can be expressed
as:

φTotal−i(ω) = tan

−1

.

(4)

(cid:20) Im(HTotal−i(ω))

(cid:21)

Re(HTotal−i(ω))

This phase, to ﬁrst order, manifests itself as a time delay
of the recorded signal. This eﬀect is particularly problematic
for the scanning mode of the SPIRE spectrometer, where
the delay induced by the electronic and thermal phase can
lead to errors in the interpolation of the detector signals (see
Section 3.2).

The phase per detector is characterized and used to de-
rive the time domain phase correction function (PCF) given
by:

−1(cid:104)

−iφTotal−i(ω)(cid:105)

PCFi(t) = FT

e

.

(5)

The measured detector timelines are corrected by con-

volution with the derived PCF

for the next step in the common spectrometer data process-
ing pipeline: the Spectrometer Mechanism timeline prod-
uct (SMECT) (Fig. 4b); the Nominal Housekeeping time-
line product (NHKT) (Fig. 4c); and the SPIRE Pointing
timeline product (SPP) (see Fig. 2).

A single building block of a SPIRE spectrometer ob-
servation in scanning mode consists of a series of scans of
the spectrometer mechanism (SMEC) while the instrument
is pointed at a given target. The sampling of the SPIRE
spectrometer detectors and the spectrometer mechanism is
not synchronized; the two subsystems are sampled at dif-
ferent rates and at diﬀerent times. In order to derive the
source spectrum from the measured data, the detector sig-
nal timeline must be linked with the position of the SMEC
to produce a signal as a function of OPD, or interferogram.
Additionally, the detector signal timelines are interpolated
onto timelines corresponding to equi-spaced OPD positions,
to exploit the Fast Fourier Transform (FFT) algorithm. The
SPIRE FTS was oversampled by a factor of 4 for SSW and
a factor of 6 for SLW (Naylor et al. 2004). Thus a third
order spline interpolation was shown to be equal to or supe-
rior to a non-uniform FFT and is used throughout (Naylor
et al. 2004). The mean value of the sky position for a de-
tector during a SMEC scan is assigned to that detector’s
interferogram.

The process by which interferograms are created in-
volves two steps that are described in the following sub-
sections. These steps are repeated for all spectrometer de-
tectors, for each scan of the observation building block. The
resulting data product is a Level-1 Spectrometer Detector
Interferogram (SDI) product that is made available to ob-
servers.

3.2.1 Interpolation of the SMEC timeline

This step converts the mechanism path diﬀerence (MPD)
in the spectrometer mechanism timeline from one that is
non-uniform in position to one that is uniform in position.

(i) Establish a common OPD position vector. This
step creates a common vector of OPD positions that will be
the basis of the interferograms for all of the spectrometer
detectors and for all of the scans in the building block. This
common position vector contains samples that are uniformly
spaced in terms of OPD position with one sample at the
position of ZPD.

The step size of the common OPD vector is chosen to
match the sampling rate of the spectrometer detector signal
samples. For an SDT sampling rate s [Hz] and a SMEC
scanning speed vSMEC [cm/s], the size of the step between
consecutive mechanism samples, ∆MPD [cm]; is given by

∆MPD = vSMEC/s.

(7)

V4−i(t) = V3−i(t) ⊗ PCFi(t).

(6)

This step is then converted such that it is in terms of OPD
by the following relation,

3.2 Interferogram Creation

The pipeline modules listed to this point describe the opera-
tions on the Level 0.5 timelines of the spectrometer detectors
(Fig. 4a). Three additional Level 0.5 timelines are required

∆OPD = FLOOR[4∆MPD]

(8)

where FLOOR[] denotes that the step size is rounded
down to the nearest integer in units of µm and the factor of
four is the nominal conversion between MPD and OPD for
a Mach-Zehnder FTS.

MNRAS 000, 1–14 (2016)

SPIRE Spectrometer Pipeline

7

(ii) Map the common OPD position vector to a
SMEC position vector for each spectrometer detec-
tor. For each spectrometer detector, this step maps the com-
mon OPD positions onto physical positions in units of me-
chanical path diﬀerence (MPD). This step involves: a scaling
factor, f , that takes into account the step size for a Mach-
Zehnder FTS; and a shifting factor, ZPD, which establishes
the position of zero optical path diﬀerence. The ﬁnal velocity
errors of the scaling factor f are <5 km/s with a spread of
<7km/s (Swinyard et al. (2010), and Hopwood et al. (2014)).
In order to take into account variations due to slight mis-
alignments of the interferometer components, each of these
quantities is unique to each spectrometer detector, i,

MPDi =

OPD

fi

+ ZPDi.

(9)

Figure 7. Spectrometer Detector Interferogram.

(iii) Parse the measured SMEC timeline into dis-
crete scans. The full SMEC timeline, z(tSMEC) is split into
a series of discrete timelines, zn(tSMEC). Each of the discrete
timelines, zn(tSMEC), represents one spectrometer scan. The
delineation of the SMEC timeline is accomplished by com-
paring consecutive SMEC position samples and ﬁnding those
samples where the motion of the SMEC mechanism changes
direction.

(iv) Interpolate the measured SMEC timelines
onto the mapped SMEC timelines. On a detector-by-
detector and scan-by-scan basis, the sample times when the
spectrometer mechanism reached the mapped SMEC po-
sitions are determined through cubic spline interpolation.
Since, for each detector, there is a 1:1 relationship between
the mapped SMEC positions and the regularly spaced OPD
positions, this step eﬀectively determines the times when the
SMEC reached the regularly spaced OPD positions for each
detector,

zn(tSMEC) → MPDn−i(tMPDi ).

(10)

3.2.2 Merge the spectrometer detector and the mapped

SMEC timelines

This step combines the signal samples from the timeline of
a given spectrometer detector, V5−i(ti), with the mapped
SMEC timelines.

(i) Interpolation of the spectrometer detector
timelines. The spectrometer detector signal samples are
mapped onto the times corresponding to the regular MPD
positions, tMPD−i, using cubic spline interpolation. Since
there is a 1:1 relationship between these time samples,
tMPD−i, and the regular MPD positions, MPDi, this in-
terpolation eﬀectively maps, for each detector, the signal
samples to the regularly spaced MPD positions. Moreover,
since there is a 1:1 relationship between the regular MPD
positions for each detector and the common OPD positions,
this step accomplishes the mapping of the signal samples for
each detector to the common OPD positions (x), resulting
in the desired equi-spaced OPD sampled interferogram (see
Fig. 7):

V4−i(ti) → V5−i(tMPDi ) → V5−i(tOPD) ≡ V5−i(x).

(11)

MNRAS 000, 1–14 (2016)

Figure 8. Interferogram modiﬁcation section of the SPIRE Spec-
trometer building block pipeline.

(ii) Assign a pointing value to the resultant inter-
ferogram. Upon creation of each interferogram, the point-
ing timeline for each detector i, Pi(t) is evaluated and its
time-averaged value is aﬃxed to each spectrometer detector
for each interferogram in the building block.

3.3 Interferogram Modiﬁcation

The pipeline modules described in this section perform
operations on the interferograms. Each of the processing
steps contained in this processing block accepts an SDI prod-
uct as input and deliver an SDI product as output (see
Fig. 8).

3.3.1 Baseline Correction

The radiant power incident on each SPIRE spectrometer
detector can be separated into two components: a compo-
nent that is constant as a function of OPD and a component
that is modulated as a function of OPD. As the ﬁrst base-
line term does not contain relevant spectral information, it
may be removed without aﬀecting the source spectrum. Fre-
quency components outside of the optical passband can also
be removed from the second term.

The baseline correction algorithm evaluates and re-
moves the oﬀset portion of the measured interferograms,
V5−i(x), on a detector-by-detector, and scan-by-scan, basis.
The baseline of each interferogram, VBaseline−i(x), is taken

8

T. Fulton et al.

as that portion of the interferogram whose Fourier compo-
nents correspond to frequencies lower than 119.92 GHz (4
cm−1). This boxcar ﬁlter cutoﬀ frequency was chosen be-
cause it provides robust estimates of the baseline without
introducing spectral artefacts

VBaseline−i(x) = FT

−1(cid:2)FT [V5−i(x)]ν=0

ν=119.92

(cid:3) .

3.3.3 Phase Correction

The presence of dispersive elements and the possibility
of the position of ZPD not being sampled can result in an in-
terferogram for which the signal samples are not symmetric
about ZPD. The resulting phase can be expressed as

(12)

φexp−i(ν) = φNonLin−i(ν) + φLin−i(ν) + φRandom−i(ν), (17)

where φNonLin−i(ν) is a non-linear phase that represents the
eﬀects of the dispersive elements, φLin−i(ν) is a linear phase
that results from not sampling the position of zero path dif-
ference and φRandom−i(ν) represents any phase due to noise.

The non-linear and linear phase terms are derived per
scan direction, on a detector-by-detector basis, from the
phases of all the low-resolution portions of the average in-
terferogram for the observation. The non-linear phase and
linear phase terms are removed from the measured interfer-
ograms in the spectral domain as follows:

Transform to the spectral domain. The Fourier
transform is applied to each measured interferogram,
V7−n−i(x), and also to the average
interferograms,
V7−n−i(x). In order to ensure that the spectral sampling in-
tervals of the transformed interferogram and the calibrated
phase are the same, zero-padding (see Section 3.4.1) is ap-
plied prior to transformation

V7−n−i(ν) = FT [V7−n−i(x)] V7−n−i(ν) = FT

V7−n−i(x)

.

(cid:104)

Derive the non-linear phase. The φNonLin−i(ν) term

is derived as

φNonLin−i(ν) = tan

−1

(cid:16)
(cid:16)

 Im

Re

V7−n−i(x)

V7−n−i(x)

(cid:17)
(cid:17)

 .

Correct the transformed interferogram. The spec-
trum of the measured interferogram is corrected by way of
multiplication with the negative of the non-linear phase,

V8−n−i(ν) = V7−n−i(ν) × e
.

−iφNonLin−i(ν).

(20)

(cid:17)

Derive the linear phase. The φLin−n−i(ν) term is
derived from a linear ﬁt of the remaining phase of each of
the corrected spectra:

(cid:105)

(18)

(19)

The baseline is subtracted from the input interferogram

to derive the corrected interferogram:

V6−i(x) = V5−i(x) − VBaseline−i(x).

(13)

3.3.2 Second level deglitching

The second-level deglitching step is responsible for iden-
tifying and correcting any glitches that are not corrected
by ﬁrst-level deglitching (Section 3.1.1). This step relies on
the principle that repeated FTS measurements of the same
astronomical source should not deviate from one another
beyond random noise. Glitches may then be identiﬁed for
each spectrometer detector as those that, for a given OPD
position, deviate by a given threshold from corresponding
samples, taken at the same OPD, from all other scans in
the same building block.

Based on a combination of pre-launch and performance
veriﬁcation phase data (Davis-Imhof et al. 2008), the most
eﬀective statistical metric found for identifying second-level
glitches is the windowed median absolute deviation (MAD)
algorithm. For a given detector, this algorithm ﬁrst com-
putes the standard deviation at each OPD position from
all of the measured interferograms. A given OPD position,
x, is then considered to contain a glitch if the standard
deviation2 within a window of neighboring samples, w, is
d × 1.4826 × MADw, where d is a pre-determined threshold
∂V6−i(xk) − MEDIANw (∂V6−i(xk)) >

d × 1.4826 × MADw (∂V6−i(xk)) ,

(14)

where

MADw (∂V6−i(xk)) = MAD

(cid:16)

∂V6−i(xk− w−1

2

), K, ∂V6−i(xk+ w−1

2

)

(15)

The samples that are identiﬁed as outliers are replaced.
Each outlier is replaced by the average of the other corre-
sponding samples at that position, as

Vj−7−i(xk) =

1

NScans − 1

NScans(cid:88)

n=1,n(cid:54)=j

Vn−6−i(xk).

(16)

φLin−n−i(ν) = φﬁt−n−i(ν) = ai + biν.

(21)

This deglitching method relies on a statistical analysis
of the measured interferograms and requires at least four
interferograms (two forward and two reverse spectrometer
scans) per building block. All observations conducted with
the SPIRE FTS meet this criterion.

Correct the transformed interferogram. The spec-
trum of the measured interferogram is further corrected by
way of multiplication with the negative of the linear phase:

V8−n−i(ν) = V7−n−i(ν) × e

−iφLin−i(ν).

(22)

2 For Gaussian-like distribution the standard deviation is
1.4826×MAD.

Apply the inverse transform to the corrected
spectrum. The inverse Fourier transform is applied to the

MNRAS 000, 1–14 (2016)

corrected spectrum, V8−n−i(ν), to create the corrected in-
terferogram, V8−n−i(x):

V8−n−i(x) = FT

−1 [V8−n−i(ν)] .

(23)

3.4 Spectrum Creation

At this point in the spectrometer pipeline, the inter-
ferograms have been subject to comprehensive corrections.
The Fourier transform is now applied to the interferograms
for each detector, Vn−m−i(x), in order to convert them into
spectra, Vn−m−i(ν). Further corrections are then applied in
the spectral domain.

3.4.1 Fourier Transform

The Fourier Transform module transforms the set of

corrected interferograms into a set of spectra.

Double-sided Transform. The

low-resolution
AOTs
(SPIRE Handbook 2016) produce double-sided
interferograms. In these cases, each interferogram in the
SDI is examined and the entire recorded interferogram is
used to compute the resultant spectrum:

V9−i(ν) = FT

V8−i(x)|L−L

=

V8−i(x)e

−i2πνxdx.

(24)

(cid:90) L

−L

The Discrete Fourier transform that is used to compute

the spectral components takes the form

V9−i(νk) =

V8−i(xn)e

−i 2πnk
N .

(25)

Single-sided Transform. The

high-resolution
AOT (SPIRE Handbook 2016) produces
single-sided
interferograms the samples of which are asymmetric with
respect to the position of ZPD. The spectra computed
from the high-resolution observations are derived from the
interferogram samples for which positions are greater than
or equal to the position of ZPD:

(cid:105)

(cid:105)

(cid:90) L

0

(cid:18) 2πnk

(cid:19)

N

N(cid:88)

n=0

(cid:104)

(cid:104)

N(cid:88)

n=0

SPIRE Spectrometer Pipeline

9

Figure 9. Initial spectrometer detector spectrum.

The spacing between independent spectral samples

(∆ν) is given by

νNyquist =

× 10

−7c.

1
2L

(29)

Interferogram Padding. The spacing between spec-
tral samples can be modiﬁed by padding the interferogram
with zeros, a process sometimes known as zero inﬁlling. This
procedure allows for an easier comparison of the spectra de-
rived from observations at diﬀerent spectral resolutions. In
this case, a zero-padded interferogram, V9−ZP−i(x), is given
by
V9−ZP−i(x) = V8−i(x)|L

0 , 0|L<x<LZP .

(30)

The corresponding spectral sampling interval is given

by

νZP =

1

2LZP

× 10

−7c,

(31)

and the resultant spectrum of the zero-padded interfer-

NZP(cid:88)

n=0

(cid:18) 2πnk

(cid:19)

NZP

V9−ZP−i(νk) =

V9−ZP−i(xn) cos

.

(32)

The SPIRE spectrometer AOTs (SPIRE Handbook
2016) provided two spectral resolution options. The lengths
to which the interferograms are padded and the resultant
spectral sampling intervals for each of the resolutions are
shown in Table 3.

3.5 Spectrum Modiﬁcation

The pipeline modules in this section describe how to
process the spectrometer detector spectra that were created
in the ”Fourier Transform” step (see Fig. 10 and Fig. 9). The
end result of these processing steps will be a Level-2 Spec-
trometer Detector Spectrum product that contains a single,
ﬂux-calibrated, average spectrum for each spectrometer de-
tector, Ii(ν).

V9−i(ν) = FT

V8−i(x)|L−L

=

V8−i(x) cos 2πνxdx. (26)

ogram is given by

The Discrete Fourier transform that is used to com-
pute the spectral components for single-sided interferograms
takes the following form:

V9−i(νk) =

V8−i(xn) cos

.

(27)

Frequency Grid. In the case of both the single-sided
and double-sided transforms the wavenumber grid onto
which the spectrum is registered is calculated from the inter-
ferogram sampling rate (∆OPD) and the maximum OPD,
L. The Nyquist frequency (νNyquist), is the highest frequency
that can be unambiguously be encoded in a discretely sam-
pled system and is given by

νNyquist =

1

2∆OP D

× 10

−7c.

MNRAS 000, 1–14 (2016)

(28)

10

T. Fulton et al.

Table 3. Spectral sampling intervals for two SPIRE spectral resolution observing options.

Spectral

Resolution

Sampling
Interval

Nyquist

Frequency

(OPD) [µm]

[GHz]

Padded

Scan Length
(OPD) [cm]

Spectral
Sampling

Interval [GHz]

Low
High

25
25

5995.85
5995.85

2.0
50.0

7.495
0.299

contribution due to the SPIRE instrument is character-
ized as the product of a blackbody function at the mean
recorded SCAL temperature for that scan, TSCAL, and the
Instrument Relative Spectral Response Function (RSRF),
RSRFInstrument(ν), for that detector:

VInstrument−n−i(ν) = B(TSCAL, ν)RSRFi−Instrument(ν),

(35)

V11−n−i(ν) = V10−−n−i(ν) − V10−Instrument−n−i(ν).

(36)

3.5.3 Extended Source Spectral Response Correction

The response of the SPIRE spectrometer detector sub-
system depends on the wavelength and on the spatial extent
of the source being studied. In other words, the response to
point-like astronomical sources diﬀers from that of extended
sources that ﬁll the detector’s ﬁeld of view, as conﬁrmed by
in-ﬂight observations. This module performs two functions
simultaneously: it removes from the measured spectrum of
each detector in the input SDS product the relative spectral
response function (RSRF) for that particular detector; and
it converts the spectral intensities from units of V GHz−1
to brightness quantities with units of W m−2 sr−1 Hz−1.
At this stage the extended source correction is applied. The
intensity is derived as

I12−i(ν) =

V11−i(ν)

RSRFi−Telescope(ν)

,

which can be expressed as

(37)

I12−i(ν) =

V11−Source−i(ν)

RSRFi−Telescope(ν)

+

V11−Telescope−i(ν)
RSRFi−Telescope(ν)

. (38)

The extended source RSRF correction and ﬂux conver-
sion curves, RSRFi−Telescope(ν), are derived from multiple
calibration observations of a dark sky region and a ther-
mal model of the emission expected from the primary and
secondary mirrors of the Herschel telescope (Fulton et al.
2014).

Figure 10. Spectral modiﬁcation section of the SPIRE Spec-
trometer building block pipeline.

3.5.1 Remove Out of Band Flux

This processing step removes, from each of the com-
puted spectra, components corresponding to out of band
frequencies. The lower and upper limits of the spectral pass-
bands (νmin and νmax) were determined from performance
veriﬁcation data for each detector and are provided by a
calibration product.
V10−n−i(ν) = V9−n−i(ν)|νmax−i
νmin−i

(33)

The equation for the total intensity of the radiation in-
cident upon the spectrometer detectors shows that, in addi-
tion to radiation from the astronomical source, the detectors
record a modulated signal from the Herschel Telescope, and
a modulated signal arising from the emission of spectrome-
ter instrument. The spectrum, V10−n−i(ν), for each detector
i and SMEC scan n, can be expressed as:

V10−n−i(ν) = V10−Source−n−i(ν) + V10−Telescope−n−i(ν)

+ V10−Instrument−n−i(ν).

(34)

3.5.4 Herschel Telescope Correction

3.5.2 Instrument Correction

This processing module removes the contribution from
the SPIRE instrument from each of the measured spec-
tra. For each SMEC scan of the building block n, the

This module applies a correction for the contribution to
the measured signal from the Herschel telescope itself. As a
reminder, the measured spectra at this point in the process-
ing pipeline I12−i(ν), for each detector i, may be expressed
as

I12−i(ν) = I12−Source−i(ν) + I12−Telescope−i(ν).

(39)

MNRAS 000, 1–14 (2016)

The method employed to correct for emission from the
Herschel telescope is to subtract from the measured spec-
trum for each detector, I12−i(ν), a model of the spectrum,
ITelescopeModel−i(ν), which is given by
ITelescopeModel−i(ν) = (1 − T el(ν)) T el(ν)ECorrB(TM1, ν)

+ T el(ν)B(TM2, ν).

(40)

where: TM1 and TM2 represent the mean of the mean
temperatures of the Herschel Telescope’s nine M1 and three
M2 thermometers over the course of the observation build-
ing block; B(T, ν) is the Planck function; T el(ν) refers to
the emissivity of the dusty Herschel Telescope mirrors M1
and M2 (Fischer et al. 2004); and ECorr is an operational-
day dependent correction factor to account for the changing
emissivity of the mirror M1 (Hopwood et al. 2014). The re-
sultant spectra are given by
I13−i(ν) = I12−i(ν) − I12−TelescopeModel−i(ν)
= I12−Source−i(ν) + I12−Telescope−i(ν)
− I12−TelescopeModel−i(ν)

(41)

3.5.5 Extended Source Calibration

I13−i(ν), as given in Eq. 41, does not include the far-
ﬁeld feedhorn eﬃciency correction ηﬀ . This correction is of
the order of 0.65-0.70 for SSW and from 0.45 to 0.75 for
SLW (Wu et al. 2013). Applying ηﬀ to I13−i(ν) gives the
correct extended source calibrated intensity:

I13−EXT−i(ν) = I13−i(ν)/ηﬀ .

(42)

Note that this correction was not applied before HIPE
version 14 of the pipeline. Consequently, prior to HIPE 14,
all the intensities, including those in spectral maps, are sig-
niﬁcantly underestimated by ηﬀ . Once the correction is ap-
plied, comparing synthetic photometry from I13−EXT−i(ν)
for fully extended and spatially ﬂat sources to the broad-
band intensities from SPIRE photometer extended source
calibrated maps, matches at a level of 3-5 % (for more de-
tails see Valtchanov et al. 2016). ηﬀ was measured in a lab
using a feedhorn and a laser, although only for SLW (Chat-
topadhaya et al. 2003). The uncertainty of the measurement
is 3% and considering the better behaved beam in SSW, we
conservatively assume the same uncertainty for the short-
wavelength array. Hence the overall extended calibration un-
certainty, including ∆ηﬀ , the telescope model uncertainty of
0.06% (see Swinyard et al. 2014), and the 1% statistical re-
peatability, is < 4% for fully extended sources.

4 LEVEL-2 SPECTRAL PRODUCTS

The ﬁnal phase of the SPIRE spectrometer pipelines
involves operations that modify the SDS products produced
by the building block pipeline to create a set of Level-2 spec-
tral products. The format and the contents of the Level-2
portion of the observation context depend on the observa-
tion:

MNRAS 000, 1–14 (2016)

SPIRE Spectrometer Pipeline

11

(a)

(b)

Figure 11. Level 2 Spectra. a) Extended-source Calibrated, b)
Point-source Calibrated

(i) Single Pointing Sparse Sampling Observations.
The Level-2 context contains both extended source cali-
brated and point source calibrated spectra. The point source
calibrated spectra contain only the unvignetted detectors.

(ii) Mapping Observations. The Level-2 context con-
tains both Spectrum2d products and hyper-spectral cubes.
In both cases, the extended source calibration is applied to
the individual spectra.

4.1 Single Pointing Sparse Sampling Observations

4.1.1 Point Source Spectral Response Correction and Flux

Conversion

In this step, a separate correction for point source obser-
vations is applied, as the correction applied in Section 3.5.3
is appropriate only for extended sources. In eﬀect, this step
applies the inverse of the extended source RSRF and then
divides the input spectra by a frequency-dependent RSRF
applicable to point-like astronomical sources:

I14−i(ν) = I13−i(ν)×RSRFT elescope−i(ν)× fP oint−i(ν)

.

RSRFP oint−i(ν)
(43)

The conversion curves, fP oint−i(ν)/RSRFP oint−i(ν), are de-
rived from the results of an observation of Uranus and a
model of its brightness (ESA-4 models, Orton et al. 2014).

12

T. Fulton et al.

4.1.2 Low Resolution Correction

4.1.5 Spectral Averaging

Observations made in low resolution mode require an
additional empirical correction to account for diﬀerences
with the high resolution mode, on which all other calibra-
tion steps in the pipeline are based (Swinyard et al. 2014).
The low resolution correction consists of applying a detector-
dependent empirically derived (Marchili et al. 2016) calibra-
tion curve to minimize the frequency-dependent artefacts in
low resolution spectra . This correction applies only to point
source calibrated data and only for the detectors in the SLW
band.

4.1.3 Apodization

The natural instrument line shape (ILS) for a Fourier
Transform spectrometer is a cardinal sine, or sinc function.
If the source signal contains features at or near the resolu-
tion of the spectrometer, the ILS can introduce secondary
maxima in the spectra. The apodization functions available
within this module may be used to reduce these secondary
maxima at the cost of degrading the spectral resolution.
While the default apodization function chosen for the stan-
dard processing pipeline is the Hanning (Blackman & Tukey
1959) function, a number of apodizing functions that allow
for an optimal trade-oﬀ between reduction in the secondary
maxima and reduced resolution (Naylor & Tahic 2007) are
available for use in interactive processing. Apodization is
performed on a detector-by-detector and on a scan-by-scan
basis by convolution of the input spectra, In−14−i(ν), with
the Fourier transform of a tapering or apodizing function:
I14−A−i(ν) = I14−A−i(ν) ⊗ FT [Hanning(x)] .

(44)

(cid:80)NScans

n=1

This module computes, on a frequency-by-frequency
(νk) basis for each spectrometer detector, i, the weighted
average of the spectral intensities across all scans, n

I15−i(ν) =

wn(νk)In−14−i(νk)
wn(νk)

.

(47)

The weighting factors, wn(νk),

in this equation are
taken as the number of scans used to compute each ele-
ment In−12−i(νk) and are normally set to 1. In addition,
this module computes, on a frequency-by-frequency basis
for each spectrometer detector, the uncertainty in the spec-
tral average. The uncertainty is calculated as the weighted
standard error of the mean of the spectral components as

(cid:16)(cid:80)NScans

n=1

1

wn(νk)

(cid:104)

(cid:17) − 1

a − I14−i−n(νk)

2

+ b

(cid:105)

,

∂I15−i(ν) =

(cid:118)(cid:117)(cid:117)(cid:116)
(cid:80)NScans
(cid:80)NScans

where

n=1

n=1

a =

b =

(cid:80)NScans

wn(νk)I 2

14−i−n(νk)

n=1
∂I 2

14−i−n(νk)wn(νk)(wn(νk) − 1)

wn(νk)

(cid:80)NScans

n=1

wn(νk)

(48)

(49)

.

(50)

When the weighting factors are equal to 1, equations 47
and 48 reduce to the unweighted mean and standard error
on the mean (standard deviation divided by root N ).

The sky position for spectrum in the output product is
computed as the average of the right ascension and declina-
tion of each spectrum for the given detector.

The results of this processing step are two Level-2 SDS
products (see Fig. 10) that are available to observers – the
standard product where no apodization has been applied
and one where the default apodization function has been
applied.

4.2 Mapping Observations

4.2.1 Spatial Regridding

4.1.4 Radial Velocity Correction

This step uses the radial velocity of the Herschel tele-
scope to correct the frequency axis to the kinematical Local
Standard of Rest (LSR). This is accomplished in two steps

(i) Compute the LSR frequencies. This step uses the
Herschel satellite velocity, accurate to 1.2 cm/s for the de-
termined velocity and to 3.6 cm/s for the predicted veloc-
ity (Herschel Flight Control Team 2014), to compute a set
of LSR frequencies for each spectrum:
ν14−n−i−LSR = ν14−n−i/(1 − vHerschel/c).

(45)

The SPIRE FTS detector arrays are arranged in a hexago-
nal, close packed, conﬁguration, as shown in Fig. 1. Observa-
tions made with sparse sampling are treated by the pipeline
as individual spectra. However, intermediate and fully sam-
pled observations, and observations made in raster mode, are
treated as maps and in the ﬁnal step they are projected onto
a rectangular sky grid to produce a hyper-spectral cube.

The ﬁrst step in creating a regularly gridded hyper-
spectral cube is to collect the individual spectra from each
detector, jiggle position and raster point into a single list.
The format of this product is a 2-dimensional list of spec-
tra, with additional columns containing the sky position,
and other relevant information such as detector name and
spectral resolution achieved.

(ii) Interpolate the spectral ﬂux onto the original
frequency grid. This step ensures that the specta are al-
ways sampled on to the same frequency grid, allowing easier
observation-to observation comparison:
I14−n−i(ν14−n−i−LSR) → I14−n−i−LSR(ν14−n−i) ≡ I14−n−i(ν14−n−i).

The second step is to deﬁne the coordinate system for
the regularly sampled spectral cube such that it covers all
of the observed sky positions. The coordinate system is
speciﬁed using the FITS World Coordinate System (WCS;
Greisen & Calabretta 2002) with the frequency grid speciﬁed
as a third axis (Greisen et al. 2006). A tangential projection
is used with equatorial right ascension and declination refer-
enced to the J2000 equinox (see Calabretta & Greisen 2002).

(46)

MNRAS 000, 1–14 (2016)

SPIRE Spectrometer Pipeline

13

(a)

(b)

Figure 12. Level 2 Spectral Cubes. a) SLW cube, b) SSW cube

The regularly spaced frequency axis has already been refer-
enced to the LSRk frame by the radial velocity correction
task (Sect. 4.1.4).

The WCS reference coordinates are set to the average
RA/Dec by summing the vectors of the sky position of each
spectrum. The size of the spatial grid is then determined to
be the minimum necessary to encompass all of the observed
points using the pixel sizes given in Table 2. The reference
coordinates always correspond to the centre of a pixel.

4.2.2 Hyper-spectral cubes

The ﬁnal step in producing the hyper-spectral cubes, is to
project the 2D list of spectra into the target spatial grid. The
Standard Product Generation for mapping observations pro-
vides two sets of spectral cube products in the Level-2 Con-
text. One set is produced using the na¨ıve projection method
(the same algorithm used to map SPIRE photometer obser-
vations, Bendo et al. 2013) and the other with a convolution
projection, which takes into account the FTS beam varia-
tion with frequency, assuming a Gaussian beam. For each
set there are separate cubes for the SLW and SSW Spec-
trometer detector arrays (see Fig. 12), and for each cube
there is a second version for which the standard apodization
function has been applied.

The na¨ıve projection algorithm computes the bright-
ness and uncertainty in a given map pixel as the mean and
standard error of the mean of all spectral samples within
that pixel, respectively. The spectra are averaged with the
same spectral averaging described by equations 47 and 48.
The map pixel value is set to nan (Not A Number) if no
spectra were observed within that pixel. The na¨ıve projec-
tion task iterates through all spectral bins and applies the
mapping algorithm for each slice independently, using the
same WCS for each. A coverage map is also computed by
the task, giving the number of samples used to compute the
ﬂux and uncertainty values.

Because of the two dead bolometers in the ﬁrst and
second ring of SSW (SPIRE Handbook 2016), the coverage
for spectral maps produced with the na¨ıve projection may
have empty pixels close to the map centre (for example, see
the SSW cube in Fig. 12). There are no such empty pixels for
the convolution gridded cubes, as each pixel is the weighted
sum of all spectra being projected, as shown in Fig. 13. The
convolution method computes a weighted error map and a
coverage map of the weighted contribution for all spectra.

MNRAS 000, 1–14 (2016)

Figure 13. The spectral cube slice for IRAS 16293 (ObsID:
1342204898) at 1244 GHz (SSW array). The blue circles of
9.5(cid:48)(cid:48)radius are the SSW detectors positions at one of the 16 jiggle
positions (full spatial resolution mode). The sky position of each
individual spectrum (red crosses) are also shown: these individual
spectra are binned on a sky grid to produce the cube using the
convolution or na¨ıve projection method.

5 SUMMARY

We have presented an overview of the data processing
pipeline for the SPIRE Imaging Fourier transform spectrom-
eter on the Herschel Space Observatory. The data process-
ing modules that are used and the manner by which they
are combined within the pipeline have been described. The
Level-0.5 and Level-1 building block data products as well
as the Level-2 spectral products for the SPIRE astronomical
observation templates have been presented.

ACKNOWLEDGMENTS

SPIRE has been developed by a consortium of institutes
led by Cardiﬀ University (UK) and including Univ. Leth-
bridge (Canada); NAOC (China); CEA, LAM (France);
IFSI, Univ. Padua (Italy); IAC (Spain); Stockholm Observa-
tory (Sweden); Imperial College London, RAL, UCL-MSSL,
UKATC, Univ. Sussex (UK); and Caltech, JPL, NHSC,
Univ. Colorado (USA). This development has been sup-
ported by national funding agencies: CSA (Canada); NAOC
(China); CEA, CNES, CNRS (France); ASI (Italy); MCINN
(Spain); SNSB (Sweden); STFC (UK); and NASA (USA).
The authors wish to acknowledge Andres Rebolledo, Peter
Kennedy, Zhaohan Weng, Yan He, Karim Ali, Yu Wai Wong,
Alim Harji, Yufei Ren, David Sharpe, and Jeremy Zaretski
for their contributions to the development of the SPIRE
spectrometer data processing modules. The authors would
also like to thank Christophe Ordenovic and Dominique Be-
nielli for their contributions to the ﬁrst level deglitching
and Telescope/SCAL corrections. The authors thank Locke
Spencer and Gibion Makiwa for their contributions to the
development of the data processing pipeline. The funding
for the Canadian contribution to SPIRE was provided by
the Canadian Space Agency and NSERC.

14

T. Fulton et al.

REFERENCES

Ade, P., Hamilton, P., & Naylor, D. 1999, in Fourier Transform
Spectroscopy: New Methods and Applications, Optical Soci-
ety of America, FWE3

Bendo, G. J., Griﬃn, M. J., Bock, J. J., et al. 2013, MNRAS,

433, 3062

Blackman, R. B., & Tukey, J. W. 1959, New York: Dover, 95-100
Calabretta, M. R., & Greisen, E. W. 2002, A&A, 395, 1077
Cara, C. 2005, SPIRE-SAP-PRJ-001243, Technical Report
Chattopadhaya, G., Glenn, J., Bock, J., et al, 2003, IEEE. Trans.

Microwave Theory and Techniques, 51, 2139

Davis-Imhof, P., et al. 2008, SPIRE-BSS-DOC-003195, Technical

Report

Dohlen, K., Origne, A., Pouliquen, D., & Swinyard, B. M. 2000, in
Society of Photo-Optical Instrumentation Engineers (SPIE)
Conference Series, Vol. 4013, Society of Photo-Optical In-
strumentation Engineers (SPIE) Conference Series, ed. J. B.
Breckinridge & P. Jakobsen, 119–128
Dowell, D.et al., 2010, Proc. SPIE, 7731
Fischer, J., Klaassen, T., Hovenier, N., et al. 2004, Appl. Opt.,

43, 3765

Fulton, T. R., Hopwood, R., Baluteau, J. P., et al. 2014, Experi-

mental Astronomy, 37, 381

Greisen, E. W., & Calabretta, M. R. 2002, A&A, 395, 1061
Greisen, E. W., Calabretta, M. R., Valdes, F. G., & Allen, S. L.

2006, A&A, 446, 747

Griﬃn, M. J., Abergel, A., Abreu, A., et al. 2010, A&A, 518, L3
Griﬃn, M. J., Orton, G. S. 1993, Icarus, 105, 537
Herschel Flight Control Team Report 2014, PT-HMOC-OPS-RP-

7600-OPS-OAH, Technical Note

Hopwood, R., Fulton, T., Polehampton, E. T., et al. 2014, Exper-

imental Astronomy, 37, 195

LeLeu, G., M´ealier, A.-L., Benielli, D., et al. 2012, Astronomical

Data Analysis Software and Systems XXI, 461, 749

Lu, N., Polehampton, E. T., Swinyard, B. M., et al. 2014, Ex-

perimental Astronomy, 37, 239

Mallat, S. & Hwang, W. L., 1992, IEEE Transaction on Informa-

tion Theory, 38, 617

Marchili, N., et al. 2016, MNRAS, (in preparation)
Mather, J. C. 1982, Applied Optics, 21, 1125
Nguyen, H. T., Bock, J. J., Ringold, P., et al. 2004, in Society
of Photo-Optical Instrumentation Engineers (SPIE) Confer-
ence Series, Vol. 5498, Society of Photo-Optical Instrumen-
tation Engineers (SPIE) Conference Series, ed. C. M. Brad-
ford, P. A. R. Ade, J. E. Aguirre, J. J. Bock, M. Dragovan,
L. Duband, L. Earle, J. Glenn, H. Matsuhara, B. J. Naylor,
H. T. Nguyen, M. Yun, & J. Zmuidzinas, 196–207

Naylor, D. A., Schultz, A. A., Clark, T. A. 1988, Appl. Opt., 27,

2603-2607

Naylor, D. A., Fulton, T., Davis, P., Chapman, I., Gom, B.,
Spencer, L., Lindner, J., Nelson-Fitzpatrick, N., Tahic, M.,
David, G. 2004, Proc. SPIE, 5546

Naylor, D. A.& Tahic, M. K. 2014, J. Opt. Soc. Am., 24, 3644-

3648

Ord´enovic, C., Surace, C., Torr´esani, B., & Ll´ebaria, A. 2008,

Statistical Methodology, 5, 373

Orton, G. S., Fletcher, L. N., Moses, J. I., et al. 2014, Icarus, 243,

494

Ott, S. 2010, Astronomical Data Analysis Software and Systems

XIX, 434, 139

Pilbratt, G. L., Riedinger, J. R., Passvogel, T., et al. 2010, A&A,

518, L1

Polehampton, E., et al. 2011, SPIRE-RAL-NOT-003270, Techni-

cal Note

Struzik, Z. R., in Fractals: Theory and Applications in Engi-
neering, Dekking, M., L´evy-V´ehek, J., Lutton, E., Tricot, C.
(Eds.), Springer, 1999, p93

Sudiwala, R. V., Griﬃn, M. J., & Woodcraft, A. L. 2002, Int. J.

Infrared. Mm. Waves, 23, 575

Swinyard, B. M., Ade, P., Baluteau, J.-P., et al. 2010, A&A, 518,

L4

Swinyard, B. M., Polehampton, E. T., Hopwood, R., et al. 2014,

MNRAS, 440, 3658

Valtchanov, I., et al. 2016, MNRAS, (in preparation)
Wu, R., Polehampton, E., Etxaluze, M., et al., 2013, A&A, 556,

116

SPIRE Handbook, 2016, HERSCHEL-HSC-DOC-0798 accessed

from http://herschel.esac.esa.int/Documentation.shtml

This paper has been typeset from a TEX/LATEX ﬁle prepared by
the author.

MNRAS 000, 1–14 (2016)

