6
1
0
2

 
r
a

M
 
7
1

 
 
]

.

A
N
h
t
a
m

[
 
 

1
v
9
7
5
5
0

.

3
0
6
1
:
v
i
X
r
a

CONVERGENCE OF A NEWTON ALGORITHM FOR

SEMI-DISCRETE OPTIMAL TRANSPORT

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

Abstract. Many problems in geometric optics or convex geometry can
be recast as optimal transport problems and a popular way to solve these
problems numerically is to assume that the source probability measure is
absolutely continuous while the target measure is ﬁnitely supported. We
introduce a damped Newton’s algorithm for this type of problems, which
is experimentally eﬃcient, and we establish its global linear convergence
for cost functions satisfying an assumption that appears in the regularity
theory for optimal transport.

Contents

Introduction

1.
2. Kantorovich’s functional
3. Local regularity in a c-exponential chart
4. C2,α regularity of Kantorovich’s functional
5. Strong concavity of Kantorovich’s functional
6. Convergence of the damped Newton algorithm
Appendix A. A weighted Poincar´e-Wirtinger inequality
Appendix B. Measure of singular points on convex sets
Appendix C. Alternate proof of upper transversality
References

1
8
10
18
27
32
34
37
39
41

1. Introduction

Many problems in geometric optics or convex geometry can be recast as
optimal transport problems: this includes the far-ﬁeld reﬂector problem,
Alexandrov’s curvature prescription problem, etc. A popular way to solve
these problems numerically is to assume that the source probability measure
is absolutely continuous while the target measure is ﬁnitely supported. We
refer to this setting as semi-discrete optimal transport. Among the several
algorithms proposed to solve semi-discrete optimal transport problems, one
currently needs to choose between algorithms that are slow but come with
a convergence speed analysis [25, 6, 17] or algorithms that are much faster
in practice but which come with no convergence guarantees [3, 23, 8, 18, 7].
Algorithms of the ﬁrst kind rely on coordinate-wise increments and the
number of iterations required to reach the solution up to an error of ε
is of order N 3/ε, where N is the number of Dirac masses in the target
measure. On the other hand, algorithms of the second kind typically rely
on the formulation of the semi-discrete optimal transport problem as an

1

2

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

unconstrained convex optimization problem which is solved using a Newton
or quasi-Newton method.

The purpose of this article is to bridge this gap between theory and practice
by introducing a damped Newton’s algorithm which is experimentally eﬃcient
and by proving the global convergence of this algorithm with optimal rates.
The main assumptions is that the cost function satisﬁes a condition that
appears in the regularity theory for optimal transport (the Ma-Trudinger-
Wang condition) and that the support of the source density is connected in a
quantitative way (it must satisfy a weighted Poincar´e-Wirtinger inequality).
In §1.7, we compare this algorithm and the convergence theorem to previous
computational approaches to optimal transport.

1.1. Semi-discrete optimal transport. The source space is an open do-
main Ω of a d-dimensional Riemannian manifold, which we endow with the
measure Hd
g induced by the Riemannian metric g on the manifold. The
target space is an (abstract) ﬁnite set Y . We are given a cost function c on
the product space Ω × Y , or equivalently a collection (cy)y∈Y of functions on
Ω. We assume that the functions (cy) are of class C1,1 on Ω:

∀y ∈ Y, cy ∈ C1,1(Ω).

(Reg)

(cid:27)

(cid:26)(cid:90)

ﬁnitely supported measure T#ρ =(cid:80)

We consider a compact subset X of Ω and ρ a probability density on X,
i.e. such that ρdHd is a probability measure. By an abuse of notation, we
will often conﬂate the density ρ with the measure ρdHd itself. Note that
the support of ρ is contained in X, but we do not assume that it is actually
equal to X. The push-forward of ρ by a measurable map T : X → Y is the
y∈Y ρ(T −1(y))δy. The map T is called a
transport map between ρ and a probability measure µ on Y if T#ρ = µ. The
semi-discrete optimal transport problem consists in minimizing the transport
cost over all transport maps between ρ and µ, that is

min

X

c(x, T (x))ρ(x)dHd

g(x) | T : X → Y s.t. T#ρ = µ

.

(M)

This problem is an instance of Monge’s optimal transport problem, where
the target measure is ﬁnitely supported. Kantorovich proposed a relaxed
version of the problem (M) as an inﬁnite dimensional linear programming
problem over the space of probability measures with marginals ρ and µ.

1.2. Laguerre tessellation and economic interpretation. In the semi-
discrete setting, the dual of Kantorovich’s relaxation can be conveniently
phrased using the notion of Laguerre tessellation. We start with an economic
metaphor. Assume that the probability density ρ describes the population
distribution over a large city X, and that the ﬁnite set Y describes the
location of bakeries in the city. Customers leaving at a location x in X try to
minimize the walking cost c(x, y), resulting in a decomposition of the space
called a Voronoi tessellation. The number of customers received by a bakery
is equal to the integral of ρ over its Voronoi cell,

Vory := {x ∈ Ω | ∀z ∈ Y, c(x, y) (cid:54) c(x, z)}.

If the price of bread is given by a function ψ : Y → R, customers leaving

at location x in X make a compromise between walking cost and price by

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

3

Figure 1. (Left) The domain X (with boundary in blue)
is endowed with a probability density pictured in grayscale
representing the density of population in a city. The set Y (in

red) represents the location of bakeries. Here, X, Y ⊆ R2 and
c(x, y) = |x − y|2 (Middle) The Voronoi tessellation induced
by the bakeries (Right) The Laguerre tessellation: the price
of bread the bakery near the center of X is higher than at
the other bakeries, eﬀectively shrinking its Laguerre cell.

minimizing the sum c(x, y) + ψ(y). This leads to the notion of Laguerre
tessellation, whose cells are given by

Lagy(ψ) := {x ∈ Ω | ∀z ∈ Y, c(x, y) + ψ(y) (cid:54) c(x, z) + ψ(z)}.

(1.1)
When the sets X and Y are contained in Rd and the cost is the squared
Euclidean distance, the computation of the Laguerre tessellation is a classical
problem of computational geometry, for which there exists very eﬃcient
software. The shape of the Voronoi and Laguerre tessellations is depicted in
Figure 1.

We want the Laguerre cells to form a partition of Ω up to a negligible set.
By the implicit function theorem, this will be the case if the following twist
condition holds,

∀x ∈ X, y ∈ Y (cid:55)→ Dcy(x) ∈ T

∗
x Ω is injective,

(Twist)

where D is the diﬀerential of the function cy. The twist condition implies
that for any prices ψ on Y , the transport map induced by the Laguerre
tessellation

Tψ(x) := arg min
y∈Y

(c(x, y) + ψ(y)),

(1.2)

is uniquely deﬁned almost everywhere. It is easy to see (see Proposition 2.2),
that Tψ is an optimal transport map between ρ and the pushforward measure

Tψ#ρ =(cid:80)

y∈Y ρ(Lagy(ψ))δy.

1.3. Kantorovich’s functional. Conversely, Theorem 1.1 below ensures
that any semi-discrete optimal transport problem admits such a solution. In
other words, for any probability density ρ on X and any probability measures
µ on Y there exists a function (price) ψ on Y such that Tψ#ρ = ν. The
proof of this theorem is an easy generalization of the proof given in [3] for
the quadratic cost, but it is nonetheless included in Section 2 for the sake of
completeness.

Here and after, we denote (1y)y∈Y the canonical basis of RY , and (cid:107)·(cid:107)
the Euclidean norm induced by this basis, while (cid:107)·(cid:107)g will denote the norm
induced by the Riemannian metric g on either TxΩ or T ∗
x Ω (which will

YX4

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

be clear from context). We will, slightly abusively, consider the space of

probability measures P(Y ) as a subset of RY .
density on Ω and ν =(cid:80)
Theorem 1.1. Assume (Reg) and (Twist), let ρ be a bounded probability

y∈Y νyδy in P(Y ). Then, the functional Φ

(cid:88)

y∈Y

ψ(y)νy

(cid:88)

y∈Y

ψ(y)νy

(1.3)

(cid:90)
(cid:88)

X

(min
y∈Y

(cid:90)

Φ(ψ) :=

c(x, y) + ψ(y))ρ(x)dHd

g(x) −

=

y∈Y

Lagy(ψ)

(c(x, y) + ψ(y))ρ(x)dHd

g(x) −

is concave, C1-smooth, and its gradient is

(cid:88)

y∈Y

∇Φ(ψ) =

(ρ(Lagy(ψ))) − νy)1y.

(1.4)

Corollary 1.2. The following statements are equivalent:

(i) ψ : Y → R is a global maximizer of Φ ;

(ii) Tψ is an optimal transport map between ρ and ν ;
(iii) Tψ#ρ = ν, or equivalently,

∀y ∈ Y, ρ(Lagψ

Y (y)) = νy

(MA)

We call Kantorovich’s functional the function Φ introduced in (1.3). Note
that both this functional and its gradient are invariant by addition of a
constant. The non-linear equation (MA) can be considered as a discrete
version of the generalized Monge-Amp`ere equation that characterizes the
solutions to optimal transport problems (see for instance Chapter 12 in [29]).

1.4. Damped Newton algorithm. We consider a simple damped Newton’s
algorithm to solve semi-discrete optimal transport problem. This algorithm
is very close to the one used in [24] and has been suggested to us by Mirebeau.
To phrase this algorithm in a more general way, we introduce a notation for

the measure of Laguerre cells: for ψ ∈ RY we set

G(ψ) :=

Gy(ψ)1y where Gy(ψ) = ρ(Lagy(ψ)),

(1.5)

(cid:88)

y∈Y

so that ∇Φ(ψ) = G(ψ) − µ. In the algorithm (Algorithm 1), we denote by
A+ the pseudo-inverse of the matrix A.
The goal of this article is to prove the global convergence of this damped
Newton algorithm and to establish estimates on the speed of convergence.
As shown in Proposition 6.1, the convergence of Algorithm 1 depends on the
regularity and strong monotonicity of the map G = ∇Φ. As we will see, the
regularity of G will depend mostly on the geometry of the cost function and
the regularity of the density. On the other hand, the strong monotonicity of
G will require a strong connectedness assumption on the support of ρ, in the
form of a weighted Poincar´e-Wirtinger inequality. Before stating our main
theorem we give some indication about these intermediate regularity and
monotonicity results and their assumptions.

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

5

Input: A tolerance η > 0 and an initial ψ0 ∈ RY such that

(cid:21)

(cid:20)
min
y∈Y
While: (cid:107)Gy(ψk) − µy(cid:107) (cid:62) η

ε0 :=

min

1
2

Gy(ψ0), min
y∈Y

µy

> 0.

(1.6)

Step 1: Compute dk = −DG(ψk)+(G(ψk) − µ)
Step 2: Determine the minimum (cid:96) ∈ N such that
k := ψk + 2−(cid:96)dk satisﬁes
ψ(cid:96)

 min
(cid:13)(cid:13)(cid:13)G(ψ(cid:96)

y∈Y

Gy(ψ(cid:96)

k)) (cid:62) ε0

(cid:13)(cid:13)(cid:13) (cid:54) (1 − 2

−((cid:96)+1))(cid:107)G(ψk) − µ(cid:107)
Step 3: Set ψk+1 = ψk + 2−(cid:96)dk and k ← k + 1.

Algorithm 1: Simple damped Newton’s algorithm

k) − µ

1.5. Regularity of Kantorovich’s functional and MTW condition.
In order to establish the convergence of a damped Newton algorithm for
(MA), we need to study the C2,α regularity of Kantorovich’s functional Φ.
However, while C1 regularity of Φ follows rather easily from the (Twist)
hypothesis (or even from weaker hypothesis, see Theorem 2.1), higher order
regularity seems to depend on the geometry of the cost function in a more
subtle manner. We found that a suﬃcient condition for the regularity of Φ is
the Ma-Trudinger-Wang condition [22], which appeared naturally in the study
of the regularity of optimal transport maps. We use a suitable discretization
of Loeper’s geometric reformulation of the Ma-Trundinger-Wang condition
[19].

Deﬁnition 1.1 (Loeper’s condition). The cost c satisﬁes Loeper’s condition

if for every y in Y there exists a convex open subset Ωy of Rd and a C1,1
diﬀeomorphism expc

y : Ωy → Ω such that the functions
p ∈ Ωy (cid:55)→ c(expc
y p, z)

y p, y) − c(expc

(QC)

are quasi-convex for all z in Y . The map expc
with respect to y, and the domain Ωy is an exponential chart.

y is called the c-exponential

Deﬁnition 1.2 (c-Convexity). Assuming Loeper’s condition, a subset X of
y)−1(X) is convex.
Ω is c-convex if for every y in Y , the inverse image (expc
Note that by assumption, the domain Ω itself is c-convex. The connection
between this discrete version of Loeper’s condition and the conditions used
in the regularity theory for optimal transport is detailed in Remark 1.1. The
(QC) condition implies the convexity of Laguerre cells in the exponential
charts, which plays a crucial role in the regularity of Kantorovich’s functional.

Theorem 1.3. Assume (Reg), (Twist), and (QC). Let X be a compact,
c-convex subset of Ω and let ρ in P ac(X) ∩ Cα(X) for α in (0, 1]. Then,
Kantorovich’s functional is of class C2,α

loc on the set

K+ := {ψ : Y → R | ∀y ∈ Y, ρ(Lagy(ψ)) > 0},

(1.7)

6

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

and its Hessian is given by

(z (cid:54)= y)

(ψ) =

Lagy(ψ)∩Lagz(ψ)

∂2Φ

∂1y∂1z
∂2Φ
∂12
y

(ψ) = −

z∈Y \{y}

∂2Φ

∂1y∂1z

.

(cid:90)
(cid:88)

ρ(x)

(cid:107)Dcy(x) − Dcz(x)(cid:107)g

dHd−1

g

(x),

(1.8)

The proof of this theorem and a more precise statement are given in
Section 4 (Theorem 4.1), showing that the C2,α estimate can be made
uniform when the mass of the Laguerre cells is bounded from below by a
positive constant.
Remark 1.1. We remark that under certain assumptions on the cost c, our
(QC) condition is implied by classical conditions introduced in a smooth
setting by X.-N. Ma, N. Trudinger, and X.-J. Wang [22], which include the
well known (MTW) or (A3) condition. See Remark 4.3 for more speciﬁcs.

There are a wide variety of known examples satisfying these conditions.

Aside from the canonical example of the inner product on Rn×Rn, and other
costs on Euclidean spaces mentioned in [22, 28], there are the nonﬂat examples
of Riemannian distance squared and − log (cid:107)x − y(cid:107)Rn+1 on (a subset of)
Sn×Sn (see [20]). The last cost is associated to the far-ﬁeld reﬂector antenna
problem. We refer the reader to [15, p. 1331] for a (more) comprehensive list
of such costs.
1.6. Strong concavity of Kantorovich’s functional. As noted earlier,
Kantorovich’s functional Φ cannot be strictly concave, since it is invariant
under addition of a constant. This implies that the Hessian D2Φ has a zero
eigenvalue corresponding to the constants. A more serious obstruction to the
strict concavity of Φ at a point ψ arises when the discrete graph induced by
the Hessian (where two points are connected iﬀ ∂2Φ/∂1y∂1z(ψ) (cid:54)= 0) is not
connected. This can happen either because one of the Laguerre cells is empty
(hence not connected to any neighbor) or if the support of the probability
density ρ is itself disconnected. In order to avoid the latter phenomena, we
will require that (X, ρ) satisﬁes a weighted L1 Poincar´e-Wirtinger inequality.
Deﬁnition 1.3 (weighted Poincar´e-Wirtinger). A continuous probability
density ρ on a compact set X ⊆ Ω satisﬁes a weighted Poincar´e-Wirtinger
inequality with constant Cpw > 0 if for every C1 function f on X,

where (cid:107)h(cid:107)L1(ρ) :=(cid:82)

(cid:107)f − Eρ(f )(cid:107)L1(ρ)
X |h(x)|ρ(x)dHd

g(x) and Eρ(f ) :=(cid:82)
(cid:54) Cpw (cid:107)∇f(cid:107)L1(ρ) ,
(cid:80)

We denote EY the orthogonal complement (in RY ) of the space of constant
functions on Y , that is EY := {ψ ∈ RY |
y ψ(y) = 0}. As before, K+ is the
set of functions ψ whose Laguerre cells all have positive mass.
Theorem 1.4. Assume (Reg), (Twist), (QC). Let X be a compact, c-convex
subset of Ω, and ρ be a continuous probability density on X satisfying (PW).
Then, Kantorovich’s functional Φ is strictly concave on EY ∩ K+.

As before, a more quantitative statement is proven in Section 5 (Theo-
rem 5.1), establishing strong concavity of Φ assuming that the mass of the
Laguerre cells is bounded from below by a positive constant.

(PW)

X f (x)ρ(x)dHd

g(x).

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

7

1.7. Convergence result. Putting Proposition 6.1, Theorem 1.3 and Theo-
rem 1.4 together, we can prove the global convergence of the damped Newton
algorithm for semi-discrete optimal transport (Algorithm 1) together with
optimal convergence rates.

Theorem 1.5. Assume (Reg), (Twist) and (QC) and also that

(i) The support of the probability density ρ is included in a compact,

c-convex subset of X of Ω, and ρ ∈ Cα(X).

(ii) ρ has positive Poincar´e-Wirtinger (PW) constant.

Then the damped Newton algorithm for semi-discrete optimal transport (Al-
gorithm 1) converges globally with linear rate and locally with rate 1 + α.

Comparison to previous work. There exist a few other numerical methods
relying on Newton’s algorithm for the resolution of the standard Monge-
Amp`ere equation or for the quadratic optimal transport problem. Here, we
highlight some of the diﬀerences between Algorithm 1 and Theorem 1.5 and
these existing results. First, we note that many authors have reported the
good behavior in practice of Newton’s or quasi-Newton’s methods for solving
discretized Monge-Amp`ere equations or optimal transport problems [23, 8, 4].
Note however that none of these works contain convergence proofs for the
Newton’s algorithm.

Loeper and Rappetti [21] (reﬁned by Saumier, Agueh, and Khouider [26])
establish the global convergence of a damped Newton’s method for solving
quadratic optimal transport on the torus, relying heavily on Caﬀarelli’s
regularity theory. In particular, the convergence of the algorithm requires
a positive lower bound on the probability densities, while this condition is
not necessary for Theorem 1.5 (see Section 5 and Appendix A where we
construct explicitly probability densities with non-convex support that still
satisfy the hypothesis of Theorem 1.5). A second drawback on relying on the
regularity theory for optimal transport is that the damping parameter, which
is an input parameter of the algorithm used in [21], cannot be determined
explicitly from the data. Third, the convergence proof is for continuous
densities, and it seems diﬃcult to adapt it to the space-discretized problem.
On the positive side, it seems likely that the convergence proof of [21][26] can
be adapted to cost functions satisfying the Ma-Trudinger-Wang condition
(which is equivalent to Loeper’s condition (QC) that we also require).

Finally Oliker and Prussner prove the local convergence of Newton’s
method for ﬁnding Alexandrov’s solutions to the Monge-Amp`ere equation
det D2u = ν with Dirichlet boundary conditions, where ν is a ﬁnitely sup-
ported measure [25]. Global convergence for a damped Newton’s algorithm
is established by Mirebeau [24] for a variant of Oliker and Prussner’s scheme,
but without convergence rates. Theorem 1.5 article can be seen as an ex-
tension of the strategy used by Mirebeau to optimal transport problems,
which amounts to (a) replacing the Dirichlet boundary conditions with the
second boundary value conditions from optimal transport (b) replacing the
Lebesgue measure by more general probability densities and (c) changing
the Monge-Amp`ere equation itself in order to deal with more general cost
functions.

8

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

Outline. In Section 2, we establish the diﬀerentiability of Kantorovich’s
functional Φ, adapting arguments from [3]. In Sections 3 and 4, we prove
the (uniform) second-diﬀerentiability of Kantorovich’s functional when the
cost function satisﬁes Loeper’s (QC) condition. Section 5 is devoted to the
proof of uniform concavity of Kantorovich’s functional, when the probability
density satisﬁes a Poincar´e-Wirtinger inequality (PW). In Section 6, we
combine these intermediate results to prove the convergence of the damped
Newton’s algorithm (Theorem 1.5), and we present a numerical illustration.
Appendix A presents an explicit construction of a probability density with
non-convex support over Rd which satisﬁes the assumptions of Theorem 1.5.
Appendix B contains an elementary proof of a convex geometry result used
in the regularity proof. Finally, Appendix C contains an alternate proof of a
crucial transversality condition, under the assumption that the target set Y
is sampled from some continuous domain.

2. Kantorovich’s functional

The purpose of this section is to present the variational formulation
introduced in [3] for the semi-discrete optimal transport problem, adapting
the arguments presented for the squared Euclidean cost in [3] to cost functions
satisfying (Reg’) and (Twist’), which are weaker than the conditions (Reg)
and (Twist) presented in the introduction:

(Reg’)

∀y ∈ Y, cy ∈ C0(Ω)
g((cy − cz)

−1(t)) = 0

∀y (cid:54)= z ∈ Y, ∀t ∈ R, Hd

(Twist’)
Note that under (Twist’), the map Tϕ : X → Y deﬁned by (1.2) is uniquely-
deﬁned Hd
g–almost everywhere. Most of the results presented here are well
known in the optimal transport literature, we include proofs for completeness.
Theorem 2.1. Assume (Reg’) and (Twist’), and let ρ be a bounded probabil-
y∈Y νyδy be a probability measure over Y . Then,
the functional Φ deﬁned by (1.3) is concave, C1-smooth, and its gradient is
given by (1.4).

ity density on Ω and ν =(cid:80)

The proof of Theorem 2.1 relies on Propositions 2.2 and 2.3.

Proposition 2.2. For any ψ : Y → R, the map Tψ is an optimal transport

map for the cost c between any probability density ρ on Ω and the pushforward
measure ν := Tψ#ρ.

Proof. Assume that ν = S#ρ where S is a measurable map between X and
Y . Then, by deﬁnition of Tψ one has

∀x ∈ X, c(x, Tψ(x)) + ψ(Tψ(x)) (cid:54) c(x, S(x)) + ψ(S(x)).

Multiplying this inequality by ρ and integrating it over X gives

(cid:90)

(cid:90)

g(x) (cid:54)

X

(c(x, Tψ(x))+ψ(Tψ(x)))ρ(x)dHd
(cid:90)
(cid:90)

X

(c(x, S(x))+ψ(S(x)))ρ(x)dHd
(cid:90)

g(x)

Since ν = S#ρ = Tψ#ρ, the change of variable formula gives

ψ(S(x))ρ(x)dHd

g(x) =

X

ϕ(y)dν =

Y

X

ψ(Tψ(x))ρ(x)dHd

g(x)

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

9

(cid:90)

(cid:90)

(cid:88)

y∈Y

Substracting this equality from the inequality above shows that Tψ is optimal:
(cid:3)

c(x, Tψ(x))ρ(x)dHd

X

g(x) (cid:54)

c(x, S(x))ρ(x)dHd

g(x)

X

Proposition 2.3. Assume (Twist’) and (Reg’). Let ρ be a probability
density over a compact subset X of Ω. Then, the map G : RY → RY is

continuous:

G(ψ) =(cid:0)ρ(Lagy(ψ))(cid:1)

y∈Y

(2.9)

Lemma 2.4. Let ρ be a probability density over a compact subset X of Ω, and
let f in C0(X) be such that ρ(f−1(t)) = 0 for all t ∈ R. Then, the function
g : t (cid:55)→ ρ(f−1((−∞, t]) is continuous.
Proof. We consider the function h(t) = ρ(f−1((−∞, t)). By hypothesis,
g(t) − h(t) = ρ(f−1(t)) = 0. Moreover, using Lebesgue’s monotone con-
vergence theorem one easily sees that g (resp. h) is right-continuous (resp.
(cid:3)
left-continuous). This concludes the proof
in Y and remark that by deﬁnition, Lagy(ψ) =(cid:84)
|Gy(ψ) − Gy(ϕ)| (cid:54) ρ(Lagy(ψ)∆ Lagy(ϕ)) (cid:54) (cid:88)

Proof of Proposition 2.3. Proving the continuity of G amounts to proving
the continuity of the functions Gy(ψ) := ρ(Lagy(ψ)) for any y in Y . Fix y

Denoting A∆B the symmetric diﬀerence of two sets, we have the following
inequalities

Hz(ψ) := {x ∈ X | c(x, y) + ψ(y) (cid:54) c(x, z) + ψ(z)}.

z(cid:54)=y∈Y Hz(ψ) where

ρ(Hz(ψ)∆Hz(ϕ)).

z(cid:54)=y∈Y

(2.10)

Fix z (cid:54)= y ∈ Y , and denote f = c(·, y) − c(·, z). Then,

Hz(ψ)∆Hz(ϕ) ⊆ f

−1([ψ(z) − ψ(y), ϕ(z) − ϕ(y)]).

By (Twist’) and Lemma 2.4 we know that limϕ→ψ ρ(Hz(ψ)∆Hz(ϕ)) = 0,
(cid:3)
which with (2.10) concludes the proof.

2.1. Proof of Theorem 1.1. We simultaneously show that the functional
is concave and compute its gradient. For any function ψ on Y and any

measurable map T : X → Y , one has miny∈Y (c(x, y) + ψ(y)) (cid:54) c(y, T (y)) +

ψ(T (y)), which by integration gives

(c(x, T (x)) + ψ(T (x)))ρ(x)dHd

g(x) −

X

ψ(y)νy.

(2.11)

Moreover, equality holds when T = Tψ. Taking another function ϕ on Y
and setting T = Tϕ in Equation (2.11) gives

Φ(ψ) (cid:54) Φ(ϕ) + (cid:104)G(ϕ) − ν | ψ − ϕ(cid:105),

where G is deﬁned as in the statement of Proposition 2.3. This proves that
the superdiﬀerential of Φ is never empty, thus establishing the concavity. By
Proposition 2.3, the map G is continuous, meaning that we have constructed a
continuous selection of a supergradient in the superdiﬀerential of the concave
function Φ. By standard arguments from convex analysis, this proves that Φ
is C1, and that ∇Φ(ψ) = G(ψ) − ν.

(cid:90)

Φ(ψ) (cid:54)

10

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

3. Local regularity in a c-exponential chart

The results presented in this section constitute an intermediate step
in the proof of C2,α regularity of Kantorovich’s functional. Let ˆX be a
compact, convex subset of Rd and f1, . . . , fN be C1,1 functions on ˆX which
are quasi-convex, meaning that for any scalar κ ∈ R the closed sublevel sets
−1
([−∞, κ]) are convex. Let ˆρ be a continuous probability density
Ki(κ) := f
i
over ˆX. The purpose of this section is to give suﬃcient conditions to ensure
the regularity of the following function ˆG near the origin of RN :
ˆG : λ ∈ RN (cid:55)→

ˆρ(x)dHd(x),
N(cid:92)
Ki(λi) = {x ∈ ˆX | ∀i ∈ {1, . . . , N}, fi(x) (cid:54) λi}.

where K(λ) := ˆX ∩

(3.12)

(cid:90)

K(λ)

i=1

3.1. Assumptions and statement of the theorem. We will impose two
conditions on the functions (fi)1(cid:54)i(cid:54)N . As we will see in Section 4, both
conditions are satisﬁed when these functions (fi) are constructed from a
semi-discrete optimal transport transport problem whose cost function satisfy
Loeper’s condition (see Deﬁnition 1.1).

Non-degeneracy. The functions (fi) satisfy the nondegeneracy condition if
the norm of their gradients is bounded from below:

εnd := min
1(cid:54)i(cid:54)N

ˆX (cid:107)∇fi(cid:107) > 0.
min

(ND)

This condition is necessary for the continuity of the map ˆG even when N = 1.

Transversality. The boundary of the convex set K(λ) can be decomposed
into N + 1 facets, namely (K(λ) ∩ ∂Ki(λi))1(cid:54)i(cid:54)N and K(λ) ∩ ∂ ˆX. The
purpose of the transversality condition we consider is to ensure that adjacent
facets make a minimum angle, when λ remains close to some ﬁxed vector
λ0. More precisely, we say that the family of functions (fi) satisfy the
transversality condition near λ0 if there exists positive constants εtr and
Ttr (cid:54) 1 such that for every λ in RN satisfying (cid:107)λ − λ0(cid:107)∞ (cid:54) Ttr for the usual
(cid:96)∞ norm on RN and every point x in ∂K(λ) one has,
if ∃i (cid:54)= j ∈ {1, . . . , N} s.t. fi(x) = λi and fj(x) = λj,

(cid:18)

(cid:19)2 (cid:54) 1 − ε2
(cid:19)2 (cid:54) 1 − ε2

tr

tr,

(T)

then,

(cid:104)∇fi(x) | ∇fj(x)(cid:105)
(cid:107)∇fi(x)(cid:107)(cid:107)∇fj(x)(cid:107)

(cid:18)

if ∃i ∈ {1, . . . , N} s.t. fi(x) = λi and x ∈ ∂ ˆX,

then, ∀u ∈ Nx ˆX,

(cid:104)u | ∇fj(x)(cid:105)
(cid:107)u(cid:107)(cid:107)∇fj(x)(cid:107)

where Nx ˆX is the normal cone to the convex set ˆX at x (see (B.68) for
a deﬁnition). When ∂ ˆX is smooth at x, Nx ˆX is the ray spanned by the
exterior normal to ˆX at x. We denote by Σ(λ) the set of points x in the

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

11

boundary of K(λ) satisfying one of the assumptions in (T) or, equivalently,
which belong to two (or more) distinct facets of K(λ):

Σ(λ) =

(K(λ)∩ ∂ ˆX ∩ ∂Ki(λi))∪

(K(λ)∩ ∂Ki(λi)∩ ∂Kj(λj)).

1(cid:54)i<j(cid:54)N

(cid:91)

1(cid:54)i(cid:54)N

(cid:91)

We will see that the transversality condition (T) and the quasi-convexity of
the functions (fi) imply a uniform upper bound on the (d − 2)–Hausdorﬀ
measure of Σ(λ), which is essential in establishing the smoothness of ˆG.

Theorem 3.1. Assume that the functions satisfy the non-degeneracy con-
dition (ND) and the transversality condition (T) near λ0. Let ˆρ be a Cα
probability density on ˆX. Then, the map ˆG deﬁned in (3.12) is of class C1,α
on the cube Q := λ0 + [−Ttr, Ttr]N and has partial derivatives given by

K(λ)∩∂Ki(λ)

ˆρ(x)

(cid:107)∇fi(x)(cid:107)

dHd−1(x).

(3.13)

is bounded by a constant depending only

In addition, the norm
on εtr, εnd,(cid:107)ˆρ(cid:107)Cα( ˆX), on the diameter of ˆX and on
CL := max

CM := max

1(cid:54)i(cid:54)N (cid:107)∇fi(cid:107)∞

1(cid:54)i(cid:54)N (cid:107)∇fi(cid:107)Lip( ˆX) .

(cid:90)
(cid:13)(cid:13)(cid:13)C1,α(Q)

∂ ˆG
∂λi

(λ) =

(cid:13)(cid:13)(cid:13) ˆG

Note that the C1,α constant of ˆG depends on the transversality constant εtr

but that it does not depend on Ttr.

3.2. Existence of partial derivatives. Without loss of generality, we as-
sume that λ0 = 0. We start the proof of Theorem 3.1 by showing the
existence of partial derivatives for the map ˆG. In this section, we denote
e1, . . . , eN the canonical basis of RN . We start by rewriting the ﬁnite dif-
ference deﬁning the partial derivative of ˆG in direction ei using the coarea
formula. Fix (cid:107)λ(cid:107) < Ttr. For t > 0, one has:

1
t

( ˆG(λ + tei) − ˆG(λ)) =

K(λ+tei)\K(λ)

ˆρ(x)dHd(x)

(cid:90)
(cid:90) λi+t

1
t

=

1
t

ˆg(s)ds,

λi

where the function ˆg is deﬁned by

(cid:90)

ˆg(s) :=

∩j(cid:54)=iKj (λj )∩f−1

i

(s)

ˆρ(x)

(cid:107)∇fi(x)(cid:107)

dHd−1(x).

The same reasoning also holds for t < 0. We now claim that ˆg is continuous
on some interval around λi, which by (3.14) and the Fundamental Theorem
of Calculus will imply that the limit as t → 0 in (3.14) exists and is equal to
ˆg(λ), thus establishing the formula (3.13). The continuity of ˆg follows from
the next proposition, which is formulated in a slightly more general way.

Proposition 3.2. Let σ be a continuous non-negative function on ˆX and
let ω be the modulus of continuity of σ. Given any vector λ in RN with

(3.14)

(3.15)

12

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

(cid:90)
(cid:107)λ(cid:107)∞ (cid:54) Ttr, consider the function
h : s ∈ R (cid:55)→
where L :=(cid:84)

L∩Ss
−1
j(cid:54)=i Kj(λj) and Ss := f
i

σ(x)dHd−1(x),

(s). Then h is uniformly continuous

on [−Ttr, Ttr] and has modulus of continuity

ωh(δ) = const · (ω(Cδ) + |δ|),

(3.16)
where the constants only depend on (cid:107)fi(cid:107)C1,1, diam( ˆX), εnd, εtr and (cid:107)σ(cid:107)∞.
Taking σ = ˆρ/(cid:107)∇fi(cid:107) in the previous proposition, which is continuous
using the non-degeneracy condition (ND) and the assumption fi ∈ C1,1( ˆX),
we see that the function ˆg deﬁned by (3.15) is continuous. This implies the
existence of partial derivatives and establishes formula (3.13). The proof of
Proposition 3.2 requires two lemmas.

Lemma 3.3. Assume that the functions fi : ˆX → R satisfy (ND). Then, for
every i ∈ {1, . . . , N}, there exists a map Φi : ˆX × R → Rd such that:
(i) For any (x, t) in ˆX × R such that the curve Φi(x, [0, t]) remains in ˆX,
(ii) The map Φi satisﬁes the following inequalities for every x, y ∈ ˆX, t ∈ R:

one has fi(Φi(x, t)) = fi(x) + t.

εnd

where CΦ := 3CL/ε2

(cid:107)Φi(x, t) − Φi(x, s)(cid:107) (cid:54) |t − s|
(cid:107)Φi(x, t) − Φi(y, t)(cid:107) (cid:54) exp(CΦ |t|)(cid:107)x − y(cid:107) ,
(cid:13)(cid:13)∞ (cid:54) 1/εnd and whose Lipschitz constant is bounded by CΦ.

i (x) = ∇fi(x)/(cid:107)∇fi(x)(cid:107)2 on ˆX, which
Proof. We consider the vector ﬁeld V 0
satisﬁes
This vector ﬁeld is extended to Rd using the orthogonal projection on ˆX,
denoted p ˆX ,

(cid:13)(cid:13)V 0

i

nd.

(3.17)

(3.18)

∀x ∈ Rd, Vi(x) := V 0

i (p ˆX (x))).

By convexity of ˆX, the map p ˆX is 1-Lipschitz. This implies that the Lipschitz
constant of Vi is also bounded by CΦ. We let Φi be the ﬂow induced by this
vector ﬁeld, which exists and is for all time since Vi is bounded and uniformly
Lipschitz on all of Rd. The inequality (3.17) follows from the deﬁnition of
integral curves and the bound on (cid:107)Vi(cid:107). Any integral curve γ : [0, T ] → Rd of
Vi which remains in ˆX satisﬁes

(cid:90) t
(cid:90) t

fi(γ(t)) = fi(γ(0)) +

= fi(γ(0)) +

(cid:48)

(s) | ∇fi(γ(s))(cid:105)ds

0 (cid:104)γ

0 (cid:104)Vi(γ(s)) | ∇fi(γ(s))(cid:105)ds = fi(γ(0)) + t,

thus establishing (i). The inequality (3.18) follows from the bound on the
(cid:3)
Lipschitz constant of Vi and from Gronwall’s lemma.

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

13

Figure 2. Illustration of the proof of Proposition 3.2.

Lemma 3.4. Assuming the transversality condition (T), there exists a con-
stant depending only on d and diam( ˆX) such that for every (cid:107)λ(cid:107)∞ (cid:54) Ttr,

Hd−2(Σ(λ)) (cid:54) const(d, diam( ˆX)) ·

1
εtr

.

Proof. Given (cid:107)λ(cid:107)∞ (cid:54) Ttr, the transversality condition (T) implies

(cid:18)

(cid:104)u | v(cid:105)
(cid:107)u(cid:107)(cid:107)v(cid:107)

(cid:19)2 (cid:54) 1 − ε2

tr,

∀x ∈ Σ(λ), ∃u, v ∈ NxK(λ),

where NxK(λ) is the normal cone to the convex set K(λ) at x (see (B.68)).
This implies that Σ(λ) is included in the set Sing(K(λ), εtr) of τ -singular
points deﬁned in (B.69), with τ = εtr. The lemma then follows from
(cid:3)
Proposition B.1.

Proof of Proposition 3.2. Let t, s be small enough so that the transversality
condition (T) holds (that is t, s ∈ [−Ttr, Ttr]). We assume that t < s so as
to ﬁx the signs of some expressions. We consider the following partition of
the facet St ∩ L, whose geometric meaning is illustrated in Figure 2:

At = {x ∈ St ∩ L | Φi(x, [0, s − t]) ⊆ L}
Bt = {x ∈ St ∩ L | ∃u ∈ [0, s − t), Φi(x, u) ∈ ∂L}.

Similarly, we deﬁne

As = {x ∈ Ss ∩ L | Φi(x, [t − s, 0]) ⊆ L}
Bs = {x ∈ Ss ∩ L | ∃u ∈ (t − s, 0], Φi(x, u) ∈ ∂L}.

Recall that by deﬁnition,

(cid:90)

(cid:90)

h(t) =

At

σ(x)dHd−1(x) +

σ(x)dHd−1(x),

(3.19)

Bt

StSsxF(x)AtAsBtBsL∂K1(λ1)Λ∂X∂K2(λ2)14

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

(cid:12)(cid:12)(cid:12)(cid:12)(cid:90)

At

where the integral is with respect to the (d − 1)-dimensional Hausdorﬀ
measure. Our strategy to show the continuity of h is to prove that the ﬁrst
term in the sums deﬁning h(t) and h(s) in (3.19) are close, namely

(3.20)
and then that the terms involving Bt, Bs are small (recall that both sets
depend on t and s):

(cid:90)

As

(cid:12)(cid:12)(cid:12)(cid:12) (cid:54) const · (|s − t| + ω(C |s − t|))
(cid:12)(cid:12)(cid:12) (cid:54) const · |s − t|

σ(x)dHd−1(x)
(cid:90)
(cid:12)(cid:12)(cid:12) +

(cid:12)(cid:12)(cid:12)σ(x)dHd−1(x)

Bs

(3.21)

σ(x)dHd−1(x) −
(cid:90)

(cid:12)(cid:12)(cid:12)σ(x)dHd−1(x)

Bt

(cid:90)

At

Using a Lipschitz change of variable formula, we get

The combination of the estimates (3.20) and (3.21) implies the desired
inequality (3.16). We now turn to the proof of these estimates, and that the
constant in these estimates depend on (cid:107)fi(cid:107)C1,1, diam( ˆX), εnd, εtr and (cid:107)σ(cid:107)∞.
Proof of Estimate (3.20). By Lemma 3.3.(i), for any point x in At one has
fi(Φi(x, s − t)) = s, so that the map F (x) := Φi(x, s − t) induces a bijection
between the sets At and As. As a consequence of (3.18), the restriction of F
to At is a bi-Lipschitz bijection between the sets At and As, with Lipschitz
constant

σ(F

(cid:90)

Lip(As)

F −1(As)

max{

−1(cid:13)(cid:13)d−1

(cid:13)(cid:13)F
−1(cid:13)(cid:13)Lip(As) , (cid:107)F(cid:107)Lip(At)} (cid:54) exp(CΦ |s − t|).
(cid:90)
σ(x)dHd−1(x) =
σ(x)dHd−1(x)
(cid:54)(cid:13)(cid:13)F
(cid:90)
−1(x))dHd−1(x)
(cid:54) exp(CΦ(d − 1)|s − t|)
(cid:13)(cid:13))
(cid:13)(cid:13)F
(cid:12)(cid:12) (cid:54) ω(
= ω((cid:107)Φ(x, s − t) − x(cid:107)) (cid:54) ω(|s − t| /εnd)
(cid:90)
(cid:90)

−1(x)) − σ(x)

−1(x))dHd−1(x) (cid:54)
(cid:54)

−1(x) − x

(cid:12)(cid:12)σ(F

As

σ(x)dHd−1(x) + Hd−1(As)ω(|s − t| /εnd)
σ(x)dHd−1(x) + Hd−1( ˆX)ω(|s − t| /εnd)

σ(F

−1(x))dHd−1(x).

As

As

As

(3.22)

By deﬁnition of the modulus of continuity and thanks to (3.17),

(cid:90)

σ(F

As

Integrating this inequality, we get

(3.23)
where the second inequality uses the monotonicity of the (d − 1)-dimensional
Hausdorﬀ measure of the boundary of a convex set with respect to inclusion,
see [27, p.211]. Combining (3.22) and (3.23) we get

(cid:18)(cid:90)

(cid:90)

σ(x)dHd−1(x) (cid:54) exp(CΦ(d−1)|s − t|)

At

σ(x)dHd−1(x) + Hd−1( ˆX)ω(|s − t| /εnd)

As

(cid:19)

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

15

so that

(cid:90)

σ(x)dHd−1(x) −

At

(cid:90)

As

σ(x)dHd−1(x) (cid:54) (exp(CΦ(d − 1)|s − t|) − 1)(cid:107)σ(cid:107)∞ Hd−1( ˆX)+
exp(CΦ(d − 1)|s − t|)Hd−1( ˆX)ω(|s − t| /εnd)

(cid:54) const · (|s − t| + ω(|s − t| /εnd)),
where the constant depends on CL, εnd, εtr, (cid:107)σ(cid:107)∞ and diam( ˆX). Exchanging
the role of s and t completes the proof of (3.20).

Proof of (3.21). By deﬁnition, for every point x in the set Bt, the curve
Φi(x, [0, s − t]) must cross the boundary of L at some point, so that

u(x) := min{v ∈ [0, s − t] | Φi(x, v) ∈ ∂L}

is well deﬁned. We write P (x) := Φi(x, u(x)) for the corresponding point on
the boundary of L. By deﬁnition of u(x), the curve Φ(x, [0, u(x)]) is included
in L, so that by Lemma 3.3.(i) we have fi(P (x)) = t + u(x). This shows

P (Bt) ⊆ Λ := ∂L ∩ f

−1
i

([t, s]).

(3.24)

We now prove that the map P satisﬁes a reverse-Lipschitz inequality. Note
that for any point x in Bt,

x = Φi(P (x),−u(x)) = Φi(P (x), t − fi(P (x))),

Using the bounds (3.18) and (3.17), we get that for any x, y in Bt,

(cid:107)x − y(cid:107) (cid:54) (cid:107)Φi(P (x), t − fi(P (x))) − Φi(P (y), t − fi(P (y)))(cid:107)
(cid:54) (cid:107)Φi(P (x), t − fi(P (x))) − Φi(P (y), t − fi(P (x)))(cid:107)
(cid:54) exp(CΦTtr)(cid:107)P (x) − P (y)(cid:107) + |fi(P (x)) − fi(P (y))| /εnd
(cid:54) C

+ (cid:107)Φi(P (y), t − fi(P (x))) − Φi(P (y), t − fi(P (y)))(cid:107)

(cid:48)

(cid:107)P (x) − P (y)(cid:107)

where C(cid:48) := exp(CΦ) + CL/εnd; we have used that Ttr (cid:54) 1. We can now
bound the (d−1)–Hausdorﬀ measure of Bt from that of Λ using this Lipschitz
bound and the inclusion (3.24):

Hd−1(Bt) (cid:54) Hd−1(P

−1(P (Bt))) (cid:54) C

(cid:48)d−1Hd−1(Λ).

(3.25)

What remains to be done is to prove that the (d − 1)–Hausdorﬀ measure of
Λ behaves like O(|s − t|), and this is where the transversality condition will
enter.

Let us write

Fj :=

(cid:40)
−1
f
(λj),
j
∂ ˆX ∩ ∂L,

j (cid:54)= 0, i,
j = 0.

Then ∂L can be partitioned (up to a Hd−1–negligible set) into faces ∂L =
∪j(cid:54)=i(Fj ∩ L) and using the coarea formula on each of the facets we get

16

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

−1
(writing B := f
i
Hd−1(Λ) =

([t, s]))

=

=

j(cid:54)=i

j(cid:54)=i

B∩(Fj∩L)

(cid:88)
Hd−1(B ∩ (Fj ∩ L))
(cid:90)
(cid:88)
dHd−1(x)
(cid:90) s
(cid:90)
(cid:88)
(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)∇fi(x) − (cid:104)∇fi(x) | ∇fj(x)(cid:105) ∇fj(x)

Su∩(Fj∩L)

Jij(x)

j(cid:54)=i

t

(cid:107)∇fj(x)(cid:107)2

(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)

1

dHd−2(x)du,

(3.26)

where and Jij(x) is the Jacobian of the restriction of the function fi to the
hypersurface Fj. More precisely,

Jij(x) =

if j (cid:54)= 0, i, and

Ji0(x) = (cid:107)∇fi(x) − (cid:104)∇fi(x) | v0(x)(cid:105)v0(x)(cid:107)

where v0(x) ∈ Nx ˆX is a unit vector. Since ˆX is convex, for Hd−1 a.e. x ∈ ∂ ˆX,
the normal cone Nx ˆX consists of only one direction, thus for such x there
is a unique choice of v0(x). Let us write vi = ∇fi(x)/(cid:107)∇fi(x)(cid:107) and vj for
either ∇fj(x)/(cid:107)∇fj(x)(cid:107) or v0(x), we then have using (T)
Jij(x)2 = (cid:107)∇fi(x)(cid:107)2 (cid:107)vi − (cid:104)vi | vj(cid:105)vj(cid:107)2

(cid:62) (cid:107)∇fi(x)(cid:107)2 (1 − (cid:104)vi | vj(cid:105)2)
(cid:62) ε2

ndε2
tr.

Combining (3.26) and (3.27) gives us

(cid:90) s
t Hd−2(Su ∩ (Fj ∩ L))du

(cid:88)
(cid:90) s
t Hd−2(Su ∩ ∂L)du.

j(cid:54)=i

Hd−1(Λ) (cid:54) 1

εndεtr

=

1

εndεtr

(3.27)

(3.28)

By deﬁnition, a point belongs to the intersection Su ∩ ∂L if it lies in the
singularity set Σ(λ(u)) where λ(u) = (λ1, . . . , λi−1, u, λi+1, . . . , λN ). By
Lemma 3.4,

Hd−2(Su ∩ ∂L) (cid:54) Hd−2(Σ(λ(u))) (cid:54) const(d, diam( ˆX)) ·

1
εtr

.

(3.29)

Combining (3.25), (3.28) and (3.29) we obtain Hd(Bt) (cid:54) const·|t − s|, which
(cid:3)

implies (3.21) using the boundedness of σ.

3.3. Continuity of partial derivatives. We prove that the function ˆG
deﬁned in (3.12) is continuously diﬀerentiable by controlling the modulus of
continuity of its partial derivatives given in (3.13). Again, we start with a
slightly more general proposition.

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

17

Proposition 3.5. Let σ be a continuous function on ˆX with modulus of
continuity ω. Consider the following function on the cube Q := [−Ttr, Ttr]N :

(cid:90)

H(λ) :=

K(λ)∩f−1

i

(λi)

σ(x)dHd−1(x).

Then H is uniformly continuous on Q with modulus of continuity

where the constants only depend on (cid:107)fi(cid:107)C1,1( ˆX), diam( ˆX), εnd, εtr, and (cid:107)σ(cid:107)∞.

ωH (δ) = const · (ω(Cδ) + |δ|),

Proof. Proposition 3.2 yields that the function H is uniformly continuous
with respect to changes of the ith variable. Let us now consider variations
with respect to the jth variable, with j (cid:54)= i by introducing

(cid:90)

h : s ∈ [−Ttr, Ttr] (cid:55)→

K(λ1,...,λj−1,s,λj+1,...,λN )∩f−1

(λi)

i

for some ﬁxed λ ∈ [−Ttr, Ttr]N . We can rewrite the diﬀerence between two
values of h using the coarea formula. As before, we assume s > t to ﬁx the
signs and introduce L(cid:48) := ˆX ∩
(λi). We have
L(cid:48)∩Kj (s)∩S

−1
k(cid:54)∈{i,j} Kk(λk) and S := f
i
σ(x)dHd−1(x)

(cid:84)
σ(x)dHd−1(x) −

h(s) − h(t) =

L(cid:48)∩Kj (t)∩S

(cid:90)

σ(x)dHd−1(x).

(cid:90)
(cid:90) s

(cid:90)

=

t

L(cid:48)∩S∩f−1

σ(x)
Jij(x)

dHd−2(x)du,

j

(u)

where the Jacobian factor Jij (cid:62) εndεtr from (3.27). Therefore,
−1(u))du.

(cid:90) s
t Hd−2(L ∩ S ∩ f

h(s) (cid:54) h(t) + (cid:107)σ(cid:107)∞
εndεtr

Just as in the proof of Proposition 3.2, the set L ∩ S ∩ f−1(u) is included in
the set Σ(λ1, . . . , λj−1, u, λj, . . . , λN ). Thus, by Lemma 3.4,

(3.30)

Hd−2(L ∩ S ∩ f

−1(u)) (cid:54) const(d, ˆX)

εtr

.

(3.31)

Combining (3.30) and (3.31) we can see that the function h is Lipschitz with
constant

where ωh is the modulus of continuity deﬁned in Proposition 3.2. This
establishes the uniform continuity of the function H, with the desired modulus
(cid:3)
of continuity.

Finally,

|H(µ) − H(λ)| (cid:54)

Ch := const(d, ˆX)(cid:107)σ(cid:107)∞
εndε2
tr

.

j=1

N(cid:88)
(cid:54) ωh(|µi − λi|) +
(cid:54) ωh((cid:107)µ − λ(cid:107)∞) + (N − 1)Ch (cid:107)µ − λ(cid:107)∞ ,

Ch |µj − λj|

(cid:88)

j(cid:54)=i

|H(λ1, . . . , λk−1, µj, . . . , µN ) − H(λ1, . . . , λj, µj+1, . . . , µN )|

18

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

3.4. Proof of Theorem 3.1. Proposition 3.2 shows that the partial de-
rivative ˆG with respect to the variable λi exists and that its expression is
given by (3.15). Applying Proposition 3.5 with σ(x) = ˆρ(x)/(cid:107)∇fi(x)(cid:107), we
obtain Cα regularity for each of the partial derivatives of ˆG on the cube
Q := [−Ttr, Ttr]N from the Cα regularity of ˆρ. Moreover, the Cα constant of
each partial derivative over Q is controlled by

const(diam( ˆX), εnd, εtr,(cid:107)∇fi(cid:107)C1,1(X) ,(cid:107)ˆρ(cid:107)Cα(X)).

4. C2,α regularity of Kantorovich’s functional

This section is devoted to the proof of the following regularity result.

Theorem 4.1. Assume (Reg), (Twist), and (QC). Let X be a compact,
c-convex subset of Ω and ρ in P ac(X) ∩ Cα(X) for α in (0, 1]. Then, the
Kantorovich’s functional Φ is uniformly C2,α on the set

Kε := {ψ : Y → R | ∀y ∈ Y, ρ(Lagy(ψ)) > ε}

(4.32)
and its Hessian is given by (1.8). In addition, the C2,α norm of the restriction
of Φ to Kε depends only on (cid:107)ρ(cid:107)∞, ε, diam(X), and the constants deﬁned in
Remark 4.1 below.

For the remainder of the section, for any point y in Y , we will denote Xy =

y)−1(X) ⊆ Rd the inverse image of the domain X in the exponential

(expc
chart at y. The set Xy is convex by c-concavity of X. We consider the
functions

fz,y : p ∈ Xy (cid:55)→ c(expc

y(p), y) − c(expc

y(p), z),

which are quasi-concave by (QC). The main diﬃculty in deducing Theo-
rem 4.1 from Theorem 3.1 is in establishing the quantitative transversality
condition (T) for the family of functions (fz,y)z∈Y \{y}.
Remark 4.1 (Constants). The C2,α norm of the restriction of Φ to Kε ex-
plicitely depends on the following constants, whose ﬁniteness (or positivity)
follows from the compactness of the domain X, from the ﬁniteness of the set
Y and from the conditions (Reg), (Twist), and (QC):

εtw := min
x∈X

min
y,z∈Y
y(cid:54)=z
C∇ := max

Cexp := max
y∈Y

max

(cid:107)Dcy(x) − Dcz(x)(cid:107)g > 0

(x,y)∈X×Y (cid:107)Dcy(x)(cid:107)g < +∞

(cid:110)(cid:13)(cid:13)expc

y

(cid:13)(cid:13)Lip(Xy) ,

(cid:13)(cid:13)(expc

y)

−1(cid:13)(cid:13)Lip(X)

(cid:111)

where we recall that cy(x) = c(x, y) and Xy := exp−1
y (X). Our estimates
will also rely on the following constants involving the diﬀerential of the
exponential maps. As before, the tangent spaces TxΩ are endowed with the
Riemannian metric g from Ω. We set:

< +∞,

(4.33)

(cid:12)(cid:12)p),
(cid:13)(cid:13)Lip(Xy) ,

cond( D expc
y

max
p∈Xy

(cid:13)(cid:13)det(D expc

y)

Ccond := max
y∈Y

Cdet := max
y∈Y

where cond(A) is the condition number of a linear transform A between ﬁnite
dimensional normed spaces and det(A) is the determinant of A with respect

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

19

to orthornormal bases. The quantitative transversality estimates involve all
the above constants in an explicit way, see (4.45).

Remark 4.2. Even in the Euclidean case, one needs a lower bound on the
volume of Laguerre cells in order to establish the second-diﬀerentiability of

the functional Φ. Indeed, let y± = ±1, let y0 = 0, Y = {y−, y0, y+} ⊆ R.
Consider the cost c(x, y) = −xy, and the density ρ = 1 on X = [− 1
2 ]. Let
ϕτ ∈ RY be deﬁned by ϕ(y±) = 1/2 and ϕ(y0) = τ . A simple calculation
gives, for τ (cid:62) 0,

2 , 1

∂Φ
∂1y0

(ψτ ) = max(1 − 2τ, 0),

which is not diﬀerentiable at τ = 1/2, even though (Reg), (Twist), and (QC)
are all satisﬁed.

Outline. In Section 4.1, we establish a part of the transversality condition
using elementary properties of convex sets (Proposition 4.2). We establish in
Section 4.2 a second transversality condition using additional assumptions
and proceed in Section 4.3 to the proof of Theorem 4.1. In Section 4.4, we
propose an alternative transversality estimate when Y is a sample subset of
a target domain Ω(cid:48) (Proposition 4.8).
4.1. Lower transversality estimates. Next, we undertake a series of
proofs to obtain explicit constants in the transversality estimate (T), which
depend on the choices of cost, domains, and dimension. Consider the Laguerre
cell of a point y in Y in its own exponential chart, that is

Ly(ψ) := (expc
y)

−1(Lagy(ψ)) = {p ∈ Xy | fz,y(p) (cid:54) ψ(z) − ψ(y)}.

The set Ly(ψ) is the intersection of sublevel sets of the functions fz,y, and
is therefore a convex subset of Xy by condition (QC). The ﬁrst proposition
establishes that two unit outer normals to Ly with the same basepoint cannot
be near-opposite. Recall the deﬁnition of the normal cone from (B.68).
Proposition 4.2. Assume that ψ lies in Kε/2 (see (4.32)). For any y in Y ,
any point p in ∂Ly(ψ) and any unit normal vectors v, w ∈ NpLy(ψ) one has
(4.34)
where δ0 := ε/(2d−1 (cid:107)ρ(cid:107)∞ Cexp

(cid:104)v | w(cid:105) (cid:62) −1 + δ2
0,
2d diam (X)d) (cid:54) 1.

The proof of this proposition follows from a general lemma about convex
sets. By convexity (QC), the set Ly(ψ) is contained in an intersection of
two half-spaces with outward normals v and w at p, giving an upper bound
on its volume in term of its diameter and the angle between v and w (see
Figure 3). On the other hand, we know that the volume of Ly(ψ) is bounded
from below by a constant depending on ε. Comparing these bounds will give
us the one-sided estimate (4.34).
Lemma 4.3. Let K be a bounded convex set of Rd, let p be a boundary point
of K and v, w be two unit (outward) normal vectors to K at p. Then,

−1 + δ2

K

(cid:54) (cid:104)v | w(cid:105) where δK =

Hd(K)

2d−2 diam(K)d

(cid:54) 1.

20

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

Figure 3. Bound on the volume of a convex set K as a
function of the angle between two normal vectors v, w at the
same point and its diameter (see Lemma 4.3).

Proof. The left-hand side of the inequality is non-positive, so the inequality

needs only to be proven when (cid:104)v | w(cid:105) (cid:54) 0, which we assume from now on.
Rd. Then, letting H := {p | (cid:104)p | v(cid:105) (cid:54) 0}, H(cid:48) := {p | (cid:104)p | w(cid:105) (cid:54) 0} and D be

Making a rotation of axes and a translation if necessary, we assume that p
lies at the orign and that the unit vectors span the ﬁrst two coordinates of

the two-dimensional disc centered at 0 of radius diam(K), one has

(cid:48)

K ⊆ H ∩ H
The intersection H ∩ H(cid:48)
is equal to θ := π − arccos((cid:104)v | w(cid:105)) (see Figure 3). Therefore, we have

∩ (D × [− diam(K), diam(K)]d−2).
∩ D is an angular sector of the disc D, whose angle

∩ (D × [− diam(K), diam(K)]d−2))
Hd(K) (cid:54) Hd(H ∩ H
(cid:115)

Using the expression of cos(θ) in term of tan(θ/2) and recalling (cid:104)v | w(cid:105) (cid:54) 0,

(cid:54) 2d−2 diam(K)d tan(θ/2).

(4.35)

(cid:48)

(cid:54)(cid:112)

tan(θ/2) =

1 + (cid:104)v | w(cid:105)
1 − (cid:104)v | w(cid:105)

1 + (cid:104)v | w(cid:105)

The lemma follows directly from Equations (4.35)–(4.36).

(4.36)

(cid:3)

Proof of Proposition 4.2. By deﬁnition of the bi-Lipschitz constant Cexp,

Hd(Ly(ψ)) (cid:62) ε/(2Cd

exp (cid:107)ρ(cid:107)∞) and diam(Ly(ψ)) (cid:54) Cexp diam(X).

Applying the above lemma to the two outward normals v, w at p, we get

(cid:104)v | w(cid:105) + 1 (cid:62)

Hd(Ly(ψ))2

4d−2 diam(Ly(ψ))2d

(cid:62)

ε2

4d−1C4d

exp (cid:107)ρ(cid:107)2∞ diam(X)2d

(cid:3)

.

We also record the following lemma for later use.

Lemma 4.4. Let y in Y and let p in be a point of Ly(ψ) such that for some
z (cid:54)= y, fz,y(p) = ψ(z)−ψ(y). Then, the point p(cid:48) := (expc
y(p)) belongs
to Lz(ψ) and the vector ∇fy,z(p) lies in the normal cone Np(cid:48)Lz(ψ).
Proof. We introduce the point x = expc
y(p). The hypothesis is equivalent to
c(x, y) + ψ(y) = c(x, z) + ψ(z). Since p belongs to Ly(ψ), the point x belongs

z)−1(expc

vwKθ≤diam(K)A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

21

to Lagy(ψ). Then, for any z(cid:48)

∈ Y ,

c(x, z) + ψ(z) = c(x, y) + ψ(y) (cid:54) c(x, z

(cid:48)

) + ψ(z

(cid:48)

)

thus establishing that x belongs to Lagz(ψ) or equivalently p(cid:48)

∈ Lz(ψ). (cid:3)

4.2. Upper transversality estimates. We now turn to the proof of the
quantitative transversality estimates. We begin with a bound which involves
the condition number of diﬀerential of exponential maps, see Remark 4.1.
The advantage of this ﬁrst bound is that we do not have to assume that the
points in Y are sampled from a continuous domain. A second transversality
estimate is presented in §4.4.
Notation. We introduce notation that will be used in throughout this section.
We ﬁx a point y0 in Y and also ﬁx an arbitrary ordering of the remaining
points, so that Y = {y0, y1, . . . , yN}. We deﬁne ˆX := Xy0 and for every
index i ∈ {1, . . . , N} we put

fi := fyi,y0 : p ∈ ˆX (cid:55)→ c(expc

y0(p), y0) − c(expc

y0(p), yi).

By the (Twist) condition, these functions f1, . . . , fN satisfy the non-degeneracy
condition (ND), and we have the following inequalities:
−1
expεtw > 0,

p∈Xy0 (cid:107)∇fi(p) − ∇fj(p)(cid:107) (cid:62) C

εnd := min
i,j(cid:54)=0

(4.37)

min

sup
i(cid:54)=0

sup

p∈Xy0 (cid:107)∇fi(p)(cid:107) (cid:54) CexpC∇.

(4.38)

(4.39)

(4.40)

To any function ψ : Y → R we associate the vector

λψ : = (ψ(y1) − ψ(y0), . . . , ψ(yN ) − ψ(y0)) ∈ RN .

We also consider the same family of convex set as in Section 3:

K(λ) = {p ∈ ˆX | ∀1 (cid:54) i (cid:54) N, fi(p) (cid:54) λi},

y0)−1(Lagy0(ψ)).

so that K(λψ) = (expc
Proposition 4.5. Assume that λ := λψ where ψ belongs to Kε/2 and let p
be a point in K(λ). Then,

Case I: If fi(p) = λi and fj(p) = λj for i (cid:54)= j in {1, . . . , N}, then

(cid:18)

(cid:104)∇fi(p) | ∇fj(p)(cid:105)
(cid:107)∇fi(p)(cid:107)(cid:107)∇fj(p)(cid:107)

(cid:18)

1.

(cid:19)2 (cid:54) 1 − δ2
(cid:19)2 (cid:54) 1 − δ2

1.

Case II: If p ∈ ∂ ˆX and if fi(p) = λi for some i in {1, . . . , N}, then
(4.41)

∀w ∈ Np ˆX,

(cid:104)∇fi(p) | w(cid:105)
(cid:107)∇fi(p)(cid:107)(cid:107)w(cid:107)

In the above inequalities,

δ1 :=

εndδ0

2CexpC∇C2

cond

.

22

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

By assumption, all the Laguerre cells associated to ψ contain a mass of
at least ε/2. This allows us to apply Proposition 4.2, ensuring that normal
vectors cannot be near-opposite, to all the Laguerre cells in their exponential
charts. We denote Li := Lyi(ψ) = (expc

yi)−1(Lagyi(ψ)) for brevity.

The proposition also relies on two simple lemmas. The ﬁrst lemma shows
the eﬀect of a diﬀeomorphism on the normal cone to a convex set, when its
image is also convex.

Lemma 4.6. Let K ⊂ Rd be a compact, convex set, F be a C1 diﬀeomorphism
from an open neighborhood of K to an open subset of Rd, and assume that
F (K) is also a convex set. Then, for any point x in ∂K one has

NF (x)(F (K)) = [DF

∗

−1
F (x)]

(NxK),

where A∗ denotes the adjoint of A.
Proof. Consider x in ∂K, v ∈ NxK, and deﬁne ϕ(z) := (cid:104)F −1(z) − x | v(cid:105).
Since v is an outer normal to K at x, the restriction of ϕ to the set F (K) is
non-positive. Since F (K) is convex, for any point y ∈ K, F (K) contains the
segment [F (x), F (y)]. We therefore have

0 (cid:62) ϕ((1 − t)F (x) + tF (y))
(cid:62) ϕ(F (x)) + t(cid:104)∇ϕ(F (x)) | F (y) − F (x)(cid:105) − o(t)
= t(cid:104)[DF

(v) | F (y) − F (x)(cid:105) − o(t).

−1
F (x)]

∗

−1
F (x)]∗(v) to obtain
where we have used ϕ(F (x)) = 0 and ∇ϕ(F (x)) = [DF
the equality at the end. Dividing by t and taking the limit as t goes to zero,
we see that

∀y ∈ K, (cid:104)[DF

∗

−1
F (x)]

(v) | F (y) − F (x)(cid:105) (cid:54) 0,

thus showing that [DF
The converse inclusion follows from the symmetry of the problem.

−1
F (x)]∗(v) belongs to the normal cone to F (K) at F (x).
(cid:3)

The second lemma compares the angle between two vectors and the angle
between their image under a linear map, using the generalized Wiedlandt
inequality (see [13, Section 3.4]). We identify Rd with its tangent and
cotangent spaces through the Euclidean structure. We denote the adjoint of
the derivative of the exponential map expc

y at a point p in Xy by

(D expc

yi)

∗

∗
|p : T
expc
yi

(p)Ω → T

∗
p

Rd ∼= Rd,

Lemma 4.7. Let yk (cid:54)= y(cid:96) ∈ Y , let x be a point in X and set pk := (expc
and p(cid:96) := (expc

yk )−1(x)

Rd.

∗
Rd → T
pk
(cid:18)

1 + (cid:104)v | w(cid:105)
(cid:107)v(cid:107)(cid:107)w(cid:107)

(cid:19)

.

Then, the following inequalities hold for all v, w in Rd:

◦ [(D expc

∗
yl |pl)

−1 : T
∗
p(cid:96)

]

A = (D expc

y(cid:96))−1(x) and
∗
yk |pk )
(cid:19)

(cid:18)

−4
cond

C

1 + (cid:104)v | w(cid:105)
(cid:107)v(cid:107)(cid:107)w(cid:107)

(cid:54) 1 + (cid:104)Av | Aw(cid:105)
(cid:107)Av(cid:107)(cid:107)Aw(cid:107)

(cid:54) C4

cond

Proof. Indeed, let θ be the angle between v and w and θ(cid:48) be the angle
between Av and Aw, both in the interval (0, π). Let t := tan(θ/2), t(cid:48) :=

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

23

tan(θ(cid:48)/2). The generalized Wiedlandt inequality in [13, Section 3.4] asserts
(1/ cond(A))t (cid:54) t(cid:48) (cid:54) cond(A)t. Expressing cos(θ) in term of t = tan(θ/2),

1 + cos(θ

(cid:48)

) = 1 +

1 − t(cid:48)2
1 + t(cid:48)2 =

2

1 + t(cid:48)2

(cid:54) cond(A)2(1 + cos(θ))

We conclude the second inequality above by using cond(A∗
and the deﬁnition of the constant Ccond. For the ﬁrst inequality, simply note
that cond(A−1) = cond(A).
(cid:3)
Proof of Proposition 4.5, case I. We let

2[A∗

1]−1) (cid:54) cond(A1) cond(A2)

V : = ∇fi(p) = ∇fyi,y0(p),
W : = ∇fj(p) = ∇fyj ,y0(p),
v : =
.

, w :=

W
(cid:107)W(cid:107)

V
(cid:107)V (cid:107)

Switching the indices i and j if necessary, we assume that (cid:107)V (cid:107) (cid:54) (cid:107)W(cid:107). The
proof depends on the sign of (cid:104)W − V | V (cid:105). Assume ﬁrst (cid:104)W − V | V (cid:105) (cid:54) 0,
and let αv := 1/(cid:107)V (cid:107) , αw := 1/(cid:107)W(cid:107). Then,
1 − (cid:104)v | w(cid:105) =
=

2 (cid:107)αw(W − V ) − (αv − αw)V (cid:107)2

2 (cid:107)v − w(cid:107)2 =
w (cid:107)W − V (cid:107)2 +
α2

(αv − αw)2 (cid:107)V (cid:107)2 − αw(αv − αw)(cid:104)W − V | V (cid:105)

1
2

1
2

1

1

Using αw (cid:62) αv, and (cid:107)W − V (cid:107) (cid:62) εnd we end up with

1 − (cid:104)v | w(cid:105)2 (cid:62) 1 − (cid:104)v | w(cid:105) (cid:62) 1
(cid:62)

2

(cid:62) 1
2

ε2
nd
expC2∇

C2

w (cid:107)W − V (cid:107)2
α2
ndδ2
ε2
0

4C2

expC2∇C4

cond

= δ2
1

where we have used (4.37) and (4.38), δ0 (cid:54) 1 and Ccond (cid:62) 1. This establishes
the desired bound when (cid:104)v | w(cid:105) ∈ [0, 1]. In the case (cid:104)v | w(cid:105) ∈ [−1, 0], we can
(cid:62) δ2
apply Proposition 4.2 to show that 1 − (cid:104)v | w(cid:105)2 (cid:62) 1 + (cid:104)v | w(cid:105) (cid:62) δ2
1, thus
establishing the desired bound.
Now suppose (cid:104)W − V | V (cid:105) (cid:62) 0. A slightly tedious computation gives

0

(cid:104)v | w(cid:105)2 = 1 − (cid:107)W − V (cid:107)2
(cid:107)W(cid:107)2 + (cid:104)W − V | v(cid:105)2
(cid:19)
(cid:18)
(cid:107)W(cid:107)2
= 1 − (cid:107)W − V (cid:107)2
1 − (cid:104)W − V | v(cid:105)2
(cid:19)
(cid:18)
(cid:107)W(cid:107)2
(cid:107)W − V (cid:107)2
ε2
(cid:54) 1 −
W − V
nd
(cid:107)W − V (cid:107) | v(cid:105)
1 − (cid:104)
expC2∇

C2

,

(4.42)

where we have used (cid:104)W − V | V (cid:105) (cid:62) 0 with (4.37) and (4.38) to get the last
inequality. We will now apply Proposition 4.2 to the Laguerre cell Li. By
Lemma 4.4, the point pi := (expc
y0(p)) ∈ Xyi belong to Li and the
vectors Vi := ∇fy0,yi(pi) and Wi := ∇fyj ,yi(pi) are both normals to Li at pi.
Proposition 4.2 then shows that the vectors Vi and Wi satisfy

yi)−1(expc

− 1 + δ2

0

(cid:54) (cid:104)Vi | Wi(cid:105)
(cid:107)Vi(cid:107)(cid:107)Wi(cid:107)

.

(4.43)

24

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

(cid:12)(cid:12)pi

∗
)

−1.
]

(cid:18)

We transfer this inequality to the exponential chart of the original point y0
using the linear map

(cid:12)(cid:12)p)

∗

A := ( D expc
y0

◦ [( D expc

yi

(cid:19)

First, note that W − V = AWi and V = −AVi. Applying the generalized
Wiedlandt inequality (Lemma 4.7) and (4.43) we have

1 − (cid:104)W − V | v(cid:105)
(cid:107)W − V (cid:107)

= 1 + (cid:104)AWi | AVi(cid:105)
(cid:107)AWi(cid:107)(cid:107)AVi(cid:107)

(cid:62) C
(cid:62) C

−4
cond
−4
condδ2

0

1 + (cid:104)Vi | Wi(cid:105)
(cid:107)Vi(cid:107)(cid:107)Wi(cid:107)
(cid:62) δ2
1.

(4.44)
Combining this inequality with (4.42) we obtain (4.40) in this case as well. (cid:3)
Proof of Proposition 4.5, case II. Consider V := ∇fi(p) and let W be any
vector in the normal cone Np ˆX. When (cid:104)V | W(cid:105) (cid:54) 0, the inequality directly
follows from Proposition 4.2, ensuring that normal vectors cannot be near-
opposite. We now assume (cid:104)V | W(cid:105) (cid:62) 0 and we will apply Proposition 4.2 to
the Laguerre cell of yi and transfer the result to the exponential chart of the
point y0. Let pi = (expc
y(p)). Then, by Lemma 4.4, pi belongs to
Li and Vi := ∇fy0,yi(pi) is a normal vector to Li at pi. We deﬁne a second
normal vector by considering

yi)−1(expc

∗
A := ( D expc
)
y0
and by setting Wi := A−1W ∈ T∗
Rd. By Lemma 4.6, the vector Wi belongs
to the normal cone to Xyi at pi. Moreover, since Li is contained in Xyi and
both sets contain pi, we have NpiXyi ⊆ NpiLi, thus ensuring that Wi also
belongs to the normal cone to Li at pi. Then, by Proposition 4.2 again,

◦ [( D expc

(cid:12)(cid:12)p0

(cid:12)(cid:12)pi

∗
)

−1

pi

yi

]

(cid:104)Vi | Wi(cid:105)
(cid:107)Vi(cid:107)(cid:107)Wi(cid:107)

(cid:62) −1 + δ2

0.

As before, we transfer this inequality to the exponential chart of the orig-
inal point y using the linear map A. We have V = ∇fi(p) = −AVi, and
by construction W = AWi. We get the desired inequality by applying
Lemma 4.7:

1 − (cid:104)V | W(cid:105)
(cid:107)V (cid:107)(cid:107)W(cid:107)

= 1 + (cid:104)AVi | AWi(cid:105)
(cid:107)AVi(cid:107)(cid:107)AWi(cid:107)

and by recalling that (cid:104)V | W(cid:105) (cid:62) 0.

(cid:62) C
(cid:62) C

−4
cond
−4
condδ2

0

1 + (cid:104)Vi | Wi(cid:105)
(cid:107)Vi(cid:107)(cid:107)Wi(cid:107)
(cid:62) δ2
1,

(cid:3)

4.3. Proof of Theorem 4.1. By Theorem 1.1, the second-diﬀerentiability
of Kantorovich’s functional Φ will follow from the diﬀerentiability of the
function

(cid:19)

(cid:18)

(cid:90)

(cid:90)

Gy0(ψ) :=

Lagy0

(ψ)

ρ(x)dHd

g(x) =

ˆρ(p)dp

Ly(ψ)

where we have used the change-of-variable formula with x = expc
ˆρ is the density of the pushforward measure (expc
the Lebesgue measure. We recall that
K(λψ) = (expc

y0)
−1(Lagy0(ψ)),

−1
# (ρHd

y0)

y0(p), so that
g) with respect to

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

25

so that Gy0(ψ) = ˆG(λψ) (as deﬁned in (3.12)). The diﬀerentiability of ˆG
will be proven using Theorem 3.1 from the previous section.

Let us ﬁx a function ψ0 in Kε and recall that λ0 := λψ0. By Proposition 2.3
there exists a positive constant Ttr such that every function ψ on Y satisfying
(cid:107)ψ − ψ0(cid:107)∞ (cid:54) Ttr belongs to Kε/2. Then, by Proposition 4.5, we see that
the functions fi satisfy the transversality condition (T) on the cube λ0 +
[−Ttr, Ttr]N with constant

εtr = δ1 =

,

(4.45)

εndδ0

2CexpC∇C2

cond

2d diam (X)d). Note also that since
where we recall that δ0 = ε/(2d (cid:107)ρ(cid:107)∞ Cexp
ρ is α-H¨older and since the exponential map is C1,1, the probability density
ˆρ is also α-H¨older with constant
(cid:107)ˆρ(cid:107)C0,α( ˆX)

(cid:54) const((cid:107)ρ(cid:107)C0,α , Cdet).

(4.46)

We can now apply Theorem 3.1. This ensures that the function ˆG is of class
C1,α on the cube λ0 +[−Ttr, Ttr]N , so that ∂Φ/∂1y0 is C1,α on a neighborhood
of ψ0. Since this holds for any point y0 ∈ Y and any function ψ0 in Kε, we
have established the C2,α-regularity of Φ on Kε. The claimed dependency of
(cid:107)Φ(cid:107)C2,α(Kε) follows from equations (4.45)–(4.46) and from Theorem 3.1.
Our goal is now to deduce the formula for the gradient of G given in
Theorem 4.1 (Equation (1.8)), from the formula for the gradient of ˆG given
in Theorem 3.1 (Equation (3.13)). This is done by looking more closely at
y0 : Ω → Rd.
the change of variable induced by the exponential map F := expc
For ease of notation we let h := cy0 − cyi = fi ◦ F −1. By deﬁnition of the

push-forward, we have for any bounded measurable function χ on Ω,

(cid:90)

χ(F (p))ρ(p)dHd(p) =

ˆΩ

χ(x)ˆρ(x)dHd

g(x).

Multiplying χ by the characteristic function of h−1([t, s]), this gives

Ω

(cid:90)
(cid:90)
(cid:90) s

(cid:90)

(cid:90)

(cid:90) s

(cid:90)

f−1

i

([t,s])

χ(F (p))ˆρ(p)dHd(p) =

h−1([t,s])

χ(x)ρ(x)dHd

g(x).

Applying the coarea formula on both sides, we get

t

f−1

i

(r)

χ(F (p))ˆρ(p)
(cid:107)∇fi(p)(cid:107)

dHd−1(p)dr =

t

h−1(r)

χ(x)ρ(x)
(cid:107)∇h(x)(cid:107)g

dHd−1

g

(x)dr.

(cid:90)

(4.47)
Using the C1,1 smoothness of the functions fi and the (Twist) condition, we
can see that for any χ in C0
χ(F (p))ˆρ(p)
(cid:107)∇fi(p)(cid:107)

c (Ω), the two inner integrals

χ(x)ρ(x)
(cid:107)∇h(x)(cid:107)g

r (cid:55)→

dHd−1

g

h−1(r)

(cid:90)

f−1

i

(x)

(r)

depend continuously on r. Using the continuity of these functions in r,
equation (4.47) and the Fundamental Theorem of Calculus, we get that for
any function χ in C0

dHd−1(p) and r (cid:55)→
(cid:90)

(cid:90)

c (Ω) and any r in R,
dHd−1(p) =

χ(F (p))ˆρ(p)
(cid:107)∇fi(p)(cid:107)

f−1

i

(r)

h−1(r)

χ(x)ρ(x)
(cid:107)∇h(x)(cid:107)g

dHd−1

g

(x).

26

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

(cid:90)
(cid:90)

By Tietze’s extension theorem, every function in C0
c (S) can be extended to a
function in C0
c (S),
and by density, it also holds for any function χ in L1(S). Applying this with
χ equal to the indicator function of the interface between the Laguerre cell
of y0 and the cell of yi, we get the desired formula for the partial derivatives:

c (Ω). The previous equality therefore holds for any χ in C0

∂Gi
∂ψi

(ψ) =

∂ ˆG
∂λi

(λψ) =

=

Ly0 (ψ)∩f−1

i

(ψ(yi)−ψ(y0))

ˆρ(p)

(cid:107)∇fi(p)(cid:107)
ρ(x)

dHd−1(p)

Lagy0

(ψ)∩Lagyi

(ψ)

(cid:107)Dcy0(x) − Dcyi(x)(cid:107)g

dHd−1

g

(x).

4.4. Alternative upper transversality estimates. Finally, we state an
alternate upper transversality estimate, under the assumption that the points
in Y are sampled from some target domain Λ, along with some convexity
conditions. Speciﬁcally, let Λ be a bounded, open subset in some Riemannian
∈ Ωcl, the mapping

manifold, with Y ⊂ Λ. We then assume that for any x(cid:48)

y (cid:55)→ −Dxc(x

(cid:48)

, y)

x(cid:48). We
x)−1(Λ) is convex for all x ∈ Ω, and ﬁnally that
x(cid:48))−1(Λ), and

is a diﬀeomorphism onto its range, and we denote the inverse by expc
will also assume that (expc
the following inequality holds: for any x, x(cid:48)
t ∈ [0, 1],
− c(x, expc
(cid:54) max{−c(x, expc

(cid:48)
, expc
x(cid:48)(p0)),−c(x, expc

x(cid:48)((1 − t)p0 + tp1)) + c(x
, expc

∈ Ω, p0, p1 ∈ (expc

x(cid:48)((1 − t)p0 + tp1)))

(cid:48)
x(cid:48)(p1)) + c(x

x(cid:48)(p0)) + c(x

, expc

(cid:48)

x(cid:48)(p1))}
(4.48)

For more on these conditions, see Remark 4.3 below.

Proposition 4.8 can be applied to provide an alternative bound in the
transversality condition (T) when the point p0 ∈ ∂K(λ) is in the interior of
X (so in particular, when dealing with Laguerre cells that do not intersect
∂X). The advantage of this bound is that it does not require knowledge of
the condition number Ccond.

We also slightly re-deﬁne the constants C∇ and Cexp so that in their
deﬁnitions, the maximum of y ranges over the domain Λ instead of just Y .
Proposition 4.8. Suppose (cid:107)λ(cid:107) < Ttr <
, and p0 ∈ K(λ)
with fi(p0) = λi and fj(p0) = λj for i (cid:54)= j in {1, . . . , N}. Then we have

exp (cid:107)ρ(cid:107)∞Hd−1

8C2d−2

(∂X)

ε

(cid:18)

(4.49)

(cid:104)∇fi(p0) | ∇fj(p0)(cid:105)
(cid:107)∇fi(p0)(cid:107)(cid:107)∇fj(p0)(cid:107)
εεnd
exp (cid:107)ρ(cid:107)∞

4√2C2∇C2d+4

δ2 :=

g

(cid:19)2 (cid:54) 1 − δ2
(cid:16)

2

Hd−1

g

(∂X)

(cid:17) .

where

The idea behind this upper bound is the following. First suppose ∇fi(p0)
is shorter than ∇fj(p0) and the two vectors are collinear, and that λ =
0. Inspired by calculations from [12, Remark 2.5, Proof of Lemma 4.7],
this would allow us to use (4.48) to obtain the inequality fi (cid:54) max{0, fj}
everywhere, which in turn would mean that −c(·, yi) + ψ(yi) is less than one

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

27

of −c(·, y0) + ψ(y0) or −c(·, yj) + ψ(yj) everywhere. However, combined with
(Twist), this would imply that the Laguerre cell Lagyi(ψ) has measure zero,
which is a contradiction. In the general case, we rotate ∇fi(p0) so that it
is collinear with ∇fj(p0), and use the lower bound on Lagyi(ψ) to obtain a
quantitative version of the above argument. We relegate the proof of the
proposition to the Appendix in Section C.

Remark 4.3. Under a set of standard conditions, we can obtain both (QC)
and (4.48).

Let Ω and Λ be bounded and smooth domains in d dimensional Riemannian

manifolds and take a cost c ∈ C4(Ω × Λ). Also assume

x : Λx → Λ by expc

• c satisﬁes the (Twist) condition: for every x ∈ Ω, the map y ∈ Λ (cid:55)→
−Dxc(x, y) is a diﬀeomorphism onto its image Λx := −Dxc(x, Λ)
and we deﬁne the c-exponential map expc
x =
(−Dxc(x,·))−1.
• the cost c∗(x, y) := c(y, x) satisﬁes the (Twist) condition: then for
every y ∈ Λ, we can deﬁne the c∗-exponential map expc
y : Ωy → Ω by
expc
• (expc
• (expc
• det D2
• For any (x, y) ∈ Ω × Λ and η ∈ T ∗

y = (−Dyc(·, y))−1.
x)−1(Λ) is convex for each x ∈ Ω.
y)−1(Ω) is convex for each y ∈ Λ.
xyc(x, y) (cid:54)= 0 for all (x, y) ∈ Ω × Λ.

x Ω, V ∈ TxΩ with η(V ) = 0,

−(cij,pq − cij,rcr,scs,pq)cp,kcq,lV iV jηkηl (cid:62) 0,

(A3w)

here indices before a comma are derivatives on Ω and after a comma on Λ,
for ﬁxed coordinate systems, and a pair of raised indices denotes the inverse
of a matrix. This last condition (A3w) originates (in a stronger version)
in [22] related to regularity of optimal transport. [19, Theorem 3.2] in the
Euclidean case and [16, Theorem 4.10] in the general manifold case show
the above conditions imply (QC) and (4.48). In fact, they are equivalent as
seen in [19]. This geometric interpretation is a key ingredient in showing
regularity in the optimal transport problem in the vein of Caﬀarelli’s classical
work [5], see [10, 12].

5. Strong concavity of Kantorovich’s functional

We establish in this section the strong concavity of Kantorovich’s functional
Φ over some suitable domain of RY . As explained in the introduction, Φ is
invariant under addition of a constant, so that we must restrict ourselves to
the orthogonal complement EY of the space of constant functions. Moreover,
we will consider the set Kε deﬁned by (4.32), which can be thought of as the
space of strictly c-concave functions.
Theorem 5.1. Assume (Reg), (Twist), (QC). Let X be a compact, c-convex
subset of Ω, and ρ be a continuous probability density on X satisfying (PW).
Then, there exists a positive constant C, such that

∀ψ ∈ Kε, ∀v ∈ EY , (cid:104)D2Φ(ψ)v | v(cid:105) (cid:54) −C · ε3 (cid:107)v(cid:107)2 ,

where C is deﬁned in (5.58), and depends on (cid:107)ρ(cid:107)∞, Hd−1
C∇, and εtw from Remark 4.1.

g

(∂X), and Cexp,

28

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

Remark 5.1. Note that unlike the domain X, the support of the density ρ
does not need be c-convex. We provide in Appendix A an example of a radial
measure on Rd whose support is an annulus (hence is not simply connected)
but whose Poincar´e-Wirtinger constant (PW) is nonetheless positive.

The end of the section is devoted to the proof of Theorem 5.1. It relies on
the fact that −D2Φ(ψ) can be regarded as the Laplacian matrix of a weighted
graph on Y , whose ﬁrst nonzero eigenvalue can be controlled from below
using the Cheeger constant of the weighted graph. In turn, this weighted
Cheeger constant can be controlled using the Poincar´e-Wirtinger inequality.

5.1. Poincar´e inequality and continuous Cheeger constant. We start
by proving that the ﬁniteness of the Poincar´e-Wirtinger constant of the
weighted domain (X, ρ) implies the positivity of the weighted Cheeger con-
stant, deﬁned in (5.50). In the following, a Lipschitz domain denotes the
closure of an open set with Lipschitz boundary.

Lemma 5.2. Assume (QC) and that X is compact and c-convex. Then

(i) X is a Lipschitz domain,
(ii) for any ψ ∈ K+ and y in Y , Lagy(ψ) ∩ X is a Lipschitz domain.

Proof. By assumption, for any y ∈ Y one can write X = expc
y(Xy) where
Xy is a bounded convex subset of Rd which must have nonempty interior
since it supports an absolutely continuous probability measure. Moreover,
the map expc
y is a diﬀeomorphism, hence bi-Lipschitz. This implies (i), while
(ii) follows from the exact same arguments, remembering that ρ(Lagy(ψ)) >
(cid:3)
0.

Given a Lipschitz domain A of X we denote

(cid:90)

(cid:90)

|∂A|ρ :=

∂A∩int(X)

ρ(x)dHd−1

g

(x) and |A|ρ :=

A∩int(X)

ρ(x)dHd

g(x).

Lemma 5.3. Let X be a compact domain of Ω and ρ in C0(X) be a probability
density with ﬁnite Poincar´e-Wirtinger constant (PW). Then the weighted
Cheeger constant of (X, ρ) is positive, that is

h(ρ) := inf
A⊆X

|∂A|ρ

min(|A|ρ ,|X \ A|ρ)

(cid:62) 2
Cpw

,

(5.50)

where the inﬁmum is taken over Lipschitz domains A ⊆ int(X) whose
boundary has ﬁnite Hd−1

–measure.

g

The proof is based on properties of functions with bounded variation. For
more details on this topic, we refer the reader to [2]. Although the discussion
in the reference is on Euclidean spaces, the relevant results easily extend to
the Riemannian case, as expc
y serves as a global coordinate system on all of
Ω.

Proof. Let A be a Lipschitz domain A of int(X). Since A has a Lipschitz
boundary with ﬁnite area, its indicator function χA has bounded variation in
int(X). By the density theorem [2, Theorem 10.1.2], there exists a sequence

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

29

of C1-functions fn on int(X) that converges to χA in the sense of intermediate
convergence (whose deﬁnition is not important here). By (PW),

(cid:107)fn − Eρ(fn)(cid:107)L1(ρ)

(cid:54) Cpw (cid:107)∇fn(cid:107)L1(ρ) .

Since intermediate convergence is stronger than L1 convergence, the continu-
ity of ρ implies

lim

n→∞(cid:107)fn − Eρ(fn)(cid:107)L1(ρ) = (cid:107)χA − Eρ(χA)(cid:107)L1(ρ) = 2|A|ρ |X \ A|ρ .

g then gives

Ω |DχA|ρdHd

n→∞(cid:107)∇fn(cid:107)L1(ρ)
lim

g converges to (cid:82)

Note that we used the fact that ρ is a probability measure, i.e. ρ(X) = 1.
(cid:82)
Proposition 10.1.2 of [2] implies that the total variation measure |Dfn|
narrowly converges to |DχA|, which with the continuity of ρ implies that
Ω |Dfn|ρdHd
g = |A|ρ. The relation |Dfn| =
(cid:107)∇fn(cid:107)g dHd
(cid:54) |∂A|ρ .

Combining the previous equations together leads to the desired inequality. (cid:3)
5.2. Cheeger constant of a graph. The goal of this section is to give a
lower bound of the second eigenvalue of −D2Φ(ψ) in terms of the Cheeger con-
stant of the weighted graph induced by this matrix. An unoriented weighted
graph can always be represented by its adjacency matrix (wyz)(y,z)∈Y 2, a
symmetric matrix with zero diagonal entries. We introduce a few deﬁnitions
from graph theory, following the conventions of [11].
Deﬁnition 5.1. Let (wyz)(y,z)∈Y 2 be a weighted graph over Y . The (weighted)
z(cid:54)=y wyz. The (weighted) Laplacian is the
matrix (Lyz)(y,z)∈Y 2 whose entries are Lyz = −wyz for y (cid:54)= z and Lyy = dy.
Deﬁnition 5.2. The Cheeger constant of a weighted graph (wyz)(y,z)∈Y 2
over a point set Y is given by

degree of a vertex y is dy := (cid:80)

h(w) := min
S⊆Y

(cid:88)

|∂S|w

,

min(|S|w ,|Y \ S|w)
wyz

and

|S|w :=

(cid:88)

y∈S

dy.

where |∂S|w :=

y∈S,z(cid:54)∈S

The (weighted) Cheeger inequality bounds from below the ﬁrst nonzero
eigenvalue of the Laplacian of a weighted graph, denoted λ(w), from its
Cheeger constant and its minimal degree. The formulation we use can be

deduced from Corollary 2.2 of [11] and from the inequality 1−√1 − x2 (cid:62) x2/2.
Theorem 5.4 (Cheeger inequality). λ(w) (cid:62) 1

2 h2(w) · miny∈Y dy.

We now proceed to the proof of the main theorem of this section.

5.3. Proof of Theorem 5.1. Let ψ be a function in ψ ∈ Kε and consider
the weighted graph (wyz)(y,z)∈Y 2 given by

wyz := −

∂2Φ

∂1y∂1z

(ψ) =

Lagy,z(ψ)

(cid:107)Dcy(x) − Dcz(x)(cid:107)g

ρ(x)

dHd−1

g

(x)

for y (cid:54)= z in Y , and with zero diagonal entries (wyy = 0). In the formula above,
we used the notation Lagy,z(ψ) = Lagy(ψ) ∩ Lagz(ψ) for the facet between

(cid:90)

30

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

two Laguerre cells. By construction, the Laplacian matrix of this weighted
graph is the Hessian matrix −D2Φ(ψ), so that Theorem 5.4 directly gives us
a lower bound on the ﬁrst nonzero eigenvalue of −D2Φ(ψ). To complete the
proof, we need to bound the Cheeger constant and the minimum degree of
the graph w from below.

Step 1. The goal here is to bound from below the discrete Cheeger constant
h(w) in terms of the continuous weighted Cheeger constant h(ρ) and the
constants introduced in (4.33). By deﬁnition of the constants εtw and C∇,
for every y (cid:54)= z in Y , one has

εtw wyz (cid:54) | Lagy,z(ψ)|ρ (cid:54) 2C∇wyz.

(5.51)
Consider a subset S of Y , and let A = ∪y∈S Lagy(ψ). Then, the intersection
of the boundary of A with X is contained an union of facets of Laguerre
cells, namely

∂A ∩ int(X) ⊆

Lagy,z(ψ).

(5.52)

The two inequalities (5.51) and (5.52) imply a lower bound on the numerator
of the Cheeger constant:

(cid:91)
(cid:12)(cid:12)Lagy,z(ψ)

y∈S,z(cid:54)∈S

(cid:12)(cid:12)ρ

(cid:54) (cid:88)

y∈S,z(cid:54)∈S

|∂A|ρ

(cid:54) 2C∇ |∂S|w .

(5.53)

We now need to bound the denominator of the Cheeger constant from above,
which requires us to control the weighted degrees dy. Note that

dy =

wyz (cid:54) 1
εtw

| Lagy,z(ψ)|ρ (cid:54) 1

εtw |∂ Lagy(ψ)|ρ,

(5.54)

(cid:88)

z(cid:54)=y

(cid:88)

z(cid:54)=y

where the second inequality comes from the fact that the facets Lagy,z(ψ)
–negligible
set. To see that this is the case, it suﬃces to remark that in the exponential
chart of y, the intersection of two distinct facets adjacent to y has a ﬁnite

form a partition of the boundary ∂ Lagy(ψ)∩ int(X) up to a Hd−1
Hd−2

g
In order to apply the (continuous) Cheeger inequality, we need to replace
the weighted area of the boundaries of Laguerre cells in (5.54) by the weighted
volume of the cells. We have

–measure, as implied by Lemma 3.4.

g

Hd−1

g

(∂ Lagy(ψ)) (cid:54) Cd−1
(cid:54) Cd−1
(cid:54) C2(d−1)

exp Hd−1((expc
exp Hd−1(∂Xy)
exp Hd−1

g

(∂X).

−1∂ Lagy(ψ))
y)

The ﬁrst and third inequalities use the deﬁnition of the bi-Lipschitz constant
inclusion (see [27, p.211]). Using the assumption(cid:12)(cid:12)Lagy(ψ)(cid:12)(cid:12)ρ
Cexp of the exponential map, while the second inequality uses the monotonic-
ity of the Hd−1–measure of the boundary of a convex set with respect to
(cid:62) ε, this gives
(∂X)(cid:12)(cid:12)Lagy(ψ)(cid:12)(cid:12)ρ

us a (rather crude) reverse isoperimetric inequality

(cid:54) (cid:107)ρ(cid:107)∞ Hd−1
exp Hd−1
C2(d−1)
(cid:54) 1
ε

(cid:12)(cid:12)∂ Lagy(ψ)

(∂ Lagy(ψ))

(cid:12)(cid:12)ρ

(5.55)

g

g

Combining (5.54), (5.55) and |A|ρ =(cid:80)

(cid:12)(cid:12)ρ we obtain

(cid:12)(cid:12)Lagy(ψ)
y∈S
2(d−1)
exp Hd−1

g

εtw

|S|w =

dy (cid:54) 1
ε

(cid:107)ρ(cid:107)∞ C

(∂X)

|A|ρ .

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

31

(cid:88)

y∈S

The same inequality holds for the complement |X \ S|. We combine the
previous inequality with Equation (5.53) and with Lemma 5.3 to get a lower
bound on the Cheeger constant

h(w) (cid:62)

C

εtwε

2(d−1)
exp C∇Hd−1

g

(∂X)(cid:107)ρ(cid:107)∞ Cpw

.

(5.56)

–measure (by Equation (5.55)).

Note that, in order to apply Lemma 5.3 we implicitly used the fact that A is
a Lipschitz domain (as a ﬁnite union of Lipschitz domains, see Lemma 5.2)

whose boundary has ﬁnite Hd−1
(cid:12)(cid:12)∂ Lagy(ψ)

g

Step 2. In order to apply the Cheeger inequality, we still need to bound from
below the weighted degree dy. By (5.51) one has, using the crucial fact that

(cid:12)(cid:12)ρ is the measure of ∂ Lagy(ψ) ∩ int(X),
(cid:88)
(cid:88)
(cid:12)(cid:12)ρ
(cid:12)(cid:12)Lagy,z(ψ)
(cid:12)(cid:12)X \ Lagy(ψ)
(cid:12)(cid:12)ρ ,
(cid:12)(cid:12)Lagy(ψ)
(cid:12)(cid:12)∂ Lagy(ψ)
(cid:12)(cid:12)ρ

wyz (cid:62) 1
2C∇

(cid:62) h(ρ) min(

(cid:62) 1
2C∇

dy =

z(cid:54)=y

z(cid:54)=y

(cid:12)(cid:12)ρ .
(cid:12)(cid:12)∂ Lagy(ψ)
(cid:12)(cid:12)ρ) (cid:62) h(ρ)ε.

Taking A = Lagy(ψ) in the deﬁnition of the Cheeger constant h(ρ), one gets

The last inequality comes from the assumption that each Laguerre cell has
a mass greater than ε and that X \ Lagy(ψ) also contains a Laguerre cell
(except for the trivial case where Y is a singleton). We deduce

dy (cid:62)

ε

C∇Cpw

.

(5.57)

Step 3. Combining the Cheeger inequality with Equation (5.56) and (5.57)
we have λ(w) (cid:62) Cε3 where

C :=

4(d−1)
exp C3∇

2C

(cid:16)

ε2
tw

Hd−1

g

(∂X)

(cid:17)2

.

(5.58)

(cid:107)ρ(cid:107)2∞ C3

pw

Since the graph induced by the Hessian is connected, the kernel of −D2Φ(ψ) is
equal to the space of constant functions over Y , implying that Ker(−D2Φ(ψ))⊥ =
EY . Then, using the variational characterization of the ﬁrst nonzero eigen-
value of the Laplacian matrix we get:

Cε3 (cid:54) λ(w) = min
v∈EY

(cid:104)−D2Φ(ψ) | v(cid:105)

(cid:107)v(cid:107)2

.

(cid:3)

32

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

6. Convergence of the damped Newton algorithm

The goal of this section is to show the convergence of the Damped Newton
algorithm for semi-discrete optimal transport. This follows in fact from
a more general result. We establish in Section 6.1 the convergence of the
damped Newton algorithm (Algorithm 1) under general assumptions on the
functional. We ﬁnally apply this algorithm to the semi-discrete optimal
transport problem, using the intermediate results (regularity and strict
concavity of the Kantorovich functional) proven in Section 4 and 5.

R

R

6.1. General damped Newton algorithm. Let Y be a ﬁnite set and
the space of functions on Y . We consider P(Y ), the space of
denote Y
probability measures on Y , as a subset of Y
. Finally, we denote by EY
the space of functions on Y who sum to zero. In this section, we show that
Algorithm 1 can be used to solve non-linear equations G(ψ) = µ where

µ ∈ P(Y ) and the map G : RY → P(Y ) satisﬁes some regularity and
under addition of a constant. Let G(ψ) =(cid:80)
Proposition 6.1. Let G be a functional from RY to P(Y ) which is invariant

monotonicity assumptions.

y∈Y Gy(ψ)1y and

Kε = {ψ ∈ RY | ∀y ∈ Y, Gy(ψ) (cid:62) ε},

and assume that G has the following properties:

(i) (Regularity) For every positive ε, G is C1,α on Kε. We let Lε be the

smallest constant such that

∀ϕ (cid:54)= ψ ∈ Kε, (cid:107)G(ϕ) − G(ψ)(cid:107)

(cid:107)ϕ − ψ(cid:107)

+ (cid:107)DG(ϕ) − DG(ψ)(cid:107)

(cid:54) Lε.

(cid:107)ϕ − ψ(cid:107)α

(ii) (Uniform monotonicity) For every ε > 0, there exists a positive

constant κε such that G is κε–uniformly monotone on Kε ∩ EY :

∀ψ ∈ Kε,∀v ∈ EY , (cid:104)v | DG(ψ)v(cid:105) (cid:62) κε (cid:107)v(cid:107)2 .

Now, let µ ∈ P(Y ) and let ψ0 be a function on Y such that the constant ε0
2 ε0, 1).
deﬁned in (1.6) is positive. Set κ := min(κ 1
Then, the iterates (ψk) of Algorithm 1 satisfy

2 ε0, 1) and L := max(L 1

1
α L
In addition, as soon as τ k = 1 one has

(cid:33)
(cid:107)G(ψk+1) − µ(cid:107) (cid:54) (1 − τ k/2)(cid:107)G(ψk) − µ(cid:107)

(cid:32)

where τ k := min

1

d

κ1+ 1
α ε
α (cid:107)G(ψk) − µ(cid:107)
(cid:107)G(ψk+1) − µ(cid:107) (cid:54) L(cid:107)G(ψk) − µ(cid:107)1+α

κ1+α

.

, 1

.

(6.59)

In particular, the damped Newton’s algorithm converges globally with linear
speed and locally with superlinear speed (quadratic speed if α = 1).

Proof. We set ε := ε0, L := max(Lε/2, 1) and κ := min(κε/2, 1). First,
2 , the pseudo-inverse DG+(ψ) maps the
we remark that for every ψ ∈ K
subspace EY to itself. The uniform monotonicity of G therefore implies that
(cid:107)DG+(ψ)(cid:107) (cid:54) 1/κ, where (cid:107)·(cid:107) is the operator norm on RY .

ε

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

33

We start by the analysis of a single iteration of the algorithm. We let
ψ := ψk ∈ Kε, deﬁne v := DG(ψ)+(G(ψ) − µ) and ψτ := ψ − τ v. Since
the pseudo-inverse DG+(ψ) is 1/κ-Lipschitz, one has (cid:107)v(cid:107) (cid:54) (cid:107)G(ψ) − µ(cid:107) /κ.
Now let τ1 be the largest time before the curve ψσ leaves Kε/2. In particular,
ψτ1 lies at the boundary of Kε/2, meaning that there must exist a point y in
Y such that Gy(ψτ1) = ε/2. This implies that (cid:107)G(ψτ1) − G(ψ)(cid:107) (cid:62) ε/2, and
using the Lipschitz bound on G we obtain a lower bound on τ1

ε
2

(cid:54) (cid:107)G(ψτ1) − G(ψ)(cid:107) (cid:54) Lτ1 (cid:107)v(cid:107) (cid:54) Lτ1

κ (cid:107)G(ψ) − µ(cid:107) .

This implies that τ1 is necessarily larger than κε/(2L(cid:107)G(ψ) − µ(cid:107)). We now
established that the curve τ (cid:55)→ ψτ remains in Kε/2 before time τ1, implying
that the function τ ∈ [0, τ1] (cid:55)→ G(ψτ ) is uniformly C1,α. Applying Taylor’s
formula we get
G(ψτ ) = G(ψ − τ DG(ψ)+(G(ψ) − µ)) = (1 − τ )G(ψ) + τ µ + R(τ ) (6.60)
where, using v = DG(ψ)+(G(ψ) − µ), and the α-H¨older property for DG

(cid:107)R(τ )(cid:107) =

(DG(ψσ) − DG(ψ))vdσ
τ α+1 (cid:107)v(cid:107)α+1 (cid:54) L(cid:107)G(ψ) − µ(cid:107)(1+α)

κ(1+α)

(cid:54) L

α + 1

τ (1+α)

(6.61)

Gy(ψτ ) (cid:62) (1 − τ )Gy(ψ) + τ µy + Ry(τ ) (cid:62) (1 + τ )ε − (cid:107)R(τ )(cid:107) .

For every y ∈ Y , using that µy (cid:62) 2ε (by (1.6)) and Gy(ψ) (cid:62) ε, one gets
If τ is chosen such that such that (cid:107)R(τ )(cid:107) (cid:54) τ ε we will have Gy(ψτ ) (cid:62) ε for
all points y in Y and therefore ψτ will belong to Kε. Thanks to our estimate
on R(τ ) this will be true provided that

(cid:13)(cid:13)(cid:13)(cid:13)(cid:90) τ

0

(cid:13)(cid:13)(cid:13)(cid:13)

(cid:32)

τ (cid:54) τ2 := min

κ1+ 1
α ε

1
α

τ1,

L

1

α(cid:107)G(ψ) − µ(cid:107)1+ 1

α

(cid:33)

.

Finally we establish the second inequality required by Step 2 of the Algorithm.
To do that, we subtract µ from both sides in (6.60) to obtain

G(ψτ ) − µ = (1 − τ )(G(ψ) − µ) + R(τ ).

(6.62)
2 )(cid:107)G(ψ) − µ(cid:107), it is suﬃcient to establish
2 (cid:107)G(ψ) − µ(cid:107). Using the estimation on (cid:107)R(τ )(cid:107) again, we see

In order to get (cid:107)G(ψτ ) − µ(cid:107) (cid:54) (1− τ
that (cid:107)R(τ )(cid:107) (cid:54) τ
(cid:32)

that it suﬃces to take

(cid:33)

τ (cid:54) τ3 := min

κ1+ 1

α

τ2,

L

1

α(cid:107)G(ψ) − µ(cid:107)2

, 1

.

1
α

Finally, using L (cid:62) 1, κ (cid:54) 1 and (cid:107)G(ψ) − µ(cid:107) (cid:54) d (since G(ψ) and µ are
probability measures), we can establish that τ3 (cid:62) τ k where the value of τ k is
deﬁned in (6.59). This ensures the ﬁrst estimate on the improvement of the
error between two successive steps.
By this ﬁrst estimate, we see that there exists k0 such that τ k = 1 for k (cid:62) k0.
When this happens, one can use (6.62) to get (cid:107)G(ψk+1) − µ(cid:107) (cid:54) (cid:107)R(τ )(cid:107). We
(cid:3)

obtain the second estimate of the theorem by plugging in (6.61).

34

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

6.2. Proof of Theorem 1.5. Proposition 6.1 can be directly applied to the
gradient of the Kantorovich functional, or more precisely to
ρ(Lagy(ψ))1y = ∇Φ(ψ) + µ

(cid:88)

G(ψ) :=

y∈Y

In that case, the set Kε is given by

Kε = {ψ ∈ RY | ∀y ∈ Y, ρ(Lagy(ψ)) (cid:62) ε}.

We have assumed that the probability density ρ is Cα(X) where X is a c-
convex, compact subset of Ω. Then, by Theorem 4.1, for any ε > 0, the map
G is uniformly C1,α over Kε. This ensures that the (Regularity) condition
of Proposition 6.1 is satisﬁed. Furthermore, since we also assumed that ρ
satisﬁes a weighted Poincar´e-Wirtinger inequality, we can apply Theorem 5.1
to see that the (Uniform monotonicity) hypothesis of Proposition 6.1 is also
satisﬁed. Applying Proposition 6.1, we deduce the desired convergence rates
for Algorithm 1.

6.3. Numerical results. We conclude the article with a numerical illustra-
tion of this algorithm, for the cost c(x, y) = (cid:107)x − y(cid:107)2 and for a piecewise-linear

density. The source density is piecewise-linear over a triangulation of [0, 3]
with 18 triangles (displayed in Figure 6.3). It takes value 1 on the boundary
∂[0, 3]2 and vanishes on the square [1, 2]2. In particular, the support of this
density is not simply connected and not convex. The target measure is uni-
form over a uniform grid 1
n−1{0, . . . , n − 1}2. Figure 6.3 displays the iterates
of the Newton algorithm, which in this case takes 25 iterations to solve the
optimal transport problem with an error equal to the numerical precision of
the machine. The source code of this algorithm is publicly available1.
We ﬁnally note that recent progress in computational geometry would
allow one to implement Algorithm 1 for the quadratic cost on R3, reﬁning
[18] or [9]. It should also be possible to deal with optimal transport problems
arising from geometric optics, such as the far-ﬁeld reﬂector problem [7],
whose associated cost satisﬁes the Ma-Trudinger-Wang condition [20].

Appendix A. A weighted Poincar´e-Wirtinger inequality

In this section, we provide an (almost) explicit example of a probability
density on Rd whose support is an annulus, therefore not simply connected,
but which still satisﬁes a weighted Poincar´e-Wirtinger inequality.
Proposition A.1. Let 0 < r < R and assume that ρ ∈ C0([0, R]) is a
probability density with ρ = 0 on [0, r] and ρ concave on [r, R]. Consider

ρ(x) =

1

(cid:107)x(cid:107)d−1 ωd−1

ρ((cid:107)x(cid:107))

over

X := B(0, R) ⊆ Rd,

where ωd−1 is the volume of the unit sphere Sd−1. Then, ρ satisﬁes the
weighted Poincar´e-Wirtinger inequality (PW) for some positive constant.

1https://github.com/mrgt/PyMongeAmpere

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

35

Figure 4. Evolution of the Laguerre cells during the exe-
cution of the damped Newton algorithm for semi-discrete
optimal transport. (Top) The source density ρ is piecewise
linear over the domain X = [0, 3]3 over the displayed tri-
angulation: it takes value 1 on the boundary of the square
[0, 3]2 and 0 on the boundary of [1, 2]2. The target measure is
uniform over a 302 uniform grid in [0, 1]2. (Bottom) Laguerre
cells at steps k = 0, 2, 6, 9, 12, 15, 18, 21 and 25.

The proof relies on two L1-Poincar´e-Wirtinger inequalities. The ﬁrst
inequality is the usual Poincar´e-Wirtinger inequality on the sphere: given a

Sd−1 f (z)dz,

C1 function f on Sd−1, and Fd−1 := (1/ωd−1)(cid:82)
(cid:90)
Sd−1 (cid:107)∇f (z)(cid:107) dHd−1(z)

(cid:90)
Sd−1 |f (z) − Fd−1| dHd−1(z) (cid:54) cd

(A.63)

36

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

for some positive constant cd. The second inequality is a Poincar´e-Wirtinger
inequality on the segment [0, R] weighted by ρ. Given a function in C1([0, R]),

and letting F1 :=(cid:82) R
0 f (r)ρ(r)dr/(cid:82) R
(cid:90) R
(cid:12)(cid:12)f (r) − F1

(cid:12)(cid:12) ρ(r)dr (cid:54) cρ

0 ρ(r)dr,

0

(cid:90) R

0

(cid:12)(cid:12)(cid:12) ρ(r)dr

(cid:12)(cid:12)(cid:12)f

(cid:48)

(A.64)

(r)

for some positive constant cρ depending only on ρ. The inequality (A.64) can
be deduced from Theorem 2.1 in [1] and from the concavity of ρ on [r, R].

Proof. We now proceed to the proof of the Poincar´e-Wirtinger inequality for

(X, ρ). Let f : B(0, R) → R be a function of class C1. By polar coordinates

and the deﬁnition of ρ, one has

(cid:90)
(cid:90) R

F :=

B(0,R)

f (x)ρ(x)dHd(x)
1

(cid:90)

(cid:90) R

0

=

ωd−1rd−1

f (r)ρ(r)dr,
where the function f (r) is the mean value of f over the sphere Sd−1(r),
f (rz)dHd−1(z).

f (z)ρ(r)dHd−1(z)dr =
(cid:90)

f (z)dHd−1(z) =

ωd−1rd−1

Sd−1(r)

f (r) =

ωd−1

(cid:90)

Sd−1

Sd−1(r)

1

1

0

Using the triangle inequality and the relation between ρ and ρ we get

(cid:90) R
(cid:90)
(cid:90) R
(cid:90) R
B(0,R) |f (x) − F| ρ(x)dHd(x) =
(cid:54)

0

ρ(r)

(cid:90)
Sd−1(r) |f (z) − F| ρ(z)dHd−1(z)dr
(cid:12)(cid:12) dHd−1(z)dr

(cid:12)(cid:12)f (z) − f (r)

(cid:90)

Sd−1(r)

ρ(r)

rd−1ωd−1

We ﬁrst deal with the second term of the sum. Using the Poincar´e-Wirtinger
inequality on the sphere (A.63), we have

(A.65)

(cid:90)
Sd−1(r) (cid:107)∇f (z)|z⊥(cid:107) dHd−1(z),

0

(cid:90)

Sd−1(r)

0

(cid:12)(cid:12) dr +

(cid:12)(cid:12)f (r) − F
(cid:12)(cid:12)f (z) − f (r)(cid:12)(cid:12) dHd−1(z) (cid:54) cd
(cid:90)

(cid:90) R

⊥, so that

where ∇f (z)|z⊥ is the orthogonal projection of the gradient on the tangent
plane {z}
ρ(r)

(cid:12)(cid:12)f (z) − f (r)(cid:12)(cid:12) dHd−1(z) (cid:54) cd

(cid:90)
B(0,r) (cid:107)∇f (x)|x⊥(cid:107) ρ(x)dHd(x).

rd−1ωd−1

Sd−1(r)

0

(A.66)
By the calculation of F above, we see F is also the mean value of f weighted
by ρ. We can therefore control the ﬁrst term of the upper bound of (A.65)
using the Poincar´e-Wirtinger inequality on the segment (A.64):

(cid:90) R

ρ(r)(cid:12)(cid:12)f (r) − F(cid:12)(cid:12) dr (cid:54) cρ
(cid:90)

1

(cid:90) R

0

(cid:12)(cid:12)(cid:12)f

(cid:12)(cid:12)(cid:12) ρ(r)dr.

(cid:48)

(r)

f (r + h) − f (r)

h

= lim
h→0

ωd−1

Sd−1

f ((r + h)z) − f (rz)

h

dHd−1(z),

0
Now, notice that:
(cid:48)

f

(r) = lim
h→0

(cid:12)(cid:12)(cid:12) dHd−1(z)

from which we deduce

Integrating this inequality shows that

(cid:48)

(cid:12)(cid:12)(cid:12)f
(cid:90) R

(r)

0

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

37

(rz)

∂r

Sd−1

ωd−1

(cid:12)(cid:12)(cid:12)(cid:12) ∂f
(cid:90)
(cid:12)(cid:12)(cid:12) (cid:54) 1
(cid:12)(cid:12)f (r) − F
(cid:12)(cid:12) dr (cid:54) cρ
(cid:12)(cid:12)(cid:12)(cid:12)(cid:104)∇f (x) |

= cρ

ρ(r)

x

1

ρ(r)

z
r(cid:105)

Sd−1(r)

ωd−1rd−1

(cid:12)(cid:12)(cid:12)(cid:12) dHd−1(z) =
(cid:90)
(cid:12)(cid:12)(cid:12)(cid:104)∇f (z) |
(cid:90) R
(cid:90)
(cid:12)(cid:12)(cid:12) dHd−1(z)
(cid:12)(cid:12)(cid:12)(cid:104)∇f (z) |
(cid:12)(cid:12)(cid:12)(cid:12)(cid:104)∇f (x) |
(cid:12)(cid:12)(cid:12)(cid:12) ρ(x)dHd(x).
(cid:90)
(cid:12)(cid:12)(cid:12)(cid:12) + (cid:107)∇f (x)|x⊥(cid:107) (cid:54) √2(cid:107)∇f (x)(cid:107) .

ωd−1rd−1

(cid:107)x(cid:107)(cid:105)

Sd−1(r)

z
r(cid:105)

B(0,R)

x

0

(A.67)

From the simple inequality (a + b)2 (cid:54) 2(a2 + b2), we get

(cid:107)x(cid:107)(cid:105)

Using the bounds (A.66) and (A.67) in Equation (A.65), we get the desired
inequality:

(cid:90)
B(0,R) |f (x) − F| ρ(x)dHd(x) (cid:54) √2(cd + cρ)

(cid:90)
B(0,R) (cid:107)∇f (x)(cid:107) ρ(x)dHd(x).
(cid:3)

Appendix B. Measure of singular points on convex sets

Let K be a convex compact set of Rd. The normal cone to K at a point

x in K is the set

NxK = {v ∈ Rd | ∀y ∈ K, (cid:104)y − x | v(cid:105) (cid:54) 0},

(B.68)

and its elements are said to be normal to K at x. Let τ be a positive
parameter. A point x in the boundary of K is τ -singular if there exist two

unit vectors u, v in its normal cone NxK such that (cid:104)u | v(cid:105)2 (cid:54) 1 − τ 2. Note

in particular that if x is τ -singular, the linear space spanned by its normal
cone has dimension two or more. Given a parameter τ > 0, we consider the
set of τ -singular points

Sing(K, τ ) := {x ∈ ∂K | ∃u, v ∈ Nx(K) ∩ Sd−1, (cid:104)u | v(cid:105)2 (cid:54) 1 − τ 2}. (B.69)
The next proposition gives an upper bound on the (d− 2)–Hausdorﬀ measure
of Sing(K, τ ). Note that a more general version of this result can be found in
[14], with optimal constant that depends on Minkowski’s quermassintegrals.
We provide below a straightforward and easy proof based on the notions of
packing and covering numbers.
Proposition B.1. Let K be a convex, compact set of Rd. Then

1
τ
where the constant depends on d and the diameter of K.

Hd−2(Sing(K, τ )) (cid:54) const(d, diam(K))

,

Before giving the proof of this proposition, we recall that the covering

number Cov(K, η) of a subset K ⊆ Rd is the minimum number of Euclidean

balls of radius η required to cover K. The packing number of a subset K is
given by

Pack(K, η) := max{Card(X) | X ⊆ K and ∀x (cid:54)= y ∈ X,(cid:107)x − y(cid:107) (cid:62) η}.

38

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

We will use the following comparisons between covering and packing numbers:

Cov(K, η) (cid:54) Pack(K, η) (cid:54) Cov(K,

η
2

).

(B.70)

Proof. The proof consists in comparing a lower bound and an upper bound
of the packing number of the set

U := {(x, n) ∈ Rd × Sd−1 | x ∈ Sing(K, τ ) and n ∈ Nx(K)}.

Step 1. We ﬁrst calculate an upper bound on the covering number of the

unit bundle UK := {(x, n) ∈ ∂K × Sd−1 | n ∈ NxK}. Given a positive
radius r, we denote by Kr the set of points that are within distance r of
K. By convexity, the projection map pK : Rd → K, mapping a point to its

orthogonal projection on K, is well deﬁned and 1-Lipschitz. We consider

(cid:18)
π : ∂Kr → U(K)

x (cid:55)→

pK(x),

x − pK(x)
(cid:107)x − pK(x)(cid:107)

(cid:112)

(cid:19)

(cid:17)

.

1 + 4/r2. We
The map π is surjective and has Lipschitz constant L :=
deduce an upper bound on covering number of UK from the covering number
of the level set ∂Kr:

(cid:16)

Cov(U(K), ε) (cid:54) Cov

∂Kr,

ε
L

Now, consider a sphere S with diameter 2 diam(K) that encloses the tubular
neighborhood Kr with r := diam(K). The projection map pKr is 1-Lipschitz,
and pKr (S) = ∂Kr. Using the same argument as above, we have:

Cov (∂Kr, η) (cid:54) Cov(S, η) (cid:54) const(d) · (diam(K)/η)d−1.
Combining these bounds with the inclusion U ⊆ U(K) gives us

Cov(U, ε) (cid:54) const(d, diam(K))

εd−1

.

(B.71)

Step 2. We now establish a lower bound for Pack(U, 2ε). Let x be a τ -

singular point and u, v be two unit vectors such that (cid:104)u | v(cid:105)2 (cid:54) 1 − τ 2. This
implies that NxK ∩ Sd−1 contains a spherical geodesic segment of length at
least const· τ , giving us a lower bound on the packing number of NxK ∩Sd−1,
namely Pack(NxK ∩ Sd−1, η) (cid:62) const · τ /η. Now, let X be a maximal set
in the deﬁnition of the packing number Pack(Sing(K, τ ), 2ε) and for every
x ∈ X, let Yx be a maximal set in the deﬁnition of the packing number
Pack(Nx(K) ∩ Sd−1, 2ε), so that Card(Yx) (cid:62) const · τ /ε. Then, the set
Z := {(x, y) | x ∈ X, y ∈ Yx} is a 2ε packing of U , and the cardinality of
this set is bounded from below by const · Card(X) · τ /ε. This gives

Pack(U, 2ε) (cid:62) const · Pack(Sing(K, τ ), 2ε) · τ /ε.

(B.72)

Step 3. Combining Equations (B.71), (B.72) and the comparison between
packing and covering numbers (B.70), we get

Pack(Sing(K, τ ), 2ε) (cid:54) const(d, diam(K))

τ εd−2

.

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

39

Using the comparison between packing and covering numbers, this means
that we can cover Sing(K, τ ) with Nε balls of radius ε, such that Nε (cid:54)
const(d, diam(K))/(τ εd−2). By deﬁnition of the Hausdorﬀ measure, we have
(cid:3)

Nεεd−2 (cid:54) const(d, diam(K))

Hd−2(Sing(K, τ )) (cid:54) lim inf
ε→0

1
τ

.

Appendix C. Alternate proof of upper transversality

Here we provide the proof of the alternative upper transversality estimate

in Section 4.4.

Proof of Proposition 4.8. Let us again write

V : = ∇fi(p0),
W : = ∇fj(p0),
v : =

V
(cid:107)V (cid:107)

, w :=

W
(cid:107)W(cid:107)

,

and assume εnd < (cid:107)V (cid:107) (cid:54) (cid:107)W(cid:107) and (cid:104)v | w(cid:105) > 0. Let us also deﬁne

y0(p0),

x0 : = expc
q0 : = −Dxc(x0, y0),

q1 := −Dxc(x0, yj).

A quick calculation yields

q0 = [(D expc
q1 = [(D expc

∗
y0 |p0)
∗
y0 |p0)

−1(−∇pc(expc
−1(W ) + q0.

y0(p0), y0)),

]

]

Now we deﬁne the point

(cid:48)

q

∗

:= [(D expc

−1((cid:107)V (cid:107) w + q0),
since (cid:107)V (cid:107) (cid:54) (cid:107)W(cid:107), the above calculation yields that q(cid:48) lies on the line
x0)−1(Λ) is convex we have that
segment between q0 and q1; since (expc
q(cid:48)
∈ (expc
Thus we can deﬁne

x0)−1(Λ) as well.

y0 |p0)

]

),

(cid:48)
i : = expc
y

(cid:48)
x0(q
fi(cid:48)(p) : = −c(expc
and by (4.48) we will obtain for all p ∈ (expc

(cid:48)
i) + c(expc

y0(p), y

y0(p0), y

y0(p), y0) + c(expc
y0)−1(Ω),
fi(cid:48)(p) − λi (cid:54) max{0, fj(p) − λj},
−1(V ) + q0).
]

∗

)

(cid:12)(cid:12)p0

while another quick calculation yields
x0([( D expc
y0

yi = expc

(cid:48)
i) + c(expc

(cid:13)(cid:13)(cid:13)( D expc

y0(p), yi)|

(cid:12)(cid:12)q)

x0

∗

(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)(cid:13)[( D expc

y0

(−Dyc(x, expc

x0(q)))

)−1(Λ)

Now note that
|−c(expc
(cid:54)

y0(p), y

sup
(x,q)∈Ω×(expc
x0

(cid:54) C∇C2

exp (cid:107)(cid:107)V (cid:107) w − V (cid:107) ,

(cid:48)
i) − c(expc

y0(p0), y0) + λi,

(C.73)

(cid:12)(cid:12)p0

∗
)

]

−1((cid:107)V (cid:107) w − V )

(cid:13)(cid:13)(cid:13)

(cid:12)(cid:12)q)∗ = D expc

y

(cid:12)(cid:12)−Dxc(x0,y).

40

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

where we have used that if y = expc
As a result we obtain

x0(q), then ( D expc
x0

y0(p), yi)|2

|fi(cid:48)(p) − fi(p)|2 = |−c(expc
(cid:54) (C∇C2
= 2(C∇C2
(cid:54) 2(C∇C2

(cid:48)
i) + c(expc
y0(p), y
exp)2 (cid:107)V − (cid:107)V (cid:107) w(cid:107)2
exp)2 (cid:107)V (cid:107)2 (1 − (cid:104)v | w(cid:105))
exp)2(CexpC∇)2(1 − (cid:104)v | w(cid:105)).
(cid:112)
y0)−1(Ω),
Combining with (C.73) we then have for any p ∈ (expc
expC2∇

fi(p) − λi (cid:54) max{0, fj(p) − λj} + √2C3

1 − (cid:104)v | w(cid:105)

or re-arranging and using that (cid:107)λ(cid:107) < Ttr,

sup
p∈(expc
y0

(fi(p) − max{0, fj(p)} − 2Ttr)2

1 − (cid:104)v | w(cid:105) (cid:62)
We now make the following observation. Let us write Xi := (expc
Then for any t, s > 0, we can estimate the volume of Xi ∩ {fy0,yi
{fyj ,yi

(cid:54) −s} by

expC2∇)2

)−1(Ω)

2(C3

.

(C.74)

yi)−1(X).
(cid:54) −t} ∩

(cid:1)
(cid:1)
(cid:54) −t} ∩ {fyj ,yi
(cid:54) −s}
(cid:1) .
(cid:54) 0} ∩ {fyj ,yi
(cid:54) 0}
(cid:54) 0}
(cid:54) 0}, we can bound the ﬁrst term from
(cid:54) 0}∩{fyj ,yi

− Hd (Xi ∩ {−t < fy0,yi

(cid:54) 0})

Hd(cid:0)Xi ∩ {fy0,yi
(cid:62) Hd(cid:0)Xi ∩ {fy0,yi
− Hd(cid:0)Xi ∩ {−s < fyj ,yi
Hd(cid:0)Xi ∩ {fy0,yi

Using that Li ⊂ {fy0,yi
below as

(cid:1) (cid:62)
(cid:54) 0}

ε

Cd
exp (cid:107)ρ(cid:107)∞

.

For the second term, by the coarea formula, we can write

(cid:90)

(cid:54) 0} ∩ {fyj ,yi
(cid:90) 0
(cid:54) tHd−1(∂Xi)

−t

εnd

1

dHd−1(p)dz

Xi∩{fy0,yi =z}

(cid:107)∇fy0,yi(p)(cid:107)
exp Hd−1

(cid:54) tCd−1

(∂X)

,

g
εnd

Hd (Xi ∩ {−t < fy0,yi

(cid:54) 0}) (cid:54)

where to obtain the second line we have again used the fact that for every

z ∈ R, the set Xi ∩ {fy0,yi = z} is contained in the boundary of a convex

subset of Xi in conjunction with [17, Remark 5.2]. By a similar bound on
the third term, we see that as long as

we have

max{t, s} <

Hd(cid:0)Xi ∩ {fy0,yi

εεnd

2C2d−2
exp (cid:107)ρ(cid:107)∞ Hd−1

g

(cid:54) −t} ∩ {fyj ,yi
c), fyj ,yi(p(cid:48)

(∂X)

(cid:1) > 0,
(cid:54) −s}
c)} (cid:54) −

thus in particular, (by continuity of fy0,yi and fyj ,yi) there must exist a
point p(cid:48)
.

c ∈ Xi for which max{fy0,yi(p(cid:48)

exp (cid:107)ρ(cid:107)∞Hd−1

2C2d−2

(∂X)

εεnd

g

A NEWTON ALGORITHM FOR SEMI-DISCRETE OPTIMAL TRANSPORT

41

0)−1(X) and in terms of fi, fj,

Translating this back into coordinates in (expc
we see there exists a point pc ∈ (expc
fi(pc) − max{0, fj(pc)} (cid:62)
exp (cid:107)ρ(cid:107)∞Hd−1

Thus if we have Ttr (cid:54)
obtain the bound (4.49) as desired.

8C2d−2

0)−1(X) for which
εεnd
2C2d−2
exp (cid:107)ρ(cid:107)∞ Hd−1

g

εεnd

.

(∂X)

g

(∂X)

, combining with (C.74) we will
(cid:3)

References

1. Gabriel Acosta and Ricardo G Dur´an, An optimal poincar´e inequality in L1 for convex

domains, Proceedings of the American Mathematical Society (2004), 195–202.

2. Hedy Attouch, Giuseppe Buttazzo, and G´erard Michaille, Variational analysis in

sobolev and bv spaces: applications to pdes and optimization, vol. 17, Siam, 2014.

3. F. Aurenhammer, F. Hoﬀmann, and B. Aronov, Minkowski-type theorems and least-

squares clustering, Algorithmica 20 (1998), no. 1, 61–76.

4. Jean-David Benamou, Brittany D Froese, and Adam M Oberman, Numerical solution
of the optimal transportation problem using the monge–ampere equation, Journal of
Computational Physics 260 (2014), 107–126.

5. Luis A. Caﬀarelli, The regularity of mappings with a convex potential, J. Amer. Math.

Soc. 5 (1992), no. 1, 99–104. MR 1124980 (92j:35018)

6. Luis A Caﬀarelli, Sergey A Kochengin, and Vladimir I Oliker, Problem of reﬂector
design with given far-ﬁeld scattering data, Monge Amp`ere Equation: Applications to
Geometry and Optimization: NSF-CBMS Conference on the Monge Amp`ere Equa-
tion, Applications to Geometry and Optimization, July 9-13, 1997, Florida Atlantic
University, vol. 226, American Mathematical Soc., 1999, p. 13.

7. Pedro Machado Manhaes De Castro, Quentin M´erigot, and Boris Thibert, Intersection
of paraboloids and application to minkowski-type problems, Proceedings of the thirtieth
annual symposium on Computational geometry, ACM, 2014, p. 308.

8. Fernando de Goes, Katherine Breeden, Victor Ostromoukhov, and Mathieu Desbrun,
Blue noise through optimal transport, ACM Transactions on Graphics (TOG) 31 (2012),
no. 6, 171.

9. Fernando de Goes, Corentin Wallez, Jin Huang, Dmitry Pavlov, and Mathieu Des-
brun, Power particles: an incompressible ﬂuid solver based on power diagrams, ACM
Transactions on Graphics (TOG) 34 (2015), no. 4, 50.

10. Alessio Figalli, Young-Heon Kim, and Robert J. McCann, H¨older continuity and
injectivity of optimal maps, Arch. Ration. Mech. Anal. 209 (2013), no. 3, 747–795.
MR 3067826

11. Shmuel Friedland and Reinhard Nabben, On cheeger-type inequalities for weighted

graphs, Journal of Graph Theory 41 (2002), no. 1, 1–17.

12. Nestor Guillen and Jun Kitagawa, On the local geometry of maps with c-convex
potentials, Calc. Var. Partial Diﬀerential Equations 52 (2015), no. 1-2, 345–387.
MR 3299185

13. Alston S. Householder, The theory of matrices in numerical analysis, Dover Publica-

tions, Inc., New York, 1975, Reprint of 1964 edition. MR 0378371 (51 #14539)

14. Daniel Hug, Generalized curvature measures and singularities of sets with positive

reach, Forum Mathematicum 10 (1998), no. 6, 699–728.

15. Young-Heon Kim and Jun Kitagawa, On the degeneracy of optimal transportation,

Communications in Partial Diﬀerential Equations 39 (2014), no. 7, 1329–1363.

16. Young-Heon Kim and Robert J. McCann, Continuity, curvature, and the general
covariance of optimal transportation, J. Eur. Math. Soc. (JEMS) 12 (2010), no. 4,
1009–1040. MR 2654086 (2011f:49071)

17. Jun Kitagawa, An iterative scheme for solving the optimal transportation problem,
Calculus of Variations and Partial Diﬀerential Equations 51 (2014), no. 1-2, 243–263.
18. Bruno L´evy, A numerical algorithm for L2 semi-discrete optimal transport in 3d,

ESAIM M2AN 49 (2015), no. 6.

42

JUN KITAGAWA, QUENTIN M´ERIGOT, AND BORIS THIBERT

19. Gr´egoire Loeper, On the regularity of solutions of optimal transportation problems,

Acta mathematica 202 (2009), no. 2, 241–283.

20.

, Regularity of optimal maps on the sphere: the quadratic cost and the reﬂec-
tor antenna, Arch. Ration. Mech. Anal. 199 (2011), no. 1, 269–289. MR 2754343
(2011j:49081)

21. Gr´egoire Loeper and Francesca Rapetti, Numerical solution of the monge–amp`ere
equation by a newton’s algorithm, Comptes Rendus Mathematique 340 (2005), no. 4,
319–324.

22. Xi-Nan Ma, Neil S Trudinger, and Xu-Jia Wang, Regularity of potential functions of
the optimal transportation problem, Archive for rational mechanics and analysis 177
(2005), no. 2, 151–183.

23. Quentin M´erigot, A multiscale approach to optimal transport, Computer Graphics

Forum 30 (2011), no. 5, 1583–1592.

24. Jean-Marie Mirebeau, Discretization of the 3d monge-ampere operator, between wide

stencils and power diagrams, arXiv preprint arXiv:1503.00947 (2015).

25. VI Oliker and LD Prussner, On the numerical solution of the equation and its dis-

cretizations, i, Numerische Mathematik 54 (1989), no. 3, 271–293.

26. Louis-Philippe Saumier, Martial Agueh, and Boualem Khouider, An eﬃcient numerical
algorithm for the l2 optimal transport problem with periodic densities, IMA Journal of
Applied Mathematics 80 (2015), no. 1, 135–157.

27. Rolf Schneider, Convex bodies: The brunn–minkowski theory, Cambridge University

Press, 1993.

28. Neil S. Trudinger and Xu-Jia Wang, On the second boundary value problem for Monge-
Amp`ere type equations and optimal transportation, Ann. Sc. Norm. Super. Pisa Cl. Sci.
(5) 8 (2009), no. 1, 143–174. MR 2512204 (2011b:49121)

29. C. Villani, Optimal transport: old and new, Springer Verlag, 2009.

Department of Mathematics, Michigan State University

Universit´e Paris-Dauphine, PSL Research University, CNRS, UMR 7534,

CEREMADE, 75016 Paris, France and Mokaplan, Inria

Laboratoire Jean Kuntzmann, Universit´e Grenoble Alpes

