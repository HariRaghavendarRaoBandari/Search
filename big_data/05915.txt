6
1
0
2

 
r
a

 

M
8
1

 
 
]
P
A

.
t
a
t
s
[
 
 

1
v
5
1
9
5
0

.

3
0
6
1
:
v
i
X
r
a

Submitted to the Annals of Applied Statistics
arXiv: arXiv:0000.0000

MSIQ: JOINT MODELING OF MULTIPLE RNA-SEQ

SAMPLES FOR ACCURATE ISOFORM QUANTIFICATION

By Wei Vivian Li‡,∗, Anqi Zhao§, Shihua Zhang¶,†

and Jingyi Jessica Li‡,∗,†

University of California, Los Angeles‡, Harvard University§ and Chinese

Academy of Sciences¶

Next-generation RNA sequencing (RNA-seq) technology has been
widely used to assess full-length RNA isoform abundance in a high-
throughput manner. RNA-seq data oﬀer insight into gene expression
levels and transcriptome structure, enabling us to better understand
the regulation of gene expression and fundamental biological pro-
cesses. Accurate quantiﬁcation of RNA isoforms from RNA-seq data
is a challenging computational task due to the information loss in
sequencing experiments. Recent accumulation of multiple RNA-seq
data sets from the same biological condition provides new opportuni-
ties to improve the isoform quantiﬁcation accuracy. However, existing
statistical or computational methods for multiple RNA-seq samples
either pool the samples into one sample or assign equal weights to
the samples in estimating isoform abundance. These methods ignore
the possible heterogeneity in the quality and noise levels of diﬀerent
samples, and could have biased and unrobust estimates. In this arti-
cle, we develop a method named “joint modeling of multiple RNA-
seq samples for accurate isoform quantiﬁcation” (MSIQ) for more
accurate and robust isoform quantiﬁcation, by integrating multiple
RNA-seq samples under a Bayesian framework. Our method aims
to (1) identify the informative group of samples with homogeneous
quality and (2) improve isoform quantiﬁcation accuracy by jointly
modeling multiple RNA-seq samples with more weights on the infor-
mative group. We show that MSIQ provides a consistent estimator
of isoform abundance, and demonstrate the accuracy and eﬀective-
ness of MSIQ compared to alternative methods through simulation
studies on D. melanogaster genes. We justify MSIQ’s advantages over
existing approaches via application studies on real RNA-seq data of
human embryonic stem cells and brain tissues. We also perform a
comprehensive analysis on how the isoform quantiﬁcation accuracy
would be aﬀected by RNA-seq sample heterogeneity and diﬀerent
experimental protocols.

∗Equal contribution.
†Corresponding authors. Please send email correspondence to jli@stat.ucla.edu or

zsh@amss.ac.cn.

MSC 2010 subject classiﬁcations: Primary 97K80; secondary 47N30
Keywords and phrases: isoform abundance estimation, joint inference from multiple
samples, RNA sequencing, Bayesian hierarchical models, Gibbs sampling, data hetero-
geneity

1

2

W. LI ET AL.

1. Introduction. Transcriptomes are complete sets of RNA molecules
in biological samples. Unlike the genome that is largely invariant in diﬀerent
tissues and cells of the same individual, transcriptomes can vary greatly and
cause diﬀerent tissue and cell phenotypes. Understanding transcriptomes is
essential for interpreting genome functions and investigating molecular bases
for various disease phenomena. In transcriptomes, the most important com-
ponents are messenger RNA (mRNA) transcripts, as they will be translated
into proteins—the key functional units in most biological processes. During
the transcription process from genes to mRNA transcripts, one gene may
give rise to multiple mRNA transcripts with diﬀerent nucleotide sequences,
thus resulting in the diversity of transcriptomes. mRNA transcripts from the
same gene are often referred to as isoforms, which are diﬀerent combinations
of whole or partial exons (i.e., genomic regions as contiguous parts of genes
that will be transcribed into RNA molecules).

Transcriptomics is an emerging ﬁeld to study transcriptomes and one of
its primary goals is to quantify the dynamic expression levels of mRNA
isoforms under diﬀerent biological conditions. For common species (e.g.,
human, mice, drosophila, etc.), extant gene annotations record a large num-
ber of mRNA isoforms reported by previous literature. For example, UCSC
genome browser (Kent et al., 2002), GENCODE (Harrow et al., 2012) and
RefSeq (Pruitt et al., 2014) contain known mRNA isoform structures in
transcriptomes of human and several other species. However, the annota-
tions lack gold standard abundance information of these isoforms. In many
biological studies, investigating the diﬀerential expression of isoforms across
diﬀerent biological conditions is an important screening step to discover
potential isoform markers for speciﬁc phenotypes (Goedert et al., 1989). For
example, diﬀerent isoforms are often diﬀerentially expressed across diﬀerent
developmental stages, tissue or cell types, and disease conditions. Hence,
how to accurately estimate isoform abundance becomes a key question.

Over the past decade, next-generation RNA sequencing (RNA-seq) tech-
nologies have generated numerous data sets with unprecedented nucleotide-
level information on transcriptomes, providing new opportunities to study
dynamic expression of known and novel mRNA isoforms in a high-throughput
manner (Wang et al., 2009; Trapnell et al., 2009). It would be ideal if full-
length mRNA transcripts could be directly sequenced, but most widely
used next-generation Illumina sequencers only generate millions of short
sequences called reads (typically shorter than 400 base pairs) from the
two ends of mRNA transcript fragments (Wang et al., 2009), and other
third-generation sequencing technologies (e.g., Ion Torrent and Paciﬁc Bio-
sciences) produce longer but more erroneous reads (Quail et al., 2012). In

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

3

this paper, our discussion focuses on RNA-seq data generated by Illumina
sequencers. There are two types of Illumina RNA-seq reads: single-end reads
from older sequencing technologies and paired-end reads from newer tech-
nologies. The former type lacks the information about whether two reads
correspond to two ends of the same fragment, while the latter type groups
every two reads from the same fragment into a pair. For more details of an
Illumina RNA-seq experiment, see Fig B1.

Given the numerous discovered isoforms in existing annotations, how to
infer their abundance from RNA-seq reads has been an active research ﬁeld
since 2009 (Jiang and Wong, 2009; Trapnell et al., 2010; Li et al., 2011; Zhang
et al., 2014). A necessary step is to ﬁrst map (or align) reads to reference
genomes so that researchers know the numbers of reads generated from each
exon. Then we need to summarize RNA-seq reads into a data structure
that can be easily used for statistical modeling. A common approach is
to categorize RNA-seq reads by the genomic regions they are mapped to,
so that the number of reads in diﬀerent genomic regions can be used to
distinguish the abundance of diﬀerent isoforms. As diﬀerent isoforms may
consist of overlapping but not identical exons, many methods divide exons
into subexons, which are deﬁned as transcribed regions between every two
adjacent splicing sites in annotations (Li et al., 2011; Zhang et al., 2014; Ye
and Li, 2016). By this deﬁnition, every gene is composed of non-overlapping
subexons and introns (i.e., non-transcribed genomic regions). In Fig 1, we
illustrate a toy example of a gene with three annotated isoforms and four
subexons. Because combinations of subexons form a superset of all the
annotated isoforms, it is reasonable to categorize RNA-seq reads based on
the sets of subexons they are mapped to. For the ease of terminology, we will
refer to subexons as exons in the remainder of this paper. For more details
about categorizing RNA-seq reads, see Section 2.2.

How to infer isoform abundance from observed RNA-seq reads is a statis-
tical problem, as reads are generated by a mixture of isoforms. We illustrate
this using a toy example in Fig 2. A hypothetical gene is composed of
four non-overlapping exons. Suppose that the gene is transcribed into two
mRNA isoforms: 60% of the transcripts are isoform 1, which consists of
exons 1, 2 and 4, and 40% of the transcripts are isoform 2, which consists of
all four exons. In reality, the isoform proportions, though of great interest
to biologists, remain unobservable under the current experimental settings.
Our aim is to estimate the proportions (or relative abundance) of annotated
isoforms based on reads generated in RNA-seq experiments. Suppose that
n paired-end reads are generated from mRNA transcripts of the gene, and
they are mapped (or aligned) to the reference genome. Some of the mapped

4

W. LI ET AL.

Fig 1: Deﬁnition of subexons. The example gene has two exons, represented by magenta
and green boxes respectively, and three mRNA isoforms. The solid lines between exons
represent introns in the gene that have been spliced out in isoforms. Adjacent splicing
sites in these isoforms deﬁne four non-overlapping subexons: the ﬁrst exon is divided into
subexon 1 and 2, and the second exon is divided into subexon 3 and 4.

reads have obvious isoform origins. For example, read 3 is compatible only
with isoform 2, and thus must have isoform 2 as its origin. On the other
hand, many mapped reads can have ambiguous origins. For example, read 1
is compatible with both isoforms 1 and 2, and thus we cannot determine its
origin isoform. The much more complex structures of real genes complicate
the situation even further: human genes have 9 exons on average (Sakharkar
et al., 2004), and we observe that a large proportion of human genes have
more than 10 annotated isoforms (see Fig 5B). Therefore, this problem
requires powerful statistical methods to provide good estimates of isoform
proportions.

A number of isoform quantiﬁcation methods have been developed to esti-
mate the abundance of given isoforms. These methods are called annotation-
based if they use isoform structures in annotations, or annotation-free if they
ﬁrst discover isoforms from RNA-seq data and then estimate the abundance
of these discovered isoforms. Regardless of the use of annotations, these
methods perform isoform quantiﬁcation using either direct computation or
model-based approaches (Wang et al., 2009; Steijger et al., 2013; Kanitz
et al., 2015). Direct computation methods use various ways to count the
number of reads compatible with each isoform and then normalize the counts
by isoform lengths and total number of reads to form estimates of isoform
abundance. The most commonly used unit is reads per kilobase of transcript
per million mapped reads (RPKM) (Mortazavi et al., 2008). For paired-end

isoform1isoform2isoform3subexons2143geneannotationgenomeISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

5

Fig 2: Illustration of RNA-seq read generation from a hypothetical gene. The four exons
of this gene are represented as boxes of diﬀerent lengths and colors. The starting and end
positions of the four exons are marked on top of the gene. In an RNA-seq experiment,
multiple reads are generated and the number of reads coming from each isoform is
proportional to the isoform’s abundance. Each read has a 5’-end and 3’-end, as shown
in read 1. These reads are mapped to the reference genome and their overlapping exons
are key information for estimating isoform abundance.

RNA-seq data, fragments per kilobase of transcript per million mapped reads
(FPKM), which accounts for the dependency between paired-end reads, is
also widely used for isoform abundance (Trapnell et al., 2010). However,
for complex gene structures, counts of RNA-seq reads compatible with iso-
forms may not be proportional to isoform abundance, as multiple isoforms
can share exons, and some reads cannot be assigned unequivocally to just
one isoform. To address this issue, model-based approaches are needed to
assess the likelihoods of a read coming from diﬀerent isoforms. In the ﬁrst
model-based isoform quantiﬁcation method (Jiang and Wong, 2009), read
counts in genomic regions are modeled as Poisson variables (with isoform
abundance as the mean parameter), under the assumption that reads are
uniformly sampled within each isoform. Isoform abundance is estimated by
maximum likelihood estimates. MISO (Katz et al., 2010) is another model-
based method constructed under a Bayesian framework, and it provides
maximum-a-posteriori estimates and conﬁdence intervals of isoform abun-
dance. There are other isoform quantiﬁcation methods with diﬀerent features
(Pachter, 2011). For example, SLIDE (Li et al., 2011) uses a linear model
and is ﬂexible for data types; RSEM (Li and Dewey, 2011) accounts for the
ambiguity in read mapping; WemIQ (Zhang et al., 2014) substitutes the
Poisson distribution with a more general and realistic generalized Poisson
distribution; eXpress (Roberts and Pachter, 2013) is an eﬃcient streaming
method based on an online-EM algorithm; and Sailﬁsh (Patro et al., 2014)
is a fast alignment-free method that saves the read mapping step.

However, there remains much space to improve the accuracy of isoform

142genemRNADNA3...read1read2read3...isoform2mRNA1423142isoform15’5’3’3’13003504004504805007006

W. LI ET AL.

Fig 3: Reads in six hESC RNA-seq samples mapped to human gene AP001347.6. Detailed
information of these samples is listed in Table B1. The vertical bars represent the genome
positions overlapped with mapped reads.

quantiﬁcation due to noise and biases in RNA-seq data. Because of the
decreasing cost of data generation, multiple RNA-seq data sets are now often
available for a biological condition, and they provide more information than
a single RNA-seq data set. This opportunity shedds new light on improving
the accuracy of isoform quantiﬁcation.

Several methods have been developed to use multiple RNA-seq samples
of the same biological condition for isoform quantiﬁcation. For example,
CLIIQ (Lin et al., 2012) uses integer linear programming to jointly model
RNA-seq data from multiple samples. MITIE (Behr et al., 2013) assumes
that the same isoforms are expressed in all samples but may have diﬀerent
abundances, and it then reduces the problem to solving systems of linear
equations. Other similar methods include FlipFlop (Behr et al., 2013) and
ISP (Tasnim et al., 2015). However, none of these methods consider the
quality variation of diﬀerent RNA-seq samples or how such variation might
aﬀect the inference results for isoform abundance. It is commonly recognized
that RNA-seq samples generated by diﬀerent protocols or diﬀerent labs can
have large variation in signal-to-noise ratios, biases, etc. For example, Figure
3 shows the RNA-seq read coverage proﬁles of six human embryonic stem
cell (hESC) samples in the human gene AP001347.6 on chromosome 21.
There is obvious variation in the read coverage proﬁles of these six samples,
and it is thus improper to treat them equally in isoform quantiﬁcation by
assuming that they come from the same population. Hence, results of these
methods could be sensitive to the heterogeneity of samples or even in some
cases be dominated by biased samples, which do not accurately reﬂect the
transcriptome information of the biological condition of interest.

In this paper, we propose a robust quantiﬁcation method for isoform ex-
pression: joint modeling of Multiple RNA-seq Samples for accurate Isoform
Quantiﬁcation (MSIQ). MSIQ is a model-based approach to estimating

Scalechr21:Basic50 kbhg1915,410,00015,420,00015,430,00015,440,00015,450,00015,460,00015,470,00015,480,00015,490,00015,500,00015,510,000ENCODECSH_2010ENCODECaltech_2011ENCODECaltech_2011Wu_2010Wu_2010Marchetto_2013Gene Annotations from GENCODE Version 19sample 1sample 4sample 5sample 2sample 3sample 6ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

7

isoform abundance by discerning and using multiple RNA-seq samples that
share similar transcriptome information, which we deﬁne as the informative
group in this paper. Our modeling consists of two components: (1) esti-
mating the probability of each sample being in the informative group via
evaluating the sample similarities, and (2) estimating isoform abundance
from reweighed samples with more weights given to the more likely infor-
mative group. In Section 2 we describe the Bayesian hierarchical model
used in MSIQ to bridge unknown isoform proportions and observed read
counts mapped to a gene in multiple RNA-seq samples. Our model allows
for diﬀerent isoform proportions of RNA-seq samples in and outside of
the informative group, with a main parameter of interest as the isoform
proportions in the informative group. This approach reduces the possibility
that the estimated isoform abundance would be biased by the minority
samples. We conduct parameter inference by Gibbs Sampling and prove
the consistency of the resulting MSIQ estimator. We also propose two other
inference procedures (averaging and pooling) to estimate the parameters.
Moreover, we show that the estimated isoform proportions by MSIQ are
consistent with the unknown isoform proportions in the informative group,
while the estimates based on the assumption that all samples have equal
quality are not consistent. In Section 3 we apply MSIQ to both simulated
and real data sets to illustrate the eﬃciency and robustness of MSIQ under
various parameter settings and diﬀerent parameter estimation procedures.
We also compare MSIQ with the oracle estimators and other competing iso-
form abundance estimation methods. In Section 4, we discuss the advantages
and limitations of MSIQ and its possible extensions.

2. Methods. For a given gene, our proposed MSIQ method aims at
two goals in isoform expression quantiﬁcation. First, we want to identify the
samples representing the biological condition of interest. We refer to these
samples as the informative group and assume that the group contains at
least one sample. We identify samples in the informative group under the
assumption that samples in the group share most similar read distributions
among all the samples. Second, we would also like to estimate the proportion
of reads coming from each mRNA isoform in the biological condition of
interest, with larger weight given to the samples in the informative group.
We focus our eﬀorts on RNA-seq data with paired-end reads, but the model
can be easily extended to apply on single-end reads.

2.1. Ideal and practical parameters of interest. Suppose we are studying
a gene with N exons, J annotated mRNA isoforms, and D RNA-seq samples.

8

W. LI ET AL.

Ideally, we are interested in the true proportion of each isoform

pj = P (an mRNA transcript is of isoform j), j = 1, 2, ..., J.

However, these are the hidden parameters that are not observable in RNA-
seq experiments, which do not directly measure mRNA transcripts. Instead
of directly estimating pj (j = 1, 2, ..., J), we aim at estimating the practical
parameters

αj = P (an RNA-seq read is from isoform j), j = 1, 2, ..., J,

which we refer to as isoform proportions in our discussions.

In this study, our raw data are RNA-seq reads mapped to the reference
genome, represented by genomic positions covered by each read. That is,
if a read has a total length 2c (the left and right end each have length
c), it is represented by a set of genomic positions {y1, . . . , y2c}. However,
eﬃcient data summary is needed to preserve most relevant information for
isoform quantiﬁcation while controlling the computational complexity at
manageable level (Rossell et al., 2014). To our knowledge, there are three
existing approaches designed for data summary:

• Approach 1 (Zhang et al., 2014): represent the read by (y1, y2c)(cid:48);
• Approach 2 (Li et al., 2011): represent the read by (y1, yc, yc+1, y2c)(cid:48);
• Approach 3 (Rossell et al., 2014): represent the read by s1 and s2, the
indices of the exons that completely or partially overlap with each end
of the read:

s1 = {i : Gi ∩ {y1, . . . , yc} (cid:54)= ∅, i = 1, . . . , N} ,
s2 = {i : Gi ∩ {yc+1, . . . , y2c} (cid:54)= ∅, i = 1, . . . , N} ,

where Gi denotes the set of genomic positions in exon i .

We compare these three approaches on the hypothetical gene in Fig 2
and summarize their results in Table 1. It is obvious that Approach 1 loses
more information than Approach 2. In this speciﬁc case, Approach 3 gives
clearer indication of the possible isoform origins of the three reads, because
it captures the mapping information inside the left and right ends, which
are missed by Approaches 1 and 2. However, Approach 3 removes the actual
genomic positions of reads, which are necessary for estimating the fragment
length corresponding to each paired-end read. Recognizing the comparative
advantages of Approaches 2 and 3, we use a combination of Approaches 2
and 3 as our data summary method.

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

9

Table 1: Comparison of the three RNA-seq data summary approaches. Examples of three
summarized reads and their encoded isoform origin information are listed (see also Fig 2).

Read

Approach 1

Approach 2

Approach 3

data
(231,559)
(100,578)
(50,537)

origin
1,2
1,2
1,2

data
(231,280,510,559)
(100,199,460,578)
(50,149,370,537)

origin
1,2
2
1,2

...

...

data
{1}{4}
{1}{3,4}
{1}{2,3,4}
...

origin
1,2
2
2

1
2
3
...

2.2. Observed data. We denote the observed data, D independent sam-
ples of mapped reads to a gene with N exons and J annotated isoforms,
by

R(d) = {r(d)

1 , r(d)

2 , . . . , r(d)
nd

} ,

d = 1 , 2 , . . . , D ,

where nd and r(d)
respectively denote the total number of reads and the ith
read (i = 1, 2, . . . , nd) in sample d. Using our data summary method, each
read can be explicitly written as

i

(cid:110)

(cid:110)

r(d)
i =

1i , s(d)
s(d)
2i ,

y(d)
i1 , y(d)

ic(d), y(d)

i(c(d)+1)

, y(d)

i(2c(d))

(cid:111)(cid:111)

,

1i and s(d)

where s(d)
with the read’s left end and right end; y(d)
in read i; and c(d) is the read length in sample d.

respectively denote the index set of exons overlapping
ik denotes the kth genomic position

2i

2.3. Assumptions and prior. Aside from the observed data, the hidden

data are the isoform origins of the reads:

Z(d) = (Z(d)

1 , Z(d)

2 , . . . , Z(d)
nd

)(cid:48) ,

where Z(d)
if read r(d)

i

i ∈ {1, 2, . . . , J} indicates the isoform origin of read i, and Z(d)

i = j

actually comes from isoform j.

The diﬀerence between RNA-seq samples is reﬂected in their isoform
proportion τ (d), d = 1, 2, . . . , D. In RNA-seq sample d, we denote the true
probability of reads from isoform j as τ (d)
i = j) and the isoform
proportion vector as

j = P (Z(d)

τ (d) = (τ (d)

1 , τ (d)

2 , . . . , τ (d)

J )(cid:48) ,

10

with (cid:80)J

such that

W. LI ET AL.

j=1 τ (d)

j = 1. We deﬁne a hidden state variable Ed for each sample

Ed = 1I{sample d belongs to the informative group}.

proportion vector α = (α1, α2, . . . , αJ )(cid:48) with (cid:80)J

We assume samples in the informative group all have the same isoform
j=1 αj = 1, while samples
not in the informative group each can have diﬀerent isoform proportions
β(d) = (β(d)
2 , . . . , β(d)
j = 1. Thus the isoform propor-
tions can be expressed as

j=1 β(d)

1 , β(d)

J )(cid:48) with (cid:80)J
(cid:26) α,

=

τ (d) = Ed · α + (1 − Ed) · β(d)

if Ed = 1 ,
if Ed = 0 .

β(d),

The isoform proportion vector of the informative group α is our parameter
of interest.
We assume α and β(d) are a priori Dirichlet(λ), and Ed is a priori
Bernoulli(γ): Ed|γ ∼ Bernoulli(γ), where γ ∼ Beta(a, b). Intuitively, λ con-
trols the distance between the isoform proportions of samples in and outside
of the informative group, while γ controls the tendency of assigning a sample
to the informative group. We describe the relationship between observed
RNA-seq reads and hidden isoform proportions in multiple samples under
Bayesian framework (Fig 4).

2.4. The MSIQ model. We introduce I (d)

i =
j}. Then given a sample with isoform proportion τ (d), the probability of read
r(d)
i

i,j as a short notation of 1I{Z(d)

and origin Z(d)

can be written as:

i

|τ (d)(cid:17)

P

r(d)
i

, Z(d)

i

(cid:16)

(2.1)

(cid:16)
(cid:16)

P

(cid:104)

P

J(cid:89)
J(cid:89)

j=1

j=1

=

=

r(d)
i

, Z(d)

i = j|τ (d)(cid:17)1I{Z(d)
(cid:105)I (d)

(cid:17)

i =j}

r(d)
i

|Z(d)

i = j

τ (d)
j

ij (cid:44)

(cid:16)

h(d)
i,j τ (d)

j

(cid:17)I (d)

i,j ,

J(cid:89)

j=1

where h(d)
r(d)
i
isoform 1), h(d)

i,j is the generating probability of read r(d)

i

given isoform j. If read

and isoform j are incompatible (e.g., read 2 in Fig 2 cannot come from
i,j depends on the model for the read

i,j = 0. Otherwise, h(d)

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

11

Fig 4: Joint modeling of multiple RNA-seq samples. In this framework, Ed (d = 1, 2, . . . , D)
is a binary hidden state variable indicating whether RNA-seq sample d is in the informative
group, while a, b and γ are hyper-parameters in Ed’s distribution. Depending on Ed, the
isoform proportion vector τ (d) takes either the informative group’s isoform proportion
vector α or its own β(d). Given the isoform proportions, RNA-seq reads are generated in
each sample, and our observed data are summarized as R(d) (see Section 2.2).

generation mechanism. We adopt the following model from a recent work
(Zhang et al., 2014)

i,j ) and variance var(L(d)

i,j denotes the fragment length of r(d)

where L(d)
if it comes from isoform j.
Note that the same read may correspond to diﬀerent fragment lengths if they
come from diﬀerent isoforms. For example, read 1 in Fig 2 might have come
from isoform 1 or 2, and it corresponds to fragments of diﬀerent lengths in
these two isoforms. L(d)
i,j is assumed to be a Gaussian random variable and its
mean L(d) = E(L(d)
i,j ) can be estimated from single-
isoform genes, whose mapped reads directly determine fragment lengths.
(cid:96)(cid:48)
j is the eﬀective length (the number of possible starting positions on the
j = (cid:96)j − L(d), where (cid:96)j is
fragment) of isoform j and can be calculated as (cid:96)(cid:48)
the length of isoform j.
Let E = (E1, E2, . . . , ED)(cid:48) be the hidden state vector indicating whether
each sample is among the informative group or not, and let R = {R(d)}D
d=1,
Z = {Z(d)}D
d=1 represent the reads, reads’ origins,
and isoform proportions in all the samples respectively. To simplify the
notation, we also introduce n(d)
to represent the total number

d=1, and τ = {τ (d)}D

j =(cid:80)nd

i=1 I (d)

ij

h(d)
i,j =

× P

1
(cid:96)(cid:48)

j

L(d)
i,j

,

(cid:16)

(cid:17)

i

γ,abλ1ERep 1λdERep λDERepdD(1)τ()dτ()Dτ(1)R()dR()DR......12

W. LI ET AL.

of reads coming from isoform j in sample d. Given equation (2.1), the joint
probability of all reads in our MSIQ model is as follows
P (R, Z, τ , E, γ|λ, a, b) = P ( R, Z| τ , E) P ( τ| λ, E) P ( E| γ) P (γ|a, b),

where

P ( R, Z| τ , E) =


 nd(cid:89)
(cid:16)
D(cid:89)
J(cid:89)
 J(cid:89)
(cid:16)
P ( τ| λ, E) ∝ J(cid:89)
D(cid:89)
αλj−1
(cid:80)D
d=1 Ed(1 − γ)D−(cid:80)D

P ( E| γ) ∝ γ
P (γ|a, b) ∝ γa−1(1 − γ)b−1.

h(d)
i,j αj

d=1

d=1

j=1

j=1

j=1

i=1

j

d=1 Ed,

i,j

Ed nd(cid:89)
(cid:17)I (d)
1−Ed
(cid:17)λj−1

i=1

(cid:17)I (d)

i,j

1−Ed ,

h(d)
i,j β(d)

j

J(cid:89)

(cid:16)

j=1

,

β(d)
j

As a result, the joint probability can be simpliﬁed as

(2.2)

∝

P (R, Z, τ , E, γ|λ, a, b)

 J(cid:89)
 D(cid:89)

j=1

α

λj−1+(cid:80)D
(cid:16)
J(cid:89)
nd(cid:89)

j

d=1 Edn(d)

j

(cid:17)I (d)

i,j

h(d)
i,j

(cid:16)

 D(cid:89)
(cid:17)(1−Ed)
J(cid:89)
(cid:16)
 γ
(cid:80)D
d=1 Ed+a−1(1 − γ)D−(cid:80)D

β(d)
j

d=1

j=1

d=1

j=1

i=1

(cid:17)

λj−1+n(d)

j

d=1 Ed+b−1.

2.5. Markov chain Monte Carlo.

In the MSIQ model (2.2), the reads
R are the observed data, the isoform origins Z and the informative group
indicator E are the hidden data, while isoform proportions α,{β(d)}D
d=1,
and informative group proportion γ are the parameters. To estimate the
paramters, a useful approach is to implement a Gibbs sampler to iteratively
draw posterior samples of hidden data and parameters from their conditional
distributions. Since our ultimate parameter of interest is α, whose inference
becomes obvious given Z and E, we integrate out τ (i.e., α and {β(d)}D
d=1)
in model (2.2) to achieve better computational eﬃciency. This step is based
on the property of Dirichlet distribution:

(cid:90)

(cid:90)
{(τ1,...,τJ ):0≤τj≤1,(cid:80)

···

J(cid:89)

j τj =1}

j=1

τ λj−1

j

dτ1 ··· dτJ = B(λ),

∀λj > 0 ,

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

13

ΠJ

Γ((cid:80)J

j=1Γ(λj )
j=1 λj )

. Hence

where B(λ) =

P ( R, Z, E, γ| λ, a, b) ∝ B1(Z, E) · D(cid:89)

·γ

where

 D(cid:89)

(cid:17)I (d)

i,j



J(cid:89)

(cid:16)

j=1

h(d)
i,j

nd(cid:89)

i=1

d=1

d=1

d=1 Ed+b−1,

0 (Z(d), Ed) ·
B(d)
(cid:80)D
d=1 Ed+a−1(1 − γ)D−(cid:80)D
(cid:17)
(cid:16)
(cid:81)J
λj +(cid:80)D
(cid:16)(cid:80)J
(cid:17) ,
j=1 λj +(cid:80)D
d=1 Ed · n(d)
d=1 Ed · nd
(cid:17)
(cid:16)
(cid:81)J
(cid:17) .
(cid:16)(cid:80)J

λj + n(d)
j

j=1 Γ

j=1 Γ

Γ

j

Γ

j=1 λj + nd

B1(Z, E) =

B(d)

0 (Z(d), Ed = 1) = 1,

B(d)

0 (Z(d), Ed = 0) =

We denote Θ = {R, Z, E, γ}. The distribution of each parameter/hidden
variable conditional on everything else can thus be estimated by Gibbs
sampling as follows.

(1) Ed follows a Bernoulli distribution:
Ed|Θ/{Ed} ∼ Bern

(2.3)

(cid:18) odds(Ed; λ, τ )

1 + odds(Ed; λ, τ )

(cid:19)

,

where

odds(Ed; λ, τ ) =

=

P (Ed = 1|Θ/{Ed})
P (Ed = 0|Θ/{Ed})
B1(Z, E−d, Ed = 1)
B1(Z, E−d, Ed = 0)

(2) Z(d)

i

(2.4)

follows a multinomial distribution:
i } ∼ Multinomial

|Θ/{Z(d)

Z(d)

i

=

P ( R, Z, E−d, Ed = 1, γ| λ, a, b)
P ( R, Z, E−d, Ed = 0, γ| λ, a, b)
· B(d)
0 (Z(d), Ed = 1)
B(d)
0 (Z(d), Ed = 0)
(cid:16)

γ
1 − γ

(cid:17)

·

.

q(d)
i1 , q(d)

i2 , . . . , q(d)

iJ

,

where

q(d)
ij =

(cid:80)J

P (Z(d)
j(cid:48)=1 P (Z(d)

i = j|Θ/{Z(d)
i })
i = j(cid:48)|Θ/{Z(d)
i })

=

P

(cid:80)J

j(cid:48)=1 P

(cid:16)
R, Z(−d)−i

, Z(d)
R, Z(−d)−i

i = j, E, γ
, Z(d)

i = j(cid:48), E, γ

(cid:12)(cid:12)(cid:12) λ, a, b
(cid:17)
(cid:12)(cid:12)(cid:12) λ, a, b

(cid:17) .

(cid:16)

14

W. LI ET AL.

(3) γ follows a Beta distribution:

(2.5)

γ|Θ/{γ} ∼ Beta

(cid:32) D(cid:88)

Ed + a, D − D(cid:88)

(cid:33)

Ed + b

.

d=1

d=1

2.6. Estimators of isoform proportion. With the above posterior dis-
tribution of the hidden variables and parameters, we can draw samples
iteratively to estimate the hidden state of each RNA-seq sample and the
true isoform proportion in the informative group. Suppose we have T it-
erations available after discarding the burn-in period of Gibbs sampling.
In each iteration, we denote the sampled hidden state vector as E(t) =
(E(1)

1 , E(2)
To estimate isoform proportion in each iteration, we pool the reads from

D )(cid:48) and the hidden origin vector in sample d as (Z(d,t)

2 , . . . , E(T )

1

, . . . , Z(d,t)

nd

)(cid:48).

Overall, the MSIQ estimator of the isoform proportion becomes

sample d whose E(t)

(2.6)

α(t)

j =

= j}(cid:17)

.

i

d=1

E(t)
d

(cid:16)
λj +(cid:80)D
(cid:80)nd
d = 1 to calculate α(t), where
j=1 λj +(cid:80)D
(cid:80)J
i=1 1I{Z(d,t)
d=1 E(t)
d nd
T(cid:88)
m(cid:88)

ˆαMSIQ =

α(t),

1
T

t=1

REE( ˆαMSIQ) =

|αj − ˆαMSIQ

|/αj.

j

j=1

and the relative estimation error is

We can also estimate the posterior probability of each sample belong-
ing to the informative group: θ = (θ1, θ2, . . . , θD)(cid:48), where θd = P (Ed =
1|R, λ, a, b), and the estimator is

T(cid:88)

t=1

ˆθMSIQ
d

=

1
T

E(t)
d .

We consider the samples with posterior probability ˆθMSIQ
the informative group.

d

> 1/2 to be among

We also consider six competing estimators to demonstrate the eﬀective-
ness of MSIQ in accurate isoform quantiﬁcation. From what has been derived
in Section 2.4, we know that the log likelihood of all reads in sample d is:

P (R(d), Z(d)|τ (d))

log

=

I (d)
ij

log

h(d)
ij τ (d)

j

.

(cid:17)

nd(cid:88)

m(cid:88)

i=1

j=1

(cid:16)

(cid:17)

(cid:16)

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

15

Then the EM algorithm can be implemented to estimate τ (d). The six com-
peting estimators are calculated using the EM algorithm based on diﬀerent
sets of samples:

AVG (averaging): We calculate the isoform proportion in each sample and

take the average of them as the estimator of isoform proportion

D(cid:88)

d=1

ˆαAVG =

1
D

ˆτ (d).

AVG* (oracle averaging): We calculate the isoform proportion in each
sample in the informative group (truth) and take the average of them
as the estimator of isoform proportion

(cid:80)D
(cid:80)D
d=1 ˆτ (d)1I{Ed = 1}
d=1 1I{Ed = 1} .

ˆαAVG* =

POOL (pooling): We pool the reads of the given gene in all samples
together, then we use the EM algorithm to estimate the isoform pro-
portion τ as ˆαPOOL.

POOL* (oracle pooling): We pool the reads of the given gene in samples in
the informative group (truth) together, then we use the EM algorithm
to estimate τ as ˆαPOOL*.

MSIQa (MSIQ averaging): We calculate the isoform proportion in each
sample identiﬁed to be in the informative group (by MSIQ) and take
the average of them as the estimator of isoform proportion

(cid:80)D
(cid:80)D
d=1 ˆτ (d)1I{ˆθMSIQ
d=1 1I{ˆθMSIQ

d

d

> 1/2}
> 1/2} .

ˆαMSIQa =

MSIQp (MSIQ pooling): We pool the reads of the given gene in the
samples identiﬁed to be in the informative group (by MSIQ) together,
then we use the EM algorithm to estimate τ as ˆαMSIQp.

Among these estimators, ˆαAVG* and ˆαPOOL* are oracle estimators that we
take as gold standards in simulations but are unknown in real data; ˆαMSIQa
and ˆαMSIQp are MSIQ-dependent and rely on ˆθ estimated by MSIQ.

2.7. MSIQ’s convergence property.

In this section, we show the consis-

tency of the MSIQ estimator ˆαM SIQ in the following lemma.

Lemma 2.1.

tion E(α|R, λ, a, b).

ˆαMSIQ converges to the posterior mean of isoform propor-

(cid:17)

(cid:16)

n(cid:89)

l=1

16

W. LI ET AL.

Proof. For simplicity, let X = (E, Z, γ)(cid:48), a vector of n = D+(cid:80)D

d=1 nd +
1 dimensions, where E = (E1, . . . , ED)(cid:48) and Z = (Z(1)
n1 , . . . , Z(D)
,
nD )(cid:48). We denote the joint density of X as π(x|R, λ, a, b). In MSIQ,
. . . , Z(D)
the transition kernel of the Markov chain is formed by the Gibbs sampler:

1 , . . . , Z(1)

1

K(x(t), x(t+1)) =

π

x(t+1)
l

|{x(t)

j }j>l,{x(t+1)

k

}k<l

.

We know that π(x|R, λ, a, b) is discrete with respect to (w.r.t.) Xi (i =
1, 2, . . . , n − 1) and is continuous w.r.t. Xn. According to Lemmas A.1 and
A.2 (Roberts and Smith, 1994), K(x(t), x(t+1)) is a well-deﬁned kernel and
π is an invariant distribution of the Markov chain applied by K. We also
know from equation (2.3) and (2.5) that the conditional probabilities of
For each XD+i+(cid:80)d−1
Xd = Ed (d = 1, . . . , D) or Xn = γ on everything else are always positive.
, if we deﬁne its conditional distribution (2.4)
on the domain {j : q(d)
(cid:54)= 0}, its conditional probability is also always
positive. The positive properties of these conditional distributions naturally
lead to the positivity of the transition kernel K(x(t), x(t+1)), and thus the
π-irreducibility of K.
Now since K(x(t), x(t+1)) is π-irreducible, by Theorem A.1 in Roberts and
Smith (1994) for all x ∈ Q = {x : π(x|R, λ, a, b) > 0}, K(t)(x,·) converges
to π(x):

= Z(d)

k=1 nk

ij

i

|K(t)(x,·) − π(x|R, λ, a, b)| → 0 as t → ∞,

where K(t)(x,·) is the density of x(t) given X (0) = x. Therefore, ˆθMSIQ
converges to E(Ed|R, λ, a, b):

d

lim
T→∞

ˆθMSIQ
d

= lim
T→∞

1
T

d = E(Ed|R, λ, a, b).
E(t)

T(cid:88)

t=1

Now we can prove the convergece of ˆαMSIQ. From model (2.2) it is easy to
see that

α|Z, E, R, λ, a, b ∼ Dirichlet(λ(cid:48)

j = λj +(cid:80)D

(cid:16)

(cid:80)nd

d=1

Ed

i=1 I (d)

i,j

where λ(cid:48)
of αj:

E(αj|Z, E, R, λ, a, b) = E(αj|X, R, λ, a, b)

. Thus the conditional posterior mean

J ),

1, . . . , λ(cid:48)

(cid:17)
(cid:16)
λj +(cid:80)D
(cid:80)nd
j=1 λj +(cid:80)D
(cid:80)J

Ed

d=1

i,j

i=1 I (d)
d=1 Ednd

=

(cid:17)

(cid:44) gj(X).

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

17

Then the isoform proportion α(t)
as: α(t)

j = gj(X (t)). As a result,

j deﬁned in equation (2.6) can be written

T(cid:88)

t=1

T→∞ ˆαMSIQ
lim

j

= lim
T→∞

1
T

j = Eπ[gj(X)] = E(αj|R, λ, a, b),
α(t)

and limT→∞ ˆαMSIQ = E(α|R, λ, a, b).

3. Results.

3.1. Performance of MSIQ in simulations. To show that MSIQ pro-
vides more accurate estimates for isoform expression than the current multi-
sample averaging or pooling method, we compare the relative estimation
errors (REE) of ˆαMSIQ with those of the six competing estimators: ˆαAVG*,
ˆαMSIQa, ˆαAVG, ˆαPOOL*, ˆαMSIQp, and ˆαPOOL. It is diﬃcult to compare
these methods on real data, because true isoform abundance in samples
is unknown. Although the quantitative polymerase chain reactions (qPCR)
technology can accurately measure the abundance of mRNA isoforms and
produce “gold standard” isoform abundance data, qPCR data sets are scarce
and unavailable for most biological conditions (Li and Dewey, 2011). We use
simulated data to compare the performance of these estimators under various
scenarios and parameter settings.

Fig 5: Relationship of isoform numbers and exon numbers in ﬂy and human genes. Points
in the scatterplots are jittered to reduce overplotting. A: Isoform numbers versus exon
numbers in 3,421 ﬂy genes, whose exon numbers range from 3 to 98. B: Isoform numbers
versus exon numbers in 15,268 human genes that have at least two annotated isoforms.
The exon numbers in human genes range from 2 to 380.

0204060801~56~1011~1516~2021~2526~3031~3536~40>410102030405060345678910>11Number of exons Number of isoformsABNumber of exons fly geneshuman genes18

W. LI ET AL.

Table 2: Four parameter settings and ﬁve scenarios in the simulation study.

setting

average fragment length (bp)

read length (bp)

1
2
3
4

150
250
150
250

scenario % samples in the informative group

1
2
3
4
5

100
50
70
70
70

50
50
100
100

isoform proportions

{α, α, α, α, α, α, α, α, α, α}
{α, α, α, α, α, β1, β2, β3, β4, β5}
{α, α, α, α, α, α, α, β1, β2, β3}
{α, α, α, α, α, α, α, β6, β6, β6}
{α, α, α, α, α, α, α, β7, β7, β7}

We simulate RNA-seq reads from 3421 D.melanogaster (ﬂy) genes that
have more than one isoform in the annotation (September 2010) of UCSC
Genome Browser. These genes include 221 3-exon genes, 330 4-exon genes,
365 5-exon genes, 370 6-exon genes, 320 7-exon genes, 311 8-exon genes, 256
9-exon genes, 292 10-exon genes, and 956 genes with more than 10 exons.
The isoform numbers increase at a roughly exponential rate as the exon
numbers increase (see Fig 5A). We simulate 10 samples and 500 paired-end
reads from each gene in every sample. To fully evaluate the performance
of the seven estimators, we consider ﬁve diﬀerent scenarios with diﬀerent
numbers of samples in the informative group.

For each gene, we ﬁrst independently generate the isoform proportion
vector α for the samples in the informative group and the isoform proportion
vectors β1, β2, β3, β4 and β5 for other ﬁve samples. The ﬁve scenarios are
designed as follows (see Table 2).

samples have individual isoform proportions β1, β2, β3, β4 and β5.

• In scenario 1, all the 10 samples are in the informative group.
• In scenario 2, 5 samples are in the informative group, and the other 5
• In scenario 3, 7 samples are in the informative group, and the other 3
• In scenario 4, 7 samples are in the informative group, and the other 3

samples have individual isoform proportions β1, β2 and β3.

samples have the same isoform proportion vector as

β6 = argmax
βi,i=1,...,5

||βi − α||2
2,

which is the isoform proportion vector most diﬀerent from α.

• In scenario 5, 7 samples are in the informative group, and the other 3

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

19

samples have the same isoform proportion vector as

β7 = argmin
βi,i=1,...,5

||βi − α||2
2,

which is the isoform proportion vector mostly similar to α.

We also consider four settings of fragment and read length (see Table
2) to examine how these parameters would aﬀect the performance of the
seven estimators on isoform quantiﬁcation. Under each setting, we ﬁrst
determine the origin of a fragment according to the designated isoform
proportion, and then the starting position and the fragment length can be
respectively simulated from a uniform distribution and a normal distribution
(with a standard deviation of 10). Once the fragments are determined, the
corresponding paired-end reads are also obtained.

For each scenario and parameter setting, we calculate the seven estimators
ˆαMSIQ, ˆαAVG*, ˆαMSIQa ˆαAVG, ˆαPOOL*, ˆαMSIQp, and ˆαPOOL, and evaluate
their estimation accuracy by calculating the REE of these estimates against
the true isoform proportions.

Fig 6: Relative estimation error (REE) rates of the seven estimators in scenario 1-5. REE
rates are calculated on 2,465 ﬂy genes with 3-10 exons. In each boxplot, the REE rates of
MSIQ, AVG, MSIQa, AVG, POOL, MSIQp and POOL are plotted side by side under each
scenario and the whiskers extend to the most extreme REE rates. The top-right legend
of each plot displays the parameter setting: the mean fragment length (F) and the read
length (R).

012345REEscenario 1scenario 2scenario 3scenario 4scenario 5012340246810REE012345MSIQAVG*MSIQaAVGPOOL*MSIQpPOOLF=150 bpR=50 bpscenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5F=250 bpR=50 bpF=150 bpR=100 bpF=250 bpR=100 bp20

W. LI ET AL.

Table 3: Median REE rates of ﬁve estimators under the ﬁve scenarios. The values are
averaged over the four parameter settings and rounded to three decimal places. Diﬀerences
in REE rates between MSIQ and the four other estimators are listed in parentheses.

estimator
MSIQ
AVG*

MSIQa

POOL*

MISQp

scenario 1

scenario 2

scenario 3

scenario 4

scenario 5

0.157
0.158

(-0.001)

0.164

(-0.007)

0.152
(0.005)
0.157

(-0.000)

0.236
0.215
(0.021)
0.244

(-0.009)

0.212
(0.023)
0.242

(-0.006)

0.194
0.179
(0.014)
0.202

(-0.009)

0.175
(0.019)
0.200

(-0.007)

0.208
0.179
(0.029)
0.222

(-0.014)

0.175
(0.033)
0.217

(-0.009)

0.211
0.179
(0.031)
0.217

(-0.006)

0.175
(0.036)
0.215

(-0.005)

3.1.1. MSIQ achieves the lowest error rates in diﬀerent scenarios. We
calculate the error rates of the seven estimators for the 2, 465 ﬂy genes with
no more than 10 exons in diﬀerent scenarios and parameter settings, and
illustrate the results in Fig 6. The results suggest that given the samples out-
side of the informative group (scenarios 2-5), especially when these samples
constitute a large proportion or are vastly diﬀerent from the informative
group, MSIQ ( ˆαMSIQ) and MSIQ-based methods ( ˆαMSIQa and ˆαMSIQp)
achieve much smaller error rates than the averaging or pooling method
( ˆαAVG and ˆαPOOL). Compared with ˆαMSIQ, ˆαAVG results in a 17.3-fold in-
crease in the REE rates on average and ˆαPOOL results in a 17.6-fold increase.
We also summarize the REE of the seven estimators (see Fig B2) when we
include the results of the 956 genes with more than 10 exons. The isoform
quantiﬁcation task is much more challenging for these 956 genes due to their
much larger numbers of annotated isoforms (see Fig 5A). As expected, both
the largest and the average REE rates increase with the addition of these 956
genes, because their complicated isoform structures pose more diﬃculty and
complexity on model ﬁtting and computation. These results suggest that
compared with the direct averaging or pooling method, the MSIQ methods
that take the quality of samples into consideration can lead to more accurate
isoform quantiﬁcation when multiple RNA-seq samples are available. Fig 6
also shows that MSIQ can constrain the estimation error to a much narrower
range compared with direct averaging and pooling. MSIQ is able to control
the REE rate below 1.33 for 90% of the 2, 465 genes, while direct averaging
and pooling give rise to REE rates larger than 2.00 for more than 15% of
these genes. We conclude that MSIQ is a more robust method than direct
averaging and pooling.

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

21

Fig 7: Median REE rates of the MSIQ-based and oracle estimators in scenarios 1-5.
MSIQ outperforms MSIQa and MSIQp and gives error rates close to those of the oracle
estimators. The top-left legend of each plot displays the parameter setting: the mean
fragment length (F) and the read length (R).

We also summarize the median REE of these estimators under diﬀerent
cases in Fig 7 and Table 3. The results show that MSIQ not only outperforms
direct averaging and pooling as we have seen, but also achieves more accurate
abundance estimation than MSIQa and MSIQp. Compared with MSIQ’s
median REE rate, MSIQa and MSIQp have a 0.009 and a 0.007 larger REE
rate on average respectively. From Fig 7 and Table 3 we also conclude that
the estimation results of MSIQ are similar to those of MSIQa and MSIQp,
the two oracle estimators that are impossible to calculate on real data. On
average, the REE rate of MSIQ is only 0.019 larger than MSIQa and 0.058
larger than MSIQp.

3.1.2. Diﬀerent scenarios inﬂuence estimators’ performance. Since AVG
and POOL are observed to have much poorer accuracy than the other
ﬁve estimation methods, we remove them from the comparison for a more
detailed evaluation of the other ﬁve methods. From Fig 7, it is obvious
that the proportion of samples in the informative group and the diﬀerence

0.160.180.200.220.24median REE●●●●●scenario 1scenario 2scenario 3scenario 4scenario 50.140.160.180.20●●●●●0.180.200.220.240.26●●●●●0.160.180.200.220.240.26●●●●●●MSIQAVE*MSIQaPOOL*MSIQpmedian REEmedian REEmedian REEscenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5F=150 bpR=50 bpF=250 bpR=50 bpF=150 bpR=100 bpF=250 bpR=100 bp22

W. LI ET AL.

Fig 8: REE rates of MSIQ for RNA-seq samples with diﬀerent fragments and read lengths.
The median (solid red line with marked numbers), 1st quartile and 3rd quartile (dashed
red lines) of the REE rates in diﬀerent scenarios are illustrated, respectively. The top-left
legend of each plot displays the parameter setting: the mean fragment length (F) and the
read length (R).

between the informative group and other samples have large eﬀects on the
performance of all ﬁve estimating methods: MSIQ, AVG*, MISQa, POOL*,
and MISQp. In scenario 1 when all the samples are in the informative group,
all the ﬁve methods have the lowest median REE rates of all the 2, 465 genes.
In scenario 2, which has the smallest proportion of samples in the informative
group, all ﬁve methods have the largest median REE rates among all sce-
narios. This phenomenon can be explained by the fact that fewer samples in
the informative group would lead to more error-prone identiﬁcation of these
samples and less accurate estimates of isoform proportions of the informative
group. In scenarios 3, 4, and 5, which have 70% samples in the informative
group, the REE rates of these ﬁve methods lie between those of scenarios 1
and 2. Among all three non-oracle estimation methods (MSIQ, MSIQa and
MSIQp), MSIQ has the best performance in all the ﬁve scenarios. Unlike
MSIQa and MSIQp, which discard the samples outside of the identiﬁed
informative group, MSIQ partially borrows information from these samples
through the Bayesian hierarchical framework.

3.1.3. More accurate isoform quantiﬁcation with longer fragments. We
also evaluate the REE rates of MSIQ with diﬀerent fragment lengths and
read lengths in simulated RNA-seq experiments. The 1st quartile, median,

0.00.20.40.60.81.00.1680.2500.1970.2100.219scenario 1scenario 2scenario 3scenario 4scenario 50.00.20.40.60.81.00.1270.1930.1580.1660.166scenario 1scenario 2scenario 3scenario 4scenario 50.00.20.40.60.81.00.1650.2500.2070.2300.236scenario 1scenario 2scenario 3scenario 4scenario 50.00.20.40.60.81.00.1680.2490.2120.2270.222scenario 1scenario 2scenario 3scenario 4scenario 5REEREEF=150 bpR=50 bpF=250 bpR=50 bpF=150 bpR=100 bpF=250 bpR=100 bpISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

23

Table 4: Description of RNA-seq samples in and outside of the informative group in ﬁve
sets.

set ID informative group

other samples

sample IDs

1
2
3
4
5

hESC
hESC
hESC
hESC
hESC

/

brain

1-6
1-9

Flux Simulator
Flux Simulator
Flux Simulator

1-6, 10-14
1-6, 15-19
1-6, 20-24

and 3rd quartile of the REE errors in each of the ﬁve scenarios are illustrated
in Fig 8. It is obvious that longer fragment lengths would improve the
estimation accuracy, especially when read lengths are short. Speciﬁcally,
when read lengths are set to 50 bp, increasing fragment lengths from 150
to 250 bp leads to a 22.5% decrease in the median REE rate and a 31.8%
decrease in the inter-quartile range of REE; when read lengths are set to
100 bp, the increase of fragment lengths does not make as much diﬀerence.

3.2. Performance of MSIQ on real data. Although the true isoform pro-
portions are mostly unknown in real data, we are still able to evaluate multi-
sample isoform abundance estimation methods by creating a set of samples
with the majority from one tissue of interest (the informative group) and
other samples from a diﬀerent tissue. In this setup, we know which samples
belong to the informative group. If our MSIQ method has good performance,
its estimated isoform proportions on all the samples should be close to its
estimates on the samples in the informative group only. We use six public
RNA-seq data sets of human embryonic stem cells (hESC) and consider
these samples as the informative group. We mix these samples with three
other samples of human brain tissues or three samples simulated by Flux
Simulator (see Table B1 for detailed description).

We obtain ﬁve sets of RNA-seq samples by mixing the six hESC samples
in the informative group with other samples in diﬀerent combinations (Table
4). Because MSIQ has the best performance among all the three non-oracle
MSIQ-based estimation methods (MSIQ, MSIQa and MSIQp) in the sim-
ulation studies in Section 3.1, we only use MSIQ in the real data studies.
We compare MSIQ with direct averaging (AVG) and pooling (POOL) on
these ﬁve sets of real RNA-seq samples to estimate the isoform proportions
in the informative group (hESC). We consider MSIQ’s estimated isoform
proportions ˆαMSIQ on set 1 as the standard, because set 1 only contains the
six hESC samples. Then the estimation results of MSIQ, AVG and POOL on
sets 2 to 5 are compared with this standard, and REE rates are calculated

24

W. LI ET AL.

Fig 9: REE rates of MSIQ, averaging and pooling on sets 2 to 5. We use these three
estimators to perform isoform quantiﬁcation on sets 2 to 5 and calculate REE by treating
ˆαMSIQ on set 1 as the standard.

Table 5: REE rates of the three estimators on real data. For sets 2 to 5, median REE
rates calculated based on set 1 are listed. The 3rd quartiles of the error rates are listed in
parentheses.

set ID

MSIQ

AVG

2
3
4
5

4.37 (34.3)
8.27 (106)
19.3 (222)
21 (201)

64.83 (442.9)

2121.17 (16406 )
2164.7 (11062)
2255 (13727)

POOL

14.91 (107.2)
378.33 (2017)
557.9 (3802)
722 (3607)

accordingly.

In our study, the true mRNA isoform structures are extracted from the
Homo sapiens annotation (February 2009) of the UCSC Genome Browser
(Rosenbloom et al., 2015). According to the annotation, there are 15, 268
human genes with multiple isoforms. Fig 5B summarizes the distribution of
the numbers of exons and isoforms of these genes. For each set of samples,
we only estimate the isoform proportions of the genes that have reads in all
the samples. As a result, isoform proportions are estimated for 13,140 genes
in sets 1 and 2, 511 genes in set 3, 629 genes in set 4, and 598 genes in set 5.
For each sample, we only perform the estimation for genes that have reads
in all the samples. As a result, isoform proportions are calculated for 11, 091
genes in sample 1 and sample 2, 389 genes in sample 3, 465 genes in sample
4, and 447 genes in sample 5.

Comparing the REE rates of MSIQ, AVG, and POOL in Table 5 and Fig
9, we clearly see that MSIQ achieves the lowest median error rates and the
smallest inter-quantile ranges on all the sets 2 to 5. This result is strong

02004006008001000REEMSIQAVGPOOL05000100001500020000REE05000100001500005000100001500020000set 2 vs. set 1REEREEMSIQAVGPOOLMSIQAVGPOOLMSIQAVGPOOLset 3 vs. set 1set 4 vs. set 1set 5 vs. set 1ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

25

evidence supporting the eﬀectiveness of MSIQ in identifying the informative
group and estimating its isoform proportions. Among all three methods,
AVG is most sensitive to the mixing of samples not in the informative group.

4. Discussion and conclusion.

In this paper, we propose a new method

MSIQ to more accurately estimate isoform expression levels in a biolog-
ical condition of interest from multiple RNA-seq data. Accurate isoform
quantiﬁcation from RNA-seq data has long been a challenge because the
existence of multiple isoforms makes it impossible to uniquely assign many
reads and determine the reads’ isoform origins. MSIQ tackles this challenge
by utilizing data from multiple RNA-seq samples of the same biological
condition, reasoning that aggregating more information can improve accu-
racy in isoform abundance estimation. Unlike previous work that treats all
the samples equally, MSIQ identiﬁes an informative group of samples that
are most representative of the biological condition, and estimates isoform
proportions of the informative group.

Applications of MSIQ to both simulated and real data demonstrate that
MSIQ gives more accurate isoform quantiﬁcation than direct averaging or
pooling methods given the existence of bad quality or mislabeled samples.
These results suggest MSIQ’s potential as a powerful and robust transcrip-
tomic tool for isoform expression quantiﬁcation.

An important step in our MSIQ method is the identiﬁcation of the infor-
mative group, which depends on posterior draws of the hidden state vari-
ables. We currently use a Beta-Bernoulli model to describe the probability of
each sample belonging to the informative group. Yet, it is possible to improve
the model once gold standard data (i.e., qPCR) for the relevant biological
condition become available (Adamski et al., 2014; Li and Dewey, 2011).
We can extend our MSIQ model to account for the heterogenous quality of
multiple RNA-seq samples based on the similarity of the isoform abundance
estimates of each sample and the gold standard. Such quality assessment
can be integrated with the inter-sample similarity to better identify the
samples in the informative group. As a result, the samples that have higher
agreement with gold standards and high similarity with each other will be
more likely to be considered as in the informative group. This procedure
is supposed to identify more reliable samples and potentially increase the
re-use of public RNA-seq data as it will provide an interpretable measure of
the quality of multiple RNA-seq data sets.

Another interesting extension of our MSIQ method is to model single-cell
RNA-seq (scRNA-seq) data, which contain information on the technical and
biological noise of isoform abundance at the single-cell level (Wu et al., 2014;

26

W. LI ET AL.

Macaulay and Voet, 2014). scRNA-seq data are in great need in the analysis
of (1) subpopulations of cells from a larger heterogeneous population and (2)
rare cell types, for which suﬃcient material cannot be obtained for conven-
tional RNA-seq experiments (Mortazavi et al., 2008). Given scRNA-seq data
of multiple cells from the same population, MSIQ can be iteratively utilized
to evaluate the transcriptional heterogeneity and detect subpopulations (the
informative groups) in the set of samples. Meanwhile, MSIQ can also reveal
the principal isoform expression pattern in the given cell population. An
alternative approach is to allow more than one informative group to be
subpopulations of single cells in the modeling.

APPENDIX A: THEOREM AND LEMMA APPENDIX

We introduce some results on the convergence of the Gibbs sampler to
assist the proof of Lemma 2.1 in Section 2.7. Please see Roberts and Smith
(1994) for the proof of these results.

Theorem A.1. Suppose (X (0), X (1), . . . , X (t), . . . ), X (t) ∈ O ⊆ Rn be a
Markov chain with transition kernel K w.r.t a σ-ﬁnite measure ν, and π is
an invariant distribution of this Markov chain. If the transition kernel K is
π-irreducible and aperiodic, then for all x ∈ Q = {x ∈ O : π(x) > 0}, as
t → ∞,

(i) |K(t)(x,·)−π| → 0, where K(t)(x,·) is the density of x(t) given X (0) =

x;

(ii) for real-valued, π-integrable function f ,

t(cid:88)

f

1
t

(cid:16)

x(i)(cid:17) →

(cid:90)

i=1

O

f (x)π(x)dν(x) a.s..

Lemma A.1.

If ν is discrete, then K is well-deﬁned and π-irreducibility

of K is a suﬃcient condition for the results of Theorem A.1.

Lemma A.2.

If ν is n-dimentional Lebesgue measure, and π is lower

semicontinuous at 0, then K is well-deﬁned.

APPENDIX B: FIGURE AND TABLE APPENDIX

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

27

Fig B1: Workﬂow of an RNA-seq experiment. The ﬁrst step is to break full-length mRNA
transcripts into short fragments, because the current state-of-the-art sequencing machines
have various length limits on their input nucleotide sequences. To stabilize the resulting
short single-stranded RNA fragments, they are reversely transcribed into double-stranded
complementary DNAs (cDNAs). Then adapters are added to both ends to ease the later
sequencing step. Since some cDNA fragments are rare and might not be captured in
sequencing, the polymerase chain reaction (PCR) technique is used to amplify the copies of
each cDNA fragment to achieve stronger sequencing signals. After this ampliﬁcation step,
a fragment size selection step via gel electrophoresis is used to ﬁlter out cDNA fragments
that are too short or too long to be accurately sequenced, and only the fragments with
lengths in a reasonable range (typically 400 ± 20 base pairs (bp) in Illumina sequencing
(Illunima, Inc., 2011)) will be kept for the later sequencing. Finally, in the sequencing
step, short sequences, starting from the ligated adapters and extending into the actual
fragment sequences, will be captured by the sequencing machine from the two ends of
double-stranded cDNA fragments.

full-length mRNA  RNA fragmentation  cDNA reverse transcription sequence adaptors ligation PCR amplification fragment size selection single-end sequencing paired-end sequencing single-end RNA-seqreads paired-end RNA-seqreads and/or28

W. LI ET AL.

Fig B2: Relative estimation error (REE) rates of the seven estimators in scenario 1-5.
REE rate are calculated on 3,421 ﬂy genes with 3-98 exons. In each boxplot, the REE
rates of MSIQ, AVG*, MSIQa, AVG, POOL*, MSIQp, and POOL are plotted side by
side under each scenario and the whiskers extend to the most extreme REE rates. The
top-right legend of each plot displays the parameter setting: the mean fragment length
(F) and the read length (R).

Table B1: Description of the RNA-seq data sets used in the real data study.

replicate ID cell/tissue

1
2
3
4
5
6
7
8
9

10-14
15-19
20-24

hESC
hESC
hESC
hESC
hESC
hESC
Brain
Brain
Brain

/
/
/

data type
real data
real data
real data
real data
real data
real data
real data
real data
real data

simulated data
simulated data
simulated data

76×2

read length
35×2 & 36×2
35×2 & 36×2

76×2
101×2
101×2
50×2
50×2
50×2
36×2
76×2
101×2

GEO accession number

GSM758566
GSM517435
GSM517435
GSM958733
GSM958743
GSM1153528

GSE19166
GSE19166
GSE19166

/
/
/

024681012REE024681012140246810REE024681012scenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5scenario 1scenario 2scenario 3scenario 4scenario 5MSIQAVG*MSIQaAVGPOOL*MSIQpPOOLF=150 bpR=50 bpF=250 bpR=50 bpF=150 bpR=100 bpF=250 bpR=100 bpISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

29

ACKNOWLEDGEMENTS

Dr. Jingyi Jessica Li was supported by the start-up fund of the UCLA
Department of Statistics and the Hellman Fellowship. Dr. Shihua Zhang
was supported by the National Natural Science Foundation of China, No.
61379092, 61422309, the Outstanding Young Scientist Program of CAS and
the Key Laboratory of Random Complex Structures and Data Science,
CAS (No. 2008DP173182). We thank Katherine R. McLaughlin at UCLA
Department of Statistics for commenting on our work.

REFERENCES

Adamski, M. G., P. Gumann, and A. E. Baird (2014). A method for quantitative analysis
of standard and high-throughput qpcr expression data based on input sample quantity.
PloS one 9 (8), e103917.

Behr, J., A. Kahles, Y. Zhong, V. T. Sreedharan, P. Drewe, and G. R¨atsch (2013). Mitie:
Simultaneous rna-seq-based transcript identiﬁcation and quantiﬁcation in multiple
samples. Bioinformatics 29 (20), 2529–2538.

Goedert, M., M. Spillantini, R. Jakes, D. Rutherford, and R. Crowther (1989). Multiple
isoforms of human microtubule-associated protein tau: sequences and localization in
neuroﬁbrillary tangles of alzheimer’s disease. Neuron 3 (4), 519–526.

Harrow, J., A. Frankish, J. M. Gonzalez, E. Tapanari, M. Diekhans, F. Kokocinski, B. L.
Aken, D. Barrell, A. Zadissa, S. Searle, et al. (2012). Gencode: the reference human
genome annotation for the encode project. Genome research 22 (9), 1760–1774.

Jiang, H. and W. H. Wong (2009). Statistical inferences for isoform expression in rna-seq.

Bioinformatics 25 (8), 1026–1032.

Kanitz, A., F. Gypas, A. J. Gruber, A. R. Gruber, G. Martin, and M. Zavolan (2015).
inference of transcript

Comparative assessment of methods for the computational
isoform abundance from rna-seq data. Genome biology 16 (1), 1–26.

Katz, Y., E. T. Wang, E. M. Airoldi, and C. B. Burge (2010). Analysis and design of
rna sequencing experiments for identifying isoform regulation. Nature methods 7 (12),
1009–1015.

Kent, W. J., C. W. Sugnet, T. S. Furey, K. M. Roskin, T. H. Pringle, A. M. Zahler, and
D. Haussler (2002). The human genome browser at ucsc. Genome research 12 (6),
996–1006.

Li, B. and C. N. Dewey (2011). Rsem: accurate transcript quantiﬁcation from rna-seq

data with or without a reference genome. BMC bioinformatics 12 (1), 323.

Li, J. J., C.-R. Jiang, J. B. Brown, H. Huang, and P. J. Bickel (2011). Sparse linear
modeling of next-generation mrna sequencing (rna-seq) data for isoform discovery and
abundance estimation. Proceedings of the National Academy of Sciences 108 (50),
19867–19872.

Lin, Y.-Y., P. Dao, F. Hach, M. Bakhshi, F. Mo, A. Lapuk, C. Collins, and S. C. Sahinalp
(2012). Cliiq: Accurate comparative detection and quantiﬁcation of expressed isoforms
in a population. In Algorithms in Bioinformatics, pp. 178–189. Springer.

Macaulay, I. C. and T. Voet (2014). Single cell genomics: advances and future perspectives.

PLoS Genet 10 (1), e1004126.

Mortazavi, A., B. A. Williams, K. McCue, L. Schaeﬀer, and B. Wold (2008). Mapping
and quantifying mammalian transcriptomes by rna-seq. Nature methods 5 (7), 621–628.

30

W. LI ET AL.

Pachter, L. (2011). Models for transcript quantiﬁcation from rna-seq. arXiv preprint

arXiv:1104.3889 .

Patro, R., S. M. Mount, and C. Kingsford (2014). Sailﬁsh enables alignment-free isoform
quantiﬁcation from rna-seq reads using lightweight algorithms. Nature biotechnol-
ogy 32 (5), 462–464.

Pruitt, K. D., G. R. Brown, S. M. Hiatt, F. Thibaud-Nissen, A. Astashyn, O. Ermolaeva,
C. M. Farrell, J. Hart, M. J. Landrum, K. M. McGarvey, et al. (2014). Refseq: an update
on mammalian reference sequences. Nucleic acids research 42 (D1), D756–D763.

Quail, M. A., M. Smith, P. Coupland, T. D. Otto, S. R. Harris, T. R. Connor, A. Bertoni,
H. P. Swerdlow, and Y. Gu (2012). A tale of three next generation sequencing platforms:
comparison of ion torrent, paciﬁc biosciences and illumina miseq sequencers. BMC
genomics 13 (1), 1.

Roberts, A. and L. Pachter (2013). Streaming fragment assignment for real-time analysis

of sequencing experiments. Nature methods 10 (1), 71–73.

Roberts, G. O. and A. F. Smith (1994).

Simple conditions for the convergence of
the gibbs sampler and metropolis-hastings algorithms. Stochastic processes and their
applications 49 (2), 207–216.

Rosenbloom, K. R., J. Armstrong, G. P. Barber, J. Casper, H. Clawson, M. Diekhans,
T. R. Dreszer, P. A. Fujita, L. Guruvadoo, M. Haeussler, et al. (2015). The ucsc
genome browser database: 2015 update. Nucleic acids research 43 (D1), D670–D681.

Rossell, D., C. S.-O. Attolini, M. Kroiss, and A. St¨ocker (2014). Quantifying alternative
splicing from paired-end rna-sequencing data. The annals of applied statistics 8 (1),
309.

Sakharkar, M. K., V. T. Chow, and P. Kangueane (2004). Distributions of exons and

introns in the human genome. In silico biology 4 (4), 387–393.

Steijger, T., J. F. Abril, P. G. Engstr¨om, F. Kokocinski, T. J. Hubbard, R. Guig´o,
J. Harrow, P. Bertone, R. Consortium, et al. (2013). Assessment of transcript
reconstruction methods for rna-seq. Nature methods 10 (12), 1177–1184.

Tasnim, M., S. Ma, E.-W. Yang, T. Jiang, and W. Li (2015). Accurate inference of isoforms

from multiple sample rna-seq data. BMC genomics 16 (Suppl 2), S15.

Illunima, Inc. (2011). Paired-end sample preparation guide.
Trapnell, C., L. Pachter, and S. L. Salzberg (2009). Tophat: discovering splice junctions

with rna-seq. Bioinformatics 25 (9), 1105–1111.

Trapnell, C., B. A. Williams, G. Pertea, A. Mortazavi, G. Kwan, M. J. Van Baren, S. L.
Salzberg, B. J. Wold, and L. Pachter (2010). Transcript assembly and quantiﬁcation
by rna-seq reveals unannotated transcripts and isoform switching during cell diﬀeren-
tiation. Nature biotechnology 28 (5), 511–515.

Wang, Z., M. Gerstein, and M. Snyder (2009). Rna-seq: a revolutionary tool

for

transcriptomics. Nature Reviews Genetics 10 (1), 57–63.

Wu, A. R., N. F. Neﬀ, T. Kalisky, P. Dalerba, B. Treutlein, M. E. Rothenberg, F. M.
Mburu, G. L. Mantalas, S. Sim, M. F. Clarke, et al. (2014). Quantitative assessment
of single-cell rna-sequencing methods. Nature methods 11 (1), 41–46.

Ye, Y. and J. J. Li (2016). Nmfp: a non-negative matrix factorization based preselection
method to increase accuracy of identifying mrna isoforms from rna-seq data. BMC
Genomics 17 (1), 127.

Zhang, J., C.-C. J. Kuo, and L. Chen (2014). Wemiq: an accurate and robust isoform

quantiﬁcation method for rna-seq data. Bioinformatics, btu757.

ISOFORM QUANTIFICATION ON MULTIPLE RNA-SEQ SAMPLES

31

Wei Vivian Li
Department of Statistics
8125 Math Sciences Bldg.
University of California, Los Angeles
Los Angeles, CA 90095-1554
E-mail: liw@ucla.edu

Anqi Zhao
Department of Statistics
Science Center 7th floor
One Oxford Street
Harvard University
Cambridge, MA 02138-2901
E-mail: anqizhao@fas.harvard.edu

Shihua Zhang
Institute of Applied Mathematics
Academy of Mathematics and Systems Science
Chinese Academy of Sciences
No.55, Zhongguancun East road
Beijing 100190, China
E-mail: zsh@amss.ac.cn

Jingyi Jessica Li
Department of Statistics
8125 Math Sciences Bldg.
University of California, Los Angeles
Los Angeles, CA 90095-1554
E-mail: jli@stat.ucla.edu

