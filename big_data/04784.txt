6
1
0
2

 
r
a

 

M
5
1

 
 
]

M

I
.

h
p
-
o
r
t
s
a
[
 
 

1
v
4
8
7
4
0

.

3
0
6
1
:
v
i
X
r
a

Mon. Not. R. Astron. Soc. 000, 000–000 (0000)

Printed 16 March 2016

(MN LATEX style ﬁle v2.2)

Radio Weak Lensing Shear Measurement in the Visibility
Domain - I. Methodology

M. Rivi1,2(cid:63), L. Miller2, S. Makhathini3,4 and F.B. Abdalla1,3
1Department of Physics and Astronomy, University College London, Gower Street, London, WC1E 6BT, UK
2Astrophysics, Department of Physics, University of Oxford, Keble Road, Oxford, OX1 3RH, UK
3Department of Physics and Electronics, Rhodes University, PO Box 94, Grahamstown, 6140, South Africa
4SKA South Africa

16 March 2016

ABSTRACT
The high sensitivity of the new generation of radio telescopes such as the Square
Kilometre Array (SKA) will allow cosmological weak lensing measurements at radio
wavelengths that are competitive with optical surveys. We present an adaptation to
radio data of lensﬁt, a method for galaxy shape measurement originally developed
and used for optical weak lensing surveys. This likelihood method uses an analytical
galaxy model and makes a Bayesian marginalisation of the likelihood over uninterest-
ing parameters. It has the feature of working directly in the visibility domain, which
is the natural approach to adopt with radio interferometer data, avoiding systematics
introduced by the imaging process. As a proof of concept, we provide results for visibil-
ity simulations of individual galaxies with ﬂux density S (cid:62) 10µJy at the phase centre
of the proposed SKA 1-MID baseline conﬁguration, adopting 12 frequency channels
in the band 950 - 1190 MHz. Weak lensing shear measurements from a population
of galaxies with realistic ﬂux and scalelength distributions are obtained after uniform
gridding of the raw visibilities. Shear measurements are expected to be aﬀected by
‘noise bias’: we estimate the bias in the method as a function of signal-to-noise ra-
tio (SNR). We obtain additive and multiplicative bias values that are comparable to
SKA 1 requirements for SNR > 18 and SNR > 30, respectively. The multiplicative bias
for SNR > 10 is comparable to that found in ground-based optical surveys such as
CFHTLenS, and we anticipate that similar shear measurement calibration strategies
to those used for optical surveys may be used to good eﬀect in the analysis of SKA
radio interferometer data.
Key words: Gravitational lensing, radio interferometry, simulations, SKA.

1 INTRODUCTION

Weak gravitational lensing is the coherent deformation in
the apparent shapes of galaxies due to the deﬂection of light
rays by large-scale foreground matter distributions (see Kil-
binger 2015 for an overview). The measure of this distortion
on cosmological scales is a powerful technique for estimat-
ing the total mass distribution and the relationship between
the distributions of dark and baryonic matter. Its combina-
tion with redshift measurements can provide cosmological
constraints on the density of dark matter and, through the
growth of large-scale structure, also on the dark energy com-
ponent of the universe. Combination with other cosmological
measurements may allow tests for modiﬁcations of General
Relativity.

Observationally, this ﬁeld has been served so far by op-
tical surveys since its initial detection (Bacon et al. 2000;
Wittman et al. 2000; Kaiser et al. 2000; Van Waerbeke et al.
2000), owing to the larger number densities of faint galaxies
achieved in such surveys. Moreover, the redshift distribu-
tion of faint radio-detected galaxies is not known accurately,
making the interpretation of the measurement very chal-
lenging. However, the new generation of radio telescopes,
such as the Square Kilometre Array (SKA)1, are expected
to reach suﬃcient sensitivity to resolve radio emission of
ordinary galaxies and therefore provide a large number den-
sity. For example, SKA will reach number densities of up to
∼ 3 galaxies/arcmin2 in Phase 1 and ∼ 10 galaxies/arcmin2
in Phase 2. This will lead weak lensing to become one of the
primary science drivers in radio surveys too, with the advan-

(cid:63) E-mail: m.rivi@ucl.ac.uk

c(cid:13) 0000 RAS

1 https://www.skatelescope.org/

2

Rivi et al.

tage that they will access the largest scales in the Universe
going beyond optical surveys, such as LSST2 and Euclid3, in
terms of redshifts that are probed. Source redshifts will be
available, although not at high redshifts, from HI 21 cm line
observations (Blake et al. 2004; Yahya et al. 2015; Abdalla
et al. 2015), and photometric redshifts should be available
from cross-correlation with faint multiband optical surveys
such as LSST. Furthermore, the radio waveband may oﬀer
unique approaches that are not available to optical surveys
and may be used to reduce or mitigate some of the system-
atic eﬀects encountered in weak lensing cosmology. First, the
Point Spread Function (PSF) of a radio interferometer, un-
certainty in which is one of the biggest causes of systematic
errors in ground-based optical surveys, is largely determined
by the known placement of antennas, and PSF variations at
mid-frequencies caused by ionospheric/tropospheric phase
perturbations are expected to be smaller than PSF varia-
tions in ground-based optical surveys. Second, it may be
possible to use polarized emission as an estimator of the
intrinsic (unlensed) galaxy orientation, although the limit-
ing ﬂux density, and hence galaxy number density, would be
compromised in such an analysis. Gravitational lensing does
not change the position angle of the polarization emission of
a galaxy and polarization is correlated with the disk struc-
ture of the galaxy (Brown & Battye 2011; Whittaker et al.
2015). This technique may be used to eﬀectively measure or
correct for intrinsic galaxy alignments (Joachimi et al. 2015),
which is likely to be one of the main astrophysical biases
of weak lensing measurements, and may potentially reduce
shear measurement systematics. HI rotational velocity mea-
surements may also be used to reduce the impact of shape
noise and intrinsic alignments. The idea, suggested by Blain
(2002) and Morales (2006), is to measure the departure from
perpendicularity of the rotation axis of a disk galaxy to the
major axis of the galaxy disk image and use this measure as
an estimate of the shear ﬁeld at the galaxy’s position (see
also Huﬀ et al. 2013). Finally, by cross-correlating the shear
estimators of optical and radio surveys, uncorrelated system-
atic errors may be mitigated (Patel et al. 2010; Demetroullas
& Brown 2016; Harrison et al. 2016). For a general overview
of radio weak lensing see Brown et al. (2015).

However, the large ﬁeld of view together with the new
sensitivity regime of instruments such as SKA will need
a more detailed treatment of the systematics of radio ob-
servations. New analysis techniques and algorithm devel-
opment may be required, in particular the development of
highly accurate shape or shear estimation techniques suit-
able for a radio interferometry dataset. Initial steps are be-
ing taken by a number of SKA pathﬁnders and precursor
telescopes. For example the UK e-MERLIN legacy projects
e-MERGE4 and SuperCLASS5 will act as training exper-
iments for algorithms on long-baseline high-resolution ob-
servations. Other projects are planned with the upgraded
JVLA interferometer: the VLASS6 survey (Brown et al.
2013) and the CHILES7 continuum and HI surveys. Large

2 http://www.lsst.org/
3 http://www.euclid-ec.org/
4 http://www.e-merlin.ac.uk/legacy/projects/emerge.html
5 http://www.e-merlin.ac.uk/legacy/projects/superclass.html
6 https://science.nrao.edu/science/surveys/vlass
7 http://www.mpia-hd.mpg.de/homes/kreckel/CHILES/index.html

scale surveys with the LOFAR8 telescope and with the SKA
pathﬁnder telescopes, MeerKAT9 and ASKAP10 will also
oﬀer interesting opportunities for radio weak lensing studies
in the run-up to Phase 1 of the SKA.

Currently, techniques available for the measurement of
galaxy shapes are based on measurement of galaxy images,
as they were developed for optical surveys. The state-of-
the-art in optical lensing measurements ﬁts model surface
brightness distributions to galaxies and combine these mea-
surements to form an estimate of the cosmic shear. For a
summary, see Mandelbaum et al. (2015). Radio interferom-
eters do not provide directly images of the observed sky,
they measure visibility data instead, that basically are the
Fourier transform of the sky image at sampled points in the
Fourier (uv) domain. Such points correspond to the pro-
jected baseline formed between two antennas on the plane
orthogonal to the antennas pointing direction (usually also
the adopted phase centre), and the locus traced by them dur-
ing an observation as the Earth rotates yields the uv data
whose Fourier transform is the PSF. The standard procedure
adopted for turning visibility data into images via PSF de-
convolution, such as CLEAN (Högbom 1974; Schwarz 1978),
is a non-linear process and the noise in radio images is highly
correlated. Weak lensing has stringent requirements on im-
age ﬁdelity because source ellipticities must be measured
accurately in order for errors on cosmological parameters to
be dominated by statistics, rather than systematics. An in-
vestigation using images simulated through a radio pipeline
presented in Patel et al. (2014), for eMERLIN and LOFAR,
and used in Patel et al. (2015) for SKA1, shows that cur-
rent iterative deconvolution methods produce images with
structures in the residuals that dominate the cosmological
signal, producing an analysis-induced bias far from what is
required. Therefore, accurate methods for radio weak lens-
ing should measure source shapes in the visibility domain,
avoiding image reconstruction. Moreover, in this domain the
noise is gaussian and there may be essentially perfect mod-
elling of the sampling function. Such methods should take
into account the computational challenges due to the fact
that sources are no longer localised in the Fourier domain,
which may require joint ﬁtting, and the number of visibilities
for a telescope such as SKA is very large.

At present, the only radio weak lensing studies in
the visibility domain have used shapelets (Refregier 2003),
where galaxy shapes are decomposed through an orthonor-
mal basis of
functions corresponding to perturbations
around a circular gaussian. The ﬁrst study, Chang et al.
(2004), used data from the Faint Images of the Radio Sky
at Twenty cm (FIRST) survey (Becker et al. 1995) con-
ducted with the VLA. Shapes of radiogalaxies were obtained
directly from the visibilities (Chang & Refregier 2002) as
shapelets are invariant under Fourier transform (up to a
rescaling). A treatment of systematics that may aﬀect the
radio lensing shear estimates was also included, allowing a
3.6σ detection of cosmic shear. The second more recent work
is presented in Patel et al. (2015), where an initial analy-
sis of the performance of visibility plane shapelets is pro-

8 http://www.lofar.org
9 http://www.ska.ac.za/meerkat/
10 http://www.atnf.csiro.au/projects/askap

c(cid:13) 0000 RAS, MNRAS 000, 000–000

Radio weak lensing shear measurement

3

intrinsic, complex source ellipticity es can be attributed to a
galaxy. If we deﬁne ellipticity e = (a− b)/(a + b), for galaxy
major axis a and minor axis b, then the observed ellipticity
under the gravitational lens mapping is given by (Seitz &
Schneider 1997):

e =

es + g
1 + g∗es ,

(3)

where both ellipticity and shear are deﬁned as complex num-
bers encoding the shape in the absolute value and the ori-
entation in the phase, i.e. e = e exp (2iθ).
Under the assumption of randomly oriented galaxies,
(cid:104)es(cid:105) = 0, the observed ellipticity is an estimator of the grav-
itational shear: (cid:104)e(cid:105) = g (cid:39) γ, in the weak lensing regime
|γ|, κ (cid:28) 1. The typical distortion of high-redshift galaxies by
the gravitational potential is much smaller than the intrinsic
dispersion in galaxy shapes (σe = (cid:104)|e|2(cid:105)1/2 ∼ 0.3). Thus, for
an individual galaxy, the lensing eﬀect is not detectable and
one needs to average over a large number of galaxies N to
obtain suﬃcient signal-to-noise ratio SNR(cid:39) g × N 1/2/σe.
The shear is estimated as a weighted average of the
galaxies’ ellipticities. Statistical weights take into account
that faint galaxies have broader likelihood surfaces (i.e.
larger measurement errors) than bright galaxies. We calcu-
late an approximate inverse-variance weight as deﬁned in
Sect. 3.6 in Miller et al. (2013):

(cid:104) σ2

i e2

wi =

max

max − 2σ2
e2

i

+ σ2

pop

(cid:105)−1

(4)

where emax is the maximum allowed ellipticity (as measured
in the same paper for the prior ellipticity distribution), σ2
i
is the 1D variance of the likelihood L(yi|ei) for the i-th
galaxy (measurement noise of galaxy i) and σ2
pop is the 1D
variance of the ellipticity distribution of the observed galaxy
population (shape noise). We deﬁne these 1D variances as
the square root of the covariance matrix determinant. Notice
that, in the limit where emax → ∞, this deﬁnition of the
weights tends to a conventional form wi → (σ2
pop)−1.

i + σ2

vided from SKA1 simulations. Conceptual concerns about
shapelets method were already raised in the optical surveys
because such models do not represent galaxy shapes in a
realistic way, that takes into account knowledge of galaxy
structure (e.g., Kitching et al. 2012). Their strength is the
ability to describe details of individual galaxy images, but
a better description of disc galaxy shapes (the only com-
ponent of interest in radio observations) is an exponential
surface brightness proﬁle, i.e. Sérsic index n = 1, and opti-
mal shape measurement algorithms should make use of that
knowledge.

In this paper we present an adaptation to the visibil-
ity domain of lensﬁt, a model ﬁtting approach developed
by Miller et al. (2007) and Kitching et al. (2008) for optical
surveys, recently used to measure galaxy shapes (Miller et al.
2013) in the CFHTLensS (Heymans et al. 2012), CS82 (Er-
ben et al., in preparation), KiDS (Kuijken et al. 2015) and
RCSLenS (Hildebrandt et al., in preparation) surveys. That
analysis assumed galaxies to comprise two components, disk
and bulge, however at radio wavelengths we expect the ra-
dio emission from the normal galaxies found at faint ﬂux
densities to be dominated by the interstellar medium in the
disk alone. Accordingly, in our adaption to the radio band,
the method models galaxy shapes using an exponential pro-
ﬁle and applies a Bayesian marginalisation of the likelihood
over uninteresting parameters. We directly estimate the like-
lihood from the visibility data and deﬁne the model visi-
bilities analytically. As a proof of concept, we present the
method for the shape measurement of a single galaxy at the
phase centre (Sect. 3). We show results obtained from sim-
ulations of visibilities generated by using the SKA1-MID
baseline conﬁguration (details are provided in Sect. 4). In
particular in Sect. 5 we provide an estimate of the shear
bias in the method.

2 WEAK LENSING SHEAR ESTIMATION
The weak lensing signal is carried by the faintest star form-
ing (SF) galaxies. The radiation emitted by such galaxies is
deﬂected in presence of a gravitational potential on the path
to an observer. The deﬂection angle is approximated to ﬁrst
order by the Jacobian matrix Aγ of the mapping between
the source and the observer,

(cid:18)1 − κ − γ1

−γ2

Aγ =

(cid:19)

−γ2

1 − κ + γ1

where κ is the convergence and the change in observed size
of the source, and where γ = γ1 + iγ2 is the gravitational
shear, that quantiﬁes anisotropic stretching, i.e. distortions
of the shape.

In the context of cosmological lensing by large-scale
structures, galaxies are very weakly lensed and the values
of κ and γ are on the order of few percent. Cosmic shear is
based on the measurement of galaxy shapes and therefore
we can factor out (1 − κ) from Aγ and measure the reduced
shear:

g =

γ

1 − k

,

(2)

which has the same polar (i.e. spin-2) transformation prop-
erties as shear.

Galaxies are intrinsically non-circular in general, so an

c(cid:13) 0000 RAS, MNRAS 000, 000–000

(1)

3 THE RADIOLENSFIT METHOD

In the radio implementation of lensﬁt, we apply the method
directly in Fourier space, where the radio interferometer
data is measured. In particular, we use a galaxy model
deﬁned analytically in the visibility domain (Sect. 3.1)
and marginalise the likelihood over uninteresting param-
eters such as ﬂux, galaxy position and galaxy scale-
length (Sect. 3.2). Finally, we sample the resulting likeli-
hood (Sect. 3.3) as a function of the ellipticity parameters
only, in order to estimate the galaxy ellipticity as the like-
lihood mean point and to compute the likelihood standard
deviation as the corresponding measurement noise, σi. This
approach is due to the fact that a likelihood estimator of the
ellipticity of an individual galaxy should respond linearly to
a cosmological shear, whereas a posterior estimation would
lead to a bias in the shear measurement, as discussed by
Miller et al. (2013).

4

Rivi et al.

3.1 Analytical galaxy model in the visibility

domain

In the radio regime galaxy models are deﬁned only by the
disc component, which is well described by the Sérsic expo-
nential brightness proﬁle:

I(r) = I0 exp(−r/α),

(5)
where I0 is the central brightness and α is the scalelength
(i.e. the radius at which intensity drops by e−1). This func-
tion deﬁnes a circular light proﬁle, with coordinates (lr, mr),
that is made elliptical and rotated according to the ellipticity
parameter e = (e1, e2) using the following linear transforma-

(cid:18) 1 − e1

−e2

(cid:19)(cid:18) l

(cid:19)

m

−e2
1 + e1

.

(6)

tion:(cid:18) lr

(cid:19)

= Ax =

mr

The galaxy image obtained can be sampled by computing
the direct Fourier transform at the uv points of the radio
telescope. However, due to the simplicity of this bright-
ness proﬁle, we are able to directly deﬁne this model in the
Fourier space by computing the analytical expression of the
Fourier transform (F) of function (5). Since it is a circularly
symmetric function, its Fourier transform is essentially its
Hankel transform of order zero H(0):
−r/αe

−2πikr cos θrdrdθ

F(I(r))(k) =

(cid:90) ∞

I0e

(cid:90) 2π
(cid:90) ∞

θ=0

r=0

r=0

−r/αJ0(2πkr)rdr
e
= 2πI0
= 2πI0H(0)(e
−r/α)(2πk)
(7)
function of order zero. For
the Bessel
function the Hankel transform is well

is

where J0
the exponential
known (Bracewell 1999):

Therefore

H(0)(e

−ar)(k) =

a

(a2 + k2)3/2 .

F(I(r))(k) =

2πα2I0

(1 + 4π2α2k2)3/2 .

(8)

(9)

Finally, by applying the following result for the composi-
tion of a function with a linear transformation deﬁned by a
matrix A ∈ Rd×d:

1

F(I ◦ A)(k) =

F(I(r))(A

−T k),

(10)
where A−T is the inverse transpose of A, we get the following
expression of the visibility produced by the observed galaxy
at the point k = (u, v):

det A

V (u, v) = F(I ◦ A)(k)

det A(cid:0)1 + 4π2α2|A−T k|2(cid:1)3/2

2πα2I0

=

(11)

In terms of ﬂux density at wavelength λ, we have Sλ =
2πα2I0/ det A. Moreover, if we want to take into account
the source spectrum, to ﬁrst order we can model it using a
single spectral index β as follows:

(cid:16) λref

(cid:17)β

λ

V (u, v) =

(cid:0)1 + 4π2α2|A−T k|2(cid:1)3/2 .

Sλref

(12)

where β = −0.7 for the synchrotron radiation emitted by
the galaxy disc.

3.2 Bayesian marginalisation of the likelihood
The model visibilities depend on 6 parameters: ﬂux S, scale-
length α, centre position c = (l0, m0) and ellipticity (e1, e2).
Since we are interested only in the measurement of the el-
lipticity, we can marginalise over the other parameters. To
compute L we adopt a chi-squared ﬁtting approach in the
frequency domain, where the visibilities are deﬁned:

χ2 = (D − SM )

†

C

−1(D − SM )

†

−1D − 2SD

†

−1M + S2M

†

C

−1M

C

C

= D

(13)

j )j are respectively the
where D = (vj)j and M = (vm
data and model visibilities, and C is the noise covariance
matrix.11 By normalising the model visibilities by a factor
(M†C−1M )−1/2, we can write chi-squared as
S − D†C−1M
−1M )2.
−1(D

−1D +
†

(M†C−1M )1/2

C
− (M

−1M )

χ2 =D

(cid:105)2

(14)

(cid:104)

C

C

†

†

We marginalise the corresponding likelihood over S by as-
suming a uniform prior for the ﬂux. Since the function to be
integrated is Gaussian-like and we expect to be measuring
radio sources that have a signiﬁcant (> 10σ) detection of
their radio ﬂux, we may integrate over the range (−∞,∞)
for which the result of the integration is well-known. There-
fore we have
L = e

−1M )2(cid:105)

−χ2/2 ∝ exp

−1M )

(cid:104) 1

−1(D

(M

C

C

†

†

.

2

C

(M

−1M )

L ∝ exp

The shift parameter x of the model position can be added
in the Fourier domain by multiplying the model visibilities
by a factor eikT x. Therefore
†

(cid:104) 1

−1h(x)2(cid:105)

2
where h(x) = D†C−1(vm
T x)j corresponds to the Fourier
transform of the cross-correlation function in the image do-
main. As discussed by Miller et al. (2007), such a cross-
correlation should be well represented by a 2-dimensional
Gaussian function, therefore by evaluating its maximum
h0 = h(l0, m0) we can approximate h(x) as a real analytical
function.

j eikj

(15)

,

h(x) ∼ h0 exp

(x − c)T Σ

−1(x − c)

(16)

(cid:105)

and use it to analytically marginalise the likelihood over the
position shift parameter assuming a uniform prior.

(cid:104) − 1
(cid:104) − (x − c)T Σ

2

log L = k exp

(cid:105)

−1(x − c)
h2
0
2

(M

†

C

k =

+ const,

(17)

−1M )

−1.

Then by using polar coordinates and a uniform prior P (r)
over the area πr2

max, we have
L(r)P (r)rdr ∝ |Σ|1/2

(cid:90) rmax

(cid:104)

−r2(cid:105)

exp

ke

(cid:90) 2π

(cid:90) rmax

dθ

0

0

r2
max

0

rdr.
(18)

11 In Appendix A we show that for weak sources, as measured in
weak lensing surveys, the visibility noise covariance matrix may
be assumed to be diagonal.

c(cid:13) 0000 RAS, MNRAS 000, 000–000

Following Miller et al. (2013), the maximum position uncer-
tainty rmax over which to marginalise is chosen to be the
position beyond which the detection of the galaxy becomes
statistically insigniﬁcant, e.g. corresponding to the 95% con-
ﬁdence region for the location of the galaxy, according to the
likelihood-ratio test:

= χ2

crit with 2 d.o.f.

(19)

(cid:18)L(rmax)

(cid:19)

L(0)

− 2 log

i.e.

−2k(e

−r2

max − 1) = χ2

crit = 5.991.

Equation (18) is solved, after the substitution t = −ke−r2,
as an exponential integral that can be evaluated numeri-
cally. The cross-correlation maximum point h0 = h(l0, m0)
is computed using the Newton method and |Σ| is obtained
as the inverse of the determinant of the Hessian matrix of
h(x) at the maximum point. Finally, a marginalisation over
a ﬁnite interval [αmin, αmax] of the scalelength is computed
numerically assuming a lognormal prior (see Sect. 4.2).

3.3 Likelihood sampling
In order to measure the ellipticity and its uncertainty for
each galaxy, we measure the likelihood standard deviation
by sampling a neighbourhood of its maximum point.

The likelihood maximum point is computed by applying
the simplex method (Nelder & Mead 1965). We use the im-
plementation of this algorithm provided by the GNU Scien-
tiﬁc Library12 with tolerance tol = 10−3. The starting point
is deﬁned by searching for the maximum posterior as a func-
tion of ellipticity and scalelength, using again the simplex
method. We adopt an adaptive grid sampling: the likelihood
is ﬁrst estimated on a coarse grid of ellipticity values with
step 0.05, then the grid step is iteratively reduced by a fac-
tor 2, until either at least 30 points had been measured above
a threshold of 5% of the maximum likelihood or a resolution
of 0.003 in ellipticity is reached. The likelihood threshold is
also used to deﬁne the size of the neighbourhood where sam-
pling. As an estimate of the galaxy’s ellipticity, we compute
the mean of the likelihood distribution using the ellipticity
samples above the threshold, and for each ellipticity com-
ponent we take as the measurement error the 1D standard
deviation of the likelihood.

4 DATA SIMULATIONS

4.1 SKA1-MID speciﬁcations
In Phase 1, SKA will consist of two sub-arrays: SKA1-LOW
will be an aperture array located in Australia operating at
low radio frequencies, while SKA1-MID will be a dish ar-
ray located in South Africa with up to ﬁve observational
frequency bands spanning the range 350 MHz to 13.8 GHz
(Braun 2014). For weak lensing surveys, SKA1-MID will be
used, as it provides both the sensitivity and the spatial res-
olution to detect shapes on high redshift SF galaxies. It will
comprise 64 MeerKAT dishes in a moderately compact core

12 http://www.gnu.org/software/gsl/

c(cid:13) 0000 RAS, MNRAS 000, 000–000

Radio weak lensing shear measurement

5

Figure 1. SKA1-MID antennas location.

Figure 2. SKA1-MID uv coverage at declination δ = −30◦.

with a diameter of about 1 km and 133 SKA1 dishes dis-
tributed in the core and in three logarithmically spaced spi-
ral arms emanating from the centre and extending out to
a maximum radius of 80 km (see Fig. 1), with a maximum
baseline of 150 km. We simulate an 8-hour observation at
declination δ = −30◦ assuming, for simplicity, that all the
antennas are SKA dishes (so that all the visibilities have
the same noise variance) and adopting a uniform weighting
scheme. We use the ﬁrst 30% of Band 2, i.e. 950 - 1190 MHz
and sample visibilities every τacc = 60 s for 12 channels of
bandwidth 20 MHz. Figure 2 shows a plot of the uv coverage
for our simulations.

4.2 Simulated galaxy visibilities
Since galaxies cannot be individually distinguished in the
visibility domain, in this ﬁrst paper we only simulate visi-
bilities of individual galaxies located at the phase centre, to

6

Rivi et al.

test the eﬀectiveness of the method in this simplest case. Fu-
ture developments will need to jointly ﬁt to multiple galaxies
observed within the primary beam (Sect. 6).

The ﬂux and scalelength of the simulated galaxies are
generated randomly according to the distributions estimated
in Rivi et al. (2016) from the VLA 20 cm continuum radio
source catalog in the SWIRE ﬁeld. The modulus e of the in-
trinsic ellipticities are generated according to a distribution
estimated from 66,762 SDSS disk-dominated galaxies (see
Appendix B2 in Miller et al. (2013)):

N e(cid:0)1 − exp(cid:2) e−emax

c
(1 + e)(e2 + e2
0)1/2

(cid:3)(cid:1)

P (e) =

,

(20)

where emax = 0.804, e0 = 0.0256, c = 0.2539 and N
is a normalisation factor. Optically-selected galaxies are
subject to the eﬀect of luminosity-dependent, inclination-
dependent obscuration, that suppressed the prevalence of
high-ellipticity galaxies in optical surveys. Thus we expect
the ellipticity distribution of radio galaxies to be diﬀerent
from the optical regime, and likely to extend to higher ellip-
ticities, but at the moment we have no information about the
ellipticity distribution of the faintest radio-selected galax-
ies, and for simplicity we use the distributions assumed for
galaxies in optical surveys. Our conclusions on the utility
of the method should not be dependent on this choice. For
each ellipticity modulus value, 10 equally-spaced galaxy ori-
entations are deﬁned, starting from a random angle value
θ0 ∈ (0, π) generated according to a uniform distribution,
so that the corresponding ellipticity values are distributed
uniformly on a circle. Keeping the same size and ﬂux of
the galaxies whose ellipticity values are on the same ring,
the simulations are largely free of shape noise, i.e. the un-
weighted average of the intrinsic ellipticity is identically zero,
(cid:104)es(cid:105) = 0, and the unweighted average of the sheared el-
lipticity yields the input shear to a good approximation:
(cid:104)e(cid:105) (cid:39) g.13 Reduction of shape noise signiﬁcantly reduces
the volume of simulations required to evaluate the shear
measurement accuracy.

Visibilities of real observations are simulated by using
equation (12) as for the model, but adding an uncorrelated
gaussian noise whose variance is dependent on the SEFD of
the SKA antennas (see Appendix A). No time or frequency
smearing eﬀects are included, as the galaxies are assumed
to be located at the phase centre, where such smearing is
negligible.

4.3 Gridding visibilities
Since the number of visibilities are very large (more than
104 per time sample per frequency channel), directly using
all the uv data is very expensive both in terms of memory
size and computational time. For this reason we apply a
gridding scheme to reduce the data volume. We have deﬁned
a regular uv grid of size n × n and taken the average of
the ci observed visibilities falling in the same grid cell i.
This operation reduces the variance (if assumed the same

13 Actually the eﬀectiveness of this shape noise cancellation is
reduced by the SNR dependence on galaxy orientation (because
we do not sample the Fourier modes isotropically), which does
aﬀect the galaxy weights that are used in the shear computation.

for every uv point) of each grid visibility ¯vi = (cid:104)vki(cid:105)ci by a
factor ci and therefore equation (15) becomes:

(cid:34)(cid:2)(cid:80)

L ∝ exp

(cid:3)2

(cid:35)

(cid:80)
i (cid:60)(¯v∗
i e−ikx)ci
i vm
i |vm
i |2ci
2σ2
v

.

(21)

Model visibilities are sampled on the gridded uv points and
only non zero visibilities of the grid are considered. Usually
the cell size is chosen to be ∆u = ∆v = 1/ψ, where ψ is the
intended ﬁeld-of-view of one beam at the band centre. This
choice would minimise the number of cells avoiding smear-
ing at large scales, which mimic primary beam attenuation.
However for our speciﬁc case (one galaxy at the phase cen-
tre) we can consider a coarser grid. By testing the shape
ﬁtting for the same visibilities with diﬀerent grid sizes, we
obtain n = 800 as the smallest size we can use (see Rivi
et al. 2016).

4.4 Code implementation
The C++/C code implemented for simulating visibility data
and ﬁtting galaxy shapes is available online14. It has been
parallelized in a hierarchical way by using the Message Pass-
ing Interface15 (MPI) and OpenMP16 parallel programming
paradigms, enabling the user to exploit HPC architectures.
The ﬁrst level of parallelisation (MPI) simply distributes the
simulated galaxies among diﬀerent nodes/multi-core proces-
sors, each simulating and performing the model ﬁtting of its
own chunk of galaxies. In the second level (OpenMP), each
thread computes visibilities for a diﬀerent channel, which is
the most computing intensive part of the code. The main
reason for such hybrid implementation is to exploit all the
CPU cores used when a large amount of RAM is required.
This happens in the realistic case where galaxies are located
randomly in the ﬁeld of view because visibilities must be
gridded in a very large grid and the uv sampling before
gridding must be higher, to minimize time and frequency
smearing eﬀects.

5 RESULTS
We simulate populations of individual galaxies whose ﬂux
densities lie in the interval 10 − 200µJy, corresponding to
SNR17 (cid:62) 10, and compare input and measured galaxy ellip-
ticity values. This ﬂux range has been chosen because of the
telescope sensitivity (lower bound) and in order to simulate
faint galaxies with redshift z > 0.5 (upper bound), the most
relevant ones for radio weak lensing (Harrison et al. 2016).
Fig. 3 shows measurements of both ellipticity compo-
nents for each simulated galaxy. The slopes of the best-ﬁt
lines are respectively 0.9065 ± 0.0060 and 0.9807 ± 0.0059.
As expected, at higher signal-to-noise ratios (see Fig. 4 for
a population with galaxy ﬂux S > 50µJy), there is a better

14 http://github.com/marziarivi/RadioLensﬁt
15 http://www.mpi-forum.org/
16 http://openmp.org/
17 We compute the signal-to-noise ratio in the visibility domain
as SNR =
i , where vi are the visibilities without
noise.

(cid:113)(cid:80)nvis

i=1 |vi|2/σ2

c(cid:13) 0000 RAS, MNRAS 000, 000–000

Radio weak lensing shear measurement

7

Figure 3. Plots for both components of 1000 galaxy shapes ﬁtting
input sources with ﬂux density S (cid:62) 10µJy. The left side shows
the likelihood mean and standard deviation of the measured el-
lipticities plotted against the input values. The right sides show
the same values binned.

Figure 5. Distribution of the measurement 1D standard devia-
tion showing the dependence on the source ellipticity and signal-
to-noise ratio.

preparation) and a non-zero additive bias indicates a sys-
tematic error due to eﬀects such as the correlation of noise
bias with the PSF (Miller et al. 2013). We considered 8 dif-
ferent shear orientations and also the case g = 0, as plotted
in Fig. 6.

Shear bias estimates obtained from the best-ﬁt lines of

shape measurements at SNR > 10 are:

Figure 4. Plots for the e1 component of galaxy shapes ﬁtting
input sources with ﬂux S > 50µJy. The right sides show the cor-
responding binned values. Results for e2 component are similar.

correspondence between input and output values. The best-
ﬁt slopes, respectively 0.9914 ± 0.0035 and 0.9864 ± 0.0035,
are closer to unity and measurements have a reduced disper-
sion. Fig. 5 shows a contour plot of the measurement noise
of 104 galaxy shapes highlighting a strong dependence on
the source SNR and ellipticity value. As expected, accurate
model ﬁts are more diﬃcult for round galaxies at low SNR.
To measure the reduced shear g with a statistical un-
certainty of 1%, we generate populations of 104 galaxies. Er-
ror bars correspond to the standard deviation of the shear
values estimated from 1000 bootstrap resamples. Typically,
6% of galaxies are not measured as their likelihoods are too
noisy: these are given zero weight in the analysis. We esti-
mate the shear measurement bias for this method by apply-
ing an input reduced shear with amplitude g = 0.04, so that
we should be in a linear regime of bias measurement. We
compare input and measured shear ellipticity values assum-
ing a linear bias model (Heymans et al. 2006),

i − gi = migi + ci,
gm

i = 1, 2,

(22)

where gm
(resp. gi) is the i-component of the measured
i
(resp. original) value of the input reduced shear, mi and
ci are respectively the multiplicative and additive biases. A
non-zero multiplicative bias indicates calibration errors due
to eﬀects such as noise bias (Melchior & Viola 2012, Re-
fregier et al. 2012) or weight bias (Fenech Conti et al., in

c(cid:13) 0000 RAS, MNRAS 000, 000–000

m1 = 0.101 ± 0.018,
m2 = 0.080 ± 0.018,

c1 = 0.0123 ± 0.0005;
c2 = 0.0073 ± 0.0005.

These results show diﬀerent bias values for the two elliptic-
ity components, probably due to the asymmetry of the uv
coverage (see Fig. 2), conﬁrming a better accuracy on the
second component at low SNR, as for the galaxy shapes.
The top panel of Fig. 6 shows the corresponding plots of
the shear measurements compared with the input values.
Similarly, we compute the shear bias from simulated pop-
ulations with the same parameters distributions but with
diﬀerent lower limit ﬂuxes, in order to investigate its rela-
tion with minimum SNR. The lower panel of Fig. 6 shows
how the shear measurements improve for SNR > 25, where
the measured shear bias is:
m1 = 0.0281 ± 0.0098,
m2 = 0.0318 ± 0.0098,
In Brown et al. (2015), requirements for the shear multi-
plicative and additive bias for SKA and other future optical
surveys are estimated by considering three parameters: sky
area, galaxy median redshift and galaxy number density.
These requirements are set such that cosmological results
are dominated by statistical rather than systematic errors
and therefore they deﬁne an upper limit on the level of bias
allowed. The sensitivity levels have been chosen appropri-
ately for image domain resolution of 0.5 arcsec at Band 2
and the galaxy number densities correspond to > 10σ detec-
tions. For a 2-year continuum survey with SKA1-MID over
5000 deg2 (as proposed for weak lensing in Braun 2014) and
zmed = 1.0, the following constraints are obtained: multi-
plicative bias m < 0.0067, additive bias c < 0.00082. A plot

c1 = 0.00065 ± 0.00026;
c2 = 0.00054 ± 0.00026.

8

Rivi et al.

Figure 6. Shear measurements from which the noise bias is com-
puted; input values are blue points while measured values are red
crosses. Top: SNR > 10. Bottom: SNR > 25.

of the multiplicative and additive shear biases are shown re-
spectively in Fig. 7 and Fig. 8. They show how the measured
bias components decrease as the SNR lower limit increases
up to 40. The additive bias turns to be comparable with
SKA1 requirements for SNR > 18, while the multiplicative
bias starts to be comparable with SKA1 requirements for
SNR > 30.

At the lowest SNR values, the current method displays
a multiplicative noise bias (Melchior & Viola 2012; Refregier
et al. 2012) at about the expected level. We may com-
pare with the correction for shear measurement bias that
was made for CFHTLenS (Heymans et al. 2012). This is
a ground-based optical survey with lensing data in the i-
band for galaxies with SNR (cid:38) 10. Shear was measured us-
ing lensﬁt with a multiplicative bias correction that was de-
pendent on both galaxy signal-to-noise ratio and size. The
weighted average correction was m (cid:39) 0.06, which is compa-
rable to our results. We expect that a post-measurement
shear calibration correction may be applied to the radio
waveband measurements that is comparable to that needed
for the current generation of optical lensing surveys.

The additive bias found in the radio waveband measure-
ments is already close to requirements, but we note that in

Figure 7. Plot for both components of the multiplicative shear
bias for diﬀerent minimum SNR values. They are compared with
SKA1 bias requirements (continuum black line) and CFHTLenS
calibration correction (dash dot line).

Figure 8. Plot for both components of the additive shear bias
for diﬀerent minimum SNR values.

these simulations, an additive bias can only arise from the
anisotropic sampling of the visibility plane. This eﬀectively
results in an anisotropic image domain PSF, and we expect
an additive noise bias component in this case (Miller et al.
2013). However, in radio interferometer data this eﬀect may
be eliminated or mitigated by weighting the samples in the
visibility domain to improve the isotropy of the measure-
ment: an advantage of interferometer measurements that is
not possible with optical lensing surveys. Additive biases are
particularly important on large angular scales in the cos-
mic shear correlation function, and currently residual addi-
tive biases limit the maximum angular scales that may be
probed in cosmological analyses (Heymans et al. 2013; Kil-
binger et al. 2013). In the case of SKA, the visibility domain
anisotropy will be a function of the declination of the ﬁeld
being observed (here we have simulated a ﬁeld that transits

c(cid:13) 0000 RAS, MNRAS 000, 000–000

close to the zenith), so larger isotropy weighting corrections
may be needed at more extreme observation declinations.

6 CONCLUSIONS

We have presented an adaptation to radio observations of
lensﬁt (Miller et al. 2013), an algorithm for shear measure-
ment for optical weak lensing surveys. Our version of the
method, called RadioLensﬁt, works directly in the visibility
domain, where radio interferometer data are observed, and
ﬁts a galaxy model computed analytically as the Fourier
transform of a Sérsic exponential brightness proﬁle.

We tested this method for the simple case of individual
galaxy visibilities using the SKA1-MID baseline conﬁgura-
tion for a continuum survey using the ﬁrst 30% of frequency
Band 2. Simulated galaxies have been located at the phase
centre with ﬂux and scalelength values generated randomly
according to distributions that we have estimated from the
VLA SWIRE catalog. As we have no information about el-
lipticity distributions of faint galaxies in the radio regime,
we have adopted the optical distribution of galaxy elliptic-
ity modulus, while orientations were generated uniformly
around circles in the ellipticity plane in order to be free of
shape noise. We have measured the sensitivity to shear and
estimated the noise bias for the RadioLensﬁt method at var-
ious SNR lower limits.

This work demonstrates that galaxy shape measure-
ment in the visibility domain provides acceptably accurate
values, with multiplicative shear bias on average comparable
with the calibration correction applied in the ground-based
optical survey CFHTLenS, and additive bias comparable
to the requirements on a 5000 deg2 SKA1 survey for SNR
> 18. We have noted that additive biases may be better con-
trolled in radio interferometer data than in optical surveys,
as any anisotropy of the visibility data may be mitigated in
the shape measurement process by suitable weighting of the
measurements.

In this work we have been able to use a coarse grid of
visibilities, as galaxies were located at the phase centre, but
when their positions are random the algorithm would need
to be implemented with ﬁner sampling of the visibility data.
The next step of our investigation will use this method for
simulations where individual galaxies are located randomly
in the ﬁeld of view, rather than being at the phase centre,
and will include frequency and time smearing eﬀects. A full
analysis method should be able to jointly measure the shapes
of all galaxies in the primary beam: we envisage an initial
imaging step would allow identiﬁcation of the locations of all
detected sources in the ﬁeld, and those positions could then
be used to ﬁt models to the visibility data. Although mea-
suring a single galaxy at a time is not a realistic algorithm
for direct measurement of visibility data, such simulations
are still useful to put constraints on the number of output
channels and the visibility grid size, and test whether such
an approach can in principle meet the requirements of a ra-
dio weak lensing survey, and the results presented here are
encouraging in that respect.

c(cid:13) 0000 RAS, MNRAS 000, 000–000

Radio weak lensing shear measurement

9

ACKNOWLEDGEMENTS

MR acknowledges the support of the Science & Technology
Facilities Council via a SKA grant. FBA acknowledges the
support of the Royal Society via a Royal Society URF award.

REFERENCES
Abdalla F. B., Bull P., Camera S., Benoit-Lévy A.,
Joachimi B., et al. 2015, Advancing Astrophysics with the
Square Kilometre Array (AASKA14), arXiv:1501.04035
Bacon D., Refregier A., Ellis A., 2000, MNRAS, 318, 625
Becker R., White R., D.J.Helfand 1995, ApJ, 450, 559
Blain A., 2002, ApjL, 570, L51
Blake C., Abdalla F., Bridle S., Rawlings S., 2004, New
Astron. Rev., 48, 1063
Bracewell R., 1999, The Fourier Transform and Its Appli-
cations, 3rd ed.. McGraw-Hill
Braun R., 2014, SKA Memo
Brown M., Abdalla F., Amara A., Bacon D., Battye R., et
al. 2013, VLASS White Paper, arXiv:1312.5618
Brown M., Bacon D., Camera S., Harrison I., Joachimi B.,
et al. 2015, Advancing Astrophysics with the Square Kilo-
metre Array (AASKA14), arXiv:1501.03828
Brown M., Battye R., 2011, MNRAS, 410, 2057
Chang T., Refregier A., 2002, ApJ, 570, 447
Chang T., Refregier A., Helfand D., 2004, ApJ, 617, 794
Demetroullas C., Brown M., 2016, MNRAS, 456, 3100
Harrison I., Camera S., Zuntz J., Brown M., 2016,
arXiv:1601.03947
Heymans C., Grocutt E., Heavens A., Kilbinger M., Kitch-
ing T. D., et al. 2013, MNRAS, 432, 2433
Heymans C., Van Waerbeke L., Bacon D., Berge J., Bern-
stein G., et al. 2006, MNRAS, 368, 1323
Heymans C., van Waerbeke L., Miller L., Erben T., Hilde-
brandt H., et al. 2012, MNRAS, 427, 146
Högbom J., 1974, A&A, 15, 417
Huﬀ E., Krause E., Eiﬂer E., George M., Schlegel D., 2013,
arXiv:1311.1489
Joachimi B., Cacciato M., Kitching T., Leonard A., Man-
delbaum R., et al. 2015, Space Sci. Rev., 193, 1
Kaiser N., Wilson G., Luppino G., 2000, arXiv:astro-
ph/0003338
Kilbinger M., 2015, Rep. Prog. Phys., 78, 086901
Kilbinger M., Fu L., Heymans C., Simpson F., Benjamin
J., et al. 2013, MNRAS, 430, 2200
Kitching T., Miller L., Heymans C., van Waerbeke L.,
Heavens A., 2008, MNRAS, 390, 149
Kitching T. D., Balan S. T., Bridle S., Cantale N., Courbin
F., et al. 2012, MNRAS, 423, 3163
Kuijken K., Heymans C., Hildebrandt H., Nakajima R.,
Erben T., et al. 2015, MNRAS, 454, 3500
Mandelbaum R., Rowe B., Armstrong R., Bard D., Bertin
E., et al. 2015, MNRAS, 450, 2963
Melchior P., Viola M., 2012, MNRAS, 424, 2757
Miller L., Heymans C., Kitching T., van Waerbeke L., Er-
ben T., et al. 2013, MNRAS, 429, 2858
Miller L., Kitching T., Heymans C., Heavens A., van Waer-
beke L., 2007, MNRAS, 382, 315
Morales M., 2006, ApJL, 650, L21
Nelder J., Mead R., 1965, Computer Journal, 7, 308

a visibility variance to the covariance between such a visi-
bility and another one from a baseline sharing one antenna
is approximately S/SEF D. For SKA1-MID dishes, whose
SEF D = 400 Jy, this ratio is of the order of 10−3 for an
amount of 104 faint sources per beam with on average a ﬂux
density S ∼ 50µJy (as observed in weak lensing surveys) and
therefore it is negligible. Therefore for weak lensing observa-
tions we can assume the covariance matrix of the visibilities
to be diagonal with

σ2(Pij) =

1

2η2

s ∆ντacc

(SEF DiSEF Dj).

(A5)

10

Rivi et al.

Patel P., Abdalla F., Bacon D., Rowe B., Smirnov O.,
Beswick R., 2014, MNRAS, 444, 2893
Patel P., Bacon D. J., Beswick R. J., Muxlow T. W. B.,
Hoyle B., 2010, MNRAS, 401, 2572
Patel P., Harrison I., Makhathini S., Abdalla F. B., Bacon
D., et al. 2015, Advancing Astrophysics with the Square
Kilometre Array (AASKA14), arXiv:1501.03892
Refregier A., 2003, MNRAS, 338, 35
Refregier A., Kacprzak T., Amara A., Bridle S., Rowe B.,
2012, MNRAS, 425, 1951
Rivi M., Miller L., Makhathini S., Abdalla F., 2016,
in EXTRA-RADSUR2015 Proceedings
of Science,
arXiv:1602.05836
Schwarz U., 1978, A&A, 65, 345
Seitz C., Schneider P., 1997, AA, 318, 687
Van Waerbeke L., Mellier Y., Erben T., Cuillandre J. C.,
Bernardeau F., et al. 2000, A&A, 358, 30
Whittaker L., Brown M., Battye R., 2015, MNRAS, 451
Wittman D., Tyson J., Kirkman D., Dell’Antonio I., Bern-
stein G., 2000, Nature, 405, 143
Wrobel J., Walker R., 1999, in Taylor G., Carilli C., Perley
R., eds, , Vol. 180, Synthesis Imaging in Radio Astronomy
II. ASP Conference Series
Yahya S., Bull P., Santos M., et al. 2015, MNRAS, 450,
2251

APPENDIX A: COVARIANCE MATRIX OF
THE VISIBILITIES
Following Wrobel & Walker (1999), we can obtain the co-
variance matrix of the visibility noise by computing the co-
variance values in a similar way adopted for variances. The
covariance between the output from two baselines is given
by

cov(Pij, Phk) = (cid:104)PijPhk(cid:105) − (cid:104)Pij(cid:105)(cid:104)Phk(cid:105),

(A1)
where Pij and Phk are the power for an interferometer in-
volving antennas pairs (i,j) and (h,k) after the cross multi-
plication in the correlator.

If ij = hk, then we have the variance for the single

baseline (Wrobel & Walker 1999):

σ2(Pij) =

1

(S2

c + SiSj + SiSEF Dj + SjSEF Di

s ∆ντacc

2η2
+ SEF DiSEF Dj),

(A2)
where Si is the source ﬂux measured by antenna i, Sc is the
correlated ﬂux, and SEF D is the antenna System Equivalent
Flux Density, deﬁned as the ﬂux density of a source that
would deliver the same amount of power in Jansky of the
antenna temperature.

Similarly, if two baselines share one single antenna then

cov(Pij, Pjk) =

1

2η2

s ∆ντacc

(S2

c + ScSj + ScSEF Dj). (A3)

Finally, if the two baselines have no antennas in common
then the only contribution to the covariance between their
outputs is from the source ﬂux density:

(A4)
In the weak source regime, S (cid:28) SEF D and the ratio of

cov(Pij, Phk) =

η2
s ∆ντacc

S2
c .

1

c(cid:13) 0000 RAS, MNRAS 000, 000–000

