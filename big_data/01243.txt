Reliable multiphoton generation in waveguide QED

A. Gonz´alez-Tudela,1 V. Paulisch,1 H. J. Kimble,1, 2, 3 and J. I. Cirac1

1Max-Planck-Institut f¨ur Quantenoptik Hans-Kopfermann-Str. 1. 85748 Garching, Germany

2Norman Bridge Laboratory of Physics 12-33

3Institute for Quantum Information and Matter, California Institute of Technology, Pasadena, CA 91125, USA

6
1
0
2

 
r
a

M
8

 

 
 
]
h
p
-
t
n
a
u
q
[
 
 

2
v
3
4
2
1
0

.

3
0
6
1
:
v
i
X
r
a

(Dated: March 9, 2016)

In spite of decades of effort, it has not yet been possible to create single-mode multiphoton states of light
with high success probability and near unity ﬁdelity. Complex quantum states of propagating optical photons
would be an enabling resource for diverse protocols in quantum information science, including for interconnect-
ing quantum nodes in quantum networks. Here, we propose several methods to generate heralded mutipartite
entangled atomic and photonic states by using the strong and long-range dissipative couplings between atoms
emerging in waveguide QED setups. Our theoretical analysis demonstrates high success probabilities and ﬁdeli-
ties are possible exploiting waveguide QED properties.

On-demand generation of optical propagating photons is
at the basis of many applications in quantum information
science,
including multipartite teleportation [1], quantum
repeaters [2], quantum cryptography [3, 4], and quantum
metrology [5]. While single photons are routinely produced
in different experimental setups [6], single–mode multiphoton
states are much harder to generate [7]. Current methods are
limited by either an exponentially small success probabilities
or by low ﬁdelities. Here we show that reliable single-mode
multiphoton sources can be constructed with emitters close
to nano-photonic waveguides by combining both the strong
coupling present in those systems and collective phenomena.
In particular, we show how collective excitations can be ef-
ﬁciently loaded in a collection of atoms, which can then be
released with a fast laser pulse to produce the desired multi-
photon state [8, 9].
In order to boost the success probabil-
ity and ﬁdelity of each excitation process, our method utilizes
atoms to both generate the excitations in the rest, as well as to
herald the successful generation. Furthermore, to overcome
the exponential scaling of the probability of success with the
number of excitations, we design a protocol to merge excita-
tions that are present in different internal atomic levels with a
polynomial scaling.

The enhancement of light-matter interactions provided by
quantum nanophotonics opens up new avenues to create high-
ﬁdelity multiphoton states. For example, m quantum emitters
can be strongly coupled to structured waveguides, which show
large Purcell factors, P1d, so that m atomic excitations can be
mapped to a waveguide mode with an error (or inﬁdelity, Im)
scaling as m/P1d. However, the resulting state is not a single
mode, but a complex entangled state of several modes [9], so
that it cannot be directly used for quantum information pur-
poses. Single-mode multiphoton states can be created by stor-
ing m collective excitations in N (cid:29) m atoms, which are then
mapped to a photonic state of the waveguide. While the lat-
ter process can be achieved with very low inﬁdelity, scaling
√
as m2/(NP1d) [8, 9], present schemes for the ﬁrst part scale
like Im ∝ m/
P1d [9], as they still do not fully exploit the
strong coupling to the waveguide nor collective effects. This
ultimately limits the ﬁdelity of the whole procedure.

In this work we show how this limitation can be overcome
with new schemes for the heralded generation of m collec-

Figure 1. (a) Setup for the ﬁrst protocol: N target atoms are col-
lectively coupled to the waveguide. A photon detection heralds the
addition of a collective excitation. (b) Atomic level structure: waveg-
uide modes are coupled to the e ↔ s transition with a spontaneous
emission rate Γ1d. The transition g ↔ e is driven by a Raman laser Ω
and the spontaneous emission rate to other modes is denoted by Γ∗.

tive excitations in N (cid:29) m atoms coupled to a waveguide. The
basic idea is to use the atoms themselves to both create the ex-
citations one-by-one, and to herald the success of the process.
In this way, arbitrarily small inﬁdelities, Im, can be obtained
at the expense of making the process non-deterministic. De-
pending on the scheme, we ﬁnd that the global probability of
success (or, inversely, the average number of operations, Rm)
decreases (increases) exponentially with m, and thus it cannot
be scaled to arbitrarily large photon production. Finally, we
also show how to overcome this exponential law by using ad-
ditional atomic states, atom number resolved detection, and a
speciﬁc protocol to merge excitations, while keeping a very
low global inﬁdelity, Im ∼ poly(m)/(NP1d).

Structured waveguide setups with trapped atoms offer sev-
eral interesting characteristics that we exploit to design our
protocols, namely, i) regions of large Purcell Factor P1d (cid:29) 1,
e.g., due to slow light in engineered dielectrics [10–13], while
keeping at the same time ii) long-propagation lengths of the
guided modes compared to the characteristic wavelength (λa)
that give rise to long-range dissipative couplings [14]. More-
over, as shown in, e.g. Ref. [14], in order to avoid dipole-
dipole interactions and fully exploit superradiance effects we
assume iii) the atoms to be placed at distances zn = nλa, with
n ∈ N.
[15]. Finally, iv) it is possible to read the collec-
tive atomic state very efﬁciently through the waveguide due
to the naturally short timescales and large collection efﬁcien-
cies. We use atomic detection for heralding, which has already
reached accuracies of 10−4 [16] in trapped ion setups, where
the collection efﬁciency is not enhanced by the presence of

...Control fieldsN atomsz(a)Detector(b)2

Figure 2. (a) Setup for the second and third protocol: N target, one source and Nd detector atoms are collectively coupled to the waveguide.
The source atom creates a single excitation, and the detector atoms herald the success of the process. (b) Atomic level structure: waveguide
modes are coupled to the e1 ↔ g and e2 ↔ s transition with a spontaneous emission rate Γ1d. A two-photon transition a1 ↔ e1 is driven by
laser light via level a2 with effective Rabi frequency Ωa. Transition a1 ↔ e2 is driven by a different laser with Rabi frequency Ωb. Coupling
between levels s,s1 is characterized by a Rabi frequency Ωc. Other levels {sn} can be manipulated using lasers/microwave ﬁelds. (c) Scheme
for the second protocol, with πc,t,d denoting the π-pulses for the population transfers within the source/target/detector atoms. The driven
transitions to the excited states are indicated by the Rabi frequencies Ωa,b. In shaded yellow the ﬁnal state where we want to arrive is indicated.

a waveguide, as in our scheme. Thus, here we assume the
atomic detection to be perfect, and consider P1d and N as the
main resources to analyze the ﬁgures of merit of the proto-
cols. For the analysis of three different schemes, we adopt
the following strategy for each one: we analyze the process of
generating a single collective excitation, assuming the atoms
already store m excitations. We denote by p the probability
of success, and Im→m+1 the corresponding inﬁdelity. We ﬁ-
nally analyze the average number of operations Rm and ﬁnal
inﬁdelities Im for accumulating all m excitations. To simplify
the expressions along the main text, we assume to work in a
regime with N (cid:29) m and P1d (cid:29) 1, though complete expressions
can be found in Supplementary Material [17].

Let us ﬁrst analyze a protocol inspired in a method origi-
nally devised to create long-distant entangled states in atomic
ensembles [18], that requires N atoms placed close to a 1d
waveguide as depicted in Fig. 1(a). The atoms must have a
level structure as depicted in Fig. 1(b), where the atomic tran-
sition e ↔ s is coupled to the guided modes at a rate Γ1d and
the transition g ↔ e is driven equally by a laser with Rabi fre-
quency Ω. The excited states e also radiate into leaky modes
(of the waveguide or outside) other than the relevant one, that
give rise to a decay rate Γ∗, leading to the Purcell factor P1d =
Γ1d/Γ∗. The excitations are stored in the states g and s, which
are assumed to be decoherence-free like any other hyperﬁne
ground state. The procedure assumes that we start with m col-
lective excitations in level s, and the goal is to add another
m(cid:105) ∝ sym{|s(cid:105)⊗m ⊗|g(cid:105)N−m},
one. Thus, the initial state is |Φs
where ‘sym’ denotes the symmetrizing operator. The idea is
to weakly excite the atoms in g to level e with a short laser
pulse of duration T (cid:28) 1/(NΓ1d) and if a photon in the waveg-
uide is detected, it heralds the addition of an excitation in state
s. As all the atoms are equally coupled to the waveguide, the
excitation will be collective.
√
NT /2 (cid:28) 1, so that right after
Let us denote by x = Ω
the pulse we have the state (up to a normalization constant),
m(cid:105), where we used the notation
Sαβ = (N)−1/2 ∑N
αβ for the collective spin operators and
αβ = |α(cid:105)n(cid:104)β| with atom number n = 1, . . . ,N. After the
σ n
pulse, we leave the system free to evolve under the interac-
tion with the waveguide for a time t (cid:29) 1/Γ∗), in which case

(cid:2)1 + xSeg + x2 S2

eg + O(x3)(cid:3)|Φs

n=1 σ n

the wavefunction terms with excitations in e decay either to
waveguide/leaky photons. If a waveguide photon is detected,
either it comes from the lowest order term, O(x), in which
case the atomic state will be the desired one, i.e., Ssg|Φs
m(cid:105),
or from the double excited state, in which case we will pre-
pare the wrong state introducing an error. Emission of leaky
photons also produces errors, but of smaller order [17]. De-
noting by η the detection efﬁciency, the success probability
in generating the desired state is p ≈ ηx2 and the inﬁdelity is
Im→m+1 ∝ (1− η)x2 [to lowest order in x]. To create m ex-
citations, one has to detect m consecutive photons, leading to
Rm = p−m and Im ∝ m(1 − η)x2. As in Ref. [18], the error
can be made arbitrarily small at the expense of decreasing the
success probability. If a high ﬁdelity is required (e.g., 0.999)
the method is practicable only for few excitations. One way
of reducing Rm is by using an additional metastable state s1 in
which the heralded excitation is stored after each successful
addition. This can be done by combining, e.g., a two-photon
Raman transition, to make a beam splitter transformation be-
tween levels s and s1, and post-selection conditioned on no
atomic detection in s. Then, assuming that we have m ex-
citations already stored in s1, this procedure generates m + 1
within the same level. It can be shown [17, 19] that this strat-
egy leads to an average number of operations Rm ∝ em/p.

To overcome the trade-off between probabilities and ﬁdeli-
ties coming from zero and double excitations, we propose a
protocol relying on a conﬁguration as depicted in Fig. 2(a):
we replace the write ﬁeld of the previous scheme by a single
source atom that guarantees the transfer of at most a single
excitation to the target ensemble. Furthermore, in a second
step, Nd detector atoms act as a detector to herald the transfer
of excitations, replacing the photon detector. Both the source
and detector atoms should be separated from the target en-
semble by a multiple of λa/2 and sufﬁciently separated for
independent addressing with external control ﬁelds. The pro-
tocol requires a level structure as shown in Fig. 2(b) where
two dipolar transitions e1 ↔ g and e2 ↔ s are coupled to the
same waveguide mode with rates that we set to be equal for
simplicity and with a corresponding Purcell Factor P1d. We
require the use of other hyperﬁne, auxiliary levels, a1,a2,s1.
The transition a1 ↔ e2 is connected by a laser, whereas the
a1 ↔ e1 is a two-photon transition mediated by a2, with effec-

(c)...Control fieldsN atoms(a)SourceTarget(b)DetectorNd atoms ...tive Rabi frequency Ωa, so that direct spontaneous emission
from e1 → a1 is forbidden [8, 17, 20, 21]. The level s1 is used
to store excitations and decouple them from the dynamics in-
duced by the waveguide. We require that s1 is not connected
to neither e1 nor e2 by a dipole transition, so that it will only
be connected to s coherently through microwave ﬁelds.
As before, this protocol starts with a superposition in the
target ensemble |Φs
m(cid:105)t, and with the source/detector atoms in
a1/s respectively. The heralded transfer of a single collec-
tive excitation consists of several steps [Fig. 2(c)]. The ﬁrst
one, coherently transfers the excitations from s → s1 in the
target and detector ensemble to protect them from the waveg-
uide dynamics. The second step uses a short laser pulse in
the source atom to excite it to state e1, and then switches on
the lasers driving e1 ↔ a1 via a two-photon transition in the
target ensemble with (effective) Rabi frequency Ωa for a time
Ta. Ideally, the source atom exchanges the excitation with the
target ensemble by a virtual photon in the waveguide, thus
generating a collective excitation in a1-state of the target en-
semble. After that, the laser Ωa is turned off and one waits for
−1 such that any (non-ideal) remaining popu-
a time t (cid:29) (Γ∗)
lation in the excited state decays. Thirdly, we apply π-pulses
to decouple the source atom and couple the target and detector
ensemble. Another short pulse is applied to move the collec-
tive excitation in the target ensemble from a1 to e2 and we
switch on the laser Ωb driving the e2 ↔ a1 transition in the
detector ensemble for a time Tb with Rabi frequency Ωb. This
transfers the collective excitation in the target ensemble to s
and creates a collective excitation in a1 in the detector ensem-
ble. At the end, a measurement of that internal state, a1, of the
detector atoms (through ﬂuorescence in the waveguide) her-
alds the successful preparation of a collective excitation in the
target ensemble, i.e., |Φs

m+1(cid:105)t.

NΓ1dΓ∗, and Ta = π/

Let us now analyze the protocol in detail.

In the second
step, the evolution of the source/target atoms is described
by a master equation [17], which can be analytically solved
in the limit NP1d (cid:29) 1. By choosing the Rabi frequency
Ωa ≈ √
√
Γ1dΓ∗, the probability for the
ensemble to end up in the desired state after the second step,
√
|g(cid:105)s ⊗ Sa1g|Φs1m(cid:105)t, is maximized pa ≈ e−π/
P1d, which can be
improved by appropriate pulse shaping [17]. Similarly, in the
third step, the evolution of the source/detector atoms can be
analytically solved in the limit NdP1d (cid:29) 1, obtaining a proba-
m(cid:105)t ⊗Sa1s|s(cid:105)⊗Nd
bility to end up in the desired state Ssg|Φs
given
also by pb ≥ pa. Thus, the total probability of success of
the protocol is lower bounded by p (cid:38) p2
a, with a heralding
inﬁdelity Im→m+1 = 0, as we rule out all the possible errors
through post-selection. Indeed, the only way to have the de-
tector atom in a1 is that the steps two and three have occurred
as desired. Any spontaneous emission in any of the atoms or
photon absorption is incompatible with that event. Thus, to
accumulate m excitations we need to repeat an average num-
ber of times Rm ∝ p−m, but with Im = 0. As p can be very
close to 1 for systems with N,Nd,P1d (cid:29) 1, we can still expect
to achieve big number of excitations m (cid:29) 1 in spite of the ex-
ponential scaling of Rm as shown in Fig. 3 for systems with
N,Nd (cid:29) m. In case of unsuccessful detection, then, we pump
all the target atoms back to |g(cid:105) and re-initialize the process.

d

3

Figure 3. Approximate number m of collective excitations with Im =
0 for a ﬁxed number of repetitions Rm (see legend) for the method
where we directly accumulate excitations such that Rm = p−m and
p ≈ p2

a, with pa as deﬁned in the text and assuming N,Nd (cid:29) m.

After this analysis one natural question arises,

that is,
whether the exponential number of operations is a fundamen-
tal problem of probabilistic protocols [19]. This leads to our
third and ﬁnal scheme in which we design a speciﬁc protocol
which circumvents this exponential scaling with a judicious
modiﬁcation of the previous protocol using several additional
atomic states sn [see Fig. 2(b)] and atomic number resolved
detection. The idea is that with each successful detection,
we transfer the heralded collective excitation in s not to the
same level s1, but to one of several states {sn} to then merge
them a posteriori with an adequate protocol that we explain
below. For that note that, in contrast to our previous schemes,
in case of unsuccessful detection, i.e., the detector atoms were
not found in a1, the m excitations stored in {sn}n are not de-
stroyed, but only the one we wanted to add. We can pump
back the target atoms in s,a1 to g and try again. The price
one has to pay is that errors appear since one may not recover
the original collective state in the ensemble, i.e., because a
spontaneous emission event occurred within the target ensem-
ble [17]. One can show that the main source of errors occurs
when a collective excitation was indeed produced in the en-
semble, but it was not detected (because, e.g., of spontaneous
emission in the detector ensemble).
In order to reduce this
error, we have to ensure that undetected collective states re-
turn back to g coherently. For that, we apply the following
repumping procedure: ﬁrst, we pump all levels but s,{sn}n
back to g. Then we coherently transfer the potential exci-
tations from s → a1, and then apply a pumping through the
waveguide, a1 → e1 → g.
In order to further minimize the
errors introduced by repumping and obtain the desired scal-
ing of inﬁdelity (1/(NP1d)), we also need to modify the third
step of the protocol for which then, interestingly, only a single
detector atom is needed, Nd = 1. It can be shown that once
we are in Sa1g|Φ{sn}n
(cid:105)|s(cid:105)d, the optimal strategy is to apply a
fast π-pulse in the target atoms such Se2g|Φ{sn}n
(cid:105)t is prepared.
Then, the system is left free to interact for a time Tb = 1/Γ1d
without any external ﬁelds, and the dynamics are terminated
by applying another π-pulse on the target and detector atoms.
We ﬁnd that the optimal probability for the system to be in
Ssg|Φ{sn}n
(cid:105)t ⊗|a1(cid:105)d is pb ≈ 0.1 (1− 1/P1d), which can be im-
proved up to pb ∼ 0.33 by repeating the fast π-pulses several
times [17]. Finally, if we fail, we apply the repumping and re-

m

m

m

1010010001041251020501004

scales as Im ∝ poly(m)/(NP1d). We note that atomic detection
may itself introduce errors, however, the aim of this scheme is
just to show that polynomial scaling can be achieved, despite
not being currently the most efﬁcient method. However, we
expect that by suitable modiﬁcation and adaptation to speciﬁc
setups, polynomial and efﬁcient scaling can be constructed.
State-of-the art technologies already provide systems with
N ∼ 1 − 2 emitters coupled to engineered dielectrics [10–
13, 23, 24] with P1d ∼ 1 − 100. Advances in both fabrica-
tion and trapping techniques foresee implementations with
N ∼ 100 atoms and P1d (cid:38) 100 in the near future. The use of
atomic internal levels may be replaced by motional levels of
each of the atoms, if they are trapped in pseudo-harmonic po-
tentials [25], since there can be many of them at our disposal.
There are several sources of errors that have not been consid-
ered here and that will give limitations to our proposal, such
as decoherence of hyperﬁne levels, laser ﬂuctuations, non per-
fect atom-resolving detection, although we expect that they
can be controlled to a large extent. Other effects such as re-
tardation, imperfect atomic cooling, or ﬂuctuations in atomic
positions may have to be considered in the analysis to achieve
large ﬁdelities (see, however [9] where part of these errors
were already considered).

In conclusion, we have presented several probabilistic pro-
tocols to generate heralded highly entangled atomic states that
afterwards can be mapped to photonic states at will with very
high ﬁdelities. In particular, we show how to accumulate m
collective atomic excitations with inﬁdelity Im = 0 and an ex-
ponential number of operations Rm = p−m, being p the herald-
ing probability for adding a single excitation. We design a
protocol where p can be close to unity for systems with large
N,P1d, which would allow to accumulate m ∼ 20− 50 excita-
tions with systems P1d ∼ 102−103 using Rm ∼ 104 operations
with unit ﬁdelity [see Fig. 3]. Moreover, we also present a
protocol with polynomial scaling in the number of operations
Rm by using atomic excitation number resolved and overall
low inﬁdelity Im ∝ poly(m)/(NP1d). Though, we discus our
protocols in the context of waveguide QED, the ideas can
also be exported to other systems such as low mode cavities
[23, 24, 26, 27], superconducting circuits [28] or optical ﬁbers
[29–32] with suitable modiﬁcation of the protocols.

Acknowledgements. The work of AGT, VP and JIC was
funded by the European Union integrated project Simulators
and Interfaces with Quantum Systems (SIQS). AGT also ac-
knowledges support from Intra-European Marie-Curie Fel-
lowship NanoQuIS (625955). VP acknowledges the Cluster
of Excellence NIM. HJK acknowledges funding by the Air
Force Ofﬁce of Scientiﬁc Research, Quantum Memories in
Photon-Atomic-Solid State Systems (QuMPASS) Multidisci-
plinary University Research Initiative (MURI), by the Insti-
tute of Quantum Information and Matter, a National Science
Foundation (NSF) Physics Frontier Center with support of the
Moore Foundation by the Department of Defense National Se-
curity Science and Engineering Faculty Fellows (DoD NSS-
EFF) program, by NSF PHY1205729 and support as a Max
Planck Institute for Quantum Optics Distinguished Scholar.

Figure 4. Numerical calculation (markers) and analytical approxi-
mation (solid lines) of total probability p and Im→m+1 for the third
protocol discussed in the text in panel (a) and (b) respectively. We
plot the variation with P1d for ﬁxed Nm = 100 (in blue) and with Nm
for ﬁxed P1d = 100. The analytical approximations for pa, pb are
given in the text and the analysis is made in Ref. [17]. The curves are
obtained from full numerical integration of the master equation.

peat the process until success, of the order of 1/p times with
p = pa pb. In Ref. [17], we analyze the process in detail, iden-
tifying all errors and how they accumulate in the repetitions,
leading to an (averaged) inﬁdelity Im→m+1 (cid:46) m/(pNP1d) [17].
We conﬁrm numerically (Fig. 4) the scaling of p and Im→m+1
integrating the corresponding master equation, showing that
our analytical estimations capture the right scalings.

Thus, the problem is reduced to merging the atomic ex-
citations distributed in the levels {sn}n. For example, if in-
stead of adding excitations one by one, as we did for the ﬁrst
scheme, we use log2 m metastable states sn, and adopt a tree-
like structure, we obtain a superpolynomial scaling [17, 22]
in Rm ∝ mlog2 m/p to merge m collective excitations in a sin-
gle atomic level. The key step is to double the number of
excitations in each step using beam splitter transformations
and post-selection conditioned no atomic detection in one of
the levels. Moreover, combining the beam splitters with dis-
placement transformations, arbitrary superpositions of collec-
tive atomic excitations can be obtained [17, 19, 22].

Finally, we go one step further by using number-resolved
atomic detection to obtain a polynomial scaling. The key point
is to realize that if we have n excitations stored in two atomic
levels, after applying a beam splitter transformation, the prob-
ability to obtain exactly 2n excitations in one of them (by de-
tecting no excitation in the other) decays with n; however, the
probability of obtaining more than 3n/2 in one level (by de-
tecting p < n/2 in the other) is actually bounded below by
1/3, independent of n [17]. Assuming the worst case scenario
in which after detecting q < m/2 excitations in one of the two
levels, we assume that the other state only goes up to 3n/2
excitations, that gives us an upper bound for the number of
operations [17] Rm (cid:46) m4.41 log3/2(m)/p, that is already poly-
nomial, and which in practical situations is better as the num-
ber of excitations in the other mode is always larger than 3n/2.
The number of atomic levels, |si(cid:105), required to reach m excita-
tions scales logarithmically log3/2 m, and the ﬁnal inﬁdelity

10205010020050010000.040.060.08101005020301570(b)(a)Fixing10-410-310-1102050100200500100010100502030157010-2Fixing5

[24] Tiecke, T. et al. Nanophotonic quantum phase switch with a

single atom. Nature 508, 241–244 (2014).

[25] Parkins, A. S., Marte, P., Zoller, P., Carnal, O. & Kimble, H. J.
Quantum-state mapping between multilevel atoms and cavity
light ﬁelds. Phys. Rev. A 51, 1578–1596 (1995).

[26] Specht, H. P. et al. A single-atom quantum memory. Nature

473, 190–193 (2011).

[27] Haas, F., Volz, J., Gehr, R., Reichel, J. & Est`eve, J. Entangled
states of more than 40 atoms in an optical ﬁber cavity. Science
344, 180–183 (2014).

[28] Mlynek, J., Abdumalikov, A., Eichler, C. & Wallraff, A. Obser-
vation of dicke superradiance for two artiﬁcial atoms in a cavity
with high decay rate. Nat. Communications 5, 5186 (2014).

[29] Vetsch, E. et al. Optical interface created by laser-cooled atoms
trapped in the evanescent ﬁeld surrounding an optical nanoﬁber.
Phys. Rev. Lett. 104, 203603 (2010).

[30] Goban, A. et al. Demonstration of a State-Insensitive, Compen-

sated Nanoﬁber Trap. Phys. Rev. Lett. 109, 033603 (2012).

[31] Petersen, J., Volz, J. & Rauschenbeutel, A. Chiral nanophotonic
waveguide interface based on spin-orbit interaction of light.
Science 346, 67–71 (2014).

[32] B´eguin, J.-B. et al. Generation and detection of a sub-
poissonian atom number distribution in a one-dimensional op-
tical lattice. Phys. Rev. Lett. 113, 263603 (2014).

[33] Gardiner, G. W. & Zoller, P. Quantum Noise (Springer-Verlag,

Berlin, 2000), 2nd edn.

η < 1.

[34] All the expressions are valid obviously for detectors with 0 <

[35] Actually the source atom can also play the role of the detector

atom with appropriate modiﬁcation of the protocol.

[1] Murao, M., Jonathan, D., Plenio, M. B. & Vedral, V. Quantum
telecloning and multiparticle entanglement. Phys. Rev. A 59,
156–161 (1999).

[2] Briegel, H.-J., D¨ur, W., Cirac, J. I. & Zoller, P. Quantum Re-
peaters: The Role of Imperfect Local Operations in Quantum
Communication. Phys. Rev. Lett. 81, 5932 (1998).

[3] Gisin, N., Ribordy, G., Tittel, W. & Zbinden, H. Quantum cryp-

tography. Rev. Mod. Phys. 74, 145 (2002).

[4] Durkin, G. A., Simon, C. & Bouwmeester, D. Multiphoton
entanglement concentration and quantum cryptography. Phys.
Rev. Lett. 88, 187902 (2002).

[5] Giovannetti, V., Lloyd, S. & Maccone, L. Quantum metrology.

Phys. Rev. Lett. 96, 010401 (2006).

[6] Lounis, B. & Orrit, M. Single-photon sources. Reports on

Progress in Physics 68, 1129 (2005).

[7] Dell’Anno, F., De Siena, S. & Illuminati, F. Multiphoton quan-
tum optics and quantum state engineering. Physics reports 428,
53–168 (2006).

[8] Porras, D. & Cirac, J. Collective generation of quantum states
of light by entangled atoms. Physical Review A 78, 053816
(2008).

[9] Gonz´alez-Tudela, A., Paulisch, V., Chang, D. E., Kimble, H. J.
& Cirac, J. I. Deterministic generation of arbitrary photonic
states assisted by dissipation. Phys. Rev. Lett. 115, 163603
(2015).

[10] Laucht, A. et al. A Waveguide-Coupled On-Chip Single-Photon

Source. Phys. Rev. X 2, 011014 (2012).

[11] Lodahl, P., Mahmoodian, S. & Stobbe, S.

Interfacing single
photons and single quantum dots with photonic nanostructures.
Rev. Mod. Phys. 87, 347–400 (2015).

[12] Yu, S.-P. et al. Nanowire photonic crystal waveguides for
single-atom trapping and strong light-matter interactions. Appl.
Phys. Lett. 104, 111103 (2014).

[13] Goban, A. et al. Superradiance for atoms trapped along a pho-
tonic crystal waveguide. Phys. Rev. Lett. 115, 063601 (2015).
[14] Chang, D., Jiang, L., Gorshkov, A. & Kimble, H. Cavity
qed with atomic mirrors. New Journal of Physics 14, 063003
(2012).

[15] In fact all results can be extended to separations of λa/2.
[16] Myerson, A. H. et al. High-ﬁdelity readout of trapped-ion

qubits. Phys. Rev. Lett. 100, 200502 (2008).

[17] See Supplementary material for full details of the calculations
of probabilities and ﬁdelities of the protocols discussed in the
main text.

[18] Duan, L.-M., Lukin, M. D., Cirac, J. I. & Zoller, P. Long-
distance quantum communication with atomic ensembles and
linear optics. Nature 414, 413 (2001).

[19] Dakna, M., Clausen, J., Kn¨oll, L. & Welsch, D.-G. Generation
of arbitrary quantum states of traveling ﬁelds. Phys. Rev. A 59,
1658–1661 (1999).

[20] van Enk, S. J., Cirac, J. I. & Zoller, P. Ideal quantum communi-
cation over noisy channels: A quantum optical implementation.
Phys. Rev. Lett. 78, 4293–4296 (1997).

[21] Borregaard, J., K´om´ar, P., Kessler, E. M., Sørensen, A. S. &
Lukin, M. D. Heralded quantum gates with integrated error de-
tection in optical cavities. Phys. Rev. Lett. 114, 110502 (2015).
[22] Fiur´aˇsek, J., Garc´ıa-Patr´on, R. & Cerf, N. J. Conditional gen-
eration of arbitrary single-mode quantum states of light by re-
peated photon subtractions. Phys. Rev. A 72, 033822 (2005).

[23] Thompson, J. D. et al. Coupling a single trapped atom to a

nanoscale optical cavity. Science 340, 1202–1205 (2013).

6

Supplemental Material: Reliable multiphoton generation in waveguide QED

In this Supplementary Material, we provide the full details on how to characterize the different protocols described within the
main manuscript. For the sake of understanding, we devote different Sections to the each protocol including in all of them the
atom-waveguide tools required and the calculation of probabilities and ﬁdelities such that each Section is self-contained. The
summary of the Supplementary Material reads as follows:

• In Section SM1, we discuss the ﬁrst protocol of the main manuscript which adapts a protocol envisioned for entangling
atomic ensembles [18] to herald the generation of m collective excitations using single photon detections within the
waveguide. We discuss both the situation where we accumulate directly the excitations into the same atomic level and
where we store it in another hyperﬁne level and combine them a posteriori.
• In Section SM2, we discuss the second protocol of the main manuscript which accumulate excitations directly within the
same level using a two-step protocol. The protocol overcomes the trade-off between probability of success and ﬁdelities
of the ﬁrst one but still requires an exponential number of operations.
• In Section SM3, we discuss the third protocol which show to overcome the exponential scaling of the number of operations
of the second protocol by using extra auxiliary levels to store the excitations after each heralded transfer while keeping the
overall inﬁdelity still low
• For completeness, in Section SM4 we discuss a variation of the previous two protocol that relaxes part of the requirements
of the protocols two and three, e.g., closed transition, at expense of slightly worse scaling of probabilities and inﬁdelities.
• Finally, in Section SM5 we discuss on how to use beam splitters transformations and atomic detection to merge atomic
excitations and reach high photon numbers.

SM1. HERALDING MULTIPLE COLLECTIVE ATOMIC EXCITATIONS IN WAVEGUIDE QED SETUPS USING SINGLE

PHOTON DETECTORS.

In this Section is show how to adapt a protocol originally envisioned to generate entanglement between distant ensembles [18],
to create multiphoton states in waveguide QED setups. The idea is to accumulate several collective atomic excitations, that can
afterwards be mapped to m-photon states with very high ﬁdelities [8, 9].

The protocol consists in heralding the transfer a single collective atomic excitations m times through m photon detection events
within the waveguide. We discuss two different approaches: i) one where we store the heralded single excitation in a different
level s1 with methods that we revise in Section SM5; ii) or where we store the excitation directly into the same level.

The key step in both cases is to study how an additional single collective excitation can be added to an atomic ensemble which

already contains m excitations in another level, s1, i.e.
|Φs1m(cid:105) =

1(cid:113)(cid:0)N

m

(cid:1)sym{|s1(cid:105)⊗m|g(cid:105)⊗(N−m)} .

(SM1)

Notice, that due to low heralding efﬁciencies p of these kind of protocols [18], it is not clear whether the decoherence
introduced when repeating the protocol 1/p times will spoil the coherence of the already stored excitations in |Φs1m(cid:105). In the
following Sections, we analyze what are the atom-waveguide resources that we use to extend the protocol for multiple excitations.
Then, we analyze the probabilities of the different processes that may occur in each attempt of generating an extra collective
excitation, and ﬁnally, we take everything into account to estimate the ﬁdelity of adding an extra excitation when the system is
already in |Φs1m(cid:105). In a separate Section, we will consider the modiﬁcations of probabilities when we directly accumulate in s,
m(cid:105).
such that the initial state is |Φs

A. Atom-waveguide resources

The tools/resources that we use are:
• We assume that we have N target atoms, in which we prepare the superposition, trapped close to a one-dimensional
waveguide as depicted in Fig. SM1 (a). Moreover, we assume that the atoms have an internal level structure, as shown
in Fig. SM1(b), where one optical transition |e(cid:105) ↔ |s(cid:105) is coupled to a waveguide mode with a rate Γ1d, and the other leg
|e(cid:105) → |g(cid:105) is controlled by a classical ﬁeld Ωn, with n = 1, . . . ,N. In one of the schemes that we explore, we also assume
that we have an extra mode s1, where the excitations can be stored and which can be combined through microwave or
two-photon Raman transitions with Rabi frequency G.

7

Figure SM1. (a) General setup for ﬁrst protocol discussed in the main manuscript which consists of a collective ensemble where we prepare
superpositions and a single photon detector that we use to herald the excitations. (b) Internal level structure of emitters in which the transition
|e(cid:105) ↔ |s(cid:105) is coupled to a waveguide mode with rate Γ1d. The transition |g(cid:105) ↔ |e(cid:105) is controlled through the Raman laser Ω. We also include the
possibility of having an extra auxiliary level |s1(cid:105) where excitations can be stored using microwave [or two-photon Raman] ﬁelds G.

• The atoms are placed at distances commensurate with the characteristic wavelength of the guided mode, λa, at the fre-
quency of the transition |e(cid:105) → |g(cid:105), i.e. zn = nλa. With that assumption, it is easy to show that effective atom dynamics
induced by the interaction with the waveguide is solely driven by long-range dissipative couplings:

Lcoll [ρ] =

(SM2)
where ρ is the reduced density matrix of the atomic system, DO[ρ] = (2OρO†−O†Oρ−ρO†O) is the dissipator associated
to a given jump operator O, and where we deﬁned the collective spin operator of the target ensemble as Sαβ = ∑N
n=1 σ n
αβ ,
αβ = |α(cid:105)n(cid:104)β|. Obviously, the excited state can also decay to other modes other than into the waveguide, which
with σ n
leads to extra Lindblad terms which read:

DSge[ρ] ,

Γ1d
2

(cid:18)Γ∗

4

L∗(ρ) = ∑
n=1,...,N

(cid:19)

Γ∗
4

Dσ n

se [ρ] +

Dσ n

ge [ρ]

,

(SM3)

which lead to ﬁnite Purcell factor P1d = Γ1d
Γ∗ .
• A single photon detector with overall efﬁciency η at the end of the waveguide to detect the emission of waveguide photons.

B. Protocol and calculation of probabilities.

(cid:115)

The protocol works as follows: we apply a short laser pulse Ωn = Ω such that we drive the collective dipole excitation coupled

√
NΩT /2 = x (cid:28) 1. Then, the stored superposition |Φs1m(cid:105) evolves into:

to the waveguide Sge, during a short time T such that

|Ψ0(cid:105) ∝ |Φs1m(cid:105) + x 1√
Nm

Seg|Φs1m(cid:105) +

x2
2

2

Nm(Nm − 1)

eg|Φs1m(cid:105) + O(x3) .
S2

(SM4)

n

k,n(cid:105)+ ,

+ x2S2
+ x2 ∑

If we leave the system free to decay for a time t (cid:29) (Γ∗)−1, the system evolves to (dropping normalization and coefﬁcients):
gg|Φs1m(cid:105)⊗|1∗
k,n(cid:105) +∑
|Ψ0(cid:105) →|Φs1m(cid:105) + xSsg|Φs1m(cid:105)⊗|1k(cid:105) + x∑
σ n
n
ggSsg|Φs1m(cid:105)⊗|1k(cid:105)⊗|1∗
σ n
ggσ m
σ n

sg|Φs1m(cid:105)⊗|2k(cid:105) + x2∑
gg|Φs1m(cid:105)⊗|1∗
k,n(cid:105) , (SM5)
sgσ m
σ n
k(cid:105)] denotes waveguide (leaky) photon states. The ﬁrst line of the equation contains the processes where
where the |Mk(cid:105) [|M∗
no photon (|Φs1m(cid:105)) or only one photon is emitted either through the waveguide or through spontaneous emission. In the second
and third lines we write the different processes associated with the existence of double quantum jumps. In order to obtain the
different probabilities associated to each process, we use the expansion of the master equation [33] distinguishing the evolution
of the effective non-hermitian Hamiltonian, i.e., S(t,t0)ρ = e−iHefftρeiH†
efft, and the one resulting from quantum jumps evolution,
i.e., Jρ, that is given in general by:

sg|Φs1m(cid:105)⊗|1∗
σ n
sgSsg|Φs1m(cid:105)⊗|1k(cid:105)⊗|1∗
k,n(cid:105)+
k,n(cid:105) + x2∑
σ n
sg|Φs1m(cid:105)⊗|1∗
k,m(cid:105)⊗|1∗
gg|Φs1m(cid:105)⊗|1∗
sgσ m
σ n

k,n(cid:105) + x2 ∑

k,m(cid:105)⊗|1∗

k,m(cid:105)⊗|1∗

k,n(cid:105) + x2 ∑

n,m

n,m

n,m

n

n

ρ(t) = S(t,t0)ρ(t0) +

∞
∑
n=1

(cid:90) t

t0

(cid:90) t2

t0

dtnS(t,tn)J(tn) . . .

dt1S(t1,t0)ρ(t0) .

(SM6)

(a)Target...N atomszControl fields(b)DetectorThe non-hermitian evolution leads to:

|Ψ(t)(cid:105) ∝ e−iHefft|Ψ0(cid:105) ∝ |Φs1m(cid:105) + x

e−(Γ1d+Γ∗)t

√
Nm

Seg |Φs1m(cid:105) +

x2
2

e−2(Γ1d+Γ∗)t

(cid:115)

2

Nm(Nm − 1)

eg|Φs1m(cid:105) + O(x3) ,
S2

(SM7)

8

where we see that if we wait a time long enough, i.e., t (cid:29) (Γ∗)−1 the only population remaining in |Ψ(T )(cid:105) → |Φs1m(cid:105). The
probability emitting a collective photon from Seg|Φs1m(cid:105) is given by:

where in the last approximation we assumed to be in a regime with P1d (cid:29) 1, whereas the one of emitting an spontaneous emission
photon from the same state:

,

(SM8)

pcoll =

≈ x2

x2
1 + 1
P1d

p∗ =

x2

P1d + 1

(cid:19)

(cid:18)
1− 1
P1d

.

≈ x2
P1d
(cid:18)
1− 1
P1d

(cid:19)

(SM9)

We herald with the detection of a waveguide photon with efﬁciency η, such that the ﬁnal success probability of heralding is:

p = pcoll × η ≈ ηx2

,

(SM10)

In case of no detection it may have happened that our waveguide photon was emitted but not detected, that is, the atoms will
indeed be in a superposition Ssg |Φs1m(cid:105). So, before making a new attempt, we need to ensure that we pump back any possible
excitation in |g(cid:105) to |s(cid:105). However, to minimize the probability of emitting an leaky photon, which spoils the coherence of our
stored superpositions, one needs to apply a repumping procedure in three steps:

• First, apply a π pulse with a microwave ﬁeld that ﬂips all the excitations |g(cid:105) → |s(cid:105). This switches Ssg|Φs1m(cid:105) into Sgs|Ψs1m(cid:105),
where |Ψs1m(cid:105) is the same as |Φs1m(cid:105) but with levels |s(cid:105) and |g(cid:105) interchanged.
• Then, we apply a fast Raman π-pulse with Ω (cid:29) NΓ1d such that Sgs|Ψs1m(cid:105) → Ses|Ψs1m(cid:105) → |Ψs1m(cid:105). This incoherent transfer is
done through a collective photon, such that the probability of emitting a leaky photon is:

ppump,∗ ≈ (1− η)× pcoll × 1
NmP1d

≈ (1− η)

x2

NmP1d

.

(SM11)

• Finally, we reverse the microwave π-pulse such that |g(cid:105) ↔ |s(cid:105) and therefore |Ψs1m(cid:105) → |Φs1m(cid:105).

C. Fidelities of the protocol.

In order to calculate the errors (and ﬁdelities) of the protocol we have to distinguish between the errors introduced after

successfully heralding the excitations, and the error per trial that we introduce when we repeat the protocol after failure.

• Successful heralding: From Eq. SM5, it can be seen that if we detect a single photon in the waveguide, this means that the
initial density matrix ρm = |Ψm(cid:105)(cid:104)Ψm| transforms into:

ρm → 1
Nm

SgsρmSsg +

2x2(1− ηd)
Nm(Nm − 1)

gsρmS2
S2
sg ,

(SM12)

where the ﬁrst term is the desired process, whereas the second corresponds to the probability of detecting only one of
es |Φs1m(cid:105). This introduces a large error as the state Sgs |Φs1m(cid:105) is
the two photons emitted from the doubly excited terms S2
orthogonal to the state that we want to create, such that the error when heralding is:

• Failed heralding: If we detect no photon, then, our state is projected to:

εdouble = x2(1− η) .

ρm → (1− x2)ρm + pcoll(1− η)

1
Nm

SgsρmSsg + p∗J∗ρm + O(x4) ,

(SM13)

(SM14)

9
which corresponds to processes in which: i) we have not created any excitation in the system, with probability (1− x2),
ii) we have created a single collective excitation emitting a collective photon but we have not detected it; iii) we have
created a single excitation, but it has emitted a free space photon, represented through J∗ρm. As we explained before, after
appropriate repumping, the errors from undetected collective quantum jumps can be corrected introducing some extra
spontaneous emission probability, such the ﬁnal density matrix after repumping is given by:

ρm → (1− x2)ρm +(cid:0)ppump,∗ + p∗(cid:1)J∗ρm + O(x4) ,

Fortunately, the errors from spontaneous emission are not so severe as the resulting state still have a big overlap with the
original state:

(cid:104)Φm|J∗[ρm]|Φm(cid:105) =

(cid:0)N−1
(cid:1)
(cid:1) ≈ 1− 2m
(cid:0)N

m

N .

m

(SM15)

(SM16)

(SM17)

Therefore, the error introduced per failed attempt is given by:

εfail,∗ =(cid:0)ppump,∗ + p(cid:1) m

N

• Complete process: The complete process consists (in average) of a successful heralding event and 1/p repetitions such
that the average ﬁnal (in)ﬁdelity to generate Ssg|Φs1m(cid:105) is given by:
p + εdouble ≈ m
ηNP1d

Im→m+1 ≈ εfail,∗

+ (1− η)x2 ,

(SM18)

Therefore, the best ﬁdelity that can be obtained is done by imposing: x2 =

, however, at the price of bad scaling
of probability: p =
NP1d(1−η) [34]. This trade off between probabilities and ﬁdelities comes from the well known problem of
double excitations in these type of probabilistic protocols for atomic ensembles. The total error to accumulate m excitations
depends on how to combine excitations from s1 and s and will be discussed in Section SM5.

η(1−η)NP1d

m

m

1. Accumulating excitations in the same level.
If we accumulate excitations directly in s, the initial state in each step will be |Φs

the very same way, but the heralding probability has in this case a small correction in m which reads:

(cid:18)

m(cid:105) instead of |Φs1m(cid:105). The protocol works in
(cid:19)

(SM19)

pm = pcoll,m × η ≈ ηx2

1−

1

(m + 1)P1d

.

Moreover, in case of failure we reinitialize the process from the beginning, pumping back all the atoms to g, which avoids
the need of applying the repumping protocol discussed below. The inﬁdelity at each step in this case only come from double
excitations contributions scale as:

Im→m+1 = εdouble ≈ (1− η)x2 .

(SM20)

The total error to accumulate m collective excitations will be directly Im = m(1− η)x2.

SM2. HERALDING SINGLE COLLECTIVE EXCITATIONS USING ATOM-WAVEGUIDE QED: TWO-STEP PROTOCOL

WITH EXPONENTIAL SCALING.

In this Section we discuss the second protocol of the main manuscript which overcomes the trade-off between heralding
probabilities and ﬁdelities. The starting point is that our target ensemble already contains m collective excitation in a given level
m(cid:105). Then, the protocol is divided in two-steps: i) we use a single atom to provide single excitations
s, i.e., our initial state is |Φs
to the target ensemble; ii) then, we use an independent ensemble to herald the successful transfer of the excitations to the target
ensemble.

10

Figure SM2. (a) General setup consisting in three individually ensembles: a single source atom and a target/detector ensembles and N/Nd
atoms respectively. (b) Internal level structure of emitters in which the transition e1(,e2) ↔ g(,s) is coupled to a waveguide mode with rate
Γ1d. The transition e1 ↔ a1 is driven by a two-photon off resonant process such that there is no spontaneous emission associated to it. The
transition e2 → s is controlled through a laser with Rabi frequency Ωb, and the transition s ↔ sn is controlled through microwave/Raman
laser Ωc. In the case of the target atoms, we require extra hyperﬁne levels {|sm(cid:105)}n, to store atomic excitations. (c) Detail of closed transition
implementation using a two photon Raman transition using |a2(cid:105) as the auxiliary intermediate state.

A. Atom-waveguide resources.

The requirements that we need for this protocol are:
• The general setup is depicted in Fig. SM2(a): we have one individually addressable source atom, and two independently
addressable ensembles with N,Nd atoms respectively, one where we store the collective excitations, namely, the target
ensemble and another one that we use to herald the excitations, namely, the detector ensemble. We assume that the
atoms have a general level structure as depicted in Fig. SM2(b), with two dipolar transitions e1(,e2) ↔ g(,s) coupled to a
waveguide modes with an effective rate Γ1d.
• The atoms must be placed at distances zn = nλa, with n ∈ N and being λa the characteristic wavelength of the guided mode
at the atomic frequency. With that choice, the dynamics induced by the waveguide is given only by long-range dissipative
couplings, described by the following Lindblad terms:

Lcoll [ρ] =

Γ1d
2

Dσ sge1

[ρ] +

Γ1d
2

Dσ sse2

+Sge1 +Sd
ge1
αβ denote the collective spin operators (∑n σ n
where Sαβ ,Sd
αβ ) in the target/detector atoms. Note that in principle they will
be expressed all in a collective jump operator as they are all coupled to the same guided mode. However, we separate them
for convenience as in our protocol each term will act in the two different steps of the protocol.
• The excited states may also decay to other channels than the one inducing the long-range couplings, which we embedded
in a single decay rate Γ∗. However, to obtain the desired scaling we use a closed transition [8, 20, 21], that we study more
in detail in a separate section. Thus, the ﬁnal spontaneous emitted photons are described by:

+Sse2 +Sd
se2

(SM21)

[ρ] .

(cid:17)

(cid:16)Γ∗

4

L∗(ρ) = ∑

n

Dσ n
se2

[ρ] +

Dσ n

a1e2

[ρ] +

Dσ n
ge1

[ρ]

,

(SM22)

Γ∗
4

Γ∗
2

where we deﬁne the coefﬁcients accompanying the jump operators, such that both transitions have the same P1d.
• Finally, we also require the existence of Raman/microwave ﬁelds, Ωa,b,c as depicted in Fig. SM2(a) that classically control
the transition between different levels.

1. Example of closed transition

There have already been several proposals in the literature of closed transitions [8, 20, 21] but for completeness, we discuss
here in detail one of particular realization sketched in Fig. SM2(c). The state a1 is connected to the excited state e1 with a two-
photon transition through the intermediate state a2. The level a1 is chosen, e.g., such that the direct transition a1 ↔ e1 is dipole
forbidden. Then, denoting as Ω1(Ω2) the Rabi frequency connecting a1 ↔ a2(,a2 ↔ e1), and choosing a detuning ∆a (cid:29) Ω1,Ω2,
the microwave and Raman laser induce a two photon transition from a1 ↔ e1 with effective driving Ωa = Ω1Ω2
4∆a .

B. Protocol and calculation of probabilities

The protocol for heralding single collective excitation starts with the source/target/detector atoms in |a1(cid:105)s ⊗|Φs

m(cid:105)t ⊗|s(cid:105)N

d and

it consists of several steps (as depicted in Fig. 2b of the main manuscript):

(a)(c)(b)SourceTarget...DetectorN atomszControl fieldsNd atoms...11
1. In the ﬁrst step, we move the target/detector atoms in s to an auxiliary level s1, such that we have |a1(cid:105)s ⊗|Φs1m(cid:105)t ⊗|s1(cid:105)Nd ,

avoiding that the excitations from the waveguide can be absorbed the detector level s.

2. In the second step, we excite the source atom to e1, then, we switch on Ωt

b (cid:28) NdP1d), such that the excitation is coherently transferred to the ensemble to a1, i.e., Sa1g|Φs1m(cid:105).

a under the Quantum Zeno dynamics conditions

(Ωd

3. Now, we move back the states in the target/detector ensemble from s1 to s, such that, we prepare Sa1g|Φs

Moreover, we move the source atom to, e.g., s1, such that it plays no role in subsequent steps.

m(cid:105)t ⊗ |s(cid:105)⊗Nd

d

.

4. Then, we do a fast π-pulse in the ensemble with Ωb, such that, Sa1g|Φs

Zeno dynamics conditions (Ωd

b (cid:28) NdP1d), such that we arrive to a state in the target/detector atoms |Φs
5. Thus, if we measure the detector atoms in a1, we herald the transfer of a single collective excitation to s.

m(cid:105) → Se2g|Φs

m(cid:105). Afterwards, we apply Ωd

b within the
m+1(cid:105)⊗ Sa1s|s(cid:105)⊗Nd .

Assuming that π-pulses are perfect, the relevant steps of the protocols for the analysis of probabilities and ﬁdelities are the
second and the fourth. Interestingly, they can be analyzed in a common way as in each of them what happens is that a single
excitation is transferred through the waveguide via Zeno dynamics to an ensemble with N/Nd atoms respectively. Therefore, in
the following Section we analyze the general problem and then we will particularize for steps 2 and 4.

1. General Zeno step

The general problem consists of two ensembles (a and b) with three-level atoms (with metastable states |0(cid:105), |1(cid:105) and excited
state |2(cid:105)) that contain Na and Nb atoms each. The dynamics are governed by the collective decay on the |2(cid:105)−|1(cid:105) transition,
i.e., L [ρ] = 1
21 + h.c.. Therefore the effective
non-hermitian hamiltonian that drives the no-jump evolution is given by:

[ρ] and an external ﬁeld on the second ensemble, i.e., Hb = 1

2ΩS(b)

2Γ1dD

S(a)
12 +S(b)
12

(cid:16)

Heff =

1
2

ΩS(b)

21 + h.c.

(cid:17)− i

(cid:0)S(a)

Γ1d
2

(cid:1)(cid:0)S(a)

(cid:1)− i

21 + S(b)
21

12 + S(b)
12

Γ∗
2 ∑

n

σ n
ee.

(SM23)

Denoting the collective symmetric excitations as |#0,#1,#2(cid:105)a/b, the initial state of the problem we want to analyze can be
written |0,0,1(cid:105)a ⊗|0,N − m,0(cid:105)b and the goal state is |0,1,0(cid:105)a ⊗|1,N − m− 1,0(cid:105)b.
The decay operators couple an initial state |ψ1(cid:105) = |Na− k− 1,k,1(cid:105)a⊗|0,Nb,0(cid:105) to |ψ2(cid:105) = |Na− k−1,k + 1,0(cid:105)a⊗|0,Nb,1(cid:105) and
the coherent terms couple the latter to |ψ3(cid:105) = |Na − k− 1,k + 1,0(cid:105)a ⊗|1,Nb,0(cid:105). In this basis, one can write the Hamiltonian as

 −i ((k + 1)Γ1d + Γ∗) −i(cid:112)(k + 1)NbΓ1d 0
−i(cid:112)(k + 1)NbΓ1d

−i(NbΓ1d + Γ∗) Ω
0

Ω

0

 .

Heff =

1
2

When the coherent driving is weak compared to the collective dissipation Ω (cid:28) NbΓ1d, the superradiant state can be adiabati-

cally eliminated and an effective Zeno Dynamics between the dark states is obtained, which is governed by the Hamiltonian

or equivalently in the basis of superradiant and dark states, that is {|ψs(cid:105),|ψd(cid:105),|ψ3(cid:105)} with |ψs(cid:105) =
and |ψd(cid:105) =

−i ((Nb + k + 1)Γ1d + Γ∗)

(cid:113) Nb
Nb+k+1|ψ1(cid:105)−(cid:113) m+1
Nb+k+1|ψ2(cid:105), as

(cid:101)Heff =
 −i ((Nb + k + 1)Γ1d + Γ∗)

−(cid:113) Nb

0
Nb+k+1Ω

HAE ≈ 1
2

1
2

0

0

−(cid:113) Nb
−(cid:113) k+1

Nb+k+1Ω
Nb+k+1Ω
0

−(cid:113) k+1

0
−iΓ∗
Nb+k+1Ω

0
(cid:113) m+1
−iΓ∗
−i
Nb+k+1Ω −i

−i

(cid:113) k+1

0
Nb+k+1Ω
Nb|Ω|2
(Nb+k+1)2Γ1d

(cid:113) k+1
Nb+k+1|ψ1(cid:105) +
 .
 .

(SM24)

(cid:113) Nb
Nb+k+1|ψ2(cid:105)

(SM25)

(SM26)

To minimize the errors, one chooses Ω =(cid:112)(Nb + k + 1)Γ1dΓ∗ such that

then approximately given by

|ψd(t)|2 ≈

Nb

Nb + k + 1

12

e−Γ∗t cos2(cid:16)
e−Γ∗t sin2(cid:16)

Nb|Ω|2

(Nb+k+1)2Γ1d

t

2

Γ∗(cid:112)(k + 1)P1d
Γ∗(cid:112)(k + 1)P1d
(cid:17)−1
(cid:16)(cid:113) k+1

t

Nb+k+1Ω

,

= Γ∗. The dynamics for each state is

(SM27)

(cid:17)
(cid:17) ≡ p,
and Ω =(cid:112)(Nb + k + 1)Γ1dΓ∗ for k (cid:28) Nb.

(SM29)

(SM28)

Nb

|ψ3(t)|2 ≈
|ψs(t)|2 ≈ k + 1

Nb + k + 1

Nb + k + 1

2
e−(Γ∗+(Nb+k+1)Γ1d)t .

p =

Nb

Nb + k + 1

√
e−π/
(k+1)P1d ,

(SM30)

The success probability p = |ψ3(T )|2 is the maximized for T = π

In this case, one obtains

where the prefactor originates in the non-unit overlap of the initial state with the dark state, i.e., |(cid:104)ψd|ψ1(cid:105)|2 = Nb

For the repumping protocols that we will study in Section SM3 it is important to know the probability of spontaneous jumps
in both ensembles during the evolution. As we already saw in the ﬁrst protocol, the problematic processes are the one associated
to leaky photons. The quantum jump analysis shows that the probability for a spontaneous jump in the ensemble a or b is given
by

Nb+k+1.

pa,∗ = pa1,∗ + pa2,∗ = Γ∗(cid:90) T
pb,∗ = pb1,∗ + pb2,∗ = Γ∗(cid:90) T

0

dt1|ψ1(t1)|2 + Γ∗(cid:90) ∞
dt1|ψ2(t1)|2 + Γ∗(cid:90) ∞

0

0

0

dt1|ψ1(T )|2e−Γ∗t1,
dt1|ψ2(T )|2e−Γ∗t1,

(SM31)

(SM32)

where the ﬁrst parts, pa,b1,∗, corresponds to the interval of time (0,T ) where Ω is switched on, and the second part, pa2,∗, the
time t (cid:29) 1/Γ∗ that we wait, with Ω = 0, such that all the population in the excited state, if any, disappears. By using the
approximations for Heff, we can calculate the different contributions and upper bound the probabilities from these processes

√
(k+1)P1d ) (cid:46) π
pa1,∗ (cid:46) 1
√
(1− e−π/
P1d
2
2
√
√
(k+1)P1d) (cid:46) π
k + 1
√
(1− e−π/
2Nb
P1d

pb1,∗ (cid:46) k + 1
2Nb

,

(SM33)

(SM34)

which mainly comes from the contribution of the dark state and where the last approximation is valid for P1d (cid:29) 1.
T = π/(cid:112)(k + 1)Γ1dΓ∗ such that then |ψd(T )|2 = 0. The only contribution remaining is the one of the superradiant |ψs(T )(cid:105) =
Finally, we need to consider what happens with the contribution pa2,∗ when P1d (cid:29) 1, and when we assume a perfect timing,
(cid:113) k+1
Nb+k+1 e−(Γ∗+(Nb+k+1)Γ1d)T /2, which leads to

pa2,∗ (cid:46) (k + 1)2
pb2,∗ (cid:46) Nb(k + 1)

√
(Nb + k + 1)2 e−π(Nb+k+1)/
(k+1)P1d ,
√
(Nb + k + 1)2 e−π(Nb+k+1)/
(k+1)P1d ,

(SM35)

(SM36)

which are negligible compared to pa,b1,∗ for sufﬁciently large Nb.

2. Particularizing for the two step protocol: success probability and inﬁdelity.

The second step of the protocol that we want to analyze corresponds to identifying in the general problem |0(cid:105) = |a1(cid:105), |1(cid:105) = |g(cid:105),
|2(cid:105) = |e1(cid:105), Ω = Ωa, where the ensembles have a size of Na = 1 and an effective size Nb = N − m because the m excitations in all
other states are decoupled and effectively reduce the atom number. This results in a heralding probability:

pa =

N − m
N − m + 1

√
e−π/
P1d .

(SM37)

13

Figure SM3. (a) Ratio between the probability of success with/without pulse shaping ppulse/p as a function of P1d for a situation with N = 100
atoms in the ensemble receiving the excitations. (b) Optimal Ω(t) for a situation with N = 100,P1d = 50 using 10 discretization steps. In red
we plot the optimal Ω for the situation of constant pulses.

In the fourth step, the equivalence reads |0(cid:105) = |a1(cid:105), |1(cid:105) = |s(cid:105), |2(cid:105) = |e2(cid:105), Ω = Ωb and the ensembles have a size of Na = N and
Nb = Nd. The initial state is |N − m− 1,m,1(cid:105)a ⊗|0,Nd,0(cid:105)b and the goal state is |N − m− 1,m + 1,0(cid:105)a ⊗|1,Nd − 1,0(cid:105)b. Thus, the
success probability reads:

where it can be shown that in the limit of N,Nd (cid:29) m, the total probability of success is lower bounded by: p (cid:38) p2

(SM38)

√
a ≈ e−2π/
P1d.

pb =

Nd

Nd + m + 1

√
e−π/
(m+1)P1d ,

3.

Improving probability through pulse-shaping.

(cid:101)Heff ≈ 1

2

(cid:33)

(cid:32) −iΓ∗

Ω√
N
N −i |Ω|2
Ω√

NΓ1d

So far, we have restricted our attention to the case of constant pulse driving Ω. However, it is in principle possible to shape Ω(t)
such that the excitation transfer from |ψ1(cid:105) to |ψ3(cid:105) is improved. The problem of optimizing Ω(t) can not be tackled analytically,
however, we can choose a discretization of time [t1,t2, . . .tn], and try to ﬁnd the optimal choice of Ωi’s such that it maximizes
|(cid:104)ψ1|ψ3(cid:105)|2. In Fig. SM3, we show an example that such optimization is possible by discretizing the optimal time found in the
previous Section T in 10 steps. In Fig. SM3(a), we show the ratio between the probability of success with/without pulse shaping
ppulse/p as a function of P1d for a situation with N = 100 atoms in the ensemble receiving the excitations, where we show how
probability can be increased, specially for moderate P1d. In panel (b), we show an example of such optimization for the case
of P1d = 50, showing how the optimal shape found is bigger that the optimal Ωopt (in red) for a constant pulse at initial times
and then smaller. The intuition for this shape can be understood by looking the effective Hamiltonian that drives the evolution.
Within the Zeno dynamics, only the dark states |ψd(cid:105) and |ψ3(cid:105) are relevant. If we project the dynamics within this subspace, we
obtain a 2× 2 hamiltonian:

.

(SM39)

From this effective Hamiltonian, we realize that while the initial state (mostly |ψd(cid:105)), which only decays with Γ∗, independent of
Ω the ﬁnal state where we want to arrive decays with an effective decay rate which increases with Ω, i.e.,
. Therefore, it is
more optimal to ramp up ﬁrst Ω while the population in |ψ3(cid:105) is still small. By using more elaborate pulse shaping, even better
improvements might be found.

|Ω|2
NΓ1d

SM3. HERALDING SINGLE COLLECTIVE EXCITATIONS USING ATOM-WAVEGUIDE QED: TWO-STEP PROTOCOL

FOR POLYNOMIAL SCALING.

In this Section we analyze the third protocol discussed in the manuscript. This protocol is a variation of the second protocol
in which after each successful heralding we store the excitations in different levels {|sn(cid:105)}n to combine them a posteriori. This
however implies the modiﬁcation of the previous protocol to obtain the desired 1/(NP1d) scaling for the inﬁdelity Im→m+1. In
√
√
particular, the second step can not be done through Quantum Zeno dynamics, because the probability of emitting an spontaneous
photon within the target ensemble is large, i.e., pb,∗ ∝ 1/
P1d, that would yield an inﬁdelity Im→m+1 ∝ 1/(N
P1d). Therefore,
in order to achieve subexponential scaling in the number of operations and inﬁdelities still scaling with Im ∝ 1/(NP1d) one needs
to make judicious modiﬁcation of the setup as we will explain now.

0.00.10.20.30.40501001502001010010001041.051.101.151.201.251.301.351.40(a)(b)14

√
Figure SM4. (a-b): Evolution of populations calculated with exact numerical integration (markers), together with the analytical approximations
NmΓ1dΓ∗. The two panels correspond to a situation with Nm = 100 = P1d (a) and
√
(solid lines, see text) by choosing the optimal Ωa =
Nm = 1000, P1d = 0.1 (b). (c) Exact (solid lines) and analytical optimal probability using Ta ≈ π/
Γ∗Γ1d.

A. Atom-waveguide resources for two-step protocol.

The requirements of this protocol are exactly analogue to the ones of Section SM2 with two modiﬁcations: i) we only require
a single detector atom, i.e., Nd = 1[35]; ii) we require the existence of several hyperﬁne states {sn} to store the superpositions.

B. Protocol and calculation of probabilities

In this Section, we analyze the main protocol described for heralding the transfer of a single collective excitation to the target

ensemble, assuming that is already in an entangled state |Φ{sn}

m (cid:105), with m excitations, which can be written as follows:

|Φ{sn}

m (cid:105) =

(cid:1)sym{|s1(cid:105)⊗m1 . . .|sn(cid:105)⊗mn|g(cid:105)⊗Nm}

1(cid:113)(cid:0)

N

m1,m2,...,mn

(SM40)

where(cid:0)

N

m1,m2,...,mn
want to create is:

(cid:1) =

m1!...mNNm)! is the number of states within the superposition, denoting Nm = N − m. The ﬁnal goal state we

N!

|Φgoal(cid:105) =

1√
Nm

Ssg|Φ{sn}
m (cid:105) .

(SM41)

As we discussed in the main text, there are two steps that we also consider separately: (a) to move an excitation from the
source to the target using Quantum Zeno Dynamics (which is analogue to the one discussed in Section SM2); (b) herald the
transfer by inducing a change in the detector atom state. The second step has to be done fast in order to get the desired scaling
of inﬁdelity. We will consider these processes separately. We assume the initial state of the detector is |s(cid:105)d such that it only
participates in step (b).

1. Step (a): From source to target using Zeno dynamics (no-jump evolution).

m (cid:105) = |Ψa,1(cid:105), which couples to other states, namely, |Ψa,2(cid:105) = |g(cid:105)⊗ Se1g√
Nm

This ﬁrst step is exactly analogue to the ﬁrst step of the second protocol discussed in Section SM2. We start in an initial state
|Ψ0,a(cid:105) = |e(cid:105)⊗|Φ{sn}
|Φ{sn}
m (cid:105).
For completeness, we compare the analytical expression of the dynamics obtained in Section SM2 with the full integration of
master equation in Figs. SM4(a-b), where we observe that they are a good approximation even for systems with P1d < 1, as long
as NmP1d. The optimal heralding probability

|Φ{sn}

m (cid:105) and |Ψa,3(cid:105) = |g(cid:105)⊗ Sa1g√
Nm

pa ≈ Nm
Nm + 1

√
e−π/
P1d ,

(SM42)

that we compare to the exact result in Fig. SM4(c), being a good approximation even when P1d < 1.

2. Step (b): heralding the transfer using fast π-pulses (no-jump evolution).

This second step of the protocol do not rely on quantum Zeno dynamics, and it will take place between the target and detector
b (cid:29) Γ1d such that the possible excitation

atoms. As we explained in the main text the idea is to: i) ﬁrst do a fast π pulse with Ωt

01020304050600.00.20.40.60.81.0,0.00.20.40.60.81.010-610-510-40.0010.010.110.1110100100010-40.0010.010.11(a)(b)(c)PopulationsPopulationsm (cid:105) → Se2g|Φ{sn}

15
in Sa1g|Φ{sn}
m (cid:105); ii) let the system evolve only through the couplings induced by the waveguide; iii) do a π pulse in
b (cid:29) Γ1d, such that any remaining excitation in the excited states |e2(cid:105) go back
both the target and detector ensemble, i.e., Ωt
to |a1(cid:105). It is important to notice that if no excitation has been transferred to |a1(cid:105) in step (a), nothing will happen in this step.
m (cid:105)⊗|s(cid:105). The effective Hamiltonian in this case is
Therefore, we consider our initial state to be: |Ψ0,b(cid:105) = |Ψb,1(cid:105) = 1√
Nm
then given by:

Se2g|Φ{sn}

b,Ωd

Hb,eff = −i

(cid:1) ,

(cid:0)Se2s + σ d

(cid:1)(cid:0)Sse2 + σ d
(cid:19)

n

se2

e2s

− i

Γ1d
2

Γ∗
2 ∑
σ n
e2e2
(cid:18) −i(Γ∗ + Γ1d)
Ssg|Φ{sn}
m (cid:105)⊗|e2(cid:105). In this basis the effective Hamiltonian reads:
1
2

Hb,eff =
in the basis of sub/superradiant state: {|Ψb,D(cid:105) = 1√

−iΓ1d

−iΓ1d

.

(SM44)
(|Ψb,1(cid:105)−|Ψb,2(cid:105)) ,|Ψb,S(cid:105) =

2

which connects |Ψb,1(cid:105) only to |Ψb,2(cid:105) = 1√
Nm

It
is again instructive to rewrite it
(|Ψb,1(cid:105) +|Ψb,2(cid:105))}, arriving to:

1√
2

(SM43)

(SM46)

(SM47)

(SM48)

(SM49)

(SM45)
where the Hamiltonian is diagonal. From here, it is simple to arrive to the solution of the dynamics: |Ψb(t)(cid:105) = e−iHb,efft|Ψ0,b(cid:105) =
∑ j β j(t)|Ψb, j(cid:105), which read:

Hb,eff =

in the original basis. Notice that pb will be the probability of having transferred the collective excitation to the target while
changing the detector atom state to a1, if we assume that the second π pulse is perfect. If we choose a time Tb = 1/Γ1d, then

1
2

−i(Γ∗ + Γ1d)
(cid:19)

.

0

0 −i(Γ∗ + 2Γ1d)

(cid:18) −iΓ∗
1 + e−Γ1dt(cid:105)2
e−Γ∗t(cid:104)
1− e−Γ1dt(cid:105)2 ≡ pb ,
e−Γ∗t(cid:104)
(cid:1) = 0.46(cid:0)1− 1
(cid:0)1− 1
(cid:0)1− 1
(cid:1) ≈ 0.1(cid:0)1− 1

1
4
1
4

P1d

P1d

(cid:1) ,
(cid:1) ,

P1d

P1d

|β1(t)|2 =
|β2(t)|2 =

|β1(Tb)|2 ≈ (e + 1)2
4e2
pb ≈ (e− 1)2

4e2

Interestingly, there is a sizeable probability of remaining in the initial state of this step. So instead of start from the beginning

every time that we fail, it is possible to repeat this step several times, which increases probability to pb ≈ 1/3.

3. Step a: Using Zeno dynamics (quantum jump analysis).

As we already calculated in Section SM2, the probability of having an individual quantum jump in the target ensemble is

given by:

pa,∗ (cid:46)
pa,∗ (cid:46)

, if P1d (cid:29) 1

π
√
P1d
(Nm + 1)
, if P1d (cid:28) 1 .

3

(Nm + 1)

(SM50)

(SM51)

In Fig. SM5 we compare the exact results (markers) with the upper bound (solid lines) for εa, showing that actually we get

the right scalings both with P1d and Nm.

4. Step b: heralding the transfer using fast π-pulses (quantum jump analysis).

The relevant quantum jumps in this step are Jbρ = Jb,∗ρ + Jb,collρ, with
Γ∗
(cid:1)ρ(cid:0)Se2s + σ d
2 ∑

Γ∗
(cid:0)Sse2 + σ d
2 ∑
Jb,collρ = Γ1d

σ n
se2ρσ n

Jb,∗ρ =

e2s +

n

n

se2

e2s

(cid:1) .

σ n
a1e2ρσ n

e2a1

,

(SM52)

16

Figure SM5. (a-b): Exact (markers) vs estimated upper bound (solid lines) pa,∗ as a function of P1d (a) and Nm (b). The exact calculation is
√
π
obtained from integrating populations in Eq. SM48, whereas for the analytical upper bound we use the leading order contribution:
.
P1d
2(Nm+1)
The Ta is chosen to be the optimal one as in Fig. SM4.

Figure SM6. General scheme of repumping process to correct collective quantum jump errors (see details in the text).

In this second step, we make a π-pulse with Ωt

is left free to evolve for a time Tb = 1
Γ1d
Therefore, the quantum jumps could only occur within a small time interval giving rise to

, and switching the Ωt

b,Ωd

b, such that the initial state |Ψb,0(cid:105) = |Ψb,1(cid:105) = 1√

(cid:105). Then the system
b such that no population remains in the excited state e2.

Se2g|Φ{sn}n

Nm

m

pb,∗ = Γ∗(cid:90) Tb

dt1|β1|2 ≈ 0.67
P1d

.

(SM53)

0

In this regime, with P1d (cid:29) 1 and Tb = 1
Γ1d

, it is also instructive to consider the probability of other quantum jumps. For
example, to calculate the probability that the excitation is transferred to Ssg|Φ{sn}
m (cid:105) but the state of the detector is unchanged, i.e.,
remains in s, one needs to sum up the probability of making a collective quantum jump in the target together with the probability
of making any jump in the f → s transition:
(cid:90) Tb

(cid:90) Tb

(SM54)

pb,coll = Γ1d

0

dt1|β1|2 + (Γ1d +

dt1|β2|2 ≈ 0.71 ,

Γ∗
2

)

0

which biggest contribution comes from the emission in the target ensemble. These states have not destroyed the coherence of
|Φ{sn}
m (cid:105) but they need to be properly taken care of with the repumping process. In order to avoid that these states also lead to
error, we have to make a repumping process back to |g(cid:105) in the way depicted in Fig. SM6:

1. First we pump incoherently back any possible excitation in |c(cid:105) through the waveguide, namely, Sa1g|Φ{sn}

m (cid:105) →
m (cid:105). Because this process is done through a collective photon the error introduced in this step

m (cid:105) → |Φ{sn}

Se1g|Φ{sn}
ppump,∗ ∝ 1
NP1d

.

2. Once, we have make sure that there are no excitation in |a1(cid:105) we can move the excitations from Ssg|Φ{sn}

m (cid:105) → Sa1g|Φ{sn}
m (cid:105)

with π pulse using a microwave or two-photon Raman transition.

3. Now, after having transferred the excitation to |a1(cid:105), we repeat the incoherent transfer through the waveguide that will only

introduce errors of the order ppump,∗.

0.111010010001×10-45×10-40.0010.0050.0100.05010205010020050010005×10-40.0010.0050.0100.050(a)(b)(a)1st part(c)3rd part(b)2nd part17

Figure SM7. Scaling of the exact (solid lines) and approximated (markers) inﬁdelities with P1d (Panel a) and Nm (Panel (b)) for different Nm
and P1d respectively as depicted in the legends.

C. Fidelities of the protocol.

From the calculation of probabilities of the previous Section, we are prepared to estimate the average ﬁdelity when detecting

an atomic excitation in the detector atom in a1. The errors appear:

• Successful heralding: As shown in the main manuscript, in the case where the transition e1 → |a1(cid:105) is closed the only
way of measuring detector atom in |a1(cid:105) is by successfully generating |Φgoal(cid:105). If we have a spurious spontaneous emission
∼ αΓ∗, then, it is possible that we herald the transfer of an incoherent excitation of s, i.e., σ n
sg, which have an overlap
∝ 1/N with the state we want to create. Thus, the possible error after heralding is given by:

εclosed =

α
√
P1d

N

.

(SM55)

• Failed heralding: As it occurred in the ﬁrst protocol, in each failed attempt we introduce an error in our initial state |Φ{sn}
m (cid:105)
due to the probability of emitting free space, which in this protocol may occur in step (a), (b) and the repumping. The
error per attempt can be estimated to be:

ε∗ ≈ (pa,∗ + pb,∗ + ppump,∗)

m
N

≈ 0.67m
NP1d

.

(SM56)

where in the last approximation we assumed to be in a regime where pb,∗ (cid:29) pa,∗, ppump,∗.
• Complete process: As in the ﬁrst protocol, the average complete process consist of a successful heralding and 1/p failed
attempts, such that the average ﬁdelities of the process:

Im→m+1 = εclosed +

m

,

ε∗
p =

α
√
P1d

+

pNP1d
√
where one sees that to reach the Im−>m+1 ∝ 1/(NP1d) scaling, we do not need a perfectly closed transition, but it is enough
to demand a cancellation of spontaneous emission (α) of at least α = 1/
P1d which can be achieved as well, e.g., by
using a quadrupole transition.

N

(SM57)

In Fig. SM7, we compare the analytical approximation of inﬁdelities of Eq. SM57 (markers) together with exact results (solid

lines) as a function of P1d and Nm.

SM4. HERALDING SINGLE PHOTON EXCITATIONS USING ATOM-WAVEGUIDE QED: SINGLE-STEP PROTOCOL FOR

POLYNOMIAL SCALING.

In this Section, we study a modiﬁcation of the previous protocol such that we can do the heralded transfer in a single step and
without the need of the closed transition at expense of showing a worse scaling of the success probabilities and inﬁdelities and
with the requirement of two different guided modes. These protocol is not discussed in the main manuscript, though we include
here for completeness.

10-310-210-1(a)(b)102050100200500100010100502030157010-410-310-210-118

Figure SM8. Variation of the internal level structure of emitters of the different ensembles in which the transition |e(cid:105) ↔ |g(cid:105) [|e(cid:105) ↔ |g(cid:105) is
coupled to a single waveguide mode with Γ1d. We also require an extra intermediate level |c(cid:105), which forms a closed transition with |e(cid:105). We
also assume that we can control the |e(cid:105) ↔ |g(cid:105)[|s(cid:105)] transition with a classical laser Ωα

ge [Ωα

se].

A. Atom waveguide resources.

The requirements for this protocol are:
• We need to have an atomic conﬁguration of source/target/detector atom as in the previous protocol. However, the internal
level structure must be modiﬁed, as shown in Fig. SM8 to have an excited state |e(cid:105) coupled directly to two waveguide
1d (cid:54)=
modes through the transitions |e(cid:105) ↔ |g[,s](cid:105) with rates Γg[,s]
Γs
1d. The modes can differ either in polarization or frequency, but they must satisfy that their characteristic wavelength λa
is approximately the same.
• To guarantee the heralding, it will be important that the transition |e(cid:105) → |s(cid:105) [|e(cid:105) → |g(cid:105)] of the source [detector] atom to be
largely off-resonant. This must be satisﬁed to avoid a direct transfer of the excitation from the source to the detector atom
that would spoil the heralding.

1d . As we will see afterwards in this case it is important that Γg

B. Protocol and calculation of probabilities.

The main difference with the previous protocol is that is done in a single step. We start with |Ψ0,a(cid:105) =|Ψa,1(cid:105) =|e(cid:105)⊗|Φ{sn}
and consider that only the classical ﬁeld Ωd

ge ≡ Ωd (cid:54)= 0, such that the dynamics governed by the effective Hamiltonian:

m (cid:105)⊗|s(cid:105)

(cid:0)σ d

ge + σ d
eg

(cid:1)− i

Γ∗
2 ∑

n

ee − i
σ n

Ha,eff =

Ωd
2

(cid:1)− i

(cid:0)σ d

Γs
1d
2

(cid:1)(cid:0)σ d

(cid:1) ,

ge + Sge

es + Ses

se + Sse

(SM58)

that couples our initial state to |Ψa,2(cid:105) = |g(cid:105) ⊗ 1√
Nm
1√
Nm

m (cid:105)⊗|g(cid:105). In this basis the Hamiltonian can be written as:

Ssg|Φ{sn}

m (cid:105) ⊗ |s(cid:105), |Ψa,3(cid:105) = |g(cid:105) ⊗ 1√
Nm

Ssg|Φ{sn}

m (cid:105) ⊗ |e(cid:105) and |Ψa,4(cid:105) = |g(cid:105) ⊗

 −i(Γg

1d + Γ∗)
√
−i
NmΓg
0
0

√
−i
NmΓg
1d
1d −i(NmΓg
1d + Γs
−iΓs
1d
0

1d + Γ∗)

Heff =

1
2

0
0
−iΓs
0
1d
−i(Γs
1d + Γ∗) Ωd
Ωd
0

 ,

(SM59)

The goal is to ﬁnd |Ψ(t)(cid:105) = e−iHa,efft|Ψ0(cid:105) = ∑ j α j(t)|Ψ j(cid:105), which can always be done numerically as it is only a 4x4 matrix.
However, in order to gain more insight it is useful to write it in a basis with sub and superradiant states. Interestingly, the
system always contains a dark state |Ψa,D(cid:105) = 1√
1d (cid:54)= 0.
1d/Γg
However, the two orthogonal excited states depend on the ratio Γs
1d. After a careful study, we found the optimal choice for
the maximum transfer to |Ψa,4(cid:105) was to choose Γs
, and the reason is that in that case the two decay channels to |g(cid:105)
and |s(cid:105) show the same ”superradiant” decay (Nm + 1)Γg
1d = Γ1d. For this ratio, the
adiabatic elimination of the superradiant states give rise to an effective 2× 2 between the dark state and the goal state

(cid:0)√
Nm|Ψa,1(cid:105)−|Ψa,2(cid:105) +|Ψa,3(cid:105)(cid:1), which is dark for all values of Γg

1d. From now one, we use that ratio and Γg

1d = Nm+1
2

1d/Γg

1d,Γs

Nm+2

(cid:1)(cid:0)σ s

(cid:0)σ s

eg + Seg

Γg
1d
2
Seg|Φ{sn}

 − iΓ∗

2
√
Ωd
Nm
2

Heff ≈

 .

√
Ωd
Nm
2
−i 3(Ωd)2
2NmΓ1d

(SM60)

...19

ical approximations (solid lines) by using the superradiant/subradiant decoupling of Eq. SM60 by choosing the optimal Ωa =(cid:112)NmΓ1dΓ∗/3.

Figure SM9. (a-b): Evolution of populations calculated with exact non-hermitian hamiltonian (markers) of Eq. SM59, together with the analyt-

The two panels correspond to a situation with Nm = 100 = P1d (a) and Nm = 2000, P1d = 0.1 (b). (c) Exact (solid lines) and analytical optimal
probability using Ta ≈ π

√
√
Γ∗Γ1d.
3/

where we have used Nm (cid:29) 1 to simplify the expressions. As we know from the previous Sections, the more convenient is to
choose an Ωd such that the contribution of Γ∗ and the effective losses induced by superradiant states, i.e., 3(Ωd)2
, is the same.
2NmΓ1d

Thus, by choosing Ωd =(cid:112)NmΓ1dΓ∗/3, it is easy to ﬁnd that:

|αD(t)|2 ≈ Nm
Nm + 2
|α4(t)|2 ≈ Nm
Nm + 2

√
Γ1dΓ∗t
e−Γ∗t cos2(
√
√
2
3
Γ1dΓ∗t
√
2
3

e−Γ∗t sin2(

) ,

) = p(t) .

Therefore, if P1d (cid:29) 1 and Ta = π

√
3√
Γ1dΓ∗ then the probability of heralding reads:

p ≈ Nm
Nm + 2

e−√

√
3π/
P1d ,

(SM61)

(SM62)

In Fig. SM9 we compare the results from the exact integration of the complete non-hermitian hamiltonian together with the
The problematic quantum jump in this case is related to the probability of having an excitation |e(cid:105) in the target ensemble, i.e.,

analytical approximation (markers) obtained from the Quantum Zeno dynamics (solid lines).
coming from the population of state |Ψa,2(cid:105) that reads

p∗ = Γ∗(cid:90) Ta

dt1|α2(t1)|2 + Γ∗(cid:90) ∞

dt1|α2(Ta)|2e−Γ∗t1 ,

(SM63)
where the ﬁrst part corresponds to the interval of time (0,Ta) where Ωd is switched on, and the second part, the time t (cid:29) 1/Γ∗
that we wait, with Ωd = 0, such that all the population in the dark state vanishes. The contributions of the superradiant/subradiant
states to |Ψa,2(cid:105) can be obtained in the asymptotic limit Nm (cid:29) 1, where:

0

0

(cid:112)
|(cid:104)Ψa,D|Ψa,2(cid:105)| ∼ 1√
Nm
(cid:112)
2 +
2

|(cid:104)Ψa,S+|Ψa,2(cid:105)| ∼
|(cid:104)Ψa,S−|Ψa,2(cid:105)| ∼

√
2
2−√

2

2

∼ O(1)

∼ O(1)

Using that information we can estimate the contribution of the dark state within the time interval: (0,Ta).

(cid:90) Ta

0

p∗,D (cid:46) Γ∗
Nm

dt1e−Γ∗t1 (cid:46) 1− e−Γ∗Ta

Nm

,

that is:

p∗,D ≈ π
2Nm

√
3
√
P1d

, if ,P1d (cid:29) 1 ,

(SM64)

(SM65)

(SM66)

0204060801000.00.20.40.60.81.00.00.10.20.30.40.50.610-510-40.0010.010.110.1110100100010-610-510-40.0010.010.11(c)(b)(a)PopulationsPopulations20

Figure SM10. (a-b): Exact (markers) vs estimated upper bound (solid lines) p∗ as a function of P1d (a) and Nm (b). The exact calculation is
obtained from integrating populations in Eq. SM63, whereas for the analytical upper bound we use the leading order contribution of Eq. SM67.
The Ta is chosen to be the optimal one as in Fig. SM9.

whereas the contribution of (Ta,∞) can always be shown to be smaller order: when P1d (cid:29) 1. Therefore, we the overall probability
of emitting a quantum jump in the target ensemble for this protocol

√
3
√
P1d

π
2Nm

p∗ ∝

, if ,P1d (cid:29) 1 ,

(SM67)

which are conﬁrmed numerically in Fig. SM10. The repumping process to correct the collective quantum jump errors can be done
as well in a single step by pumping collectively the atoms from |s(cid:105) → |g(cid:105), which moves Ssg|Φm(cid:105) → Seg|Φm(cid:105) → |Φm(cid:105). Because
this process is done through a collective photon the probability of emitting a free space photon is given by ppump,∗ ∝ 1
NP1d

.

C. Fidelity of the protocol.

The analysis of the ﬁdelity will be very similar to the one performed for the previous protocol. In this case, if we detect an
excitation in g in the detector atom, no error may appear. Therefore, the only contribution to the inﬁdelity is the error coming
from free space photons in each attempt after 1/p repetitions, which ﬁnally scale:
m
√
P1d

(SM68)
for systems with P1d,Nm (cid:29) 1. In Fig. SM11 we conﬁrm numerically that the analytical approximations capture the right scaling.
If we consider as a reference the largest Purcell factor (the one associated to Γs
1d), then, the scaling of probabilities and ﬁdelities
should read equivalently:

× (p∗ + ppump,∗)× m
N

Im→m+1 ≈ 1
p

N2

∝

,

e−√

√
√
P1d
Nm/

3π

p ≈ Nm
Nm + 2
m
√
P1d
N3/2

Im→m+1 ∝

,

(SM69)

SM5. MERGING PROTOCOLS FOR COMBINING COLLECTIVE ATOMIC EXCITATIONS.

In this Section we show how to combine the excitations stored in the target atoms after the ﬁrst part of the process, that is,
m (cid:105) ∝ sym{|s1(cid:105)m1 ⊗···⊗|sn(cid:105)mn ⊗|g(cid:105)Nm}, with Nm = N − m = N − ∑i mi such that we

when our atomic state has the form |Φ{sn}
can build up higher excitation numbers into a single level. For that purposes we use several tools and assumptions:

√
Nm ≈ a†

α can be approximated by bosonic operators.

• We are interested in the so called Holstein-Primakoff limit where m (cid:28) N, such that the collective atomic dipoles
Sαg
• Using the microwave/Raman lasers connecting an atomic level α with g, we can do displacement transformations D(α)
on the α level. Moreover, using microwave/Raman transition between α and β levels, we can also engineer beam splitter
transformations between these modes.

0.111010010000.0010.01010205010020050010000.0010.010(a)(b)21

Figure SM11. Scaling of the exact (solid lines) and approximated (markers) inﬁdelities with P1d (Panel a) and Nm (Panel (b)) for different Nm
and P1d respectively as depicted in the legends.

Figure SM12. Scheme to build up m collective atomic states combining heralded single collective excitations plus beam splitters and posts-
election. The red arrows indicates the path adding excitations, whereas the green ones how one needs to reinitialize the process if we fail in
given step. (a) Scheme using two atomic levels to add excitations one by one with probability qn in each step. (b) [(c)] Scheme using log2 m
[log3/2 m] with probability qn [sn] in each step using a tree-like structure that avoids starting the whole process from the beginning in case of
failure.

• Moreover, we can read the atomic state very efﬁciently by pumping to an excited state that emits a collective photon
through the waveguide in a cyclic transition. This will allow do to very efﬁcient detection and potentially number resolved
as we explain in the last Section. Together with the beam splitter and displacement transformations, they provide a similar
set of tools as the ones used in linear optics protocol with the advantage of having the excitations stored.

Using all those assumptions, our goal is to build a given arbitrary atomic state of m excitations, that we know it can be

afterwards be mapped to a photonic state with very high efﬁciency [9]. The general form of this state typically reads:

|Ψm(cid:105) = ∑

n

fn√
n!

(a†)n|vac(cid:105) ∝

(a† − α∗

i )|vac(cid:105) ,

n

∏
i=1

(SM70)

and we will put particular emphasis in the simple Dicke states with m excitations, as this will be mapped to photonic Fock states.
We discuss two different types of merging protocols separately.

1. If the number of metastable states |si(cid:105) is limited, we only use two levels and add excitations one by one. This is the kind

of protocols typically used in linear optics protocols where it is not possible to store several atomic excitations [19].

2. Using several hyperﬁne levels and adopting a tree-like structure that will allow us to avoid the exponential scaling of the

number of operations.

A. Adding excitations one by one.

Here we show how to create a photonic state of m excitations by combining beam splitters (B), displacements transformations
(D(α)) and post-selection condition on no detection in a particular level P0i by using only two atomic levels. For the sake of
discussion, we analyze ﬁrst in detail the case of single Dicke states and leave the analysis of the superpositions afterwards.
The general scheme to build a given atomic state with m collective excitations is depicted in Fig. SM12(a). The main step
consists of going from an state with m excitations in one level and a single one in the other, |φn(cid:105) = |n(cid:105)⊗|1(cid:105), to an state n + 1

(b)10-610-510-410-310-2151050100500100010-610-510-40.0010.010.11020501002005001000(a)(a)Adding excitations one by oneUsing tree-like structure(b).........44Using tree-like structure and number resolved detection(c)............ steps steps...... steps22
excitation in one of them conditioned on detecting no excitation in the other one, i.e., |n + 1(cid:105)⊗|0(cid:105)1. The idea is to apply a beam
splitter transformation of |φn(cid:105), followed by a projection of the state conditioned on detecting no excitations in the a2 level:

| ˜φn(cid:105) = P02B|φn(cid:105) =
(not normalized) and the probability of ﬁnding it is given by

1√
n!

T nR(a†

(cid:104) ˜φn| ˜φn(cid:105) = (n + 1)|T|2n|R|2 ≤(cid:0) n

1)n+1|vac(cid:105)
(cid:1)m

(SM72)
which is maximized for a transmitivity |T|2 = n/(n + 1). Interestingly, limn→∞ qn = e−1 such that it does not decay with n.
However, if we fail, we have to repeat the process from the beginning, such that the mean number of operations to create a state
with m excitations can be obtained:

n + 1

= qn,

(SM73)
Taking into account that 2 = q1 > q2 > ··· > qn > e−1 and q0 = p the probability to generate a single heralded excitation, the

qm−1qm−2

qm−1

qm−1

qn

=

+

n

.

Rm =

+··· +

1
∏m−1

1 + Rm−1

1

1

(SM71)

mean number of states can be lower and upper bounded by:
m
∏m−1
n
1
∏m−1

Rm >

Rm <

qn

n

qn

>

<

qn

m
∏m−1
n
1
p∏m−1
n=1 q1

<

>

mem
p ,
2m−1
p .

(SM74)

which increase exponentially to increase the number of excitations m. Moreover, it was shown in Ref. [19] that by combining
single photon addition with displacement transformation before and after the addition, lead to a conditional outcome after starting
with a state |φ(cid:105), that is, D(α)a†D(α)†|φ(cid:105). Combining m of these operations and using the fact that D(α)a†D(α)† = a† − α it
can be shown that one arrives to |Ψph,m(cid:105) as in Eq. SM70, but also with an exponential number of operations.

B. Doubling the number of excitations post-selecting on no detection.

The key difference with respect to the previous protocol is that we are going to adopt a tree-like structures as depicted in
Fig. SM12(b), where we can reach the m excitations in log2 m steps and we do not have to repeat all of them if we fail. The ﬁrst
building block is to study the process that add up two states with |n(cid:105) excitations to go to |n(cid:105)⊗|n(cid:105) → |2n,0(cid:105). It can be shown that
the conditional outcome after a beam splitter and detecting no excitations in the second atomic level is given by:

| ˜φ2n(cid:105) =

1
n!

T nRn(a†

1)2n|vac(cid:105),

(SM75)

which yields an (approximated) optimal probability for a 50− 50 beam splitter transformation:

dn = (cid:104) ˜φ2n| ˜φ2n(cid:105) =

√
(2n)!
22n(n!)2 ≈ 1/
πn ,

(SM76)
2πn nne−n in the last step. Therefore, in this case the optimal dn does decay
√
n but only polynomially. However, in spite of this decay, the use of of a tree-like structure is enough to circumvent the
with 1/
exponential scaling of adding excitations one by one. The average number of operations to arrive to an state of m excitations can
be calculated iteratively, i.e.,

where we used Stirling’s approximation n! ≈ √
(cid:0)1 + 2Rm/2

(cid:1) = d−1

(SM77)

m/4 + 22d−1

m/2 + 2d−1

m/2d−1

m/4d−1

Rm = d−1
m/2

m/2d−1

m/8 + . . . ,

where the d−1
m/2 terms represents the number of times we need to try in the step m/2 to succeed and the one with 2Rm/2 is the
number of steps we need to repeat at the m-th step to get the the two branches of the tree. We lower and upper bound this number
of operations to get m excitations by:

Rm <

Rm >

log2 m

p

2log2 m−1
∏log2 m−1

n=1
2log2 m−1
p∏log2 m−1

n=1

dm/2n

<

dm/2n
m2
4p ,

>

log2 m

p

2log2 m−1
dlog2 m
m/2

≈ m(log2 m)/2+1 log2 m

2p

,

(SM78)

23

where we use that dm < dm/2 and d1 = 1/2 and that we require log2 m steps to arrive to m excitations. Thus, Rm is superpolynomial
in m because the probability in each step, dm, decays with m. If we had a way of making dm independent of m as it occurs for
the single excitation case qm, then we would have a polynomial scaling.

For completeness it will be interesting to prove that one can also get arbitrary superpositions [22] using the tree-like structure
of Fig. SM12(b). As a resource we assume we can build any superposition of 0 and 1 photon, i.e., which we know is possible
from the previous section. Then, we prove ﬁrst that using 50− 50 beam splitter and detecting no excitations in the a2-mode we
can arrive to any arbitrary state as follows:

P02B|Ψa1,m(cid:105)⊗|Ψa2,m(cid:105) = P02B

(cid:16)

=

1
2m

m

∏
i=1

1)2 − (α∗
(a†

i + α∗

i+m)a†

(cid:16)

m

∏
i=1

a†

1 − α∗
i√
2
i α∗
1 + α∗

i+m

a†

(cid:17)|vac(cid:105) =

(cid:16)
(cid:17) m
2 − α∗
i+m√
∏
(cid:17)|vac(cid:105) ∝
2
i=1
2m
1 − α∗
∏
(a†
i=1

i )|vac(cid:105) ∝ |Ψ2m,goal(cid:105) .

(SM79)

Now, it is important to check the conditions under which the probability of doubling the excitations is not exponentially small.

It is easy to show from the previous equations that he probability of success in each step of the doubling is lower bounded by

dm (cid:38) 1√

2πm

|(cid:104)m|Ψa1,m(cid:105)|2|(cid:104)m|Ψa2,m(cid:105)|2 ,

(SM80)

such that it does not decay exponentially if the contribution |(cid:104)m|Ψa1,2,m(cid:105)|2 do not decay exponentially either. This is a reasonable
assumption as if |(cid:104)m|Ψa1,2,m(cid:105)| would be exponentially small we could approximate the photonic state without doubling with an
exponentially small error. Both Eqs. SM79 and SM80 show that we can create any arbitrary state with a non-exponentially small
probability. Using that |(cid:104)m|Ψa1,2,m(cid:105)|2 ∝ 1/mα, it is then easy to show the superpolynomial scaling of probability:

Rm (cid:46) mα(log2 m)+1 log2 m

2p

.

(SM81)

C.

Increasing the number of excitations with number resolved detection.

In this last Section, we show how by using atomic number resolved detection, we can overcome the superpolynomial scaling
of the previous section. Instead of starting the process again when we detect some excitation in the a2, we can think of using
some of these states that still have a non-negligible number of excitations in the a1 mode that we can use a posteriori. To further
explore this possibility, we generalize the operation of Eq. SM75 to see what is the resulting state after 50/50 beam splitter
transformation when we want to sum up m and n excitations in the a1,2 modes when we detect the p excitations in the a2 mode:

fp(m,n) =1 (cid:104)m + n− p| ˜φm+n−p(cid:105) =1 (cid:104)m + n− p|Pp2B

=

m

∑
k=0

(−1)m−k
√
√
n!
m!

2(m+n)/2

n

k

m + n− k− p

(cid:18)m

(cid:19)(cid:18)

|vac(cid:105)

(a†
1)m(a†
2)n
√
√
n!
m!

(cid:19)(cid:112)p!(cid:112)(m + n− p)! .

(SM82)

In Fig. SM13(a) we plot the distribution of probabilities | fp(m,n)|2 as a function of p for different m and n. In solid black,
we depict the the case with m = n which is the symmetric situation that we consider before. For this symmetric situation the
expression of Eq. SM82 can be simpliﬁed as follows:

| f2n(m,m)|2 =

(2m− 2n)!(2n)!

22m(m!)2

n

(cid:18)m

(cid:19)2 ≈ 1

1(cid:112)n(m− n)

π

.

(SM83)

and f2n−1(m,m) ≡ 0 for n ∈ N, and where in the last approximation we assumed m,n (cid:29) 1 to use Stirling approximation. By
integrating this expression it can be obtained that the probability of detecting an state p < m/2 lead to:

(cid:90) m/4

sp<m/2 =

m/2
∑
p=0

| fp(m,m)|2 ≈

0

dn| f2n(m,m)|2 =

(cid:90) m/4

0

1(cid:112)n(m− n)

dn 1
π

= 1/3 ≡ s ,

(SM84)

which means that there is a probability s independent of m of going from |m(cid:105)1 ⊗|m(cid:105)2 → |2m− p > 3m/2(cid:105)1 ⊗|p(cid:105)2. In order to
make a worst case estimation, we assume that in each step we go only to |m(cid:105)1 ⊗|m(cid:105)2 → |3m/2(cid:105)1. This in principle can be done

24

(a) Distribution of probabilities | fp(m,n)|2 as a function of p for m = n = 20 (lower panel) and m = 10,n = 30.

Figure SM13.
∑p<m/2| fp(m + α,m − α)|2 as a function of m for different degrees of asymmetry given by α as shown in the legend.
checked that all the cases converges to a constant s ≈ 1/3.

(b)
It can be easily

because if one obtains a higher excitation number it can be decreased by applying inﬁnitesimal beam splitter transformations
with an empty mode as:

(cid:18)
(cid:19)
1− θ 2n
P02B(θ (cid:28) 1)|n(cid:105)1 ⊗|0(cid:105)2 ≈
|n(cid:105) ,
2
√
n|n− 1(cid:105)1 ,
P02B(θ (cid:28) 1)|n(cid:105)1 ⊗|0(cid:105)2 ≈ iθ

(SM85)
which show that by switching θ 2n (cid:28) 1, we do not alter |n(cid:105)1, until we decrease one excitation. This can be applied several times
until we arrive to |3m/2(cid:105). In this worst case scenario, starting again with M single excitations [see Fig. SM12(c)] we will arrive

(cid:1)log2(M) [which lead log3/2 m = log2 M] in log2(M) steps, which means that with this protocol

at least to m ≥(cid:0) 3

2

Rm (cid:46) log2(M)2log2 M−1

pslog2 M

≈ m4.41 log3/2 m

2p

,

(SM86)

where we used logb x = loga x
loga b. Thus, by using number resolved detection we turn the superpolynomial scaling into polynomial
which is big improvement if we want to scale our protocol for larger excitation numbers. In practical situations, the scaling will
be better as one will never decrease the excitations to arrive to 3n/2, but will use the larger excitation numbers. The consequence
of that is that within the tree we will need to add up excitation in an asymmetric way, i.e., (m,n) as we showed in Fig. SM13(b).
However, even in this case it can also be shown that

| fp(m + α,m− α)|2 ≈ 1/3 ≡ s ,

m/2
∑
p=1

(SM87)

for approximately all α as shown numerically in Fig. SM13(b). This proves that the number resolved excitation also helps even
in the asymmetric conﬁguration as it also may give rise to a probability in each step independent of the number of excitations
we add up.

D. Atomic number resolved detection using waveguide QED.

Though standard linear optics setups can already distinguish between photon numbers using superconducting detectors, cur-
rent technologies are far from obtaining the desired detection efﬁciencies for optical photons. In our case, we can beneﬁt directly
from our atomic detection which naturally give rise to ways of having number resolved detection. In this Section, we make a
short discussion of how one can do it.

The goal is to be able to distinguish in one atomic level between having m or m + 1 excitations. In order to do it, we can
drive a closed atomic transition to an excited state such that we emit photons through the waveguide. Using the fact that
P1d (cid:29) 1, we will be able to obtain the photon counting distribution P[n,T ] of having detected n photons after a time interval
T . Interestingly, this photon counting distribution is given by a Poisson process with different parameter λm = mΓ1dT , being m
n! e−λm. In Fig. SM14, we see this distribution quickly converges to a Gaussian with
λ n
the number of excitations, i.e., P[n,T ] =
m

0102030400.00.10.00.10.2204060801000.00.20.40.60.81.0(a)(b)25

Figure SM14. (a-b) Photon counting probabilities P[n,T ] for TΓ1d = 10− 30 for two different atomic levels with m = 1 [black] and m = 2
excitations.

√
mean value λm and width
λm, such that for large T (or equivalently large λm), the overlap between the two distribution, ε
vanishes approximately with T approximately ε ∝ e−(Γ1dT )2, which give as some bounds of the T required to minimize the error
introduced in the number resolved detection.

Depending on the particular implementation, a more thorough analysis of the errors has to be performed, to estimate the ﬁnal

ﬁdelities of the protocol, though our paper serves as an optimistic basis for future research.

102030400.000.020.040.060.080.100.12,0204060801001200.000.010.020.030.040.050.060.07(a)(b)