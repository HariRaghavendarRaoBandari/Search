Coupling volume-excluding compartment-based models of

diﬀusion at diﬀerent scales: Voronoi and pseudo-compartment

approaches

P. R. Taylor∗ and R. E. Baker

Mathematical Institute, University of Oxford,

Woodstock Road, Oxford, OX2 6GG, UK

M. J. Simpson

Mathematical Sciences, Queensland University of Technology,

G.P.O. Box 2434, Brisbane 4001, Australia

C. A. Yates

Department of Mathematical Sciences, University of Bath,

Claverton Down, Bath, BA2 7AY, UK

(Dated: March 11, 2016)

Abstract

Numerous processes across both the physical and biological sciences are driven by diﬀusion.
Partial diﬀerential equations (PDEs) are a popular tool for modelling such phenomena determin-
istically, but it is often necessary to use stochastic models to accurately capture the behaviour of a
system, especially when the number of diﬀusing particles is low. The stochastic models we consider
in this paper are ‘compartment-based’: the domain is discretized into compartments, and particles
can jump between these compartments. Volume-excluding eﬀects (crowding) can be incorporated
by blocking movement with some probability.

Recent work has established the connection between ﬁne-grained models and coarse-grained
models incorporating volume exclusion, but only for uniform lattices. In this paper we consider
non-uniform, hybrid lattices that incorporate both ﬁne- and coarse-grained regions, and present
two diﬀerent approaches to describing the interface of the regions. We test both techniques in a
range of scenarios to establish their accuracy, benchmarking against ﬁne-grained models, and show
that the hybrid models developed in this paper can be signiﬁcantly faster to simulate than the
ﬁne-grained models in certain situations, and are at least as fast otherwise.

6
1
0
2

 
r
a

 

M
0
1

 
 
]

.

M
Q
o
i
b
-
q
[
 
 

1
v
6
4
3
3
0

.

3
0
6
1
:
v
i
X
r
a

∗ paul.taylor@maths.ox.ac.uk

1

I.

INTRODUCTION

Diﬀusion can be modelled using a multitude of mathematical techniques. Partial diﬀer-
ential equations (PDEs) are a popular choice, but are inappropriate where stochastic eﬀects
are signiﬁcant [1]. Stochastic models of diﬀusion fall into two main categories: oﬀ-lattice
models, where each particle’s position lies on a continuum within the domain, and on-lattice,
compartment-based models, where particles undergo a random walk on a lattice [2].

Volume exclusion (crowding) can be incorporated into compartment-based models by
assigning a maximum particle capacity, m, to each compartment, where m varies linearly
with the compartment’s size. Attempted moves into any given compartment are blocked
with some probability. Of particular interest is the case where this probability scales linearly
with the compartment’s current occupancy, such that the blocking probability is equal to
zero when empty and to unity when full to capacity, m [3–5]. We describe such a model as
‘partially-excluding’ or ‘coarse-grained’ when m > 1, and as ‘fully-excluding’ or ‘ﬁne-grained’
when m = 1.

In a recent paper [6], we showed that the descriptions of a system given by fully-excluding
and partially-excluding models can be reconciled. Speciﬁcally, we demonstrated that the
mean and variance of particle numbers within each partially-excluding compartment of ca-
pacity m can be matched with the mean and variance of the total number of particles across
the m corresponding contiguous fully-excluding compartments.

Our previous work considered uniform lattices, where every compartment was of the same
size and capacity. For some models, such as those of real biological systems, it may be nec-
essary to incorporate events occurring across a wide range of spatial and temporal scales [7].
This means that it may be desirable to, for example, simulate the diﬀusion of particles
with precision in a small spatial region of interest, such as the area around receptors on a
cell membrane [8], or around an ion channel [9], while using less computationally intensive
methods elsewhere on the domain. As a result, recent years have seen the development
of multiple hybrid approaches for linking compartment-based models to oﬀ-lattice models
of diﬀusion [10–12], oﬀ-lattice models to PDE models of diﬀusion [13], and PDE models
to compartment models of diﬀusion [14–16]. To our knowledge, however, there have been
no attempts to develop a hybrid system interfacing volume-excluding compartment-based
models at diﬀerent scales.

In this paper, we consider how to interface a uniform region of partially-excluding com-
partments with another uniform region of fully-excluding compartments, and present two
hybrid approaches capable of accurately simulating diﬀusion in such systems. Both ap-
proaches will be of value to researchers working on multi-scale systems, as they can speed
up simulations while preserving precision where needed.

We begin by providing a short summary of our previous work on reconciling models of
particle behaviour across spatial scales on uniformly partitioned lattices, before proceeding
to consider hybrid models. The ﬁrst hybrid method we present extends to diﬀusion on
non-uniform lattices the previous results reconciling fully-excluding and partially-excluding
systems. We use these results to present one simple and elegant means of connecting two
uniformly partitioned regions of diﬀering compartment capacity. The second hybrid method
we present deﬁnes a small area between the ﬁne and coarse regions of the domain, where
particle behaviour exhibits some characteristics of both regions. We term this area a pseudo-
compartment, and the modelling framework a pseudo-compartment method, by analogy to
a recent paper using similar techniques to couple a PDE model to a compartment-based

2

FIG. 1. Shaded cells represent particles, and white cells unused capacity, within uniform compart-
ments of diﬀerent capacities. As m increases, the spatial resolution coarsens, but the descriptions
given at these diﬀerent scales can be reconciled.

model [14].

To determine the accuracy of these hybrid approaches, we apply each one to three sce-
narios, comparing the correspondence of the means and variances of particle numbers in the
hybrid system to the corresponding moments in non-hybrid ﬁne-grained and coarse-grained
systems, as well as to PDE solutions when appropriate. The ﬁrst scenario conﬁrms that
the hybrid systems are capable of maintaining a uniform steady state. The second com-
pares their accuracy in a simple case of particle spreading from an initially inhomogeneous
particle distribution.
In the third scenario, we examine a morphogen gradient formation
system, incorporating particle decay and inﬂux of particles at the left-hand boundary x = 0.
Morphogen gradients are a common example of a multi-scale system in biology, as they
incorporate both regions of low particle density where models with high spatial resolution
are suitable, and regions of high particle density where such detailed modelling is computa-
tionally infeasible and unnecessary [17, 18]. In all three cases, we observe that the mean and
variance of particle numbers in each compartment of the hybrid models agree with those
obtained from simulations run on uniform lattices.

Finally, we consider a simple multi-species scenario, where the simulated results of a
partially-excluding model fail to match those of a fully-excluding model. We demonstrate
that both hybrid systems are capable of matching the accuracy of the fully-excluding model
in this scenario, while requiring only between a third and a seventh of the computational
time to simulate.

II. RANDOM WALKS ON UNIFORM LATTICES

We consider a one-dimensional lattice-based random walk on x ∈ [0, L], where each
motile particle has length h. The length of the domain, L, is chosen such that L = N h,
where N ∈ N, so that the domain can contain at most N particles. We impose a uniform
lattice consisting of K compartments onto this domain, where choices of K are constrained
by the requirement that m = L/(Kh) should be a positive integer. As a consequence,
N = Km, and m describes the maximum number of particles that can reside in each of the
K compartments, or their ‘capacity’. Diﬀusion may then be modelled as a series of jumps
as particles move between neighbouring compartments. The spatial resolution of the model
can be varied by changing the compartment capacity, m, as illustrated in Figure 1. We
are particularly interested in the ﬁne-grained limiting case m = 1 where each compartment
contains at most one particle (‘fully-excluding’). We shall consider the fully-excluding case
to be ‘accurate’, in the sense that no assumptions are required to determine each particle’s
position within its compartment. We assume that the particles considered in this paper do

3

not interact except through volume-excluding eﬀects.

A. Volume exclusion

ments as

T ±
j =

D

m2h2

1 − n(m)
j±1
m

(cid:32)

(cid:33)

A common approach taken in the literature is to deﬁne the jump rates between compart-

,

j = 1, . . . , K,

(1)

j

where D is the diﬀusivity of particles, and n(m)
is the number of particles in compartment
j when each compartment has capacity m [3]. The term in brackets incorporates volume
exclusion by causing attempted jumps into a compartment to fail with a probability that
scales linearly with the compartment occupancy. Other forms for the blocking probability
could be chosen, but the resulting particle behaviours would not be conserved across spatial
scales [6]. Imposing zero-ﬂux boundary conditions so that the number of particles in the
system is constant, the evolution of mean particle numbers in compartment 1 < j < K is
given by

(cid:19)

(cid:18)

dMj
dt

= T +
j−1
− T +

j

(cid:104)nj−1nj(cid:105)

Mj−1 − 1
m
(cid:104)njnj+1(cid:105)

Mj − 1
m

(cid:19)

− T −

j

(cid:18)

+ T −

j+1

Mj − 1
m
Mj+1 − 1
m

(cid:104)nj−1nj(cid:105)

(cid:104)njnj+1(cid:105)

.

(2)

(cid:105) denotes the mean number of
where (cid:104)·(cid:105) is used to denote expected values, and M (m)
particles in the jth compartment of capacity m. Writing out the transition rates explicitly,
the evolution of mean particle numbers in each compartment is given by

j = (cid:104)n(m)

j

(cid:18)
(cid:18)

(cid:19)
(cid:19)

(cid:16)−M (m)
(cid:16)
(cid:16)

(cid:17)
1 + M (m)
j−1 − 2M (m)
(cid:17)
M (m)
K−1 − M (m)
M (m)

K

.

2

,

j + M (m)

j+1

dM (m)

1
dt

dM (m)

j
dt

dM (m)

K
dt

=

=

=

D

m2h2

D

m2h2

D

m2h2

(cid:17)

,

j = 2, . . . , K − 1,

(3)

(4)

(5)

We refer to these as ‘mean master equations’, and note their linearity: this is a consequence of
our choice of blocking probability, and would not be the case had we chosen otherwise [6]. It
is also possible to derive equations describing the evolution of the variance of n(m)
(‘variance
master equations’):

j

dV (m)

j
dt

=

D

m2h2

(cid:34)

2

m

(cid:19)

(cid:18) m − 1
(cid:32)
1 − M (m)
(cid:32)
1 − M (m)

j
m

j+1
m

+M (m)
j−1

+ M (m)

j

(cid:19)

(cid:18) m − 1
(cid:33)
(cid:33)(cid:35)

m

j + 2

j,j−1 − 4V (m)
(cid:33)
(cid:32)
V (m)
1 − M (m)
j−1
(cid:32)
(cid:33)
m
1 − M (m)

+ M (m)

+ M (m)
j+1

j

j
m

V (m)
j,j+1

,

(6)

4

for 2 ≤ j ≤ K − 1, where V (m)
compartment j, and V (m)
j,k

j = (cid:104)(n(m)j )2(cid:105)− (M (m)
(cid:19)
is the covariance of particle numbers in compartments j and k:

)2 is the variance of particle numbers in

j

V (m)
j−1,j + V (m)

j + V (m)

j−1 + V (m)

j−2,j + V (m)

j−1,j+1

dV (m)
j−1,j
dt

=

D

m2h2

(cid:33)

(cid:32)

(cid:33)(cid:35)

;

− M (m)
j−1

1 − M (m)

j
m

− M (m)

j

1 − M (m)
j−1
m

− 4

m

(cid:34)(cid:18) 2
(cid:32)
(cid:104)−4V (m)

dV (m)
j,k
dt

=

D

m2h2

j,k + V (m)

j−1,k + V (m)

j+1,k + V (m)

j,k−1 + V (m)

j,k+1

(cid:105)

for

1 < j < k − 1 < K,
and 1 < k + 1 < j < K.

Similar expressions can be found for the variance and covariance terms involving the bound-
ary compartments, j = 1, K.

When comparing a fully-excluding model (m = 1) to a partially-excluding model (m > 1),
we seek to show that the mean and variance of particle numbers in each compartment is
conserved. In order to compare the results of the two models, we ﬁrst consider the means and
variances of the total number of particles residing in a group of m contiguous compartments
with capacity one. We therefore deﬁne

jm(cid:88)

i=(j−1)m+1

S(m)
j

(t) =

n(1)
i (t),

(7)

with µ(m)

j

(t) the mean of S(m)

j

(t), and v(m)

j

(t) its variance.

B. Moving between scales

We wish to establish the relationship between: (i) µ(m)

(t)
(t). It is straightforward to show that, in both of these cases, the steady state values
(t) under transient conditions, we

and V (m)
match. To ﬁnd the relationship between µ(m)
note

(t); and (ii) v(m)

(t) and M (m)

(t) and M (m)

j

j

j

j

j

j

dM (1)

i
dt

(cid:16)

jm(cid:88)
jm(cid:88)

i=(j−1)m+1

(cid:16)

D
h2

D
h2

i=(j−1)m+1

dµ(m)

j
dt

=

=

=

(cid:16)

dM (m)

j
dt

=

D

m2h2

(cid:17)

(cid:17)

.

j−1 − 2M (m)
M (m)

j + M (m)

j+1

5

i−1 − 2M (1)
M (1)

i + M (1)

i+1

(j−1)m − M (1)
M (1)

(j−1)m+1 − M (1)

jm + M (1)

jm+1

(cid:17)

.

(8)

We compare this to the coarse-grained model, Eq. (4), which we re-state here for convenience:

(cid:18)1
(cid:18)1

2

2

(cid:16)

M (1)

jm =

M (1)

jm+1 =

1
m
1
m

m + 1

m
m − 1
m

µ(m)
j +

µ(m)
j +

m − 1
m

m + 1

m

1
2
1
2

µ(m)
j+1

µ(m)
j+1

dµ(m)

j
dt

=

D

m2h2

j−1 − 2µ(m)
µ(m)

j + µ(m)

j+1

,

(cid:19)
(cid:19)

,

,

(cid:17)

(9)

(10)

(11)

FIG. 2. Schematic of the interpolation process for m = 4.

Under the assumption that particles in the coarse (m > 1) compartments are distributed,
on average, following a linear interpolation between neighbouring coarse compartments. We
therefore write

as shown in Fig. 2, with similar values for M (1)

(j−1)m and M (1)

(j−1)m+1. As a result we have

and evolution of the mean particle numbers in the coarse-grained system matches that of the
accurate model. Analogous reasoning can be applied to match the evolution of the variance
of particle numbers.

III. HYBRID FULLY-/PARTIALLY-EXCLUDING SYSTEMS

Having reviewed the reasoning used to match descriptions of uniform lattices at diﬀerent
spatial scales, we proceed to outline two hybrid models using non-uniform lattices. In both
cases, we justify the correspondence of mean particle numbers in each compartment of the
hybrid model to the mean particle numbers in the accurate, m = 1 uniform lattice.

A. Voronoi method

Jump rates between compartments can be derived from the assumption of underlying
Brownian motion of particles using ﬁrst-passage time arguments (the method is outlined in
Appendix A) [21]. Particles are assumed to begin from a ﬁxed point within their current
compartment, the ‘residence point’, and are deemed to have jumped to a neighbouring
compartment when they ﬁrst reach that compartment’s residence point. For a uniform
lattice, these residence points are located at the centre of each compartment.
For a non-uniform lattice, we let the compartment residence points be at [x1, . . . , xK]
on the domain [0, L], then deﬁne ∆xj = xj − xj−1, for 1 < j ≤ K. Compartment edges
are then placed so as to be equidistant between neighbouring residence points, so that the
jth compartment covers the interval x ∈ [xj − ∆xj/2, xj + ∆xj+1/2] (an example is given
in Figure 3). Recall that the capacity of each compartment varies linearly with its length,
and that the capacity of compartments on a uniform lattice is given by m = L/(Kh), that

6

is, the compartment length divided by particle length, h. Similarly, we obtain capacities
[m1, . . . , mK] for the K Voronoi compartments by dividing their lengths by h, obtaining

m1 =

mj =

mK =

2x1 + ∆x2

2h

,

, 1 < j < K,

∆xj + ∆xj+1
2(L − xK) + ∆xK

2h

.

2h

(12)

(13)

(14)

The positioning of residence points is restricted by a requirement that every compartment
should have an integer-valued capacity. Inverting the conditional expected exit times ob-
tained in Appendix A, and factoring in the relative probabilities of moving left or right, the
following transition rates for a particle in the jth compartment can be obtained [20, 21]:

T −
j =

T +
j =

2D

∆xj(∆xj + ∆xj+1)

2D

,

D

∆xjmjh

D

=

=

∆xj+1(∆xj + ∆xj+1)

∆xj+1mjh

.

(15)

(16)

The following equation for the evolution of mean particle number can then be obtained

(cid:18)
(cid:18)

dM (v)

j
dt

= T +
j−1
− T +

j

j−1 − 1
M (v)
mj
j − 1
M (v)
mj+1

(cid:19)
(cid:19)
j (cid:105)
j−1n(v)
j+1(cid:105)
(cid:104)n(v)
j n(v)

(cid:104)n(v)

(cid:18)
(cid:18)

− T −

j

+ T −

j+1

j − 1
M (v)
mj−1
j+1 − 1
M (v)
mj

(cid:19)
(cid:19)
j (cid:105)
j−1n(v)
j+1(cid:105)
j n(v)

(cid:104)n(v)

(cid:104)n(v)

,

(17)

j

, M (v)

and V (v)

where we use n(v)
to denote the number, mean and variance, respectively, of
particles in the jth Voronoi compartment. From the deﬁnitions of the transition rates given
in Eqs. (15) and (16) we note that T +
j+1/mj, and
hence Eq. (17) simpliﬁes to

j /mj+1 = T −

j−1/mj = T −

j /mj−1, and T +

j

j

dM (v)

j
dt

=T +

j−1M (v)

j + T +

j

j + T −

j+1M (v)
j+1.

In the same way, we can obtain equations for the evolution of variances,

j + T +

j

j + 2T +
j−1

1 − 1
mj

j−1,j + 2T −
V (v)

j+1

1 − 1
mj

j−1 −(cid:0)T −
(cid:18)

= −2(cid:0)T −

dV (v)

j
dt

(cid:1) V (v)
(cid:32)
(cid:32)

(cid:33)
1 − M (v)
(cid:33)
j
mj
1 − M (v)
j+1
mj+1

+T +

j−1M (v)
j−1

+T +

j M (v)

j

+ T −

j M (v)

i

+ T −

j+1M (v)

j+1

(cid:1) M (v)
(cid:19)
(cid:32)
1 − M (v)
j−1
(cid:32)
mj−1
1 − M (v)
j
mj

(cid:33)
(cid:33)

(cid:18)

(18)

(cid:19)

V (v)
j,j+1

.

(19)

The derivations of both Eq. (17) and Eq. (19) are outlined in Appendix B. In the previous
section, we summarised previous work matching the behaviours of µ(m)
(t), and
of v(m)
(t). We now wish to show that particle behaviour is similarly conserved
between scales when using a Voronoi partitioned lattice.

(t) with M (m)

(t) with V (m)

j

j

j

j

7

FIG. 3. The locations of a Voronoi lattice’s residence points are chosen (x1, . . . , x9), and then com-
partment edges are positioned equidistant between neighbouring residence points. This particular
arrangement demonstrates how a compartment of capacity (m+1)/2 can be used to interface regions
where m > 1 with regions where m = 1. In this case, ∆x2 = mh, and ∆xj = h for j = 3, . . . , 9.
When grouped, we would ﬁnd S(v)

(t) and S(v)

4(cid:80)

9(cid:80)

(t).

1 (t) = n(v)

1 (t), S(v)

2 (t) =

3 (t) =

n(v)
i

n(v)
i

i=2

i=5

Suppose that the Voronoi lattice consists of p compartments of capacity m > 1 at the
left of the domain, followed by a single compartment of capacity (m + 1)/2, and then the
remainder of the domain is partitioned into ﬁne compartments of capacity one (as illustrated
in Figure 3, for p = 1 and m = 5). To avoid non-integer compartment capacities, our choice
of m must be odd-valued. Recall that, to aggregate compartments on a fully-excluding
uniform lattice, we wrote

jm(cid:88)

S(m)
j

(t) =

n(1)
i (t).

i=(j−1)m+1

(20)

(21)

By analogy, we deﬁne S(v)

j (t), such that



S(v)
j (t) =

n(v)
j (t)

p+(m+1)/2(cid:88)
p+(m+1)/2+m(j−p)(cid:88)

n(v)
i (t)

i=p+1

i=p+(m+3)/2+m(j−p−1)

if j < p + 1,

if j = p + 1,

n(v)
i (t) if j > p + 1.

j (t) and v(v)

These groupings are illustrated in Figure 3 for p = 1 and m = 5. As in the previous section,
we write µ(v)
j (t), and seek to show a
connection between: (i) µ(v)
(t). We can do this by
examining the equation for the evolution of µ(v)

j (t) to denote the mean and variance of S(v)
j (t) and v(m)
. For j < p, we write

j (t) and µ(m)

(t); and (ii) v(v)

j

j

j

(cid:16)

(cid:17)

dµ(v)
j
dt

=

dM (v)

j
dt

=

D

m2h2

j−1 − 2µ(v)
µ(v)

j + µ(v)

j+1

,

(22)

which clearly matches Eq. (11). For j > p + 1, a similar match can be obtained using the
same linear interpolation applied in the previous section.

8

When j = p, p + 1 then we use Eqs. (15) and (16) to obtain

D
m2h2 M (v)

p +

D

mmp+1h2 M (v)
p+1,

(23)

dµ(v)
p
dt
dµ(v)
p+1
dt

=

=

=

p−1 − 2

D
m2h2 M (v)
p+(m+1)/2(cid:88)

(t)

dM (v)

i
dt
p −

i=p+1
D
m2h2 M (v)

D

mmp+1h2 M (v)

p+1 − D

h2 M (v)

p+(m+1)/2 +

D
h2 M (v)

p+(m+3)/2.

(24)

p+(m+1)/2 and M (v)

p−1 and M (v)
As before, we make the substitutions M (v)
p , and interpolate values
of M (v)
p+2 using Eqs. (9) and (10). Finally, we
observe that the residence point of the (p + 1)th Voronoi box coincides with the centre of
the (p + 1)th aggregated box (as illustrated in Figure 3), so the interpolated value for M (v)
p+1
is simply

p−1 = µ(v)
p+1 and µ(v)

p+(m+3)/2 from µ(v)

p = µ(v)

M (v)

p+1 =

mp+1

m

µ(v)
p+1.

Substituting this into Eqs. (23) and (24), we arrive at
p−1 − 2µ(v)
µ(v)
p − 2µ(v)
M (v)

m2h2

dµ(v)
p
dt
dµ(v)
p+1
dt

m2h2

D

D

=

=

p + µ(v)

p+1

p+1 + µ(v)

p+2

(cid:16)
(cid:16)

(25)

(26)

(27)

,

(cid:17)
(cid:17)

,

so we can expect the values of µ(v) to match those of µ(m). Although we do not show them
here, analogous treatments can be applied to match v(v) with v(m).

Voronoi partitioned lattices provide one method of interfacing two regions partitioned
by uniform lattices of diﬀering compartment capacities, but only for certain compartment
capacity values. It is not possible, for example, to interface a region where m = 1 with a
region where m = 2, as any intermediate sized compartment would have non-integer valued
capacity. In such situations, it is useful to have another hybrid method capable of interfacing
the regions.

B. Pseudo-compartment method

Pseudo-compartment methods have previously been used to interface compartment-based
models with PDE models. In such models, the domain consists of a region where diﬀusion
is modelled using a discrete model, another region in which diﬀusion is modelled using a
continuum PDE model, and a pseudo-compartment that combines both models. Speciﬁ-
cally, although particle concentration in the pseudo-compartment is modelled in a spatially
continuous manner using PDEs, discrete jump events between the pseudo-compartment and
the neighbouring compartment-based region can take place, adjusting the particle concen-
tration proﬁle appropriately [14]. In this section, we discuss using similar ideas to interface
one region of the domain, partitioned by a coarse lattice with compartment capacity m > 1,
with another region, partitioned with a ﬁne lattice where m = 1.

We assume, without loss of generality, that the coarse region is to the left hand side
of the domain, and that it consists of p compartments of capacity m > 1. The ﬁrst m

9

fully-excluding compartments, i.e. those of index p + 1 through to p + m, are then said to
collectively comprise the pseudo-compartment (this is illustrated for p = 1 and m = 5 in
Figure 4). Particles in compartments 1 through to p may attempt to jump to neighbouring
compartments in this range with rate D/m2h2, while particles in compartments p+1 through
to K may attempt to jump to neighbouring compartments in this range with rate D/h2. In
both cases, these jumps fail with blocking probability,

(cid:33)

(cid:32)

1 − n(c)
j
mj

,

(28)

where j is the index of the destination compartment, and we use n(c)
p , to de-
j
note, respectively the number of particles and the mean number of particles in compartment
j of the lattice.

, and later M (c)

In addition, it is possible for a particle in compartment p to move into the pseudo-
compartment with jump propensity D/m2h2. When this happens, one of the compartments
that comprise the pseudo-compartment is selected uniformly at random, and if it is un-
occupied a particle jumps into it from compartment p (if it is occupied then the jump is
terminated). Equivalently, volume-excluding eﬀects can be incorporated by multiplying the
jump propensity by the fraction of compartments in the pseudo-compartment currently un-
occupied, and selecting a destination from among the unoccupied compartments uniformly
at random when a jump occurs.

Similarly, a particle residing within any part of the pseudo-compartment may jump into

compartment p, with propensity

D

m2h2

(cid:33)

(cid:32)

1 − n(c)
p
m

.

(29)

All of the possible particle jumps for an example lattice are illustrated by arrows in Figure
4. Suppose that the pth compartment is the last partially-excluding compartment, so that
all compartments of index greater than p will be fully-excluding. Within the coarse region,
we write the usual equations for the evolution of mean particle number

(cid:17)

,

(cid:16)−M (c)
(cid:16)

2

1 + M (c)
i−1 − 2M (c)
M (c)

i + M (c)

i+1

dM (c)
1
dt

dM (c)

i
dt

=

=

D

m2h2

D

m2h2

(cid:17)

, 1 < i < p.

(30)

(31)

The mean master equation for compartment p, the ﬁnal partially-excluding compartment,
is modiﬁed to account for the incoming particles it can receive from all fully-excluding
compartments within the pseudo-compartment:

(cid:32)

(cid:33)

p+m(cid:88)

j=p+1

dM (c)
p
dt

=

D

m2h2

p−1 − 2M (c)
M (c)

p +

M (c)

j

.

(32)

Similarly, the equations for mean particle number in the m fully-excluding compartments
comprising the pseudo-compartment region must also account for particles moving to, and

10

FIG. 4. Pseudo-compartment method, with m = 5 and p = 1. The compartments of index
2 through to 6 form the pseudo-compartment. Particles in these compartments may attempt
to jump to neighbouring compartments with rate D/h2, or into compartment 1 with propensity
D/m2h2, subject to the standard blocking probability arising from volume exclusion. Particles
in compartment 1 may jump into any unoccupied compartment with index 2 through to 6 with
propensity D/mh2. When grouped, we have S(c)

6(cid:80)

1 (t) = n(c)

1 (t), S(c)

n(c)
i (t) and S(c)

3 (t) =

2 (t) =

i=2

11(cid:80)

i=7

n(c)
i (t).

(cid:18) 1
(cid:18) 1

m

m

arriving from, the partially-excluding region, as well as for movement over the fully-excluding
lattice,

dM (c)
p+1
dt

dM (c)

i
dt

=

=

D
h2

D
h2

p −

1
m2 M (c)
1
m2 M (c)

p + M (c)

1 +

1
m2
i−1 −

(cid:21)

M (c)

p+1 + M (c)

p+2

,

2 +

1
m2

M (c)

i + M (c)

i+1

(cid:19)

(33)

, p + 1 < i ≤ p + m, (34)

and, ﬁnally, beyond the pseudo-compartment, the evolution of mean particle number is
described using the standard mean master equations with m = 1,

(cid:21)
(cid:20)

(cid:19)

(cid:17)

(cid:16)
(cid:16)

(cid:20)



dM (c)

i
dt

dM (c)
K
dt

=

=

D
h2
D
h2

i + M (c)

i+1

i−1 − 2M (c)
(cid:17)
M (c)
K−1 − M (c)
M (c)

K

.

, p + m < i < K,

(35)

(36)

To compare the description of particle diﬀusion given by the pseudo-compartment model
to the description given by the fully-excluding model where m = 1 we must aggregate the
compartments, writing

S(c)
j (t) =

n(c)
j (t)

p+m(cid:88)
p+m(j−p)(cid:88)

n(c)
i (t)

i=p+1

n(c)
i (t)
i=p+1+m(j−p−1)

if j < p + 1,

if j = p + 1,

if j > p + 1.

(37)

As before, we write µ(c)
(t). This is trivial
for j < p and for j > p + 1, as these are sections of uniformly partitioned compartments

j (t) with µ(m)

j (t)(cid:105), and seek to match µ(c)

j (t) = (cid:104)S(c)

j

11

where m > 1 and m = 1, respectively, and so the previously obtained results apply. When
j = p, we use Eq. (32) to write

dµ(c)
p
dt

=

dM (c)
p
dt

=

=

D

m2h2

D

m2h2

p−1 − 2M (c)
M (c)

p +

p−1 − 2µ(c)
µ(c)

p + µ(c)

p+1

M (c)

j

,

(38)

(cid:33)

p+m(cid:88)
(cid:17)

,

j=p+1

(cid:32)
(cid:16)

which is the expected form needed to match µ(c)
(33) and (34) to write

p with µ(m)

p

. Similarly, for j = 1 we use Eqs.

p+m(cid:88)

j=p+1

dµ(c)
p+1
dt

=

dM (c)

j
dt

p+m(cid:88)

j − D
M (c)

j=p+1

j − D

h2 M (c)

p+m +

p+m +

h2 M (c)
D
h2 M (c)

p+m+1.

D
h2 M (c)

p+m+1

=

D
m2h2 M (c)
D
m2h2 µ(c)
p+m and M (c)

=

p − D
m2h2

p − D
m2h2 µ(c)
(cid:16)

D

dµ(c)
p+1
dt

=

m2h2

p − 2µ(c)
µ(c)

p+1 + µ(c)

p+2

,

(cid:17)

(39)

(40)

Interpolating values of M (c)

p+m+1 using Eqs. (9) and (10), we ﬁnally arrive at

so we expect the values of µ(c)
j

to match those of µ(m)

.

j

Having presented two hybrid methods for interfacing partially-excluding with fully-
excluding regions, we now apply them both to a number of test systems to check their
correspondence to the fully-excluding model where m = 1.

IV. NUMERICAL INVESTIGATIONS

In this section we consider three single-species test cases: maintaining a uniform steady
state in a purely diﬀusive system; particle redistribution from a non-uniform initial state;
and a morphogen gradient. For each case we compare four diﬀerent models:

1. Uniform fully excluding (m = 1): 105 compartments of capacity one and length 0.2.

2. Uniform partially excluding (m = 7): 15 compartments of capacity seven and length

1.4.

3. Hybrid Voronoi: ﬁve compartments of capacity seven and length 1.4, one box of

capacity four and length 0.8, and 66 compartments of capacity one and length 0.2.

4. Hybrid pseudo-compartment: 5 compartments of capacity seven and length 1.4, and
70 of capacity one and length 0.2. The ﬁrst seven fully-excluding compartments form
the pseudo-compartment.

In each case we use these four models to obtain, respectively, numerical values for µ(m)
and
v(m)
, aggregating compartments
j
from the ﬁner grids into regions of capacity m = 7. In each case we set h = 0.2, L = 21, and

, and for µ(p)
j

, for M (m)

and V (m)

, for µ(v)

and v(v)

and v(p)

j

j

j

j

j

j

12

hence N = 105. We choose diﬀusion constant D = 2 for all test cases, and perform 50, 000
realisations of each case over the time interval t ∈ [0, 25].

Since we consider the fully-excluding model as ‘accurate’, in the sense that it speciﬁes
each particle’s location precisely rather than making assumptions about its position within
a larger compartment, a further 50, 000 realisations of the fully-excluding model were gen-
erated to provide an independent estimate for µ(m)
, and these values were used as
our comparison data set.

and v(m)

j

j

The agreement of the four models with the comparison data set was then quantiﬁed using

the Histogram Distance Error (HDE) [22]:

HDE =

K(cid:88)

k=1

1
2

|sk − ck|,

(41)

where sk is the normalised value of the kth aggregated compartment of the model being con-
sidered, and ck is the normalised value of the kth aggregated compartment of the comparison
data set.

To generate these realisations we used an algorithm based on Gillespie’s Direct Method [23],
as described in Appendix C. In each of the three test cases, we also record the time taken
to simulate 50,000 realisations of each model. All simulations were performed using Matlab
code, parallelised using parfor, on a four-core desktop computer using an AMD PhenomTM
II X4 925 Processor.

A. Test Case 1: Maintaining a spatially uniform steady state

In this simplest test, for each realisation we initialise 15 uniformly distributed particles
over the lattice, let them diﬀuse freely, then record their ﬁnal positions to ensure they
remain uniformly distributed. This is the most basic test, and is performed to conﬁrm that
the hybrid interfaces do not interfere with a homogeneous particle distribution.

The mean and variance of particle numbers in each aggregated box at t = 25 are plotted
in Figure 5, showing good agreement between all four models. This agreement is quantiﬁed
in Table I, where we observe that in each model, mean values deviate from the comparison
data by less than 0.25%, and variance values deviate by less than 0.5%. Although we do not
present the details here, it is also possible to demonstrate the steady state agreement of all
four models by analysing their mean and variance master equations.

We ﬁnd that the hybrid models are faster to simulate than the fully-excluding model.
However, the decrease in computational time is modest, and we anticipate that signiﬁcant
computational savings will only be achieved when the majority of particle motion is concen-
trated in the partially-excluding region.

B. Test Case 2: Particle redistribution

The second test case examines the ability of our hybrid models to accommodate a net
particle ﬂux over the interface. Our initial state consists of thirty-ﬁve particles collected
at the left of the domain. For the uniform fully-excluding model, this means that the ﬁrst

13

FIG. 5. Results from 50,000 repeats of the uniform steady state simulation at time t = 25. Fifteen
particles were uniformly distributed at time t = 0 and then diﬀused until time t = 25. From left to
right, each set of four bars shows results from the fully-excluding (dark blue), partially-excluding
(light blue), Voronoi (green) and pseudo-compartment (yellow) models.

Model

Mean HDE Variance HDE Time to simulate

Acceleration relative

TABLE I. Details of uniform distribution simulation.

at t = 25

at t = 25

Fully-excluding
Partially-excluding
Voronoi
Pseudo-compartment

0.0023
0.0022
0.0020
0.0017

0.0046
0.0036
0.0035
0.0033

28741 seconds
582 seconds
19738 seconds
26361 seconds

to fully-excluding

-

49.4 times faster
1.5 times faster
1.1 times faster

thirty-ﬁve compartments are occupied. For all the other models, the ﬁrst ﬁve compartments,
each of capacity seven, are full to capacity.

We compare the agreement of mean and variance values at t = 1, 2, 3 . . . , 25 in Figure 6.
As anticipated, all four models perform well, although the Voronoi model performs somewhat
better than the pseudo-compartment model. A possible explanation of this is that, with
particle concentrations in the pseudo-compartment higher to the left and lower to the right,
particles jumping into the pseudo-compartment from compartment p will disproportionately
arrive in the more numerous vacant compartments to the right of the pseudo-compartment,
slightly lengthening the average jump length. We note though that, even in this case of
strongly asymmetric ﬂux, the HDE remains below 0.008 throughout the simulation.

We also plot the means and variances of particle numbers at t = 25 in Figure 7, and for
consistency with the other test cases list the HDE values at time t = 25 in Table II. We
also record the time taken to simulate each model in Table II, noting again that the hybrid
models run faster than the fully-excluding model, with the Voronoi model taking only half
as much time to simulate.

14

compartment index13579111315mean particle number0.00.20.40.60.81.01.2compartment index13579111315variance of particle number0.00.10.20.30.40.50.60.70.80.9FIG. 6. HDE values for the mean and variance of the particle redistribution simulation results at
discrete times t = 1, 2, . . . , 25.

FIG. 7. Results from 50,000 repeats of the particle redistribution simulation at time t = 25.
Thirty-ﬁve particles were initialised at the left of the domain at time t = 0. From left to right,
each set of four bars shows results from the fully-excluding (dark blue), partially-excluding (light
blue), Voronoi (green) and pseudo-compartment (yellow) models.

15

t0510152025Mean HDE0.0000.0020.0040.0060.0080.0100.012t0510152025Variance HDE0.0000.0050.0100.0150.0200.0250.030Uniform fully-excludingUniform partially-excludingHybrid (Voronoi)Hybrid (Pseudo-compartment)compartment index13579111315mean particle number0.00.51.01.52.02.53.03.54.0compartment index13579111315variance of particle number0.00.20.40.60.81.01.21.41.61.8Model

Mean HDE Variance HDE Time to simulate

Acceleration relative

TABLE II. Details of particle redistribution simulation.

at t = 25

at t = 25

Fully-excluding
Partially-excluding
Voronoi
Pseudo-compartment

0.0015
0.0022
0.0019
0.0047

0.0037
0.0021
0.0037
0.0032

40775 seconds
752 seconds
20884 seconds
31330 seconds

to fully-excluding

-

54.2 times faster
2.0 times faster
1.3 times faster

Model

Mean HDE Variance HDE Time to simulate

Acceleration relative

TABLE III. Details of morphogen gradient simulation.

at t = 25

at t = 25

Fully-excluding
Partially-excluding
Voronoi
Pseudo-compartment

0.0015
0.0023
0.0032
0.0077

0.0050
0.0060
0.0059
0.0105

16622 seconds
385 seconds
3438 seconds
4847 seconds

to fully-excluding

-

43.2 times faster
4.8 times faster
3.4 times faster

C. Test Case 3: Morphogen gradient

In the ﬁnal single-species test case, a simple morphogen gradient system is simulated.
Starting from an empty initial state, particles enter the domain at the left-hand boundary
with rate r1. As well as moving diﬀusively, particles decay with rate r2. In the absence
of volume exclusion, a ﬂux boundary condition can be implemented by adding or removing
particles in the closest compartment to the boundary at a speciﬁed rate [24]. When volume
exclusion is incorporated, however, it will sometimes be the case that the closest compart-
ment to the boundary is already ﬁlled to capacity, in which case no more particles may be
added to it. When this occurred in simulations, we added particles to the ﬁrst compartment
from the boundary with available capacity.

The means and variances of particles at time t = 25 are illustrated in Figure 8, while HDE
values and the computational time required to simulate each model are presented in Table
III. In this case, the hybrid simulations are signiﬁcantly faster than the equivalent fully-
excluding simulations. This is because the majority of particles are located in the ﬁrst third
of the domain, where the hybrid models use computationally eﬃcient partially-excluding
compartments. Simulations of the Voronoi model ran more than four times faster than the
fully-excluding model, while simulations of the pseudo-compartment model ran more than
three times faster than the fully-excluding model.

V. APPLICATION TO A SIMPLE MULTI-SPECIES EXCLUSION SYSTEM

Having established the accuracy of the hybrid methodologies in the test cases of the
previous section, we now apply them to a simple model system where the results of the
partially-excluding model deviate from those of the fully-excluding model.

16

FIG. 8. Results from 50,000 repeats of the morphogen gradient simulation at time t = 25. Particles
are added to the system with rate r1 = 1, and are placed into the closest compartment to the left-
hand boundary which is not full to capacity, while each particle may decay and be removed with
rate r2 = 0.05. From left to right, each set of four bars shows results from the fully-excluding (dark
blue), partially-excluding (light blue), Voronoi (green) and pseudo-compartment (yellow) models.

We consider a simple multi-species system containing two species of particle, A and
B [25]. Neither species is reactive, and particles do not interact with each other except
through volume exclusion eﬀects. The initial state for the system consists of twenty-one
particles of species A at the left of the domain, and twenty-one particles of species B at the
right of the domain, as illustrated in Figure 9 (so that for the fully-excluding model, the
ﬁrst and last twenty-one compartments are occupied, and for the other models the ﬁrst and
last three compartments are ﬁlled to capacity). When simulated using a partially-excluding
model, this system will eventually reach a homogeneous steady state, with both A and B
particles intermixed since the coarsened lattice description allows particles to move past
each another. In contrast, the fully-excluding model does not allow particles to pass one
another, and hence the two species will remain separated. Our hybrid methods can improve
the eﬃciency of simulations by modelling a small central region, where it is possible for the
two species meet, using a fully-excluding lattice, while using a computationally eﬃcient,
partially-excluding lattice elsewhere in the domain.

Figures 10 and 11 illustrate how such regions can be arranged for Voronoi and pseudo-
compartment models where m = 5, and how the interfaces can be shifted left or right to
prevent particles of species A and B from passing one another. Shifting the interface imposes
a small computational cost, but this is more than compensated for by the decreased number
of jump events occurring due to the coarser lattice partitioning.
We adopt the same values of N , h, L and D used in Section IV, and perform 50, 000
realisations of each model over the time interval t ∈ [0, 25]. For the Voronoi and pseudo-
compartment models, we begin each realisation with six compartments of capacity m = 7
at the left-hand side and at the right-hand side of the domain, with an intermediate region

17

compartment index13579111315mean particle numbers0.00.51.01.52.02.53.03.5compartment index13579111315variance of particle numbers0.00.51.01.52.02.5FIG. 9. At time t = 0, twenty-one particles of species A (blue) are initialised at the left of the
domain, and twenty-one particles of species B (red) are initialised at the right.

FIG. 10. An illustration of an adaptive Voronoi domain partition. Particles of species A and B
are shown in blue and red, respectively. The upper image shows the lattice before the hybrid
region shifts left, where the areas marked (a), (b) and (f) are partially-excluding, those marked (c)
and (e) are a combination of fully-excluding and partially-excluding, and the one marked (d) is a
section of fully-excluding compartments. When a B particle enters box (c), the interface shifts left
as illustrated in the lower image, where the areas marked (i), (v) and (vi) are partially-excluding,
those marked (ii) and (iv) are a combination of fully-excluding and partially-excluding, and the
one marked (iii) is a section of fully-excluding compartments. Where a partially-excluding box is
replaced with a ﬁner partition (i.e. (b) and the left part of (c)), the particles within it are uniformly
randomised across the compartments taking its place, weighted by the length of the destination
compartments. When a section of compartments are replaced by a coarser partition (i.e. (e) and
the right of (d)) the occupancy of the new compartments is found from the total number of particles
across that section.

at the centre of the domain of the form illustrated in Figures 10 and 11.

We compare mean and variance values at t = 1, 2, 3 . . . , 25, and plot the resulting HDEs
in Figure 12. As anticipated, the results generated using the partially-excluding model
deviate signiﬁcantly from those generated using the fully-excluding and hybrid models. This
deviation is illustrated by plots of the means and variances of particle numbers at t = 25
in Figure 13. The HDE values at time t = 25 are listed in Table IV together with the time

18

compartment index123456789101112131415initial particle number012345678FIG. 11. An illustration of an adaptive domain partition using the pseudo-compartment model.
Particles of species A and B are shown in blue and red, respectively. The upper image shows the
lattice before the hybrid region shifts left, where the areas marked (a), (b) and (f) are partially-
excluding, those marked (c) and (e) are pseudo-compartments, and the one marked (d) is a section
of fully-excluding compartments. When a B particle enters box (c), the interface shifts left as
illustrated in the lower image, where the areas marked (i), (v) and (vi) are partially-excluding,
those marked (ii) and (iv) are pseudo-compartments, and the one marked (iii) is a section of fully-
excluding compartments. The positions of any particles in box (b) are uniformly randomised across
(ii), while the occupancy of (v) is given by the total number of particles across (e).

FIG. 12. HDE values for the mean and variance of the multi-species simulation results at discrete
times t = 1, 2, . . . , 25. The growing deviation of the partially-excluding model (plotted in blue)
from the other three models can be clearly seen.

taken to simulate each system. It can be seen that the Voronoi and pseudo-compartment
models run 6.9 and 3.2 times faster, respectively, than the fully-excluding system without
losing accuracy.

19

t0510152025mean A HDE10-410-2100t0510152025mean B HDE10-410-2100t0510152025variance A HDE10-210-1Uniform fully-excludingUniform partially-excludingHybrid (Voronoi)Hybrid (Pseudo-compartment)t0510152025variance B HDE10-210-1FIG. 13. Results from 50, 000 repeats of the multi-species simulation at time t = 25. From left to
right, each set of four bars shows results from the fully-excluding (dark blue), partially-excluding
(light blue), Voronoi (green) and pseudo-compartment (yellow) models. The fully-excluding and
hybrid model results display strong agreement, but the results of the partially-excluding model
diﬀer as this model cannot prevent the particles of diﬀering type from moving past one another.

Model

TABLE IV. Details of multi-species simulation.
Mean HDE

Variance HDE Time to simulate Acceleration relative

at t = 25 (A/B) at t = 25 (A/B)

to fully-excluding

Fully-excluding
Partially-excluding
Voronoi
Pseudo-compartment

0.0011/0.0019
0.1853/0.1844
0.0013/0.0019
0.0017/0.0023

0.0032/0.0043
0.2034/0.2023
0.0022/0.0031
0.0017/0.0049

53663 seconds
902 seconds
7722 seconds
16755 seconds

-

59.5 times faster
6.9 times faster
3.2 times faster

VI. DISCUSSION

In this paper, we have presented two methods for the simulation of volume-excluding
compartment-based models on non-uniform lattices. We have presented analytical argu-
ments for the agreement between aggregated mean particle distribution in the uniform
partially-excluding model with m > 1 and in both hybrid models (i.e. M (m) µ(v) and µ(p),
respectively) with the aggregated mean particle distribution in the ‘accurate’ fully-excluding
model with m = 1 (µ(m)). Numerical investigations of three single-species test cases conﬁrm
that all four models agree on the mean and variance of particle numbers within each com-
partment. We have further presented a simple multi-species system, where the results of
uniform partially-excluding models deviate from those of the accurate fully-excluding model,
but the results of hybrid models match those of the fully-excluding model and can be gener-
ated in a fraction of the time. This is a valuable development for researchers working with
multi-scale diﬀusion systems, as it enables computationally eﬃcient partially-excluding com-

20

compartment index13579111315mean of A particle number0123compartment index13579111315mean of B particle number0123compartment index13579111315variance of A particles00.511.52compartment index13579111315variance of B particles00.511.52partments to be used where possible, while using ﬁne-grained fully-excluding compartments
elsewhere in the domain when necessary. Time savings of nearly a factor of seven relative
to the fully-excluding model were observed for the Voronoi model when the test system was
conducive to hybrid modelling, and the time savings in other situations could be even more
signiﬁcant.

ACKNOWLEDGMENTS

PRT gratefully acknowledges an EPSRC studentship through the University of Oxford’s
Systems Biology Doctoral Training Centre. MJS acknowledges support from the Australian
Research Council (FT130100148).

[1] Spill F, Guerrero P, Alarcon T, Maini PK, and Byrne H. 2015 J. Comput. Phys. 299, 429-445.
[2] Erban R, and Chapman SJ. 2009 Phys. Biol. 6, 1-18.
[3] Painter KJ, and Hillen T. 2002 Canad. Appl. Math. Quart. 10, 501.
[4] Anguige K, and Schmeiser C. 2009 J. Math. Biol. 58, 395.
[5] Khain E, Khasin M, and Sander LM. 2014 Phys. Rev. E 90, 062702.
[6] Taylor PR, Yates CA, Simpson MJ, and Baker RE. 2015 Phys. Rev. E 92, 040701(R).
[7] Walpole J, Papin JA, and Peirce SM. 2013 Annu. Rev. Biomed. Eng. 15, 137-154.
[8] Klann M, Ganguly A, and Koeppl H. 2012 Bioinformatics 28, i549-i555.
[9] Flegg MB, R¨udiger S, and Erban R. 2014 J. Chem. Phys. 138, 154103.

[10] Flegg MB, Chapman SJ, and Erban R. 2012 J. Roy. Soc. Interface 9, 859-868.
[11] Robinson M, Flegg MB, and Erban R. 2014 J. Chem. Phys. 140, 124109.
[12] Flegg MB, Hellander S, and Erban R. 2015 J. Comput. Phys. 289, 1-17.
[13] Franz B, Flegg MB, Chapman SJ, and Erban R. 2013 SIAM J. Appl. Math. 73, 1224-1247.
[14] Yates CA, Flegg MB. 2015 J. Roy. Soc. Interface 12, 0141-0155.
[15] Ferm L, Hellander A, and L¨otstedt P. 2010 J. Comput. Phys. 229, 343-360.
[16] Moro E. 2004 Phys. Rev. E 69, 060101(R).
[17] Bollenbach T, Kruse K, Pantazis P, Gonz´alez-Gait´an M, and J¨ulicher F. 2005 Phys. Rev. Lett.

94, 018103.

[18] Tostevin F, ten Wolde PR, Howard M. 2007 PLOS Comp. Biol. 3, e78.
[19] Painter KJ, and Sherratt JA. 2003 J. Theor. Biol. 225, 327.
[20] Redner S. 2001 A Guide to First-Passage Processes. Cambridge, UK: Cambridge University

Press.

[21] Yates CA, Baker RE, Erban R, Maini PK. 2012 Phys. Rev. E 86, 021921.
[22] Cao Y, and Petzold L. 2006 J. Comput Phys. 212, 6.
[23] Gillespie DT. 1977 J. Chem. Phys. 81, 2340-2361.
[24] Taylor PR, Baker RE, and Yates CA. 2015 Phys. Biol. 12, 016006.
[25] Simpson MJ, Landman KA, and Hughes BD. 2009 Physica A 388, 399-406.
[26] Engblom S, Ferm L, Hellander A, and L¨otstedt P. 2009 SIAM J. Sci. Comput. 31, 1774-1797.

21

Appendix A: Outline of transition rate derivations

Transition rates between compartments can be obtained from standard ﬁrst passage pro-
cess results [21]. Consider a particle undergoing Brownian motion, starting from xj, the
residence point of the jth compartment. The probability distribution for its position, p(x, t),
evolves in time following the diﬀusion equation,

∂p
∂t

= D

∂2p
∂x2 .

(A1)

To calculate transition rates between compartments, we consider a ﬁrst passage process on
the interval x ∈ [xj−1, xj−1] to determine the expected time until a particle starting from one
residence point reaches one of its neighbouring residence points. For the diﬀusion equation,
this means deﬁning boundary conditions p(xj−1, t) = p(xj−1, t) = 0, and initial condition
p(x, 0) = δ(x − xj). By applying a Laplace transform, it is possible to obtain the eventual
hitting probabilities describing the likelihood of the particle leaving to either side of the
interval [20]

−(xj) =

+(xj) =

xj+1 − xj
xj+1 − xj−1
xj − xj−1
xj+1 − xj−1

,

.

(A2)

(A3)

(A4)

(A5)

(A6)

Combining these values with the conditional mean exit times

(cid:104)t(xj)(cid:105)− =
(cid:104)t(xj)(cid:105)+ =

(xj − xj−1)(2xj+1 − xj − xj−1)
(xj+1 − xj)(xj+1 + xj − 2xj−1)

6D

6D

,

,

we can then obtain the unconditional exit time
(cid:104)t(xj)(cid:105) = −(xj)(cid:104)t(xj)(cid:105)− + +(xj)(cid:104)t(xj)(cid:105)+

(xj − xj−1)(xj+1 − xj) ([2xj+1 − xj − xj−1] + [xj+1 + xj − 2xj−1])
(xj − xj−1)(xj+1 − xj) (3xj+1 − 3xj−1)
(xj − xj−1)(xj+1 − xj)

6D(xj+1 − xj−1)

6D(xj+1 − xj−1)

=

=

=

2D

.

Inverting the unconditional exit times gives the unconditional exit rate, and by multiplying
this value by the hitting probabilities we obtain the transition rates

2D

(xj − xj−1)(xj+1 − xj−1)

=

Dh

∆xjmj

,

T −
j =

−(xj)
(cid:104)t(xj)(cid:105) =

T +
j =

Dh

∆xj+1mj

.

(A7)

It is also possible to derive these values using a ﬁnite element approach [26]. Transition rates
for the two boundary compartments, j = 1, K, can be derived similarly using the reﬂection

22

principle of Brownian motion. For example, deﬁne a notional point x0 = −x2, then the
unconditional expected exit time for the ﬁrst box is

(cid:104)t(x1)(cid:105) =

(x1 − x0)(x2 − x1)

(x1 + x2)(x2 − x1)

2D

=

2D

.

(A8)

(A9)

Clearly +(x1) = 1, hence we write

We can similarly derive T −

K by reﬂecting xK−1 about x = L.

T +
1 =

Dh

∆x2m1

.

Appendix B: Voronoi master equation derivations

The following derivations are based upon those found in the Supplemental Information
of a previous paper, generalised here to a non-uniform Voronoi lattice [6]. Recall that a
spatial lattice composed of K compartments has been deﬁned. The distribution of particles
over this domain is given by the vector n(t) = [n1(t), n2(t), ..., nK(t)], where ni(t) denotes
the number of particles in the ith compartment at time t. Particles in compartment i may
attempt to jump out to compartments i − 1 or i + 1 with rates T −
i , respectively.
: RK → RK, for

i and T +
: RK → RK, for i = 1, ..., K − 1, and J−

We deﬁne two operators, J +
i

i

i = 2, ..., K, as

: [n1, ..., ni, ..., nK] → [n1, ..., ni−2, ni−1, ni + 1, ni+1 − 1, ni+2, ..., nK],
: [n1, ..., ni, ..., nK] → [n1, ..., ni−2, ni−1 − 1, ni + 1, ni+1, ni+2, ..., nK].

J +
i
J−

i

(B1)
(B2)

Both operators move a particle into compartment i, taken from the compartment to the
right or left, respectively. We assume that attempted jumps into some compartment j fail
with probability nj/mj due to exclusion eﬀects. We can then write the probability master
equation as

(cid:21)
(cid:21)

(cid:20)
(cid:20)

1 − ni+1
mi+1
1 − ni−1
mi+1

(cid:27)
(cid:27)

Pr(n, t)

Pr(n, t)

.

(B3)

(B4)

(cid:21)
(cid:21)

(cid:20)
(cid:20)

mi+1

mi−1

1 − ni+1 − 1
1 − ni−1 − 1
··· N(cid:88)
(cid:26)

(cid:20)

nK =1

Pr(J +

Pr(J−

i n, t) − ni
i n, t) − ni
N(cid:88)

n1,n2,...,nK =0

(cid:21)

Deﬁne the mean vector, M = [M1, ..., MK], where

Mj =

njPr(n, t) :=

njPr(n, t).

Multiplying Eq. (B3) by nj and summing over all possible values that the vector n(t) can
take we have

T +
i

(ni + 1)

(ni + 1)

1 − ni+1 − 1
(cid:21)

(cid:20)
1 − ni−1 − 1

mi+1

mi+1

Pr(J +

i n, t) − ni
(cid:20)

1 − ni+1
mi+1

(cid:21)

Pr(J−

i n, t) − ni

1 − ni−1
mi+1

(cid:20)

(cid:21)

(cid:27)

)

Pr(n, t)

(cid:27)(cid:33)

Pr(n, t)

.

(B5)

(cid:26)
(cid:26)

K−1(cid:80)
K(cid:80)

i=1

i=2

dPr(n, t)

dt

=

+

T +
i

T −

i

(ni + 1)

(ni + 1)

N(cid:88)

n2=1

n1=1

N(cid:88)
(cid:32)K−1(cid:88)
(cid:26)
K(cid:88)

i=1

T −

i

nj

i=2

dMj
dt

=

N(cid:88)

n1,n2,...,nK =0

+

23

We begin by considering only the ﬁrst term of this expression, with Pr(J +
explicitly to give

i n, t) expanded

nj

d(ni + 1) [1 − f (ni+1 − 1)] Pr(n1, n2, ..., ni + 1, ni+1 − 1, ...nK, t).

(B6)

N(cid:88)

K−1(cid:88)

n1,n2,...,nK =0

i=1

When i (cid:54)= j, j − 1 each term of this expression reduces to

i (cid:104)njnif (ni+1)(cid:105),
where (cid:104)njni(cid:105) indicates the mean of the product. When i = j,

i (cid:104)njni(cid:105) − T +
T +

(B7)

(B8)

N(cid:80)
N(cid:80)

N(cid:80)

njT +

j (nj + 1) [1 − f (nj+1 − 1)] Pr(n1, n2, ..., nj + 1, nj+1 − 1, ...nK, t)

n1,n2,...,nK =0

n1,n2,...,nK =0

=

=

j (nj + 1)2 [1 − f (nj+1 − 1)] Pr(n1, n2, ..., nj + 1, nj+1 − 1, ...nK, t)
T +

− T +

j (nj + 1) [1 − f (nj+1 − 1)] Pr(n1, n2, ..., nj + 1, nj+1 − 1, ...nK, t)

j [(cid:104)njnj(cid:105) − (cid:104)njnjf (nj+1)(cid:105) − Mj + (cid:104)njf (nj+1)(cid:105)].
T +

Similarly for i = j − 1,

n1,n2,...,nK =0

=

j−1nj(nj−1 + 1) [1 − f (nj − 1)] Pr(n1, n2, ..., nj−1 + 1, nj − 1, ...nK, t)
T +
j−1[(cid:104)nj−1nj(cid:105) − (cid:104)nj−1njf (nj)(cid:105) + Mj−1 − (cid:104)nj−1f (nj)(cid:105)].
T +
N(cid:88)

i ni [1 − f (ni+1)] Pr(n1, n2, ..., ni, ..., nK, t),
T +

nj

(B9)

(B10)

−

We then consider the second term,

n1,n2,...,nK =0

which evaluates to

[(cid:104)ninj(cid:105) − (cid:104)nif (ni+1)nj(cid:105)] .

T +
i

When combined with the expressions derived from the ﬁrst term these give us

i=1

− T +

j Mj + T +

j (cid:104)njf (nj+1)(cid:105) + T +

j−1Mj−1 − T +

j−1(cid:104)nj−1f (nj)(cid:105).

Applying the same approach to the third and fourth terms we obtain

− T −

j Mj + T −

j+1Mj+1 − T −
j (cid:104)njf (nj−1)(cid:105) + T −
(cid:19)
(cid:18)
Adding this expression to Eq. (B12), we arrive at
(cid:19)
(cid:18)

(cid:18)
(cid:18)

dMj
dt

− T −

(cid:104)nj−1nj(cid:105)

Mj−1 − 1
mj
(cid:104)njnj+1(cid:105)

Mj − 1
mj+1

= T +
j−1
− T +

j

+ T −

j+1

j

Mj − 1
mj−1
Mj+1 − 1
mj

(cid:104)nj−1nj(cid:105)

(cid:104)njnj+1(cid:105)

j+1(cid:104)nj+1f (nj)(cid:105).

(B11)

(B12)

(B13)

,

(B14)

(cid:19)
(cid:19)

24

K−1(cid:88)
− K−1(cid:88)

i=1

as stated in Eq. (2) of the main text.

Variance equations can be derived using the same approach. We begin by using Eq. (B3)

N(cid:88)

to obtain

d
dt

(cid:18)
(cid:18)
(cid:18)
(cid:18)
(cid:18)
(cid:18)
(cid:18)
(cid:18)

i P (n) = T +
n2
i−1

+ T +
i

+ T −

i

+ T −

i+1

⇒ d
dt

(cid:104)n2

i(cid:105) = T +
i−1

+ T +
i

+ T −

i

+ T −

i+1

(cid:19)

(cid:19)
(cid:19)

2(cid:104)ni−1ni(cid:105) − 2
mi
2

−2(cid:104)nini(cid:105) +

−2(cid:104)nini(cid:105) +

(cid:104)ni−1nini(cid:105) + Mi−1 − 1
mi
(cid:104)ninini+1(cid:105) + Mi − 1
mi+1
(cid:104)ni−1nini(cid:105) + Mi − 1
mi−1

mi+1

2

mi−1

2(cid:104)nini+1(cid:105) − 2
mi

(cid:104)ninini+1(cid:105) + Mi+1 − 1
mi

(cid:104)ni−1ni(cid:105)

(cid:104)nini+1(cid:105)

(cid:104)ni−1ni(cid:105)

(cid:19)

2(cid:104)ni−1ni(cid:105) + Mi−1 − 1
mi
−2(cid:104)nini(cid:105) + Mi − 1
mi+1
−2(cid:104)nini(cid:105) + Mi − 1
mi−1
2(cid:104)nini+1(cid:105) + Mi+1 − 1
mi
i−1/mi and T −

(cid:104)ni−1ni(cid:105)

(cid:104)nini+1(cid:105)

(cid:104)ni−1ni(cid:105)

(cid:104)nini+1(cid:105)

,

(cid:104)nini+1(cid:105)

(cid:19)
(cid:19)
(cid:19)
(cid:19)
(B15)
i /mi+1. We then use (cid:104)ninj(cid:105) =
(cid:19)
(cid:19)

1 − 1
mj

(cid:18)

(cid:19)

Vj,j+1

j+1

,

,

(B16)

where we have used T −
Vi,j − MiMj to obtain

= −2(cid:0)T −

dVj
dt

i+1/mi = T +

(cid:18)

j + T +

j

i /mi−1 = T +

j−1

(cid:1) Vj + 2T +
(cid:19)
(cid:18)
(cid:19)

1 − Mj
mj
1 − Mj+1
mj+1

(cid:18)

+ T −

(cid:18)

1 − 1
mj
1 − Mj−1
mj−1
1 − Mj
mj

j Mi

j+1Mj+1

+ T −

(cid:19)
(cid:18)

Vj−1,j + 2T −

+T +

j−1Mj−1

+T +

j Mj

with equations for the covariances obtainable in a similar manner.

Appendix C: Outline of simulation algorithm

In second part of this paper, we compare realisations of four diﬀerent models of volume-
excluding diﬀusion. The following algorithm was used to generate realisations between t = 0
and t = 25:

1. Set timeElapsed = 0 to track the duration of the simulation, and initialise an array

to track particle locations.

2. Generate the exponentially distributed

timeU ntilN extEvent = −ln(rand)/totalEventP ropensity,

(C1)

where rand is a uniformly distributed random number in the range [0, 1].

25

3. If timeElapsed + timeU ntilN extEvent > 25, then go to Step 7, otherwise continue

to Step 4.

4. Use a uniformly distributed random number to determine what event has occured.
The probability of each event being chosen is given by the array of eventP ropensities
divided by the totalEventP ropensity.

5. Update the array of particle locations to reﬂect the outcome of the event, and update

the individual eventP ropensities and the totalEventP ropensity accordingly.

6. Set timeElapsed = timeElapsed + timeU ntilN extEvent, and return to Step 2.

7. Store the array describing the particle positions at time t = 25.

In the ﬁrst two test cases, the array of eventP ropensities consists of left and right jump
propensities for each compartment, some of which will be reduced or elimated completely due
to ﬁlled volumes in neighbouring compartments, and the totalEventP ropensity is their sum.
For the morphogen gradient case, the eventP ropensities will also include decay propensi-
ties for each occupied compartment in the system and a constant particle in-ﬂux term. The
second test case also records particle positions at t = 1, 2, . . . , 24, in addition to the ﬁnal
distribution at t = 25. For each test case, we generated 50,000 realisations of each model,
plus another 50,000 realisations of the fully-excluding model to provide comparison data for
the HDE, and then calculated the mean and variance of particle numbers in each compart-
ment. This algorithm follows a deliberately simple design, demonstrating that no advanced
programming ability is required to implement any of the models.

26

