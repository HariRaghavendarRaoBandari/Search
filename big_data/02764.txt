DOI: 10.1109/TPDS.2016.2533614
Distributed Control for Charging Multiple Electric

Vehicles with Overload Limitation

Bo Yang, Jingwei Li, Qiaoni Han, Tian He, Cailian Chen, Xinping Guan

Abstract

Severe pollution induced by traditional fossil fuels arouses great attention on the usage of plug-in electric

vehicles (PEVs) and renewable energy. However, large-scale penetration of PEVs combined with other kinds of

appliances tends to cause excessive or even disastrous burden on the power grid, especially during peak hours.

This paper focuses on the scheduling of PEVs charging process among different charging stations and each station

can be supplied by both renewable energy generators and a distribution network. The distribution network also

powers some uncontrollable loads. In order to minimize the on-grid energy cost with local renewable energy and

non-ideal storage while avoiding the overload risk of the distribution network, an online algorithm consisting of

scheduling the charging of PEVs and energy management of charging stations is developed based on Lyapunov

optimization and Lagrange dual decomposition techniques. The algorithm can satisfy the random charging requests

from PEVs with provable performance. Simulation results with real data demonstrate that the proposed algorithm

can decrease the time-average cost of stations while avoiding overload in the distribution network in the presence

of random uncontrollable loads.

Index Terms

Electric vehicle, charging scheduling, renewable energy, smart grid, Lyapunov optmization.

6
1
0
2

 
r
a

M
9

 

 
 
]

Y
S
.
s
c
[
 
 

1
v
4
6
7
2
0

.

3
0
6
1
:
v
i
X
r
a

Copyright (c) 2015 IEEE. Personal use of this material is permitted. Permission from IEEE must be obtained for all other uses, including
reprinting/republishing this material for advertising or promotional purposes, collecting new collected works for resale or redistribution to
servers or lists, or reuse of any copyrighted component of this work in other works.
B. Yang, Q. Han, C. Chen, and X. Guan are with the Department of Automation, Shanghai Jiao Tong University, and Key Laboratory
of System Control and Information Processing, Ministry of Education of China, Shanghai, 200240 P. R. China (e-mail: {bo.yang, qiaoni,
cailianchen, xpguan}@sjtu.edu.cn).

J. Li was with the Department of Automation, Shanghai Jiao Tong University, Shanghai, 200240 P. R. China. She is currently with Centre
for Translational Medicine (MD6), National University of Singapore, 14 Medical Drive, Singapore 117599 (email: jingwei.li@u.nus.edu).

T. He is with Department of Computer Science and Engineering, University of Minnesota, MN, USA. Email: tianhe@cs.umn.edu.

I. INTRODUCTION

2

Nowadays pollution engendered by massively burning fossil fuel is serious. Hence more attention is

paid on electric vehicles (EVs), to replace the traditional vehicles. The report by International Energy

Agency (IEA) [1] shows that the number of global EV sales in 2012 reached 113,000, double of sales

in 2011, and predicts that the expected number of EV on the road by 2020 will be up to 20 million.

Therefore, massive plug-in electric vehicles (PEVs)/EVs will appear on the road in the near future, leading

to huge amount of charging demands. This new kind of demand will surely be a challenge for the power

grid, according to the survey conducted by Su et al. [2]. The safety of distribution network to support

the huge demand from PEVs/EVs is essential in regulating the demand from vehicles. Parts of EVs’

inﬂuences on the power grid have been studied in [3]. Good simulation frameworks in [4] also show the

interactions between plug-in hybrid electric vehicles (PHEVs) and the power grid.

Meanwhile, it is possible to integrate more renewable energy sources into the power network due to the

two-way communication and regulation capability of smart grid. Studies in [5] give some inspiration for

better utilization of distributed renewable energy generation. However, the uncertainty and intermittence

of such renewable sources makes it difﬁcult to use them stably and consecutively. A method to tackle

this problem is to introduce storage devices, which can store renewable energy when it is abundant, and

release the stored energy when renewable sources do not work. The objective of storage is similar with

that in Rechargeable Sensor Networks [6]. Moreover, the storage device can be used to cut down the

electricity cost by serving the load when electricity price is high. However, the time-diversity pattern of

electricity price does not always match that of renewable energy generation, which depends on weather

conditions mostly. Thus, how to minimize the non-renewable energy cost through optimal management

of the storage device, renewable energy and on-grid energy comes to be a practical problem. As to PEV

charging, there are already some real applications of renewable-powered charging stations, such as the

3

wind powered stations in Barcelona, Spain [7] and the charging stations with roof-top solar panels in

Downtown Westport, Connecticut, USA [8]. Although they are not massively deployed, these examples

demonstrate the technique feasibility for charging EVs/PEVs by renewable energy.

Prior works [9]-[11] have considered regulations of EV loads in a distribution network. Rahbari-Asr et

al. in [9] consider to maximize the total utility of PEV/EV users, as well as avoiding line/node overload.

The distributed charging regulation algorithms are designed to ensure certain system optimality and line

constraints by means of utility maximization framework and game theory in [10] and [11], respectively.

The scheme in [10] also considers the effects of residential loads on overloading the same distribution

network that provides charging service to EVs. The similar effects are further discussed in [12]-[15]. In

general the above works regard EVs as time shiftable loads and regulate them to charge at different time

slots in order to maintain power network safety and decrease electricity cost by utilizing the time diversity

of electricity price. In other words, [10]-[13] and [16] are more suitable for slow charging scenario. As

for fast charging, it usually lasts for less than one hour with large power consumption. Thus where to

charge turns to be another practical problem, since it is important to avoid overload at individual place

of a distribution network. Saovapakhiran et al. propose to guide EVs and HEVs to the optimal charging

station in order to maximize system utility in [17]. [18] offers a coordinated charging strategy relying on

the vehicle network communication to enhance the cooperation among mobile EVs. Compared with these

papers that utilize conventional power grid to supply charging vehicles, Misra et al. in [19] consider to

use pricing to attract EVs to charge at different microgrids, which can be powered by renewable energy

sources. However, the intermittent nature of renewable energy is not considered in [19]. Recently, we

design an online algorithm to guide EV charging at different stations, which are supplied by both on-grid

energy and time-varying renewable energy [20].

As to dealing with the stochastic issue of renewable energy generation, Lyapunov optimization tech-

4

nique [21] has been applied to energy systems [22]-[25] and wireless communications in smart grid [26].

There are also other techniques that can be used to exploit the time-varying nature of renewable energy,

such as Markov decision process in [27] and game theory in [28]. However, the problem formulation

in [27]-[28] has to rely on the priori knowledge of the underlying stochastic process. This paper also

utilizes Lyapunov optimization method to regulate PEVs to charge with on-grid power or renewable

energy. Moreover, this paper further considers that each charging station is equipped with non-ideal energy

storage with inefﬁcient charging and discharging to store extra renewable energy. Thus, the framework

of the algorithm designed for ideal storage in the aforementioned articles cannot be applied to this paper

directly.

In this paper, a distribution network is considered, where there are multiple charging stations. Also

many non-EV loads are connected to every transformer and transmission line in this distribution network.

It is supposed that each charging station is equipped with a renewable energy generator and a non-ideal

storage, which will absorb the abundant renewable energy. If the energy generated by renewable source

is insufﬁcient, charging stations are supposed to draw energy from the local storage or gain energy

from the power grid. Hence this paper tries to minimize the time average non-renewable energy cost in

a distribution network by coordinating the charging of PEVs and renewable energy management, while

satisfying the safety of distribution networks by limiting the overload probability under a certain permitted

bound. The contribution of this paper are threefold:

1. A stochastic optimization problem is formulated to minimize the time-average cost for serving PEVs

by renewable energy with non-ideal storage and power networks that supply some uncontrollable

loads at the same time.

2. An online algorithm consisting of guidance of PEV charging and energy management at stations

is proposed based on Lyapunov optimization and Lagrange dual decomposition techniques. The

5

algorithm can result in provable performance with non-ideal storage and ensure the safety of the

distribution network.

3. Simulations with real data demonstrate that the asymptotic optimality and comparative waiting time

can be achieved.

The rest of this paper is organized as follows: system models are introduced in Section II; problem

formulation is given in Section III; an online algorithm is developed in Section IV; mathematical proofs

of algorithm performance can be found in Section V; simulations are demonstrated in Section VI; at last,

conclusion of this paper is given in Section VII. The key mathematical notations used in the paper are

listed in Table 1.

TABLE I

MATHEMATICAL NOTATIONS

Notation
l, L
i, I
j, Ji
k, K
[tT, (t + 1)T )
Pl
Xli
Nl(t)
Ui(t)
Bi(t)
Ri(t)
rij(t)
Dd
i (t)

c(t)
σNl
ek(t)
ηk(t)
Ek(t)
pk
Wk,ij(t)
Qij(t)
η+, η−
−−→
Hi(t)
−−→
θ(t)
L(
−−→
θ(t))
(cid:52)(
θ(t))

Physical interpretation
Index and set of transformers and lines (nodes), L ={1, 2, ..., L}
Index and set of charging stations, I ={1, 2, 3, ..., N}
Index and set of charging outlets belonging to the i-th charging station, Ji ={1, 2, ..., Ji}
Index and set of entry points, K ={1, 2, ..., K}
t-th interval with T being the length of a slot
Capacity of the l-th transformer/line
Indicating variable for the relationship between the l-th node and the i-th charing station
Amount of uncontrollable loads connected to the l-th node in time slot t
Production rate of a renewable energy generator for thr i-th station
Energy level of the storage device for the i-th charging station
Charging rate renewable energy charged into the i-th charging station’s battery
Charging rate of the charging outlet j in the i-th charging station
Energy ﬂow from the grid to charging outlets directly
Maximum probability of the overload chance
Power price in time slot t in the system
Standard deviation of Nl(t)
Amount of energy demand at the k-th entry point in time slot t
Whether there is a PEV carrying an amount of energy demand of ek(t) in time slot t
Energy demand arrives at the k-th entry point in time slot t
Probability of PEVs sending request to the k-th entry point
Indicating variable for connections between k-th entry point and i-th charging station’s j-th outlet in time slot t
Demand queue of the j-th outlet of the i-th charging station at the beginning of time slot t
Charging efﬁciency, discharging efﬁciency
Shift version of Bi(t)
State of system queues at the beginning of time slot t
Lyapunov function
Lyapunov drift

6

Fig. 1. Distribution network.

II. SYSTEM MODELS

This section introduces the system model of a distribution network, which includes several charging

stations, uncontrollable non-PEV loads, and random request of PEVs.

A. Distribution Network and Charging Stations

In this paper, a distribution network (Fig. 1), composed of multiple transformers and lines, is considered.
The set of transformers and lines is L = {1, 2, ..., L}. Every transformer and transmission line has its

power capacity, determined by the type of conductor, the highest temperature permitted, and other physical
and environmental factors, and the capacity of the l-th (l ∈ L) transformer/line is denoted by Pl. The

considered system is modeled as a slotted one and it is referred to the t-th interval [tT, (t + 1)T), where

T is the length of a slot. In the following T is normalized to unit for easier presentation.

Let i ∈ I = {1, 2,··· , N} denote the i-th charging station and j ∈ Ji = {1, 2, ..., Ji} denote the

j-th charging outlet in the i-th station, where Ji is the set of charging outlets belonging to the i-

th charging station. In this distribution network, different charging stations are connected to different

transformers/lines, represented by different nodes later for consistency. Therefore, the matrix X(L×I) is

used to indicate the relationship between different nodes and charing stations, where Xli = 1 means that

the i-th station is downstream of the l-th node, otherwise Xli = 0. It should be noted that the network

7

constraint is not explicitly modelled here as in generic AC networks. We only use the matrix X(L×I)

to reﬂect the DC power ﬂow relationship between different nodes and charging stations to present the

problem clearly. Meanwhile, other non-EV loads, such as factories, households, and shopping malls, are

also fed by this distribution network. The amount of uncontrollable loads connected to the l-th node is

Nl(t) in time slot t.

To alleviate the burden imposed by charging stations on the distribution networks, every charging
station is equipped with a renewable energy generator, whose production rate is Ui(t)∈ [0, Umax] for the

i-th station, and the cost to use its own renewable energy is neglected in this scenario. We do not consider

the initial investment cost for deploying renewable energy generators, since it is a constant. Note that

it is easy to incorporate the storage degradation cost due to charging/discharging by the model in [29].

Since the renewable energy production is intermittent and unpredictable, a storage device, for example a

battery, is equipped for every charging station. It can also cut down the electricity cost since a battery as

a buffer can store energy when electricity price is low and release energy for EVs’ charging when price

is high, to reduce the cost. The energy level of the storage device for the i-th charging station is Bi(t),
bounded by [0, Bi,max], and Bi,max∈ (0, Bmax]. In the following, we refer the battery as the storage device

in each station except for other speciﬁcation. Given that the SOC of each battery is upper bounded by

the battery’s capacity, not all amount of renewable energy Ui(t) in time slot t is charged into it.

For every charging outlet j in the i-th charging station, the charging rate rij(t) is also constrained by
rij(t)∈ [0, ri,max] and ri,max ∈ (0, rmax]. The PEV charging load is ﬁrstly supplied by harvested energy

from renewable energy generator. If there is still redundant energy, it is then charged into the battery1.
Let Ri(t) be the current charging rate to the battery and thus Ri(t)∈

rij(t)

,

(cid:32)
Ui(t)− Ji(cid:80)

j=1

0, min

Rmax

i

(cid:33)+
,

1If there is still superﬂuous energy after charging the storage, the renewable generator will self-regulate its generation rate. For example,
the output power of a solar panel can be changed by maximum power point tracking method. If the renewable energy generator is connected
to the power grid, the redundant energy will be input to the grid. However, in this paper we assume that the local renewable energy generator
is run in off-grid mode.

where (x)+ ˆ=max{0, x}. Otherwise an amount of

(cid:32) Ji(cid:80)

j=1

(cid:33)+
rij (t) − Ui (t)

8

load will be served either by the

battery or by the distribution networks depending on the energy availability in battery and usage cost

i (t) ∈(cid:104)

0, Dd,max(cid:105)
(cid:33)+−Dd

(cid:32) Ji(cid:80)

j=1

of power grid. Let Dd

denote the amount of energy withdrawn from the distribution

network and

rij(t)−Ui(t)

i (t) the amount of energy supplied by the battery. To ensure that the

distribution network can sustain the charging load independently, we assume Dd,max > ri,max. Thus the

total loads imposed on the l-th node is (cid:80)
If no overload is permitted, (cid:80)

i:Xli=1Dd
i (t)+Nl(t) ≤ Pl should stand for every time slot t. Since the
uncontrollable loads are time varying and each node always allows slight overload for the safety reason

i:Xli=1Dd

i (t)+Nl(t).

[10], the above inequality can be slacked to the “chance constraint”:
i (t)+Nl(t) > Pl]≤ ,
Dd

(cid:88)

P r[

i:Xli=1

(1)

where  is chosen to ensure that the node is safe even with a little overload.

At the end of this subsection, let c(t) denote the power price in time slot t in the system, and it is also

bounded by [Cmin, Cmax].

B. PEVs’ Request and Guidance

In the area supplied by this distribution network, there are numerous entry points for PEVs to join,

which can be considered as ﬁxed data uploading workstations on the roadside, and the number of such

entry points is K. Here we just use the entry point to describe the parallel process of multiple PEVs’

request. PEVs randomly send charging requests to an idle entry point, and the variable ξk(t) denotes

whether there is a PEV carrying an amount of energy demand of ek(t), sending request to the k-th
(k ∈ K = {1, 2,··· , K}) entry point. If there is a PEV uploading request to the k-th entry point, let

ξk(t) = 1, otherwise ξk(t) = 0. Therefore the energy demand arrives at the k-th entry point is Ek(t) =
ek(t)ξk(t)≤ Emax <∞. Notably, the probability of PEVs sending request to the k-th entry point is denoted

by pk, which means P r[ξk(t) = 1] = pk.

9

The proposed directing policy in Section IV decides which charging outlet the PEVs arriving at each
entry point should be guided to. Hence the binary variable Wk,ij(t) ∈ {0, 1} is used to denote the

connections between the k-th entry point and the j-th outlet of the i-th charging station, where Wk,ij(t) = 1

means the PEVs sending request to the k-th entry point shall be guided to the j-th outlet in the i-th

charging station. It is reasonable that each charging outlet can only serve one entry point and only one

outlet can be connected to each entry point simultaneously. Therefore, Wk,ij(t) satisﬁes

(cid:88)Ji

i=1

j=1

(cid:88)I
(cid:88)K

Wk,ij(t)≤ 1 (∀k∈ K),

Wk,ij(t)≤ 1 (∀i∈ I, j∈ Ji).

k=1

rij(t)−Ui(t)

(cid:32) Ji(cid:80)

(cid:33)+−Dd

where 0 < η+ ≤ 1 and η− ≥ 1 represent the charging and discharging efﬁciency respectively, and
η−

 denotes the amount of energy that the i-th charging station extracts
 Ji(cid:88)

≤ Bi(t)≤ Bi,max,

from its battery. The following inequality stands for every battery:

rij (t)−Ui (t)

+

0≤ η−

−Dd

i (t)

i (t)

j=1

j=1

The dynamic operation of this system is stated here. At the beginning of every time slot, the central

controller collects the energy demand at each entry point and some information of each charging station

before broadcasting the guidance information. At the same time, every node computes the overload indica-

tion according to current PEV loads and uncontrollable loads imposed on it. Finally, each charging station

computes other control variables Dd

i (t) and Ri(t) in a distributed way based on the local information

and the overload indication.

C. Battery Dynamics and Demand Queue

For each charging station, its battery’s energy state satisﬁes the following iterating equation:

Bi(t + 1) = Bi(t)−η−

rij(t)−Ui(t)

−Dd

i (t)

 Ji(cid:88)

j=1

+

+η+Ri(t),

(2)

(3)

(4)

(5)

10

which means charging outlets in the i-th charging station cannot obtain amounts of energy from the battery

more than the battery’s residual energy and the battery also has its capacity constraint. The algorithm

given in Section IV can guarantee it perfectly.

Since PEVs’ charging request is random, the following virtual demand queues are introduced to measure

the relationship between charging request and energy supply. The stability of demand queues, deﬁned

in Section III, can be reached by regulating charging rate at every outlet and directing policy in Section

IV to realize the supply-demand balance. The stability of demand queue means that the time-average

charging requests can be satisﬁed. For every outlet, the demand queue is denoted by:

Qij(t + 1) = [Qij(t) − rij(t) + Ek(t)Wk,ij(t)1{Qij (t)=0}]+,

(6)

where [a]+ stands for max{a, 0}. The expression 1{Qij (t)=0} here denotes that only if the demand queue

is empty at the beginning of time slot t, can any new PEV’s demand be directed to this charging outlet.

III. PROBLEM FORMULATION

The goal of this paper is to minimize the time-average expected cost from the power grid with

constraints of battery and stable demand queues, as well as the safety of the distribution networks.

The problem can be formulated as a stochastic optimization problem.

P1: min lim
τ→∞

1
τ

τ−1(cid:88)

I(cid:88)

t=0

i=1

E{c(t)Dd

i (t)}

(7)

s.t. stability of Qij(t) (∀i ∈ I,∀j ∈ Ji), (1), (2), (3), (4), (5), (6)

where the expectation above is with respect to the potential randomness of the control policy. The stability

of these queues are deﬁned in Deﬁnition 1.

Deﬁnition 1: A discrete queue evolving like Q(t + 1) = [Q(t) − S(t)]+ + D(t) is strongly stable if:

t−1(cid:88)

τ =0

lim
t→∞ sup

1
t

E{Q(τ )} < ∞.

If demand queues including the battery dynamics iteration (4) are strongly stable, the system is stable.

11

According to Neely’s monograph [30], a strongly stable queue must be rate stable for ﬁnite service
S(t) and stochastic arrival D(t). Furthermore, if and only if d ≤ s holds, Q(t) is rate stable, where

(cid:80)t−1
τ =0 E{D(τ )} and s = limt→∞ 1

(cid:80)t−1
τ =0 E{S(τ )}.

t

d = limt→∞ 1
t

There is time coupling difﬁculty in solving P1 due to (4), that is to say the current charging and

discharging decisions will affect the energy level in battery in the future. To tackle this difﬁculty, a

relaxed problem will be studied:

(cid:102)P1: min
s.t. stability of Qij(t) (∀i ∈ I,∀j ∈ Ji), (1), (2), (3), (6),

i (t)}

lim
τ→∞

1
τ

i=1

t=0

τ−1(cid:88)
I(cid:88)
E{c(t)Dd
η−
 Ji(cid:88)

j=1

E

t=0

1
τ

lim
τ→∞

−Dd

τ−1(cid:88)

≥ lim
+
rij (t)−Ui (t)
Denote the optimal value of P1 as P ∗ and (cid:102)P1 as P ∗
a feasible solution of (cid:102)P1 since (cid:102)P1 is less constrained than P1. Therefore, P ∗
to P1. More interestingly, the proposed algorithm for (cid:102)P1 also satisﬁes the constraints of (5).

η+Ri (t)

τ−1(cid:88)

τ→∞

i (t)

(cid:110)

1
τ

(cid:111)

.

E

t=0

re. Notice that any feasible solution of P1 is also

re ≤ P ∗. We will solve (cid:102)P1

ﬁrst. Later we will prove the performance gap between the proposed algorithm and the optimal solution

One challenge in solving (cid:102)P1 is due to the fact that the supply, demand and price are all stochastic

IV. PROBLEM DECOMPOSITION AND SOLUTION

processes. If all statistical information is known, it can be solved ofﬂine. However, the solution to this

problem should be achieved by real-time implementations. Firstly, some transformation of constraint (1)

shall be done to write it into a deterministic form.

A. Transformation of Chance Constraint

Assume the distribution of uncontrollable load Nl(t) is symmetric about its mean. Then there is

P r[Nl(t)≥Pl−(cid:88)

Dd

i (t)]=

i:Xli=1

P r[|Nl(t)−E{Nl(t)}|≥Pl−(cid:88)
[Pl − (cid:88)

σ2
Nl

Dd

i (t)−E{Nl(t)}]2 ≤ ,

i:Xli=1

1
2
≤ 1
2

i (t)−E{Nl(t)}]
Dd

12

(8)

where σNl is the standard deviation of Nl(t). As in [31], Chebyshev’s inequality is given below:

i:Xli=1

P r[|x| ≥ a] ≤ σ2

x/a2

for a zero-mean random variable x, and σx is the standard deviation of x. Therefore, the constraint in

(8) is transferred to

B. Real-time Decomposition

Pl− (cid:88)

i:Xli=1

i (t)−E{Nl(t)}≥ σNl√
Dd
2

.

(9)

In order to develop algorithm to regulate the SOC of each battery to satisfy (5), the shifted version
of Bi(t), Hi(t) = Bi(t)−Tmax−η−Jiri,max is given, where Tmax is a constant which will be deﬁned in

Section V. Like Bi(t), Hi(t) also satisﬁes
Hi(t + 1) = Hi (t)−η−

 Ji(cid:88)

+

rij (t)−Ui (t)

j=1

+η+Ri (t) .

−Dd

i (t)

(10)

The technique for shifted queue is also utilized in [32]. Then the state of system queues is described
−−→
θ(t) = (Q11(t), ..., QIJI (t), H1(t), ..., HI(t)).

as

Deﬁne Lyapunov function as:

−−→
θ(t)) =

L(

I(cid:88)

Ji(cid:88)

i=1

j=1

1
2

Q2

ij(t) +

I(cid:88)

i=1

1
2

H 2

i (t).

The Lyapunov drift is given by
(cid:52)(

−−→
θ(t)) = E{L(

−−−−−→
θ(t + 1)) − L(

θ(t))|−−→
−−→
θ(t)}.

From (6) and (10), it is easy to see that

(11)

(12)

(cid:88)K

13

(15)

1
2

1
2

ij(t + 1)−Q2

ij(t))≤ αmax−Qij(t)rij(t)−rij(t)

(Q2

Ek(t)Wk,ij(t)1{Qij (t)=0},

(Hi(t + 1)−H 2

i (t))≤ βmax−Hi(t)

where αmax=1

2r2

max+1

2E2

max<∞ and βmax = 1

2 max

η−
 Ji(cid:88)
(cid:110)

j=1

k=1

+
rij(t)−Ui(t)
(cid:110)

(η+Umax)2 , maxi

−Dd

i (t)

J 2
i r2

i,max

(13)

 ,

+η+Ri(t)
(cid:111)(cid:111)
<∞ are ﬁnite constants.

(14)

Substitute (13) and (14) into (12). We consider the following drift plus penalty expression as in [33].

The Lyapunov drift is used to measure stability and the penalty item accounts for system performance.

The tradeoff between system stability and optimal performance is achieved by the parameter V .

E

i=1

j=1

 Ji(cid:88)
θ(t)}≤ δmax− I(cid:88)
i (t)|−−→
(cid:33)
· 1(cid:26)
Ek (t) Wk,ij (t)+Hi (t) η−
+
I(cid:88)

rij (t)<Ui(t)

i=1

E

E

i=1

i=1

j=1

k=1

Dd

(cid:52)(

rij (t)

−−→
θ(t))+V E{c(t)

− I(cid:88)
I(cid:88)
I(cid:88)

I(cid:88)
 Ji(cid:88)
(cid:32) K(cid:88)
Hi (t) Ri (t) η+·1(cid:26) Ji(cid:80)
Dd
where δmax=(cid:80)I

i (t)

i=1

i=1

+

+

E

E

j=1

(cid:16)
Hi (t) η−+V c (t)

θ (t)

(cid:27)(cid:12)(cid:12)(cid:12)(cid:12)−−→
(cid:17) · 1(cid:26) Ji(cid:80)

j=1

rij (t)≥Ui(t)

θ (t)


(cid:12)(cid:12)(cid:12)(cid:12)−−→


(cid:27)(cid:12)(cid:12)(cid:12)(cid:12)−−→

θ (t)

rij (t)

(cid:16)

θ (t)

Qij (t)=0

rij (t)≥Ui(t)

Qij (t)+Hi (t) η−(cid:17)·1{Qij (t)>0}

(cid:27)(cid:12)(cid:12)(cid:12)(cid:12)−−→
Ji(cid:80)
Hi (t) η−Ui (t)·1(cid:26) Ji(cid:80)
 ,
(cid:27)(cid:12)(cid:12)(cid:12)(cid:12)−−→

rij (t)≥Ui(t)

θ (t)

j=1

j=1

i=1 Jiαmax+Iβmax<∞, and V is an important parameter in regulating the trade-off between
system cost and storage capacity. By adopting the framework of Lyapunov optimization, two sub-problems

only relying on current information are derived by minimizing the right hand side of (15) approximately

subject to the constraints in (cid:102)P1. Later it is proven that the proposed algorithm can satisfy the constraints

of (5). Notice that (1) has been replaced by (9).

P2:

 Ji(cid:88)
I(cid:88)

i=1

j=1

−Dd

i (t)

(cid:16)

rij (t)

If Qij(t) > 0

(cid:16)

(cid:32) K(cid:88)
Qij (t)+Hi (t) η−(cid:17)·1{Qij (t)>0}+
Ji(cid:88)
(cid:17)−Hi (t) Ri (t) η+(cid:111)
Rmax
Ui (t)− Ji(cid:88)
0, min

rij (t)

k=1

j=1

,

i

j=1

Hi (t) η−+V c (t)

s.t. (9), rij (t)∈ [0, ri,max] , Ri (t)∈

Ek (t) Wk,ij (t)+Hi (t) η−

+
 ,∀i∈ I.

rij (t)

14

(cid:33)

·1{Qij (t)=0}

(16)

Another subproblem can be extracted from P2, to decide the connections between PEV requests at

different entry points and charging outlets, for ∀Qij(t) = 0, shown as below:

K(cid:88)

k=1

P3: max
Wk,ij (t)

Ek (t) Wk,ij (t) + Hi (t) η−

(17)

s.t. (2), (3)

which means that the algorithm should meet the largest amount of demand with the empty charging outlet

whose battery’s residual energy is the most.

Notice that there is variable coupling due to the constraint (9) in P2. To decouple this constraint,

Lagrange dual method will be employed in the next subsection.

C. Decoupling of Primal Problems

Considering Lagrangian relaxation for P2, two functions are deﬁned in the case of Qij(t) > 0 and

F 1

−→
Dd,

Qij(t) = 0 respectively:
−→
−→
λ )=
R,

I(cid:88)
{ Ji(cid:88)
t (−→r ,
L(cid:88)
λl(Pl−(cid:88)
i (t)−E{Nl(t)}− σNl√
Dd
I(cid:88)
{ Ji(cid:88)
2
−→
t (−→r ,
Dd,

−→
λ )=

K(cid:88)

−→
R,

i:Xli=1

F 2

j=1

i=1

+

l=1

),

rij(t)[Qij(t)+Hi(t)]−Dd

i (t)(Hi(t)η−+V c(t))−Hi(t)Ri(t)η+}

rij(t)[

Ek(t)Wk,ij(t)+Hi(t)η−]
L(cid:88)
i (t))(Hi(t)η−+V c(t))−Hi(t)Ri(t)η+}+

λl(Pl− (cid:88)

k=1

j=1

i=1

−(Dd

i (t)+Db

i (t)−E{Nl(t)}− σNl√
Dd
2

),

l=1

i:Xli=1

I (t)),

1(t), ..., Dd

−→
R = (R1(t), ..., RI(t)), and

−→
where −→r = (r11(t), ..., rIJi(t)),
Dd = (Dd
−→
−→
λ ) and Γ2
The dual functions Γ1
λ ) are deﬁned as the partial maximum of F 1
t (
t (
−→
−→
λ ) with respect to −→r ,
t (−→r ,
Dd,
−→
t (−→r ,
(cid:33)+ , Ri (t)∈
Dd,
−→r ,
rij (t)−Ui (t)

−→
−→
λ ), Γ2
λ ) = max
t (
−→
−→
Dd,
R

t (−→r ,
(cid:32)
Ui (t)− Ji(cid:80)

−→
Γ1
λ ) = max
t (
−→
−→
Dd,
R

0, min

−→
R :
−→
R ,

(cid:32) Ji(cid:80)

0,

−→
Dd,

−→
Dd,

s.t. Dd

−→
R ,

−→
R ,

rij (t)

F 2

F 1

F 2

i (t)∈

−→r ,

Rmax

i

,

j=1

j=1

15

−→
λ = (λ1, ..., λL).
t (−→r ,

−→
λ ) and

−→
Dd,

−→
R ,

−→
λ )

(cid:33)+
 , (∀i∈I, j∈Ji)

Now scrutinizing the dual functions above, it can be decomposed into subproblems for each charging

outlet, renewable energy generator, and charging station. The following problems P4(a) and P4(b) are for

every charging outlet to decide their charging rates. Problem P5 is for station’s private renewable energy

generator to regulate the charging rate Ri(t) to the battery. And problem P6 is for every charging station

to determine the energy they consume from the grid.

If Qij(t) > 0,

If Qij(t) = 0,

P4(a) :

max

0≤rij (t)≤ri,max

rij(t)[Qij(t)+Hi(t)η−]

P4(b) :

max

0≤rij (t)≤ri,max

K(cid:88)

rij(t)[

Ek(t)Wk,ij(t)+Hi(t)η−]

(18)

(19)

(cid:80)K
k=1 Ek(t)Wk,ij(t) + Hi(t)η− in P4(b) will be solved by directing policy in the next subsection, which
is the solution of P3.

k=1

I(cid:88)

P5: min
Ri(t)

i=1

Hi (t) Ri (t) η+

Rmax
s.t. 0≤ Ri (t)≤ min
(cid:16)
(cid:17)
L(cid:88)
Hi(t)η− + V c(t)

+

i (t)

i

, Ui (t)− Ji(cid:88)
 (cid:88)

j=1

λl

l=1

i:Xli=1



rij (t)

i (t)−Pl +E{Nl(t)}+
Dd

(20)

 (21)

σNl√
2

P6: min
i (t)

Dd

φt(

−→
Dd,

−→
λ ) =

Dd

I(cid:88)
 Ji(cid:88)

i=1

j=1

0,

s.t. Dd

i (t)∈

rij (t)−Ui (t)

+

Notice that P4(a), P4(b), and P5 are independent of Lagrangian multipliers. Thus only the dual problem

16

of P6 shall be considered as follows. (cid:99)P6: max−→

λ

−→
Dd,

−→
λ )

φt(

min
Dd
i (t)

s.t. λl ≥ 0 ∀l ∈ L,

which is equivalent to:

where Λi(Dd

i (t),

λl(E{Nl(t)} +

{ L(cid:88)
i (t)(Hi(t)η− + V c(t) +(cid:80)

σNl√
2

l=1

max−→

λ

−→
λ ) = Dd

− Pl) + min

Db

i (t)

l:Xli=1 λl).

I(cid:88)

i=1

Λi(Dd

i (t),

−→
λ )},

(22)

(23)

D. Directing Policy and Distributed Energy Allocation Laws

In this subsection, the solutions of P3∼P6 will be given. The whole algorithm consists of directing

policy and energy allocation laws. Directing policy, the solution of P3, decides which outlet that the PEV

registered at the k-th entry point should be charged in. Distributed energy allocation laws, implemented
by each charging station, are solutions of P4∼P6.

1) Directing Policy: After every PEV uploads their energy demands via entry points, and every

charging station uploads their battery state, the central controller implements the following Algorithm 1.

Algorithm 1 Directing Policy
Input: Ek(t), Hi(t)η−
Output: The decision variable Wk,ij(t)

Deﬁne two sets: Y={k|Ek(t) > 0} and Z={(i, j)|Qij = 0} to include the nonempty entry points and
empty outlets in time slot t respectively.
Let all Wk,ij(t) = 0.
while Y (cid:54)= Ø && Z (cid:54)= Ø do

Choose the entry point having the largest demand Ek(t) from Y.
Search for an empty outlet (i, j) among Z to get the maximum of Ek(t) + Hi(t)η−.
Let Wk,ij(t) = 1, remove k from Y and (i, j) from Z.

end while

17

Fig. 2. Charging rate control law.

Fig. 3. A sketch for the whole algorithm.

2) Charging Rate of PEV: For every charging outlet, the charging rate is determined by solving

problems P4(a) and P4(b), case by case.

a) For outlet that is non-empty (Qij(t) > 0) at the beginning of t: The charging rate depends on the

demand queue state and battery state.

b) For outlet that is empty (Qij(t) = 0) at the beginning of t: The charging rate depends on the coming

demand in this time slot and also battery state.

The charging rate control law shown in Fig. 2 means to serve the demand as fast as possible when the

battery has sufﬁcient power.

3) Renewable energy input: Every charging station determines the charging rate of their harvested

renewable energy at time slot t, depending on the battery state, also in a distributed way,

min{Rmax

i

Ri(t) =



, (Ui(t) − Ji(cid:88)

j=1

rij(t))+}

if Hi(t) ≤ 0

0

otherwise

It is intuitive that Hi(t) < 0 means that the battery is thirsty so that all available renewable energy

should be charged into it; however, when there is enough electricity in the battery, no renewable energy

will be charged into, for the sake of battery constraints in (5).

(cid:11)(cid:12)0?ijQt(cid:33)(cid:11)(cid:12)(cid:12),maxijirtr(cid:32)(cid:32)(cid:11)(cid:12)(cid:12)0ijrt(cid:32)(cid:32)YYNN(cid:11)(cid:12)(cid:11)(cid:12)(cid:11)(cid:12),1?KkkijikEtWtHt(cid:75)(cid:16)(cid:32)(cid:33)(cid:16)(cid:166)(cid:11)(cid:12)(cid:11)(cid:12)?ijiQtHt(cid:75)(cid:16)(cid:33)(cid:16)(cid:11)(cid:12)(cid:12),maxijirtr(cid:32)(cid:32)(cid:11)(cid:12)(cid:12)0ijrt(cid:32)(cid:32)r(cid:11)(cid:12)(cid:11)(cid:12)(cid:12)??kiji(cid:11)(cid:12),WtHt(cid:11)(cid:12)(cid:11)kiji(cid:11)(cid:12)ijrijYNDirecting PolicyCentral controller decides guidance for every PEV(cid:262)s request according to Algorithm 1Nodes:Iteration for Lagrange multipliersUpdate(cid:11)(cid:12)(cid:11)(cid:12)(cid:11)(cid:12)(cid:11)(cid:12) 4,6iijBtQtby(cid:11)(cid:12)(cid:11)(cid:12): 00, 00iijInitializationBQ(cid:32)(cid:32)Charging Stations:Implement energy allocation laws for (cid:11)(cid:12)(cid:11)(cid:12)(cid:11)(cid:12), ,  dijiirtDtandRt4) Consumption from the power grid: By introducing the Lagrangian dual problem (cid:99)P6, each charging

18

station can locally solve a subproblem given by

min

s.t.

Λi
i (t)≤

0≤ Dd

(cid:33)+
i (t) , (cid:126)λ
rij (t)−Ui (t)

.

(24)

(cid:17)

(cid:16)
(cid:32) Ji(cid:80)

Dd

j=1

The dual problem is solved by using gradient projection method, and the Lagrangian multipliers are

updated as following:

λl(n+1, t) =

λl(n, t)−κ

Pl−(cid:88)

i (n, t) − E{Nl(t)} − σNl√
Dd
2

i:Xli=1

+

,

(25)

where κ is a sufﬁciently small positive constant, known as the step size and n is the iteration index in

time slot t.

Since Λi is a linear function of Dd

i (t), the optimum of (24) depends on the monotonicity of Λi. Algo-

rithm 2 states how to choose Dd

i (t), where M is the greatest number of iterations and ξ is the convergence

criterion. The following result characterizes the effects of constant step size on the convergence property.

Lemma 1: By the above iteration (25) with constant stepsize, the dual function (22) is guaranteed

(cid:17)
(cid:17) − ϕbest
(cid:16)(cid:126)λ (m, t)
(cid:16)(cid:126)λ
(cid:17)2(cid:27) steps, where ϕ∗

n,t

t

(cid:17)

<

(cid:16)(cid:126)λ

(cid:26)

(cid:16)

to converge to a suboptimal value within a ﬁnite number of steps, i.e., ϕ*
t

κL maxl

P 2

l +

Dmax

l +E (Nl)+ σNl√

2

within at most

(cid:17)2(cid:27)
(cid:16)(cid:126)λ (m, t)

(cid:17)

(cid:26)

(cid:16)
(cid:107)(cid:126)λ(0,t)−(cid:126)λ∗(t)(cid:107)2
l +

Dmax+E(Nl)+

(cid:16)(cid:126)λ (m, t)
(cid:17)

2

P 2

σNl√
2

κ2L maxl

is the optimal value of (22) and ϕbest
is the best value of (22)
n,t
till now, (cid:126)λ (0, t) is the initial value of Lagrangian multiplier vector and (cid:126)λ∗ (t) is the optimal value vector.

ˆ= maxm∈{1,··· ,n} ϕm,t

The above lemma shows that the stepsize can be used to tradeoff convergence accuracy and speed. Due

to space limitation, the detailed proof can be found in [34].

The whole algorithm for the problem (cid:102)P1 is given in Fig. 3. At the beginning of time slot t, every entry

point uploads the energy demand arriving at them, and every charging station uploads the states of demand

queues and batteries, for the central controller to guide different PEVs to charge at different charging

19

Algorithm 2 Consumption From the Power Grid
Input: Hi(t), c(t), η−
Output: Dd
1: Let all λl = λmax.
2: while
3:
4:

(cid:12)(cid:12)(cid:12) ≥ ξ && n < M do

Compute new values of
if

−→
λ through (24).

λ(n) − φt|−→

i (t)

(cid:12)(cid:12)(cid:12)φt|−→

λ(n−1)

i (n,t) > 0 then

(cid:33)+

rij (t) − Ui (t)

5:
6:

7:

∂Λi

i (n,t) = ∂Λi
∂Db
i (n, t) = 0

(cid:32) Ji(cid:80)

j=1

∂Dd
Dd
else
Dd
end if
n = n + 1

i (n, t)=

8:
9:
10: end while
11: Dd

i (t) = Dd

i (n, t)

outlets. At the same time each node in the distribution network computes the Lagrangian multipliers as the

overload indication through (25) and broadcasts them to downstream charging stations. When receiving

the Lagrange multipliers, each charging station calculates the charging rate, the utilization of renewable

energy, and the energy consumption from the power grid.

V. PERFORMANCE ANALYSIS

Stability of battery dynamics and demand queues should be guaranteed in the above algorithms. Also

the performance gap between the proposed algorithm and the optimal one in solving P1 is given.

A. Stability of Queues

Theorem 1: All demand queues at every charging outlet are stable.

Proof: Since only one EV can be served by each outlet, Qij(t) ≤ Emax for all time slot t.

Remark 1: This inequality guarantees the worst delay for every PEV. By employing virtual queue as

[33], the length of worst delay can be calculated and limited easily.

Theorem 2: For any parameter V bounded between 0 < V ≤ Vmax at any time slot t , where

Vmax =

min{Bi,max}−η+Umax−η−Jrmax−Lλmax

Cmax

,

(26)

20

Tmax =V Cmax+Lλmax, Jmax =maxi{Ji}, the algorithm satisﬁes: 0≤Bi(t) ≤ Bimax. Before the proof of

Theorem 2, the following lemma is given ﬁrst.

Lemma 2: The energy management algorithm developed by solving P5 and P6 can ensure the fol-

lowing conditions, 1) If Bi (t)≥Bmax−η+Umax, then Ri (t)=0; 2) If Bi (t)≤η−Jiri max, then Dd
(cid:80)Ji
j=1(rij−Ui (t))+ .

i (t)=

Proof: If Bi (t)≥ Bmax−η+Umax, we have Bi(t)−(Jiri maxη−+(Bmax−η+Umax−η−Jrmax−Lλmax)+Lλmax)≥

0. Due to the deﬁnition of Vmax, it is obtained that Bi (t) − (Jiri maxη− + VmaxCmax + Lλmax) ≥ 0, i.e.,

Hi (t) > 0. Then we have Ri (t) = 0 according to the solution to P5.

we have Hi (t) < −(V Cmax+Lλmax), which results in Hi (t) < −V c(t)+(cid:80)
If Bi (t) ≤ η−Jiri max, we have Bi (t)− (η−Jiri,max+V Cmax+Lλmax) ≤ −(V Cmax+Lλmax). Then
(cid:80)Ji
j=1(rij−Ui (t))+ is obtained by solving P6.

. Thus, Dd

i (t) =

l:Xli=1
η−

λl(t)

Now we give the proof of Theorem 2.

Proof: The bound of Bi(t) will be proved by induction. At the beginning, the energy level of each

battery satisﬁes:

0 ≤ Bi(0) ≤ Bi,max.

a) When Tmax + η+Jiri,max ≤ Bi(t) ≤ Bi,max, Ri (t) = 0 holds according to the solution to P5. Then

Bi(t + 1) = Bi (t)−η−

rij (t)−Ui (t)

 Ji(cid:88)

j=1

b) When Hi(t) ≤ Tmax+η+Jiri,max, we have Ri (t) = min

is obtained that

Bi(t + 1) ≤ Bi (t) + η+Ri (t) < η−Jrmax + V Cmax + Lλmax + η+

−Dd

+
Rmax

i

,

≤ Bi (t)≤ Bi,max.
(cid:32)
Ui (t)− Ji(cid:80)

rij (t)

i (t)

(cid:33)+ . Therefore, it
+

rij (t)

j=1

Ui (t) − Ji(cid:88)

≤ η−Jrmax + V Cmax + Lλmax + η+Umax
≤ η−Jrmax + min{Bi,max} − η+Umax − η−Jrmax − Lλmax + Lλmax + η+Umax
≤ Bi,max,

j=1

(27)

21

where (27) is due to the deﬁnition of Vmax.
c) When 0 ≤ Bi (t) ≤ η−Jrmax, due to the second statement in Lemma 1, we have

 Ji(cid:88)

Dd

i (t) =

rij (t)−Ui (t)

+

,

j=1

which means that the i-th station uses grid energy to supply the charging request totally. Therefore, by

the dynamics of battery, we have

Bi(t + 1)≥ Bi (t)≥ 0.

d) When Bi (t) ≥ η−Jrmax, we have Ri (t) according to Lemma 1. Then we have

 Ji(cid:88)

+

≥ Bi (t)−η−Jrmax≥ 0.

Bi(t + 1) = Bi (t)−η−

rij (t)−Ui (t)

−Dd

i (t)

j=1

Thus for all time slot t, the conclusion in Theorem 2 stands.

Theorem 2 means that the constraint (5) is satisﬁed at every time slot although the proposed algorithm

in Fig. 3 solves (cid:102)P1. The maximum of Lagrangian multipliers (λmax) exists because the gradient method

in Algorithm 2 converges.

B. Asymptotic Performance

Before we state the performance of the proposed algorithm the following Lemma is needed.

Lemma 3: (stationary and randomized policy): If all Ek(t), Ui(t), c(t) are independent and identically

distributed (i.i.d.) over time slots, then taking all control decisions (cid:100)rij(t), (cid:100)Dd
i (t), and (cid:100)Ri(t) every time
slot t only as a function of current system state ω(t) = {Ek(t), Ui(t), c(t)|∀k∈K, ∀i∈I}, the constraints
mentioned in problem (cid:102)P1 are satisﬁed and the following properties stand:
(cid:111)
(cid:110)
η+ (cid:100)Ri (t)

 Ji(cid:88)

(28)

= E

E

,

η−

j=1

(cid:100)rij (t)− (cid:100)Ui (t)
E{c(t)

(cid:111)

+−E
(cid:110)
η− (cid:100)Dd
N(cid:88)
(cid:100)Dd
i (t)} = P ∗
re,

i (t)

(29)

re is the optimal value of problem (cid:102)P1, and the expectations are with respect to the stationary

where P ∗

i=1

distribution of ω(t) and randomized control decisions.

Proof: Similar policy is mentioned in the work of Fang et al. in [32]. and also proved by Neely et

al. in [21] and [30]. So it is omitted here.

Theorem 3: If Ek(t), Ui(t), c(t) are i.i.d. over slots, an upper bound for the time average expected

22

electricity cost under our algorithm can be obtained and the upper bound is as follows:

(cid:88)τ−1

t=0

lim
τ→∞

1
τ

I(cid:88)

i=1

E{c(t)

i (t)} ≤ P ∗ +
Dd

δmax
V

.

Proof: From (15), the following inequality is tenable:

i=1

(cid:52)(

Dd

I(cid:88)
−−→
i (t)]|−−→
θ(t))+V E{c(t)
 Ji(cid:88)
K(cid:88)
Hi (t) η−
 Ji(cid:88)

θ(t)}≤ δmax− I(cid:88)
Ek (t) Wk,ij (t) · 1{Qij (t)=0}
+

rij (t)−Ui (t)

−Dd

rij (t)

k=1

− I(cid:88)
− I(cid:88)

j=1

i=1

i=1

E

E

E

j=1

i=1

i (t)

j=1

 Ji(cid:88)
+
(cid:12)(cid:12)(cid:12)(cid:12)−−→
(cid:26)
I(cid:88)
 + VE
(cid:12)(cid:12)(cid:12)(cid:12)−−→

θ (t)

θ (t)

i=1

E

(cid:40)

rij (t) Qij (t) · 1{Qij (t)>0}

θ (t)


(cid:12)(cid:12)(cid:12)(cid:12)−−→
(cid:12)(cid:12)(cid:12)(cid:12)−−→
(cid:27)
(cid:41)
(cid:12)(cid:12)(cid:12)(cid:12)−−→

θ (t)

θ (t)

Hi (t) Ri (t) η+

I(cid:88)

i=1

c (t)

Dd

i (t)

(30)

,

since −Tmax−η−Jiri,max≤ Hi(t)≤ Bi,max−Tmax−η−Jiri,max and Bi,max > Tmax+η−Jiri,max.

Solutions to P3∼P6 are willing to minimize the R.H.S of (30) at each time slot t by choosing control

decisions among all feasible actions including the optimal one given in Lemma 1. Considering that the

−→
θ(t), substitute the optimal decisions

policy stated in Lemma 1 is independent on the queues vector

( (cid:100)rij(t), (cid:100)Dd
i (t), (cid:100)Ri(t)) and the conclusion of (28) and (29) in Lemma 1 into (30), and use P ∗
I(cid:88)
i (t)|−−→
−−→
θ(t)}
θ(t)) + V E{c(t)
(cid:52)(

−−→
(cid:26)
(cid:27)
I(cid:88)
− I(cid:88)
Hi (t) (cid:100)Ri (t)η+−−→
(cid:41)
(cid:12)(cid:12)(cid:12)(cid:12)−−→
I(cid:88)
(cid:100)Dd

Hi (t) η−
= δmax + V E{c(t) (cid:100)Dd

(cid:100)rij (t)− (cid:100)Ui (t)
θ(t)} = δmax+V P ∗

+
− (cid:100)Dd
re≤ δmax+V P ∗.

 Ji(cid:88)
i (t)|−→

≤δmax+
(cid:40)

re ≤ P ∗:

+V E

i (t)

i (t)

θ (t)

θ (t)

θ (t)

c (t)

Dd

j=1

i=1

i=1

i=1

E

E

i=1

Sum over t ∈ {0, 1, ..., τ − 1} , divide V τ on both sides, and let τ → ∞:

(cid:88)τ−1

t=0

lim
τ→∞

1
τ

I(cid:88)

i=1

E{c(t)

i (t)} ≤ P ∗ +
Dd

δmax
V

23

Fig. 4. A 19-bus bus test feeder.

holds due to the fact that E{L(

−−→
θ(τ ))} is nonnegative and E{L(

−−→
θ(0))} is ﬁnite.

Remark 2: It is noted that the performance gap between the proposed algorithm and the optimal one

for P1 can be decreased by an increasing V , which means the capacity of each battery should be increased

according to (26).

A. Simulation Setup

VI. SIMULATION

We evaluate our designed algorithms using Matlab on a 19-bus test feeder [35] shown in Fig. 4. The

system contains 50 entry points and 18 charging stations, each of which has three charging outlets.

All the parameters are set as follows except for other speciﬁcations. The capacity of each battery in

different stations is 500kWh. Let r1,max = ... = rI,max = 20kW, Umax = 225kW, Dd,max = 20kW, and

Emax = 30kWh. Assume the uncontrollable loads at each node follow gaussian distributions where the
expectation is E{Nl(t)} = 200kW, and the standard deviation is σNl = 100kW. PEVs charging requests

arrive to each entry points according to a geometric distribution with probability 0.9. The charging and
discharging efﬁciency parameters are ﬁrst assumed to be η− = η+ = 1. Real wind speed data are taken

from Alternative Energy Institute (AEI) [36], and converted to wind energy generation based on the power

Subtransmission NetworkS/Primary SS 132kVTR2-40MVA-145kV/11kVTR1-40MVA-145kV/11kVPrimary SS 11kV12345615789101112131416171819 24

Fig. 5. Wind power at charging station 7.

Fig. 6. Real-time market price.

curve of the Vestas V27 225 kW wind turbine. Fig. 5 shows one wind turbine’s generation data. Real-

time electricity price data are from Power Smart Pricing administered for Ameren Illinois [37], which is

shown in Fig. 6. Both of them are updating every one hour. By linear interpolation for electricity price

and spline interpolation for wind energy, the interval of these data is 10min, equal to the length of one

time slot. The total length of data is 60h.

B. Numerical Results

Fig. 7 illustrates the convergent values for the 8 batteries’ energy level under the proposed algorithm.

The values are approximately 450kWh, falling in the feasible region of batteries. The existence of

convergence for batteries’ energy level indicates that the charging and discharging power amounts are

roughly equal.

The probability of overload at node 7 in this distribution network is examined in Fig. 8. Different

values for permitted overload probability  are taken into account. This ﬁgure shows good performance

for “chance constraint” of the proposed algorithm. When the permitted overload probability is tiny, there is

almost no overload possibility for the total loads. Obviously, during 600min-800min, 2100min-2400min,

and 3300min-3600min, when the electricity price is low, there are some peaks at the corresponding node.

From Fig. 9, it is obvious that the system cost rises with respect to the increasing probability of

0300600900120015001800210024002700300033003600050100150Time (min)Wind Power Output (kW)030060090012001500180021002400270030003300360000.511.522.533.544.55Time (min)Electricity Price (cent per kWh)25

Fig. 7. Average energy level of each battery at steady state.

Fig. 8. Overload: comparison between two different possibilities.

Fig. 9. Time-average on-grid energy cost v.s. probability of PEVs request.

PEV’s arrival request at every entry point. Meanwhile, Fig. 9 also illustrates that the larger V is, the

less non-renewable energy cost is incurred, which conﬁrms the asymptotically optimal performance of

the proposed algorithm shown in Theorem 3. It is also observed that a lower charging efﬁciency incurs

a slightly higher system cost, since the degraded renewable energy utilization results in more on-grid

energy consumption.

For comparison, we consider the charging guidance algorithm in [38]. Speciﬁcally, the charging

guidance designed in [38] is aimed to optimize the load balance of charging stations and minimize

the system waiting time for charging. For fair comparison, we assume the following adapted algorithm

consisting of the charging guidance in [38] and the energy management in this paper. At each time slot,

123456780100200300400500600Number of batteriesAverage energy level of each battery at steady state (kWh)030060090012001500180021002400270030003300360014001600180020002200Time (min)Power (kW)  Capacity of Node 7Real Load with ε = 0.01Real Load with ε = 0.10.40.50.60.70.80.9111.522.533.5Probability of PEV requestTime−average cost ($)  V=0.8Vmax,η+=0.8V=0.8Vmax,η+=1.0V=0.9Vmax,η+=0.8V=0.9Vmax,η+=1.026

the adapted algorithm in [38] is described as follows:

Given the overall charging request γ, the optimal charging request allocated to each charging station

γi can be calculated based on the solution to a waiting time minimization problem, which considers the

coupling among charging stations. Then, the new charging request is guided to the corresponding charging

station with probability γi/γ. For energy usage, the needed energy for minimizing system waiting time

is supplied by renewable generator ﬁrstly, and the remaining renewable energy is stored in the battery

with the feasibly largest proportion. Otherwise, if the renewable energy is insufﬁcient, the stored energy

is used. If the energy is still in shortage, the on-grid energy ﬁlls the gap.

A greedy algorithm is also proposed for comparison. At each time slot, if there is at least one idle outlet,

the PEV will be guided to an idle outlet in the station that has the most residual energy in the storage

device. While the charging rate is always fulﬁlled by the maximum value given that the distribution

network constraint is satisﬁed.

Fig. 10 shows the comparison of the time-average non-renewable energy cost among the three algo-

rithms. It is found that the system time average cost of the three algorithms decreases as enlarging battery

size, since larger batteries can store more renewable energy. In general the cost achieved by the designed

algorithm is the smallest no matter with different battery charging efﬁciency since it can utilize the time

diversity of electricity price to absorb on-grid energy.

Fig. 11 illustrates that the average waiting time2 under the three algorithms. The average waiting

time of the proposed algorithm grows as Bmax increasing till 500kWh since small battery can store

some renewable energy and admit some PEVs into the system but its residual value is not engough to

charge PEVs with full rate mostly. Considering that the energy obtained from the grid will increase the

system cost, the proposed algorithm chooses to charge PEVs with lower average rate and thus longer

2Waiting time is deﬁned as the period, beginning with a PEV’s request accepted by an outlet and ending with its demand totally satisﬁed,

divided by the amount of its request.

27

Fig. 10. Time-average on-grid energy cost v.s. battery capacity.

Fig. 11. Waiting time v.s. battery capacity.

Fig. 12. Time-average on-grid energy cost v.s. renewable energy rate.Fig. 13. Waiting time v.s. renewable energy rate.

waiting time. However, if the battery size is large enough, the average waiting time descends as battery

capacity increasing. For the greedy algorithm and the adapted algorithm in [38], the waiting time is

almost independent of the battery size, since these two algorithms charge PEVs with available residual

energy in battery, otherwise it charges PEVs with on-grid energy directly. It should be noted that the

waiting time of the adapted algorithm in [38] is the smallest due to its optimal objective aiming at it.

Thus, it can be concluded that the proposed algorithm can result in quicker charging service with less

cost if the battery in each station is large enough.

We further evaluate the effects of average renewable energy generation rate on the time-average cost

and waiting time in Fig. 12 and Fig. 13, respectively. The similar pattern is found in Fig. 12 as in Fig. 10,

except that the time-average cost of the proposed algorithm decreases faster as the increase of renewable

4904955005055105155200.511.522.533.544.555.5Battery capacity (kWh)Time−average cost ($)  Proposed algorithm,η+=1.0Adapted algorithm in [36],η+=1.0Greedy algorithm,η+=1.0Proposed algorithm,η+=0.8Adapted algorithm in [36],η+=0.8Greedy algorithm,η+=0.84005006007008009001000567891011121314Battery capacity (kWh)Waiting time (min/kWh)  Proposed algorithm,η+=1.0Greedy algorithm,η+=1.0Adapted algorithm in [36],η+=1.0Proposed algorithm,η+=0.8Greedy algorithm,η+=0.8Adapted algorithm in [36],η+=0.8606570758085900.511.522.533.5Average renewable energy generation rate (kW)Time−average cost ($)  Proposed algorithm,η+=1.0Adapted algorithm in [36],η+=1.0Greedy algorithm,η+=1.0Proposed algorithm,η+=0.8Adapted algorithm in [36],η+=0.8Greedy algorithm,η+=0.86065707580859055.566.577.58Average renewable energy generation rate (kW)Waiting time (min/kWh)  Proposed algorithm,η+=1.0Greedy algorithm,η+=1.0Adapted algorithm in [36],η+=1.0Proposed algorithm,η+=0.8Greedy algorithm,η+=0.8Adapted algorithm in [36],η+=0.8energy generation rate. This is due to that the generated renewable energy is utilized directly and then

the residual is charged into storage for future use. Thus, more on-grid energy is saved than in the case

of Fig. 10 for our design. Due to the same reason, it is found in Fig. 13 that the average waiting of our

algorithm behaves better than the greedy one after a threshold generation rate.

28

VII. CONCLUSION

This paper considers the dynamic charging problem for PEVs in a distribution network, which consists

of multiple charging stations and uncontrollable non-EV loads. Each charging station can supply random

arrival PEVs with energy from local renewable energy generator directly, the storage device or the distri-

bution network. In order to cut down the on-grid energy cost and avoid overload risk in lines/transformers,

Lyapunov optimization and chance constraints are utilized to develop dynamic charging guidance for PEVs

and energy management scheme for stations with inefﬁcient storage device. The proposed algorithm does

not rely on the statistics of underlying processes but has provable performance. Simulation results with

real wind and electricity price proﬁles are provided to show that the proposed algorithm can achieve

lower cost with comparable waiting time compared with peer work and a greedy algorithm.

REFERENCES

[1] T. Trigg, P. Telleen, R. Boyd, F. Cuenot, D. DAmbrosio, R. Gaghen, M. Wrake, “Global EV Outlook: Understanding the Electric

Vehicle Landscape to 2020,” IEA, Paris, France, Apr. 2013.

[2] W. Su, H. Eichi, W. Zeng, M. Y. Chow, “A survey on the electriﬁcation of transportation in a smart grid environment,” IEEE Trans.

Ind. Informat., vol. 8, no. 1, pp. 1-10, Jan. 2012.

[3] C. Wu, H. Mohsenian-Rad, J. Huang, “Vehicle-to-Aggregator Interaction Game,” IEEE Trans. Smart Grid, vol. 3, no. 1, pp. 434-442,

Mar. 2012.

[4] Z. Darabi, M. Ferdowsi, “An Event-Based Simulation Framework to Examine the Response of Power Grid to the Charging Demand of

Plug-In Hybrid Electric Vehicles,” IEEE Trans. Ind. Informat., vol. 10, no. 1, pp. 313-322, Feb. 2013.

[5] Y. Wu, X. Tan, L. Qian, et al. “Optimal Pricing and Energy Scheduling for Hybrid Energy Trading Market in Future Smart Grid,” IEEE

Trans. Ind. Informat., vol. 11, no. 6, pp. 1585-1596, Dec. 2015.

[6] S. He, J. Chen, F. Jiang, D.K. Yau, G. Xing, Y. Sun, “Energy Provisioning in Wireless Rechargeable Sensor Networks,” IEEE Trans.

Mobile Computing, vol.12, no. 10, pp. 1931-1942, Oct. 2013.

29

[7] http://www.ugei.com/case study/enterprise/ev charging.
[8] W. Tushar, C. Yuen, S. Huang, D.B. Smith, H.V. Poor, “Cost Minimization of Charging Stations with Photovoltaics: An Approach with

EV Classiﬁcation,” IEEE Trans. Intell. Transportation Syst., vol. 17, no. 1, pp. 156-169, Jan. 2016.

[9] N. Rahbari-Asr, M.Y. Chow, Z. Yang, J. Chen, “Network cooperative distributed pricing control system for large-scale optimal charging

of PHEVs/PEVs,” in Industrial Electronics Society, IECON 2013-39th Annual Conference of the IEEE. IEEE, 2013, pp. 6148-6153.

[10] O. Ardakanian, S. Keshav, C. Rosenberg, “Real-Time Distributed Control for Smart Electric Vehicle Chargers: From a Static to a

Dynamic Study,” IEEE Trans. Smart Grid, vol. 5, no. 7, pp. 1937-1947, 2015.

[11] A. Ghavami, K. Kar, S. Bhattacharya, A. Gupta, “Price-driven charging of Plug-in Electric Vehicles: Nash equilibrium, social optimality
and best-response convergence,” in Information Sciences and Systems (CISS), 2013 47th Annual Conference on. IEEE, 2013, pp. 1-6.
[12] A. Safdarian, M. Fotuhi-Firuzabad, M. Lehtonen, “A Distributed Algorithm for Managing Residential Demand Response in Smart

Grids,” IEEE Trans. Ind. Informat., vol.10, no. 4, pp. 2385-2393, Nov. 2014.

[13] F. de Angelis, M. Boaro, D. Fuselli, S. Squartini, F. Piazza, Q. Wei, “Optimal Home Energy Management Under Dynamic Electrical

and Thermal Constraints,” IEEE Trans. Ind. Informat., vol. 9, no. 3, pp. 1518-1527, Aug. 2013.

[14] J. Xu, Y. Zou, Y. Niu, “Multi-time scale hierarchical predictive control for energy management of microgrid system with smart users,”,

Proc. the 26th Chinese Control and Decision Conference (2014 CCDC), pp. 3055-3060, 2014.

[15] K. Ma, G. Hu, C. J. Spanos, “Distributed Energy Consumption Control via Real-Time Pricing Feedback in Smart Grid,” IEEE Trans.

Control Syst. Technol., vol. 22, no. 5, pp. 1907-1914, Sept. 2014.

[16] Z. Yang, L. Sun, M. Ke, Z. Shi, J. Chen, “Optimal charging strategy for plug-in electric taxi with time-varying proﬁts,” IEEE Trans.

Smart Grid, vol. 5, no. 6, pp. 2787-2797, 2014.

[17] B. Saovapakhiran, G. Michailidis, M. Devetsikiotis, “An algorithm for joint guidance and power control for electric vehicles in the

smart grid,” in Communications (ICC), 2012 IEEE International Conference on. IEEE, 2012, pp. 3328-3334.

[18] M. Wang, H. Liang, R. Zhang, R. Deng, X. Shen, “Mobility-Aware Coordinated Charging for Electric Vehicles in VANET-Enhanced

Smart Grid,” IEEE J. Sel. Areas Commun., vol. 32, no. 7, pp. 1344-1360, Jul. 2014.

[19] S. Misra, S. Bera, T. Ojha. “D2P: Distributed Dynamic Pricing Policy in Smart Grid for PHEVs Management,” IEEE Trans. Parallel

Distrib. Syst., vol. 26, no. 3, pp. 702-712, 2015.

[20] J. Li, Y. Bo, X. Yang, C. Chen, X. Guan, W. Zhang, “Scheduling of Electric Vehicle Charging Request and Power Allocation at

Charging Stations with Renewable Energy,” in Control Conference (CCC), 2014 33rd Chinese, Nanjing, China, Jul. 2014.

[21] L. Georgiadis, M. J. Neely, L Tassiulas, “Resource allocation and cross-layer control in wireless networks,”Found. and Trends in

Networking, vol. 1, no. 1, pp. 1-149, 2006.

[22] M. J. Neely, A. S. Tehrani, A. G. Dimakis, “Efﬁcient algorithms for renewable energy allocation to delay tolerant consumers,” in

Smart Grid Communications (SmartGridComm), 2010 First IEEE International Conference on. IEEE, 2010, pp. 549-554.

[23] L. Yu, T. Jiang, Y. Cao, Q. Qi, “Joint Workload and Battery Scheduling with Heterogeneous Service Delay Guarantees for Data Center

Energy Cost Minimization,” IEEE Trans. Parallel Distrib. Syst., vol. 26, no. 7, pp. 1937-1947, 2015.

[24] W. Deng, F. Liu, H. Jin, C. Wu, X. Liu, “MultiGreen: Cost-Minimizing Multi-source Datacenter Power Supply with Online Control,”

Proceedings of the fourth international conference on Future energy systems, 2013, pp. 149-160.

[25] S. Chen, N. B. Shroff, P. Sinha, “Heterogeneous Delay Tolerant Task Scheduling and Energy Management in the Smart Grid with

Renewable Energy,” IEEE J. Sel. Areas Commun., vol. 31, no. 7, pp. 1258-1267, Jul. 2013.

[26] G. A. Shah, V. C. Gungor, O. B. Akan, “A Cross-Layer QoS-Aware Communication Framework in Cognitive Radio Sensor Networks

for Smart Grid Applications,” IEEE Trans. Ind. Informat., vol, 9, no. 3, pp. 1477-1485, Aug. 2013.

[27] T. Zhang, W. Chen, Z. Han, Z. Cao, “Charging Scheduling of Electric Vehicles with Local Renewable Energy under Uncertain Electric

Vehicle Arrival and Grid Power Price,” IEEE Trans. Veh. Technol., vol. 63, no. 6, pp. 2600-2612, Jul. 2014.

30

[28] S. Maharjan, Q. Zhu, Y. Zhang, S. Gjessing, “Dependable demand response management in the smart grid: A stackelberg game

approach,” IEEE Trans. Smart Grid, vol. 4, no. 1, pp. 120-132, Mar. 2013.

[29] S. Sun, M. Dong, B. Liang, “Real-time welfare-maximizing regulation allocation in dynamic aggregator-EVs system,” IEEE Trans.

Smart Grid vol. 5, no. 3, pp. 1397-1409, 2014.

[30] M. J. Neely, “Stochastic Network Optimization with Application to Communication and Queueing Systems,” Synthesis Lectures on

Commun. Networks, vol. 3, no. 1, pp. 1-211, 2010.

[31] P. Tarasak, “Optimal real-time pricing under load uncertainty based on utility maximization for smart grid,” in Smart Grid

Communications (SmartGridComm), 2011 IEEE International Conference on. IEEE, 2011, pp. 321-326.

[32] Y. Guo, M. Pan, Y. Fang, “Optimal power management of residential customers in the smart grid,” IEEE Trans. Parallel Distrib. Syst.,

vol. 23, no. 9, pp. 1593-1606, Sept. 2012.

[33] C. Jin, X. Sheng, P. Ghosh, “Optimized Electric Vehicle Charging With Intermittent Renewable Energy Sources,” IEEE J. Sel. Topics

Signal Process., vol. 8, no. 6, pp. 1063-1072, Dec. 2014.

[34] S. Boyd, M. Almir, “Subgradient methods,” Lecture notes of EE364b, Stanford University, Winter Quarter 2007 (2006).
[35] K. Yunus, M.R. Jemal, and K. Srivastava, “Impacts of stochastic residential plug-in electric vehicle charging on distribution grid.”

Proc. IEEE Innovative Smart Grid Technologies (ISGT), 2012.

[36] Alternative Energy Institute Wind Test Center, online. Available: http://www.windenergy.org/datasites/0000-aeiwtc/.
[37] Power Smart Pricing served by Ameren Illinois, online. Available: http://www.powersmartpricing.org/prices/.
[38] D. Ban, Michailidis, G. M. Devetsikiotis, “Demand response control for PHEV charging stations by dynamic price adjustments,” Proc.

IEEE Innovative Smart Grid Technologies (ISGT), 2012 IEEE PES, pp. 1-8, Jan. 2012.

