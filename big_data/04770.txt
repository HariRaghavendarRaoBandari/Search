6
1
0
2

 
r
a

 

M
5
1

 
 
]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[
 
 

1
v
0
7
7
4
0

.

3
0
6
1
:
v
i
X
r
a

Mixed-Hybrid and Vertex-Discontinuous-Galerkin Finite Element
Modeling of Multiphase Compositional Flow on 3D Unstructured

Grids

Joachim Moortgat

School of Earth Sciences, the Ohio State University, Columbus, Ohio, USA.

Abbas Firoozabadi

Reservoir Engineering Research Institute, Palo Alto, CA 94301, USA.

Department of Chemical and Environmental Engineering,Yale University, New Haven, CT

Abstract

Problems of interest in hydrogeology and hydrocarbon resources involve complex heterogeneous

geological formations. Such domains are most accurately represented in reservoir simulations by

unstructured computational grids. Finite element methods accurately describe ﬂow on unstruc-

tured meshes with complex geometries, and their ﬂexible formulation allows implementation on

diﬀerent grid types. In this work, we consider for the ﬁrst time the challenging problem of fully

compositional three-phase ﬂow in 3D unstructured grids, discretized by any combination of tetra-

hedra, prisms, and hexahedra. We employ a mass conserving mixed hybrid ﬁnite element (MHFE)

method to solve for the pressure and ﬂux ﬁelds. The transport equations are approximated with a

higher-order vertex-based discontinuous Galerkin (DG) discretization. We show that this approach

outperforms a face-based implementation of the same polynomial order. These methods are well

suited for heterogeneous and fractured reservoirs, because they provide globally continuous pressure

and ﬂux ﬁelds, while allowing for sharp discontinuities in compositions and saturations. The higher-

order accuracy improves the modeling of strongly non-linear ﬂow, such as gravitational and viscous

ﬁngering. We review the literature on unstructured reservoir simulation models, and present many

examples that consider gravity depletion, water ﬂooding, and gas injection in oil saturated reser-

voirs. We study convergence rates, mesh sensitivity, and demonstrate the wide applicability of our

chosen ﬁnite element methods for challenging multiphase ﬂow problems in geometrically complex

subsurface media.

Keywords: unstructured 3D grids, higher-order, compositional, compressible, multiphase ﬂow,

Discontinuous Galerkin, Mixed Hybrid Finite Elements, SPE 10, Egg model

Email address: moortgat.1@osu.edu (Joachim Moortgat)
c(cid:13) 2016.

This manuscript version is made available under the CC-BY-NC-ND 4.0 license http://

creativecommons.org/licenses/by-nc-nd/4.0/

Preprint submitted to Journal of Computational Physics

March 16, 2016

1. Introduction

Subsurface geological formations generally have complex geometries that require highly ﬂexible

meshing for accurate representation. Structured (or logically Cartesian) grids may not accurately

describe many subsurface problems in hydrogeology and the recovery of hydrocarbon resources.

They are also not well suited to model radial ﬂow near wells, and results from commercial simulators

may not converge in the near-well region [1].

The most commonly used numerical method to model ﬂow on structured grids is the ﬁnite

diﬀerence (FD) approach, while ﬁnite volume (FV) methods are usually adopted for unstructured

grids.

In their lowest-order form, both assume element-wise constant scalar variables (such as

saturations) and use a two-point ﬂux approximation (TPFA) to compute vectors (ﬂuxes) from

(pressure) gradients between two points. It is well known that such lowest-order approximations

suﬀer from excessive numerical dispersion, and grid sensitivity. The former can be reduced through

‘brute force’ by signiﬁcantly reﬁning the mesh, which is made more feasible by the development of

massively parallelized simulators in the industry [2]. However, suﬃcient mesh reﬁnement is often not

feasible when modeling ﬂow in ﬁeld-scale hydrocarbon reservoirs or aquifers. Grid sensitivity cannot

be resolved by mesh reﬁnement. Speciﬁcally, it is well known that the TPFA may not converge

unless the grid is K-orthogonal [3, 4]. Recently, signiﬁcant improvements have been made to the

FV approach, for instance to accommodate the full permeability tensor [5, 6, 7, 8, 9, 10, 11, 12, 13]

and fractures [14, 15, 16]. To improve FD ﬂux computations on general grids and with tensor

permeability, the multipoint ﬂux approximation (MPFA) was introduced.

In MPFA, ﬂuxes are

reconstructed from the pressures in multiple surrounding elements [17, 18, 19, 20, 21, 6, 22, 23],

similar to the stencil of a standard continuous Galerkin discretization. Several ﬂavors of MPFA

have been proposed since the original version [23, 24, 8, 9, 24, 25, 26]. MPFA has been compared

to the Vertex Approximate Gradient scheme [27] and to BDM1 space under numerical quadrature

[24, 25].

The last category of numerical ﬂow models rely on ﬁnite elements (FE). FE are the method

of choice in many disciplines in science and engineering that involve unstructured grids. The FE

methods that we adopt in this work are motivated by two essential physical properties of ﬂow

through porous media: 1) pressures and ﬂuxes are continuous, even across layers and fractures,

while 2) ﬂuid properties are often discontinuous across phase boundaries, fractures, and layers.

In light of the latter realization, we adopt the discontinuous Galerkin (DG) method for the

mass transport update. DG is strictly mass conserving at the element level.

In higher-order

DG, compositions or saturations can be updated at all vertices or faces and the values can be

discontinuous across faces. This is particularly useful in fractured or layered reservoirs. In this work,

2

we employ a multi-linear DG approximation as a compromise between higher-order convergence

versus the number of phase-split computations that have to be carried out at each degree-of-freedom.

Many ﬂavors of DG have been analyzed in terms of error estimates and convergence properties, and

it is hard to do justice to the full scope of this work (the following papers provide an overview of

pioneering and recents eﬀorts in the analysis of DG methods: [28, 29, 30, 31, 32, 33, 34, 35, 36, 37,

38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52]).

We use a mixed-hybrid ﬁnite element (MHFE) to satisfy the second aforementioned physical

property: that both pressure and ﬂux ﬁelds are continuous everywhere. MHFE simultaneously

and to the same order of accuracy solves for globally continuous pressure and ﬂux ﬁelds [53, 54,

33, 55, 56, 57]. The high accuracy in the velocity ﬁeld in highly heterogeneous and/or anisotropic

domains is the main attraction of the MHFE method. Computing the pressures on element faces is

also convenient when modeling capillarity and fractured reservoirs. Unlike some FE methods, the

MHFE-DG combination is strictly mass conserving at the element level.

A comparison between MFE and MPFA was presented in Matringe et al. [24] for single-phase

incompressible ﬂow without gravity. Hoteit and Firoozabadi [58] and [59] compared MHFE-DG to

the traditional TPFA-FD approach in a commercial simulator, and to an equal-order MUSCL FV

scheme, respectively. Both MPFA [60] and MHFE [61] ﬂux approximations have been presented on

unstructured 3D grids for two-phase incompressible ﬂow. However, to the best of our knowledge,

neither method has been investigated for unstructured 3D grids and (EOS-based) compositional

and compressible multiphase ﬂow with gravity, which is the subject of this work. We emphasize that

the latter problem is governed by a diﬀerent set of equations which involve the highly non-linear

total compressibility and total partial molar volumes of multicomponent multiphase mixtures.

Based on this discussion, we adopt an implicit-pressure-explicit-composition (IMPEC) scheme

with a higher-order DG explicit mass transport update and a MHFE implicit pressure and ﬂux

update. This MHFE-DG scheme was explored for single-phase compressible compositional ﬂow

in fractured media in Hoteit and Firoozabadi [58], and generalized to two-phase compositional

ﬂow in homogenous [62] and fractured domains [63], all on structured 2D grids; and to two-phase

immiscible and incompressible ﬂow with capillarity on 3D unstructured grids in [64]. More recently,

MHFE-DG has been applied to problems of increasing complexity and non-linearity: three-phase

ﬂow with an immiscible aqueous phase [65], three fully compositional multicomponent hydrocarbon

phases or two hydrocarbon phases and a compositional aqueous phase modeled by the cubic-plus-

association (CPA) equation-of-state (EOS) [66, 67]. Fickian diﬀusion, three-phase capillarity, and

discrete fractures were modeled in 3D in Moortgat et al. [68], Moortgat and Firoozabadi [69, 70].

Our past studies of compositional multiphase ﬂow have been restricted to structured grids. The

objective of this work is to unleash the full potential of our FE methods by moving to unstructured

3

grids and allowing for all types of commonly used elements: triangles and quadrilaterals in 2D, and

hexahedra, prisms, and tetrahedra in 3D. One other improvement is that we consider vertex-based

DG discretizations rather than face-based (which requires a diﬀerent slope-limiter [53, 64]). The

superiority of this approach is demonstrated in one of the numerical examples.

We brieﬂy summarize our mathematical fractional ﬂow formulation in Section 2. In Section 3

we discuss the MHFE-DG implementation on unstructured grids. The numerical experiments in

Section 4 are a main focus of this work. First, we model the recovery of hydrocarbon energy resources

by three important processes (gravity depletion, water ﬂooding, and compositional CO2 injection)

from a 3D reservoir discretized by 5 diﬀerent structured and unstructured hexahedral, prismatic and

tetrahedra grids. This example shows that we obtain the same results irrespective of grid-types for

a wide range of multiphase processes that exhibit counter-current ﬂow and phase behavior. Other

sets of examples investigate grid sensitivity, anisotropic domains, and the convergence properties of

the MHFE-DG method on structured and unstructured grids. The last example considers realistic

petrophysical properties from the benchmark ‘SPE Tenth Comparative Solution Project’ [71], and

‘Egg Model’ [72, 73]. We end with a brief summary of our ﬁndings.

2. Mathematical Model

2.1. Fluid and Formation Description and Notation

We consider multicomponent multiphase ﬂow through porous media. The porous medium is

characterized by an absolute permeability tensor K, porosity φ, tortuosity τ , and formation com-

pressibility Cr. The ﬂuid mixtures consist of nc components, labeled by index i, and each species

can transfer between up to three phases α = α1, α2, α3. The overall molar density of species i

in the mixture is ci = czi in terms of the overall molar density c and overall molar composition

zi. Similarly, ci,α = cαxi,α is the molar density of species i in phase α, and cα and xi,α are the

phase molar density and composition. Molar and mass densities (ρα) are related through the molar

(cid:80)

weights Mi: ρα = cα

i Mixi,α. Phase saturations are indicated by Sα.

Phase compositions xi,α and molar fractions are found from phase stability analyses and phase

split computations, based on a given total composition zi, temperature T and pressure p. The

phase-splits are based on the Peng-Robinson (PR) EOS [74] for hydrocarbon phases, and a cubic-

plus-association (CPA) EOS [67] for mixtures that contain polar component such as water. The

basic algorithm is described in Appendix A.

4

2.2. Governing Equations

In terms of the above deﬁnitions of ﬂuid and formation properties, we can write the species

transport, or material balance, equations as

φ

∂ci
∂t

+ ∇ · Ui = Fi,

i = 1, . . . , nc,

(1)

in which Fi represent sinks (production wells) or sources (injection wells) of species i. Ui are the

total molar velocities of each species i. Ui consists of convective Darcy phase velocities uα and

diﬀusive (species) phase velocities Ji,α:

(cid:88)

Ui =

(ci,αuα + f (φ, τ )SαJi,α) ,

i = 1, . . . , nc.

(2)

α

The factor f (φ, τ ) is a modiﬁcation from open space diﬀusion to account for the reduction in

available ﬂow paths due to rock porosity and tortuosity.

In this work, we focus on the MHFE

discretization of the Darcy velocity on diﬀerent types of 2D and 3D unstructured grids and omit

diﬀusion from the equations for clarity of presentation. Fickian diﬀusion is modeled similar to

Moortgat and Firoozabadi [75, 76], and is included in the example in Section 4.6.2. Similarly, we

refer to [69] for a discussion on capillarity and neglect the capillary pressure here in the Darcy

relation for the convective phase velocities:

uα = −λαK(∇p − ραg), α = α1, . . . , α3

in which g is the gravitational vector and λα = λα(Sα) is the phase mobility.

We use an explicit equation for the pressure ﬁeld [77, 78]:

nc(cid:88)

i=1

ζ

∂p
∂t

+

¯vi(∇ · Ui − Fi) = 0,

where ζ = φ(Cr + Cf ), and Cf and ¯vi are, respectively, the total compressibility and total par-

tial molar volumes of the three-phase ﬂuid mixture (derived in [66]). We adopt a fractional ﬂow

formulation in terms of the total velocity ut:

in which λt = (cid:80)

α λα and ρt = (cid:80)

ut = −λtK (∇p − ρtg) ,

α ραfα with fα = λα/λt the fractional ﬂow functions. The
main advantages of the fractional ﬂow formulation are that (5) can be readily inverted in favor of
the pressure (λt > 0, while λα ≥ 0), and that we only solve directly for one velocity ﬁeld. More
speciﬁcally, in the next section we describe our MHFE method to simultaneously solve (5) for the

total velocity and (4) for the pressure.

The phase velocities are reconstructed from ut by

uα = fα (ut + Gα) ,

Gα =

(cid:88)

α(cid:48)

λα(cid:48)K(ρα − ρα(cid:48))g,

5

(3)

(4)

(5)

(6)

(7)

in which the prime notation denotes independent phase indices α and α(cid:48). Gravity (and capillarity)
can drive counter-current ﬂow, which causes complications in ﬁnding the upwind values of λα(cid:48),

which were resolved in earlier work [66].

3. MHFE-DG on 3D Unstructured Grids

In this section we discuss the IMPEC discretization of our mathematical model through higher-

order ﬁnite element methods. First, we provide the FE basis (vector) functions for scalar and

vector quantities (Section 3.1) and then we summarize the MHFE discretization of the velocity

(5) and pressure (4) equations (Section 3.2) and species transport (1) (Section 3.3). Details have

been presented in our earlier work [70].

In these sections we mainly emphasize the coeﬃcient

matrices that depend on mesh geometry. Appendix B provides the complete expressions for the

DG discretization on all grid types.

area |E|, such that the boundary of K is ∂K =(cid:80)

The domain is discretized by elements K with volume |K|, which have faces E with surface
E |E|. We label the (local) vertices inside each
element by N , and denote the total number of elements, faces, and nodes by NK, NE, and NN ,

respectively. The coordinate vector is deﬁned as x = (x, y, z)T .

3.1. Finite Element Bases

In FE discretizations, scalars and vectors are decomposed in terms of appropriately deﬁned

basis functions ϕ(x) and basis vector ﬁelds w(x), respectively. Diﬀerential equations are put in the

weak form by integrating over each grid cell K. The number and choice of basis (vector) functions

depend on the number of degrees-of-freedom (DOF) associated with the order of the method. In

our MHFE-DG approach, the scalar state variables are evaluated at the vertices (nodes) by a multi-

linear DG approximation, while the velocity vector ﬁeld is evaluated across element faces in the

MHFE discretization. The corresponding DOF are illustrated in Figures 1-5.

Note that while for a continuous higher-order method, such as continuous Galerkin, a single

value is updated for each vertex in the domain, for our discontinuous Galerkin method the DOF

are the nodes inside each element and properties can be discontinuous across edges. This means

that for hexahedra, for instance, eight values (e.g. for compositions) are updated at each vertex,

one for each of the eight elements sharing that vertex. Physically, this is a desirable feature when

discontinuities occur on grid faces, e.g. at layer or fracture-matrix interfaces, while mathematically

this gives one the freedom to use diﬀerent orders of approximations in each grid cell (because the

interpolations do not have to conform at the grid boundaries). Pressures and ﬂuxes, on the other

hand, are required to be continuous across edges to satisfy the physical constraints of the problem.

6

(cid:88)
(cid:88)

N

We expand ci(t, x) (and ci,α(t, x)) and ut(t, x) (and uα(t, x) and g(x)) as:

ci(t, x) =

ut(t, x) =

(ci)N (t)ϕN (x),

qE(t)wE(x),

(8)

(9)

where the coeﬃcients (ci)N are the species molar densities at the vertices N , and qE is the total

E

ﬂux across faces E.

3.2. MHFE Pressures and Fluxes

To ﬁnd the MHFE discretization of the Darcy law for the total velocity, we expand ut as in (9),

multiply (5) by a test function, which we choose to be the same as the basis vector ﬁelds wE, and

integrate over elements K. The result is

qK,E = θK,EpK − (cid:88)
K p and tpK,E =(cid:82)

E(cid:48)∈∂K

in which pK =(cid:82)

βK,E,E(cid:48)tpK,E(cid:48) − γK,E, E ∈ ∂K,

(10)

Gauss’ theorem, and the coeﬃcients are deﬁned (with dx the volume increment) as:

E∈∂K p follow from partial integration of the divergence term by

(cid:20)(cid:90)

K

(cid:88)

(cid:21)−1

βK,E,E(cid:48) = λt,K

wK,EK−1

K wK,E(cid:48) dx

βK,E,E(cid:48),

θK,E =
γK,E = −λt,Kρt,KK(g · nE)|E|.

E(cid:48)

,

(11)

(12)

(13)

Detailed derivations can be found in [70]. The MHFE discretization of the pressure equation

proceeds along the same lines. We multiply (4) by wE, expand the phase velocities in Ui in

terms of the total velocity using (6), integrate over each element K, and adopt a backward Euler

discretization of the time derivative (indexed by superscript n). The ﬁnal expression for the pressure

evolution is:

×

˜αK∆t + ζK

pn+1
K =

(cid:40)

×

ζK
∆t

pn
K +

∆t

(cid:88)

E∈∂K

˜βK,Etpn+1

K,E + ˜γK +

(cid:41)

¯νi,KFi,K

(14)

(cid:88)

i

in which ˜αK, ˜βK,E and ˜γK are essentially multiplications of (11)–(13) by the partial molar volumes

and phase mobilities and densities, without additional dependencies on the geometry. In our hy-

bridized MHFE approach, a Schur decomposition is performed that leaves the pressure traces on

faces as primary variables. The sparsity pattern involves for each row (corresponding to a face)

all the faces of the neighboring two elements. Cell-centered pressures and ﬂuxes are obtained by

computationally inexpensive back-substitution. Details of the derivations are provided in [70, 79].

7

The purpose of this brief reiteration of our MHFE method is to demonstrate the elegance with

which the method can be generalized from Cartesian grids to any type of unstructured partitions.

The only diﬀerence between diﬀerent grid types is in the integral over permeability in (11), and the

normal components of gravity with respect to element faces in (13). Both these terms are time-

independent and only have to be evaluated once in the initialization of a simulation on a particular

grid. Once the geometrical coeﬃcients in (11) and (13) are given, the MHFE computation of the

pressures and ﬂuxes at each time-step is identical for all grid types.

3.3. DG Species Transport

The DG discretization of the transport equation is similar: (1) is put into weak form by multi-

plying by test functions ϕN and integrating by parts over each element K. The time derivative is

discretized by a forward Euler method. Using standard calculus, the derivatives over the unknown

phase properties are changed into derivatives of the known basis functions, which results in the

following discretized transport equation (with ds the surface increment):

(cid:88)
(cid:20)

N

(ci)n+1

(cid:90)

K,N − (ci)n
(cid:90)
∆t/φK

(cid:88)
ϕN wE · ∇ϕN(cid:48) dx − ((cid:103)ci,α)n

ϕN ϕN(cid:48) dx =

K,N

K

N

(cid:88)

α

(cid:88)
(cid:90)

E

(ci,α)n

K,N

K

(cid:90)

qα,K,E ×

(cid:21)

K,E,N

|E|

E∈∂K

ϕN ϕN(cid:48) ds

+(Fi)n
K

in which ((cid:103)ci,α)K,E,N are the upstream values of ci,α at all the vertices of face E with respect to the

K

ϕN(cid:48) dx

(15)

phase ﬂux qα,K,E through E (this deﬁnes the numerical ﬂux in our DG discretization and guarantees

its continuity). Appendix B provides the explicit algebraic expressions from working out (15) for

all grid types considered in this work, i.e. triangles, rectangles, tetrahedra, prisms, and hexahedra.

These expressions can be readily implemented in any reservoir simulator and should facilitate the

popularization of the Discontinuous Galerkin mass transport update for non-trivial unstructured

3D grids.

An important advantage of this vertex-based DG discretization is that up to 4 vertex values are

upwinded for each face E, rather than just one value in a face-centered DG approach. This means

that not only the magnitude of compositions and densities are communicated between elements,

but also the gradients in those variables along faces. This further reduces numerical dispersion and

grid sensitivity.

Similar to our discussion of the MHFE method on unstructured grids, we only summarize

the DG-discretized mass transport equation to highlight the ease with which complex geometries

can be accommodated. The only grid dependencies are captured in the matrices (cid:82)
(cid:82)
K ϕN wE · ∇ϕN(cid:48)dx, and(cid:82)

N dx,
E ϕN ϕN(cid:48)ds, which are again time-independent and can be computed as

K ϕN ϕ(cid:48)

part of an initialization routine once the grid is speciﬁed.

8

We note that while Equation 15 is expressed as a ﬁrst-order time-discretization, we have also

implemented a second-order Runge-Kutta scheme. However, it appears that the dependence of

numerical dispersion on the time-step size is weak, partly due to the small time-steps enforced by

the CFL condition in our IMPEC scheme [70].

3.4. Slope Limiter

Higher-order methods generally require a slope limiter to avoid spurious oscillations around

sharp front, and our DG implementation is no exception. We adopt the limiter developed by

[53, 64]. Consider vertex values (ci)K,N for an element K with local node number N . In the full

grid, this node is shared with multiple neighboring element, e.g. eight for a hexahedral grid and

often even more in fully unstructured tetrahedral grids. Denote ¯c as the vector of averages

[¯c]K(cid:48) =

1
|K(cid:48)|

in all the elements K(cid:48) sharing node N .

ci =

1
N(cid:48)

K(cid:48)

(cid:90)

(cid:88)

N(cid:48)

(ci)K(cid:48),N(cid:48)

(16)

The basic idea is to limit (ci)K,N to lie between the minimum and maximum of the average state

variables in all the elements surrounding a given node. This is done by minimizing the L2 norm of

the limited, or reconstructed, (cl

i)K,N with respect to the original vertex values (ci)K,N under the

physical constraints of mass conservation

||(cl

i)K,N − (ci)K,N||2,

satisfying

and

min
i)K,N

(cid:88)

(cl
min(¯c) < (cl
1
N

(cl

N

i)K,N < max(¯c),

i)K,N =

(ci)K,N .

(cid:88)

N

1
N

(17)

(18)

(19)

The mesh dependence of this slope limiter lies only in keeping track of which elements share which

(global) vertex, and the (possibly) diﬀerent numbers of nodes in each type of grid cell.

It has been shown that this slope limiter does not enforce a maximum principle on the face-

averaged values of state variables [80], which could theoretically cause spurious oscillations, e.g. if

phase ﬂuxes are computed with face-centered fractional ﬂow functions. Two-phase immiscible ﬂow

is particularly sensitive because mobilities depend directly on the primary saturation variable. Nev-

ertheless, this slope limiter was applied successfully in MHFE-DG modeling of two-phase immiscible

ﬂow on unstructured 3D grids by Hoteit and Firoozabadi [64]. In compositional ﬂow, species mo-

lar densities are the primary variables that are updated at vertices by DG for given phase ﬂuxes.

After slope limiting, molar densities and overall compositions (0 < zi < 1) are computed and used

to update the phase split (ﬂash) computations. Phase saturations (and mobilities) are derived

quantities, with 0 < Sα < 1 guaranteed by the ﬂash algorithms. In two-phase ﬂow, face-centered

mobilities can be computed from face-averaged saturations (which are assumed to vary linearly in

9

each dimension), but in compositional ﬂow, saturations are a strongly non-linear function of com-

positions. Phase properties (compositions and saturations) cannot be extrapolated away from the

points where ﬂash calculations were performed. Instead, motivated by the ﬁrst-order accuracy of

the MHFE ﬂux update, we perform a cell-centered ﬂash computation to update saturations and

mobilities. With this approach, we avoid any spurious oscillations in our solution. In future work,

we may explore methods to further improve accuracy by coupling DG to a higher-order ﬂux update

(e.g., BDM1) and developing a slope limiter with a formal maximum principle.

3.5. Convergence

Formally, the order of convergence for our multi-linear DG approximation should be quadratic.

However, these formal rates are derived for highly simpliﬁed problems, and observed rates are

generally lower for highly non-linear problems. Nevertheless, the convergence rate scales with the

order of approximation. In [66], we found that the convergence rate of a 2D face-based bilinear

DG mass transport update was twice that of an element-wise constant (FV) approximation. The

order of convergence is particularly important for IMPEC schemes in 3D. The CLF constraint on

the time-steps scales as 1/h (where h is a characteristic length-scale of the elements, i.e. ∆x, ∆y

or ∆z on structured grids, or, say, V 1/3 for an unstructured element with volume V ). Therefore,

for explicit methods the increase in CPU time for a mesh reﬁnement δf = hcoarse/hﬁne in each

direction scales with at best δf 4! Our DG approximation on tetrahedra requires the update of 4

ci at vertices instead of an element-wise constant value, but the associated additional CPU cost is
negligible compared to the ∝ δf 4 cost of mesh reﬁnement to reduce numerical dispersion.

Note that, when ﬂow instabilities (gravitational or viscous ﬁngering) or strong heterogeneity

occur at small spatial scales, such features cannot be resolved on coarse grids and mesh reﬁnement

may be unavoidable [81]. Up- and down-scaling static reservoir models for permeability and porosity

heterogeneity on unstructured grids adds further complexity, but geostatistical facies modeling can

be applied to unstructured grids as well as to structured ones. When a formation is layered or

fractured, grids should conform to the layer and matrix block sizes, but within a layer or matrix

block, less mesh reﬁnement is required, e.g., to resolve ﬂow instabilities, when higher-order methods

are used. Moreover, the discontinuous Galerkin method preserves sharp changes in ﬂuid properties

at layer and fracture-matrix interfaces.

We also note that it is not straightforward to compare the CPU times and degree of mesh

reﬁnement for the diﬀerent types of elements: time-steps are governed by the element volumes and

will be similar for any grid types, provided they have the same number of elements. However,

the computational cost of the DG transport update scales with the number of nodes per element.

Finally, the MHFE pressure update is proportional to the number of faces, which again scales

diﬀerently for each type of element. To summarize: in order to make a ‘fair’ comparison between

10

simulations on diﬀerent grids we have to balance 1) the number of elements, which governs the

time-steps, 2) the number of nodes, which determines the cost of the DG update and associated

phase-split computations, and 3) the number of faces, which determines the size of the matrix that

need to be inverted in the implicit pressure solve.

4. Numerical Experiments

We present the results of nearly 50 simulations that explore key challenges in the modeling

of subsurface ﬂow. Grid independence is the ﬁrst such challenge.

In certain numerical models

(e.g. TPFA), simulated results are sensitive to the orientation and quality of the mesh. We claim

that MHFE shows virtually no mesh dependence. We demonstrate this in the ﬁrst set of examples

by simulating gravity depletion, water ﬂooding, and CO2 injection on structured and unstructured

tetrahedral, prismatic, and hexahedral grids. The ﬂuid characterization, rock properties, temper-

ature and pressure conditions are representative of a North Sea light-oil reservoir. The second

example further explores gridding by verifying that in the absence of gravity the expansion front

from a point-source in a homogeneous domain is spherical. For unstable ﬂow, which exhibits vis-

cous ﬁngering, we demonstrate the advantage of our vertex-based DG formulation over a face-based

approach. Anisotropic formations with a full permeability tensor are considered in the third exam-

ple. The convergence rate upon grid reﬁnement of our MHFE-DG method on unstructured grids is

analyzed in the fourth example. In that example, we compare the CPU times for a range of grid

reﬁnements and diﬀerent grid types. In the other examples, the bulk of the CPU time may be con-

sumed by phase-split computations, and comparisons between diﬀerent grid types is less informative

of the eﬃciency of the FE methods. In the ﬁfth set of examples, we demonstrate the ﬂexibility of

our methods in dealing with complicated domain geometries and mixing diﬀerent elements types in

a single mesh.

The ﬁrst ﬁve examples are not necessarily representative of realistic reservoir geometries. Rather,

each example is constructed to demonstrate a speciﬁc powerful feature of our ﬁnite element ap-

proach. In the sixth example, we consider two benchmark reservoirs from the literature: Model 2 of

the ‘SPE Tenth Comparative Solution Project’ [71], and the ‘Egg Model’ developed at the Technical

University of Delft [72, 73]. These two models use logically Cartesian grids with low geometrical

complexity, but they incorporate realistic petrophysical properties with many orders of magnitude

variations in permeabilities and porosities.

In all the examples we determined that the maximum mass balance error of a species for the
entire simulations is of the order ∼ 10−13. All simulations were carried out in serial mode on a 2.8
GHz Intel Core i7 with 12 GB RAM.

11

4.1. Example 1: Depletion, Water Flooding, and CO2 Injection

We consider a 0.3 km × 0.1 km × 0.05 km section of a North Sea reservoir, discretized by
structured hexahedra, unstructured prisms, and various tetrahedralizations. We consider the 7-

(pseudo)-component ﬂuid characterization and formation properties (homogeneous rock permeabil-

ity of 100 mD and 20% porosity) from Example 2 in Moortgat and Firoozabadi [70]. The tempera-

ture is 400 K, and the initial bottom-hole pressure of 337.5 bar is just below the saturation pressure

(338 bar) of the oil. We assume Stone [82, 83] relative permeabilities, with quadratic exponents

and end-points of k0

rg = k0

ro = 0.4 for gas and oil. The aqueous phase has an end-point relative

permeability of 0.3 and exponent of 3. The residual oil saturations are 50% to water and 0% to gas

(due to phase behavior).

We test our unstructured higher-order FE methods for three important oil recovery processes:

gravity depletion, water ﬂooding, and compositional CO2 gas injection.

To investigate whether our method suﬀers from grid dependency, we consider 5 diﬀerent grids.
The ﬁrst is a structured mesh with 50×18×10 = 9, 000 elements, while the other 4 are unstructured.
The second grid has 10 layers of prisms, the third (tetrahedra 1) consists of 9, 000 equal size

tetrahedra constructed from a 1, 500 element structured grid (5 layers) by dividing each cuboid

into 6 tetrahedra, the fourth grid (tetrahedra 2) is an irregular CDT with 10, 467 elements of

widely varying sizes, and the ﬁfth (tetrahedra 3) is a 36, 000 element reﬁnement (10 layers) of the

tetrahedra 1 grid. The number of elements, vertices and faces for each grid are summarized in

Table 1. Wells are placed at the origin (bottom) and the diagonally opposite corner (top) with each

well’s function (injection or production) determined by the production scenario. For the depletion

case, oil is produced at a constant rate of 6% pore volume (PV) per year from the bottom well,

water ﬂooding and gas injection are at a constant rate of 5% PV/yr from the bottom well with

constant production pressure from the top.

4.1.1. Depletion

Figure 6 shows the gas saturation throughout the domain on all 5 grids after 5 years of gravity

depletion. The results are in good agreement on all types of grids. The complete lack of mesh

dependence for these simulations is even more apparent in Figure 7, which shows the oil recovery over

a simulation time of 20 years. The results are indistinguishable. Depletion is a somewhat challenging

test-case for multiphase ﬂow simulations, because the ﬂow exhibits gravitational counter-current

ﬂow with gas buoyantly rising to the top while oil drains to the bottom.

4.1.2. Water ﬂooding

The water saturation after 1 year of 5% PV/yr injection is shown in Figure 8 on all 5 grids.

Due to the 50% residual oil saturation, water has invaded about 10% of the domain. Again, we ﬁnd

12

very good agreement in the front locations on all meshes and nearly identical oil recoveries over 20

year in Figure 9. We do see a slightly sharper kink in the oil recovery around the time of water
breakthrough for the ﬁnest tetrahedral grid, suggesting that the ∼ 9, 000 element grids still have a
small degree of numerical dispersion.

4.1.3. CO2 Injection

The injected CO2 has a higher density (614 kg/m3) than the oil (543 kg/m3), so CO2 will

preferentially ﬂow below the oil. Figure 10 illustrates that the gas saturation after 10 years of

injection is nearly identical for MHFE-DG simulations on hexahedral, prismatic and tetrahedral 1

grids. Also shown is a comparison between MHFE-DG and a lower-order transport update (MHFE-

FV) on a 2D cross-section at y = 70 m for 30% and 50% PVI and for 3 diﬀerent grid types. The

MHFE-FV results have not converged and are therefore more dispersed. The implications of this

numerical dispersion are more apparent in Figure 11. It shows that while the converged MHFE-DG

simulations predict the same oil recovery on all grid types (with diﬀerent levels of reﬁnement as

given in Table 1), the MHFE-FV results have diﬀerent oil recoveries on diﬀerent grids and the

recovery predictions are overestimated by 15 – 25%.

4.2. Example 2: Grid Sensitivity Studies

We carry out a few more targeted grid sensitivity studies.

4.2.1. Stable Waterﬂooding

First, water is injected (at 10% PV/yr) from the center of a 3 m × 3 m × 3 m cube, with
constant pressure production from all 8 vertices. All rock and ﬂuid parameters are the same as

in Example 1. We set the gravitational acceleration to zero to make the problem fully symmetric.

The water front should therefore expand as a sphere. Sensitivity to grid orientation manifests itself

as enhanced ﬂow along the prevalent grid directions. On 2D structured grids (below), this would

result in a diamond-shaped distortion of the (real) circular outﬂow. In 3D, grid sensitivity would

lead to deviations from the sphere, either along the coordinate axis for structured cuboid grids, or

along preferred grid lines in unstructured prismatic and tetrahedral grids.

Figure 12 shows the water saturation proﬁle at 6% PVI, as well as a projection onto a slice at

z = 0.7 m, simulated on a hexahedral, a prismatic, and two tetrahedral grids. We see no discernible

deviations from the sphere (or projected circle) due to grid sensitivity.

We also simulated this problem (and others) with our previous face-based DG formulation and

found equally low grid sensitivity. However, we expect that the vertex-based DG formulation should

be superior in some applications, as discussed in Section 3.3. To test this hypothesis we consider a

pathological case of an unstable displacement front next.

13

4.2.2. Unstable Gas Injection with Viscous Fingering

We consider a 2D horizontal 50 m × 50 m ﬁve-spot pattern (source in the center, constant
pressure production wells in all four corners), and a ﬁne 99 × 99 element mesh. All other parameters
are the same as above. To simulate unstable ﬂow, we inject CO2 and increase the gas/oil mobility

ratio through the relative permeability by changing the gas relative permeability to linear, and

setting k0

rg = 10 × k0

ro = 1. The oil and gas viscosities are 0.14 cp and 0.03 cp, respectively.

Figure 13 shows the overall CO2 composition at 5% PVI for simulations with vertex- versus face-

based DG formulations. We present these early-time results, because the onset of a viscous ﬁngering

instability is of interest. Due to the adverse mobility ratio, the ﬂow is inherently unstable. However,

the instability needs to be triggered by some deviation from complete symmetry (e.g. numerical

precision). What we see in Figure 13 is that for the vertex-based DG, viscous ﬁngers emerge ﬁrst

along the physical deviation from symmetry caused by the four production wells in the corners.

For the face-based DG, on the other hand, we ﬁnd that the most pronounced ﬁngers prefer to

ﬂow along the coordinate axis, which is a typical unphysical gridding eﬀect. We conclude that for

certain problems the vertex-based DG formulation presented in this work performs better than the

face-based discretization with the same formal convergence properties. Simulations results are also

presented for a lowest-order FV transport update, which shows similar grid orientation eﬀects as in

the face-based DG approach, but with increased numerical dispersion.

4.2.3. General Quadrilateral and Hexahedral Grids

As a ﬁnal test of mesh sensitivity, we consider water-ﬂooding from the center of extremely poor

quality distorted quadrilateral and hexahedral grids as shown in Figure 14. Production is again

from all the corners. The nodes of structured 2D and 3D grids are randomly perturbed to the degree

that, for instance, many of the quadrilaterals look like triangles with a hanging node on one of the

edges (which in reality is the fourth node of the quadrilateral). The hexahedra have non-parallel

faces and many sharp angles. For the 2D grid, water is injected from the center at 10% PV/yr. The

3D simulation is as in Section 4.2.1. We can still not detect any mesh sensitivity or other numerical

artifact, and the total mass balance error (integrated in time, and over the domain) in each of the
6 components after 100% PVI is < 10−14.

4.3. Example 3: Water Flooding of Anisotropic Reservoir

One of the strengths of our FE formulation is that we can readily accommodate full permeability

tensors. On unstructured grids we eﬀectively always consider anisotropic permeability, in the sense

that even for a matrix-diagonal permeability on a real mesh element, the permeability mapped onto

the reference ﬁnite element will look like an anisotropic permeability tensor.

14

In this example we consider two tensors in which the vertical permeability is much lower than the
horizontal permeability, and the permeability in the x − y direction is either enhanced or reduced:

 50 ±40

±40
0

50

0



0

0

1

K± = 10 mD

(20)

such that the determinants of K+ and K− are again 100 mD. We repeat the water ﬂooding case

from Example 1 with this permeability, and on all 5 (un)structured grids.

The eﬀect of the non-zero Kxy component is most apparent before the water front reaches the
back y = 100 m of the domain, so we plot the water saturation at 1% PVI for K+ and K− in

Figures 15 and 16, respectively. Only 0 < x < 100 m is shown for clarity.

We see how the positive Kxy signiﬁcantly enhances the (early) ﬂow along the x = y direction in

Figure 15, while a negative Kxy has the opposite eﬀect in Figures 16. A similar example for trian-

gular 2D grids was presented in Moortgat and Firoozabadi [75]. These observations are as expected

and simply demonstrate the applicability of our MHFE-DG approach to non-grid-orthogonal tensor

permeabilities. The initial ﬂow is mainly in the x-y plane, due to the high horizontal to vertical

permeability ratio. The fronts on the coarsest two tetrahedral grids (1 and 2) are slightly more
dispersed, because they have only ∼ 5 layers in z, as compared to 10 layers for the hexahedral and
prismatic grids. On the ﬁner tetrahedral 3 grid the results appear to be converged. In terms of the

oil recovery predictions, the results from the coarsest tetrahedral 1 grid converge to those on the

ﬁner hexahedral and prismatic grids, as shown in Figure 17 for 20 years of water injection for K+
(the ﬁgure for K− is omitted due to its similarity).

4.4. Example 4: Convergence Analysis

We analyze the convergence properties of our FE methods by simulating a simple problem on a
wide range of grid reﬁnements. Water is injected into a 4 cm × 4 cm × 30 cm core saturated with
nC10. The temperature and pressure are 310 K and 100 bar, respectively, the permeability is 10 mD,

and porosity is 20%. The relative permeabilities are linear with unit end-point for oil and 0.3 for

water, and the residual oil saturation is 30%. To simulate gravitationally stable displacement, we

inject one PV/day from the bottom and produce from the top at a constant pressure.

We perform simulations on 9 diﬀerent grids. The coarsest grid has N1 = 2 × 2 × 15 hexahedral
elements, which we reﬁne by a factor 2 in each direction 4 times, such that the ﬁnest grid has
212 × N1 elements. Tetrahedral grids are created by dividing each hexahedron into 6 tetrahedra.
The number of elements, vertices, and faces for the 5 hexahedral and 4 tetrahedral grids are provided

in Tables 2 and 3, respectively. The ﬁnest grid has 245, 760 elements, 262, 449 faces, and 753, 664

nodes, such that we update well over one million values for compositions, pressures and ﬂuxes.

15

The ﬂow of water through the core is piston-like displacement. The exact water composition

proﬁle is expected to be a 1D step-function propagating through the core, with increasing numerical

dispersion exhibited on coarser grids. 3D plots of the results on all 9 meshes are not very informative.

Instead, Figure 18 shows a projection onto the z-axis of all the hexahedral simulations at 50% PVI.

The important results are summarized in Tables 2 and 3, which provide the L1 errors, conver-

gence rates, and CPU times of all the simulations. The order of convergence is lower than the formal

order of 2, but is still well above linear. In fact, it is higher than for the Buckley-Leverett problem

simulated with a MHFE-DG approach in Hoteit and Firoozabadi [64], and our convergence study

in Moortgat et al. [66]. The latter may be due to the vertex, rather than face, based formulation.

Figure 18 illustrates the gain from the higher order of convergence: the simulation results on the
8 × 8 × 60 grid have mostly converged to the same accuracy as on the 32 × 32 × 240 grid, while
requiring two orders of magnitude less CPU time.

4.5. Example 5: Complex Domains and Grids

4.5.1. Mixed Elements Grid

To illustrate our capability to mix diﬀerent element types, we start with 3 sub-domains, which

are discretized by hexahedra, prisms, and tetrahedra, respectively, and then form a compounded grid

by ‘glueing’ the three grids together, as shown in Figure 19. Because neighboring elements cannot

have intersecting edges, we join the rectangular faces of the right-boundary of the cuboid with those

of the left-boundary of the prismatic grid, and one of the triangular faces of the top-boundary of the

latter grid with one of the triangular faces of the tetrahedral sphere. We subsequently transform
the x and z coordinates to x(cid:48) and z(cid:48) (with Lx = 250 m and Lz = 143 m) by

x(cid:48) = x − (z + Lz)/5,
z(cid:48) = z + x/6 + 40 sin(xπ/Lx)4 + y/2.5,

(21)

(22)

to create more general unstructured hexahedral and prismatic elements. The geometrical slopes

and domes result in interesting multiphase ﬂow, particularly when driven by gravity. The grid and

well locations are shown before and after applying (21)-(22) in Figure 19.

For the simulations, we consider the same ﬂuid and rock parameters as in Example 1 and again

simulate depletion, water ﬂooding, and gas injection.

Gravity Depletion. We deplete at a constant rate of 5% PV/yr from the lowest point in the domain.

The initial bottom-hole pressure is 375 bar. The saturation pressure of the reservoir oil is not much

lower (338 bar), and after a few months the pressure in the top start to drop below the saturation

pressure. It takes only 6 months before the entire reservoir is in a two-phase state. Figure 20 shows

the gas saturation throughout the reservoir after 4 years. Because of the relatively high permeability

16

(100 mD), the liberated gas buoyantly rises to the top and accumulates in the trap in the prismatic

grid section and inside the sphere, although the latter is hampered by the bottle-neck intersection.

In terms of numerical performance, we see a smooth and nearly ﬂat saturation proﬁle throughout

the grid without any artifacts at the intersections between diﬀerent element-types.

Water Flooding. Water is injected at 5% PV/yr from the lowest point, and production is from the

top of the sphere, resulting in immiscible compressible displacement of the reservoir oil. The water

saturation at diﬀerent times is shown in Figure 21. Note that the mesh is rotated around the z-axis
by 180◦ to oﬀer a better view. During the ﬁrst 10% PVI water mainly ﬁlls the lower trough of the
hexahedral and prismatic sections, before spilling over into the second trough in the domain. After

42% PVI the ﬂooding front reaches the bottle-neck to the sphere. At later times, water ﬁlls the

sphere, without recovering the oil in the dome section of the domain. Figure 21 nicely shows a level

front due to gravitational segregation.

CO2 Injection. As mentioned in Example 1, CO2 is denser than the oil at these reservoir conditions

and should be injected from the bottom for the most eﬃcient oil recovery. However, the ﬂow in that

case is similar to that of water in the previous example, so instead we simulate the more complicated

scenario of CO2 injection from the top of the sphere, with production from the bottom. Figure 22

shows the overall molar fraction of CO2 after 10% and 25% PVI. We see how dense CO2 sinks to

the bottom of the sphere, and then ﬁlls the right-side trough of the prismatic grid, before spilling

over into the downward sloping prismatic and hexahedral sections of the domain. Again, we observe

no sign of grid sensitivity within or across the transitions between the 3 sub-grids.

4.6. Example 6: Benchmark Examples with Realistic Petrophysical Properties

4.6.1. SPE Tenth Comparative Solution Project

We consider the SPE 10 benchmark problem [71] as an example of a realistic geo-statistical

realization of petrophysical properties. This benchmark problem has more than eight orders of

magnitude variation in permeabilities, as well as a wide range in porosities. We perform ﬁne-grid

simulations of two-phase ﬂow in two diﬀerent sectors of this domain, which is saturated with nC10

at the same temperature and pressure as in Example 4. C1 is injected at 5% PV/yr from one corner

and production is at a constant pressure from the opposite corner. The relative permeabilities are

linear with an end-point relative permeability of 0.27 for oil, and 1 for gas.

The ﬁrst section consists of the bottom ﬁve layers (60 × 220 × 5 grid cells). This is part of
the ﬂuvial Ness formation in the North Sea, which has well connected high-permeability sandstone

channels, corresponding to river depositions with low permeability shale in between. Figure 23

shows the gas saturation at 25% and 70% PVI and clearly shows the channeling of injected methane

through the high permeability sandstone with a poor sweep of the shale depositions.

17

The second section has the top ﬁve layers from the Tarbert formation, which has a completely

diﬀerent shallow marine deposition history. In Figure 24, we see a better sweep for the Tarbert

formation, in which the permeability variations still span 8 orders of magnitude, but with a shorter

correlation length.

4.6.2. TU Delft Egg Domain

This synthetic domain is a three-dimensional realization of a channelized reservoir, which was

used to benchmark water ﬂooding conditions with eight water injectors and four producers using 4

diﬀerent simulators [73, 72]. We use the dataset adapted for MRST [84]. An image of the channeled

permeability ﬁeld is also available on the SINTEF MRST website. The permeability varies between

about 80 and 7, 000 milli-Darcy, while the porosity is uniform at 20%.

Instead of modeling the same immiscible two-phase ﬂow problem, we combine the grid and

realistic petrophysical properties from the Egg model with a challenging ‘benchmark’ compositional

problem from our own work. We consider CO2 injection into a Brazilian oil which we modeled before

[68] at conditions where CO2 is supercritical and denser than the oil, and the CO2-oil mixtures are

near the critical point. All parameters, except the grid, permeability and porosity, are the same

as in our earlier work [68], and we also include Fickian diﬀusion in this example. CO2 is injected

at a constant rate of 5% PV/yr from 8 injectors that perforate the full depth of the formation (7

layers), represented by a total of 56 grid cells. Constant pressure production wells are deﬁned on

the outer boundaries of the domain, and are represented by one element in the top and one in the

bottom of each of the 4 producers indicated in Figures 25–26 (a total of 8 grid cells). The grid has

a total of 18, 553 active grid cells.

Figure 25 shows gas saturations at 5, 25, 50, and 65% PVI for two-phase gas-oil ﬂow. The

panels show how dense CO2, injected from the 8 wells in blue, segregates to the bottom even in this

relatively thin formation. The high permeability channels in the Egg model enhance ﬂow towards

some of the producers (in red), while impeding ﬂow to, for instance, the bottom-left producer. We

also simulate the same problem, but as a three-phase compositional problem with a 31% connate

water saturation and allowing for CO2 dissolution into the aqueous phase and the resulting volume

swelling. Figure 26 shows that the results are quite similar.

5. Conclusions

In this work, we study for the ﬁrst time an attractive combination of higher-order ﬁnite element

methods for compressible, compositional three-phase ﬂow on unstructured 3D grids. The main

strengths of our IMPEC MHFE-DG scheme are summarized below.

18

1. Both the DG and MHFE methods work as well on unstructured grids as they do on struc-

tured ones and with similar complexity of implementation. The DG transport update can

capture discontinuities in ﬂuid properties, e.g., across phase boundaries, layers, and fractures,

with low numerical dispersion. The MHFE approach provides accurate, globally continuous,

velocity ﬁelds, even on highly heterogeneous and anisotropic permeability ﬁelds. The only

geometry/grid dependence of the MHFE-DG implementation consists of coeﬃcients that are

computed in a preprocessing step.

2. Our new vertex-based MHFE-DG method is more accurate than previous face-based imple-

mentations. The reason is that multiple values are upwinded across each face, which transfers

information regarding not only the magnitude of phase properties, but also their gradients.

3. These ﬁnite element methods are remarkably insensitive to mesh orientation and quality,

which we demonstrated for grids made of tetrahedra, prisms, and general hexahedra in 3D,

as well as triangles and general quadrilaterals in 2D.

The ﬁrst item has been demonstrated on unstructured grids in the past for incompressible immiscible

ﬂow, but not for compressible compositional ﬂow. Compositional ﬂow is a considerably more

complicated problem due to the higher degree of non-linearity.

To build conﬁdence in the algorithm, we presented a wide range of numerical experiments in

Sections 4. The examples demonstrate that simulations of multicomponent multiphase ﬂow with

gravity-driven counter-current-ﬂow and phase behavior yield identical results on all considered grid

types, and for a range of processes (Example 1). As expected, we ﬁnd that the MHFE method

exhibits no grid orientation eﬀects (Example 2), and can accommodate a full permeability tensor

(Example 3). For transport we showed that by using a multi-linear DG approximation we can

achieve a higher convergence rate than for element-wise constant approximations. This is critical

in 3D, where the CPU cost of grid reﬁnement by a factor δf scales with δf 4 for an IMPEC method

(one factor of δf is due to the CFL time-step constraint and could be eliminated in fully implicit

schemes). Using even higher orders of DG may further improve accuracy, but involves a more subtle

trade-oﬀ than for immiscible incompressible ﬂow models, because of the additional (CPU expensive)

phase-split computations. Combinations of diﬀerent grid types were considered in Example 5, and

two- and three-phase ﬂow with Fickian diﬀusion were modeled for realistic geostatistical benchmark

problems in terms of petrophysical properties in Example 6.

Appendix A: Phase-Split Computations

Details of the phase stability and phase-split computations for compositional three-phase ﬂow

are discussed in [66]. The basic algorithm proceeds along the following steps

19

1. For a given mixture composition zi, temperature and pressure, perform a phase stability

analysis to determine whether a single-phase state is stable. The phase stability analysis is

based on the tangent-plane distance and ﬁnds the phase state with the minimum Gibbs free

energy. If the the ﬂuid is stable, xi,α = zi and cα = c and no further calculations need to be

performed. If the phase is unstable, we proceed to a two-phase phase-split computation.

2. The phase-split calculations determine the phase compositions and amounts such that the

fugacities of each component are equal in all phases. We have found that the most numerically

βα are found from the Rachford-Rice equation: (cid:80)

stable and eﬃcient approach (fewest iterations) is to carry out these calculations in terms of
the logarithm of equilibrium ratios: ln Ki = ln φi,α1 − ln φi,α2, in which φi,α are the fugacity
coeﬃcients and α1, α2 are two of the three possible phases. The molar fractions of each phase,
i(xi,α1 − xi,α2) = 0. The equilibrium ratios
and phase fractions βα are found iteratively. First, successive substitution iterations (SSI)
are used until both Ki and βα have converged to a tolerance of typically 10−4. After this
switch criterion, Newton-Raphson (NR) iterations are used until the error is < 10−10. The
NR method requires the computation of the inverse of a Jacobian matrix of derivatives of the

aforementioned governing equations with respect to ln Ki and βα. However, while the SSI has

linear converge, NR shows quadratic convergence and only requires a few iterations.

3. Once a two-phase solution is found, we perform a second phase-stability analysis to determine

whether the two-phase state is stable, or whether a three-phase state has a lower Gibbs free

energy. This can be done by testing the stability of either of the two phases found in the

previous step. If the two-phase state is stable, phase compositions can be computed from zi,

Ki and βα. If not, a three-phase split computation is performed.

4. The three-phase split computation, while computationally more challenging, is mathemati-

cally similar to the two-phase split. We solve for two sets of equilibrium ratios from ln Ki,α1 =
ln φi,α1−ln φi,α2 and ln Ki,α3 = ln φi,α3−ln φi,α2, and two Rachford-Rice equations. The same
combination of SSI and NR with the same switch criterion and ﬁnal tolerance is used for the

iterative solution procedure.

The full (stand-alone) phase stability and phase-split algorithm is very computationally expensive.

In the context of reservoir simulations, many of the computational steps can be avoided by spatial

and temporal information. For example, whenever equilibrium ratios and phase amounts from a

previous time-step are available, these can be used as initial guesses for a phase-split calculation. In

> 99% of cases the phase-split computation with such a guess converge in a few iterations, avoiding

the need for a phase-stability analysis. Also, if a grid cell and all its neighboring grid cells where in

single-phase in the previous time-step, it is safe to assume that this grid cell will remain in single-

phase at the next time-step (for ﬂuid injection, not depletion, and for an IMPES scheme with a

20

time-step constraint that essentially says that a ﬂuid cannot propagate through more than one grid

cell in one time-step). A similar argument can be used for grid cells saturated with water and oil,

when an injection gas front is still far away. The phase-split computations are further optimized by

adaptively adjusting the switch criterion: if the average number of SSI iterations is large, while only

one or two NR iterations are used, we increase the tolerance (switch to NR earlier). Conversely, if

the number of NR iterations is high or NR fails due to inadequate initial guesses, the tolerance is

decreased (more SSI iterations before NR).

Appendix B:

In this appendix we provide the complete expressions for the second-order Discontinuous Galerkin

update on two-dimensional triangles and rectangles, and three-dimensional prisms, tetrahedra, and

hexahedra. Our formulation allows for any combination of these element types within a single grid.

To solve (15) we invert the matrix(cid:82)

K φN φN(cid:48)dx analytically and arrive at the generic expression

(ci)n+1

K,N = (ci)n

K,N +

∆t
φ|K|

[(Vi)n

α − (Ei)n

α + (Fi)n
K]

(23)

(cid:88)

α

for each component i at each node N . (Vi)n

α and (Ei)n

α collect all the terms in the volume and

surface integrals in (15), respectively.

The expressions for (Vi)n

E,α are the same for each grid cell, each phase, and each
time-step, so we drop indices n and α. As such, cN refers to the phase composition inside grid cell

K,α and (Ei)n

K at node N . Note that the ﬂux index refers to edges. For the upwind phase compositions we

use slightly diﬀerent notation here (cid:103)cE,n will refer to the phase composition upwinded with respect

to the ﬂux qα,E, at local node n of edge E (i.e, n = 1, 2 for triangular and quadrilateral elements,

n = 1, 2, 3 for tetrahedra and two faces on a prism, and n = 1, . . . , 4 on the quadrilateral faces on

a prism and for hexahedra).

We write in matrix notation V = VN,α, Q = qα,E, c = cN,α

21

Triangular Elements

Figure 1 illustrates the degrees-of-freedom (DOF) for the MHFE-DG method. The vertex-based

DOF for the DG transport update are deﬁned inside each element K, and can be discontinuous

across edges E.

Figure 1: Degrees of freedom for MHFE-DG on a triangular grid element K with the following notation: average

pressure pK , pressure traces on edges tpE , edge ﬂuxes qE and ﬂuid properties at vertices, e.g. phase molar density

of component i at node N , cN . Note that the cN are deﬁned inside element K; the corresponding global node has as
many discontinuous values cN(cid:48) as elements K(cid:48) sharing the same global node. One neighbouring element K(cid:48) is shown
to illustrated the discontinuous cN across edge E3.

The volume integrals in (23) can be written as: VN,α = c ¯VN q/2, with

 .

1

1

2

1

1

2

The surface integrals are given explicitly by EN,α = ¯EN q/2, with

¯V2 =

¯V3 =

¯V1 =

1

1

 ,

1

2

1

 ,

2 −2
1 −3

2 −2
1 −3
1 −3

 1 −3

 2
 −3
¯E1 = (5(cid:103)c1,1 +(cid:103)c1,2, 5(cid:103)c2,1 +(cid:103)c2,2,−3[(cid:103)c3,1 +(cid:103)c3,2]) ,
¯E2 = ((cid:103)c1,1 + 5(cid:103)c1,2,−3[(cid:103)c2,1 +(cid:103)c2,2], 5(cid:103)c3,1 +(cid:103)c3,2) ,
¯E3 = (−3[(cid:103)c1,1 +(cid:103)c1,2],(cid:103)c2,1 + 5(cid:103)c2,2,(cid:103)c3,1 + 5(cid:103)c3,2) .

−3
−2

22

pK tp3 tp2 tp1 q2 q3 q1 c1 c2 c3 c`1 c`3 c`2 K K` Quadrilaterals

Figure 2: Degrees of freedom for MHFE-DG on quadrilateral grid elements. Notation as in Figure 1.

We write the volume integrals in (15)-23 as VN,α = 1
4 −2
−2
1 −2
−2

A−1 =

1 −2
1
4 −2
4

4 −2

1 −2



 ,

9 A−1(c ¯VN q) with

 ,
 ,




 ,
 .

2

4

2

2 −4 −1
4 −2 −2
2 −2 −4
1 −2 −2
−1
−2
−4
−2

1
2 −2 −4
1 −2
1
2 −1
4 −1

2

¯V2 =

¯V4 =

4

1

2

−2 4 −2
−4 2 −1
−2 1 −2
−1 2 −4
2
1 −2 1 −2
2 −1 2 −4
4 −2 4 −2
2 −4 2 −1

4
3 A−1( ¯EN q), with
¯E1 = (0,(cid:103)c2,1 + 2(cid:103)c2,2, 0, 2(cid:103)c4,1 +(cid:103)c4,2) ,
¯E2 = (2(cid:103)c1,1 +(cid:103)c1,2, 0, 0,(cid:103)c4,1 + 2(cid:103)c4,2) ,
¯E3 = ((cid:103)c1,1 + 2(cid:103)c1,2, 0, 2(cid:103)c3,1 +(cid:103)c3,2, 0) ,
¯E4 = (0, 2(cid:103)c2,1 +(cid:103)c2,2,(cid:103)c3,1 + 2(cid:103)c3,2, 0) .

23

and

¯V1 =

¯V3 =




The surface integrals are computed from EN,α = 2

pK tp1 tp2 tp3 tp4 q1 q2 q3 q4 c1 c2 c3 c4 Tetrahedra

Figure 3: Degrees of freedom for MHFE-DG on tetrahedral grid elements. Notation as in Figure 3.

For tetrahedra we ﬁnd VN,α = c ¯VN q/3, with




¯V1 =

¯V3 =

 ,
 ,




¯V2 =

¯V4 =

 ,
 .

1 −4
2 −3
1 −4
1 −4

1

1

1

2

1

1

1

2

1

2

1

1

2

1

1
1
1 −4
1 −4
1 −4
2 −3

2 −3
2
1 1 −4
1 1 −4
1 1 −4
−4 1
−4 1
−3 2
−4 1

1

1

1

2

2

1

1

1

1

1

2

1

The surface integrals are given by EN,α = ¯EN q/3, with

¯E1 = (6(cid:103)c1,1 +(cid:103)c1,2 +(cid:103)c1,3, 6(cid:103)c2,1 +(cid:103)c2,2 +(cid:103)c2,3,−4[(cid:103)c3,1 +(cid:103)c3,2 +(cid:103)c3,3], 6(cid:103)c4,1 +(cid:103)c4,2 +(cid:103)c4,3) ,
¯E2 = (6(cid:103)c1,1 +(cid:103)c1,2 +(cid:103)c1,3,−4[(cid:103)c2,1 +(cid:103)c2,2 +(cid:103)c2,3], 6(cid:103)c3,1 +(cid:103)c3,2 +(cid:103)c3,3, 6(cid:103)c4,1 +(cid:103)c4,2 +(cid:103)c4,3) ,
¯E3 = (−4[(cid:103)c1,1 +(cid:103)c1,2 +(cid:103)c1,3], 6(cid:103)c2,1 +(cid:103)c2,2 +(cid:103)c2,3, 6(cid:103)c3,1 +(cid:103)c3,2 +(cid:103)c3,3, 6(cid:103)c4,1 +(cid:103)c4,2 +(cid:103)c4,3) ,
¯E4 = (6(cid:103)c1,1 +(cid:103)c1,2 +(cid:103)c1,3, 6(cid:103)c2,1 +(cid:103)c2,2 +(cid:103)c2,3, 6(cid:103)c3,1 +(cid:103)c3,2 +(cid:103)c3,3,−4[(cid:103)c4,1 +(cid:103)c4,2 +(cid:103)c4,3]) .

24

tp3 tp4 tp2 c3 c4 pK tp1 c1 c2 Prismatic Elements

Figure 4: Degrees of freedom for MHFE-DG on prismatic grid elements. Notation as in Figure 1.

Note that this is the ﬁrst element type where the number of nodes and faces is not equal.

The volume integrals are VN,α = c ¯VN q/2, with




¯V1 =

¯V4 =




2 2 −2 −2 4
1 1 −3
0
1 1 −3
0 0

0

2

0

0
0 −4
0
0

0

0 0

0 0

0

0

0

0

0

2

1

1

0

0

0

0
0
2 −2
1 −3
1 −3

0
0
2 −4
0
0

0
0
4 −2
0
0

0

0

,

¯V2 =

,

¯V5 =






,

−3
−3
−2
0

0

0

0

0

1

1

2

0

0

0

1

0

1
0
2 −2
0
0

0

0

4

0

0

0
0
0 −4 2

0

0

0

0

1

1

0

0

0
−3
−3
0
2 −2 −2 −4

1

1



,

0

0

0
0
2 −4
0
0

0

2

,

¯V3 =

,

¯V6 =







1
0
2 −2
0
1

0
0
0 −4
0
0

0

4

0

0

2

0

0

0

0

1

2

1

0
0
2 −4
0
0

0
0
4 −2
0
0

1 −3
2 −2
1 −3
0
0

0

0

0

0

0

0

0

0

0
0
1 −3
2 −2
1 −3

25

tp3 tp1 c1 c3 tp2 tp5 tp4 c4 c6 c5 c2 pK And the surface integrals satisfy EN,α = ¯EN q/2, with

¯E1 = (5(cid:103)c1,1 +(cid:103)c1,3, 5(cid:103)c2,1 +(cid:103)c2,3,−3[(cid:103)c3,1 +(cid:103)c3,3],−4(cid:103)c4,1, 8(cid:103)c5,1) ,
¯E2 = ((cid:103)c1,1 + 5(cid:103)c1,3,−3[(cid:103)c2,1 + 5(cid:103)c2,3], 5(cid:103)c3,1 +(cid:103)c3,3,−4(cid:103)c4,2, 8(cid:103)c5,2) ,
¯E3 = (−3[(cid:103)c1,1 +(cid:103)c1,3],(cid:103)c2,1 + 5(cid:103)c2,3,(cid:103)c3,1 + 5(cid:103)c3,3,−4(cid:103)c4,3, 8(cid:103)c5,3) ,
¯E4 = (5(cid:103)c1,2 +(cid:103)c1,4, 5(cid:103)c2,2 +(cid:103)c2,4,−3[(cid:103)c3,2 +(cid:103)c3,4], 8(cid:103)c4,1,−4(cid:103)c5,1) ,
¯E5 = ((cid:103)c1,2 + 5(cid:103)c1,4,−3[(cid:103)c2,2 + 5(cid:103)c2,4], 5(cid:103)c3,2 +(cid:103)c3,4, 8(cid:103)c4,3,−4(cid:103)c5,3) ,
¯E6 = (−3[(cid:103)c1,2 +(cid:103)c1,4],(cid:103)c2,2 + 5(cid:103)c2,4,(cid:103)c3,2 + 5(cid:103)c3,4, 8(cid:103)c4,3,−4(cid:103)c5,3) .

Hexahedra

Figure 5: Degrees of freedom for MHFE-DG on hexahedral grid elements. Notation as in Figure 1.

The volume integrals are given by VN,α = c ¯VN q with N = 1, . . . 8 and six edges E.

26

pK tp1 tp3 tp4 c1 c2 c3 c4 c5 c6 c7 c8 tp2 tp6 tp5 




¯V1 =

¯V3 =

¯V5 =

¯V7 =

−1
−2
0

0

0

0

0

0

2 −1 2 −1
0
1

0

0

0
0 −2
0
0

0

0
0
0 −2 1
0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0
0
1 −2

0

0
0
2 −1 2 −1 −1
1 −2 0
0
0
0

0

0

0

0

2

0

0

0

1

0

0

0

0

0

2

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0
0
−1 2 −1
−2
0
0

1

1

0

0
0
0 −2
0
0
0
0 1 −2
0
0

0

0

0

0

0

0
0
2 2 −1
0
0

0

0

0
0 0
0 −2 1 0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0
0
1 −2
0
2 −1 2 −1
1 −2
0

0

0

0

0

0

0
0
1 −2
0
0

0

0

0
0
2 −1
0
0






,

¯V2 =

,

¯V4 =

,

¯V6 =

,

¯V8 =






27

0
0
2 −1
0
1

0

0

0
0
0 −2
0
0

0
0
1 −2
0
0

0

0

0

0

0
0
2 −1 −1
0
0

0

0

0

0
0
0 −2

1 −2
0
2 −1 −1
0 −2
0
0
0

0

0

0

0

0

0

0
−2
−1
0

0

0

0

0

0

0

0

0

0

0

0

0

1

2

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

2

0

0

0

1

0

0

0

0

0

2

0

0

0

1






,

,

,

.

0

0

0

0

0

2

1

0

0

0
0
1 −2
0
2 −1 −1
0 −2
0
0
0

0

0

0

0

0

0

0
−2
−1

0

0

0

0

0

0

1

2

0

0

0

0

0

0

0
0
1 −2
0
0

0
0
2 −1

0
0
1 −2
0
0

0

0

0
0
2 −1
0
0

0

0

0

0

0

0

0
0
1 −2
0
0

0

0

0
0
2 −1

The surface integrals are calculated from EN,α = 2 ¯EN q with

¯E1 = (−(cid:103)c1,1, 2(cid:103)c2,1,−(cid:103)c3,2, 2(cid:103)c4,1,−(cid:103)c5,1, 2(cid:103)c6,1) ,
¯E2 = (2(cid:103)c1,1,−(cid:103)c2,1,−(cid:103)c3,1, 2(cid:103)c4,2,−(cid:103)c5,2, 2(cid:103)c6,2) ,
¯E3 = (2(cid:103)c1,2,−(cid:103)c2,2, 2(cid:103)c3,1,−(cid:103)c4,2,−(cid:103)c5,3, 2(cid:103)c6,3) ,
¯E4 = (−(cid:103)c1,2, 2(cid:103)c2,2, 2(cid:103)c3,2,−(cid:103)c4,1,−(cid:103)c5,4, 2(cid:103)c6,4) ,
¯E5 = (−(cid:103)c1,3, 2(cid:103)c2,3,−(cid:103)c3,4,(cid:103)c4,3, 2(cid:103)c5,1,−(cid:103)c6,1) ,
¯E6 = (2(cid:103)c1,3,−(cid:103)c2,3,−(cid:103)c3,3, 2(cid:103)c4,4, 2(cid:103)c5,2,−(cid:103)c6,2) ,
¯E7 = (2(cid:103)c1,4,−(cid:103)c2,4, 2(cid:103)c3,3,−(cid:103)c4,4, 2(cid:103)c5,3,−(cid:103)c6,3) ,
¯E8 = (−(cid:103)c1,4, 2(cid:103)c2,4, 2(cid:103)c3,4,−(cid:103)c4,3, 2(cid:103)c5,4,−(cid:103)c6,4) .

References

References

[1] L. S. Fung, X. Y. Ding, A. H. Dogru, Using unstructured grids for modeling densely-spaced

complex wells in ﬁeld-scale reservoir simulation, in: Paper SPE-17062-MS presented at the 6th

International Petroleum Technology Conference, Beijing, China, Mar 26-28 (2013), pp. 1–14.

[2] L. S. K. Fung, A. H. Dogru, Parallel unstructured-solver methods for simulation of complex

giant reservoirs, SPE J. 13 (2008) 440–446.

[3] I. Aavatsmark, T. Barkve, Ø. Bøe, T. Mannseth, Discretization on non-orthogonal, quadrilat-

eral grids for inhomogeneous, anisotropic media, J. Comput. Phys. 127 (1996) 2 – 14.

[4] X. H. Wu, R. R. Parashkevov, Eﬀect of grid deviation on ﬂow solutions, SPE J. 14 (2009)

67–77.

[5] I. Aavatsmark, T. Barkve, Ø. Bøe, T. Mannseth, Discretization on Unstructured Grids for

Inhomogeneous, Anisotropic Media. Part I: Derivation of the Methods, SIAM J. Sci. Comput.

19 (1998) 1700–1716.

[6] M. G. Edwards, Unstructured, control-volume distributed, full-tensor ﬁnite volume schemes

with ﬂow based grids, Comput. Geosci. 6 (2002) 433–452.

[7] M. G. Edwards, H. Zheng, Quasi-positive families of continuous Darcy-ﬂux ﬁnite volume

schemes on structured and unstructured grids, J. Comput. Appl. Math. 234 (2010) 2152–2161.

28

[8] M. G. Edwards, H. Zheng, S. Lamine, M. Pal, Continuous elliptic and multi-dimensional

hyperbolic Darcy-ﬂux ﬁnite-volume methods, Comput. Fluids 46 (2011) 12–22.

[9] M. G. Edwards, H. Zheng, Quasi m-matrix multifamily continuous Darcy-ﬂux approximations

with full pressure support on structured and unstructured grids in three dimensions, SIAM J.

Sci. Comput. 33 (2011) 455–487.

[10] S. Lamine, M. G. Edwards, Higher order cell-based multidimensional upwind schemes for ﬂow

in porous media on unstructured grids, Comput. Methods in Appl. M. 259 (2013) 103–122.

[11] S. Lamine, M. G. Edwards, Multidimensional upwind convection schemes for ﬂow in porous

media on structured and unstructured quadrilateral grids, J. Comput. Appl. Math. 234 (2010)

2106–2117.

[12] R. Eymard, T. Gallou¨et, R. Herbin, Discretization of heterogeneous and anisotropic diﬀusion

problems on general nonconforming meshes sushi: a scheme using stabilization and hybrid

interfaces, IMA J. Numer. Anal. 30 (2010) 1009–1043.

[13] J. Droniou, R. Eymard, A mixed ﬁnite volume scheme for anisotropic diﬀusion problems on

any grid, Numer. Math. 105 (2006) 35–71.

[14] M. Karimi-Fard, L. Durlofsky, K. Aziz, An eﬃcient discrete-fracture model applicable for

general-purpose reservoir simulators, SPE J. 9 (2004) 227–236.

[15] J. E. P. Monteagudo, A. Firoozabadi, Control-volume model for simulation of water injection

in fractured media: Incorporating matrix heterogeneity and reservoir wettability eﬀects, SPE

J. 12 (2007) 355–366.

[16] K. S. Schmid, S. Geiger, K. S. Sorbie, Higher order FE-FV method on unstructured grids

for transport and two-phase ﬂow with variable viscosity in heterogeneous porous media, J.

Comput. Phys. 241 (2013) 416–444.

[17] I. Aavatsmark, An introduction to multipoint ﬂux approximations for quadrilateral grids,

Comput. Geosci. 6 (2002) 405–432.

[18] J. Kozdon, B. Mallison, M. Gerritsen, W. Chen, Multidimensional upwinding for multiphase

transport in porous media, SPE J. 16 (2011) 263–272.

[19] B. R. Batista Fernandes, F. Marcondes, K. Sepehrnoori,

Investigation of several interpola-

tion functions for unstructured meshes in conjunction with compositional reservoir simulation,

Numer. Heat Tr. A-Appl 64 (2013) 974–993.

29

[20] J. Nordbotten, I. Aavatsmark, G. Eigestad, Monotonicity of control volume methods, Num.

Math. 106 (2007) 255–288.

[21] I. Aavatsmark, G. T. Eigestad, B. T. Mallison, J. M. Nordbotten, A compact multipoint

ﬂux approximation method with improved robustness, Numer. Meth. Part D E 24 (2008)

1329–1360.

[22] A. Younes, M. Fahs, B. Belfort, Monotonicity of the cell-centred triangular MPFA method for

saturated and unsaturated ﬂow in heterogeneous porous media, J. Hydro. 504 (2013) 132–141.

[23] I. Aavatsmark, G. T. Eigestad, B. O. Heimsund, B. T. Mallison, J. M. Nordbotten, E. Qian,

A new ﬁnite-volume approach to eﬃcient discretization on challenging grids, SPE J 15 (2010)

658–669.

[24] S. F. Matringe, R. Juanes, H. A. Tchelepi, A new mixed ﬁnite element and its related ﬁnite

volume discretization on general hexahedral grids, Mech. Sol. Struct. Fluids 12 (2009) 77–87.

[25] A. Salama, S. Sun, M. F. El Amin, A multipoint ﬂux approximation of the steady-state heat

conduction equation in anisotropic media, J. Heat Trans. 135 (2013) 041302.

[26] L. Ag´elas, R. Masson, Convergence of the ﬁnite volume MPFA O scheme for heterogeneous

anisotropic diﬀusion problems on general meshes, Comptes Rendus Mathematique 346 (2008)

1007–1012.

[27] R. Eymard, C. Guichard, R. Herbin, R. Masson, Vertex-centred discretization of multiphase

compositional Darcy ﬂows on general meshes, Comput. Geosci. 16 (2012) 987–1005.

[28] M. D. Jackson, J. L. Gomes, P. Mostaghimi, J. Percival, B. S. Tollit, D. Pavlidis, C. C. Pain,

A. H. El-Sheikh, A. H. Muggeridge, M. J. Blunt, Reservoir modeling for ﬂow simulation

using surfaces, adaptive unstructured meshes, and control-volume-ﬁnite-element methods, in:

Paper SPE-163633-MS presented at the SPE Reservoir Simulation Symposium, 18-20 February

(2013), The Woodlands, Texas, pp. 1–20.

[29] D. Arnold, An interior penalty ﬁnite element method with discontinuous elements, SIAM J.

Numer. Anal. 19 (1982) 742–760.

[30] I. Babu˘ska, The ﬁnite element method with penalty, Math. Comp. 27 (1973) 221–228.

[31] I. Babu˘ska, M. Zlamal, Nonconforming elements in the ﬁnite element method with penalty,

SIAM J. Numer. Anal. 10 (1973) 863–875.

[32] M. F. Wheeler, An elliptic collocation ﬁnite element method with interior penalties, SIAM J.

Numer. Anal. 15 (1978) 152–161.

30

[33] F. Brezzi, M. Fortin, Mixed and Hybrid Finite Element Methods, Springer-Verlag, New York,

1991.

[34] B. Cockburn, G. E. Karniadakis, C. E. Shu, Discontinuous Galerkin Methods, Theory, Com-

putation, and Applications, Springer-Verlag, Berlin, 2000.

[35] C. Dawson, S. Sun, M. F. Wheeler, Compatible algorithms for coupled ﬂow and transport,

Comput. Meth. Appl. M. 193 (2004) 2565–1029.

[36] B. Riviere, M. Wheeler, V. Girault, A priori error estimates for ﬁnite element methods based

on discontinuous approximation spaces for elliptic problems, SIAM J. Numer. Anal. 39 (2001)

902–931.

[37] V. Girault, S. Sun, M. F. Wheeler, I. Yotov, Coupling discontinuous Galerkin and mixed ﬁnite

element discretizations using mortar ﬁnite elements, SIAM J. Numer. Anal. 46 (2008) 949–979.

[38] S. Sun, M. F. Wheeler, Discontinuous Galerkin methods for coupled ﬂow and reactive transport

problems, Appl. Numer. Math. 52 (2005) 273–298.

[39] S. Sun, M. F. Wheeler, l2(h1) norm a posteriori error estimation for discontinuous Galerkin

approximations of reactive transport problems, J. Sci. Comput. 22 (2005) 501–530.

[40] S. Sun, M. F. Wheeler, Symmetric and nonsymmetric discontinuous Galerkin methods for

reactive transport in porous media, SIAM J. Numer. Anal. 43 (2005) 195–219.

[41] S. Sun, M. F. Wheeler, Analysis of discontinuous Galerkin methods for multicomponent reac-

tive transport problems, Comput. Math. Appl. 52 (2006) 637–650.

[42] S. Sun, M. F. Wheeler, Anisotropic and dynamic mesh adaptation for discontinuous Galerkin

methods applied to reactive transport, Comput. Method. Appl. M. 195 (2006) 3382–3405.

[43] S. Sun, M. F. Wheeler, A dynamic, adaptive, locally conservative and nonconforming solution

strategy for transport phenomena in chemical engineerin, Chem. Eng. Commun. 193 (2006)

1527–1545.

[44] S. Sun, M. F. Wheeler, Discontinuous Galerkin methods for simulating bioreactive transport

of viruses in porous media, Adv. Water Resour. 30 (2007) 1696–1710.

[45] D. Arnold, F. Brezzi, B. Cockburn, L. Marini, Uniﬁed analysis of discontinuous Galerkin

methods for elliptic problems, SIAM J. Numer. Anal. 39 (2002) 1749–1779.

[46] J. Peraire, P. O. Persson, The compact discontinuous Galerkin (CDG) method for elliptic

problems, SIAM. J. Sci. Comput. 30 (2008) 1806–1824.

31

[47] N. C. Nguyen, J. Peraire, B. Cockburn, An implicit high-order hybridizable discontinuous

Galerkin method for nonlinear convection-diﬀusion equations, J. Comput. Phys. 228 (2009)

8841–8855.

[48] N. C. Nguyen, J. Peraire, B. Cockburn, An implicit high-order hybridizable discontinuous

Galerkin method for linear convection-diﬀusion equations, J. Comput. Phys. 228 (2009) 3232–

3254.

[49] L. Ag´elas, D. A. Di Pietro, R. Eymard, R. Masson, An abstract analysis framework for

nonconforming approximations of anisotropic heterogeneous diﬀusion,

Int. J. Finite Vol. 7

(2010) 1–29.

[50] D. A. Di Pietro, A. Ern, Mathematical Aspects of Discontinuous Galerkin Methods (Vol. 69),

Springer Science and Business Media, Berlin, 2011.

[51] P.-O. Persson, A sparse and high-order accurate line-based discontinuous Galerkin method for

unstructured meshes, J. Comput. Phys. 233 (2013) 414–429.

[52] G. Scovazzi, H. Huang, S. S. Collis, J. Yin, A fully-coupled upwind discontinuous Galerkin

method for incompressible porous media ﬂows: High-order computations of viscous ﬁngering

instabilities in complex geometry, J. Comput. Phys. 252 (2013) 86–108.

[53] G. Chavent, J. Jaﬀre, Mathematical Models and Finite Elements for Reservoir Simulation.

Studies in Mathematics and its Applications., Elsevier, North-Holland, 1986.

[54] R. Mose, P. Siegel, P. Ackerer, G. Chavent, Application of the mixed hybrid ﬁnite-element

approximation in a groundwater-ﬂow model – Luxury or necessity, Water Resour. Res. 30

(1994) 3001–3012.

[55] H. Hoteit, J. Erhel, R. Mose, B. Philippe, P. Ackerer, Numerical reliability for mixed methods

applied to ﬂow problems in porous media, Comput. Geosci. 6 (2002) 161–194.

[56] J. Douglas, R. Ewing, M. Wheeler, A time-discretization procedure for a mixed ﬁnite element

approximation of miscible displacement in porous media, Numer. Anal. 17 (1983) 249–265.

[57] B. Darlow, R. Ewing, M. Wheeler, Mixed ﬁnite-element method for miscible displacement

problems in porous media, SPE J. 24 (1984) 391–398.

[58] H. Hoteit, A. Firoozabadi, Multicomponent ﬂuid ﬂow by discontinuous Galerkin and mixed

methods in unfractured and fractured media, Water Resour. Res. 41 (2005) 1–15.

[59] J. Mikysta, A. Firoozabadi, Implementation of higher-order methods for robust and eﬃcient

compositional simulation, J. Comput. Phys. 229 (2010) 2898–2913.

32

[60] M. G. Edwards, Higher-resolution hyperbolic-coupled-elliptic ﬂux-continuous CVD schemes on

structured and unstructured grids in 3-d, Int. J. Num. Methods Fluids 51 (2006) 1079–1095.

[61] H. Hoteit, A. Firoozabadi, An eﬃcient numerical model for incompressible two-phase ﬂow in

fractured media, Adv. Water Resour. 31 (2008) 891–905.

[62] H. Hoteit, A. Firoozabadi, Compositional modeling by the combined discontinuous Galerkin

and mixed methods, SPE J. 11 (2006) 19–34.

[63] H. Hoteit, A. Firoozabadi, Compositional modeling of discrete-fractured media without transfer

functions by the discontinuous Galerkin and mixed methods, SPE J. 11 (2006) 341–352.

[64] H. Hoteit, A. Firoozabadi, Numerical modeling of two-phase ﬂow in heterogeneous permeable

media with diﬀerent capillarity pressures, Adv. in Water Res. 31 (2008) 56–73.

[65] J. Moortgat, S. Sun, A. Firoozabadi, Compositional modeling of three-phase ﬂow with gravity

using higher-order ﬁnite element methods, Water Resour. Res. 47 (2011).

[66] J. Moortgat, Z. Li, A. Firoozabadi, Three-phase compositional modeling of CO2 injection by

higher-order ﬁnite element methods with CPA equation of state for aqueous phase, Water

Resour. Res. 48 (2012). doi:10.1029/2011WR011736.

[67] Z. Li, A. Firoozabadi, Cubic-plus-association equation of state for water-containing mixtures:

Is “cross association” necessary?, AIChE J. 55 (2009) 1803–1813.

[68] J. Moortgat, A. Firoozabadi, Z. Li, R. Esp´osito, CO2 injection in vertical and horizontal cores:

Measurements and numerical simulation, SPE J. 18 (2013). Doi:10.2118/135563-PA.

[69] J. Moortgat, A. Firoozabadi, Three-phase compositional modeling with capillarity in hetero-

geneous and fractured media, SPE J. 18 (2013) 1150–1168.

[70] J. Moortgat, A. Firoozabadi, Higher-order compositional modeling of three-phase ﬂow in 3D

fractured porous media based on cross-ﬂow equilibrium, J. Comput. Phys. 250 (2013) 425–445.

[71] M. A. Christie, M. J. Blunt, Tenth SPE comparative solution project: A comparison of

upscaling techniques, SPE Reserv. Eval. Eng. 4 (2001) 308–317.

[72] J. D. Jansen, R. M. Fonseca, S. Kahrobaei, M. M. Siraj, G. M. Van Essen, P. M. J. Van den

Hof, The Egg model; a geological ensemble for reservoir simulation, Geosci. Data J. 1 (2014)

192–195.

[73] J.

Jansen,

Egg

Model,

http://data.3tu.nl/repository/uuid:

916c86cd-3558-4672-829a-105c62985ab2, 2013.

33

[74] D.-Y. Peng, D. B. Robinson, A new two-constant equation of state, Ind. Eng. Chem. Fundam.

15 (1976) 59–64.

[75] J. Moortgat, A. Firoozabadi, Higher-order compositional modeling with Fickian diﬀusion in

unstructured and anisotropic media, Adv. Water Resour. 33 (2010) 951 – 968.

[76] J. Moortgat, A. Firoozabadi, Fickian diﬀusion in discrete-fractured media from chemical

potential gradients and comparison to experiment, Energy Fuel 27 (2013) 5793–5805.

[77] G. Acs, S. Doleschall, E. Farkas, General purpose compositional model, SPE J. 25 (1985)

543–553.

[78] J. W. Watts, A compositional formulation of the pressure and saturation equations, SPE

Reser. Eng. 1 (1986) 243–252.

[79] E. Shahraeeni, J. Moortgat, A. Firoozabadi, High resolution ﬁnite element methods for 3d

simulation of compositionally triggered instabilities in porous media, Comput. Geosci. 19

(2015) 899–920.

[80] H. Hoteit, P. Ackerer, R. Mose, J. Erhel, B. Philippe, New two-dimensional slope limiters for

discontinuous Galerkin methods on arbitrary meshes, Int. J. Numer. Methods Eng. 61 (2004)

2566–2593.

[81] J. Moortgat, Viscous and gravitational ﬁngering in multiphase compositional and compressible

ﬂow, Adv. Water Resour. 89 (2016) 53–66.

[82] H. Stone, Probability model for estimating three-phase relative permeability, J. Petrol. Technol.

22 (1970) 214–218.

[83] H. Stone, Estimation of three-phase relative permeability and residual oil data, J. Can. Petrol.

Technol. 12 (1973) 53.

[84] K.-A. Lie, S. Krogstad, I. S. Ligaarden, J. R. Natvig, H. M. Nilsen, B. Skaﬂestad, Open source

matlab implementation of consistent discretisations on complex grids, Comput. Geosci. 16

(2012) 297–322.

34

Table 1: Example 1: Grids.

Gird

Hexahedra

Prisms

Tetrahedra 1

Tetrahedra 2

Tetrahedra 3

NK

9, 000

11, 240

9, 000

10, 467

36, 000

NN

10, 659

6, 754

2, 046

2, 611

7, 216

NE

28, 580

29, 734

19, 000

22, 670

74, 300

Table 2: Example 4: Convergence Analysis on Hexahedra.

NK

NN

NE

h (mm)

245, 760

245, 760

753, 664

30, 720

34, 969

96, 256

3, 840

4, 941

12, 544

480

60

775

144

1, 696

244

1.25

2.50

5.00

10.00

20.00

L1 error (×10−3) Convergence rate p CPU time
36 min

-

-

2.55

7.25

17.54

36.32

-

1.51

1.39

1.28

3 min

14 sec

1 sec

< 1 sec

Table 3: Example 4: Convergence Analysis on Tetrahedra.

NK

NN

NE

h (mm)

184, 320

34, 969

376, 832

23, 040

4, 941

48, 128

2, 880

360

775

144

6, 272

1.376

2.752

5.503

848

11.007

L1 error (×10−3)
-

1.89

4.92

16.90

Convergence rate p

CPU time

-

-

1.38

1.58

3 min

14 sec

8 sec

< 1 sec

35

Figure 6: Example 1: Gas saturation after 5 years of depletion, simulated on 5 diﬀerent grids.

36

Figure 7: Example 1: Oil recovery from 20 years of gravity depletion, computed on 5 diﬀerent structured and

unstructured grids.

Figure 8: Example 1: Water saturation after 1 year of ﬂooding, simulated on 5 diﬀerent grids.

Figure 9: Example 1: Oil recovery from 20 years of water ﬂooding, computed on 5 diﬀerent structured and unstruc-

tured grids.

37

0.0 0.1 0.2 0.3 0.4 0.5 0 5 10 15 20 Oil Recovery (fraction) Time (yr)  Hexahedra  Prisms  Tetrahedra 1  Tetrahedra 2  Tetrahedra 3 0.0 0.1 0.2 0.3 0.4 0.5 0 5 10 15 20 Oil Recovery (fraction) Time (yr)  Hexahedra  Prisms  Tetrahedra 1  Tetrahedra 2  Tetrahedra 3 Figure 10: Example 1: Gas saturation after 10% PV of CO2 injection from the bottom, MHFE-DG simulations on

3 diﬀerent grids. Overall CO2 composition is also shown at 30% and 50% PVI on a cross-section at y = 70 m for

both MHFE-DG and lower order MHFE-FV simulations, with arrows indicating the (projected) injection (top) and

production (bottom) well locations.

38

Hexahedra - DG Hexahedra - FV Prisms - DG Prisms - FV Tetrahedra 3 - DG Tetrahedra 3 - FV Hexahedra - DG Hexahedra - FV Prisms - DG Prisms - FV Tetrahedra 3 - DG Tetrahedra 3 - FV 30% PVI 50% PVI Figure 11: Example I: Oil recovery from 20 years, or 1 PV, of CO2 injection from the bottom, computed on 4 diﬀerent

structured and unstructured grids with MHFE-DG and MHFE-FV.

Figure 12: Example 2: Water saturation isosurface (Sw = 0.2) and projected contours (Sw = 0.05 and Sw = 0.1)

at 6% PVI on NK = 29, 791 hexahedral, NK = 35, 030 prismatic, NK = 29, 478 tetrahedra 1, and NK = 55, 566

tetrahedra 2 grids.

Figure 13: Example 2: Overall CO2 molar fraction at 5% PVI CO2 injection from the center for MHFE-FV and

MHFE plus vertex- and face-based DG simulations. Production is from the four corners.

39

0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.0 0.2 0.4 0.6 0.8 1.0 Oil Recovery (fraction) PVI (fraction)  Hexahedra - DG  Prisms - DG  Tetrahedra 2 - DG  Tetrahedra 3 - DG  Hexahedra - FV  Prisms - FV  Tetrahedra 2 - FV  Tetrahedra 3 - FV Figure 14: Example 2: Water saturation for injection from the center with production from all corners. Left ﬁgure
is at 15% PVI for NK = 64 × 64 distorted quadrilateral grid. Right ﬁgure is same NK = 29, 791 hexahedral grid and
Sw = 20% iso-surface at 6% PVI as in Figure 12 but with nodes randomly distorted.

Figure 15: Example 3: Water saturation after 1% PVI of water, simulated on 5 diﬀerent grids with permeability

tensor K+ given in (20).

Figure 16: Example 3: Water saturation after 1% PVI of water, simulated on 5 diﬀerent grids with permeability
tensor K− given in (20).

40

Figure 17: Example 3: Oil recovery from 20 years of water injection from the bottom of a reservoir with permeability

tensor K+ given in (20), computed on 3 diﬀerent grids.

Figure 18: Example 4: Water composition (molar fraction) at 50% PVI on all 5 hexahedral grids as provided in

Table 2.

41

0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0 5 10 15 20 Oil Recovery (fraction) Time (yr)  Hexahedra  Prisms  Tetrahedra 1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0.00 0.10 0.20 0.30 Molar fraction water z (m)  NK = 32×32×240   NK = 16×16×120   NK = 8×8×60   NK = 4×4×30   NK = 2×2×15  Figure 19: Example 5: Compounded mesh before (left) and after applying the coordinate transformation in (21)-(22)

(right), and location of injection and production wells in the ﬁnal mesh. The original mesh on the left consists of
1) a 0.1 km × 0.1 km × 0.08 km cube discretized by 10 × 13 × 10 hexahedral elements, 2) an hour-glass shaped
domain consisting of 10 layers, with the horizontal cross-sections deﬁned by the points (100 m, 0 m), (175 m, 40 m),

(250 m, 10 m), (220 m, 80 m), (165 m, 60 m), and (100 m, 100 m), discredited by 2, 870 prisms, and 3) a 30 m-radius

sphere, discretized by 676 tetrahedra (CDT).

Figure 20: Example 5: Gas saturation after 4 years depletion at 5% PV/yr from the bottom.

Figure 21: Example 5: Water saturation at 10% (left), 25% (middle), and 45% (right) PV of water ﬂooding.

42

Figure 22: Example 5: Overall CO2 composition (molar fraction) at 5% (left) and 10% (right) PV of CO2 injection.

Figure 23: Example 6: Gas saturation for 5% PV/yr methane injection into bottom ﬁve layers of SPE 10 domain at

25% PVI (left) and 70% PVI (right).

Figure 24: Example 6: Gas saturation for 5% PV/yr methane injection into top ﬁve layers of SPE 10 domain at 50%

PVI (left) and 100% PVI (right).

43

Figure 25: Example 6: Gas saturation for 5% PV/yr CO2 injection into Egg reservoir model saturated with oil.

Snap-shots at 5% (top-left), 25% (top-right), 50% (bottom-left) and 65% PVI (bottom-right). Eight injection wells

are indicated in blue, and four production wells in red.

Figure 26: Example 6: Same as Figure 25 but for CO2 injection into Egg reservoir saturated with oil and water

(three-phase ﬂow problem). Snap-shots at 5% (left) and 25% PVI (right). Note that these correspond to a 31% lower

eﬀective pore volume.

44

