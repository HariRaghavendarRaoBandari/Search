6
1
0
2

 
r
a

 

M
8
1

 
 
]

V
C
.
s
c
[
 
 

1
v
2
7
7
5
0

.

3
0
6
1
:
v
i
X
r
a

LearningtoNavigatetheEnergyLandscapeJulienValentin1,3AngelaDai2MatthiasNießner2PushmeetKohli1PhilipTorr3ShahramIzadi1CemKeskin11MicrosoftResearch2StanfordUniversity3UniversityofOxfordAbstractInthispaper1,wepresentanovel,general,andefﬁcientarchitectureforaddressingcomputervisionproblemsthatareapproachedfroman‘AnalysisbySynthesis’standpoint.Analysisbysynthesisinvolvestheminimizationofrecon-structionerror,whichistypicallyanon-convexfunctionofthelatenttargetvariables.State-of-the-artmethodsadoptahybridschemewherediscriminativelytrainedpredictorslikeRandomForestsorConvolutionalNeuralNetworksareusedtoinitializelocalsearchalgorithms.Whilethesehy-bridmethodshavebeenshowntoproducepromisingre-sults,theyoftengetstuckinlocaloptima.Ourmethodgoesbeyondtheconventionalhybridarchitecturebynotonlyproposingmultipleaccurateinitialsolutionsbutbyalsodeﬁninganavigationalstructureoverthesolutionspacethatcanbeusedforextremelyefﬁcientgradient-freelocalsearch.WedemonstratetheefﬁcacyandgeneralizabilityofourapproachbyontasksasdiverseasHandPoseEstima-tion,RGBCameraRelocalization,andImageRetrieval.1.IntroductionRecentyearshaveseenthere-emergenceofthe‘anal-ysisbysynthesis’or’inversegraphics’approachtoCom-puterVisionproblems[3,41,38,26,20,42,43].Thisele-ganttechniqueworksbyﬁndingtheparametersofthesyn-thesismodelthatminimizesthereconstructionerror;e.g.,thedistancebetweensynthesizedandqueryimages.Ithasbeenexploredbyresearchersmanytimes[16,4,45,49]butrepeatedlyfelloutoffavorduetotheperceptionofbe-ingcomputationallyexpensiveandbrittleduetoreconstruc-tionerrorbeinganon-convexfunctionofthetargetvari-ables[25].Morelately,however,theavailabilityoflargedatasetsoftrainingdataalongwiththeabilitytotrainhighcapacitymodelslikeConvolutionalNetworks(CNN)[44,26]andRandomForests(RF)[41,38]havegiventheapproachanewbreathoflife.Thesemodelshaveledtothedevelop-mentofhybridarchitectures,wherediscriminativelytrainedfeed-forwardpredictors(RFsorCNNs)areusedtoinitial-1Allofourdatasetsarepubliclyavailable(fordetails,seeSec.7.3.):http://www.graphics.stanford.edu/projects/reloc/izecontinuouslocalsearchalgorithms.Whilethesehybridtechniqueshavebeenshowntoproduceimpressiveresults,itishardtomakethemworkrobustlyinrealtime.Thisisinlargepartduetothecostofcomputingthederivativeofthereconstructionerrorwithrespecttothemodelparame-ters,asitisafunctionoftherenderingprocess.Althoughgradient-freeoptimizationmethodssuchasParticleSwarmOptimization(PSO)exist,theysufferfromtheproblemthatgenerativemethodsoftenrequireasigniﬁcantamountofer-rorevaluationstoconvergetogoodsolutions.Thiscanbeveryexpensive,aseacherrorevaluationrequiresperform-ingarenderingoperationon-the-ﬂy2.Anothermajorobsta-cleisthatitisnon-trivialtoextractgoodsearchseedsinsuperreal-time.Thisisarequirementforanycontinuousorstochasticoptimizationoperatingonanon-convexsurfacetoconvergetogoodminimawhileallowingtheentireopti-mizationpipelinetoruninreal-time.Thereisthenaneedforﬂexibleandgeneraloptimizationframeworksmimick-ingthegenerativeoptimizationprocedure,butordersofmagnitudefasterthanthecurrentmethods.Inthispaper,weproposeanewgeneralframeworkforminimizingthereconstructionerroremanatingfromtheanalysisbysynthesisapproach.Ourapproachisbasedonintegrationoftwosearchstructures:retrievalforestsandanavigationgraph.Theretrievalforestiscomposedofacol-lectionoftrees,eachofwhichoperateslikealearned,con-ditional,localitysensitivehashfunctionthatmapstoahashtablebucket(leaf)whereasubsetoftheinstancesfromthetrainingsetarestoredwhichcanbeusedascandidatesforlocalsearch.However,insteadofcomputingthederivativeoftherenderingpipelineordoingablindsearchlikePSO,ourlocalsearchmethodoperatesbytraversingahierarchi-calnavigationgraphdeﬁnedontheparameterspace.Eachinstanceinthetrainingsethasacorrespondingvertexinthegraphwhichisconnectedwithasetofneighboringvertices(ideallyi.i.d.distributedinparameterspacearoundthatver-tex)accordingtoadistancemeasure.AsimplechoiceforthedistancefordeﬁningtheneighborhoodistheL1-orL2-distanceindescriptor-space,asitisinvolvedinthecom-putationofthereconstructionerror,butL2-distanceintar-getparameterspacecanalsobeusedtobuildthegraph.2Itisworthnotingthatitissometimespossibletoalleviatethoselimi-tationsbyheavycodeengineering[38]torendersmallimages.1Traversaloftheedgesinthisnavigationalgraphcanbeseenasmakingupdatesintheparameterspaceintheroughdi-rectionofthegradientminimizingthereconstructionerror.Webuildthisnavigationalgraphwithmultiplelevels,whereverticesinhigherlevelsaremoresparse,allowingforlargerjumpsacrosstheparameterspace.Duringtesttime,weuseacollectionofdiscriminativelytrainedretrievaltreestoproposecandidateverticesfromwherethelocalsearchshouldbeinitiated.Wethenre-peatedlyconsideralltheneighborsofthecandidatever-tices,computethedistancebetweenthemandthequeryimage(reconstructionerrororsurrogateerror),andselectthosehavinglowesterrorascandidatesforfutureexplo-ration.WeconsideraNavigationGraphtobeconvergedwhennonewverticeswithabetterenergycanbereached.Then,weinitiateanewsearchusingthenextGraphinthehierarchy,andproceeduntiltheconvergenceofalltheNav-igationGraphsinthehierarchy.Atthisstage,thebestpre-dictioncanbedirectlyusedasaprediction.Alternatively,themostpromisingpredictionscanbeusedtoseedacontin-uous(e.g.,Levenberg-Marquardt)orstochasticprocedure(e.g.,ParticleSwarmOptimization)forafewstepsoflocalandﬁnalreﬁnement.WeﬁrstdemonstratetheefﬁcacyandgeneralizabilityofourapproachonHandPoseEstimationandImageRetrievaltasks.WealsodemonstratetheefﬁcacyofourapproachontheproblemofRGBCameraRelocalization.Tomakethisproblemparticularlychallenging,weintroduceanewdatasetof3Denvironmentsthataresigniﬁcantlylargerthanthosefoundinotherpublicly-availabledatasets.Ourex-perimentalresultsindicatethatthecompositeretrievaltree-navigationgrapharchitecturenotonlyleadstodramaticim-provementsincomputationtimebutalsoresultsinmoreac-curatesolutions.Tosummarize,themaincontributionsofthisworkare(i)anewgradient-freeheuristicoptimizationmethodbasedonnavigationalgraphsthatisfastandaccurate,(ii)theintroductionofanewpublicdatasetforRGBandRGB-Drelocalizationthatissigniﬁcantlylargerthatthosecur-rentlyavailable,(iii)thedemonstrationthatourapproachisgenericandreachesstate-of-the-artresultsonthreeverydistinctvisionproblems,namelyRGBcamerarelocaliza-tion,handposeestimation,andimageretrieval.2.RelatedworkWebrieﬂyintroducepopularmethodsforapproximatenearestneighborsearchinthenextfourparagraphs.Were-fertheinterestedreaderto[15,14,24,10,48,36,47]and[41,38]forrelevantlitteratureonRGBcamerarelocaliza-tionandHandPoseEstimation,respectively.LSHAnumberofpapersintheliteraturehaveconsid-eredtheuseofhashfunctionsforsolvingregressionprob-lemssuchashumanposeestimation[37].Thesearebasedontheconceptoflocalitysensitivehashing(LSH)[19],us-ingseveralrandomprojectionfunctionstohasheachpointofthedatasetsothatsimilaritemsmaptothesamebucketwithhighprobability.Ourapproachisrelatedtothepose-sensitivehashingmethod[37],astheyfocusonretrievingneighborsinthelatentlow-dimensionalmanifoldwherethedatalives(articulatedhumanpose)ratherthantheobservedspaceofimages.Inthispaper,themaintargetistomini-mizethecameraposedistancebetweenthepredictionsandtheactualposesofthe‘lost’cameras.Intheirinﬂuentialwork,theauthorsof[34]showhowtousesimpleapproximationsthatallowbetterprobingse-quencesforLSH.TheirmultiprobeLSHledtoimprove-mentsinbothspaceandtime.SigniﬁcantworkonbuildingefﬁcientindexthatcanbeusedbyLSHinclude[50]wheretheauthorsproposeacompoundsrepresentationbydecom-posingimagesintobackgroundandimage-speciﬁcinforma-tion.ForadditionaldetailsonLSH,see[33,1,34].KD-treeContrarytoLSH,aKD-tree[5,12]recursivelypartitionsthespacewithaxis-alignedhyperplanesthatsplitthedataintwohalves.Notableworkinthisareainclude[32]wheretheauthorsbuildahierarchicalk-meanscluster-ingandthewidelyusedlibrarybasedon[28]MoredetailsaboutdifferentvariantsofKD-treecanbefoundin[7].Derivative-freeoptimizationParticleSwarmOptim-mization[23],CuckooSearch,andGeneticAlgorithmsaresearchheuristics.Thecommonideabehindthesemeth-odsistoperturbatethecurrentsolutionset(randomi.i.d.jumps,mutations,etc.)inthehopeofﬁndinganewsolu-tionsetthatbetterexplainsthetarget.Inthecontextofhandposeestimation,suchmethodscanbeused[18]toitera-tivelyreﬁnetheposeparametersthatbestexplaintheinputimage.Wereferthereaderto[8]forextensivediscussionsonderivative-freeoptimization.k-NNgraphsThereareanumberofworksthatfocusonhill-climbingstrategiesork-NNgraphs,buttothebestofourknowledgetherehasbeenonlyoneattemptatper-forminghill-climbingonk-NNgraphs[17].Thisworkisthemostrelatedtoours;however,weintroduceseveralsigniﬁcantdifferences.First,[17]startstosearchfromapointdrawnrandomlyfromauniformdistributionoverthedatabase.Followingsuchastrategyispronetoreachingpoorminima,especiallyforlargeanddiversedatabases.Tocircumventthisproblem,[17]allowsthesystemtorestarttheentiresearchwithanewseedapre-deﬁnednumberoftimes,whichisrelativelycomputationallywasteful.WethenproposetotrainaRandomForestadaptedforretrievalthatwillveryquicklygenerateseedsthatareingeneralmuchclosertotheminimareachedafteroptimization(i.e.lessedgesaretraversed).Thusweareabletoreachbet-terresults,faster.Second,[17]onlyexploresonepathatatime,whichisextremelygreedy.Similartobio-inspiredtechniques,weexploreand‘optimize’multiplehypothesisatonce.Again,thismakethesearchlesspronetogettingstuckinbadlocalminima.Alltheseelementscontributetoamethodthatsigniﬁcantlyoutperforms[17].3.MethodOverviewTheproposedmethodisessentiallyadiscreteoptimiza-tiontechniquethatusesahierarchicalnavigationgraphandaretrievalforest.Webuildthegraphusingmultipledistancemeasuresinordertodecreasethenumberoflocalminima,andusethereconstructionerror(orasurrogate)whennav-igatingthroughthegraph.Wediscriminativelytraintreestogenerateseedstoinitiatethenavigationintheﬁrstgraphinthehierarchy.Thesearchstartsfrommultipleseeds,tra-versesthehierarchyofnavigationgraphs,andﬁnallyout-putsanumberofsolutionswhichareusedtoinitiatethecontinuousoptimizationstepifreﬁnementisneeded.Aretrievalforest[13]outputsalistofsamplesforeachtree,whicharerankedbasedonhowmanytimestheywereselected.Thetop-rankingverticesareusedtoinitiatethesearchinthetoplevelofthenavigationgraph.Ateachiterationofthesearch,acandidatesolutionlistisexpandedbyincludingallneighborsofthecurrentesti-mates.Thequeryimageiscomparedagainstthislistusingthereconstructionerror(orasurrogatemeasure),andtheresultingenergiesusedtorankthecandidates.Afewtop-rankingverticesarethenusedtoinitiatethenextiterationofthesearchinthesamelevelofthegraph.Ifthecandi-datesolutionsetdoesnotchangethroughouttheiteration,orifamaximumnumberofiterationsaremet,wecontinuethesearchinthenextlevelofthehierarchy,usingtheﬁnallistofverticesfromthepreviouslevelasseeds.Oncethesearchconcludesinthebottomlevel,thesolutionisﬁnalandcanoptionallybesenttoacontinuousoptimizer(e.g.PSO,gradientdescent).4.RetrievalForestsAretrievalforest[13]isarandomizeddecisionforest(RDF)[9],whichactsasahashfunctionthatassignseachquerytoaleaf.TheleavesofatypicalRDFstoreanem-piricaldistributionoverthesamples.Inretrievalforests,theleavesactastheentriesofalookuptableandstorethein-dicesofdatasetelements.Duringinference,eachtreevotesforasetofelementspresentinthetrainingset,andwecountthenumberofvotesperelementinordertorankthem.Weusethestandardgreedytreetrainingalgorithmtogrowthetrees.Eachtreeistrainedwithsomerandomnessfromtherandomgenerationofpairsoffeatureindicesφandthresholdsτ,andoptionallyalsofrombagging.Wedenoteeachpair(φ,τ)asθ,andthesetofcandidateran-domparametersθinnodenasΘn.Eachnodenusestherandomly-generatedΘntogreedilyoptimizeθ∗n=argmaxθ∈ΘnIn(θ),(1)whereInistheinformationgain:In(θ)=E(Sn)−Xi∈{L,R}|Sin||Sn|E(Sin),(2)Here,E(S)isameasureofthedifferentialentropyofthesetSindescriptorspace.NotethattheleftandrightsubsetsSinareimplicitlyconditionedonthecandidateparametersθ.Asin[46],weusethedeterminantofthecovariancematrixastheentropymeasure.Hashfunctionstypicallyusedenseprojections,whileweperformverysparseprojectionstotraverseourtreesmoreefﬁciently.Theresultsobtainedusingtheretrievalforestarethenfurtherreﬁnedinthenextphasesofthepipeline.5.MultiscaleNavigationGraphThecoreofourdiscreteoptimizationmethodisthemul-tiscalenavigationgraph,whichallowsforrapidreﬁnementofasetofinitialestimatesinsolutionspace.Theinitialseedsareprovidedbytheretrievalforest(cf.Section4),whicharetoocrudetobeuseddirectlyinagradient-basedcontinuousoptimizerwithoutarobustreﬁnementproce-dure.Thegraphsearchrapidlyreﬁnesthesesolutionswhileavoidingmostlocalminima.Fig.1offersanintuitionabouttheoptimizationprocedure.WestartbyconstructingamultiscalegraphG=(V,E)fromasetofsamples,wheretheverticesVaretheindivid-ualsamplesandthedirectededgesEareformedbetweenverticespandq,ifqisamongtheknearestneighborsofp.Thegraphconsistsofmultiplelevelscorrespondingtodifferentscales,eachdescribedwithanadjacencylistGi,muchlikeapyramid.Whiletoplevelholdsafractionofallsamples,chosenuniformly,thebottomlevelkeepsallthesamplesinthedataset.Everyvertexinahigherlevelofthegraph,mustappearineverylevelbelowit.kneighborsarecalculatedseparatelyforeachlevel.NotethatE(p,q)doesnotnecessarilyimplyE(q,p)sincenearestneighborrelationshipsarenotsymmetric,evenifthedistancemetricis.ThedistanceDmbetweensamplespandqisdenotedbyDm(p,q),wheremdenotesthemetricused(e.g.,Euclideandistanceinacertainspace).ThegraphsearchalgorithmisexplainedinAlgo.1.Givenaqueryt,thesearchstartsinthetoplevelgraphGTfromaninitialsetofseedsC,whichisprovidedbythere-trievalforestasdescribedintheprevioussection.Acandi-datelistC0isthenformedfromsamplesinCandalltheirneighbors.ForeachcandidateinC0,wemeasuretheirdis-tanceDttothequery.NotethatthedistancemeasureDmusedtobuildGisnotnecessarilythesameasDt.Werankthesecandidatesbasedontheirdistancesandchoosensam-plestoreplaceC.IfCdoesnotchangeinagiveniteration,orifamaximumnumberofiterationsisreached,weswitchtothenextgraphinthehierarchy,initiatinganewsearchwiththesetCwherethepreviousgraphconvergedto.TheCfromtheﬁnallevelinthehierarchyistheoutputofthediscreteoptimizationmethod.Figure1.IntuitionforNavigationGraphs.Left:query;right:reconstructionerrorasafunctionoftheposeparameters.Thecurrentcandidateposeishighlightedinorange;theoptimizationprocessconsistsofestimatingwhetheranyofitsneighbormini-mizesthereconstructionerroranyfurther.Ifthisisthecase,theoptimizationmayconsiderthemaspotentialdescentdirections.Orangearrowsmarkconnectionsbetweencandidates,andbluear-rowsdenotetheirpositionsonthesolutionmanifold.6.ContinuousPoseReﬁnementTheprevioussectionhasdescribedhowgoodcamerahy-pothesescanbeformed.Usingthesehypothesis,wefollow[30,11]andminimizethephoto-consistencyerrorinordertomakeaccurateposepredictions.Givenaninitialposehy-pothesispandaqueryimageCq,weoptimizefortherigidbodytransformbetweenpandCqbyminimizingthepro-jectionofthemodelofthesceneMtoCq.Atanystageoftheoptimization,weraycastMfromthecurrentposeofhy-pothesispandproduceacolorimageCmandadepthimageDm.WethenoptimizetherigidtransformTtomaximizethephoto-consistencywhenprojectingCmintoCqusingDm.LetGdenotetheintensityimageofCm,πdthedepthcameraprojection,andπcthecolorcameraprojection(πdandπcaredeﬁnedbytherespectivecameraintrinsics),thenthephoto-consistencyerrorisgivenasEc(T)=#pixelsXk(cid:13)(cid:13)(cid:13)Gq(πc(Tπ−1d(Dm(k))))−Gm(k)(cid:13)(cid:13)(cid:13)22.Notethatwediscardpixelswithinvaliddepth.Thenon-linearleast-squaresobjectiveEcissolvedusingGauss-Newtonoptimization.Weuseahierarchicalcoarse-to-ﬁneoptimizationstrategy,withtheﬁnesthierarchylevelcon-tainingthefullcolorresolution,andeachsubsequenthier-archylevelsub-sampledbyafactorof2.Then,forqueryimageCqanditstopkposeproposalsp1,...,pk,weminimizeEcforeachposeproposal,produc-Algorithm1:GraphtraversalInputs:Anewtestsamplet.MadjacencylistsdenotedGm,deﬁningeachlevelofthemultiscalegraphstructureG.AfunctionDthatestimatessomedistancebetweentwoimages.AsetSofseeds.Anumberofmaximumiterationsitmax.AdesirednumberofpredictionsK.Amaximumnumberofverticestokeepaftereachiterationn.Output:KapproximatenearestneighborsoftAlgorithm:C=Sforlv=Mto1doforit=1toitmaxdoC0=Cforeachc∈CdoUsingtheneighborhoodstructuredeﬁnedinGlv,addallunvisitedneighborsofcintoC0withoutrepetition,andmarkthemasvisitedendSortC0accordingtoDcomputedbetweentandeachelementofC0.C=ﬁrstnelementsofC0ifChasnotchangedthisiterationthenbreakendendendreturnﬁrstKelementsofCingpotentialreﬁnedposesp01,...,p0k.Theﬁnalreﬁnedposep∗isthengivenbytheposep0iwithi=argminjEc(p0j).Asthisoptimizationisstraightforwardtoparallelize,wecaneasilycomputeTonaGPUwithinonlyafewmillisecondsforagivenimagepair.7.ResultsWeevaluateourmethodonthreeimportantcomputervi-siontasks.First,weshowresultsonHandPoseEstimation;second,weprovideanevaluationonapproximatenearestneighborqueriesforImageRetrieval;third,weshowresultsonRGBrelocalization.Ourmethodoutperformsthebase-linesinallexperiments,bothinaccuracyandspeed.Open-sourcecodeforretrievalforestsandNavigationGraphswillbereleaseduponacceptance.7.1.ExperimentsonHandPoseEstimationInthissection,weﬁrstevaluateourmethodonthetaskofhandposeestimationusingthesyntheticdatasetfrom[38].Thisdatasetcomprises100ktrainingand10ktestFigure2.Precisionofhandposepredictions.Theabscissade-ﬁneshowmanyseedsareusedforanygivenhandimage,andtheordinaterepresentstheclosestofthoseseedsinaveragejointerror.TheseresultsaregeneratedbyconsideringthetopKsamplesfromwhichwedeterminethelowestaveragejointposeerrorusinganoracle.Notethatourmethodnotonlyprovidesmorepreciseseedsthan[41]butalsoextractsthemanorderofmagnitudefaster.handposesthathavebeengeneratedbyrenderingdepthim-agesofasynthetichandmodel.Formoredetailsregardingthedatasetgeneration,wereferthereaderto[38].Inourexperiments,wecompareourresultstothelateststateoftheart[41].Wefollow[40]andusetheaveragejointposeasanerrormetric.InFig.2,weshowthatregardlessofthenumberofseedswepredict,ourmethodisconsistentlybetteratpredictinghandposesofloweraveragejointposeerrorthan[41].Furthermore,weextractourseedsanorderofmagnitudefasterthan[41].WefurthercomparedourmethodonDexter[40],NYU[44]andFingerPaintdatasets[38]whichonlycontainrealimages.InFig.3weshowthattheproposedmethodsig-niﬁcantlyoutperformsRetrievalForestonlyandthereini-tializerpresentedin[38].Wealsodemonstratethepowerofourmethodunderthepresenceofapowerfulcontinu-ousLMbasedoptimizer,whereourmethodgenerates10seedsperframetoinitiatethegradientdescent.Eachframeistreatedindependently(i.e.withouttracking)toproperlyshowtheeffectofusingourreinitializerinsteadoftheonepresentedin[38].OurmethodshowssigniﬁcantgainsonDexterandNYU,andshowsonparresultsforFingerPaint.Thecontinuousoptimizationmethodandmoreexperimen-talresultscanbefoundin[2].7.2.ExperimentsonImageRetrievalInthissection,wedemonstratetheperformanceoftheproposedNN-searchmethodonawell-establishedimageretrievaldataset,GIST-1M[21].IntheexperimentspresentedinFig.4,wecompareourworkagainstallthebaselinemethodsimplementedintheFigure4.ResultsontheGIST-1Mdataset[21].Intheseexperi-ments,thetaskistoretrieve100neighbors,withrecallcomputedagainsttheactual100nearestneighbors.ForourMultiscaleNav-igationGraph,weuseahierarchyof2graphswheretheﬁrstcon-tains1/10thofthedatasetandthesecondcontainsallofit.OurmethodoutperformsallthebaselinesinFLANNinalmostanyregime.NotethattheRetrievalForestisnotplottedonthisﬁg-ure,butreachesaspeed-upoverlinearsearchofaround6500forarecallof2.07%.FLANNlibrary[28]usingthecodeprovidedontheauthors’websiteaswellasourownimplementationof[17](referredtoasGNNS).Notably,ourproposedmethodsigniﬁcantlyoutperformsallbaselinesfromFLANNwithacomparablecomputebudget.Forinstance,at450×speedupoverlinearsearch,thehierarchical,k-means,andcompositebaselinesfromFLANNonlyattainhalftherecallofourmethod.Ad-ditionally,ourmethodiscapableofreachingevenhigherrecallratesifmorecomputebudgetisavailable.Witha5msbudget(onalaptopcomputer),weachieverecallratesover70%,correspondingtoa60×speedupcomparedtolinearsearch.Notethattoprovideafaircomparisonagainst[17],wesetthenumberofrestartstobethesameasthenumberofseedsweextractfromtheretrievalforest.7.3.RGBRelocalizationDatasetThemaindatasetcurrentlyusedforRGBandRGB-Drelocalizationisthe7-Scenesdataset[39,15].ThisdatasetcontainsseveralscenesrecordedfromaKinectV1.Thesescenesareallverylimitedenvironments(atmost6m3),forwhichextremelypreciseresultshavealreadybeenreached[46].Amajorincreaseinthevolumeinwhichtorelocalizeisaclearwaytomaketherelocalizationprob-lemmorechallenging.Additionally,the7-Scenesrecord-ingssufferfromlowcolorquality(VGAresolution,motionblurartifacts,auto-whitebalance,auto-exposure)andnoex-ternalcalibrationbetweenthedepthandRGBsensors.Astheseissuesarealleasilysolvablehardwareorcalibrationproblems,theyshouldnotbepartofbenchmarkevaluationsDexterNYUFingerPaintFigure3.Handposeestimationonrealdata.Firstrow:pureposeregression.Secondrow:regressedposesoptimizedusingtheframeworkpresentedin[2]ofrelocalizationtechniques.Fig.6illustratestheseeffectsonthescenemodelquality,whichisamajorobstacletosynthesizingRGBframesconsistentwiththerealworld.WethusintroduceanewdatasetwhichwebelievewillallowthecommunitytopushtheboundariesofRGBandRGB-Drelocalizationfurther.UsingaStructure.iodepthsensorcoupledwithaniPadcolorcamera,wecapturevari-ousenvironmentsofsigniﬁcantphysicalextent(volumesanorderofmagnitudelargerthanthoseof7-Scenes),ascanbeobservedinTab.1.Notethatbothcamerashavebeencal-ibratedandtemporallysynced.RGBimagesequencesarerecordedataresolutionof1296×968pixels;thedepthres-olutionis640×480andofsimilarqualitytotheKinectV1.WecapturefourlargeRGB-Dscenes,eachofwhichiscomposedofseveralroomsasshowninFig.5.Foreachscene,twoindependentcapturesareperformed.Theﬁrstcaptureisusedtoreconstructascenemodel,withre-constructionperformedusingtheVoxelHashingframeworkof[31]incombinationwithglobalbundleadjustment.Thisreconstructionprovidesthegroundtruthcameraposes(6d.o.f.)foreachframe.WethenuniformlysampleaﬁxednumberofposesaroundthosegroundtruthcameraposesandsyntheticallyrenderthecorrespondingRGBimages.Thisprocedureisusedtoformthetrainingset.Thesecondrecordingisalsoreconstructedandbundleadjusted.Then,manualalignmentbetweenthetwomodelsisperformed.TheRGBimagesandcameraposesofthissecondrecord-ingcorrespondtoourtestset.Notethatthedataset(RGB-Dframes,ground-truthposes,and3Dmodels)willbemadepubliclyavailabletothecommunity.ParametersettingsTheparametersofthesystemareSequenceVolume#trainingframes#testframesKitchen33m37160357Living30m310554493Bath24m322500230Bed14m317800244Kitchen21m314665230Living42m334280359Luke53m338382624Floor5a38m310680497Floor5b79m310360415Copy26m313640649Gates36229m318641386Gates38144m3202401053Lounge38m33160327Manolis50m317940807TOTAL521m32400026671Table1.Physicaldescriptionofournewdataset.Therecordedenvironmentsaresigniﬁcantlylargerthanthelargestenvironmentofthe7-Scenesdataset(6m3).heldconstantforallrelocalizationscenarios.Theretrievalforestiscomprisedof64treeswithamaximumdepthof13,whereeachdecisionnodeonlyuses2dimensionsoftheinputvectortoroutethesamples.FortheMultiscaleNavigationGraph,atanystage,the20closestneighborsofeachcandidateareconsideredandthe10bestcandidatesarepassedtothenextiterationoveramaximumof5iterations.The4topcandidatesarethenpassedtoaposereﬁnementstep.ContinuousPoseReﬁnementSimilarlyto[46,39]whichperformRGB-Drelocalizationbyﬁrstgeneratinghy-Figure5.AnewpublicdatasetforRGBandRGB-Dcamerarelocalization.Ournewdatasetcomprisestwoapartmentsandtwoofﬁcescenes.Thereisatotalof14rooms,eachofwhichareindividuallylargerthanthelargestsceneof[39].Ourdataset7-Scenes[39]Figure6.Qualitativedifferencebetweenourdatasetmodelsandthoseof[39].Bothimagesareraycastfromtheirrespective3Dmodels.NotethatweareabletosynthesizeRGBframesofmuchhigherquality.pothesisandthenoptimizingtheminacontinuousfashionforhighprecision,werunacontinuousposeoptimizerontopofthetoppredictionfromourmethod.Todoso,wefollow[30,11]andminimizethephoto-consistencyerror.Itisworthnotingthattheenergysurfaceisnon-convexandhencegoodinitialcandidatesareessentialtosustaingoodrelocalizationrates.Werefertheinterestedreadertothesupplementarymaterialsformoredetails.Notethatpre-cisecamerarelocalizationisrequiredinapplicationssuchasSLAMwhereitallowsthesystemtorecoverfromtrack-ingfailures.SpeedOnalaptopequippedwithani7-4720HQ,passinganewsampledowntheentiretestpipeline(retrievalforestandMultiscaleGraphNavigation)takeslessthan1ms.WeruntheposereﬁnementstepontheGPUusinganNVIDIAGTXTitan,whichtakeslessthan10mstofullyoptimizeeachposeproposal.Foreachquery,weonlyoptimizethetop4poseproposalsfromtheMultiscaleGraphNavigation.BaselinecomparisonsWecompareourapproachagainsttwoRGBrelocalizationbaselinebaseduponmatchingsparsefeatures,followingmainstreamfeature-basedrelo-calizationapproachessuchas[47,10,29].Thoseap-proacheseitherusetheSIFTortheORBalgorithmforsparsefeatureextractionanddescription.First,sparsefea-turesaredetectedintheRGB-Dtrainingimages,whicharestoredwiththeircorresponding3Dpositionsanddescrip-tors.Attesttime,descriptorsarecomputedperqueryframeandmatched.Tripletsofstrongfeaturematchesarethenusedtogeneratecandidatecameraposesusingtheperspec-tive3-pointmethod.ThesehypothesesarereﬁnedusingaRANSACoptimization.Notethatduringtrainingandtest,atmost100SIFTfeaturesor1000ORBfeaturesareex-tractedperimage.Inordertomaximizetherelocalizationperformacneofthebaselines,weusebruteforcefeaturematchingfollowedbyRANSACPnPfromOpenCV’s[6]implementation.ItisworthnotingthatwedonotcompareagainstPoseNet[22]astheonlydatasetforwhichtheyreportre-sultsandwecouldpotentiallyuseis7-Scenes[39].Asde-scribedearlierinthepaper,thetestrelocalizationpipelineforpreciseestimatesrequiresagoodcalibrationbetweenthecoloranddepthsensors,whichisnotthecaseinthe7-Scenesdatasetwherenoexternalcalibrationhasbeenpro-vided.Nevertheless,itisworthnotingthattheresultsob-tainedbyPoseNetareonlyslightlybetterthanthoseofnear-estneighbors.ThebestresultsfromPoseNetrequires95msonaGPU.Usingthisbudget,wecouldfullyoptimize115camerasusingthemethodpresentedinthispaper.Togetafeelforwheretheproposedmethodstands,weranonlytheRetrievalForestandNavigationGraphsonthe7-Scenesdataset.Onaverage,weretrievethenearestneighbor97%ofthetimewithanaveragerun-timeof1ms(CPU).MainrelocalizationresultsFig.7showsqualitativere-sultsobtainedbytheMultiscaleNavigationGraphwhenfedwithseedsgeneratedbytheretrievalforest.Theﬁrstpre-dictionsarevisuallyverysimilartothequeries.Thepredic-tionsfromMultiscaleNavigationGraphoftencontainthesameobjectsasthequery,butsometimesfromslightlydif-ferentviewpoints.However,Fig.8showsthatthesepre-dictionsstilllieintheconvergencebasinofthecontinuousposereﬁnement.Table2liststhemainquantitativeresultsonourrelocal-izationdataset.Onaverage,theproposedsystemisabletorelocalize67.4%ofthequerieswitherrorbelow5cmand5◦.Forapplicationsthatdon’trequirethislevelofpreci-sion,ourmethodscores88%within30cmand10◦.Comparatively,thesparserelocalizationbaselineofSIFTmatchingandRANSACPnPposereﬁnementresultsinanaveragerelocalizationrateof51.8%within5cmand5◦.Thoseresultsareobtainedin≈1500ms,whereasourMultiscaleNavigationGraphfollowedbycontinuousposeoptimizationrunsin≈40ms.ByreplacingSIFT[27]withORB[35],speedincreases3×,butaccuracyfalls5-10%.Thus,weprovidebothbettercameraposeestimatesandfastperformance.Webelievethattheseresultswouldbeverybeneﬁcialtomanyapplications.SequenceORB+PnPSIFT+PnPOurmethodKitchen66.39%71.43%85.7%Living41.99%56.19%71.6%Bath53.91%48.70%92.2%Bed71.72%72.95%66.4%Kitchen63.91%71.74%76.7%Living45.40%56.19%66.6%Luke54.65%70.99%83.3%Floor5a28.97%38.43%66.2%Floor5b56.87%45.78%71.1%Copy43.45%62.40%51.0%Gates36249.48%67.88%51.8%Gates38143.87%62.77%52.3%Lounge61.16%58.72%64.2%Manolis60.10%72.86%76.0%Average52.99%61.56%67.4%Table2.MainquantitativeresultsforthetaskofRGBrelocal-ization.Foreachsequence,weshowthepercentageofreﬁnedposeswithin5cm/5◦forourmethodandgenericbaselines.NotethatthebaselineswithORBandSIFTareﬁrstoptimizedusingaPnPoptimizationoverRanSaCrounds.ForSIFT+PnP,notethatweuse100featuresperimage.ForORB+PnP,weuse1000fea-turesperimage.Also,notethatthefeaturematchingforSIFTandORBisdoneexactlyviabrute-forcematching.However,despitetherelativelygoodqualityreconstruc-tionswhichweobtain,all3Dmodelsstillremainincon-sistentwiththerealworldduetotrackingerrorsinthere-construction,aswellasotherartifactssuchasmotionblur.Infact,ourmethodwouldbeabletoprovidemuchmoreaccurateresultsifthetrainingandtestimageswereconsis-tentwitheachother;e.g.,generatedfromthesamemodel.Wesetupsuchanexperiment,generatingqueryimagesbyraycastingthescannedscenesratherthanusingtheorigi-nalcolorframescapturedbytheiPadcamera.Inthiscase,weobtainsigniﬁcantlyhigheraccuracy,asshowninFig.9.Thissuggeststhatthereisroomforimprovementbyusingmoreaccuratemodels;however,itisquitechallengingtoreconstructlargescenesatmillimeter-levelaccuracy.MemoryForallsequences,werequirelessthan25MBmemory.NotethatloadingeverythingintoRAMisnotre-quiredandthatlazydataaccessispossibleifnecessary.8.ConclusionInthiswork,wepresentedanoveldiscreteoptimizationmethodanddemonstrateditsapplicabilitytoseveralcom-putervisiontasks,includingRGBrelocalization,handposeestimation,andnearestneighborqueriesforimageretrieval.Atthecoreofthepipelineliesourmultiscalenavigationalgraph.Givenalistofseedspredictedbyarandomfor-est,thegraphsearchquicklytraversesthediscretemanifoldQuery1stpred.2ndpred.3rdpred.Figure7.QualitativeresultsfromtheMultiscaleNavigationGraph.Givenaqueryimage(leftcolumn)andseedsfromtheretrievalforest,thegraphsearchproducesviewpointstothequery.Ourmethodisrelativelyrobustevenwhensomedataismissingfromthesyntheticviewsorwhentheilluminationchanges.QueryToppred.ReﬁnedposeFigure8.Continuousposereﬁnementforpredictedcam-erahypotheses.Fromaqueryimage(leftcolumn),thegraphsearchsearchesforthemostsimilarviewpoints.Fromthetop4predictedviewpoints(thetoppredictionshowninthemiddlecolumn),weoptimizefortheﬁnalposebyminimizingphoto-metricerror.ofsolutionsinordertomakefastandaccuratepredictions.Thesepredictionscanthenbefurtherreﬁned;forinstance,inthecaseofRGBrelocalization,werunacontinuousposeoptimizationforprecise6DOFcameraposeinference.Thesameappliestotheresultswehaveshownonhandposeestimationandimageretrievaltasks.References[1]A.Andoni,P.Indyk,H.L.Nguyen,andI.Razenshteyn.Beyondlocality-sensitivehashing.InProceedingsoftheTwenty-FifthAnnualACM-SIAMSymposiumonDiscreteAl-Figure9.Precisionoftherelocalizationaveragedacrossallscenes.Thevalueoftheplotat(x,y)representsthe%ofpre-dictedcameraswithtranslationalandrotationalerrorlowerxandy.Left:precisiononrealworldtestdata.Right:precisiononsynthetictestdata.gorithms,pages1018–1028.SIAM,2014.2[2]Anonymous.Concerto:Efﬁcientandpreciseinteractivehandtrackingthroughjoint,continuousoptimizationofposeandcorrespondences.InProc.ACMSIGGRAPH.ACM,2016.5,6[3]J.T.BarronandJ.Malik.Shape,illumination,andre-ﬂectancefromshading.TPAMI,2015.1[4]B.G.Baumgart.Geometricmodelingforcomputervision.Technicalreport,DTICDocument,1974.1[5]J.L.Bentley.Multidimensionaldivide-and-conquer.Com-mun.ACM,1980.2[6]G.Bradski.Dr.Dobb’sJournalofSoftwareTools,2000.8[7]R.A.Brown.Buildingabalancedk-dtreeino(knlogn)time.CoRR,abs/1410.5420,2014.2[8]A.R.Conn,K.Scheinberg,andL.N.Vicente.Introductiontoderivative-freeoptimization,volume8.Siam,2009.2[9]A.CriminisiandJ.Shotton.Decisionforestsforcomputervisionandmedicalimageanalysis.Springer,2013.3[10]E.EadeandT.Drummond.Uniﬁedloopclosingandrecov-eryforrealtimemonocularslam.InBMVC,volume13,page136.Citeseer,2008.2,7[11]J.Engel,T.Sch¨ops,andD.Cremers.Lsd-slam:Large-scaledirectmonocularslam.InEuropeanConferenceonCom-puterVision.Springer,2014.4,7[12]J.H.Friedman,J.L.Bentley,andR.A.Finkel.Analgorithmforﬁndingbestmatchesinlogarithmicexpectedtime.ACMTrans.Math.Softw.,1977.2[13]H.Fu,Q.Zhang,andG.Qiu.Randomforestforimageannotation.InComputerVision–ECCV2012,pages86–99.Springer,2012.3[14]A.P.GeeandW.W.Mayol-Cuevas.6drelocalisationforrgbdcamerasusingsyntheticviewregression.InBMVC,pages1–11,2012.2[15]B.Glocker,S.Izadi,J.Shotton,andA.Criminisi.Real-timergb-dcamerarelocalization.InMixedandAugmentedReality(ISMAR),2013IEEEInternationalSymposiumon,pages173–179.IEEE,2013.2,5[16]U.Grenander.Patternsynthesis:Lecturesinpatterntheory,volume18.SpringerScience&BusinessMedia,2012.1[17]K.Hajebi,Y.Abbasi-Yadkori,H.Shahbazi,andH.Zhang.Fastapproximatenearest-neighborsearchwithk-nearestneighborgraph.IJCAI,2011.2,3,5[18]A.A.A.IasonOikonomidis,NikolaosKyriazis.Efﬁcientmodel-based3dtrackingofhandarticulationsusingkinect.InBMVC,2011.2[19]P.IndykandR.Motwani.Approximatenearestneighbors:Towardsremovingthecurseofdimensionality.InProceed-ingsoftheThirtiethAnnualACMSymposiumonTheoryofComputing,STOC,1998.2[20]V.Jampani,S.Nowozin,M.Loper,andP.V.Gehler.Theinformedsampler:Adiscriminativeapproachtobayesianinferenceingenerativecomputervisionmodels.ComputerVisionandImageUnderstanding,136:32–44,2015.1[21]H.J´egou,M.Douze,andC.Schmid.Searchingwithquan-tization:approximatenearestneighborsearchusingshortcodesanddistanceestimators.2009.5[22]A.Kendall,M.Grimes,andR.Cipolla.Posenet:Aconvolu-tionalnetworkforreal-time6-dofcamerarelocalization.InProceedingsoftheIEEEInternationalConferenceonCom-puterVision,pages2938–2946,2015.8[23]J.KennedyandR.Eberhart.Particleswarmoptimization.InternalConferenceonNeuralNetworks,1995.2[24]G.KleinandD.Murray.Improvingtheagilityofkeyframe-basedslam.InComputerVision–ECCV2008,pages802–815.Springer,2008.2[25]P.Kohli,J.Rihan,M.Bray,andP.H.Torr.Simultane-oussegmentationandposeestimationofhumansusingdy-namicgraphcuts.InternationalJournalofComputerVision,79(3):285–298,2008.1[26]T.Kulkarni,P.Kohli,J.Tenenbaum,andV.Mansinghka.Picture:Aprobabilisticprogramminglanguageforsceneperception.InProc.CVPR,2015.1[27]D.G.Lowe.Objectrecognitionfromlocalscale-invariantfeatures.InProc.ICCV,1999.8[28]M.MujaandD.G.Lowe.Scalablenearestneighboralgo-rithmsforhighdimensionaldata.PatternAnalysisandMa-chineIntelligence,IEEETransactionson,2014.2,5[29]R.Mur-Artal,J.Montiel,andJ.D.Tardos.Orb-slam:aver-satileandaccuratemonocularslamsystem.Robotics,IEEETransactionson,31(5):1147–1163,2015.7[30]R.Newcombe,S.Lovegrove,andA.Davison.Dtam:Densetrackingandmappinginreal-time.InICCV,2011.4,7[31]M.Nießner,M.Zollh¨ofer,S.Izadi,andM.Stamminger.Real-time3Dreconstructionatscaleusingvoxelhashing.ACMTOG,32(6),2013.6[32]D.NistrandH.Stewnius.Scalablerecognitionwithavo-cabularytree.InComputerVisionandPatternRecognition,2006.2[33]R.ODonnell,Y.Wu,andY.Zhou.Optimallowerboundsforlocality-sensitivehashing(exceptwhenqistiny).ACMTransactionsonComputationTheory(TOCT),6(1):5,2014.2[34]L.Qin,W.Josephson,Z.Wang,M.Charikar,andK.Li.Mul-tiProbeLSH:EfﬁcientIndexingforHigh-DimensionalSim-ilaritySearch.InVeryLargeDataBases,2007.2[35]E.Rublee,V.Rabaud,K.Konolige,andG.Bradski.Orb:anefﬁcientalternativetosiftorsurf.InComputerVision(ICCV),2011IEEEInternationalConferenceon,2011.8[36]S.Se,D.G.Lowe,andJ.J.Little.Vision-basedgloballo-calizationandmappingformobilerobots.Robotics,IEEETransactionson,21(3):364–375,2005.2[37]G.Shakhnarovich,P.Viola,andT.Darrell.Fastposeestima-tionwithparameter-sensitivehashing.InComputerVision,2003.Proceedings.NinthIEEEInternationalConferenceon,pages750–757.IEEE,2003.2[38]T.Sharp,C.Keskin,D.Robertson,J.Taylor,J.Shotton,D.Kim,C.Rhemann,I.Leichter,A.Vinnikov,Y.Wei,D.Freedman,P.Kohli,E.Krupka,A.Fitzgibbon,andS.Izadi.Accurate,robust,andﬂexiblereal-timehandtrack-ing,2015.CHI.1,2,4,5[39]J.Shotton,B.Glocker,C.Zach,S.Izadi,A.Criminisi,andA.Fitzgibbon.Scenecoordinateregressionforestsforcam-erarelocalizationinrgb-dimages.InComputerVisionandPatternRecognition.IEEE,2013.5,6,7,8[40]S.Sridhar,A.Oulasvirta,andC.Theobalt.Interactivemark-erlessarticulatedhandmotiontrackingusingrgbanddepthdata,2013.ICCV.5[41]D.Tang,J.Taylor,P.Kohli,C.Keskin,T.-K.Kim,andJ.Shotton.Openingtheblackbox:Hierarchicalsamplingoptimizationforestimatinghumanhandpose.InInterna-tionalConferenceonComputerVision.IEEE,2015.1,2,5[42]J.Thies,M.Zollh¨ofer,M.Nießner,L.Valgaerts,M.Stam-minger,andC.Theobalt.Real-timeexpressiontransferforfacialreenactment.ACMTransactionsonGraphics(TOG),34(6),2015.1[43]J.Thies,M.Zollh¨ofer,M.Stamminger,C.Theobalt,andM.Nießner.Face2face:Real-timefacecaptureandreen-actmentofrgbvideos.InProc.ComputerVisionandPatternRecognition(CVPR),IEEE,June2016,2016.1[44]J.Tompson,M.Stein,Y.Lecun,andK.Perlin.Real-timecontinuousposerecoveryofhumanhandsusingconvolu-tionalnetworks.ACMTransactionsonGraphics,2014.1,5[45]Z.TuandS.C.Zhu.Imagesegmentationbydata-drivenmarkovchainmontecarlo.PAMI,24(5):657–673,2002.1[46]J.Valentin,M.Nießner,J.Shotton,A.Fitzgibbon,S.Izadi,andP.Torr.Exploitinguncertaintyinregressionforestsforaccuratecamerarelocalization.InProc.CVPR,2015.3,5,6[47]B.Williams,G.Klein,andI.Reid.Real-timeslamrelocal-isation.InComputerVision,2007.ICCV2007.IEEE11thInternationalConferenceon,pages1–8.IEEE,2007.2,7[48]B.Williams,G.Klein,andI.Reid.Automaticrelocaliza-tionandloopclosingforreal-timemonocularslam.PatternAnalysisandMachineIntelligence,IEEETransactionson,33(9):1699–1712,2011.2[49]A.YuilleandD.Kersten.Visionasbayesianinference:anal-ysisbysynthesis?Trendsincognitivesciences,10(7):301–308,2006.1[50]X.Zhang,Z.Li,L.Zhang,W.-Y.Ma,andH.-Y.Shum.Efﬁ-cientindexingforlargescalevisualsearch.InInternationalConferenceonComputerVision,2009.2