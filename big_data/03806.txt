Mechanism Design for Subadditive Agents via an Ex-Ante

Relaxation

Shuchi Chawla∗

J. Benjamin Miller†

March 15, 2016

Abstract

We consider the problem of maximizing revenue for a monopolist offering multiple items to multiple
heterogeneous buyers. We develop a simple mechanism that obtains a constant factor approximation un-
der the assumption that the buyers’ values are additive subject to a feasibility constraint and independent
across items. Importantly, different buyers in our setting can have different constraints on the sets of
items they desire. Our mechanism is a sequential variant of two-part tariffs. Prior to our work, simple
approximation mechanisms for such multi-buyer problems were known only for the special cases of all
unit-demand or all additive value buyers.

Our work expands upon and uniﬁes long lines of work on unit-demand settings and additive settings.
We employ the ex ante relaxation approach developed by Alaei (2011) for reducing a multiple-buyer
mechanism design problem with an ex post supply constraint into single-buyer ones with ex ante supply
constraints. Solving the single-agent problems requires us to signiﬁcantly extend techniques developed
in the context of additive values by Li and Yao (2013) and their extension to subadditive values by
Rubinstein and Weinberg (2015).

6
1
0
2

 
r
a

 

M
1
1

 
 
]
T
G
.
s
c
[
 
 

1
v
6
0
8
3
0

.

3
0
6
1
:
v
i
X
r
a

∗University of Wisconsin - Madison
†University of Wisconsin - Madison

1

1 Introduction

Multi-parameter optimal mechanism design is challenging from both a computational and a conceptual
viewpoint, even when it involves only a single buyer. Multi-parameter type spaces can be exponentially
large, and multi-dimensional incentive constraints lack the nice structure of single-dimensional constraints
that permits simpliﬁcation of the optimization problem. As a result, optimal mechanisms can possess unde-
sirable properties such as requiring randomness (Briest et al., 2010; Hart and Nisan, 2012, 2013), displaying
non-monotonicity of revenue in values (Reny and Hart, 2015; Rubinstein and Weinberg, 2015), and are in
many cases computationally hard to ﬁnd (see, e.g., Daskalakis et al., 2012, 2014). The situation exacer-
bates in multi-agent settings. Hartline (2016b, chap. 8) identiﬁes two further difﬁculties: multi-parameter
agents impose multi-dimensional externality on each other that may not be possible to capture succinctly;
multi-parameter problems are typically not revenue linear, meaning that the optimal revenue does not scale
linearly with the probability of service. Designing simple near-optimal mechanisms in such settings is a
primary goal of algorithmic mechanism design.

In this paper we study the problem facing a monopolist with many items and many buyers, where each
buyer is interested in buying one of many different subsets of items, and his value for each such subset is
additive over the items in that subset. What selling mechanism should the monopolist use in such a setting
to maximize his revenue? One challenge for the seller is that buyers may have heterogeneous preferences:
some buyers are interested in buying a few speciﬁc items, others are indifferent between multiple items,
and yet others have a long shopping list. We design the ﬁrst approximation mechanism for this problem,
achieving a constant factor approximation in fairly general settings.

Our approximation mechanism has a particularly simple and appealing format – a sequential extension
of standard two-part tariff mechanisms. Two-part tariffs for a single agent have the following structure. The
buyer ﬁrst pays a ﬁxed entry fee and is then allowed to purchase any set of items at ﬁxed per-item prices.
The buyer may choose to not participate in the mechanism, in which case he does not pay the entry fee
and does not receive any item. In our context, buyers pay (different) entry fees at the beginning, and then
take turns (in an arbitrary but ﬁxed order) to buy a subset of items at predetermined item-speciﬁc prices,
subject to availability. There are many real-world examples of two-part tariffs, such as amusement park
pricing, memberships for discount shopping clubs like Costco, Sam’s Club, and Amazon’s Prime, telephone
services, and membership programs for cooperatives and CSAs. These mechanisms have long been studied
in economics for their ability to effectively price discriminate among different buyers despite their relative
simplicity. Armstrong (1999) shows, for example, that for an additive value buyer with independent item
values and sufﬁciently many items, two-part tariffs extract nearly the entire social surplus.

Our work combines and signiﬁcantly extends techniques from several different lines of work in mecha-
nism design. We use the ex ante relaxation of Alaei (2011) to break up the multi-agent revenue maximization
problem into its single-agent counterparts and capture the externalities among buyers through ex ante supply
constraints. We solve the single-agent problems with ex ante supply constraints by adapting and extending
the so-called core-tail decomposition technique of Li and Yao (2013), as well employing the prophet in-
equalities of Chawla et al. (2010a) and Feldman et al. (2016). Finally, we use ideas from (Chawla et al.,
2010a) to combine the resuting single-agent mechanisms sequentially and obtain a multi-agent approxima-
tion mechanism that is ex post supply feasible.

1.1 Multi-Parameter Mechanism Design: Previous Work

This paper belongs to a long line of research on ﬁnding simple and approximately optimal mechanisms for
multi-parameter settings under various assumptions on the buyers’ value functions and type distributions,

2

and on the seller’s supply constraint. The ﬁrst breakthrough along these lines was made by Chawla et al.
(2007) who showed that the revenue of an optimal mechanism for a single unit-demand buyer can be ap-
proximated within a factor of 3 by an item pricing1: a mechanism that allows the buyer to choose any item
to buy at ﬁxed per-item prices. More recently, Babaioff et al. (2014) developed a similar result for a single
buyer with additive values.2 They showed that the revenue of an optimal mechanism in this case is approxi-
mated within a factor of 6 by one of two simple mechanisms: an item pricing that ﬁxes a price for each item
and allows the buyer to choose any subset of items to buy, and a bundle pricing that allows the buyer to buy
the grand bundle of all items at a ﬁxed price. Observe that item pricing and bundle pricing are both two-part
tariffs (with the entry fee or the per-item prices being zero, respectively).

Unit-demand and additive types are two extremes within a broader class of value functions that we call
constrained additive values. A constrained additive buyer has a value (drawn independently) for each item
under sale; he is interested in buying a set of items that satisﬁes a certain downward closed constraint; his
value is additive over any such set. We have only recently begun to understand optimal mechanism design
for a single agent with constrained additive values. Rubinstein and Weinberg (2015) proved that in this
setting, as in the additive case, either item pricing or bundle pricing gives a constant factor approximation to
the optimal revenue.3 There are many similarities between the two lines of work on unit-demand buyers and
additive buyers, and Rubinstein and Weinberg’s result can be seen as a uniﬁcation of the two approaches,
albeit with a worse approximation factor.

Multi-parameter settings with multiple buyers are less well understood. For settings with many unit-
demand buyers, Chawla et al. (2010a,b) developed a generic approach for approximation via sequential
posted-price mechanisms (SPMs). SPMs approach buyers in some predetermined order and offer items for
sale to each buyer at predetermined prices while supplies last. For settings with many additive-value buyers,
Yao (2015) showed that either running a second price auction for each item separately or optimally selling
to bidder i the set of items for which he is the highest bidder4 achieves a constant factor approximation.
Cai et al. (2016) presented a new uniform framework that can be used to rederive both Yao and Chawla
et al.’s results, with a tighter analysis for the former. However, prior to our work, no approximations were
known for other constrained additive settings or for settings with heterogeneous buyers. Consider, for exam-
ple, a setting with some unit-demand and some additive buyers. In this case, neither of the results mentioned
above provide an approximation. Chawla et al.’s analysis relies on a reduction from multi-dimensional in-
centive constraints to single-dimensional ones that applies only to the unit-demand setting, and, in particular,
cannot account for revenue from bundling, which is crucial in non-unit-demand settings. Yao’s approach on
the other hand relies on allocating each item to the highest value agent, and cannot provide a constant factor
approximation for subadditive agents.5

A different approach to optimal mechanism design due to Cai et al. (2012a,b, 2013a,b) uses linear pro-
gramming formulations for settings with small support type distributions, and shows that optimal mech-
anisms are virtual welfare maximizers. This approach is unsuitable for our setting which, even upon dis-
cretization of values, involves distributions over exponential size supports. Moreover, mechanisms generated
by this approach tend to lack the nice structure and simplicity of pricing-based mechanisms.

Finally, a new approach to mechanism design has emerged in recent years that uses duality theory to de-

1Chawla et al. (2010a) later improved this approximation factor to 2.
2This is the culmination of a series of papers including Hart and Nisan (2012, 2013); Li and Yao (2013).
3Rubinstein and Weinberg (2015)’s result holds for a much broader setting with a single subadditive value agent, but their factor

of approximation is rather large – about 340.

4In the latter case, Yao approximates the optimal revenue via two-part tariffs.
5To see why Yao’s approach cannot work for unit-demand agents, observe that if a single unit-demand agent has the highest

value for each item, the seller must try to sell all but one item to non-highest-value buyers in order to obtain good revenue.

3

sign as well as analyze optimal or approximately optimal mechanisms (Daskalakis et al., 2015; Giannakopoulos and Koutsoupias
2014, 2015; Haghpanah and Hartline, 2015; Cai et al., 2016). Designing good dual solutions in this context,
however, involves more art than science, and for the most part, positive results are restricted to very special
classes of value functions and value distributions.

1.2 Our Techniques and Contributions

Ex Ante Relaxation Our work follows a generic approach developed by Alaei (2011) for transforming
multi-agent mechanism design problems into their single-agent counterparts via the so-called ex ante re-
laxation. In a multi-agent setting, agents impose externalities upon each other through the seller’s supply
constraint: each item must be sold to at most one buyer ex post. Alaei proposes relaxing the problem by
enforcing the supply constraint ex ante rather than ex post: the probabilities with which an item is sold to
the different buyers should sum up to no more than one. In other words, in expectation the item is sold at
most once. Applying the ex ante relaxation to a mechanism design problem with multiple buyers involves
three steps:

1. Decompose into single-agent problems: determine the ex ante probabilities with which each item

can be sold to each buyer; for each item these probabilities should sum up to no more than 1;

2. Solve single-agent problems: for each agent, ﬁnd an approximately optimal mechanism satisfying

the ex ante supply constraint determined in the ﬁrst step;

3. Stitch single-agent mechanisms: combine the single-agent mechanisms developed in the second

step into a single mechanism that satisﬁes the supply constraints ex post.

The ﬁrst step is conceptually simple and applies in any setting where buyers have independent values. We
reproduce this argument in Section 4 for completeness.

Alaei described how to implement the second and third steps for problems involving unit-demand
agents.6 For the third “stitching” step, he suggested composing the single-agent mechanisms sequentially
(similar to the approach of Chawla et al. (2010a)). However, this does not work for arbitrary single-agent
mechanisms. Once the composite mechanism has sold off a few items, fewer bundles are available to sub-
sequent buyers, and the mechanism may obtain far less revenue than its single-agent counterparts. We show
that two-part tariffs compose well without much loss in revenue when each buyer’s value function is additive
up to a matroid feasibility constraint.

Core-Tail Decomposition In order to bound the single-agent revenue as required in step two of the ex ante
approach, we use the core-tail decomposition of Li and Yao (2013), and its extensions due to Babaioff et al.
(2014) and Rubinstein and Weinberg (2015). Roughly speaking, in the absence of ex ante supply constraints,
for any vector of item values, we can partition items into those with small value and those with large value.
This partitioning is done in such a manner that the set of large-value items (a.k.a. the tail) contains only a few
items in expectation; the revenue generated by these items behaves essentially like unit-demand revenue, and
can be recovered by selling the items separately via an argument of Chawla et al. (2010b). The set of small-
value items (a.k.a. the core), on the other hand, displays concentration of value and the revenue generated
by these items can be recovered via bundling (Rubinstein and Weinberg, 2015).

6Alaei also presented solutions for certain additive-value settings under the assumption that the agents’ type spaces are small

and given explicitly.

4

Under an ex ante supply constraint the revenue generated by the tail can still be recovered via item
pricing as before. Bounding the revenue from the core is trickier, however, because different items may face
very different ex ante constraints, and their total values may not concentrate well. Furthermore, selling the
grand bundle allocates all items with the same probability to the buyer and consequently may not respect
the given ex ante constraint. We make a careful choice of thresholds for partitioning values into the core
and the tail in such a manner that we can recover the value of the core in two parts: (1) when the ex ante
constraint is strong (i.e. the allocation probabilities are mostly small), selling separately recovers most of
the core revenue; (2) when the ex ante constraint is weak (i.e. the allocation probabilities are mostly large),
bundling as part of a two-part tariff recovers most of the core revenue while continuing to respect the ex ante
constraint.

Prophet inequalities Observe that the ex ante approach described above relaxes the seller’s supply con-
straint, but continues to enforce the buyer’s demand constraint7 ex post. It is unclear how a relaxation of the
buyer’s demand constraint would capture revenue due to bundling, and whether such a relaxation is useful
for mechanism design. Nevertheless, our analysis gives rise to a term which coresponds to item-pricing
revenue from a common relaxation of the seller’s and buyer’s constraints. Roughly speaking, this term cap-
tures the total revenue that the seller can obtain from the buyer by selling each item separately subject to
a bound on the probability of sale, under the condition that these bounds respect both the seller’s and the
buyer’s feasibility constraints in an ex ante sense. For example, for a unit-demand buyer, the probabilities of
sale over the items must sum up to no more than 1. We then employ a prophet inequality to relate this term
to the optimal item-pricing revenue for that buyer. A prophet inequality in this context speciﬁes an item
pricing that, regardless of which maximal feasible set of items the buyer purchases, obtains in expectation a
constant fraction of the ex ante optimal revenue. Prophet inequalities of the above form are known to hold
for several classes of feasibility constraint, such as uniform matroids, partition matroids, and their intersec-
tions (see, e.g., Chawla et al., 2010a). For general matroid constraints, it is not known whether a prophet
inequality with static item prices as described above can obtain a constant approximation factor.8 How-
ever, Feldman et al. (2016) give a prophet inequality that obtains a constant approximation by restricting the
buyer’s demand – in other words, by forbidding the buyer to purchase certain feasible sets. We discuss and
use these results in Section 5.

The ﬁnal mechanism As mentioned earlier, our ﬁnal mechanism is a sequential two-part tariff mecha-
nism. We remark that buyers in our mechanism are required to pay the entry fee before ﬁnding out whether
their favorite items will be available when it is their turn to buy; therefore, our mechanism is only Bayesian
incentive compatible (BIC), and not necessarily dominant strategy incentive compatible (DSIC). We leave
open the question of whether it is possible to approximate the optimal revenue within a constant factor via a
DSIC mechanism. In some settings, our mechanism restricts the subsets of items that a buyer is allowed to
buy; we call such a mechanism a demand-limiting sequential two-part tariff. This is similar to, for example,
market-style CSA programs where members can buy only certain quantities and combinations of produce.

Other contributions As special cases of our general result, we also obtain improvements to the results
of Rubinstein and Weinberg (2015). Recall that Rubinstein and Weinberg show that for a single buyer with

7The buyer’s demand constraint refers to, e.g., whether the buyer desires one item as in the unit-demand case, or all items as in

the additive case.

8Kleinberg and Weinberg (2012) present a prophet inequality with adaptive prices, but this is unsuitable for our setting.

5

subadditive values, either item pricing or bundle pricing obtains a constant factor approximation. We im-
prove this result in two ways. First, for constrained additive values, we improve the approximation factor
from about 340 to 31.1 (Corollary 3.6).9 Second, we show that the result holds also under an ex ante con-
straint for a suitable deﬁnition of item pricings and bundle pricings that respect the same ex ante constraint
(see Corollary 3.7). Finally, for revenue maximization with multiple additive buyers, we adapt arguments
from (Babaioff et al., 2014) to obtain an approximation factor of 28 (see Appendix C); this is an improve-
ment over Yao (2015)’s approximation factor of 69 for the same setting, but is worse than Cai et al. (2016)’s
improvement of Yao’s analysis to an 8-approximation. Arguably, our analysis for this setting is conceptually
simpler than both of those works.

Symmetric settings
In an interesting special case of our setting, the buyers are a priori symmetric (but
items are heterogeneous). That is, each buyer has a value vector drawn from identical independent distribu-
tions, and also desires the same bundles of items. In this setting, our mechanism sets the same entry fee as
well as item prices for all buyers. Furthermore, these fees and prices can be computed efﬁciently.

Further directions For settings with asymmetric buyers, we leave open the question of efﬁciently solving
the ex ante relaxation. Finally, our results require buyers’ demand constraint to be matroids for two reasons:
this allows us to use a prophet inequality for a single agent, as well as enables combining single-agent
mechanisms sequentially without much loss in revenue. An interesting direction is to apply the ex ante
approach for demand constraints beyond matroids, or for more general classes of subadditive values.

2 Preliminaries

We consider a setting with a single seller and n buyers. The seller has m heterogeneous items to sell. Each
buyer i ∈ [n] has a type composed of a public downward closed demand constraint Fi ⊆ 2[m] and a private
value vector vi = (vi1,··· , vim) that maps items to non-negative values. Roughly speaking, the demand
constraint Fi describes the maximal sets of items from which the buyer derives value. Formally, the buyer’s
value for a set of items is described by a constrained additive function: for S ⊆ 2[m],

vi(S) = max

vij

S′∈Fi;S′⊆SXj∈S′

It will sometimes be necessary to consider feasibility restricted to subsets of the available items. For
M ′ ⊆ [m], the restriction of Fi to M ′, denoted Fi|M ′, is formed by dropping items not in M ′. Formally,
Fi|M ′ = Fi ∩ 2M ′. We will typically assume that for all i, Fi is a matroid; see Appendix A for a review of
matroid concepts.
We assume that the values vij are drawn from distribution Dij independently of all other values; we use
Di =Qj Dij to denote the joint distribution of buyer i’s value vector and D =Qi Di to denote the joint
distribution over all value vectors. The demand constraints Fi may be different for different buyers. Let
F = {Fi}i∈[n] denote the tuple of feasibility constraints, one for each buyer.

9It is possible to use Rubinstein and Weinberg’s techniques to obtain a better approximation for the special case of constrained

additive values, however, the resulting bound is still much weaker than ours.

6

2.1 Incentive Compatible Mechanisms and Revenue Maximization
A mechanism M takes as input the value vectors v = (v1,··· , vn) and returns an allocation x(v) and
payment vector p(v). Here xi(v) denotes the (potentially random) set of items that is allocated to buyer i.
A mechanism M is supply-feasible if every item is allocated to at most one buyer; in other words, for all v,
and i1 6= i2, xi1(v) ∩ xi2(v) = ∅ with probability 1.
We use xij(v) to denote the probability with which buyer i receives item j. Without loss of generality,
we focus on mechanisms that for every value vector v and every buyer i satisfy xi(v) ∈ Fi with probability
1; we call such mechanisms demand-feasible. Consequently, we note that the vector (xi1(v),··· , xim(v))
lies in the polytope enclosing Fi,10 which we denote PFi. In the rest of the paper we will overload notation
and use xi(v) to denote the vector (xi1(v),··· , xim(v)).
We assume that buyers are risk neutral and have quasi-linear utilities. In other words, the utility that a
buyer derives from allocation xi and payment pi is given by xi · vi − pi. We consider mechanisms which
are Bayesian incentive compatible (BIC). A mechanism is BIC if truthtelling is a Bayes-Nash equilibrium;
that is, if a buyer maximizes his own utility—in expectation over other buyers’ values, assuming they report
truthfully, as well as randomness inherent in the mechanism—by reporting truthfully. In contrast, a mech-
anism is dominant-strategy incentive compatible (DSIC) if truthtelling is a dominant strategy; that is, if a
buyer maximizes his own utility by reporting truthfully, regardless of what other buyers report.

We are interested in revenue maximization for the seller. The seller’s revenue from a BIC mechanism

M = (x, p) at value vectors v isPi pi(v), and the expected revenue is REVM(D) = Ev∼D[Pi pi(v))].
The revenue maximization problem seeks to maximize REVM(D) over all BIC mechanisms that are demand-
and supply-feasible; we use REV(D,F) to denote this maximum revenue.
2.2 Ex Ante Constrained Revenue Maximization

We will reduce the multiple buyer revenue maximization problem described above to single buyer problems
with an ex ante supply constraint. The following deﬁnitions are for a single agent i; we omit the subscript i
for clarity. Let q = (q1,··· , qn) be a vector of probabilities with qj ∈ [0, 1] for all j ∈ [m]. A mechanism
M = (x, p) is q-constrained under D if for all items j ∈ [m], its ex ante probability for selling item j
when values are drawn from D, Ev∼D[xj(v)], is at most qj. We will consider both revenue and welfare
maximization problems over q-constrained mechanisms. Formally, we deﬁne

REVq(D,F) =

M=(x,p):Ev∼D[xj(v)]≤qj ∀j∈[m]

max

REVM(D)

(1)

and

VALq(D,F) =

M=(x,p):Ev∼D[xj(v)]≤qj ∀j∈[m]

max

VALM(D),

where the maximum is taken over all BIC demand-feasible mechanisms11 and VALM(D) = Ev∼D[x(v) · v].
It will some times be convenient to express the ex ante constraint in the form of ex ante prices deﬁned
−1(1 − qj). In other words, for every j ∈ [m], βj is deﬁned such that the probability that vj
as: βj = Dj
exceeds this price is precisely qj. Note that there is a one-one correspondence between ex ante probabilities
and ex ante prices.

10Formally, PFi is the convex hull of the incidence vectors of all sets in Fi in ℜm.
11We don’t need to impose the supply-feasibility constraint explicitly — this is already implicit in the ex ante probability con-

straint.

7

2.3 Special Single-Agent Mechanisms

Item pricing An item pricing is deﬁned by a set of prices pj, one for each item j. A buyer is allowed to
select as many items as he pleases, up to some downward closed constraint F and he pays the sum of the

associated prices. That is, if the buyer selects the set S ⊆ [m], he paysPj∈S pj. The buyer then selects the
set S ∈ F which maximizesPj∈S(vj − pj). We use SREV(D,F) to denote the optimal revenue obtainable

by any item pricing from a buyer with value distribution D and demand constraint F.
Bundle pricing A bundle pricing is deﬁned by a single price (a.k.a. entry fee) π. A buyer can buy any
subset of items satisfying the demand constraint F at price π. A rational buyer chooses to participate (i.e.
pay the fee) if v([m]) = maxS∈F v(S) ≥ π and then selects a corresponding maximal set S. We use
BREV(D,F) to represent the optimal revenue obtainable by any bundle pricing from a buyer with value
distribution D and demand constraint F.
Two-part tariffs A two-part tariff is a common generalization of both item pricings and bundle pricings.
It is described by an m + 1 dimensional vector of prices: (π, p1,··· , pm). The mechanism offers each set
at these offered prices. Informally speaking, the mechanism charges the buyer an entry fee of π for the right
to buy any set of items, with item j offered at a ﬁxed price of pj. Like other pricing-based mechanisms,
two-part tariffs are deterministic, dominant strategy incentive compatible mechanisms.

S ⊆ [m] of items to the buyer at a price of π +Pj∈S pj; the buyer can then choose to buy his favorite set

A utility-maximizing buyer with values v and feasibility constraint F when offered a two-part tariff
(π, p) buys the set S ∈ F of items that maximizes v(S) − π −Pj∈S pj, if that quantity is non-negative;
in that case, we say that the buyer participates in the mechanism. We denote the revenue of a two-part tariff
(π, p) offered to a buyer with feasibility constraint F and value distribution D by REV(π,p)(D,F). We
use TREV(D,F) to denote the optimal revenue that a two-part tariff can obtain from a buyer with value
distribution D and demand constraint F.
Two-part tariffs are known to be approximately optimal in certain single agent settings. The following
results12 are due to Chawla et al. (2010b) and Babaioff et al. (2014) respectively. Rubinstein and Weinberg
(2015) proved a similar result for constrained additive values, but with a very large approximation factor
(about 340).

REV(D,FUNITDEMAND) ≤ 4 TREV(D,FUNITDEMAND)

REV(D,FADDITIVE) ≤ 6 TREV(D,FADDITIVE)

Pricings with an ex ante constraint Next we extend the above deﬁnitions to respect ex ante supply
constraints. We say that a two-part tariff (π, p) satisﬁes ex ante constraint q if for all j, pj ≥ βj =
−1(1− qj). Note that this is a stronger condition than merely requiring that the mechanism allocates item
Dj
j with ex ante probability at most qj. We use TREVq(D,F) to denote the optimal revenue achieved by a
demand-feasible two-part tariff that satisﬁes ex ante constraint q. Likewise, we use SREVq(D,F) to denote
the optimal revenue achievable by an item pricing p with pj ≥ βj for all j.
12Here FUNITDEMAND = {S ⊂ [m] | |S| = 1} represents a unit-demand buyer, and FADDITIVE = 2[m] represents a buyer with

fully-additive values.

8

2.4 Multi-Agent (Sequential) Two-Part Tariff Mechanisms

We now extend the deﬁnition of two-part tariffs to multi-agent settings. Consider a setting with n agents
and demand constraints F = {Fi}i∈[n]. A sequential two-part tariff for this setting is parameterized by
an ordering σ over the agents, a set of entry fees π = (π1,··· , πn), and a set of prices p = {pij}. The
mechanism proceeds as follows.

1. The ordering σ and prices π; p are announced.

2. Each agent i independently decides whether or not to participate in the mechanism.

If the agent

decides to participate, then he pays his corresponding entry fee πi.

3. The mechanism considers agents in the order given by σ. When an agent i is considered, if the agent
previously declined to participate, no items are allocated and no payment is charged. Otherwise, of
the items unallocated so far, the agent is allowed to purchase his favorite feasible set of items at the
prices pij.

Observe that agents choose whether or not to participate in the mechanism before knowing which items
will be available when it is their turn to purchase. Accordingly, a sequential two-part tariff is BIC but not
necessarily DSIC.

The sequential two-part tariff mechanisms that we develop in this paper are order oblivious in the sense
that their revenue guarantees hold regardless of the ordering σ chosen over the agents. Accordingly, in
describing these mechanisms, we need only specify the prices π; p.

In some cases, our two-part tariff mechanisms disallow agents from buying certain sets of items. Specif-
ically, a demand-limiting sequential two-part tariff is parameterized by an ordering σ, prices π; p, as well
as feasibility constraints F ′ = {F ′
i ⊆ F is a matroid constraint stronger
than the agent’s original demand constraint. When it is agent i’s turn to buy items, the agent is allowed to
buy any subset of items in F ′

i. In particular, the agent is not allowed to buy sets of items in Fi \ F ′
i.

i}i∈[n] where for every agent i, F ′

3 Main Results

We now state our three main results corresponding to the three parts of the ex ante approach for approximat-
ing REV(D,F). Lemma 3.1 corresponds to the ﬁrst relaxation step, and states that the revenue REV(D,F)
can be bounded by the sum of single-agent revenues with appropriate ex ante constraints.
Lemma 3.1 (Relaxation). For any feasibility constraints F = {Fi}i∈[n] and value distributions D =
Qi Di, there exist ex ante probability vectors q1,··· , qn, satisfying: (1) qi ∈ PFi for all i, and, (2)
Pi qij ≤ 1 for all j, such that

REVqi(Di,Fi).

Lemma 3.2 corresponds to the last stitching step, and shows that any single-agent two-part tariff mecha-
nisms that collectively satisfy an ex ante constraint on every item can be stitched together into a multi-agent
sequential two-part tariff mechanism without losing much revenue.
Lemma 3.2. For every agent i, let Mi = (πi, pi) be any two-part tariff that is demand-feasible with respect
to a matroid feasibility constraint Fi and that satisﬁes ex ante supply constraints qi under value distribution

REV(D,F) ≤Xi

9

Di. Let F = {Fi}i∈[n] and D =Qi Di. Then, ifPi qij ≤ 1/2 for all j, there exists a sequential two-part

tariff mechanism M that is supply-feasible and demand-feasible with respect to F such that

REVM(D) ≥

REVMi(Di).

1

2Xi

We therefore obtain the following corollary.

Corollary 3.3 (Stitching). For any value distributions D =Qi Di and feasibility constraints F = {Fi}i∈[n],
where each Fi is a matroid, let q1,··· , qn be any ex ante probability vectors satisfyingPi qij ≤ 1/2 for

all j. Then, there exists a demand- and supply-feasible sequential two-part tariff mechanism M such that

REVM(D) ≥

TREVqi(Di,Fi).

1

2Xi

In order to put together the Relaxation Lemma and the Stitching Corollary, it remains to relate REVq for
a single agent to TREVq for the same agent. The following lemma presents such a relationship when the
buyer’s demand constraint is a matroid.
Lemma 3.4 (Single-agent approximation). Let D be any product value distribution and F be a matroid
with feasible polytope PF . Then, for any q ∈ 1

2PF , there exists a submatroid F ′ ⊆ F such that

REVq(D,F) ≤ 33.1 TREV q(D,F ′)

If F is a partition matroid, then F ′ = F.

Putting Lemmas 3.1 and 3.4, and Corollary 3.3 together, and observing that by the concavity of the

2 qi

(Di,Fi) ≥ 1

revenue objective, REV 1
Theorem 3.5. For any product value distribution D and feasibility constraints F = {Fi}i∈[n], where each
Fi is a matroid, there exist submatroids F ′
i}-limited sequential two-part
tariff mechanism M such that

2 REVqi(Di,Fi) for all i, we get our main result.

i ⊆ Fi and a supply-feasible {F ′

REV(D,F) ≤ 133 REVM(D)

If Fi is a partition matroid, then F ′
Further results

i = Fi.

As a consequence of our single-agent approximation (Lemma 5.10 in Section 5), we also obtain an improved
approximation for the single-agent revenue maximization problem with constrained additive values. Specif-
ically, taking q = ~1 and noting β = ~0, Lemma 5.10 gives the following bound on the optimal revenue for
the single-agent setting.
Corollary 3.6. For any downward closed feasibility constraint F and any value distribution D,

REV(D,F) ≤ 31.1 max{SREV(D,F), BREV(D,F)} .

Also as a consequence of Lemma 5.10, we show the following bound for revenue maximization under

an arbitrary ex ante constraint.
Corollary 3.7. Let D be any product value distribution and F be a matroid. Then for any q ∈ [0, 1]m, there
exists a submatroid F ′ ⊆ F such that

If F is a partition matroid, then F ′ = F.

REVq(D,F) ≤ 35.1 TREV q(D,F ′)

10

4 The Ex Ante Relaxation and Stitching

In this section we will prove Lemmas 3.1 and 3.2.
PROOF OF LEMMA 3.1. Let M be the optimal mechanism for feasibility constraints F and value distribu-
tions D achieving revenue REV(D,F). We will now consider a buyer i and construct a mechanism Mi for
this buyer as follows. When the buyer i reports a value vector vi, the mechanism Mi draws value vectors
˜v−i from the joint distribution D−i; It then returns the allocation and payment that M returns at (vi, ˜v−i).
It is easy to see that if M is BIC, then so is Mi. Furthermore, Mi obtains the same revenue from buyer i
as M. Therefore, we have:

Now let xi denote the allocation rule of Mi and let qij = Evi∼Di[xij(vi)]. Then, recalling equation (1),

we have REVMi(Di) ≤ REVqi(Di,Fi), and so,

REV(D,F) =Xi

REVMi(Di).

REV(D,F) ≤Xi

REVqi(Di,Fi).

Finally, the demand feasiblity of M implies that the vector qi lies in the polytope PFi, while the supply

feasiblity of M implies thatPi qij ≤ 1 for all j. The lemma follows.

PROOF OF LEMMA 3.2. For every buyer i, let πi and (pi1,··· , pim) denote the entry fee and item prices
respectively in the mechanism Mi. We will compose the mechanisms Mi to obtain a single mechanism M
as follows.
The mechanism M considers buyers in an arbitrary order and offers items for sale sequentially to the
buyers in that order. When it is buyer i’s turn, some (random set of) items have already been sold to other
buyers. The mechanism offers the remaining items to buyer i via a two-part tariff: it charges the buyer an
entry fee of 1
2 πi for the right to buy any subset of the remaining items, with item j priced at pij. Importantly,
buyers must make the decision of whether or not to participate (that is, whether or not to pay the entry fee)
before knowing which items are left unsold.

By deﬁnition, the mechanism is BIC: buyers may choose whether or not to participate and which subset

of items to purchase.

Let us now consider a single buyer i. We ﬁrst claim that when the mechanism M considers buyer i, for
every item j, the probability (taken over value vectors of other agents) that item j is available to be bought
by i is at least 1/2. Recall that for every pair i, j, Prvij ∼Dij [vij > pij] = 1−Dij(pij) ≤ 1−Dij(βij ) = qij.
So the probability that some agent i′ buys item j is at most qi′j. Therefore, the probability (over values of
agents other than i) that item j is allocated to an agent other than i is at mostPi′6=i qi′j ≤ 1/2, and this
participates in mechanism Mi, then for some set S ∈ Fi his value vector satisﬁesPj∈S(vij −pij)−πi > 0.

participate (i.e. pay the entry fee) in mechanism Mi, then he chooses to participate in M.
In the mechanism M, the agent derives from the same set S an expected utility of

We will now use the above claim to argue that if after drawing his value vector the buyer chooses to
If agent i

proves the claim.

Xj∈S

Pr[j is available for i] (vij − pij) −

1
2

πi,

which by the above claim is at least 1/2(Pj∈S(vij − pij)− πi) > 0. Consequently, if Mi obtains the entry

fee πi from agent i, then M obtains the entry fee πi/2.
11

Next we claim that if agent i buys item j in mechanism Mi and item j is available for him in mechanism
M, then the agent buys item j in M. This follows directly from Lemma A.1 (Appendix A) by noting that
Mi and M offer the same item prices to the agent and that the agent is a utility maximizer. As argued
previously, item j is available with probability at least 1/2, therefore, this claim implies that if Mi obtains
the price pij from agent i, then M obtains the same price pij with probability 1/2. Putting this together with
the above observation about entry fee, we get that M obtains in expectation at least half of the total revenue
obtained by the mechanisms Mi.

5 Two-Part Tariffs for a Single Agent

We now turn to bounding the revenue from a single agent subject to an ex ante constraint. In this section
we will prove Lemma 3.4.
In the following discussion, we assume that the buyer has a product value

distribution D =Qj Dj, and faces a demand feasibility constraint F, while the mechanism is subject to an
−1(1 − qj) for all items j.

ex ante supply constraint q. Recall that we deﬁne the ex ante prices β as βj = Dj
5.1 Core Decomposition with Ex Ante Constraints
We begin by deﬁning the notation for the core-tail decomposition (see Table 1). Let τ ≥ 0 be a constant to
be deﬁned later. We use tj = βj + τ to denote the threshold for classifying values into the core or the tail.
Speciﬁcally, for any item j, if vj > tj, we say item j is in the tail, otherwise it is in the core. Let DC
j (resp.,
DT
j ) denote the distribution for item j’s value conditioned on the item being in the core (resp., tail).
For a set A ⊆ [m] of items, let ρA denote the probability that the items in A are in the tail and the

remaining items are in the core: ρA = (cid:16)Qj∈A Prvj ∼Dj [vj > tj](cid:17)(cid:16)Qj6∈A Prvj ∼Dj [vj ≤ tj](cid:17). Then ρ∅

denotes the probability that all items are in the core. Observe that as we increase the constant τ (thereby
increasing the core-tail thresholds uniformly), the probability ρ∅ increases. We pick τ to be the smallest
non-negative number such that ρ∅ ≥ 1/2. Observe that τ > 0 implies13 ρ∅ = 1/2.
We now state our version of the core-tail decomposition, extended to respect ex ante constraints. See
Appendix 5.1 for a proof. Note that although the sum over tail revenues does not explicitly enforce the ex
ante constraints, the tail distributions are supported only on values above the ex ante prices β.
Lemma 5.1 (Core Decomposition with Ex Ante Constraints). For any product distribution D, feasibility
constraint F, and ex ante constraint q,

REV q(D,F) ≤ VALq(DC

ρAREV(DT

A,F|A)

∅ ,F) + XA⊆[m]

The proof of Lemma 5.1 makes use of the following two lemmas, which are analogous to results proved
by Babaioff et al. (2014). after Li and Yao (2013). We verify that they continue to hold under an ex ante
constraint.

Lemma 5.2. There exists a set {qA ∈ [0, 1]m : A ⊆ [m]} such thatPA ρAqA

j ≤ qj for all j and

REV q(D,F) ≤ XA⊆[m]

ρAREVq

A(DA,F)

13For simplicity, we are assuming that the value distribution does not contain any point masses; it is easy to modify our argument

to work in the absence of this assumption, but we skip the details.

12

Notation Deﬁnition

Formula

Table 1: Notation for Section 5.

q Ex ante probabilities

β Ex ante prices

−1(1 − qj) ∀j ∈ [m]

βj = Dj
βj + τ

j

Core distribution for item j

tj Core-tail threshold for item j
τ Difference between tj and βj; same for all items min{t | Prv∼D[vj ≤ t + βj∀j] ≥ 1/2}
DC
DT
j
DC
A Core distribution for items not in A
DT
A Tail distribution for items in A
Probability item j is in the tail
ξj

Tail distribution for item j

Dj|vj ≤tj
Dj|vj >tj

j

j

Qj6∈A DC
Qj∈A DT
(cid:16)Qj∈A ξj(cid:17)(cid:16)Qj6∈A(1 − ξj)(cid:17)

Prvj ∼Dj [vj > tj]

ρA Probability exactly items in A are in the tail

D − p Distribution D shifted to the left by p

Proof: Let M be a BIC mechanism which is q-constrained under D such that REVM(D) = REVq(D,F).
So REVM(D) =PA⊆[m] ρAREVM(DA). Let qA
j be the probability that M allocates item j given that v
is drawn from DA; that is, qA
j ≤ qj, by the assumption that M is
q-constrained. The result follows since REVM(DA) ≤ REVq
Lemma 5.3. For any two independent distributions DS and DT over disjoint sets of items S and T with
corresponding ex ante constraints qS and qT and a joint feasibility constraint F,

j = Ev∼DA[xj(v)]. ClearlyPA ρAqA

A(DA,F) for each A.

REV(qS ;qT )(DS × DT ,F) ≤ VALqS (DS ,F|S) + REVqT (DT ,F|T ).

Proof: Let M be a BIC mechanism which is (qS; qT )-constrained under (DS ×DT ) such that REVM(DS ×
DT ) = REV(qS ;qT )(DS × DT ,F). We construct a mechanism M′ for selling items in T as follows. M′
ﬁrst samples vS ∼ DS, and then solicits a bid vT for items in T . Let (xS∪T (vS ; vT ), p(vS ; vT )) be
the allocation returned and payment charged by M for the combined bid; then M′ returns the allocation
xT (vS ; vT ) and charges p(vS; vT ) − vS(xS(vS ; vT )).
We now prove that M′ is truthful. Suppose the bidder submits a bid v′
T ))−
T ))(cid:1), which is the utility of a bidder participating in M with valuation (vS, v′
(cid:0)p(vS; v′
T )− vS (xS (vS; v′
T ).
Since M is truthful, the bidder can do no worse by bidding vT in M′ and receiving the utility of an agent
who bids truthfully in M.
Note that M′ allocates item j ∈ T exactly when M does (conditioned on vS). So M′ is demand-
feasible. Furthermore, since M′ draws vS from DS, M′ is also qT -constrained under DT . Formally, let x′
be the allocation rule of M′; then EvT ∼DT [xj

′(vT )] = EvS ∼DS,vT ∼DT [xj(vS; vT )] ≤ qj for all j ∈ T .

T . His utility is vT (xT (vS ; v′

13

The revenue obtained by M′ is

REVM′

(DT ) = EvS∼DS,vT ∼DT [p(vS; vT ) − vS(xS(vS ; vT ))]

= REV(qS ;qT )(DS × DT ,F) − EvS ∼DS,vT ∼DT [vS(xS (vS; vT ))]
≥ REV(qS ;qT )(DS × DT ,F) − VALqS (DS ,F|S),

where the inequality follows because the welfare M obtains from items in S is a lower bound on the welfare
of any qS-constrained mechanism for DS.
PROOF OF LEMMA 5.1. By Lemmas 5.2 and 5.3, we have

ρA(cid:0)VALq

A(DC

A ,F|Ac ) + REVq

A,F|A)(cid:1) .
A(DT

REVq(D,F) ≤ XA⊆[m]
A(DC

A ,F|Ac ). One way to allocate items when values are drawn from DC

For each A ⊆ [m], let MA be a truthful qA-constrained demand-feasible mechanism which obtains
∅ is to choose
welfare equal to VALq
to sell only items from some set A ⊆ [m]. Consider a mechanism which chooses from among all subsets of
items, choosing A with probability ρA, and then runs MA. The expected welfare from such a mechanism
is exactlyPA⊆[m] ρAVALqA(DC
j ≤ qj, the welfare of this mechanism also
provides a lower bound on VALq(DC
5.2 Bounding the Tail

A ,F|Ac ). SincePA⊆[m] ρAqA

∅ ,F).

We will now show that the tail revenue can be bounded by selling items separately under the given ex ante
supply constraint q. Our main result of this section is as follows.
Lemma 5.4. For any product distribution D over m independent items and any F,

XA⊆[m]

ρAREV(DT

A,F|A) ≤ 8(1 + ln 2)SREV q(D,F)

We will make use of the following weak but general relationship between the optimal revenue and the

revenue generated by selling separately for a single-agent constrained additive value setting.
Lemma 5.5. For any product distribution D over m items and any F,

REV(D,F) ≤ 4mSREV(D,FUNITDEMAND).

For every type v, let x′(v) = 1

Proof: Let M be a BIC mechanism such that REVM(D) = REV(D,F). Let (x(v), p(v)) be the lottery
offered by M to an agent who reports v. We modify M to get M′, a BIC mechanism which allocates at
most one item and has revenue REVM′
m p(v) be the lottery offered by M′. Since M is
supply-feasible, |x(v)|1 ≤ m, and so |x′(v)|1 ≤ 1. Therefore M′ is demand-feasible for the unit-demand
setting. Because the buyer’s utility is quasi-linear, scaling the allocation probabilities and payments by m
simply scales the utility of each outcome by m. Therefore, the buyer will select corresponding outcomes in
m REVM(D). So REV(D,F) ≤ mREV(D,FUNITDEMAND). The
M and M′, and M′ is BIC with revenue 1
following result of Chawla et al. (2010b) completes the proof.

m REVM(D).
m x(v) and p′(v) = 1

(D) = 1

14

Lemma 5.6. (Chawla et al. (2010b)) For any product distribution D,

REV(D,FUNITDEMAND) ≤ 4SREV(D,FUNITDEMAND).

PROOF OF LEMMA 5.4. Applying 5.5 to the revenues REV(DT

A,F|A), we have

XA

ρAREV(DT

A,F|A) ≤ 4XA

ρA|A|SREV(DT

A,FUNITDEMAND).

We will now use the fact that the tail contains few items in expectation. Let ξj denote the probability that
item j is in the tail: ξj = Prvj ∼Dj [vj > tj]. We can write the following series of inequalities.

XA

ρA|A|SREV(DT

ρA|A|Xj∈A
REV(DT

A,FUNITDEMAND) ≤XA
REV(DT
j )
= Xj∈[m]
j )XA∋j
= Xj∈[m]
ξjREV(DT
j )E[|A||j ∈ A]
≤ (1 + ln 2) Xj∈[m]

REVξj (Dj)

ρA|A|

1
ρ∅

≤

(1 + ln 2)SREVξ(D,F)

(2)

(3)

(4)

j

that achieves revenue REV(DT

Here inequality (2) follows by removing the demand constraint FUNITDEMAND. Inequality (3) follows
from Claim 1 by noting that the tail is non-empty with probability at most 1/2, and by noting that a single-
agent single-item mechanism for value distribution DT
j ) would achieve ξj
times that revenue on the value distribution Dj while satisfying an ex ante supply constraint of ξj. See
Appendix B for a proof of the claim.
Claim 1. Let {zi}i∈[n] be success probabilities for n independent Poisson trials. If the probability that all
n trials fail is at least 1/2, thenPi∈[n] zi ≤ ln 2.

Inequality (4) follows from the standard argument that the revenue obtained by selling each item indi-
vidually at prices tj (or higher) is at least ρ∅ times the sum of the corresponding per-item revenues. Finally,
the result follows by recalling that ρ∅ ≥ 1/2 and relaxing the ex ante constraint.
5.3 Bounding the Core

Recall that an item j is in the core if its value vj is no more than the threshold tj = βj + τ . We will bound
the ex ante constrained social welfare of the core, VALq(DC
∅ ,F), in two parts: the welfare obtained from
values below β via a prophet inequality and the welfare between β and β + τ using a concentration bound
introduced by Rubinstein and Weinberg (2015).

Recall that DC
j − βj to denote the distribution of vj − β conditioned on vj being in the core; in other words, DC
DC
the distribution DC
∅ −β is deﬁned to be the product of the distributions DC
Observe that value vectors drawn from DC
is straightforward and breaks up VALq(DC

j denotes the value distribution for item j conditioned on being in the core. We use
j − βj is
j −βj.
∅ − β are bounded by τ in every coordinate. The following lemma
∅ ,F) into the two parts described above.

j shifted to the left by βj. DC

15

Lemma 5.7. For any product disribution D and downwards closed feasibility constraint F, VALq(DC
β · q + VAL(DC
Proof: Let x(v) be the interim allocation rule of a BIC mechanism which is q-constrained under DC
attains social welfare equal to VALq(DC

∅ ,F). Then

∅ − β,F).

∅ ,F) ≤

∅ and

VALq(DC

∅ ,F) =Xj Z tj
≤Xj Z tj

0

0

fj(y)xj(y)y dy

fj(y)xj(y)βj dy +Xj Z tj

0

≤ β · q + VAL(DC

∅ − β,F).

fj(y)xj(y)(y − βj) dy

We ﬁrst show how to recover VAL(DC

∅ − β,F) using a two-part tariff for the original distribution D by
employing the following concentration result proved by Rubinstein and Weinberg (2015), based on a result
of Schechtman (1999).

Lemma 5.8 (Rubinstein and Weinberg (2015)). Let v be a constrained additive value function with a down-
wards closed feasibility constraint, drawn from a distribution over support (−∞, τ ] for some τ ≥ 0. Let a
be the median of the value of the grand bundle, v([m]). Then, E[v([m])] ≤ 3a + 4τ / ln 2.
Lemma 5.9.

VAL(DC

∅ − β,F) ≤ 6 BREV(D − β,F) +

8
ln 2

SREVq(D,F)

Consider offering the grand bundle at price a to a buyer with value drawn from DC

Proof: We apply Lemma 5.8 to the distribution DC
∅ − β to obtain VAL(DC
a is the median of the value of the grand bundle under the distribution DC
earlier.

∅ − β,F) ≤ 3a + 4τ / ln 2 where
∅ − β, and τ is the constant deﬁned
∅ − β; the buyer
accepts with probability 1/2. Therefore BREV(D − β) ≥ BREV(DC
∅ − β) ≥ a/2. Next, suppose
that τ > 0. Consider selling the items separately at prices tj for all j. Recall that τ > 0 implies that
Prv∼D[∃j s.t. vj > tj] = 1 − ρ∅ = 1/2. So the agent buys at least one item with probability 1/2. Noting
that tj > τ for all j, this item pricing obtains a revenue of at least τ /2. Since also tj ≥ βj for all j, we have
τ ≤ 2SREV q(D,F).
5.4 Putting the Pieces Together

Combining Lemmas 5.1, 5.4, 5.7, and 5.9 together, we obtain the main result of this section:
Lemma 5.10. For any product value distribution D, downward closed feasibility constraint F and ex ante
constraints q,

REVq(D,F) ≤ 6 BREV(D − β,F) + 8(1 + ln 2 + 1/ ln 2) SREV q(D,F) + β · q.

It remains to bound the β·q term. Note that this term is the revenue that would be obtained in the absence
of any demand constraint (equivalently, in the additive setting) by setting the ex ante prices on the items.
When F is a partition matroid and if the ex ante constraint q lies in the shrunk polytope 1
2PF , Chawla et al.
(2010a) show via a prophet inequality that the term β · q is bounded by the revenue of an item pricing.

16

Lemma 5.11 (Chawla et al. (2010a)). For a partition matroid F, ex ante constraints q ∈ 1
sponding ex ante prices β,

2PF , and corre-

β · q ≤ 2 SREVq(D,F).

No prophet inequality based on static thresholds is known for general matroids. However, Feldman et al.
(2016) nonetheless show that, if q ∈ bPF , selling at the ex ante prices recovers a (1 − b) fraction of the
relaxed revenue under a stronger demand constraint. This leads to the following result.
Lemma 5.12 (Feldman et al. (2016)). For a general matroid F, constant b ∈ (0, 1), ex ante constraints
q ∈ bPF , and corresponding ex ante prices β, there exists a submatroid F ′ ⊆ F such that

β · q ≤

1
1 − b

SREVq(D,F ′).

Furthermore, the constraint F ′ is efﬁciently computable.

We are now ready to prove Lemma 3.4 and Corollary 3.7, stated in Section 3.

Lemma 3.4. Let D be any product value distribution and F be a matroid with feasible polytope PF . Then,
for any q ∈ 1

2PF , there exists a submatroid F ′ ⊆ F such that

REVq(D,F) ≤ 33.1 TREV q(D,F ′)

If F is a partition matroid, then F ′ = F.
Proof:We ﬁrst observe that BREV(D − β,F) ≤ TREV q(D,F). In particular, for any a > 0, a two-part
tariff with entry fee a and item prices β achieves at least as much revenue over values drawn from D as does
a bundle pricing with price a over values drawn from D − β. The lemma now follows from Lemma 5.10,
together with the bounds on β · q given by Lemmas 5.11 and 5.12
2PF in Lemma 3.4 is necessary only to recover β · q;
we can, in fact, show a slightly weaker result which holds for arbitrary q.
Corollary 3.7. Let D be any product value distribution and F be a matroid. Then for any q ∈ [0, 1]m, there
exists a submatroid F ′ ⊆ F such that

As a ﬁnal remark, we note that the condition q ∈ 1

REVq(D,F) ≤ 35.1 TREV q(D,F ′)

If F is a partition matroid, then F ′ = F.
Proof: For any q ∈ [0, 1]m,

′≤q
q
′∈PF

q

REVq(D,F) ≤ max

REVq′(D,F).

Therefore, there exists q′ ∈ PF and corresponding β′ such that Lemma 5.10 gives

REVq(D,F) ≤ 31.1TREV q′(D,F) + β′ · q′.

Furthermore, by scaling q′ to lie in 1
2PF we can only increase the corresponding ex ante prices, so Lemma 5.12
gives β′ · q′ ≤ 4SREVq′(D,F ′) for some F ′ ⊆ F. The corollary now follows by noting TREVq′(D,F) ≤
TREVq(D,F) and SREVq′(D,F ′) ≤ SREV q(D,F ′).

17

6 Approximation for Symmetric Agents

Computing the approximate mechanisms of Theorem 3.5 requires being able to efﬁciently solve the ex

problem and it is not clear whether this can be solved or approximated efﬁciently in general. In this section
we show how to solve this problem in the special case where agents are a priori identical.

ante optimization, maxqPi REVqi(Di,Fi) s.t. Pi qi ≤ ~1. This is not necessarily a convex optimization
In a symmetric agents setting, agents share a common feasibility constraint and value distribution. In
particular, Fi = Fi′ = F and Di = Di′ = D for all i, i′ ∈ [n]. Note that the values of different items are
not necessarily distributed identically, neither is F necessarily symmetric across items. Since each agent is
identical, we can focus on maximizing the revenue obtained from a single agent, while ensuring that the ex
ante probability of selling each item is small enough that we may apply Lemma 3.2. We formalize this in
the following lemma. See Appendix B for a proof.
Lemma 6.1. In a symmetric agents setting with n agents, a matroid feasibility constraint F and product
distribution D,

REV(×nD,×nF) ≤ 2n

max
q∈PF ∩h0,

1

2nim

REVq(D,F),

For the remainder of this section, we focus on efﬁciently approximately maximizing the single agent

2n(cid:3)m. Lemma 5.10
bounds the revenue by three terms; we observe that SREVq(D,F) is at most maxq′≤q q′ · D−1(1 − q′).
Therefore,

objective REV q(D,F) subject to q ∈ cPF , where we use cPF as short form for PF ∩(cid:2)0, 1

max
q∈dPF

REV q(D,F) ≤ 6 max
q∈dPF

BREV(D − D−1(1 − q),F) + 26.1 max
q∈dPF
≤ 6 BREV(D − D−1(1 − 1/2n),F) + 26.1 max
q∈dPF

q · D−1(1 − q)
q · D−1(1 − q)

(5)

The ﬁrst term on the LHS of Equation (5) is easy to capture. We can use sampling to efﬁciently compute the
−1(1−
optimal bundle price for the value distribution D−D−1(1− 1/2n). Call this price a, and let pj = Dj
1/2n) for all items j ∈ [m]. Then, by Lemma 3.2 the multi-agent sequential two-part tariff mechanism that
offers each agent an entry fee of a and per item pricing p obtains revenue at least n
2 BREV(D − D−1(1 −
1/2n),F).

This leaves us with the following maximization problem:

2n(cid:3)m
s.t. q ∈ PF ∩(cid:2)0, 1

maximize q · D−1(1 − q)

We obtain a (potentially random) vector q that in expectation satisﬁes the feasibility constraint cPF and ob-

(6)
In Appendix D we discuss how to solve (a relaxation of) this problem efﬁciently when F is a matroid.
tains an expected objective function value no smaller than the optimum of (6). Then, for partition matroids,
we can employ a constructive version of Lemma 5.11 due to Chawla et al. (2010a) to obtain a (potentially
random) sequential two-part tariff mechanism that obtains revenue at least n
4 times the optimum of (6). For
general matroids, we can likewise employ a constructive version of Theorem 5.12 due to Feldman et al.
(2016) to obtain a (potentially random) demand-limiting sequential two-part tariff mechanism that obtains
revenue at least n
Theorem 6.2. For any symmetric, matroid feasibility constraint F and symmetric, product distribution D,
there is an efﬁciently computable randomized demand-limiting sequential two-part tariff mechanism M and
a constant c such that

4 times the optimum of (6). We obtain the following theorem.

REV(D,F) ≤ c REVM(D).

18

When F is a partition matroid, we obtain a sequential two-part tariff mechanism, and when Dj is regular
for all j, our mechanism is deterministic.

Acknowledgements

We are grateful to Jason Hartline for insights on efﬁciently solving the optimization problem (6).

References

Alaei, S. (2011). Bayesian combinatorial auctions: Expanding single buyer mechanisms to many buyers. In

IEEE Symp. on Foundations of Computer Science, pages 512–521. 1, 2, 4

Armstrong, M. (1999). Price discrimination by a many-product ﬁrm. The Review of Economic Studies,

66(1):151–168. 2

Babaioff, M., Immorlica, N., Lucier, B., and Weinberg, S. (2014). A simple and approximately optimal
mechanism for an additive buyer. In Foundations of Computer Science (FOCS), 2014 IEEE 55th Annual
Symposium on, pages 21–30. 3, 4, 6, 8, 12, 22, 23, 24

Briest, P., Chawla, S., Kleinberg, R., and Weinberg, S. M. (2010). Pricing randomized allocations. In ACM

Symp. on Discrete Algorithms, pages 585–597. 2

Cai, Y., Daskalakis, C., and Weinberg, S. M. (2012a). An algorithmic characterization of multi-dimensional

mechanisms. In ACM Symp. on Theory of Computing, pages 459–478. 3

Cai, Y., Daskalakis, C., and Weinberg, S. M. (2012b). Optimal multi-dimensional mechanism design:
Reducing revenue to welfare maximization. In IEEE Symp. on Foundations of Computer Science, pages
130–139. 3

Cai, Y., Daskalakis, C., and Weinberg, S. M. (2013a). Reducing revenue to welfare maximization: Approx-
In ACM Symp. on Discrete Algorithms, pages 578–595.

imation algorithms and other generalizations.
3

Cai, Y., Daskalakis, C., and Weinberg, S. M. (2013b). Understanding incentives: Mechanism design be-

comes algorithm design. In IEEE Symp. on Foundations of Computer Science, pages 618–627. 3

Cai, Y., Devanur, N., and Weinberg, S. M. (2016). A duality based uniﬁed approach to bayesian mechanism
design. In Proceedings of the 48th Annual ACM Symposium on Theory of Computing (STOC). To appear.
3, 4, 6

Chawla, S., Hartline, J., and Kleinberg, R. (2007). Algorithmic pricing via virtual valuations. In Proc. 9th

ACM Conf. on Electronic Commerce, pages 243–251. 3

Chawla, S., Hartline, J. D., Malec, D. L., and Sivan, B. (2010a). Multi-parameter mechanism design and
sequential posted pricing. In ACM Symp. on Theory of Computing, pages 311–320. 2, 3, 4, 5, 16, 17, 18

Chawla, S., Malec, D., and Sivan, B. (2010b). The power of randomness in Bayesian optimal mechanism

design. In Proc. 12th ACM Conf. on Electronic Commerce. 3, 4, 8, 14, 15

19

Daskalakis, C., Deckelbaum, A., and Tzamos, C. (2012). Optimal pricing is hard. In Workshop on Internet

and Network Economics (WINE), pages 298–308. 2

Daskalakis, C., Deckelbaum, A., and Tzamos, C. (2014). The complexity of optimal mechanism design. In

ACM Symp. on Discrete Algorithms, pages 1302–1318. 2

Daskalakis, C., Deckelbaum, A., and Tzamos, C. (2015). Strong duality for a multiple-good monopolist. In
Proceedings of the Sixteenth ACM Conference on Economics and Computation, EC ’15, pages 449–450.
4

Feldman, M., Svensson, O., and Zenklusen, R. (2016). Online contention resolution schemes. In Proceed-
ings of the Twenty-Seventh Annual ACM-SIAM Symposium on Discrete Algorithms, SODA ’16, pages
1014–1033. 2, 5, 17, 18

Giannakopoulos, Y. and Koutsoupias, E. (2014). Duality and optimality of auctions for uniform distribu-
tions. In Proceedings of the Fifteenth ACM Conference on Economics and Computation, EC ’14, pages
259–276. 4

Giannakopoulos, Y. and Koutsoupias, E. (2015). Selling two goods optimally. In Automata, Languages, and

Programming: 42nd International Colloquium, ICALP 2015, pages 650–662. 4

Haghpanah, N. and Hartline, J. (2015). Reverse mechanism design. In Proceedings of the Sixteenth ACM

Conference on Economics and Computation, EC ’15, pages 757–758. 4

Hart, S. and Nisan, N. (2012). Approximate revenue maximization with multiple items. In ACM Conf. on

Electronic Commerce, page 656. 2, 3

Hart, S. and Nisan, N. (2013). The menu-size complexity of auctions. In ACM Conf. on Electronic Com-

merce, pages 565–566. 2, 3

Hartline, J. (2016a). Private communication. 25

Hartline, J. (2016b). Mechanism Design and Approximation. 2

Kleinberg, R. and Weinberg, S. M. (2012). Matroid prophet inequalities.

In ACM Symp. on Theory of

Computing, pages 123–136. 5

Li, X. and Yao, A. C.-C. (2013). On revenue maximization for selling multiple independently distributed

items. Proceedings of the National Academy of Sciences. 1, 2, 3, 4, 12, 24

Reny, P. J. and Hart, S. (2015). Maximal revenue with multiple goods: nonmonotonicity and other observa-

tions. Theoretical Economics, 10(3). 2

Rubinstein, A. and Weinberg, S. M. (2015). Simple mechanisms for a subadditive buyer and applications to
revenue monotonicity. In Proceedings of the Sixteenth ACM Conference on Economics and Computation,
EC ’15, pages 377–394. 1, 2, 3, 4, 5, 6, 8, 15, 16

Schechtman, G. (1999). Concentration, results and applications. 16

Yao, A. C.-C. (2015). An n-to-1 bidder reduction for multi-item auctions and its applications. In Proceedings
of the Twenty-Sixth Annual ACM-SIAM Symposium on Discrete Algorithms, SODA ’15, pages 92–109. 3,
6

20

A Matroid Concepts

A matroid M is a tuple (G,I) where G is called the ground set and I ⊆ 2G is a collection of independent
sets satisfying the following two properties:

1. If I ⊆ J and J ∈ I, then I ∈ I (I is downward-closed); and
2. If I, J ∈ I and |J| > |I|, then there exists e ∈ J \ I such that (I ∪ {e}) ∈ I.

A basis is an independent set of maximal size: B ⊆ G is a basis if B ∈ I and |I| ≤ |B| for all I ∈ I. The
following lemma is a simple consequence of the fact that the greedy algorithm ﬁnds the maximum weight
basis in any matroid.
Lemma A.1. Let F be any matroid over ground set G, I be any subset of G, and w be any vector of weights
deﬁned on elements in G. If j ∈ G belongs to a maximum weight basis of F and j ∈ I, then j also belongs
to a maximum weight basis of F|I .

Several classes of matroids are of special interest. A k-uniform matroid is a matroid in which any
S ⊆ G with |S| ≤ k is an independent set; the class of uniform matroids generalizes the extensively studied
additive (k = m) and unit-demand (k = 1) settings. A partition matroid is the union of uniform matroids:
G = G1 ∪ . . . ∪ GN , where (Gi,Ii) is a ki-uniform matroid, and a set S ⊆ G is independent if S ∩ Gi ∈ Ii
for all i.

B Omitted Proofs

B.1 Proofs from Section 5

PROOF OF CLAIM 1. We prove the lemma under the assumption thatQi∈[n](1 − qi) = 1

2. It is clear that if
the probability of zero successes is higher, the expected number of successes is lower. We wish to ﬁnd an
upper bound on the following maximization problem:

qi

s.t.

max Xi∈[n]
Yi∈[n]

0 ≤ qi ≤ 1

(1 − qi) =

∀i

1
2

.

Note that, given the second constraint, the ﬁrst set of constraints is loose: each qi is actually at most 1/2.

We ﬁrst solve for qn using the constraint on the probability of zero successes. Substituting this expres-

sion for qn, the objective becomes

f (q1, . . . , qn−1) = Xi∈[n−1]

qi + 1 −

1

2 Yi∈[n−1]

(1 − qi)−1,

subject only to the constraint that each qi be a valid probability.

21

We now ﬁnd a critical point in the feasible region and show that it is the unique maximum. The ﬁrst-

and second-order partial derivatives of the objective are

∂f
∂xi

∂2f
∂x2
i

∂2f

∂xi∂xj

(1 − qj)−1,

1
2

= 1 −

(1 − qi)−2Yj6=i
= −(1 − qi)−3Yj6=i

(1 − qj)−1, and
(1 − qi)−2(1 − qj)−2 Yk6=i,j

1
2

= −

(1 − qk)−1.

Now, suppose f has some critical point ˆq with ˆqi 6= ˆqj for some i, j ≤ n− 1. Then, ﬁxing all other ˆqk’s,

we have

(1 − ˆqi)2(1 − ˆqj) = X = (1 − ˆqi)(1 − ˆqj)2.

Since none of these terms is zero (because each qi is at most 1/2), the critical point must have ˆqi = ˆqj for
all i, j ∈ [n − 1]. Assuming identical ˆqi’s and setting the gradient to zero gives ˆqi = (1 − 2−1/n) for all
i ∈ [n − 1]. The Hessian matrix at this point is

H(f )ij =(−2 · 21/n
−21/n

if i = j
otherwise.

This matrix is negative deﬁnite, so the critical point is the unique maximum in the feasible region.

Solving for ˆqn gives ˆqn = 1 − 2−1/n; i.e., all n probabilities are equal. The objective of the original

maximization problem is thus

Xi∈[n]

ˆqi = n(1 − 2−1/n) ≤ ln 2.

B.2 Proofs from Section 6

PROOF OF LEMMA 6.1. Let M be a demand- and supply-feasible BIC mechanism such that REVM(D) =
REV(D,F). Let qij be the probability with which M sells item j to agent i. By symmetry, we can permute
the identities of the agents uniformly at random before running M without hurting the expected revenue.
Under this permutation, the ex ante probability with which M sells j to i is at most 1/n. We can therefore
assume without loss of generality that qij ≤ 1/n. Now, consider a single agent i; with probability 1/2,
allocate the empty set to this agent at price 0, and with probability 1/2, draw values for all other agents from
D−i and simulate mechanism M. The resulting mechanism is a single agent mechanism that obtains a 1/2n

fraction of the revenue of M and satisﬁes an ex ante constraint q ∈ PF ∩(cid:2)0, 1

2n(cid:3)m. The lemma follows.

C Alternate Approximation for Many Additive Agents

For the special case of additive buyers, we show how to modify the analysis of Babaioff et al. (2014) in
order to achieve a much tighter bound than that stated in Theorem 3.5. The relaxation and stitching steps

22

Notation Deﬁnition

Formula

Table 2: Notation for Section C.

q Ex ante probabilities

β Ex ante prices

rj Revenue from item j

r

Item-pricing revenue

tj Core-tail threshold for item j

ξj

Probability item j is in the tail

D − p Distribution D shifted to the left by p

−1(1 − qj) ∀j ∈ [m]

βj = Dj
REVqj (Dj)

Pj rj

max(βj , r)
Prvj ∼Dj [vj > tj]

hold as before; we prove that Babaioff et al.’s single-agent approximation can be made to respect ex ante
constraints with only a small penalty to the approximation factor.
Lemma C.1. For any product distribution D and any q ∈ [0, 1]m,

REVq(D,FADDITIVE) ≤ 7 TREV q(D,FADDITIVE)

Combining Lemma C.1 with Lemma 3.1 and Corollary 3.3 as before, we get our improved result.

Theorem C.2. For any product value distribution D, there exists a supply-feasible sequential two-part tariff
mechanism M such that

REV(D,×nFADDITIVE) ≤ 28 REVM(D)

We devote the remainder of this section to the proof of Lemma C.1; we drop the explicit dependence on

the feasibility constraint, FADDITIVE, for clarity.
We make use of the fact that relaxing the demand constraint is unnecessary in the additive setting. This
allows us to get a much tighter concentration result in the core. Instead of deﬁning tj = βj + τ , as in
Section 5, we deﬁne tj = max (βj, SREV q(D)). It is straightforward to verify that our core decomposition
(Lemma 5.1) continues to hold under this deﬁnition. The key insight in Babaioff et al. (2014)’s analysis is
that this deﬁnition allows for a nontrivial bound on the variance of the core, leading to a strong concentration
result via Chebyshev’s inequality, while keeping the expected number of items in the tail small. It turns out
that their analysis goes through under an ex ante constraint, except for a small loss in the core due to
enforcing the constraint for the bundle pricing.

In addition to the notation from Section 5, we deﬁne the following notation (see Table 2). Let rj =

REVqj (Dj) and r = SREVq(D). Note that in the additive setting SREVq(D) =Pj REVqj (Dj); in other
words, r =Pj rj.

By Lemmas 5.1 and 5.7, we have

REVq(D) ≤ β · q + VAL(DC

∅ − β) + XA⊆[m]

ρAREV(DT
A)

Clearly β · q ≤ SREVq(D), so it remains to bound the other two terms. Note that the ex ante constraint
has been effectively removed from these terms; we will show that Babaioff et al.’s unconstrained bounds

23

∅ − β) ≤ TREVq(D) completes the proof.

continue to apply here. We state these bounds and then show that our distributions satisfy their conditions.
Recalling that BREV(DC
Lemma C.3 (Babaioff et al. (2014)). If, for all j, V ar(DC
∅ − β) ≤ 4 max(cid:8)BREV(DC
Lemma C.4 (Babaioff et al. (2014)). If, for all j, REV(DT
XA⊆[m]

∅ − β), SREV q(D)(cid:9)

j ) ≤ rj/ξj and ξj ≤ rj/r, then

j − βj) ≤ 2rrj, then

VAL(DC

ρAREV(DT

A) ≤ 2 SREV q(D)

The following two lemmas capture the necessary conditions.

j − βj) ≤ 2rrj

j − βj) ≤ rj for all j. Let pj

j at price pj
j − βj) ≤ REVqj (DC

Lemma C.5. V ar(DC
Proof: We ﬁrst prove REV(DC
DC
j − βj. Selling to DC
qj, so REV(DC
REVqj (DC
j ) sells to DC
gets at least as much revenue and satisﬁes the same ex ante constraint.

∗ ≥ 0 be an optimal price for selling to
∗ + βj gets at least as much revenue and sells with probability at most
j ). Now, let q∗
j be the probability with which a mechanism obtaining
j , selling to Dj with probability q∗
j
Given the above, we employ an argument originally due to Li and Yao (2013) to bound the variance of
DC
j − qj. Note that DC
j −βj)[V ≥ v] ≤
rj/v. Then

j − βj is supported on [0, r], but its revenue is at most rj. So PrV ∼(DC

j . Clearly, since Dj stochastically dominates DC

EV ∼(DC

min(1, rj /√v) dv

j −βj)(cid:2)V 2(cid:3) ≤Z r2

0

≤ 2rrj

j ). Then, by setting price pj

j ) ≤ rj/ξj and ξj ≤ rj/r.

Lemma C.6. REV(DT
Proof: The ﬁrst inequality follows from the assumption that tj ≥ βj. Let pj
REV(DT
constraint qj. In other words, ξjREV(DT
ante constraint qj. Since REVqj (Dj) = rj, we must have ξjr ≤ ξjtj ≤ rj.

∗ be an optimal price for
j ) from Dj while respecting the ex ante
Recall that tj ≥ r. So one could sell item j at price tj and earn proﬁt ξjtj ≥ ξjr while respecting the ex

∗, one can obtain ξjREV(DT
j ) ≤ REVqj (Dj) = rj.

D Efﬁcient Approximation for Symmetric Agents

We will now discuss how to solve the optimization problem (6) efﬁciently when F is a matroid. We ﬁrst
modify the distribution D so that for every item j, any value below quantile 1 − 1/2n is mapped to 0. The
problem then simpliﬁes to the following.

maximize q · D−1(1 − q)

s.t. q ∈ PF

(7)

24

This problem is related to the ex ante relaxation of the single-parameter revenue maximization problem
with m buyers, where buyer j’s value is distributed independently according to Dj and the seller faces the
feasibility constraint F (i.e., he can sell to any subset of buyers that form an independent set in F). When
the distributions Dj are all regular, the objective q · D−1(1 − q) is concave, and the above problem can be
solved using standard convex optimization techniques.
In this case, allowing
for a randomized solution convexiﬁes the problem. Consider the following relaxation that maximizes the
objective over all distributions over vectors q:

When the distributions Dj are not all regular, (7) is not necessarily convex.

maximize E(cid:2)q · D−1(1 − q)(cid:3)

s.t. E[q] ∈ PF

(8)

This problem can in turn be restated as follows: maximize the ironed virtual surplus of a BIC mechanism
for the single-parameter revenue maximization problem stated above subject to the feasibility constraint PF
imposed ex ante.
Hartline (2016a) describes an alternative to standard convex optimization for solving the above problem
to within arbitrary accuracy. Pick a sufﬁciently small ǫ > 0. Discretize the problem by creating a new
′ for every j ∈ [m] as follows: for every integer z in [0, 1/ǫ], place a mass of ǫ
discrete distribution Dj
on the ironed virtual value for distribution Dj at quantile zǫ. Let Rj denote the support of distribution
′. Over these discrete supports, the ironed virtual value maximization problem becomes one of selecting
Dj
a subset of ∪jRj of maximum total (ironed virtual) value subject to the constraint that the subset can be
partitioned into at most 1/ǫ parts each of which is independent in F. In other words, this is the problem
of ﬁnding a maximum weight basis over a matroid formed by the union of 1/ǫ identical copies of F. The
standard greedy algorithm for matroids solves this problem efﬁciently for any constant ǫ. This algorithm
−1(1), and in the case of non-regular distributions,

approximates (8) to within an additive error of ǫPj Dj

produces a distribution over two vectors q1 and q2 that in expectation satisﬁes the constraint PF .

25

