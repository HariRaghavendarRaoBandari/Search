6
1
0
2

 
r
a

 

M
9
 
 
]
F
M
n
i
f
-
q
[
 
 

.

1
v
7
6
8
2
0

.

3
0
6
1
:
v
i
X
r
a

Convex duality in optimal investment and

contingent claim valuation in illiquid markets

Teemu Pennanen∗

Ari-Pekka Perkki¨o†

March 10, 2016

Abstract

This paper studies convex duality in optimal investment and contin-
gent claim valuation in markets where traded assets may be subject to
nonlinear trading costs and portfolio constraints. Under fairly general
conditions, the dual expressions decompose into tree terms, correspond-
ing to the agent’s risk preferences, trading costs and portfolio constraints,
respectively. The dual representations are shown to be valid when the
market model satisﬁes an appropriate generalization of the no-arbitrage
condition and the agent’s utility function satisﬁes an appropriate gener-
alization of asymptotic elasticity conditions. When applied to classical
liquid market models or models with bid-ask spreads, we recover well-
known pricing formulas in terms of martingale measures and consistent
price systems. Building on the general theory of convex stochastic op-
timization, we also derive optimality conditions in terms of an extended
notion of a “shadow price”.

1 Introduction

A fundamental problem in ﬁnancial economics is that of managing investments
so that their proceeds cover given liabilities as well as possible. This is important
not only in wealth management but also in valuation of ﬁnancial products.
Both optimal investment and asset valuation are often analyzed by introducing
certain dual variables that appear e.g. in optimality conditions and valuation
operators. Classical references include [29], [30], [42] and [18] where the no-
arbitrage condition was related to the existence of martingale measures; see [20]
for a detailed discussion of the topic. In problems of optimal investment, convex
duality has become an important tool in the analysis of optimal solutions; see
e.g. [16], [39], [21], [37], [62] and their references.

∗Department of Mathematics, King’s College London, Strand, London, WC2R 2LS, United

Kingdom, teemu.pennanen@kcl.ac.uk.

†Department of Mathematics, Technische Universit¨at Berlin, Building MA, Str. des 17.
Juni 136, 10623 Berlin, Germany, perkkioe@math.tu-berlin.de. The author is grateful to the
Einstein Foundation for the ﬁnancial support.

1

This article studies convex duality in optimal investment and contingent
claim valuation in illiquid markets where one may face nonlinear trading costs
and portfolio constraints that hinder transfer of funds between asset classes or
through time. Building on general theory of convex stochastic optimization, we
give explicit expressions for the dual objective as well as suﬃcient conditions for
absence of a duality gap and for the attainment of the dual optimum. The ﬁrst
set of conditions involve a multivariate generalizations of the asymptotic elas-
ticity conditions from [39, 64] as well as a condition that generalizes the robust
no-arbitrage condition in unconstrained models with proportional transaction
costs. The conditions for attainment of the dual optimum are closely related to
those of [6, Corollary 5.2] in the context of perfectly liquid market models. The
dual solutions provide a natural extension of the notion of a “shadow price”
from unconstrained sublinear market model of [17] to general convex models.
Analogously to shadow prices, the optimal dual variables, when they exist, yield
pointwise optimality conditions for optimal investment strategies.

Under nonlinear illiquidity eﬀects and nonconical portfolio constraints, the
dual objective turns out to be the sum of three nonlinear terms. Like in classical
perfectly liquid models, the ﬁrst term is the conjugate of the primal objective.
The two other terms correspond to trading costs and portfolio constraints, re-
spectively. In the classical perfectly liquid model with a cash-account, we recover
the familiar dual problem over positive multiples of martingale densities. In the
absence of a cash-account, however, the dual variables become stochastic dis-
count factors that account for uncertainty as well as for time-value of money
much like in the numeraire-free conical models of [22], [33], [44], [43] and [67].
Introduction of short-sales constraints result in stochastic discount factors that
turn the market prices into supermartingales like in [34]. Adding proportional
transaction costs, one gets similar conditions for a “shadow price” process that
evolves within the bid-ask spread; see [35, 17].

Our model of nonlinear trading costs is closely related to the continuous-
time model of [28]. Within the discrete-time framework, we are able to relax
the coercivity conditions of [28] so as to allow for nondecreasing as well as linear
trading costs. Analogously to [28], we extend the analysis also to contingent
claims with physical delivery. It turns out that this is the natural framework of
analysis and the results on cash-valued contingent claims are derived from the
corresponding results for multivariate claims.

Building on the duality theory of optimal investment, we derive dual expres-
sions for the values of contingent claims that may have several payout dates.
As in [51], two widely studied notions of a value will be considered. The ﬁrst
one, which we will refer to as accounting value, is deﬁned as the least amount of
initial cash that is needed to hedge a claim at an acceptable level of risk. In the
most risk averse case, where one does not accept any risk of a loss at maturity,
this reduces to the classical superhedging cost. More reasonable versions are
obtained by relaxing the superhedging requirement to that of acceptable “risk”
associated with the terminal net position. Such valuations have been studied
under various names including (but not restricted to) “risk measure” [2, 3], “ef-
ﬁcient hedging” [25, 26] or “good-deal bounds” [14]. The second notion of value

2

is that of indiﬀerence price which is the natural notion for an agent who con-
siders entering a ﬁnancial transaction and is interested in how the trade would
change his existing ﬁnancial position; see e.g. [32, 63, 13] and their references.
Dual expressions for the accounting values turn out to have the same general
structure as in “good deal bounds” studied e.g. in [33] and [14]. The dual
representation may also be seen as a multiperiod generalization of the dual
representation of a convex risk measure in illiquid markets.
In the case of
indiﬀerence swap rates, we obtain illiquid discrete-time versions of the pricing
formulas derived e.g. in [45, Section 7] and [8, Section 4].

2 Optimal investment and contingent claim val-

uation

Consider a ﬁnancial market where a ﬁnite set J of assets can be traded over
t = 0, . . . , T . As usual, we will model uncertainty and information by a ﬁltered
t=0, P ). The cost of buying a portfolio x ∈ RJ at time t
probability (Ω, F , (Ft)T
and state ω will be denoted by St(x, ω). We assume that St : RJ ×Ω → R is a an
Ft-measurable convex normal integrand (see the appendix) such that St(0, ω) =
0. This abstract speciﬁcation covers e.g. proportional transaction costs as well as
transient illiquidity eﬀects one faces e.g. in limit order markets. In the presence
of portfolio constraints, the set of portfolios that can be held over (t, t + 1]
will denoted by Dt(ω) ⊆ RJ . We assume that Dt is Ft-measurable, closed and
convex-valued with 0 ∈ Dt(ω). We emphasize that we do not assume a priori the
existence of a perfectly liquid numeraire asset that is free of such constraints.
Such models can, however, be treated as special cases of the market model
(S, D); see Example 2 below. More examples with e.g. proportional transactions
and speciﬁc instances of portfolio constraints can be found in [47, 50, 49, 51].

In a market without perfectly liquid assets it is important to distinguish
between payments at diﬀerent points in time. See [51, 43, 67] for further dis-
cussion. Accordingly, we will describe the agent’s preferences over sequences
of payments by a normal integrand V on RT +1 × Ω. More precisely, the agent
prefers to make a random sequence c1 of payments over another c2 if

EV (c1) < EV (c2)

while she is indiﬀerent between the two if the expectations are equal. A possible
choice would be

T

V (c, ω) =

Vt(ct, ω).

(1)

In general, the function V can be seen as a multivariate generalization of a
“loss function” in the sense of [26, Deﬁnition 4.111], where a loss function was
a nonconstant nondecreasing function on R. Multivariate utility functions have
been studied also in [12] where the utility was a function of a portfolio of assets.
More recently, [67] studied optimal consumption investment

Xt=0

3

We allow for random, nondiﬀerentiable, extended real-valued loss functions

V but will require the following.

Assumption 1. The loss function V is a normal integrand on RT +1 × Ω such
that for P -almost every ω ∈ Ω, the function V (·, ω) is convex and nondecreasing
with respect to the componentwise order of RJ , V (0, ω) = 0 and for every
nonzero c ∈ RT +1

there exists an α > 0 such that V (αc, ω) > 0.

+

The last condition in Assumption 1 means that the agent is not completely
indiﬀerent with respect to nonzero nonnegative payments. It holds in particular
if V is of the form (1) and each Vt is convex Ft-normal integrand on R × Ω such
that Vt(·, ω) is nonconstant and nondecreasing with V (0, ω) = 0.

We will study optimal investment from the point of view of an agent who
has ﬁnancial liabilities described by a random sequence c of payments to be
made over time. We allow c to take arbitrary real values so it can describe
endowments as well as liabilities. The agent’s problem is to ﬁnd a trading
strategy that hedges against the liabilities c as well as possible as measured by
EV . Denoting the linear space of adapted RJ -valued trading strategies by N ,
we can write the problem as

minimize EV (S(∆x) + c)

over

x ∈ ND,

(ALM)

where ND = {x ∈ N | xt ∈ Dt ∀t P -a.s.} is the set of feasible trading strategies,
S(∆x) denotes the process (St(∆xt))T
t=0 and x−1 := 0. Here and in what follows,
we deﬁne the expectation of a measurable function as +∞ unless the positive
part is integrable. For any z ∈ RJ and c ∈ R, we set V (S(z, ω) + c, ω) := +∞
unless zt ∈ dom St(·, ω) for all t. Thus, (ALM) incorporates the constraint
∆xt ∈ dom St almost surely for all t, i.e. there may be limits on traded amounts.
Assumption 1 guarantees that the objective of (ALM) is a well-deﬁned convex
function on N ; see Corollary 17 in the appendix. We assume that DT (ω) = {0},
i.e., the agent is required to close all positions at time T .

Throughout this paper, we will denote the optimum value of (ALM) by ϕ(c).
The optimum value function ϕ is an extended real-valued function on the linear
space M of random sequences of payments.

Problem (ALM) covers discrete-time versions of many more traditional mod-
els of optimal investment that have appeared in the literature. In particular,
(ALM) can be interpreted as an optimal consumption-investment problem with
random endowment −ct and consumption −St(∆xt) − ct at time t. Our for-
mulation extends the more common formulations with a perfectly liquid nu-
meraire asset; see e.g. [16, 37] and their references. Problem ALM is close to
[67, Section 2], where optimal investment-consumption was studied in a linear
discrete-time market model without a perfectly liquid numeraire asset.

Allowing for extended real-valued loss functions V , we can treat superhedg-
ing problems and problems with explicit budget constraints as special cases of
(ALM). We will denote by

C := {c ∈ M | ∃x ∈ ND : S(∆x) + c ≤ 0},

the set of claims that can be superhedged without a cost.

4

Example 1. When V is of the form

V (c, ω) =(VT (cT , ω)

+∞

if ct ≤ 0 for t < T ,
otherwise,

problem (ALM) can be written with explicit budget constraints as follows

minimize
subject to

EVT (ST (∆xT ) + cT )
St(∆xt) + ct ≤ 0,

over

x ∈ ND

∀t < T P -a.s.

(2)

This is an illiquid version of the classical problem of maximizing expected utility
of terminal wealth. Indeed, since xT = 0 for all x ∈ ND, we have ST (∆xT ) =
ST (−xT −1), which is the cost of closing all positions at time T . Alternatively,
one may interpret −ST (−xT −1) as the liquidation value of xT −1. When1 V =
δRT +1 we have ϕ = δC.

In models with perfectly liquid cash, problem (2) can be written in a more

familiar form.

Example 2. Models with perfectly liquid cash correspond to

St(x, ω) = x0 + ˜St(˜x, ω) and Dt(ω) = R × ˜Dt(ω),

where x = (x0, ˜x) and ˜S and ˜D are the trading cost and the constraints for the
remaining risky assets J \ {0}. When c is adapted, one can then use the budget
constraint in problem (2) to substitute out the cash investments x0 from the
problem formulation much like in [15, Equation (2.9)] and [28, Equation (4)].
Recalling that xT = 0 for x ∈ ND, problem (2) can thus be written as

minimize

EVT   T
Xt=0

˜St(∆˜xt) +

ct! over

T

Xt=0

x ∈ ND

If one specializes further to the perfectly liquid market model where ˜St(˜x) = ˜st· ˜xt
for a unit price process ˜s that is independent of the trades, one can express
the accumulated trading costs in the objective as a stochastic integral of ˜x with
respect to ˜s, thus recovering a discrete-time version of the classical formulation
from e.g. in [39, 21, 40, 7, 8]. Note that in [39, 40, 7], the ﬁnancial position of
the agent was described solely in terms of an initial endowment w ∈ R without
future liabilities. This corresponds to c0 = −w and ct = 0 for t > 0.

We ﬁnish this section with a short review of contingent claim valuation under
illiquidity; see [51] for further discussion. The accounting value of the liability
of delivering a contingent claim c ∈ M is deﬁned in terms of the optimum value
function ϕ of (ALM) as

s (c) = inf{α ∈ R | ϕ(c − αp0) ≤ 0},
π0

1Here and in what follows, δC denotes the indicator function of a set C: δC (x) equals 0 or

+∞ depending on whether x ∈ C or not.

5

0 = 1 and p0

where p0 ∈ M is given by p0
t = 0 for t > 0. The accounting
value gives the least amount of initial capital needed to hedge the claim c at
an acceptable level of risk as measured by EV . This extends the notion of
“eﬃcient hedging” with minimal shortfall risk from [26, Section 8.2] to illiquid
markets and claims with multiple payout dates. Alternatively, π0
s (c) can be
seen as an extension of a “risk measure” from [2] to markets without a perfectly
liquid “reference asset”. The function π0
s : M → R is convex and nondecreasing
with respect to the pointwise ordering on M. It also has a translation property
that extends the one proposed in [2]; see the remarks after [51, Theorem 3.2].
Applications of π0
s (c) gives
the least amount of initial cash required to construct an acceptable hedging
strategy for a liability c ∈ M, the number

s in pension insurance are studied in [31]. While π0

l (c) := sup{α ∈ R | ϕ(αp0 − c) ≤ 0}
π0

gives the greatest initial payment one could cover at an acceptable level of risk
(by shorting traded assets at time t = 0 and dynamically trading to close posi-
tions by time t = T ) when receiving c ∈ M. We will call π0
l (c) the accounting
value of an asset c ∈ M. Clearly, π0
s (−c). Accounting values for as-
sets are relevant e.g. in banks whose assets are divided into the trading book and
the banking book. Assets in the banking book are typically illiquid assets with-
out secondary markets. The above deﬁnition of π0
l (c) gives a market consistent,
hedging based value for such assets.

l (c) = −π0

The second notion of a “value” considered in this paper extends the notion
of indiﬀerence price from [32]. The indiﬀerence swap rate of exchanging a claim
c ∈ M for a multiple of a premium sequence p ∈ M is deﬁned as

πs(¯c, p; c) = inf{α ∈ R | ϕ(¯c + c − αp) ≤ ϕ(¯c)},

where ¯c ∈ M describes the agent’s initial liabilities. The interpretation is that
the indiﬀerence swap rate gives the least swap rate that would allow the agent
to enter the swap contract without worsening her position as measured by the
optimum value of (ALM). While accounting values are important in accounting
and ﬁnancial supervision, indiﬀerence swap rates are more relevant in trading.
The indiﬀerence swap rate for taking the other side (“long position”) of the
swap contract is given analogously by

πl(¯c, p; c) = sup{α ∈ R | ϕ(¯c − c + αp) ≤ ϕ(¯c)}.

Note that when c = (0, . . . , 0, cT ) and p = p0, the indiﬀerence swap rate reduces
to the familiar notion of indiﬀerence price.

We end this section by recalling some basic facts about superhedging and
the arbitrage bounds for accounting values and indiﬀerence swap rates; see [51]
for more details. We have

ϕ(c) = inf
d∈C

EV (c − d).

6

Moreover, ϕ, π0
creasing in the directions of the recession cone

s and π(¯c, p; ·) are convex functions on M and they are nonin-

C∞ = {c ∈ M | ¯c + αc ∈ C ∀¯c ∈ C, α > 0}

of C∞. Clearly, C∞ is a convex cone and C∞ ⊆ C with equality when C is a cone
(as is the case e.g. under proportional transaction costs and conical constraints).
We will give an explicit expression for C∞ in terms of the market model (S, D);
see Corollary 7 below.

The accounting values can be bounded between the super- and subhedging

cost deﬁned by

π0
sup(c) = inf{α ∈ R | c − αp0 ∈ C} and π0

inf (c) = sup{α ∈ R | αp0 − c ∈ C},

respectively. Indeed, if π0

s (0) = 0, then, by [51, Theorem 3.2],
π0
inf (c) ≤ π0

l (c) ≤ π0

s (c) ≤ π0

sup(c)

with equalities throughout when c − ¯αp0 ∈ C ∩ (−C) for some ¯α ∈ R and in this
case, π0
s (c) = ¯α. Similarly, the indiﬀerence swap rates can be bounded by the
super- and subhedging swap rates deﬁned by

πsup(p; c) = inf{α ∈ R | c−αp ∈ C∞} and πinf (p; c) = sup{α ∈ R | αp−c ∈ C∞},

respectively. Indeed, if πs(¯c, p; 0) = 0, then, by [51, Theorem 4.1],

πinf (p; c) ≤ πl(¯c, p; c) ≤ πs(¯c, p; c) ≤ πsup(p; c)

with equalities throughout if c − ¯αp ∈ C∞ ∩ (−C∞) for some ¯α ∈ R and in
this case, πs(¯c, p; c) = ¯α. This last condition extends the classical condition
of replicability (attainability) to nonlinear market models. In [43, Section 2],
elements of C∞ ∩ (−C∞) are interpreted as “liquid zero cost attainable claims”.
Recall that in conical market models, C∞ = C.

3 Duality in optimal investment

Our overall goal is to derive dual expressions for the optimum value function ϕ,
the accounting value π0
s and the indiﬀerence swap rate πs(¯c, p; ·), to analyze their
properties and to relate them to more speciﬁc instances of market models and
duality theory that have appeared in the literature. We will use the functional
analytic techniques of convex analysis where duality is derived from the notion
of a conjugate of a convex function; see [60]. More precisely, we apply the results
of [48, 54, 9, 56], where the general conjugate duality framework of Rockafellar
was specialized to general convex stochastic optimization problems.

In order to apply conjugate duality in the setting of Section 2, we will assume
from now on that M ⊂ L0(Ω, F , P ; RT +1) is in separating duality with another
space Q ⊂ L0(Ω, F , P ; RT +1) of random sequences under the bilinear form

hc, qi := E(c · q),

7

where “·” denotes the usual Euclidean inner product. We will also assume that
both M and Q are decomposable in the sense of [58] and that they are closed
under adapted projections. Decomposability means that c1A + c′
1Ω\A ∈ M for
every c ∈ M, c′ ∈ L∞ and A ∈ F . The adapted projection of a c = (ct)T
t=0 ∈ M
is the (Ft)T
t=0-adapted stochastic process ac given by act := Etct. Here and
in what follows, Et denotes the conditional expectation with respect to Ft.
Recall that (see e.g. [11, Lemma 1]) decomposability M and Q implies that
L∞ ⊆ M ⊆ L1 and that the pointwise maximum of two elements of M belongs
to M.

We will denote the adapted elements of M and Q by Ma and Qa, respec-
tively. Since M and Q are assumed to be closed under adapted projections, Ma
and Qa are in separating duality under (c, q) 7→ hc, qi. The elements of Qa can
be interpreted as “stochastic discount factors” (or “state price densities”) that
extend the notion of a martingale density from classical market models. In mar-
kets without perfectly liquid cash (or other perfectly liquid numeraires), more
general dual objects from Qa are needed in order to bring out the time value of
money. In a deterministic setting, the dual variables q ∈ Qa represent the term
structure of interest rates (prices of zero coupon bonds). In [1, Theorem 3.4] and
[43, Section 3], dual variables q ∈ Qa are expressed as products of martingale
densities and predictable discount processes; see also [67, Section 3.2].

The convex conjugate of ϕ : Ma → R with respect to the pairing of Ma

with Qa is deﬁned by

ϕ∗(c) = sup
c∈Ma

{hc, qi − ϕ(c)}.

The conjugate of a function on Qa is deﬁned analogously. If ϕ is closed and
proper, then ϕ∗∗ = ϕ; see e.g. [60, Theorem 5]. In other words, we then have
the dual representation

ϕ(c) = sup
q∈Qa

{hc, qi − ϕ∗(q)}.

The maximization problem on the right is known as the dual problem. If ϕ is not
closed, then for some c ∈ Ma the dual optimum value is strictly less than ϕ(c)
(there is a “duality gap”). The main result of this section gives an expression for
the conjugate ϕ∗ in terms of the loss function V and the market model (S, D).
Section 4 below gives suﬃcient conditions for the closedness of ϕ.

Note that if V is P -almost surely the indicator function of the nonpositive
cone RT +1
− , then the optimum value function ϕ coincides with the indicator
function δC (of the set C of claims that can be superhedged without a cost) on
Ma and its conjugate of ϕ∗ becomes the support function2

σC(q) := sup
c∈C

hc, qi.

2Here one can think of C as the set of adapted claims that can be superhedged without a
cost. Indeed, it is not diﬃcult to show that the supremum is not aﬀected if one restricts c to
be adapted.

8

When S is sublinear and D is conical, the set C is a cone as well and σC becomes
the indicator function of the polar cone

C∗ := {q ∈ Qa | hc, qi ≤ 0 ∀c ∈ C}.

In the classical perfectly liquid market model, the elements of C∗ come out as
the positive multiples of martingale density processes; see the remarks after
Corollary 3. Combined with the Kreps–Yan theorem, this gives a quick proof
of the fundamental theorem of asset pricing.

The expression for ϕ∗ in Theorem 1 below applies to loss functions V that

exhibit risk aversion with respect to sequences of random payments.

Assumption 2. EV (ac) ≤ EV (c) for all c ∈ M.

Clearly, Assumption 2 holds also if Ft = F for all t. It holds also if V is
of the form (1) where each Vt is a convex normal Ft-integrand such that there
exists q ∈ Qa with EV ∗
t (qt) < ∞ for all t. Indeed, in that case, the inequality
in Assumption 2 is simply Jensen’s inequality for convex normal integrands; see
e.g. [48, Corollary 2.1].
We use the notation

(αSt)(x, ω) :=(αSt(x, ω)

δcl dom St(·,ω)(x)

if α > 0
if α = 0.

The deﬁnition in the case α = 0 is motivated by the fact that the function
αSt(·, ω) is the epi-graphical limit of αν St(·, ω) as αν ց 0; this follows from [61,
Proposition 7.29] and the property that proper closed convex functions are uni-
formly bounded from below on bounded sets. By [61, Proposition 14.44 and
Proposition 14.46], αS is a convex normal integrand for every measurable α ≥ 0.
We will denote the space of adapted integrable RJ -valued processes by N 1.
In order to simplify the notation in the statements below, we ﬁx a dummy
variable wT +1 ∈ L1(Ω, F , P ; RJ ). Since DT ≡ {0}, we have σDT ≡ 0, so the
value of wT +1 does not aﬀect any of the expressions. The proof of the following
will be given in Section 7.2.

Theorem 1. If V satisﬁes Assumptions 1 and 2 and if S(x, ·) ∈ Ma for all
x ∈ RJ , then the conjugate of the optimum value function ϕ of (ALM) can be
expressed as

ϕ∗(q) = EV ∗(q) + inf
w∈N 1

E( T
Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1)]) ,

where the inﬁmum is attained for every q ∈ Qa.

The assumption that S(x, ·) ∈ Ma for x ∈ RJ is a generalization of the
assumption S(x, ·) ∈ L1 made in [47]. Recall that Ma ⊆ L1. We will see
in Section 5 that a stronger assumption on S may allow one to establish the
existence of dual solutions and the necessity of optimality conditions for (ALM).

9

The assumption that S(x, ·) ∈ Ma is close also to [6, Assumption 3.1] which, in
the perfectly liquid case, asks the price process to belong “locally” to an Orlicz
space associated with the utility function being optimized.

When V (·, ω) = δRT +1

−

for P -almost all ω, Theorem 1 gives the following is

a variant of [47, Lemma A.1].

Corollary 2. If S(x, ·) ∈ Ma for all x ∈ RJ , then

σC(q) = inf

w∈N 1

E( T
Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1)])

for q ∈ Ma
for every q ∈ Ma.

+ while σC(q) = +∞ otherwise. Moreover, the inﬁmum is attained

Proof. When V (·, ω) = δRT +1
ϕ = δC so that ϕ∗ = σC. Since V ∗(·, ω) = δRT +1

−

, Assumptions 1 and 2 clearly hold, and we have

, Theorem 1 gives

+

ϕ∗(q) = inf
w∈N 1

E( T
Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1)])

for q ∈ Ma

+ and ϕ∗(q) = +∞ for q /∈ Ma
+.

t and σDt =
If in addition, S(x, ·) ∈ Ma for all x ∈ RJ , so that dom St = RJ and
t ), Corollary 2 gives the following expression for the

When S is sublinear and D is conical, we have S∗
t .
δD∗
(qtSt)∗(w) = δ(w | qt dom S∗
polar cone

t = δdom S∗

C∗ = {q ∈ Qa

+ | ∃w ∈ N 1 : wt ∈ qt dom S∗

t , Et[∆wt+1] ∈ D∗

t P -a.s.}.

The polar cone of C can also be written as3

C∗ = {q ∈ Qa

+ | ∃s ∈ N 1 : st ∈ dom S∗

t , Et[∆(qt+1st+1)] ∈ D∗

t P -a.s.}.

In unconstrained linear models with St(x, ω) = st(ω) · x and Dt(ω) = RJ , we
have dom S∗

t (ω) = {0} so that

t = {st} and D∗

C∗ = {q ∈ Qa

+ | qs is a martingale}

in consistency with [67, Deﬁnition 2.2] in the context of numeraire-free linear
models.
is the cube
[s−
t , s+

In unconstrained models with bid-ask spreads, dom S∗
t

t ] and

C∗ = {q ∈ Qa

+ | ∃s ∈ N : s−

t ≤ st ≤ s+

t , qs is a martingale}.

The processes s above correspond to “shadow prices” in the sense of [17]; see
Section 5 for more details on this. When short selling is prohibited, i.e. when

3Here we use the fact that every selector w of dom S∗

t is integrable. Indeed, by Fenchel
t (w), where the supremum is integrable since S(x, ·) ∈ Ma.

inequality, |w| ≤ sup|x|≤1 St(x)+S∗

10

+, the condition Et[∆(qt+1st+1)] ∈ D∗

Dt = RJ
t means that qs is a supermartin-
gale. In models with perfectly liquid cash (see Example 2), the elements of C∗
can be expressed as

C∗ = {q ∈ Qa

+ | ∃Q ∈ P, α ≥ 0 : qt = αEt

dQ
dP

}

where P = {Q ≪ P | ∃˜s ∈ ˜N : ˜st ∈ dom ˜S∗
t Q-a.s.} and ˜N
denotes the set of adapted RJ\{0}-valued processes. In unconstrained models, P
is the set of absolutely continuous probability measures Q that admit martingale
selectors of dom S∗
t . In the classical linear model with St(x, ω) = st(ω) · x we
simply have dom S∗
t = {st} so the set P becomes the set of absolutely continuous
martingale measures for s.

t ∆˜st+1 ∈ ˜D∗

t , EQ

Using Corollary 2, we can write Theorem 1 more compactly as follows.

Corollary 3. Under the assumptions of Theorem 1, ϕ∗ = EV ∗ + σC.

Corollary 3 was given in [55, Lemma 3] under more restrictive assumptions
on the loss function. Moreover, the proof of [55, Lemma 3] was based on [48,
Theorem 2.2], which suﬀers from errors that were corrected in [9]; see [52].

4 Closedness of the value function

This section gives conditions for the closedness of ϕ and thus, the validity of
the dual representation ϕ = ϕ∗∗. The closedness conditions will be given in
terms of asymptotic behavior of the market model and the loss function. The
asymptotic behavior of a convex function h is described by its recession function
h∞ which can be expressed as

h∞(x) = sup
α>0

h(αx + ¯x) − h(¯x)

α

,

where the supremum is independent of the choice of ¯x ∈ dom h; see [59, theo-
rem 8.5]. The recession function of a convex function is convex and positively
homogeneous.

Given a market model (S, D), the function S∞

t (·, ω) := St(·, ω)∞ is a convex
Ft-integrand and D∞
t (ω) := Dt(ω)∞ is an Ft-measurable set; see [61, Exer-
cises 14.54 and 14.21]. This way, every (S, D) gives rise to a conical market
model (S∞, D∞). Similarly, a convex loss function V gives rise to a sublinear
loss function V ∞(·, ω) := V (·, ω)∞. Note that the growth properties in Assump-
tion 1 mean that V ∞(c, ω) ≤ 0 for all c ∈ RT +1
+ | V ∞(c, ω) ≤
0} = {0}. Our closedness result requires the following.

and {c ∈ RT +1

−

Assumption 3. {x ∈ ND∞ | V ∞(S∞(∆x)) ≤ 0} is a linear space.

If the loss function V satisﬁes

{c ∈ RT +1 | V ∞(c, ω) ≤ 0} = RT +1
− ,

(3)

11

then Assumption 3 means that {x ∈ ND∞ | S∞(∆x) ≤ 0} is a linear space.
This generalizes the classical no-arbitrage condition from perfectly liquid market
models to illiquid ones. In particular, when D ≡ RJ (no portfolio constraints),
the linearity condition becomes a version of the “robust no-arbitrage condition”
introduced in [66] for the currency market model of [36]; see [49] for the details
and further examples that go beyond no-arbitrage conditions. The linearity
of {x ∈ ND∞ | S∞(∆x) ≤ 0} can be seen as a relaxation of the condition
of “eﬃcient friction”, which, in the present setting, would require this set to
reduce to the origin; see [10] for a review of the eﬃcient friction condition and
an extension to a models with dividend payments.

Condition (3) clearly implies Assumption 1. It holds in particular if V is
of the form (1), where Vt(·, ω) are univariate nonconstant loss functions with
V ∞
t ≥ 0. Indeed, since Vt are nondecreasing, we have V ∞
t ≤ 0 on R− while the
nonconstancy implies V ∞
t (ct, ω) > 0 for ct > 0; see [59, Corollary 8.6.1]. Condi-
tion (3) certainly holds if Vt are diﬀerentiable and satisfy the Inada conditions

lim

c ց −∞

V ′
t (c, ω) = 0

and

lim
c ր ∞

V ′
t (c, ω) = +∞

since then, V ∞

t ≡ δR−.

We will need one more assumption on the loss functions.

Assumption 4. There exists λ 6= 1 such that

λ dom EV ∗ ⊆ dom EV ∗.

Assumption 4 holds, in particular, if V is bounded from below by an inte-
grable function since then 0 ∈ dom EV ∗. Lemma 4 below gives more general
conditions. The conditions extend the asymptotic elasticity conditions from [39]
and [64] to multivariate, random and possibly nonsmooth loss functions. For a
univariate loss function v, the conditions can be stated as

∃λ > 1, ¯y ∈ dom Ev∗, C ≥ 0 : v∗(λy) ≤ Cv∗(y) ∀ y ≥ ¯y,
∃λ ∈ (0, 1), ¯y ∈ dom Ev∗, C > 0 : v∗(λy) ≤ Cv∗(y) ∀ y ≤ ¯y.

(RAE+)
(RAE−)

Various reformulations of the asymptotic elasticity conditions given for deter-
ministic functions in [39, 64] are extended to random and nonsmooth loss func-
tions in the appendix. The following lemma gives multivariate extensions.

Lemma 4. If v∗(η, ω) := V ∗(ηy(ω), ω) satisﬁes (RAE+) for every y ∈ dom EV ∗,
then

λ dom EV ∗ ⊆ dom EV ∗ ∀λ ≥ 1.

If v∗(η, ω) satisﬁes (RAE−) for every y ∈ dom EV ∗, then

λ dom EV ∗ ⊆ dom EV ∗ ∀λ ∈ (0, 1].

Proof. Given y ∈ dom EV ∗, the normal integrand h = v∗ satisﬁes in both cases
the assumptions of Lemma 19 in the appendix with 1 ∈ dom Eh.

12

Remark 1. In the univariate case, the radial conditions in Lemma 4 are sat-
isﬁed by loss functions that satisfy the corresponding asymptotic elasticity con-
Indeed, if V ∗ satisﬁes (RAE+) and y ∈ dom EV ∗, then v∗(η, ω) :=
dition.
V ∗(ηy(ω), ω) satisﬁes (RAE+) with the same λ and C but with ¯y replaced by
1{y>0} ¯y/y. Similarly for (RAE−).

We are now ready to state the main result of this section. Besides closedness
of the optimum value function ϕ and the existence of optimal trading strategies,
it gives an explicit expression for the recession function of ϕ. These results turn
out to be useful in the analysis of valuations of contingent claims in Section 6.
The proof of the following will be given in Section 7.2.

Theorem 5. Let Assumptions 1, 3 and 4 hold and assume that

EV ∗(q) + inf
w∈N 1

E( T
Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1)]) < ∞

for some q ∈ Q. Then ϕ is σ(Ma, Qa)-closed in Ma, the inﬁmum in (ALM) is
attained for all c ∈ Ma and

ϕ∞(c) = inf
x∈ND

EV ∞(S∞(∆x) + c).

Under the assumptions of Theorem 1, the last assumption in Theorem 5
holds, in particular, if ϕ∗ is proper. The assumption that ϕ∗ be proper holds
automatically if V is bounded from below by an integrable function since then
ϕ is bounded as well so that ϕ∗(0) < ∞. If V is unbounded from below, then
the properness of ϕ∗ is a more delicate matter. In the classical linear model,
this holds if there exists a martingale measure Q ≪ P with a density process
q ∈ Qa with EV ∗(q) < ∞. This is analogous to Assumption 1 of [65] where the
market was assume perfectly liquid and the dual problem was formulated over
equivalent martingale measures. In general, properness of ϕ∗ means that ϕ is
bounded from below on a Mackey-neighborhood4 U of the origin. Indeed, this
means that the lower semicontinuous hull of ϕ is ﬁnite at the origin and then ϕ∗
is proper, by [60, Theorem 4]. This certainly holds if ϕ is ﬁnite and continuous
at the origin. Suﬃcient conditions for that will be given in Section 5.

The following result summarizes our ﬁndings so far. It gives a dual repre-
sentation for the optimum value function of (ALM) by combining Theorems 1,
5 and Corollary 2 with the general biconjugate theorem for convex functions.

Theorem 6. If Assumptions 1-4 hold, S(x, ·) ∈ Ma for all x ∈ RJ and ϕ∗ is
proper, then

ϕ(c) = sup
q∈Qa

{hc, qi − EV ∗(q) − σC(q)} ,

where σC is given by Corollary 2.

4The Mackey-topology on Ma is the strongest locally convex topology compatible with the

pairing with Qa.

13

The following example specializes Theorem 6 to conical market models with

perfectly liquid cash.

Example 3. Consider Example 2 and assume that D is conical, S is sublinear,
and that {x ∈ ND | S(∆x) ≤ 0} is a linear space (which holds, in particular,
under the robust no arbitrage condition if there are no constraints; see [49,
Section 4]). If VT (·, ω) is nonconstant, convex loss function satisfying V ∞ ≥ 0
and either (RAE+) or (RAE−), then

ϕ(c) = sup
λ≥0

Q∈P(λEQ

sup

T

Xt=0

ct − EV ∗

T (λET

dQ
dP

))

(see the representations of C∗ at the end of Section 3). This is analogous to the
dual problems derived for continuous time models e.g. in [45] or [8]. While these
references studied optimal investment with random endowment in perfectly liquid
markets, the above applies to illiquid markets in discrete time. In the exponential
case

1
α

VT (c) =

(eαc − 1),

the supremum over λ > is easily found analytically and one gets

ϕ(c) =

1
α

exp" sup

Q∈P

{αEQ

T

Xt=0

ct − H(Q|P )}# −

1
α

,

where H(Q|P ) denotes the entropy of Q relative to P . This is an illiquid
discrete-time version of the dual representation obtained in [21]; see also [5].

Much of duality theory in optimal investment has studied the optimum value

as a function of the initial endowment only; see e.g. [39] or [38].

Example 4 (Indirect utilities). The function v(c0) = ϕ(c0, 0, . . . , 0) gives the
optimum value of (ALM) for an agent with initial capital −c0 and no future
liabilities/endowments. We can express v as

v(c0) = inf

d∈C(c0)

EV (d),

(4)

where C(c0) = {d ∈ Ma | (c0, 0, . . . , 0) − d ∈ C} is the set of future endowments
needed to risklessly cover an initial payment of c0. If ϕ is proper and lower
semicontinuous (see Theorem 5), the biconjugate theorem gives

v(c0) = sup
q∈Qa

{c0q0 − ϕ∗(q)} = sup
q0∈R

{c0q0 − u(q0)}

where

u(q0) = inf
z∈Qa

{ϕ∗(z) | z0 = q0}.

If C is conical, we can use Corollary 3 to write u analogously to (4) as

u(q0) = inf

z∈Y(q0)

EV ∗(z),

14

where Y(q0) = {z ∈ C∗ | z0 = q0}. Even if ϕ is closed, there is no reason to
believe that u would be lower semicontinuous as well nor that the inﬁmum in its
deﬁnition is attained. In some cases, however, it is possible to enlarge the set
Y(q0) so that the function u becomes lower semicontinuous and the inﬁmum is
attained; see [17] for a sublinear two asset model without constraints.

When V = δRT +1

, the assumptions of Theorem 5 are automatically satisﬁed
so we obtain the following result on the set C of claims that can be superhedged
without a cost.

−

Corollary 7. If {x ∈ ND∞ | S∞(∆x) ≤ 0} is a linear space, then C is closed
and its recession cone can be expressed as

C∞ = {c ∈ Ma | ∃x ∈ ND∞ : S∞(∆x) + c ≤ 0}.

The ﬁrst part of Corollary 7 was given in [49, Section 4], where it was
also shown that the linearity condition is implied by the “robust no-arbitrage
condition”, which reduces to the classical no-arbitrage condition in the classical
perfectly liquid market model. Combined with the Kreps–Yan theorem, this
gives a quick proof of the famous Dalang–Morton–Willinger theorem.

The recession cone C∞ of C plays an important role in contingent claim
valuation; see [51] and Section 6 below.
In particular, the indiﬀerence swap
rates are uniquely determined by the market model (and are thus independent
of the agent’s preferences V and ﬁnancial position ¯c) when c− αp ∈ C∞ ∩(−C∞)
for some α ∈ R; see [51, Theorem 4.1]. This generalizes the classical notion
of “attainability” to illiquid market models. Accordingly, in general market
models, the notion of completeness (attainability of all c ∈ Ma) extends to
the property of C∞ ∩ (−C∞) being a maximal linear subspace of Ma. The
maximality means that if p /∈ C∞ ∩ (−C∞), then the linear span of p ∪ [C∞ ∩
(−C∞)] is all of Ma. Under the conditions of Theorem 5 and the mild additional
condition that V ∞ ≥ 0, the condition p /∈ C∞, turns out to be necessary and
suﬃcient for πs(¯c, p; ·) to be a proper lsc function on Ma; see Theorem 11 below.

5 Optimality conditions and shadow prices

Under the assumptions of Theorems 1 and 5, the optimum value of (ALM)
equals that of the dual problem

minimize
q∈Qa,w∈N 1

E(V ∗(q) +

[(qtSt)∗(wt) + σDt (Et∆wt+1) − ctqt]) .

T

Xt=0

The optimal q ∈ Qa, if any exist, are characterized by the equality ϕ(c)+ϕ∗(q) =
hc, qi which means that q is a subgradient of ϕ at c, i.e.

ϕ(c′) ≥ ϕ(c) + hc′ − c, qi ∀c′ ∈ Ma.

Optimal dual solutions q ∈ Qa can thus be interpreted as marginal prices for
the claims c ∈ Ma. In particular, if ϕ happens to be Gateaux diﬀerentiable at

15

c, then q is the derivative of ϕ at c. We will denote the subdiﬀerential, i.e. the
set of subgradients, of ϕ at c ∈ Ma by ∂ϕ(c).

Much like in the conjugate duality framework of [60], the dual solutions allow
us to write down optimality conditions for the solutions of the primal problem
(ALM). The proof of the following will be given in Section 7.2.

Theorem 8. Let c ∈ Ma. If Assumptions 1–4 hold and (w, q) ∈ Qa × N 1
solves the dual, then an x ∈ N solves (ALM) if and only if it is feasible and

Et∆wt+1 ∈ NDt (xt),

q ∈ ∂V (S(∆x) + c),

wt ∈ ∂(qtSt)(∆xt).

Conversely, if x and (w, q) are feasible primal-dual pair satisfying the above
system, then x solves the primal, (w, q) solves the dual, and ϕ is closed at c.

In the classical linear model where St(x, ω) = st(ω) · x, the optimality con-

ditions in Theorem 8 simplify to

Et∆(qt+1st+1) ∈ NDt (xt),

q ∈ ∂V (s · ∆x + c).

In the unconstrained case where D ≡ RJ , the ﬁrst condition means that qs is
a martingale. On the other hand, we can write the last condition as wt = qt¯st,
where ¯st ∈ L0(Ω, Ft, P ; RJ ) is such that

¯st ∈ ∂St(∆xt).

Following [17], we call such a process ¯s a shadow price. By [59, Theorem 23.5],
we can write this as ∆xt ∈ ∂S∗
t (¯st). If S is positively homogeneous like in [17],
this becomes

∆xt ∈ Ndom S∗

t (¯st).

In particular then, the optimal strategy trades only when ¯st /∈ int dom S∗
t and
in that case, the increment ∆xt belongs to the (outward) normal to dom S∗
t
at ¯st. This extends the complementarity condition from [17, Deﬁnition 2.2] to
multiple assets and general sublinear trading costs. If, moreover, S∗(¯s) ∈ Ma,
and ¯x is optimal in (ALM), then it is optimal also in the linearized problem

minimize EV (¯s · ∆x + ¯c)

over

x ∈ ND,

where ¯c := c − S∗(¯s). Indeed, if ¯x, ( ¯w, ¯q) are optimal in (ALM) and the dual,
we have S(∆¯x) + S∗(¯s) = ¯s · ∆¯x, by the optimality conditions in Theorem 8,
so they satisfy the optimality conditions for the linearized model for which they
are feasible as well, so the claim follows from the last part of Theorem 8.

The condition ∆x ∈ Ndom S∗

t (¯st) is closely related to the result of [19], who
found that under transaction costs, there is a “no-transaction region” where
optimal trading strategies stay constant. In the sublinear case, this region is

16

the interior of dom S∗
t . Note also that if S happens to be strictly convex, ∂S∗ is
(at most) single-valued (see [59, Theorems 26.1 and 26.1]), so the shadow price
characterizes the optimal trading strategy uniquely.

Section 3 of [17] gives an example where shadow prices do not exist and thus,
the supremum in the dual representation of ϕ is not attained. The following
gives suﬃcient conditions for the attainment. Recall that the Mackey-topology
on Ma is the strongest locally convex topology compatible with the pairing with
Qa.

Theorem 9. Under the assumptions of Theorem 1, the dual optimum is at-
tained if ϕ is bounded from above on a Mackey-neighborhood of c.

Proof. By Theorem 1, dual solutions coincide with subgradients of ϕ at the
origin. The claim thus follows from [60, Theorem 11].

Much like in [6, Corollary 5.2], the dual attainment in Qa can be guaran-
teed under appropriate continuity assumptions on the expected loss function
EV . Recall that a locally convex topological vector space is barreled if every
closed convex absorbing set is a neighborhood of the origin. By [60, Corollary
8B], a lower semicontinuous convex function on a barreled space is continuous
throughout the algebraic interior (core) of its domain. On the other hand, by
[60, Theorem 11], continuity implies subdiﬀerentiability. Fr´echet spaces and, in
particular, Banach spaces are barreled. We will say that Ma is barreled if it is
barreled with respect to a topology compatible with the pairing with Qa.

Example 5. Assume that Ma is barreled. Then the boundedness condition in
Theorem 9 is satisﬁed, if EV is ﬁnite throughout Ma and EV ∗ is proper on Qa.
The ﬁniteness of EV fails in Example 2, but the boundedness condition holds if
EVT (c0 + · · · + cT ) < ∞ for all c ∈ Ma and either ϕ or c 7→ EVT (c0 + · · · + cT )
is lower semicontinuous on Ma (see Theorem 5).

Proof. By [60, Theorem 21], EV is lower semicontinuous so, by [60, Corol-
lary 8B], it is continuous on Ma. Choosing x = 0, gives

ϕ(c) ≤ EV (c),

so [60, Theorem 8] implies that ϕ is continuous and thus subdiﬀerentiable
throughout Ma, by [60, Theorem 11]. Similarly, in Example 2,

so, by [60, Corollary 8B], both of the conditions imply the continuity of ϕ.

ϕ(c) ≤ EVT (c0 + · · · + cT ),

6 Duality in contingent claim valuation

The main results of [51] relate the accounting values and indiﬀerence swap rates
to arbitrage bounds and the classical replication based values. Section 6 of [51]
gives conditions on lower semicontinuity and properness of π0
s and πs(¯c, p; ·).
This section reﬁnes those conditions and gives dual expressions for π0
s and
πs(¯c, p; ·). We start with accounting values.

17

6.1 Accounting values

As noted in the introduction, the accounting value π0
s extends the notion of a
convex risk measure to sequences of payments and markets without a perfectly
liquid cash-account. This section extends the analogy by giving dual repre-
sentations for π0
s which reduce to the well-known dual representations of risk
measures when applied in the single period setting with perfectly liquid cash.
We also give general conditions under which the conjugate (“penalty function”)
in the dual representation separates into two components, one corresponding to
the market model and the other one to the agent’s risk preferences. This can
be seen as an extension of a corresponding separation in models with perfectly
liquid cash; see e.g. [26, Proposition 4.104].

Note that the accounting value can be expressed as

π0
s (c) = inf{α | c − αp0 ∈ A},

where A = {c ∈ Ma | ϕ(c) ≤ 0} consists of ﬁnancial positions which the agent
can cover with acceptable level of risk (as measured by EV ) given the possibility
to trade in the illiquid markets described by S and D. This is analogous to the
correspondence between convex risk measures and their acceptance sets in [2]
where the ﬁnancial market is described by a single perfectly liquid asset. Besides
the market model, another notable extension here is that acceptance sets consist
of sequences of payments instead of payments at a single date.

The dual representation for π0

s below involves the support function of A
which corresponds to the “penalty function” in the dual representation of a
convex risk measure; see [26, Chapter 4] and the references therein. Under mild
conditions the support function separates into two terms: the ﬁrst term is the
support function of the set

B = {c ∈ Ma | EV (c) ≤ 0}

while the second one is the support function of the set C of claims that can
be superhedged without a cost. While B depends only on the agent’s risk
preferences, C depends only on the market model.

Theorem 10. If F0 is the trivial sigma-ﬁeld, V ∞ ≥ 0 and the assumptions of
Theorem 5 hold, then the conditions

1. π0

s is proper and lower semicontinuous,

2. π0

s (0) > −∞,

3. p0 /∈ C∞,

4. q0 = 1 for some q ∈ dom σC

are equivalent and imply the validity of the dual representation

π0
s (c) = sup
q∈Qa

{ hc, qi − σA(q) | q0 = 1} .

18

If inf ϕ < 0, then under the assumptions of Theorem 1, σA = σB + σC and

σB(q) = inf
α>0

αEV ∗(q/α).

Proof. Closedness of ϕ in Theorem 5 implies the closedness of A. By Lemma 18
in the appendix, the dual representation is then valid under the ﬁrst two con-
ditions which are both equivalent to p0 /∈ A∞ which in turn is equivalent to
the existence of a q ∈ dom σA with hp0, qi = 1. Here, hp0, qi = q0 since
p0 = (1, 0, . . . , 0) and F0 is the trivial sigma ﬁeld by assumption. By [57,
Corollary 6B], A∞ = {c ∈ Ma | ϕ∞(c) ≤ 0}. When V ∞ ≥ 0, the expression for
ϕ∞ in Theorem 5 yields

A∞ = {c ∈ Ma | ∃x ∈ ND∞ : S∞(∆x) + c ≤ 0},

which, by Corollary 7, equals C∞. Thus, the ﬁrst two conditions are both equiv-
alent to 3. Another application of Lemma 18 now implies that 3 is equivalent
to 4. This ﬁnishes the proof of the ﬁrst claim.

By Lagrangian duality (see e.g. Example 1” on page 45 of [60]), the condition

inf ϕ < 0 implies

σA(q) = sup
c∈Ma

{hc, qi | ϕ(c) ≤ 0}

= inf
α>0

= inf
α>0
= inf
α>0

{hc, qi − αϕ(c)}

sup
c∈Ma
αϕ∗(q/α)

αEV ∗(q/α) + σC(q),

where the last equality comes from Corollary 3 and the fact that σC is positively
homogeneous. By Lagrangian duality again,

σB(q) = sup
c∈Ma

{hc, qi | EV (c) ≤ 0}.

Under Assumption 2, we have for all q ∈ Qa

sup
c∈Ma

{hc, q/αi − EV (c)} = sup
c∈L1

{hc, q/αi − EV (c)}

= EV ∗(q/α),

where the last equality comes from the interchange rule [61, Theorem 14.60].

The ﬁrst part of Theorem 10 is analogous to Corollary 1 in [24, Section 4.3]
which was concerned with risk measures in a general single period setting. The
dual representation in the second part is analogous to the one in [26, Propo-
sition 4.104] in the single period setting with portfolio constraints and linear
trading costs. See also [4, Theorem 3.6], which gives a dual representation for
the inﬁmal convolution of two convex risk measures.

19

When C is a cone, the dual representation in Theorem 10 can be written as

s (c) = sup { hc, qi − σB(q) | q ∈ C∗, q0 = 1} .
π0

If, in addition, EV is sublinear, then B = {c ∈ Ma | EV (c) ≤ 0} is a cone and
σB = δB∗ (the indicator function of the polar cone), so we get the more familiar
expression

s (c) = sup { hc, qi | q ∈ C∗ ∩ B∗, q0 = 1} .
π0

(5)

−

, we have B = Ma

+. Since C∗ ⊂ Qa

− and
In the completely risk averse case where V = δRT +1
B∗ = Qa
+, we thus recover the dual representation of the
In general, B may be interpreted much like
superhedging cost; see e.g. [49].
the set of “desirable claims” in the theory of good-deal bounds; see [14] and
In the dual representation above, the polar cone B∗
the references therein.
restricts the set of stochastic discount factors used in the valuation of the claim
c, thus making the value lower than the superhedging cost. This is simply a dual
formulation of the no-arbitrage bound obtained by purely algebraic arguments in
[51]; see Section 2. The general structure is similar also to the models of “two-
price economies” in [23], [43] and their references.
In particular, expression
(5) has the same form as the dual representation of the “ask price” in [43,
Section 3] which addresses conical markets without perfectly liquid numeraire
in the context of ﬁnite probability spaces.

While Theorem 10 is formulated for short positions, it can be immediately
l (c) =

translated to accounting values for long positions through the identity π0
−π0

s (−c). In particular, the dual representation of π0
l

in the general becomes

π0
l (c) = inf
q∈Qa

{hc, qi + σA(q) | q0 = 1} ,

while in the conical case

l (c) = inf { hc, qi | q ∈ C∗ ∩ B∗, q0 = 1} .
π0

If we ignore the ﬁnancial market (by setting S ≡ 0), the last part of Theo-
rem 10 gives a multiperiod extension of [27, Theorem 4.115] to extended real-
valued random loss functions. Besides the generality, the convex analytic proof
above is considerably simpler.

6.2

Indiﬀerence swap rates

This section gives a dual representation for the indiﬀerence swap rate πs(¯c, p; c).
The arguments involved are very similar to those in the previous section once
we notice that the indiﬀerence swap rate can be expressed as

πs(¯c, p; c) = inf{α | c − αp ∈ A(¯c)},

where A(¯c) = {c ∈ Ma | ϕ(¯c + c) ≤ ϕ(¯c)} is the set of claims that an agent with
current ﬁnancial position ¯c ∈ Ma deems acceptable given his risk preferences
and ability to trade in the illiquid market described by S and D.

20

Analogously to the dual representation for risk measures and accounting val-
ues in the previous section, the dual representation for πs(¯c, p; ·) below involves
the support function of A(¯c). Under mild conditions, the support function splits
again into two terms. One of them is still the support function of the set C of
claims that can be superhedged without a cost but now the second term is the
support function of the set

B(¯c) = {c ∈ Ma | EV (¯c + c) ≤ ϕ(¯c)}.

This is the set of claims an agent with ﬁnancial position ¯c ∈ Ma and risk
preferences EV would deem at least as desirable as the possibility to trade in a
ﬁnancial market described by S and D.

Theorem 11. If the assumptions of Theorem 5 are satisﬁed and V ∞ ≥ 0, then,
for every ¯c ∈ dom ϕ and p ∈ Ma, the conditions

1. πs(¯c, p; ·) is proper and lower semicontinuous,

2. πs(¯c, p; 0) > −∞,

3. p /∈ C∞,

4. hp, qi = 1 for some q ∈ dom σC

are equivalent and imply the validity of the dual representation

πs(¯c, p; c) = sup

q∈Qa(cid:8) hc, qi − σA(¯c)(q)(cid:12)(cid:12) hp, qi = 1(cid:9)

If the above conditions hold for some ¯c ∈ dom ϕ, then they hold for every ¯c ∈
dom ϕ.
If inf ϕ < ϕ(¯c), then under the assumptions of Theorem 1, σA(¯c) =
σB(¯c) + σC, where

σB(¯c)(q) = inf
α>0

α[EV ∗(q/α) − h¯c, q/αi − ϕ(¯c)].

Proof. The closedness of ϕ in Theorem 5 implies the closedness of A(¯c) and
then, A∞(¯c) = {c ∈ Ma | ϕ∞(c) ≤ 0}, by [57, Corollary 6B]. The ﬁrst claim is
now proved just like in Theorem 10.

By Lagrangian duality, the condition inf ϕ < ϕ(¯c) implies

σA(¯c)(q) = sup
c∈Ma

{hc, qi | ϕ(¯c + c) − ϕ(¯c) ≤ 0}

= inf
α>0

= inf
α>0

= inf
α>0
= inf
α>0

{hc, qi − α[ϕ(¯c + c) − ϕ(¯c)]}

sup
c∈Ma
sup
c∈Ma
α[ϕ∗(q/α) − ϕ(¯c)] − h¯c, qi

{hc, qi − α[ϕ(c) − ϕ(¯c)]} − h¯c, qi

α[EV ∗(q/α) − ϕ(¯c)] − h¯c, qi + σC(q),

21

where the last equality comes from Corollary 3 and the fact that σC is positively
homogeneous. By Lagrangian duality again

σB(¯c)(q) = sup
c∈Ma

{hc, qi | EV (¯c + c) ≤ ϕ(¯c)}

= inf
α>0

α[EV ∗(q/α) − ϕ(¯c)] − h¯c, qi,

just like in the proof of Theorem 10.

The structure and assumptions of Theorem 11 are essentially the same as
those in Theorem 10. The main diﬀerence is in the interpretations. While the
accounting value looks for least amount of initial cash that allows one to ﬁnd an
acceptable hedging strategy, the indiﬀerence swap rate compares two ﬁnancial
positions. The diﬀerence is reﬂected in the deﬁnitions of the “acceptance sets”
B and B(¯c), where the latter compares claims with the current ﬁnancial position
of a rational agent who has access to ﬁnancial markets.

Specializing to market models with perfectly liquid cash, we obtain illiquid

discrete-time versions of pricing formulas obtained in e.g. [45] and [8].

Example 6 (Numeraire and martingale measures). Let p = (1, 0, . . . , 0) and
assume that

St(x, ω) = x0 + ˜St(˜x, ω) and Dt(ω) = R × ˜Dt(ω)

with a sublinear ˜S and conical ˜D as in Example 2. Like at the end of Section 3,
we can then write the dual representation in terms of probability measures as

π(¯c; c) = sup

y∈C∗(cid:8) h¯c + c, yi − σA(¯c)(y)(cid:12)(cid:12) hp, yi = 1(cid:9)
Xt=0

(¯ct + ct) − α"E

Xt=0

T

= sup
Q∈P

T

α>0(EQ

sup

v∗
t (Et

dQ
dP

/α) − ϕ(¯c)#) .

This can be seen as an illiquid discrete-time version of the pricing formulas
in [45, Section 7] and [8, Section 4].

7 Contingent claims with physical delivery

In this section, we study problems of the form

minimize EV (S(∆x + θ) + c)

over

x ∈ ND,

(ALM+)

where θ is a RJ -valued process that can be interpreted as a contingent claim
with physical delivery (portfolio-valued contingent claims) that the agent has to
deliver in addition to the cash-settled claim c. Superhedging of contingent claims
with physical delivery has been studied e.g. in [36, 53, 41]. Our formulation is
close to [28] who studied optimal investment and superhedging under superlinear

22

trading costs in an unconstrained continuous time market model with perfectly
liquid cash.

We will denote the optimum value of (ALM+) by ¯ϕ(θ, c). Clearly, the op-
timum value function ϕ of (ALM) is simply the restriction of ¯ϕ(0, ·) to Ma.
Combined with some functional analytic arguments, this simple identity allow
us to derive the main results of the previous sections from corresponding results
on ¯ϕ. The introduction of the extra parameter θ, in fact, simpliﬁes the analysis
and provides extra information about (ALM).

7.1 Nonadapted claims

We start by analyzing (ALM+) with possibly nonadapted claims (θ, c). More
precisely, we will study the optimum value ¯ϕ(θ, c) of (ALM+) on the space

U := L∞(Ω, F , P ; RJ(T +1)) × M

of claim processes u = (θ, c) whose physical component θ is essentially bounded
and the cash component c belongs to M. In most situations, one is interested
in adapted claims but our formulation allows also for situations where the in-
vestor may remain unaware of the exact claim amounts until a certain future
time (as may happen e.g. in asset management departments of large ﬁnancial
institutions). The space U is in separating duality with

Y := L1(Ω, F , P ; RJ(T +1)) × Q

under the bilinear form hu, yi := E(u · y). We will split the dual variables y into
two processes w and q corresponding to the splitting of u into θ and c. One can
thus express the bilinear form as

hu, yi = hθ, wi + hc, qi.

The following result shows that, under Assumption 1, the conjugate of ¯ϕ can
be expressed in terms of the loss function and the market model. The proof is
given in the appendix.

Theorem 12. If V satisﬁes Assumption 1, then the conjugate of the optimum
value function ¯ϕ of (ALM+) with respect to the pairing of U with Y can be
expressed as

¯ϕ∗(y) = E(V ∗(q) +

T

Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1)]) .

The next result gives suﬃcient conditions for the closedness of ¯ϕ as well as
an expression for the recession function ¯ϕ∞. The proof can be found in the
appendix.

23

Theorem 13. If Assumptions 1, 3 and 4 hold and there exists y ∈ Y such that

E(V ∗(q) +

T

Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1)]) < ∞,

then ¯ϕ is σ(U, Y)-closed in U, the inﬁmum in (ALM+) is attained for all u ∈ U
and

¯ϕ∞(u) = inf
x∈N

EV ∞(S∞(∆x + θ) + c).

When V = δRJ+1

−

, we have ¯ϕ = δ ¯C, where

¯C := {(θ, c) | ∃x ∈ ND : S(∆x + θ) + c ≤ 0 P -a.s.}

is the set of multivariate claim processes that can be superhedged without a
cost. The closedness result above can then be seen as a discrete-time version
of [28, Proposition 3.5] which addresses unconstrained continuous-time models
with perfectly liquid cash. When V = δRJ+1
, the assumptions of Theorem 13
reduce to the requirement that

−

{x ∈ ND∞ | S∞(∆x) ≤ 0}

is a linear space; see the discussion after Assumption 3 in Section 4. This
certainly holds under the superlinear growth condition of [28], which (in the
notation of Example 2) implies that there is a strictly positive adapted process
H such that

˜St(x, ω) ≥ Ht(ω)|˜x|α ∀˜x ∈ RJ .

Indeed, this implies that ˜S∞
t = δ{0} so the linearity condition means that
{(x0, 0) ∈ ND | ∆x0 ≤ 0} is a linear space. But this is obvious since x−1 = 0
and DT = {0}. Note that, unlike the superlinear growth condition, the linearity
condition above does allow for cost functions S which are decreasing in some
directions, which is quite a natural assumption for assets with free disposal.

Under the assumptions of Theorems 12 and 13, the optimum value of (ALM+)

equals that of the dual problem

minimize
(w,q)∈Y

E(V ∗(q) +

T

Xt=0

[(qtSt)∗(wt) + σDt (Et∆wt+1) − θt · wt − ctqt]) .

We know from the general conjugate duality theory that the dual solutions are
then the subgradients of the optimum value function ¯ϕ at u = (θ, c). Much
like in [60], the dual variables can be used to give optimality conditions for the
solutions of the primal problem (ALM+). The situation here is slightly diﬀerent,
however, since in (ALM+), the primal solutions are sought over the vector space
N that lacks an appropriate locally convex topology. Applying the optimality
conditions derived for convex stochastic optimization in [9, Section 3], we obtain
the following. The proof is given in the appendix.

24

Theorem 14. If ¯ϕ is closed at (θ, c) and Assumption 1 holds, then x ∈ N solves
(ALM+) and y ∈ Y solves the dual problem if and only if they are feasible and

Et∆wt+1 ∈ NDt(xt),

q ∈ ∂V (S(∆x + θ) + c),

wt ∈ ∂(qtSt)(∆xt + θt).

Conversely, if x and y are feasible primal-dual pair satisfying the above system,
then x solves the primal, (w, q) solves the dual, and ϕ is closed at (θ, c).

7.2 Adapted claims

When the claim process (θ, c) is adapted and the loss function V satisﬁes As-
sumption 2, the above results can be expressed in terms of adapted dual vari-
ables. We will denote the linear subspaces of adapted processes in U and Y by
U a and Y a, respectively. In other words,

U a := N ∞ × Ma

and Y a := N 1 × Qa.

Since, by assumption, M and Q are closed under adapted projections, we have
that U a and Y a are in separating duality under the bilinear form deﬁned for U
and Y.

We will denote the restriction of ¯ϕ to U a by ¯ϕa. Since the relative topology
σ(U, Y) on U a coincides with σ(U a, Y a), Theorem 13 implies that ¯ϕa is closed
with respect to σ(U a, Y a). It is immediate from the deﬁnition of the recession
function that ¯ϕ∞
a is simply the restriction of ¯ϕ∞ to U a. To restrict the dual
variables to Y a, only one simple observation is needed.

If ψ is any functional on U such that ψ(au) ≤ ψ(u) for all u ∈ U, then for

any y ∈ Y,

ψ∗(ay) = sup
u∈U

{hu, ayi − ψ(u)} ≤ sup
u∈U

{hau, yi − ψ(au)} ≤ ψ∗(y).

In particular, if V satisﬁes Assumptions 1 and 2, then by the interchange rule,
EV ∗(aq) ≤ V ∗(q) so V ∗ satisﬁes Assumption 2 as well. The following shows
that Assumption 2 is inherited by ¯ϕ∗ and thus by the closure of ¯ϕ as well.

Theorem 15. If V satisﬁes Assumptions 1 and 2, then ¯ϕ∗(ay) ≤ ¯ϕ∗(y) for all
y ∈ Y and ¯ϕ∗
a = ¯ϕ∗ on Y a. In particular, if (θ, c) ∈ U a and y ∈ Y solves the
dual, then ay ∈ Y a solves the dual as well and x ∈ N solves (ALM+) if and
only if it is feasible and satisﬁes the subdiﬀerential conditions of Theorem 14
with ay.

Proof. Since S is adapted and S(0) = 0, we have

E[(qtSt)∗(awt) + σDt (Et∆ awt+1)] ≤ E[(qtSt)∗(wt) + σDt (Et∆wt+1)],

by Jensen’s inequality for normal integrands; see e.g. [48, Corollary 2.1]. The
ﬁrst claim thus follows from the expression for ¯ϕ∗ in Theorem 12 since EV ∗(aq) ≤

25

EV ∗(q) under Assumption 2. For any y ∈ Y a, the conjugate of ¯ϕa can be ex-
pressed as

¯ϕ∗

a(y) = sup
u∈U a
= sup
u∈U

{hu, yi − ¯ϕ(u)}

{hu, yi − ( ¯ϕ + δU a)(u)}

{ ¯ϕ∗(y − y′) + δ(U a)⊥(y′)}

= cl inf
y′∈Y
= ¯ϕ∗(y),

where the closure is taken with respect to the pairing of Y with U and the last
equality holds by the ﬁrst claim.

The proofs of Theorems 1, 5 and 8 are now simple applications of the Theo-
rems 13 and 15 and the fact that ϕ is the restriction of ¯ϕ(0, ·) to the space Ma
of adapted cash-valued claims.

Proof. (of Theorem 1) Deﬁning γq : N ∞ → R by

γq(θ) := inf

c∈Ma

{ ¯ϕa(θ, c) − hc, qi},

we have ϕ∗(q) = −γq(0) and γ∗

q (w) = ¯ϕ∗

a(w, q) so that

−γ∗∗

q (0) = inf
w∈N 1

¯ϕ∗

a(w, q),

which, by Theorem 15, is the desired expression. It thus suﬃces to show that
γq(0) = γ∗∗
q (0) and that the inﬁmum is attained. By [60, Theorem 17], this
holds if γq is bounded from above on a Mackey-neighborhood of the origin.
Choosing x = 0 and c = −S(θ), we get

γq(θ) =

inf

c∈Ma,x∈ND

E[V (S(∆x + θ) + c) − c · q] ≤ E

qtSt(θt).

T

Xt=0

Convexity of S(·, ω) and the assumption that S(x, ·) ∈ M for all x ∈ RJ implies
S(x) ∈ M for all x ∈ L∞, so [60, Theorem 22] implies that the last expression
is Mackey-continuous on L∞ and thus bounded above on a neighborhood of the
origin.

Proof. (of Theorem 5) Theorem 5 follows from Theorem 13 once we notice that
ϕ is the restriction of ¯ϕ(0, ·) to Ma and that σ(Ma, Qa) is the relative topology
of σ(U, Y) on Ma.

Proof. (of Theorem 8) It suﬃces to apply Theorem 15 with θ = 0.

26

Appendix

A set-valued mapping ω 7→ C(ω) is Ft-measurable is the inverse image

C−1(U ) := {ω ∈ Ω | C(ω) ∩ U 6= ∅}

of every open U ⊂ Rn is Ft-measurable. An extended real-valued function f
on Rn × Ω is a normal integrand if the set-valued mapping ω 7→ epi f (·, ω) :=
{(x, α) ∈ Rn × R | f (x, ω) ≤ α} is closed-valued and measurable. We refer the
reader to [61, Chapter 14] for further details on measurable set-valued maps and
normal integrands.

Compositions of convex functions

Given an extended real-valued function g on Rm and an Rm-valued function F
on a subset dom F of Rn, we deﬁne their composition as the extended real-valued
function

(g◦F )(x) :=(g(F (x))

+∞

if x ∈ dom F ,
if x /∈ dom F .

Given a convex cone K ⊂ Rm, the function F is said to be K-convex if the set

epiK F := {(x, u) | x ∈ dom F, F (x) − u ∈ K}

is convex. It is said to be closed if epiK F is a closed set. It is easily veriﬁed
(see the proof of Lemma 16 below) that if g is convex and F is K convex then
g◦F is convex if

F (x) − u ∈ K =⇒ g(F (x)) ≤ g(u) ∀x ∈ dom F.

(6)

For such composition, full subdiﬀerential and recession calculus is available; see
[46]. The composition is well-behaved also in terms of measurability.

We say that a family {F (·, ω)}ω∈Ω of closed K-convex functions is a random

K-convex function if epiK F (·, ω) is measurable.

Lemma 16. Let g be a convex normal integrand and let F be a random K-
convex function such that (6) holds almost surely. If (−K) ∩ {u | g∞(u, ω) ≤ 0}
is linear, then g◦F is a convex normal integrand on Rn × Ω.

Proof. By [61, Example 14.32 and Proposition 14.44],

h(x, u, ω) := g(u, ω) + δepiK F (·,ω)(x, u),

is a normal integrand. The growth condition gives (g◦F )(x, ω) = inf u∈Rm h(x, u, ω)
while the linearity condition implies, by [59, Theorem 9.2], that this expression
is lsc in x and thus a normal integrand, by [61, Proposition 14.47].

27

In the market model of Section 2, the function S(x, ω) := (St(x, ω))T

t=0 with

dom S(·, ω) := \t=0,...,T

dom St(·, ω)

deﬁnes a random K-convex function with K := RT +1
− . By [59, Corollary 8.6.1],
Assumption 1 means that (−K)∩{c ∈ RT +1 | V ∞(c, ω) ≤ 0} = {0}, so Lemma 16
gives the following.

Corollary 17. Under Assumption 1, the function (x, c, ω) 7→ V (S(∆x, ω)) + c)
is a convex normal integrand and, in particular, B(RJ(T +1) × R(T +1)) ⊗ F -
measurable.

7.3 Proofs of Theorems 12, 13 and 14

As in [51], we analyze (ALM+) in the more general parametric stochastic opti-
mization format from [48, 9]. To this end, we express the value function as

¯ϕ(u) = inf

x∈NZ f (x(ω), u(ω), ω)dP (ω),

where N is the linear space of adapted RJ -valued processes and f is the extended
real-valued function on RJ(T +1) × R(J+1)(T +1) × Ω deﬁned by

f (x, u, ω) = V (S(∆x + θ, ω) + c, ω) + δD(ω)(x).

Indeed, f is a normal integrand by, [61, Proposition 14.44 and Proposition 14.45]
and Corollary 17.

The dual expressions involve the associated Lagrangian integrand

l(x, y, ω) =

inf

u∈R(J+1)(T +1)

{f (x, u, ω) − u · y}

= δD(ω)(x) − V ∗(q, ω) +

= δD(ω)(x) − V ∗(q, ω) +

T

T

Xt=0
Xt=0

[∆xt · wt − (qtSt)∗(wt, ω)]

[−xt · ∆wt+1 − (qtSt)∗(wt, ω)]

(7)

and the conjugate of f

f ∗(v, y, ω) =

sup

{x · v + u · y − f (x, u, ω)}

x∈RJ(T +1)

u∈R(J+1)(T +1)

= sup

{x · v − l(x, y, ω)}

x∈RJ(T +1)

= V ∗(q, ω) +

T

Xt=0

[σDt(ω)(vt + ∆wt+1) + (qtSt)∗(wt, ω)].

28

By [61, Theorem 14.50], f ∗ is a normal integrand as well.

We deﬁne an auxiliary value function

˜ϕ(u) := inf

u∈N ∞

Ef (x, u),

where N ∞ := N ∩ L∞, the essentially bounded adapted trading strategies.

Proof. (of Theorem 12) Since {x ∈ N ∞ | ∃u ∈ U : Ef (x, u) < ∞} = N ∞,
Theorem 2 of [9] says that conjugate of ˜ϕ can be expressed as

˜ϕ∗(y) = − inf

x∈N ∞

El(x, y)

T

Xt=0

= − inf

x∈N ∞(E
= E( T
Xt=0

[δDt (xt) − xt · Et[∆wt+1] − (qtSt)∗(wt)] − V ∗(q))

[σDt (Et∆wt+1) + (qtSt)∗(wt)] + V ∗(q))

where the second equality comes from properties of conditional expectation
and the last from the interchange rule for integration and minimization; see
[61, Theorem 14.60]. We have Ef ∗(v, y) = ˜ϕ∗(y) for any y ∈ Y and vt =
Et∆wt+1 − ∆wt+1. Thus, by [9, Theorem 2], ¯ϕ∗ = ˜ϕ∗.

Proof. (of Theorem 13) By [56, Theorem 5 and Lemma 6], it suﬃces to show
that  L := {x ∈ N | f ∞(x, 0) ≤ 0} is a linear space and that there exists
(v, y) ∈ N ⊥ × Y with λ(v, y) ∈ dom Ef ∗ for two diﬀerent λ > 0.

By [59, Theorem 9.3] and [46, Theorem 7.3],

f ∞(x, u, ω) = V ∞(S∞(∆x + θ, ω) + c, ω) + δD∞(ω)(x),

so  L is a linear space under Assumption 3. The assumption in the theorem
means that Ef ∗(v, y) is ﬁnite for some y and v = Et∆wt+1 − ∆wt+1. By
Assumption 3, EV ∗(λq) is ﬁnite for some nonnegative λ 6= 1, and since the
other terms in

Ef ∗(v, y) = E[V ∗(q) +

T

Xt=0

[(qtSt)∗(wt) + σDt (vt + ∆wt+1)]

are positively homogeneous, we get λ(v, y) ∈ dom Ef ∗.

Proof. (of Theorem 14) By Theorem 12, y solves the dual if and only if it
maximizes hu, yi − ¯ϕ∗(y). Under the closedness condition, this is equivalent to
y ∈ ∂ ¯ϕ(u). The assumptions of [9, Theorem 8] are then satisﬁed with vt :=
Et∆wt+1 − ∆wt+1. Thus, x ∈ N and y ∈ Y are optimal if and only if they are
feasible and

v ∈ ∂xl(x, w, q),

(θ, c) ∈ ∂(w,q)[−l](x, w, q)

29

P -almost surely. Looking at the last expression (7) for l, we see that the ﬁrst
inclusion here coincides with the ﬁrst one in the statement. The second inclusion
means that c ∈ ∂V ∗(q) + d and ∆x + θ = η for some (ηt, dt) ∈ ∂q,w(qtSt)∗(wt).
Indeed, the subdiﬀerential sum rule [59, Theorem 23.8] applies ω-wise since
Assumption 1 implies that dom V ∗ ∩ RT +1
++ 6= ∅ while, by [59, Theorem 6.6], the
relative interior of the domain of the function (w, q) 7→ (qSt)∗(w, ω) contains a
(w, q) whenever q ∈ RT +1
++ . It is easily checked that (qtSt)∗(wt) is the support
function of the set Et := {(η, d) | St(η) + d ≤ 0}. By [59, Theorem 23.5 and p.
215], (ηt, dt) ∈ ∂q,w(qtSt)∗(wt) is thus equivalent to (wt, qt) ∈ NEt (ηt, dt). This
means that either St(ηt) + dt < 0 and (wt, qt) = (0, 0) or St(ηt) + dt = 0 and
wt ∈ ∂(qtSt)(ηt). The second inclusion thus means that

q ∈ ∂V (c − d),

wt ∈ ∂(qtSt)(∆xt + θt)

for some measurable process d ≤ −S(∆x + θ) such that q(S(∆x + θ) + d) = 0
almost surely. Since V is nondecreasing, this is satisﬁed also by d = −S(∆x +
θ).

A convex analytic lemma

The following was used in the proofs of Theorems 10 and 11.

Lemma 18. Let D ⊂ Ma be a closed set containing the origin, let p ∈ Ma and

π(c) = inf{α ∈ R | c − αp ∈ D}.

Then the conditions

1. π(c) is closed and proper,

2. π(0) > ∞,

3. p /∈ D∞,

4. hp, qi = 1 for some q ∈ dom σD

are equivalent and imply the validity of the dual representation

π∗(c) = sup
q∈Qa

{hc, qi − σD(q) | hp, qi = 1}.

Proof. This is proved for D = C in [50, Proposition 4.2 and Theorem 5.2]. The
same arguments work for any convex D.

Asymptotic elasticity of a random loss function

The main result of [54] was used in [51] to give condition for the lower semicon-
tinuity of the optimal value function of (ALM). One of the conditions was that
the functions Vt are bounded from below. While this is satisﬁed in many cases,

30

it rules out isoelastic utility functions. Theorem 5 in [56] allows us to replace
the lower bound by more general “asymptotic elasticity” conditions introduced
in [39] and [64]. We extend the conditions of [39, 64] further by allowing for
nonsmooth and random functions Vt and by not imposing the Inada conditions,
which can be written as V ∞
t (·, ω) = δR−. Indeed, it suﬃces to have one of the
conditions in the following lemma.

Lemma 19. Let h be a convex normal integrand on the real line. If there exist
λ > 1, ¯y ∈ dom Eh∗ and C ≥ 0 such that

h∗(λy, ω) ≤ Ch∗(y, ω) ∀y ≥ ¯y(ω)

then (in L0)

λ dom Eh∗ ⊆ dom Eh∗ ∀λ ≥ 1.

If there exist λ ∈ (0, 1), ¯y ∈ dom Eh∗ and C > 0 such that

h∗(λy, ω) ≤ Ch∗(y, ω) ∀y ∈ [0, ¯y(ω)]

then

λ dom Eh∗ ⊆ dom Eh∗ ∀λ ∈ (0, 1].

Proof. Let y ∈ dom Eh∗. Under the ﬁrst condition

h∗(λy) = 1{y≤¯y}h∗(λy) + 1{y>¯y}h∗(λy)

≤ 1{y≤¯y} max{h∗(y), h∗(λ¯y)} + 1{y>¯y}h∗(λy)
≤ 1{y≤¯y} max{h∗(y), Ch∗(¯y)} + 1{y>¯y}Ch∗(y),

where the ﬁrst inequality comes from the convexity of h∗. Since ¯y, y ∈ dom Eh∗,
the last expression is integrable.
Under the second condition,

Eh∗(λy) = E1{y≤¯y}h∗(λy) + E1{y>¯y}h∗(λy)

≤ E1{y≤¯y}h∗(λy) + E1{y>¯y} max{h∗(y), h∗(λ¯y)}
≤ E1{y≤¯y}Ch∗(y) + E1{y>¯y} max{h∗(y), Ch∗(¯y)},

where the ﬁrst inequality comes from the convexity of h∗.

The following lemmas give alternative formulations of the conditions in
Lemma 19 which were used in the proof of Theorem 13. In both lemmas, third
condition extends the “asymptotic elasticity” conditions introduced in [39] and
[64], respectively, for deterministic utility functions.

Lemma 20. Given a nondecreasing closed convex function g on the real line
with g(0) = 0, the following are equivalent conditions on β > 1 and ¯y for which

31

∂g∗(¯y) ⊂ R+.

g∗(λy) ≤ λ

β

β−1 g∗(y)
β

∀λ ≥ 1, y ≥ ¯y.

g∗(y) ∀y ≥ ¯y, c ∈ ∂g∗(y).

cy ≤

β − 1
cy ≥ βg(c)
g(λc) ≥ λβ g(c)

∀c ≥ ∂g∗(¯y), y ∈ ∂g(c).
∀λ ≥ 1, c ≥ ∂g∗(¯y).

(8)

(9)

(10)

(11)

Proof. Assuming (10), we have g(λc) ≥ g(c) +R[c,λc] β g(s)

s ds, so

g(λc) ≥ g(c) +Z[c,λc]

g(c)

β
s

exp(Z[s,λc]

β
r

dr)ds = λβ g(c)

by Gronwall’s inequality. For y ≥ ¯y(ω), condition (11) gives

g∗(y) ≥ sup{cy − λ−β g(λc)} = λ−βg∗(λβ−1y),

which implies (8). We have for every λ > 1, y ≥ ¯y(ω), and c ∈ ∂g∗(y),

c(λy − y) ≤ g∗(λy) − g∗(y) ≤ (λ

β

β−1 − 1)g∗(y)

from where we get (9) by ﬁrst dividing by λ − 1 and then letting λ ց 1. Using
the equivalence

c ∈ ∂g∗(y, ω) ⇐⇒ y ∈ ∂g(c) ⇐⇒ g(c) + g∗(y) = cy

we can write condition (9) as

cy ≤

β

β − 1

(cy − g(c)) ∀c ≥ ∂g∗(¯y), y ∈ ∂g(c)

which is equivalent with (11).

Lemma 21. Given a nondecreasing closed convex function g on the real line
with g(0) = 0, the following are equivalent conditions on β ∈ (0, 1) and ¯y for
which ∂g∗(¯y) ⊆ R−.

−β

g∗(λy) ≤ λ

cy ≥

1−β g∗(y)
−β
1 − β
cy ≥ βg(c)
g(λc) ≥ λβ g(c)

∀λ ∈ (0, 1), y ∈ (0, ¯y].

g∗(y) ∀y ∈ (0, ¯y], c ∈ ∂g∗(y).

∀c ≤ ∂g∗(¯y), y ∈ ∂g(c).
∀λ ≥ 1, c ≤ ∂g∗(¯y).

(12)

(13)

(14)

(15)

Proof. Assuming (14), we have g(c) ≤ g(λc) +R[λc,c] β g(s)

s ds, so

ds = g(λc)(1 − ln(λ−β )) ≤ λ−βg(λc)

g(c) ≤ g(λc) + g(λc)Z[λc,c]

β
s

32

For y ∈ (0, ¯y], condition (15) gives

g∗(y) ≥ sup{cy − λ−β g(λc)} = λ−βg∗(λβ−1y),

which implies (12). We have for every λ ∈ (0, 1), y ∈ (0, ¯y], and c ∈ ∂g∗(y),

c(λy − y) ≤ g∗(λy) − g∗(y) ≤ (λ

−β

1−β − 1)g∗(y)

from where we get (13) by ﬁrst dividing by λ − 1 and then letting λ ր 1. Using
the equivalence

c ∈ ∂g∗(y) ⇐⇒ y ∈ ∂g(c) ⇐⇒ g(c) + g∗(y) = cy

we can write condition (13) as

cy ≥

−β
1 − β

(cy − g(c)) ∀c ≥ ∂g∗(¯y), y ∈ ∂g(c)

which is equivalent with (14).

References

[1] Acciaio, B., F¨ollmer, H., & Penner, I. 2012. Risk assessment for uncertain
cash ﬂows: model ambiguity, discounting ambiguity, and the role of bubbles.
Finance Stoch., 16(4), 669–709.

[2] Artzner, Ph., Delbaen, F., Eber, J.M., & Heath, D. 1999. Coherent Measures

of Risk. Mathematical Finance, 9(3), 203–228.

[3] Artzner, Ph., Delbaen, F., & Koch-Medona, P. 2009. RISK MEASURES

AND EFFICIENT USE OF CAPITAL. Astin Bulletin, 39(1), 101–116.

[4] Barrieu, P., & El Karoui, N. 2005.

Inf-convolution of risk measures and

optimal risk transfer. Finance and Stochastics, 9(2), 269–298.

[5] Becherer, D. 2003. Rational hedging and valuation of integrated risks under

constant absolute risk aversion. Insurance Math. Econom., 33(1), 1–28.

[6] Biagini, S., & ˇCern´y, A. 2011. Admissible strategies in semimartingale port-

folio selection. SIAM J. Control Optim., 49(1), 42–72.

[7] Biagini, S., & Frittelli, M. 2008. A Uniﬁed Framework for Utility Max-
imization Problems: An Orlicz Spaces Approach. The Annals of Applied
Probability, 18(3), 929–966.

[8] Biagini, S., Frittelli, M., & Grasselli, M. 2011. Indiﬀerence price with general

semimartingales. Mathematical Finance, 21(3), 423–446.

[9] Biagini, S., Pennanen, T., & Perkki¨o, A.-P.. 2015. Duality and optimality
conditions in stochastic optimization and mathematical ﬁnance. manuscript.

33

[10] Bielecki, T. R., Cialenco, I., & Rodriguez, R. 2015. No-arbitrage pricing
for dividend-paying securities in discrete-time markets with transaction costs.
Math. Finance, 25(4), 673–701.

[11] Bismut, J.-M. 1973. Int´egrales convexes et probabilit´es. J. Math. Anal.

Appl., 42, 639–673.

[12] Campi, L., & Owen, M. P. 2011. Multivariate utility maximization with

proportional transaction costs. Finance Stoch., 15(3), 461–499.

[13] Carmona, R. (ed). 2009.

theory and applications.
Princeton series in ﬁnancial engineering. Princeton, NJ: Princeton University
Press.

Indiﬀerence pricing:

[14] ˇCern´y, A., & Hodges, S. 2002. The theory of good-deal pricing in ﬁnancial
markets. Pages 175–202 of: Mathematical ﬁnance—Bachelier Congress, 2000
(Paris). Springer Finance. Springer, Berlin.

[15] C¸ etin, U., & Rogers, L. C. G. 2007. Modelling liquidity eﬀects in discrete

time. Mathematical Finance, 17(1), 15–29.

[16] Cvitani´c, J., & Karatzas, I. 1992. Convex duality in constrained portfolio

optimization. Ann. Appl. Probab., 2(4), 767–818.

[17] Czichowsky, C., Muhle-Karbe, J., & Schachermayer, W. 2014. Transaction
costs, shadow prices, and duality in discrete time. SIAM J. Financial Math.,
5(1), 258–277.

[18] Dalang, R. C., Morton, A., & Willinger, W. 1990. Equivalent martingale
measures and no-arbitrage in stochastic securities market models. Stochastics
Stochastics Rep., 29(2), 185–201.

[19] Davis, M. H. A., & Norman, A. R. 1990. Portfolio selection with transaction

costs. Math. Oper. Res., 15(4), 676–713.

[20] Delbaen, F., & Schachermayer, W. 2006. The Mathematics of Arbitrage.

Springer Finance. Berlin Heidelberg: Springer-Verlag.

[21] Delbaen, F., Grandits, P., Rheinl¨ander, T., Samperi, D., Schweizer, M., &
Stricker, C. 2002. Exponential hedging and entropic penalties. Math. Finance,
12(2), 99–123.

[22] Dermody, J. C., & Rockafellar, R. T. 1991. Cash stream valuation in the

face of transaction costs and taxes. Math. Finance, 1(1), 31–54.

[23] Eberlein, E. 2015. Valuation in illiquid markets. Procedia Economics and

Finance, 29, 135143.

[24] Farkas, W., Koch-Medina, P., & Munari, C. 2015. Measuring risk with

multiple eligible assets. Math. Financ. Econ., 9(1), 3–27.

34

[25] F¨ollmer, H., & Leukert, P. 2000. Eﬃcient hedging: cost versus shortfall

risk. Finance Stoch., 4(2), 117–146.

[26] F¨ollmer, H., & Schied, A. 2011. Stochastic ﬁnance. extended edn. Berlin:

Walter de Gruyter & Co. An introduction in discrete time.

[27] Frittelli, M., & Scandolo, G. 2006. Risk measures and capital requirements

for processes. Math. Finance, 16(4), 589–612.

[28] Guasoni, P., & R´asonyi, M. 2015. Hedging, arbitrage and optimality with

superlinear frictions. Ann. Appl. Probab., 25(4), 2066–2095.

[29] Harrison, J. M., & Kreps, D. M. 1979. Martingales and arbitrage in mul-

tiperiod securities markets. J. Econom. Theory, 20(3), 381–408.

[30] Harrison, J. M., & Pliska, S. R. 1981. Martingales and stochastic integrals
in the theory of continuous trading. Stochastic Process. Appl., 11(3), 215–260.

[31] Hilli, P., Koivu, M., & Pennanen, T. 2011. Cash-ﬂow based valuation of

pension liabilities. European Actuarial Journal, 1, 329–343.

[32] Hodges, S. D., & Neuberger, A. 1989. Optimal Replication of Contingent

Claims under Transaction Costs. Reviev of Futures Markets, 8, 222–239.

[33] Jaschke, S., & K¨uchler, U. 2001. Coherent risk measures and good-deal

bounds. Finance Stoch., 5(2), 181–200.

[34] Jouini, E., & Kallal, H. 1995a. Arbitrage in securities markets with short-

sales constraints. Math. Finance, 5(3), 197–232.

[35] Jouini, E., & Kallal, H. 1995b. Martingales and arbitrage in securities

markets with transaction costs. J. Econom. Theory, 66(1), 178–197.

[36] Kabanov, Y. M. 1999. Hedging and liquidation under transaction costs in

currency markets. Finance and Stochastics, 3(2), 237–248.

[37] Karatzas, I., & ˘Zitkovi´c, G. 2003. Optimal consumption from investment
and random endowment in incomplete semimartingale markets. The Annals
of Probability, 31(4), 1821–1858.

[38] Klein, I., & Rogers, L. C. G. 2007. Duality in optimal investment and
consumption problems with market frictions. Math. Finance, 17(2), 225–
247.

[39] Kramkov, D., & Schachermayer, W. 1999. The condition on the Asymp-
totic Elasticity of Utility Functions and Optimal Investment in Incomplete
Markets. Annals of Applied Probability, 9(3), 904–950.

[40] Kramkov, D., & Schachermayer, W. 2003. Necessary and suﬃcient con-
ditions in the problem of optimal investment in incomplete markets. Ann.
Appl. Probab., 13(4), 1504–1516.

35

[41] Kreher, D. 2009. Hedging of portfolio-valued claims under convex transac-
tion costs and portfolio constraints. M.Phil. thesis, Humboldt-Universit¨at zu
Berlin.

[42] Kreps, D. M. 1981. Arbitrage and equilibrium in economies with inﬁnitely

many commodities. J. Math. Econom., 8(1), 15–35.

[43] Madan, D. B. 2014. Asset pricing theory for two price economies. Annals

of Finance, 11(1), 1–35.

[44] Napp, C. 2001. Pricing issues with investment ﬂows: applications to market

models with frictions. J. Math. Econom., 35(3), 383–408.

[45] Owen, M. P., & ˇZitkovi´c, G. 2009. Optimal investment with an unbounded
random endowment and utility-based pricing. Math. Finance, 19(1), 129–159.

[46] Pennanen, T. 1999. Graph-convex mappings and K-convex functions. J.

Convex Anal., 6(2), 235–266.

[47] Pennanen, T. 2011a. Arbitrage and deﬂators in illiquid markets. Finance

and Stochastics, 15(1), 57–83.

[48] Pennanen, T. 2011b. Convex duality in stochastic optimization and math-

ematical ﬁnance. Mathematics of Operations Research, 36(2), 340–362.

[49] Pennanen, T. 2011c. Dual representation of superhedging costs in illiquid

markets. Mathematics and Financial Economics, 5, 233–248.

[50] Pennanen, T. 2011d. Superhedging in illiquid markets. Mathematical Fi-

nance, 21(3), 519–540.

[51] Pennanen, T. 2014a. Optimal investment and contingent claim valuation

in illiquid markets. Finance Stoch., 18(4), 733–754.

[52] Pennanen, T. to appear. Correctional note: ”Convex duality in stochastic
optimization and mathematical ﬁnance”. Mathematics of Operations research.

[53] Pennanen, T., & Penner, I. 2010. Hedging of claims with physical delivery
under convex transaction costs. SIAM Journal on Financial Mathematics, 1,
158–178.

[54] Pennanen, T., & Perkki¨o, A.-P. 2012. Stochastic programs without duality

gaps. Mathematical Programming, 136(1), 91–110.

[55] Pennanen, Teemu. 2014b. Convex duality in optimal investment under

illiquidity. Math. Program., 148(1-2, Ser. B), 279–295.

[56] Perkki¨o, A.-P. 2016. Stochastic programs without duality gaps for objec-

tives without a lower bound. preprint.

[57] Rockafellar, R. T. 1966. Level sets and continuity of conjugate convex

functions. Trans. Amer. Math. Soc., 123, 46–63.

36

[58] Rockafellar, R. T. 1968. Integrals which are convex functionals. Paciﬁc J.

Math., 24, 525–539.

[59] Rockafellar, R. T. 1970. Convex analysis. Princeton Mathematical Series,

No. 28. Princeton, N.J.: Princeton University Press.

[60] Rockafellar, R. T. 1974. Conjugate duality and optimization. Philadelphia,

Pa.: Society for Industrial and Applied Mathematics.

[61] Rockafellar, R. T., & Wets, R. J.-B. 1998.

Variational analysis.
Grundlehren der Mathematischen Wissenschaften [Fundamental Principles
of Mathematical Sciences], vol. 317. Berlin: Springer-Verlag.

[62] Rogers, L. C. G. 2013. Optimal Investment. Berlin: Springer.

[63] Rouge, R., & El Karoui, N. 2000. Pricing via utility maximization and
INFORMS Applied Probability

entropy. Math. Finance, 10(2), 259–276.
Conference (Ulm, 1999).

[64] Schachermayer, W. 2001. Optimal investment in incomplete markets when

wealth may become negative. Ann. Appl. Probab., 11(3), 694–734.

[65] Schachermayer, W. 2003. A super-martingale property of the optimal port-

folio process. Finance Stoch., 7(4), 433–456.

[66] Schachermayer, W. 2004. The fundamental theorem of asset pricing under
proportional transaction costs in ﬁnite discrete time. Math. Finance, 14(1),
19–48.

[67] Tehranchi, M. 2016. Arbitrage theory without a numeraire. preprint.

37

