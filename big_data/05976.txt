6
1
0
2

 
r
a

 

M
8
1

 
 
]

M

I
.

h
p
-
o
r
t
s
a
[
 
 

1
v
6
7
9
5
0

.

3
0
6
1
:
v
i
X
r
a

TO BE SUBMITTED TO APJ
Preprint typeset using LATEX style emulateapj v. 04/17/13

BICEP2 / Keck Array VII: MATRIX BASED E/B SEPARATION APPLIED TO BICEP2 AND THE Keck Array

Keck Array AND BICEP2 COLLABORATIONS: P. A. R. ADE1, Z. AHMED2,3, R. W. AIKIN4, K. D. ALEXANDER5, D. BARKATS5,
S. J. BENTON6, C. A. BISCHOFF5, J. J. BOCK7,8, R. BOWENS-RUBIN5, J. A. BREVIK7, I. BUDER5, E. BULLOCK9, V. BUZA5,10,
J. CONNORS5, B. P. CRILL8, L. DUBAND11, C. DVORKIN10, J. P. FILIPPINI7,12, S. FLIESCHER9, J. GRAYSON2, M. HALPERN13,
S. HARRISON5, S. R. HILDEBRANDT7,8, G. C. HILTON14, H. HUI7, K. D. IRWIN2,3, J. KANG2,3, K. S. KARKARE5, E. KARPEL2,

J. P. KAUFMAN15, B. G. KEATING15, S. KEFELI7, S. A. KERNASOVSKIY1, J. M. KOVAC5,10, C. L. KUO2,3, E. M. LEITCH16,

M. LUEKER7, K. G. MEGERIAN8, T. NAMIKAWA2,3, C. B. NETTERFIELD6,17, H. T. NGUYEN8, R. O’BRIENT7,8, R. W. OGBURN IV2,3,

A. ORLANDO7, C. PRYKE9,18, S. RICHTER5, R. SCHWARZ18, C. D. SHEEHY16,18, Z. K. STANISZEWSKI7,8, B. STEINBACH7,

R. V. SUDIWALA1, G. P. TEPLY7,15, K. L. THOMPSON2,3, J. E. TOLAN2,20, C. TUCKER1, A. D. TURNER8, A. G. VIEREGG5,16,19,

A. C. WEBER8, D. V. WIEBE13, J. WILLMERT18, C. L. WONG5,10, W. L. K. WU2, AND K. W. YOON2

to be submitted to ApJ

ABSTRACT

A linear polarization ﬁeld on the sphere can be uniquely decomposed into an E-mode and a B-mode compo-
nent. These two components are analytically deﬁned in terms of spin-2 spherical harmonics. Maps that contain
ﬁltered modes on a partial sky can also be decomposed into E-mode and B-mode components. However, the
lack of full sky information prevents orthogonally separating these components using spherical harmonics. In
this paper, we present a technique for decomposing an incomplete map into E and B-mode components using
E and B eigenmodes of the pixel covariance in the observed map. This method is found to orthogonally deﬁne
E and B in the presence of both partial sky coverage and spatial ﬁltering. This method has been applied to
the BICEP2 and the Keck Array maps and results in reducing E to B leakage from ΛCDM E-modes to a level
corresponding to a tensor-to-scalar ratio of r < 1× 10−4.
Subject headings: cosmic background radiation — cosmology: observations — gravitational waves — inﬂa-

tion — polarization

1. INTRODUCTION

1 School of Physics and Astronomy, Cardiff University, Cardiff, CF24

3AA, United Kingdom

USA

2 Department of Physics, Stanford University, Stanford, CA 94305,

3 Kavli Institute for Particle Astrophysics and Cosmology, SLAC Na-
tional Accelerator Laboratory, 2575 Sand Hill Rd, Menlo Park, CA 94025,
USA

4 Department of Physics, California Institute of Technology, Pasadena,

California 91125, USA

5 Harvard-Smithsonian Center for Astrophysics, 60 Garden Street MS

42, Cambridge, Massachusetts 02138, USA

6 Department of Physics, University of Toronto, Toronto, Ontario, M5S

1A7, Canada

California 91125, USA

7 Department of Physics, California Institute of Technology, Pasadena,

8 Jet Propulsion Laboratory, Pasadena, California 91109, USA
9 Minnesota Institute for Astrophysics, University of Minnesota, Min-

neapolis, Minnesota 55455, USA

10 Department of Physics, Harvard University, Cambridge, MA 02138,

11 Service des Basses Températures, Commissariat à l’Energie Atom-

USA

ique, 38054 Grenoble, France

Urbana, Illinois 61801, USA

12 Department of Physics, University of Illinois at Urbana-Champaign,

13 Department of Physics and Astronomy, University of British

Columbia, Vancouver, British Columbia, V6T 1Z1, Canada

14 National Institute of Standards and Technology, Boulder, Colorado

15 Department of Physics, University of California at San Diego, La

16 Kavli Institute for Cosmological Physics, University of Chicago,

80305, USA

Jolla, California 92093, USA

Chicago, IL 60637, USA

1Z8, Canada

17 Canadian Institute for Advanced Research, Toronto, Ontario, M5G

18 School of Physics and Astronomy, University of Minnesota, Min-

neapolis, Minnesota 55455, USA

19 Department of Physics, Enrico Fermi

Institute, University of

Chicago, Chicago, IL 60637, USA

20 Corresponding author: jetolan@stanford.edu

Current experiments are producing low noise maps of the
polarization of the cosmic microwave background (CMB) ra-
diation able to constrain models of inﬂation and measure B-
modes from gravitational lensing. These experiments include
BICEP2, the Keck Array, POLARBEAR, SPTPOL, ACTPol,
and Planck (BICEP2 Collaboration I 2014; Keck Array and
BICEP2 Collaborations VI 2015; Hanson et al. 2013; Polar-
bear Collaboration 2014; van Engelen et al. 2015; Planck Col-
laboration I 2015). These experiments do not measure the
CMB over the entire sky for a variety of reasons. Galactic
foregrounds prevent any experiment from producing a map of
the CMB over the entire sky. Any ground or balloon based
experiment has a limited view of the full sky. Some experi-
ments, including BICEP2 and the Keck Array, choose to ob-
serve a limited ﬁeld of view to increase map depth over a
small region of sky or choose to ﬁlter their data so that the
maps incompletely measure the modes within the ﬁeld.

The ability to uniquely separate a linear polarization ﬁeld
into E and B-modes is critical for measuring gravitational
waves using the B-mode polarization. This separation allows
the distinction to be made between E-modes created by scalar
perturbations and B-modes coming from tensor perturbations
(Kamionkowski et al. 1997; Zaldarriaga 1998).

Unfortunately, the unique decomposition into E and B is
only possible for maps of the full sky. Maps containing a
limited view of the sky, or an incomplete measurement of the
true sky modes, are said to suffer from E/B leakage. E to B
leakage is deﬁned as measured power for a particular B-mode
estimator whose source is true sky E-mode power. B to E
leakage is leakage of power in the opposite direction, but in
practice it is less of a concern for CMB measurements due to
the much fainter B-mode signal. E/B leakage refers to both

2

types of leakage.

There are several ways to mitigate the effect of E/B leakage
in analysis. Full pixel-space likelihood methods in principle
can optimally separate E and B contributions for any given
map. These have been applied mainly to maps of relatively
modest pixel count, including many early detections of CMB
polarization (for example, Kovac et al. 2002; Readhead et al.
2004; Bischoff et al. 2008). Current analyses more commonly
apply ﬁxed estimators of E and B power spectra to observed
CMB polarization maps. The simplest way to correct such
estimators for leakage is to run an ensemble of simulations
through the analysis and subtract the mean level of leakage
in the angular power spectrum. However, the sample variance
from the leaked power remains and contributes to the ﬁnal un-
certainty of measured power in each angular power spectrum
bin, limiting an experiment’s ability to measure B-modes re-
gardless of its instrumental sensitivity. For many experiments,
including BICEP2 and the Keck Array, the sample variance of
the leaked E-modes is comparable to the instrumental noise
and is a signiﬁcant contribution to the uncertainty in the B-
mode power spectrum.

Solutions to this problem rely on the fact that for most B-
mode science it is not necessary to classify all the modes in
the measured polarization ﬁeld.
Instead, it is sufﬁcient to
ﬁnd subspaces that are caused by either E or B and ignore
the modes whose source cannot be determined. There are a
number of published methods that attempt this goal.

Smith (2006) presents an estimator that does not suffer from
E/B leakage arising from partial sky coverage. This method
has been incorporated into the Xpure and S2HAT packages
(Grain et al. 2009), and the BICEP2 and Keck Array analysis
pipeline contains an option in which this algorithm is imple-
mented.

However, many experiments, including BICEP2 and the
Keck Array, produce maps in which some modes have also
been removed by ﬁltering. The estimator presented in Smith
(2006) does not prevent ﬁltered modes from creating E/B
leakage. Another method, presented in Smith & Zaldarriaga
(2007), accounts for incomplete mode measurement in partial
sky maps. However, we have found this method to be compu-
tationally infeasible for the BICEP2 and Keck Array observing
and ﬁltering strategy.

For BICEP2 and the Keck Array, we developed a new
method for distinguishing true sky B-mode polarization from
the leaked E-modes in the observed maps. The method ex-
tends the work of Bunn et al. (2003) and applies it to a real
data set. It is a standard component of the BICEP2 and Keck
Array analysis pipeline and effectively eliminates the uncer-
tainty created by E/B leakage. The method reduces the ﬁnal
uncertainty in the measured BB power spectrum of the BI-
CEP2 results (BICEP2 Collaboration I 2014) by more than
a factor of two, compared to analysis done with the Smith
(2006) method. The method results in a larger improvement
for the analysis of the combined BICEP2 and Keck Array maps
(Keck Array and BICEP2 Collaborations VI 2015), where the
noise levels are lower.

The organization of this paper is as follows: Section 2 pro-
vides an abbreviated background of a polarization ﬁeld on a
sphere, decomposition into spin-2 spherical harmonics, and
analytically deﬁnes E and B-modes. Section 3 outlines the
eigenvalue problem used in the matrix based E/B separation.
Section 4 describes how an observation matrix is created in
the BICEP2 and Keck Array analysis pipeline. Section 5 de-

scribes constructing the signal covariance matrix and Section
6 uses the covariance matrix to solve the eigenvalue problem
and ﬁnd puriﬁcation matrices. Section 7 prensents results of
matrix based E/B separation in the BICEP2 data set. Con-
cluding remarks are offered in Section 8.

Unless otherwise stated, we adopt the HEALPix polariza-
tion convention2 and work in J2000.0 equatorial coordinates
throughout this paper. Bold font letters and symbols repre-
sent vectors or matrices, even when containing subscripts, in
which case the subscript is meant to designate a new matrix
or vector. Normal font letters and symbols represent scalar
quantities.

2. E AND B-MODES FROM A POLARIZATION FIELD

This section demonstrates the decomposition of a polariza-
tion ﬁeld on the full sky into E and B-modes. Much of the dis-
cussion follows Zaldarriaga & Seljak (1997) and Bunn et al.
(2003).

2.1. Full sky

The values of the Stokes parameters Q and U for a partic-
ular location on the sky are dependent on the choice of coor-
dinate system. By rotating the local coordinate system, Q is
rotated into U and vice versa. Under rotation by an angle φ,
the combinations Q + iU and Q − iU transform as:

(Q + iU)(cid:48) = e−2iφ(Q + iU)
(Q − iU)(cid:48) = e2iφ(Q − iU).

(1)
The T , Q, and U ﬁelds can be expressed as sums of
spin weighted spherical harmonics. While the temperature
anisotropies can be broken down into spin-0 harmonics, the
polarization ﬁeld of Q and U must be expressed in terms of
spin-2 spherical harmonics (Goldberg et al. 1967):

T (r) =(cid:88)
(Q + iU)(r) =(cid:88)
(Q − iU)(r) =(cid:88)

lm

lm

aT
lm ( 0Ylm(r))

a+2,lm ( +2Ylm(r))

a−2,lm ( −2Ylm(r)) ,

(2)

lm

where ±2Ylm are the spin-2 case of spin weighted spherical
harmonics, and the spin-0 case are the normal spherical har-
monics, 0Ylm. Since Q+iU and Q−iU are affected by rotations
of the coordinate system, it is convenient to express the coef-
ﬁcients of the spin-2 spherical harmonics using a set of coor-
dinate independent scalar aE
lm coefﬁcients and pseudo-scalar
aB
lm coefﬁcients:

lm ≡ −(a+2,lm + a−2,lm)/2
aE
lm ≡ −i(a+2,lm − a−2,lm)/2.
aB

(3)
We also deﬁne two combinations of spin-2 spherical harmon-
ics:

X1,lm ≡ ( +2Ylm + −2Ylm)/2
X2,lm ≡ ( +2Ylm − −2Ylm)/2.

(4)

2http://healpix.jpl.nasa.gov/html/intronode12.

htm

Matrix based E/B Separation

3

We can use the coefﬁcients in Equation 3 and the combina-
tions in Equation 4 to construct real space forms of T , Q, and
U ﬁelds, according to Equation 2:
aT
lm( 0Ylm(r))

(cid:0)aE
(cid:0)aB

lmX2,lm(r)(cid:1)
lmX2,lm(r)(cid:1) .

lmX1,lm(r) + iaB

lmX1,lm(r) − iaE

(5)

Using these relations, we can write the polarization ﬁeld as a
vector:

P(r) ≡

lm

lm

lm

T (r) =(cid:88)
Q(r) = −(cid:88)
U(r) = −(cid:88)
(cid:19)
(cid:18)Q(r)
(cid:20) aE
= −(cid:88)
(cid:20)
= −(cid:88)
= −(cid:88)
(cid:2)aE
(cid:90)

U(r)

aE
lm

lm

lm

(cid:21)
(cid:18)iX2,lm(r)

X1,lm(r)

(cid:19)(cid:21)

(6)

lmX1,lm(r) + iaB
lmX1,lm(r) − iaE
aB

(cid:18) X1,lm(r)

−iX2,lm(r)

lmY E

lm(r) + aB

lmY B

lmX2,lm(r)
lmX2,lm(r)

(cid:19)
lm(r)(cid:3) ,

+ aB
lm

lm
lm and Y B
lm have been introduced and deﬁned in the last

where Y E
step. On the full sphere, Y E

lm and Y B

lm are orthogonal:

lm(r)·Y B
Y E

l(cid:48)m(cid:48)(r)dS = 0,

(7)

S2
for all l,l(cid:48) and m,m(cid:48).

(cid:90)

2.2. Orthogonality of pure E and pure B

The inner product of two polarization ﬁelds is deﬁned as:

P· P(cid:48) ≡

P· P(cid:48)dΩ,

(8)

Ω

where Ω is the manifold on which the polarization ﬁeld is de-
ﬁned: for the full sky it is the celestial sphere. In pixelized
maps, the vector space of a polarization ﬁeld has a ﬁnite di-
mension: twice the number of pixels in the map.

As demonstrated in Equation 7, E and B-mode polarization
ﬁelds on the full sky are orthogonal. However, experiments
produce Q/U maps of portions of the sky, and often ﬁlter spa-
tial modes out of these maps. We deﬁne the term ‘observed’
maps or modes to refer to these incomplete measurements of
the true sky.

The spaces of observed E-modes and B-modes are non-
orthogonal. The overlapping subspace between the two is
called the ambiguous space. We cannot tell whether signal
in the ambiguous subspace came from full sky E-modes or
full sky B-modes.

The solution is to decompose vector ﬁelds on an observed
‘pure’ E-modes, ‘pure’ B-
manifold into three subspaces:
modes, and ambiguous modes. Pure E and B-modes are sub-
spaces of the polarization vector space of a particular mani-
fold, deﬁned as:

• A pure B-mode is orthogonal to observed E-modes.
• A pure E-mode is orthogonal to observed B-modes.

Therefore, a pure B-mode is one that has no E to B leakage:
neither pure E-modes nor ambiguous modes contribute to it.

3. HOW MATRIX BASED E/B SEPARATION FINDS PURE E AND

PURE B

A pure B-mode on an observed manifold is deﬁned in Sec-

tion 2.2 as being orthogonal to observed E-modes:

PE · b = 0.

(9)
The vector b is any linear combination of modes in the sub-
space of the pure B-modes. For pixelized maps, b contains
Q and U values for each of the pixels in the map, and PE is
the pixelized version of the E-mode spherical harmonics. It is
useful to multiply the above equation by its conjugate trans-
pose, and sum over l and m, so that we have a scalar repre-
senting the degree of orthogonality:
lmYE†

(cid:32)(cid:88)

aE∗
lm aE

b = 0.

(cid:33)

(cid:10)aE∗

We have freedom to choose the power spectrum, CEE

(cid:11), which is included in the covariance matrix, CE:

lm YE
lm

(10)

b(cid:62)

=

lm

l

lm aE
lm

lm YE
lm.

(11)

We note that this product is the 2× 2 [Q,U] covariance block
in the signal covariance matrix:

lm

l YE†
CEE

CE ≡(cid:88)
(cid:68)(cid:0)PE(cid:1)(cid:62) PE(cid:69)
(cid:18)(cid:10)QE
(cid:11) (cid:10)QE
(cid:10)U E
(cid:11) (cid:10)U E

i QE
j
i QE
j

=

CE =

(cid:11)
(cid:11)(cid:19)

i U E
j
i U E
j

,

(12)

where the superscript denotes the E-mode component of the
full sky polarization ﬁeld. We can evaluate the covariance
matrix for a particular set of pixels and a chosen spectrum.

CBxi = λiCExi,

By solving a generalized eigenvalue equation of the form:
(13)
and selecting eigenmodes corresponding to the largest eigen-
values, we can ﬁnd eigenmodes b that are nearly orthogonal
to E-modes and therefore approximate pure B. Eigenmodes
corresponding to the smallest eigenvalues approximate pure
E. This method is a natural extension to the signal to noise
truncation discussed in Bond et al. (1998) and Bunn & White
(1997) and applied in Kuo et al. (2004). The speciﬁc appli-
cation to E and B-modes was ﬁrst discussed in Bunn et al.
(2003).

We say the modes approximate pure E and pure B-modes
because the degree of orthogonality is proportional to the
magnitude of the eigenvalues. The level of orthogonality is
discussed further in Section 6. However, for the remainder of
the paper, we will use the terms pure B and pure E to refer to
the largest and smallest eigenmodes of Equation 13, despite
the fact that their inner product is not identically zero.
Now suppose that the true sky polarization ﬁeld, P, is trans-
formed into an observed polarization ﬁeld, ˜P, by a real space
linear operation, R:

˜PE = RPE

= −R(cid:88)

aE
lmYE
lm.

(14)

lm

Throughout this paper, transformations into observed quan-
tities are indicated by the inclusion of a tilde over the vari-
able, in the above equation, P → ˜P. The operator R will

4

typically represent ﬁltering operations necessary to suppress
noise and/or systematics plus an apodization of the resulting
observed maps.

The condition for pure E and pure B must be the same after
multiplying by R. We still demand that the vectors of pure B
be orthogonal to all those in the E space, which includes both
the pure E-modes and the ambiguous modes:

aE
lmYE
lm

· b = 0.

(15)

We create a basis of pure E and pure B-modes by solving

the eigenvalue problem with the covariances of the form:

(cid:33)

lm

(cid:32)
R(cid:88)
(cid:32)(cid:88)
(cid:32)(cid:88)

lm

(cid:33)
(cid:33)

˜CE = R(cid:62)

l YE†
CEE

lm YE
lm

R

˜CB = R(cid:62)

l YB†
CBB

lmYB
lm

R,

(16)

lm
so that Equation 13 becomes:

˜CBxi = λi ˜CExi.

(17)
In the simplest case, the matrix R is an apodization window
and ﬁlled only on its diagonal. However, Equation 15 does not
necessitate that the real space operator be a diagonal matrix.
Any analysis steps that can be expressed as linear operations
can be included.

In BICEP2 and Keck Array analysis a number of ﬁltering
operations are typically performed during the map making
In the next section the matrix R corresponding to
process.
these operations is derived. The practical implementation of a
solution to the eigenvalue equation is discussed in Section 6.

4. OBSERVATION MATRIX

The matrix R transforms an ‘input map,’ m, a vector of
the true sky polarization ﬁeld, into a vector of the observed
map, ˜m. If the matrix R represents the apodization and linear
ﬁltering of an analysis pipeline, it is deﬁned to be the ‘obser-
vation’ matrix for a particular experiment. This choice of R
ensures the eigenspaces of Equation 17 are pure E and B for
the observed map. This section describes how the observation
matrix is computed for BICEP2 and the Keck Array.

The steps in constructing the observation matrix mirror
functions in the data reduction pipeline that was originally
developed for QUAD (Pryke et al. 2009) and later used in
the BICEP1 (BICEP1 Collaboration 2014), BICEP2 (BICEP2
Collaboration I 2014), and Keck Array (Keck Array and BI-
CEP2 Collaborations V 2015) analyses. This pipeline consists
of a MATLAB library of procedures which constructs maps,
including several ﬁltering steps, from real data or simulated
timestream data for a given input sky map.

The ﬁltering operations performed sequentially in the stan-
dard pipeline include data selection, polynomial ﬁltering,
scan-synchronous signal subtraction, weighting, binning into
map pixels, and deprojection of leaked temperature signal. To
construct the observation matrix, matrices representing each
of these steps are multiplied together to form a ﬁnal matrix
that performs all of the operations at once. Since each of the
operations is linear, the observation matrix is independent of
the input map. Therefore, the same matrix can be used on
any input map and will perform the same operations as the
standard pipeline.

If the combined matrix of timestream operations is V, then
˜m, is

transforming a timestream, d, into an observed map,
simply:

(18)
The signal component of a timestream can be generated
from an input map, m, using a matrix that contains infor-
mation about the pointing and orientations of the detectors,
according to the equation d = Am. The observation matrix,
R, is given by the product of V and A:

˜m = Vd.

˜m = VAm
= Rm.

(19)
(20)
It is not necessary for the input maps and observed maps to
share the same pixelization scheme, since the observation ma-
trix can easily be made to transform between the two.

4.1. Input HEALPix maps

We choose a HEALPix pixelization scheme (Gorski et al.
2005) for the input maps, m, because it has equal area pixels
on the sphere and is widely used in the cosmology commu-
nity.

is represented by the map mo =
A true sky signal
xy,Qo
[T o
xy], where (x,y) are the (RA,Dec) coordinates of
the map. Using synfast3, the unobserved input map is con-
volved with the array averaged beam function, ¯B, constructed
from measurements of the beam function of all detectors in
the array:

xy,U o

= ¯B∗ mo = ¯Bxy ∗

(21)

 .

 T o

xy
Qo
xy
U o
xy

(cid:34) Txy

(cid:35)

Qxy
Uxy

The input map vector is found by reforming the beam con-
volved two dimensional map into a one dimensional vector,
m, of length 3 j, where j = 1...np, for np pixels in the input
map:

.

(22)

(cid:34) Tj

(cid:35)

Q j
Uj

m ≡

4.2. BICEP2 and Keck Array scan strategy

The observing strategies for BICEP2 and the Keck Array
are very similar and borrow heavily from BICEP1. All three
experiments target a region of sky centered at a right ascen-
sion of 0 degrees and declination of -57.5 degrees. A detailed
description of the scan strategy is contained in BICEP2 Col-
laboration II (2014).

• Halfscans: During normal observations, the telescope
scans in azimuth at a constant elevation. The scan speed
of 2.8 deg s−1 places the targeted multipoles of 20 < l <
200 at temporal frequencies less than 1 Hz. Each scan
covers 64.2 degrees, at the end of which the telescope
stops and reverses direction in azimuth and scans back
across the ﬁeld center. A scan in a single direction is
known as a ‘halfscan.’

• Scansets: Halfscans are grouped into sets of ≈ 100
halfscans, which are known as ‘scansets.’ The scan pat-
tern deliberately covers a ﬁxed range in azimuth within

3 synfast is a program in the HEALPix suite that renders sky maps

from sets of input alm’s.

Matrix based E/B Separation

5

each scanset, rather than a ﬁxed range in right ascen-
sion. Over the course of the 50 minute scanset, Earth’s
rotation results in a relative drift of azimuthal coordi-
nates and right ascension of about 12.5 degrees. At the
end of each scanset the elevation is offset by 0.25 de-
grees, and a new scanset commences. The telescope
steps in 0.25 degree elevation increments between each
scanset. All observations take place at 20 elevation
steps, with a boresight pointing ranging in elevation be-
tween 55 and 59.75 degrees. The geographic location
of the telescope, near the South Pole, means that eleva-
tion and declination are approximately interchangeable.
• Phases: Scansets are grouped together into sets known
as ‘phases.’ For BICEP2 and the Keck Array, CMB
phases consist of ten scansets, comprising 9 hours of
observations. CMB phases are grouped into seven types
and each type has a unique combination of elevation
offset and azimuthal position.

• Schedules: The third degree of freedom in the BICEP2
and Keck Array telescope mounts is a rotation about the
boresight, referred to as ‘deck rotation.’ The polariza-
tion angles relative to the cryostats are ﬁxed, so rotating
in deck angle allows detector pairs to observe at multi-
ple polarization angles.
A ‘schedule’ typically consists of a set of phases at a
particular deck angle. The deck angle is rotated be-
tween schedules. There is typically one schedule per
fridge cycle, occurring every ∼ 3 days for BICEP2 and
∼ 2 days for the Keck Array.
4.3. Relationship between timestreams and [T,Q,U]

The BICEP2 and Keck Array detectors consist of pairs
of nominally co-pointed, orthogonal, polarization sensitive
phased array antennas coupled to TES bolometers (BI-
CEP2/Keck and Spider Collaborations 2015). The signal in
the timestream from detector ‘A’ is:

t )Ut,

t )Qt + sin(2ΨA

τ A
t = Tt + cos(2ΨA

(23)
where [Tt,Qt,Ut] are the Stokes parameters of the beam con-
volved sky signal for timestream sample t. A timestream con-
sists of nt time ordered measurements of the sky, t = 1...nt.
ΨA is the angle the ‘A’ antenna makes with the Q,U axis on
the sky. For the HEALPix polarization convention, this axis
is a vector pointing towards the north celestial pole.

The relative gain normalized ‘A’ timestream is summed and
differenced with the normalized timestream from its orthogo-
nal partner ‘B’:

st =

dt =

1
2
1
2

(τ A

t + τ B

t ) = Tt + α+

t Qt + β+

t Ut

(τ A

t − τ B

t ) = α−

t Qt + β−

t Ut.

The variables α and β are deﬁned by:

(cid:2)cos(2ΨA
(cid:2)sin(2ΨA

t ≡ 1
α±
2
t ≡ 1
β±
2

t )(cid:3)
t )(cid:3) ,

t )± cos(2ΨB

t )± sin(2ΨB

(24)

(25)

where ΨB is the angle the ‘B’ antenna makes with the Q,U
axis on the sky. Assuming that ‘A’ and ‘B’ are perfectly co-
pointed and orthogonal, the signal portion of the timestream

vectors can be described with a transformation, At j, from the
input map pixel (with index j) to the timestream sample (with
index t):

st = At jTj
dt = α−

t At jQ j + β−

t At jUj.

(26)

The signal-plus-noise timestreams, in vector notation, are:

s =

d =

1
2
1
2

(nA + nB) + A[T]

(nA − nB) +(cid:2)α− β−(cid:3)(cid:20)A 0

0 A

(cid:21)

(cid:21)(cid:20)Q

U

.

(27)

(28)

where nA and nB are the time ordered noise components of
detector ‘A’ and detector ‘B,’ assuming the noise is uncorre-
lated with the pointing of the detector pair. For signal only
simulations, nA and nB can be ignored.

The matrix(cid:2)α− β−(cid:3) contains the information about the ori-

entation of a pair’s antennas relative to Q and U deﬁned on the
sky. We call it the detector orientation matrix. The combina-
tion:

(cid:2)α− β−(cid:3)(cid:20)A 0

(cid:21)

0 A

(cid:2)α− β−(cid:3) is constructed from two diagonal matrices, α− and

transforms input Q,U maps into a pair difference timestream.

β−, which are ﬁlled with the sine and cosine of the detector
orientations at each time sample. A graphical representation
of the detector orientation matrix is shown in Figure 1. (Ad-
ditional steps accounting for polarization efﬁciency and pair
non-orthogonality are absorbed into a normalization correc-
tion to the pair difference timestream.)

(29)

FIG. 1.— Detector orientation matrix,(cid:2)α− β−(cid:3). The matrix is only ﬁlled

on the diagonals of the two sub-blocks, α and β.

4.4. Timestream forming matrix, A

The matrix A = At j represents the timestream forming
matrix for a detector pair.
It transforms the input temper-
ature map, Tj, into the signal component of the pair sum
timestream, st. A graphical representation of the timestream
forming matrix is shown in Figure 2.

To create timestreams with smooth transitions at pixel
boundary crossings, the input maps should have a resolution
higher than the spatial band limit imposed by the beam func-
tion. For this reason, Nside=512 HEALPix maps are used,
whose pixels have a Nyquist frequency (cid:38) 2× the band limit
of the BICEP2 and Keck Array 150 GHz beam function.

The current BICEP2 and Keck Array CMB observations
fall within the region of sky bounded in right ascension by
−3h40m < α < 3h40m and in declination by −70◦ < δ < −45◦.

ntntntnt6

This region contains np = 111,593 pixels in an Nside=512
HEALPix map. The number of samples in a scanset is typi-
cally nt ≈ 43,000.
The simplest form of A performs nearest neighbor interpo-
lation of the HEALPix maps, in which case A is (nt ×np) and
is ﬁlled with ones where the detector pair is pointed and zeros
otherwise.
A more sophisticated form of A performs Taylor interpola-
tion on the HEALPix map, in which case A is (nt × λ(λ+1)
np),
where λ is the order of the Taylor polynomial used in inter-
polation. In this case, A is a matrix that performs Taylor in-
terpolation, allowing sub-pixel accuracy to be recovered from
the input map, and m must also contain derivatives of the true
sky temperature and polarization ﬁeld. This matrix is used
to build the deprojection templates in Section 4.10 but is not
used for forming timestreams because it increases the dimen-
sions of the observation matrix, making the computation of
the observation matrix more difﬁcult.

2

FIG. 2.— Timestream forming matrix, A: ﬁlled elements of the matrix that
takes HEALPix maps to timestreams. This matrix contains the pointing of
a single detector pair over one scanset within a Nside=512 HEALPix map.
The pattern of the ﬁlled elements is determined by the particular HEALPix
pixel indexing scheme. There are nt ﬁlled entries, consisting of a 1 for each
timestream sample. Note that although the above image appears to have mul-
tiple pointing locations for a single timestream sample, nt, this is merely a
result of limited resolution in the image. The timestream forming matrix
contains only one HEALPix pixel location for each time sample.

4.5. Polynomial ﬁltering matrix, F

To remove low frequency atmospheric noise from the data,
a third order polynomial is ﬁt and subtracted from each half-
scan in the timestreams. Since each halfscan traces an approx-
imately constant elevation trajectory across the target ﬁeld,
the polynomial ﬁlter removes power only in the right ascen-
In multipole, l, the third order
sion direction of the maps.
polynomial ﬁlter typically rolls off power below l < 40. This
can be represented by a ‘ﬁltering matrix,’ F, which is block
diagonal with the block size being the temporal length of a
halfscan. Each block is composed of a matrix:

F = I − V(V(cid:62)V)−1V(cid:62),

(30)
where I is the identity matrix and V is the same third order
Vandermonde matrix for each halfscan of equal length. The
Vandermonde matrix is deﬁned as:
Vt j = x j−1

(31)
where j = 4 for a third order ﬁlter and xt are the coordinate
locations.

For BICEP2 and the Keck Array, xt is a vector of the rel-
ative azimuthal location of each sample in the halfscan. A
representation of the polynomial ﬁltering matrix is shown in
Figure 3.

,

t

FIG. 3.— Polynomial ﬁltering matrix, F, showing the ﬁlled elements of the
matrix. The matrix is very sparse and is block diagonal with blocks the size
of a halfscan (≈ 404 samples).

4.6. Scan-synchronous signal removal matrix, G

signal

Scan-synchronous

subtraction removes

in the
timestreams that is ﬁxed relative to the ground rather than
moving with the sky. These azimuthally ﬁxed signals are de-
coupled from signals rotating with the sky by the scan strat-
egy, which observes over a ﬁxed range in azimuth as the sky
slides by (as described in Section 4.2). A template of the mean
azimuthal signal is subtracted from the timestreams for each
scan direction. This procedure can be represented as a matrix
operator, referred to as a ‘scan-synchronous signal matrix.’

The mean azimuthal signal can be found using a matrix
X=Xtt, for which each row is only ﬁlled for entries containing
the same azimuthal pointing as the diagonal entry. The scan-
synchronous signal matrix subtracts off the mean azimuthal
signal:

G = I − X,

(32)
where I is the identity matrix. A graphical representation of
the scan-synchronous signal removal matrix is shown in Fig-
ure 4. Note that while the F matrix is block diagonal and
sparse, and the G matrix is sparse, once the two are combined,
the resulting ﬁlter matrix is neither sparse nor block diagonal,
making matrix operations more computationally demanding.

FIG. 4.— Scan-synchronous signal removal matrix, G, showing the ﬁlled
elements. The scan-synchronous signal matrix is sparse Toeplitz, with off
diagonal components that subtract the average scan-synchronous signal for
one of the two scan directions in a scanset.

4.7. Inverse variance weighting matrices, w±

The timestreams are weighted based on the measured in-
verse variance of each scanset. Pair sum and pair difference
are weighted separately from weights calculated from the two
timestreams, w+ and w−. The scheme assigns lower weight
to particularly noisy channels and periods of bad weather.
This choice of weighting is not a fully “optimal” map maker
(Tegmark 1997), but instead represents a practical solution
that avoids calculating and inverting a large noise covariance
matrix. The weighting is represented by a matrix whose diag-

(cid:1)(cid:2)(cid:1)(cid:3)(cid:1)(cid:2)(cid:1)(cid:2)(cid:1)(cid:2)(cid:1)(cid:2)onal is ﬁlled with the vector w+=w+
for pair difference, shown in Figure 5.

tt for pair sum and w−=w−
tt

Matrix based E/B Separation

7

FIG. 5.— Weighting matrices w±, showing the ﬁlled elements. The weight-
ing matrices are zero except on the diagonal, where they contain the weights
based on the inverse variance of the timestream.

4.8. Filtered signal timestream generation

Ignoring noise and combining all the operators of Sec-
tions 4.5, 4.6 and 4.7, the equations for sum and difference
timestreams (Equation 26) become:

s = w+GFA[T]

d = w−GF(cid:2)α− β−(cid:3)(cid:20)A 0

(cid:21)(cid:20)Q
(cid:21)

0 A

U

(33)

,

the second of which is graphically represented in Figure 6.

FIG. 6.— Matrix generation of simulated timestreams corresponding to

Equation 33.

4.9. Pointing matrix, Λ

The timestream quantities s and d are converted to maps by
the pointing matrix, Λ = Λit. If the pixelization of the input
maps were identical to the output maps, the pointing matrix
would be the transpose of the timestream forming matrix:

Λ = A(cid:62).

As discussed in Section 4.1, the input maps are HEALPix
Nside=512. However, the BICEP maps instead use a simple
rectangular grid of pixels in RA and Dec: the size of the pix-
els is 0.25 degrees in Dec, with the pixel size in RA set to
be equivalent to 0.25 degrees of arc at the mid-declination of
the map, resulting in 236× 100 = 23,600 pixels. If the BICEP
maps are naively used as “ﬂat maps” then projection distor-
tions are inherent. However, note that the A and Λ matrices
together fully encode the mapping from the underlying curved
sky to the observed map pixels, allowing such distortions to
be accounted for. Figure 2 shows A for a single detector over
a scanset and Figure 7 shows Λ for a single detector over a
scanset.

The pointing matrix for a single detector pair can be used

to construct a pair sum ‘pairmap:’

mT = Λs = Λw+GFA[T].

(34)

FIG. 7.— Pointing matrix, Λ: ﬁlled elements of the pointing matrix that
transforms timestreams to an observed map in the BICEP pixelization. This
matrix contains the mapping between the pointing of a single detector pair
over one scanset and the output map pixels. There are 23,600 pixels in a
BICEP map, denoted as ˜np. There are nt ﬁlled entries, consisting of a 1 for
each timestream sample. Each leg of the zigzag pattern corresponds to a
halfsan within the scanset, where the telescope is scanning back and forth at
a ﬁxed elevation.
The pair difference timestream is converted into pairmaps us-
ing two copies of the pointing matrix. The two pair difference
pairmaps correspond to linear combinations of Stokes Q and

U:(cid:20)mα−

(cid:21)

mβ−

=

0 Λ

(cid:21)(cid:20)Q
w−GF(cid:2)α− β−(cid:3)(cid:20)A 0
(cid:21)(cid:20)α−
(cid:20)Λ 0
(cid:21)
(cid:21)
(cid:21)(cid:20)α−
(cid:20)Λ 0
w−GF(cid:2)α− β−(cid:3)(cid:20)A 0
(cid:21)
(cid:21)

0 A

β−

U

0 Λ

β−

0 A

.

P ≡

.

(35)

(36)

For later convenience in abbreviating this equation, we deﬁne:

4.10. Deprojection matrix, D

A potential systematic concerning polarization measure-
ments is the leakage of unpolarized signal into polarized sig-
nal. In the case of CMB polarization, this takes the form of
the relatively bright temperature anisotropy leaking into the
much fainter polarization anisotropy. The leakage is caused
by imperfect differencing between the orthogonal pairs of de-
tectors. The beam functions can be well approximated by el-
liptical Gaussians, the difference of which correspond to gain,
pointing, width and ellipticity.

The BICEP2 and Keck Array pipeline removes leaked tem-
perature signal from the polarization signal using linear re-
gression to ﬁt leakage templates to the polarization data. This
method allows the beam mismatch parameters to be ﬁtted di-
rectly from the CMB data itself, rather than relying on exter-
nal calibration data sets, and is robust to temporal variations
of the beam mismatch.

The templates used in the regression are constructed from
Planck 143 GHz temperature maps4. These maps contain both
CMB and foreground emission at approximately the BICEP2
band. The noise in Planck 143 GHz is signiﬁcantly subdom-
inant to the CMB temperature anisotropy. For a full descrip-
tion and derivation of the deprojection technique, see Aikin
(2013), Sheehy (2013), BICEP1 Collaboration (2014), and
BICEP2 Collaboration III (2015). In this section, the entire
deprojection algorithm is re-cast as a matrix operation.

For the purposes of generating deprojection templates, we
use a timestream forming matrix that performs Taylor expan-
sion around the nearest pixel center to the detector pointing
location. The Taylor interpolating matrix produces higher ﬁ-
delity timestreams than a nearest neighbor matrix. This is im-
portant for the deprojection algorithm since small displace-

4For the Keck Array 95 GHz and 220 GHz bands, we use Planck

100 GHz and 217 GHz maps.

ntnt1(cid:1)(cid:1)(cid:1)(cid:2)(cid:3)(cid:1)(cid:4)8

ments in beam position are responsible for the systematic
effect that is removed. Without Taylor interpolation, pixel
boundary discontinuities introduce noise and limit the effec-
tiveness of deprojection.

A Taylor polynomial of order λ has λ(λ+1)
terms, so the
dimensions of the input map vector for second order interpo-
lation is 1× 6np. Using Equation 21, the input maps are con-
volved with the array averaged beam function. The smoothing
is done using synfast, which contains the ability to output
derivatives of the temperature (and polarization) ﬁeld. Be-
cause the beam is applied ﬁrst, the output derivatives are less
noisy than they would be in the raw maps.

2

The maps are of the form:

 ,



T
(cid:126)∇θT
(cid:126)∇φT
(cid:126)∇θθT
(cid:126)∇φφT
(cid:126)∇θφT

Θ =

(37)

(cid:105)

tude.

(cid:104)

A(cid:48) =

where θ and φ are the HEALPix map’s latitude and longi-

Using the temperature map and its derivatives, we can ﬁnd
the Taylor interpolated temperature timestream by replacing
A with a Taylor interpolating matrix, A(cid:48):

A A∆θ A∆φ A ∆θ2

2 A ∆φ2

2 A∆θ∆φ

,

(38)

where ∆θ and ∆φ are diagonal matrices giving the differ-
ence between the detector pair’s pointing and the nearest
HEALPix pixel center.

A differential beam generating operator is applied to the
timestreams to create differential beam timestreams. For ex-
ample, the differential gain timestream is just the beam con-
volved temperature ﬁeld:

dδg = δgA(cid:48)Θ,

(39)
where the ﬁt coefﬁcient for the gain mismatch is δg. The dif-
ferential pointing components are found from the ﬁrst deriva-
tives of the temperature ﬁeld with respect to the focal plane
coordinates, x and y:

dδx = δx (cid:126)∇xA(cid:48)Θ
dδy = δy (cid:126)∇yA(cid:48)Θ,

(40)
(41)
where δx and δy are the differential beam coefﬁcients and (cid:126)∇x
and (cid:126)∇y are partial differential operators with respect to the
focal plane coordinates. Further details of this calculation
and derivations for other beam modes are discussed in Ap-
pendix C of BICEP2 Collaboration III (2015).

The differential beam timestreams are transformed into
maps analogously to Equation 35, creating a pairmap tem-
plate, ˜T , for each differential beam mode, j. The template
pairmaps for each scanset, S, are then coadded over phases.
For instance, the template pairmap for differential gain, is ˜T1:
(cid:21)(cid:19)

w−GF(cid:2)α− β−(cid:3)(cid:20)A(cid:48) 0

(cid:18)(cid:20)Λ 0

(cid:21)(cid:20)α−

S∈phase(cid:88)

(cid:21)(cid:20)Θ

(cid:21)

˜T1 =

0 A(cid:48)

Θ

0 Λ

β−

S

.

S
(42)

A matrix performing weighted linear least-squares regression
against real pairmaps produces the ﬁtted coefﬁcients for each
of the differential beam modes, c ≡ [δg, δx, δy, ...]:

(cid:21)

(cid:20)mα−

mβ−

˜T (cid:62)

(W−)−1

,

(43)

(W−)−1 ˜T(cid:17)−1

(cid:16) ˜T (cid:62)
(cid:21)

c =

(cid:20)mα−

mβ−

where
is the real data pairmap coadded over a phase,
˜T is a vector of pairmap templates, and W− is the pair differ-
ence weight map, created from the weight matrix according
to:

W− =

S∈phase(cid:88)
the real data pairmap:(cid:20) ˜mα−

(cid:21)

S

=

˜mβ−

(cid:21)(cid:19)

Λβ−w−Λ(cid:62)

(cid:18)(cid:20)Λα−w−Λ(cid:62)
(cid:20)mα−

(cid:21)

− ˜T c.

mβ−

The pairmap templates weighted by c are then subtracted from

.

S

(44)

(45)

This process takes the form of a matrix operator that in-
cludes each of the beam systematics, giving the deprojection
matrix:

(W−)−1 .
Deprojected pairmaps are then found according to:

D ≡ I − ˜T (cid:16) ˜T (cid:62)
(cid:20) ˜mα−
(cid:21)

(W−)−1 ˜T(cid:17)−1
S∈phase(cid:88)

(46)

(47)

P S

= D

˜T (cid:62)
(cid:21)

(cid:20)Q

U

.

˜mβ−

S

The regression in Equation 43 operates simultaneously over
all the modes to be deprojected. Because the templates for
different modes are not in general orthogonal, the coefﬁcient
for each mode depends on the full set of modes. Therefore,
the subtraction in Equation 46 must include the same mode
list used in the regression in Equation 43. If the regression
included more modes than the subtraction step, the regression
would have extra degrees of freedom. This could result in in-
complete removal of leakage signal. We avoid this possibility
by deferring the regression step until immediately before the
subtraction step, and explicitly using the same mode selection
for both.

As in the standard pipeline, we deproject for each detector
pair, after coadding scanset to phases. To reduce the com-
putational demands, the matrix deprojection pairmaps have
additionally been coadded over scan direction, whereas the
standard pipeline performs regression separately for left go-
ing and right going scans. This is the only difference between
simulations run with the standard pipeline and those calcu-
lated from the observation matrix and leads to a negligible
difference, see Figure 11 and Figure 12.

The deprojection matrix made for a phase is less sparse than
one made for a scanset because over the course of a phase a
particular pair will observe a larger range of elevation than it
would in a scanset. The ﬁlled elements of the matrix D, for
one pair across one phase, is shown in Figure 8.

4.11. Coadding over scansets and detector pairs to the

observation matrix

An observed temperature map, ˜T, can be found by multi-
plying the pair sum pairmaps by the inverse weighting vector

Matrix based E/B Separation

found according to:(cid:20) ˜Q(cid:48)

(cid:21)

=

(cid:20)e f

(cid:21)(cid:88)

f g

P,S

˜U(cid:48)

(cid:21)

(cid:20)Q

U

,

P P,S

9

(53)

where P was deﬁned in Equation 36.

If the sum of P matrices could be inverted, it would be pos-
sible to use this inverse to recover an unbiased estimate of the
original Q and U. However, P is singular because it includes
polynomial ﬁltering and scan-synchronous signal subtraction,
which completely remove some modes that were present in
the original maps. We therefore use instead the matrix de-
ﬁned by the matrix inversion in Equation 52, which does not
include these ﬁltering operations. Even the inversion in Equa-
tion 52 is singular unless the coadded data contains observa-
tions at multiple detector angles, Ψt. Observations at multi-
ple detector orientations are made through deck rotations or
by coadding over receivers in different orientations. As de-
scribed in Section 4.2, deck rotations occur between phases,
so coadding over phases makes the matrix invertible.

Including deprojection, Equation 53 becomes:

(cid:21)

(cid:20) ˜Q(cid:48)

˜U(cid:48)

(cid:20)e f

(cid:21)(cid:88)

(cid:32)

=

f g

S∈phase(cid:88)

D

P S

(cid:33)

(cid:20)Q
(cid:21)

U

.

(54)

P

S

P

This represents the entire Q,U map making process for signal
simulations: from input maps to observed maps, including
ﬁltering operations. It can be summarized as:

(cid:20)R(cid:48)

(cid:21)

(cid:20) ˜Q(cid:48)

˜U(cid:48)

=

QQ R(cid:48)
UQ R(cid:48)
R(cid:48)

QU
UU

(cid:21)(cid:20)Q

(cid:21)

U

.

(55)

4.12. Non-apodized observation matrix

As constructed, the matrix, R(cid:48), contains an apodization
based on the inverse variance of the timestreams, w+ and w−.
We can, however, choose to remove this apodization, produc-
ing maps with equal weight across the ﬁeld in units of µK. We
construct the quantities:

W+ =(cid:88)
(cid:20)e f
(cid:21)(cid:88)

(cid:16)
Λw+Λ(cid:62)(cid:17)
(cid:18)(cid:20)Λα−α−w−Λ(cid:62)

S,P

S,P

,

Λβ−β−w−Λ(cid:62)

f g

S,P

(56)

(57)

(cid:21)(cid:19)

,

S,P

and use these to remove the apodization from the observa-
tion matrix, solving for the non-apodized observation matrix,
R:

RT T =(cid:0)W+(cid:1)−1 R(cid:48)
(cid:20)R(cid:48)
(cid:21)

= (W−)−1

TT

(cid:20)RQQ RQU

RU Q RU U

QQ R(cid:48)
UQ R(cid:48)

QU
UU

R(cid:48)

(cid:21)

(58)

(59)

4.13. Selecting the observation matrix’s apodization

Using the non-apodized observation matrix of Section 4.12,
we can create an observation matix with an arbitrary apodiza-
tion, Z. The matrix R is constructed as follows:

RTT = ZRT T

(60)

FIG. 8.— Deprojection matrix, D: ﬁlled elements of the deprojection matrix
for one pair, for one phase of data. The overall dimensions are 2˜np × 2˜np,
twice the number of pixels in a BICEP map.

and summing temporally over scansets (S) and over detector
pairs (P):

Λw+GFA[T].

(48)

˜T =(cid:88)

P,S

The matrix performing this transformation is deﬁned as R(cid:48)

TT.
The transformation from pair difference pairmaps to Q,U
maps depends on the detector orientations during the obser-
vations. This transformation relies on an inversion of a 2× 2
detector orientation matrix. We will now derive the matrix
that performs this transformation.

Ignoring ﬁltering, the pair difference timestream is found

using the timestream forming matrix, At j:

dt =

1
2

(τ A

t ) = α−

t − τ B
combinations of

t At jQ j + β−

t At jUj.

(49)

the pair difference

Forming linear

timestream,(cid:20)α−

t dt
β−
t dt

(cid:21)

(cid:20)α−

=

t α−
t β−
α−

t At j α−
t At j β−

t β−
t β−

t At j
t At j

(cid:21)(cid:20)Q j

(cid:21)

Uj

,

(50)

and applying the pointing matrix, Λ, the vectors α−d and
β−d are binned into map pixels, i. At this point we coadd
over scansets and detector pairs, and apply a weighting, w−,
equal to the inverse of the variance of the timestreams during

(cid:20)Λitw−
a scanset:(cid:88)

t α−
t dt
t β−
t dt

Λitw−

=

(cid:21)

(cid:32)(cid:88)

P,S

(cid:20)Λitw−

Λitw−

P,S

(cid:20)ei

(cid:21)

(cid:32)(cid:88)

(cid:20)Λitwt

fi
fi gi

≡

P,S

t α−
t α−

t α−
t β−

t At j Λitw−
t At j Λitw−

t α−
t β−

t β−
t β−

t At j
t At j

(cid:21)(cid:33)(cid:20)Q j

Uj

(cid:21)

.

W− =

(51)
We invert the matrix on the right hand side of Equation 51

to compute a matrix that generates Q and U maps:

(cid:21)(cid:33)−1

−α−
t α−

t α−
t β−

t Λti Λitw−
t Λti Λitw−

t α−
t β−

t β−
t β−

t Λti
t Λti

Λitw−

, (52)

where the t index has been summed over to ﬁnd each of the
elements in the 2× 2 matrix on the right hand side and A j has
been replaced by Λti so the equation now determines the Q,U
values in the observed map, Qi,Ui. There is one 2× 2 matrix
inversion performed for each pixel, i, in the observed map. In
other words, one value of e, f , and g is computed for each
pixel in the observed map.

The pairmaps ˜mα− and ˜mβ− are transformed into Stokes
. Observed Q,U maps are

Q,U by multiplying by

(cid:20)e f

(cid:21)

f g

˜np˜np˜np˜np110

(cid:20)RQQ RQU

RUQ RUU

(cid:21)

=

(cid:20)Z 0

0 Z

(cid:21)(cid:20)RQQ RQU

RU Q RU U

(cid:21)

(61)

largely sparse, as shown in Figure 9.

A sensible choice for the apodization, Z, may be the inverse
variance mask we removed in Section 4.12, or a smoothed
version thereof. However, there is freedom to choose any
apodization at this point, and this may prove useful in joint
analyses with other experiments, where the analysis combines
maps with low noise regions in slightly different regions of the
sky.

4.14. Summary

We have constructed a matrix, R, which performs the lin-
ear operations of polynomial ﬁltering, scan-synchronous sig-
nal subtraction, deprojection, weighting and pointing. R has
dimensions (3˜np,3np) where ˜np is the number of pixels in
the BICEP map and np is the number of pixels in the input
HEALPix map.

Using the observation matrix, the entire process of generat-

ing a signal simulation from an input map is:

 =

 RTT

 ˜T

˜Q
˜U

T

 .

Q
U

0

0
0 RQQ RQU
0 RUQ RUU

(62)

Here the off diagonal terms, RQU and RUQ, exist because
the ﬁltering operations are performed on pair difference
timestreams, which are a combination of Q and U.

The deprojection operator contains regression against a
temperature map that must be chosen before constructing the
observation matrix. The deprojection operator is a linear ﬁl-
tering operation, and it only removes beam systematics aris-
ing from one particular temperature ﬁeld. One could in princi-
ple apply the deprojection operator to Q,U maps correspond-
ing to a different temperature ﬁeld. The operator would re-
move the same modes from the polarization ﬁeld, but these
modes would not correspond to those which had been mixed
between T and Q,U by beam systematics (or T E correlation).
When constructing an ensemble of E-mode realizations for
use in Monte Carlo power spectrum analysis, the T E corre-
lation and the ﬁxed temperature sky force us to build con-
strained realizations. The ensemble of simulations all contain
identical temperature ﬁelds, so we cannot use them for anal-
ysis of temperature, which is acceptable because the focus of
our analysis is polarization. The ensemble does contain differ-
ent realizations of Q,U, constrained for the given temperature
ﬁeld, and these can be used in Monte Carlo analysis of po-
larization. The details of constructing these constrained input
maps is the subject of Appendix A.

Because the construction of RQQ, RQU, and RUU depends
on a ﬁxed temperature ﬁeld, the deprojection templates can
be thought of as numerical constants. RTT performs a sepa-
rate ﬁltering on the temperature ﬁeld that is largely decoupled
from the ﬁltering of Q and U. To include systematics that leak
temperature to polarization, the terms RTQ and RTU would in
principle need to be non zero. However, so long as the leak-
age corresponded to modes being removed by the deprojec-
tion matrix D the the deprojection elements in the RQQ, RQU,
and RUU blocks would ensure that the output Q,U maps were
identical.

Although the nominal dimensions of R are large, our con-
stant elevation scan strategy means that R is only ﬁlled for
pixels at roughly the same declination. This means that R is

FIG. 9.— Observation matrix, R: ﬁlled elements of the observation matrix
for the BICEP2 3-year data set. T Q, TU, UT , and QT are empty because no
T→P leakage is simulated. The horizontal axis corresponds to the HEALPix
pixelization and has 3×111,593 elements. The vertical axis corresponds to
the BICEP pixelization, and has 3×23,600 elements. The matrix has only
∼5% of its elements ﬁlled.

Some intuition about the operations the observation matrix
performs can be gained by plotting a column of the matrix re-
shaped as a maps—see Figure 10. The column chosen in this
case corresponds to a Q pixel in the observed map. It shows
how that Q value in the observed map is sourced from Q and
U in the HEALPix map. The bright pixel in the Q observed
map corresponds to the location of the input Q. The effects of
polynomial and scan-synchronous signal subtraction are vis-
ible to the left and right of the bright Q pixel. These two
types of ﬁltering are performed on scansets and are therefore
conﬁned to a row of pixels. Deprojection operates on phases,
creating the effects seen at other declinations. Because all
of these ﬁltering operations are performed on pair difference
data, which contains linear combinations of Q and U, signal
in the observed Q map can be created by signal in the input
HEALPix U map. This is why the U map in Figure 10 is
non-zero.

FIG. 10.— A single column of the observation matrix R, for an observed Q
pixel near the center of our ﬁeld. The value of a single Q pixel are affected
by values on the sky of both Q and U over the range of declinations covered
in a phase.

4.15. Forming maps from real timestreams

QUDeclination [deg]Right ascension [deg]  −50050−60−58−56−54asinh(µK)−4−3−2−101234Matrix based E/B Separation

11

We can form observed maps from the real timestreams us-

ing the matrices constructed above:

˜Treal = Z(cid:0)W+(cid:1)−1(cid:88)
(cid:0)Λw+GFs(cid:1)
(cid:21)
(cid:20)e f
(cid:21)
(cid:20)Z 0
(cid:21)(cid:19)
w−GF(cid:2)α− β−(cid:3)(cid:20)d
(cid:21)
(cid:21)(cid:20)α−
(cid:18)(cid:20)Λ 0
(cid:88)

(W−)−1

0 Z

f g

×

P,S

P,S

0 Λ

β−

P,S

d

P,S

(63)

.

(64)

(cid:21)

(cid:20) ˜Qreal

˜Ureal

=

It is important to note that the exact same matrices are used to
process the real data in Equation 64 as are used to construct
the simulated maps in Equation 35.

4.16. Equivalence of observation matrix with standard

pipeline

The matrix formalism described above is self-contained and
complete in the sense that it contains the tools necessary to
create real data maps and simulated maps.

We demand that the map making and ﬁltering operations be
identical between the standard pipeline and the observation
matrix. It is straightforward to test this equivalence: simu-
lated maps run through the standard pipeline must be identical
to the maps found with the observation matrix. Figure 11 and
Figure 12 show that the two match quite well, within a few
percent over the multipoles of 50 < l < 350. The lack of a per-
fect match is due to the difference in deprojection timescale
and because the standard pipeline uses Nside=2048 HEALPix
input maps that are Taylor interpolated, whereas the observa-
tion matrix uses Nside=512 input HEALPix maps with nearest
neighbor interpolation.

5. SIGNAL COVARIANCE MATRIX, C

The signal covariance matrix contains the pixel-pixel co-
variances of a map for a given spectrum of Gaussian ﬂuctua-
tions. The diagonal entries contain the variance of each pixel,
and each row describes the covariance of a given pixel with
the other pixels in the map. For [T,Q,U] maps, the covari-
ance matrix contains nine sub-matrices for the correlations
between T ,Q, and U.

5.1. True sky signal covariance matrix

A pixel on the sky at location i, has values of the Stokes

parameters:

 .

 Ti

Qi
Ui

xi ≡

The 3×3 pixel-pixel covariance between two locations on the
sky, i and j, is given by:

Ci, j ≡ (cid:104)xix j(cid:105) = R(α)M(ri · r j)R(α)(cid:62).

(66)
The covariance matrix, M, is deﬁned with the Q,U convention
referenced to the great circle connecting the two points, i, j.
For a particular spectrum M depends only on the dot product
between the pixels, ri · r j. M contains nine symmetric sub-
matrices:

 (cid:104)TiTj(cid:105)

(cid:104)TiQ j(cid:105)

(cid:104)TiUj(cid:105)
(cid:104)QiTj(cid:105) (cid:104)QiQ j(cid:105) (cid:104)QiUj(cid:105)
(cid:104)UiTj(cid:105) (cid:104)UiQ j(cid:105) (cid:104)UiUj(cid:105)



M(ri · r j) =

(65)

(67)

FIG. 11.— Comparison of observed Q maps created by the observation
matrix and the standard pipeline. The input map for both is from the same
simulation realization. There are small differences due the difference in de-
projection timescales, input HEALPix map resolution, and interpolation.

FIG. 12.— Comparison of power spectra of maps created by the observation
matrix and the standard pipeline. The input map for both is from the same
simulation realization, which differs from the theory curve for this particular
realization in the BICEP ﬁeld. The two methods are fractionally the same to
within a few percent over the multipoles of interest, 50 < l < 350.
The 3× 3 matrix, R, is applied to rotate from this local ref-
erence frame to a global frame where Q,U are referenced to
the North-South meridians. The angle between the great cir-
cle connecting any two points and the global frame is given

Standard Pipeline  µK−3−2−10123Observation Matrix  µK−3−2−10123Difference  −50050−65−60−55−50µK−0.500.50246l(l+1)CEEl / 2π050100150200250300350−0.100.1Multipole ,  l00.0020.0040.0060.008l(l+1)CBBl / 2π  TheoryStandard PipelineObservation MatrixFractional diff050100150200250300350−0.100.1Multipole ,  l12

by the parameter α.

R(α) =

 1

0

0

0 cos2α sin2α
0 −sin2α cos2α



(68)

Changing the sign of α allows us to change the polarization
convention from IAU to HEALPix (U to −U), see Hamaker &
Bregman (1996). We have chosen to use the IAU convention
for BICEP2 and Keck Array covariance matrices.

The true sky pixel-pixel signal covariance matrix for the
Stokes Q,U parameters is derived in Kamionkowski et al.
(1997); Zaldarriaga (1998). To calculate the covariances, we
follow some of the suggestions in Appendix A of Tegmark &
de Oliveira-Costa (2001).

We use the HEALPix ring pixelization, which allows the
covariance to be calculated simultaneously for all pixels at a
particular latitude that are separated by the same distance.5
This shortcut is exploited by simultaneously calculating all
equidistant pixels for rows in the map that have the same lat-
itude to within 1× 10−4 degrees. This approximation is much
smaller than the ∼7 arcminute pixels in Nside=512 maps, and
the rounding error has been found to be insigniﬁcant.
5.2. Observed signal covariance matrix, ˜C

The observed signal covariance matrix contains the pixel-
pixel covariance in the observed BICEP pixelized maps. The-
oretically, modifying the true sky signal covariance matrix is
simple: take the unobserved signal covariance of C of Section
5.1 and the observation matrix R from Section 4 and form the
product:

˜C = RCR(cid:62).

(69)
This equation results in a symmetric positive deﬁnite matrix,
which is rank deﬁcient because of the ﬁltering steps in the
observing process.

Unfortunately, performing this multiplication is computa-
tionally demanding: The input C is a square matrix, with
3×111,593 elements on a side, corresponding to the elements
of T , Q, and U. To reduce the memory requirements of the
calculation, we divide the covariance matrix, C, into row sub-
sets and calculate in parallel. Once a row subset is calculated,
the observation matrix is immediately applied to transform the
HEALPix covariance to the observed map covariance, which
reduces the dimensions of the covariance to the 23,600 pixels
of the observed maps.

The covariance and observed covariance should both be
symmetric, which provides a good check on our math.
Usually the output is slightly (fractionally, ∼ 1/10−7) non-
symmetric due to rounding errors in the multiplication, and
we force the ﬁnal matrix to be symmetric to numerical pre-
cision by averaging across the diagonal before moving to the
next steps, since symmetric matrices often allow the use of
faster algorithms.

A row of the observed covariance matrix can be reshaped
into a map, which reveals the structure of the covariance for a
particular pixel, see Figure 13.

6. E/B SEPARATION USING A PURIFICATION MATRIX

The observed covariance matrix contains expected pixel-
pixel covariance in our observed maps given an initial spec-
trum. The observation matrix, R, has made the E and B-mode

5This quality of the HEALPix maps is by design, see Gorski et al.

(2005).

FIG. 13.— Maps showing a row of the observed covariance matrix ˜C. The
row selected corresponds to the covariance of an individual Q pixel at the
center of the map. The top row shows the covariance used to calculate the
pure E and B-modes described in Section 6. The bottom row shows the co-
variance for an input spectrum corresponding to ΛCDM [left], and r = 0.2
tensors [right].

spaces of the observed covariance non-orthogonal. The result
of Section 3 is that we can ﬁnd the orthogonal pure E and
pure B spaces by solving the eigenvalue problem from Equa-
tion 17: ˜CBxi = λi ˜CExi.

6.1. Construction of puriﬁcation matrix

As written, Equation 17 is not solvable: ˜CB has a null space
that is the set of pure E-modes. Similarly, the space of pure
B-modes is the null space of ˜CE. By adding the identity ma-
trix multiplied by a constant, σ2I, to the covariance matrices
we regularize the problem to ﬁnd approximate solutions and
eliminate the null spaces:

( ˜CB + σ2I)xi = λi( ˜CE + σ2I)xi.

(70)
The amplitude of σ2 sets the relative magnitude of the am-
biguous mode eigenvalues versus the pure E and pure B-mode
eigenvalues. The eigenvalues are shown in Figure 14. In our
analysis, we choose σ2 to be 1/100th the mean of the diagonal
elements of the covariance matrices, ˜CE and ˜CB.
In Equation 70, ˜CE is an observed covariance matrix for
[Q,U] whose input spectrum contains only CEE
l with a 1/l2
˜CB is the same except for an input spectra
red spectrum.
with only B-modes. The eigenmodes in xi with the largest
eigenvalues compromise a set of vectors that span a space of
pure B-modes, bi. The pure B quality of these vectors can be
seen in the fact that the product ˜CEx is much smaller than the
product ˜CBx. The eigenmodes in xi with the smallest eigen-
values compromise a set of vectors that span a space of pure
E-modes, ei.

Using the reddened input spectrum 1/l2 causes the mag-
nitude of the eigenvalues to be proportional to the band of
multipole, l, that each mode contains. The steepness of the
spectrum ensures each mode contains power from a limited
range of l. The particular choice of 1/l2 is arbitrary. A basis
constructed from eigenmodes up to some cutoff in λi spans
the space of pure B up to the l of the cutoff eigenmode. We
arbitrarily choose the cutoff, k, to be 1/4 the number of [Q,U]
pixels and have found modes contained in this set adequate for
preserving power up to l ∼700. Figure 15 shows four eigen-
modes of the BICEP2 observed covariance.

1/l2 E1/l2 BRight Ascension [deg]ΛCDM−50050−65−60−55−50r = 0.2−50050Matrix based E/B Separation

FIG. 14.— The generalized eigenvalues for the BICEP2 observed covari-
ance matrix, sorted by magnitude. Eigenvectors corresponding to small
eigenvalues are E-modes in the observed space, large eigenvalues corre-
spond to B-modes. Eigenvalues near one correspond to ambiguous modes:
the modes that are simultaneously E and B in the observed space, and must
be thrown out. By selecting the eigenmodes corresponding to eigenvalues
with an absolute value larger than some arbitrary cutoff (dashed red line), k,
we can construct a space that spans the space of E or B-modes that can be
effectively observed using our scan strategy and analysis.

Using the set of pure E and pure B-mode basis vectors, two
projection matrices are constructed from the outer products:

ΠE =(cid:88)
ΠB =(cid:88)

i

(cid:62)

eiei

bibi

(cid:62),

(71)

i

which we call the puriﬁcation matrices for pure E and pure B.
Operating the puriﬁcation matrices on an input map projects
onto the space of pure E and pure B:
˜mpureE = ΠE ˜m
˜mpureB = ΠB ˜m.

(72)
From the construction of the pure B basis, bi, one can see
that the vector ˜mpureB vanishes for arbitrary input containing
lm, as desired for a puriﬁed B

only E-modes: ˜m = R·(cid:80)aE

lmYE

map.

7. MATRIX E/B SEPARATION APPLIED TO BICEP2

This section describes the application of the matrix based
E/B separation to the BICEP2 data set. The technique re-
lies on the existence of the observation matrix and puriﬁcation
matrix from the previous sections.

7.1. Motivation for matrix based E/B separation in BICEP2
The BICEP2 and Keck Array analysis pipeline contains the
following attributes that can leak E-modes to B-modes: par-
tial sky coverage, timestream ﬁltering (including deprojec-
tion), and choice of map projection+estimator. A simulation
demonstrating the leaked B-mode maps for each of these ef-
fects is shown in Figure 16. These maps are created by apply-
ing the standard E and B estimator in Fourier space and then
an inversion back to map space. The observations and data
reduction produce three classes of E/B leakage:

13
• Apodization: The ﬁrst obvious deviation from the ideal
full sky map is the partial sky coverage of BICEP2
and Keck Array maps. Once a boundary is imposed
E/B leakage is created. Map boundary effects are
reduced by an apodization window which tapers the
maps smoothly to zero near the edges. Use of apodiza-
tion windows is common practice in any Fourier trans-
form analysis of ﬁnite regions to prevent ‘ringing’ near
boundaries. For small regions of sky, effects of the
map boundary dominate the leakage even after apodiza-
tion is applied. The apodization window used in BI-
CEP2 and the Keck Array are modiﬁed inverse variance
maps. We apply a smoothing Gaussian with a width
of σ = 0.5◦ to the inverse variance map, and, for the
combined analyses of BICEP2 and the Keck Array, we
use a geometric mean of the individual experiments’
apodization maps.

• Map projection: The total extent of the BICEP2 and
Keck Array maps is about 50 degrees on the sky in the
direction of RA, over a declination of −70 < δ < 45.
The chosen projection is a simple rectangular grid of
pixels in RA and Dec. Taking standard discrete Fourier
transforms of such maps results in signiﬁcant E/B leak-
age. While we note that other map projections will
have signiﬁcantly lower distortion, such effects will be
present for all projections when subjected to Fourier
transform. However, note that the A and Λ matrices
together fully encode the mapping from the underlying
curved sky to the ﬂat sky of the observed map pixels,
and therefore so does the observing matrix R derived
from these.

• Linear ﬁltering effects: There are three main ana-
lytic ﬁlters applied in the standard pipeline: polynomial
ﬁlter, scan-synchronous subtraction, and deprojection.
With respect to E to B leakage, all three ﬁlters are sim-
ilar: by removing modes in the Q,U maps, an E-mode
can be turned into an observed B-mode. Polynomial ﬁl-
tering and scan-synchronous signal subtraction create
comparable leakage, both in amplitude and morphol-
ogy. Deprojection creates more power in the leaked B
maps, and at smaller angular scales, than either polyno-
mial ﬁltering or scan-synchronous signal subtraction.

If matrix puriﬁcation is not used, the sample variance of
E/B leakage in the BICEP2 BB power spectrum is compara-
ble to the uncertainty due to instrumental noise. This is clearly
highly undesirable, and led to the development of the puriﬁ-
cation matrix described in this paper. The puriﬁcation matrix
‘knows about’ all of the E/B mixing effects and how to deal
with them.

7.2. Effectiveness of puriﬁcation matrix

The effectiveness of the puriﬁcation matrix given by Equa-
tion 72 can be immediately tested by applying the operator to
a vector of [Q,U] maps simulated with the standard pipeline.
The upper left map of Figure 17 shows an observed map
whose input is unlensed-ΛCDM E-modes, and the next two
rows in that column show the resulting E and B maps after
projection onto the pure E and B spaces. The right column of
Figure 17 shows an observed input map with both unlensed-
ΛCDM and r=0.1 projected onto pure E and B-modes.

Matrix puriﬁcation is integrated with the existing BICEP
analysis code by applying the puriﬁcation operator to maps

0500010000150002000025000300000.00010.0010.010.1110100100010000Eigenmode sorted by eigenvalueEigenvalueEmodesAmbiguousBmodes14

FIG. 15.— Eigenmodes of the BICEP2 observed covariance matrix. Shown are the modes corresponding to the largest and 50th largest eigenvalues of Equation
70. Colormap shows amplitude of E and B-modes. The eigenvalues are shown graphically in Figure 14.

FIG. 16.— E to B leakage maps: examples of leaked B-modes in the BICEP2 maps. Top row, left: Leaked B-modes due to map projection and apodization. Top
row, right: Leaked B-modes due to third order polynomial subtraction. Bottom row, left: Leaked B-modes due to scan-synchronous signal subtraction. Bottom
row, right: Leaked B-modes due to deprojection of beam systematics.

EB1st EigenmodesRight Ascension [deg]Declination [deg]−50050−65−60−55−50−5005050th Eigenmodes0.5µKProjection + Apodization0.3µKThird order polynomial filterRight Ascension [deg]Declination [deg]0.3µKScan−synchronous subtraction−50050−65−60−55−500.4µKDeprojectionMatrix based E/B Separation

15

FIG. 17.— Polarization maps showing the effectiveness of the BICEP2 puriﬁcation matrix at separating noiseless simulations into pure E and pure B. Left
column: on a scalar only unlensed-ΛCDM BICEP2 simulation. Right Column: on the same simulation with the addition of a small tensor component. Top Row:
the total polarization of the BICEP2 observed map, containing E and ambiguous modes. Center Row: pure E-mode map, constructed by projecting the total
polarization map onto the E eigenmodes found in Equation 70. Bottom Row: pure B-mode map, constructed by projecting the total polarization map onto the B
eigenmodes of Equation 70.
before calculating the power spectra. Since the observation
matrix is only used for this puriﬁcation step, the puriﬁcation
matrix need only work well enough to result in E/B leak-
age less than the noise level of the experiment. Therefore, it
is acceptable to use an approximate observation matrix con-
structed from a subset of the full observation list, as long as
it is representative of the full scan strategy. This shortcut
was employed in Keck Array and BICEP2 Collaborations V
(2015), but the results shown in this section from BICEP2 are
from the full set of observations.

Figure 18 compares the spectra for puriﬁed maps to the
spectra from maps without puriﬁcation, and to the spec-
tra found using the improved estimator suggested in Smith
(2006). Both the puriﬁed maps and unpuriﬁed maps use
the standard E and B estimator in Fourier space, and we re-
fer to the unpuriﬁed maps processed this way as the ‘nor-
mal method.’ Figure 18 shows the spectra for 200 noiseless
unlensed-ΛCDM simulations passed through the three esti-
mators. The leaked power is roughly three orders of magni-
tudes smaller when using the matrix puriﬁcation than when
using the normal method or Smith estimator. The mean of
the leaked power is de-biased from the ﬁnal power spectra, so
what matters is the variance of the leaked spectra. Computing
the 95% conﬁdence limits based on the variance in each of the
three methods, we ﬁnd that in the absence of B-mode signal
or instrumental noise, the matrix estimator achieves a limit on

FIG. 18.— BB power spectra of noiseless unlensed-ΛCDM (r = 0) simu-
lations, estimated using various methods, demonstrating the effectiveness of
the BICEP2 puriﬁcation matrix. The E/B leakage using the matrix estimator
is 3 orders of magnitude lower than other methods.
the tensor-to-scalar ratio of r < 8.3× 10−5, while the normal
method and Smith estimator achieve limits of r < 0.17 and
r < 0.074 respectively.

Figure 19 shows the spectra from the three estimators for in-
put maps containing only input B-modes at the level of r = 0.1.
The spectra for all three estimators show beam roll off at high
l. At the lowest l, the map size prevents large angular scale

5.0µKScalars only5.0µKScalars + tensors (r=0.1)5.0µK5.0µKRight Ascension [deg]Declination [deg]0.3µK−50050−65−60−55−500.3µK−50050µK−505µK−505µK−0.300.3Total Polarizationpure Epure B501001502002503003504004501e−061e−050.00010.0010.010.1Multipole ,  ll(l+1)CBBl / 2π [µK2]  normal: r < 0.17Smith: r < 0.074matrix: r < 8.3x10−5lens+r=0.1normalSmithmatrix16

semble of simulations is used to construct the errorbars in the
ﬁnal spectra. The tighter distribution of the matrix estimator
simulations is a result of the decrease in E/B leakage. Using
the matrix estimator results in an improvement in the r limit,
for BICEP2 noise level and ﬁltering in the absence of B-mode
signal, of about a factor of two over the Smith method. The
remaining variance in the BB spectrum of the matrix estima-
tor is instrumental noise.

FIG. 19.— BB power spectra of noiseless unlensed (r = 0.1) tensor only
simulations, estimated using various methods. All methods suffer from loss
of power due to ﬁltering and beam effects. The removal of ambiguous modes
at low l results in a further decrease in power for the matrix method. Note
that the spectra in this plot have not been corrected for the beam and ﬁlter
suppression factors, but in Figure 18 the correction is applied.

DEGREES OF FREEDOM IN BINNED BB POWER SPECTRA

TABLE 1

FOR DIFFERENT ESTIMATORS

Degrees of Freedom

Bin center, l Normal
37.5
72.5
107.5
142.5
177.5
212.5
247.5
282.5
317.5

12.9
40.9
71.4
83.7
120.6
156.1
172.0
202.8
189.0

Smith
15.5
41.4
69.7
81.2
116.4
153.0
172.9
200.8
185.7

Matrix

8.6
34.8
66.8
81.7
116.9
141.9
145.8
177.4
155.0

modes from being measured. For multipoles around l ∼ 100,
the matrix estimator recovers slightly less signal than the other
two methods. However, the extra power measured by the
other methods near l ∼ 100 largely comes from the ambigu-
ous modes. On the left of Figure 18, these ambiguous modes
are seen as the bump in the normal and Smith method near
l ∼ 100.

The total number of degrees of freedom in each band power

can be estimated according to the formula:

(ml(cid:48))2
σ2
l(cid:48)

,

Nl(cid:48) = 2

(73)
where ml(cid:48) is the mean of the simulations in band power l(cid:48) and
σ2
l(cid:48) is the variance of the simulations in the band power. Table
1 shows the number of degrees of freedom for the three esti-
mators for a tensor B-mode. The fewer degrees of freedom at
low l for the matrix estimator are consistent with the decrease
in recovered power on the left side of Figure 18. The high-
est l bins in Table 1 also show fewer degrees of freedom in
the matrix estimator because the puriﬁcation matrix includes
a limited number of pure eigenmodes, as shown in Figure 14.
Figure 20 shows signal plus noise spectra for a set of 200
unlensed-ΛCDM+noise spectra. The noise simulations are
the standard BICEP2 sign ﬂip realizations discussed in BI-
CEP2 Collaboration I (2014). In Figure 20, the mean noise
level and leaked BB power are de-biased. The resulting en-

FIG. 20.— BB power spectra of unlensed-ΛCDM (r = 0) + BICEP2 noise
simulations, estimated using various methods, demonstrating the effective-
ness of the BICEP2 puriﬁcation matrix. For BICEP2 noise levels the con-
straint on r (in the absence of signal) is improved by about a factor of two.
(The mean of the noise and leakage have been de-biased in each case.)

7.3. Transfer functions

The observation matrix transforms an input HEALPix map
into an observed map with a simple matrix multiplication.
The speed of the operation facilitates the calculation of anal-
ysis transfer functions, which are a necessary component of
the pseudo-Cl MASTER algorithm (Hivon et al. 2002).

We start with input maps, ml, which are delta functions in
a particular multipole. These maps are then observed using
the matrix R. The spectra calculated from these maps rep-
resent the response in our analysis pipeline to the input delta
function, in a manner conceptually analogous to Green’s func-
tions.

Our procedure uses two sets of HEALPix maps, one set
corresponding to T T = T E = EE = 1 and one set with T T =
BB = 1. The observation matrix is used to create maps for l=1
through 700, with 100 random realizations for each l. Pro-
cessing the 140,000 maps would be infeasible without the ob-
servation matrix, but using the observation matrix it can be
accomplished in a few hours.

7.3.1. Band power window functions

The power spectra of the output maps for a particular l are
averaged over the N = 100 realizations. The averaged spectra
are used to form a band power window function, MXX
ll(cid:48) , for
a particular band power, l(cid:48), which is a function of the input
multipole of the delta function, l:

(cid:80)N
r=1F XX
ll(cid:48) (Rml)
N

MXX

ll(cid:48) =

,

(74)

501001502002503003504004501e−061e−050.00010.0010.01Multipole ,  ll(l+1)CBBl / 2π [µK2]  Input: r=0.1normalSmithmatrix50100150200250300−0.0200.020.040.060.08Multipole ,  ll(l+1)CBBl / 2π [µK2]  lens+r=0.1normal: r<0.20Smith: r<0.11matrix: r<0.06Matrix based E/B Separation

17

7.4. Computing challenges

TABLE 2

BB BAND POWER WIDTHS

Measured

Nominal
center
37.5
72.5
107.5
142.5
177.5
212.5
247.5
282.5
317.5

low
20.0
55.0
90.0
125.0
160.0
195.0
230.0
265.0
300.0

low
37.0
59.0
92.0
125.0
158.0
189.0
220.0
253.0
285.0

high
54.0
86.0
121.0
157.0
192.0
227.0
262.0
298.0
333.0

high
55.0
90.0
125.0
160.0
195.0
230.0
265.0
300.0
335.0

center
46.4
73.4
107.2
140.7
173.7
205.4
237.2
270.2
302.9

Bin Number
1
2
3
4
5
6
7
8
9
NOTE. — Nominal and measured centers and edges of the band power
bins. The measured values are extracted from the band power window func-
tions shown in Figure 21. The low/high values for the latter are the ±1σ
points.
where F ll(cid:48)
is the analysis pipeline’s transformation from
map to power spectra6 and XX = {T T,T E,EE → EE,EE →
BB,BB → BB,BB → EE}. When the input maps contain
E-modes, and we measure the BB spectra, the result is the
EE → BB band power window. The use of the puriﬁcation
matrix prevents leakage and makes these band power win-
dows have much lower amplitude than the EE or BB ones.
In BICEP2, it has been standard procedure not to use the E-
mode puriﬁcation matrix, hence the BB → EE band power
window contains (irrelevant) leakage from B into E.

Calculating the band power window functions in this way
accounts for all aspects of our instrument and analysis: beam
convolution, sky cut, map projection, polynomial ﬁltering,
scan-synchronous signal subtraction, deprojection, and power
spectrum estimation.

Figure 21 shows the results of the calculation. Although we
bin in annular rings of the two dimensional power spectra, the
ﬁltering operations move power from other l into those bins.
This means the band powers are sensitive to a broader range
in l than the nominal range of multipoles. The broad shelf in
the band power window functions at lower l is due to ﬁltering.
Table 2 shows the nominal and measured centers and edges of
the band power bins.

7.3.2. Suppression factor

The integrated area under the curve of each band power
window function represents the response of that band power
measurement to an input spectrum. We call this set of values
the suppression factor, Sl(cid:48), since they approximate how our
analysis pipeline suppresses power.

The suppression factor is plotted in Figure 22. At small an-
gular scales, the suppression factor is dominated by the roll-
off of BICEP2’s 31 arcminute beam. The measured array av-
erage 150 GHz beam function is shown as the dotted line in
Figure 22. The ‘map window function,’ which includes the
ﬁnite size of the map and the pixel window function for the
∼ 0.25 degree pixels, is shown as the dashed line7. At high l,
the pixel window function is sub-dominant to the beam win-
dow function. At low l the suppression factor is dominated by
the timestream ﬁltering effects.

6Including the steps: apply matrix puriﬁcation, two dimensional Fourier
transform, construction of E and B, and binning to one dimensional spectra.
7Calculated according to http://healpix.jpl.nasa.gov/

html/intronode14.htm

Building the observation matrix requires constructing, mul-
tiplying, and ﬁnally averaging a large number of sparse matri-
ces. Applying the observation matrix to the true sky signal co-
variance matrix requires a large matrix multiplication to ﬁnd
the product, RCR(cid:62).

Matrix multiplication is the dominant contributor to compu-
tation time. We use matrix multiplication routines built in to
MATLAB. These routines incorporate a number of optimized
algorithms for computing matrix products, including BLAS
(Lawson et al. 1979). At this time we have not compared the
run time on GPUs with that on CPUs, but are aware of this as
a possible avenue for reducing the compute time.

Solving the eigenvalue problem using the MATLAB func-
tion eig() takes about 48 hrs and 80 GB of RAM for the
full BICEP2 observed covariance. For BICEP2, this is small
fraction of the total computation time. However, for experi-
ments whose maps contain more pixels, the difﬁculty of the
eigenvalue problem increases. In these cases, the use of dis-
tributed memory parallel code may be necessary.

For the BICEP2 results, we used computing resources pro-
vided by the Odyssey cluster at Harvard8. The Odyssey clus-
ter contains 54K CPUs with 190 terabytes of RAM and 10
petabytes of storage. High memory nodes have access to
256GB of RAM, which is useful for large matrix multiplica-
tions. Odyssey uses SLURM9 as its queue manager, allowing
our analysis to utilize the large number of cores available.

Although the raw BICEP2 data set comprises roughly 3 TB
of data, the data products from the steps in the matrix analysis
chain use 17 TB of storage. Processing during the BICEP2
matrix analysis steps required roughly 1 million CPU hours.
This represents a signiﬁcant portion of the total computing
demand of the entire BICEP2 analysis effort, which comprised
roughly 6 million CPU hours.

8. CONCLUSIONS

We have described a method for decomposing an observed
polarization ﬁeld into orthogonal components coming from
celestial E and B-modes. The method relies on numerically
calculating an observation matrix. In our case the observa-
tion matrix encodes the mathematical steps translating the true
sky to an observed map including polynomial ﬁltering, scan-
synchronous subtraction, pointing of individual detectors, and
linear regression of beam systematics.

Applying the observation matrix to pixel-pixel covariance
matrices for E and B-modes transforms the true sky covari-
ance into the observed space. We then solve for the E and
B eigenmodes and select those modes that are orthogonal. In
this way, the orthogonality relationship of the true sky is trans-
lated to the observed maps. The method accounts for all types
of E/B leakage: boundary effects, polynomial ﬁltering, linear
regression, etc.—as long as these properties of the observing
strategy and analysis have been encoded in the observation
matrix.

The observation matrix has many other possibilities and
in principle allows construction of fully optimal analyses
through to power spectra or cosmological parameters for a
single experiment, or a combination of experiments with
partially overlapping sky coverage. One simple application
which we have explored is to use the observation matrix to

8https://rc.fas.harvard.edu/odyssey/
9http://slurm.schedmd.com/

18

FIG. 21.— Band power window functions, MXX
BB → EE panel in the bottom right shows signiﬁcantly more power since matrix puriﬁcation is not applied to E-modes.

ll(cid:48) . Filtering causes mixing of power from low multipoles up to higher multipoles. As noted in Section 7.3.1, the

separating E and B as well and may ﬁnd the technique useful.
Additionally, the ongoing search for the imprint of gravita-
tional waves in CMB polarization will require mitigation of
lensing signal from intervening structure and foreground re-
moval, both of which are improved by cleanly separating E
and B.

BICEP2 was supported by the US National Science
Foundation under grants ANT-0742818 and ANT-1044978
(Caltech/Harvard) and ANT-0742592 and ANT-1110087
(Chicago/Minnesota). The computations in this paper were
run on the Odyssey cluster supported by the FAS Science
Division Research Computing Group at Harvard University.
The analysis effort at Stanford/SLAC is partially supported by
the US Department of Energy Ofﬁce of Science. Tireless ad-
ministrative support was provided by Irene Coyle and Kathy
Deniston.

We thank the staff of the US Antarctic Program and in
particular the South Pole Station without whose help this re-
search would not have been possible. We thank all those who
have contributed efforts to the BICEP/Keck Array series of ex-
periments, including the BICEP1 and BICEP3 teams.

APPENDIX

A. GENERATION OF CONSTRAINED REALIZATION HEALPix

MAPS

An ensemble of signal only simulations is needed for a
MASTER pseudo-Cl analysis. We use CAMB with input Planck
parameters to construct power spectra, Cl. The power spec-
tra are used to generate high resolution HEALPix maps that

FIG. 22.— The BB suppression factor. At high l the beam function domi-
nates. At low l the effects of ﬁltering dominates. The map window function
for the BICEP 0.25 degree square pixels and ﬁnite map size is shown as a
dashed line. The band power window functions are plotted in colors corre-
sponding to individual band powers on a different scale.

directly produce simulated observed maps from input maps
in a single step. This is dramatically faster than the previous
standard pipeline. However production of observing matri-
ces is sufﬁciently costly that we have not generated them for
the many alternate “jackknife” data split maps and so for the
present standard simulations are still required.

We ﬁnd that the matrix based E/B separation performs
quite well, limiting the leakage to a level corresponding to
r < 1× 10−4, well below the noise level for any foreseeable
CMB experiment. The method should prove useful for future
ground based or balloon based experiments focused on mea-
suring large angular scale B-modes. Experiments measuring
the lensing potential using CMB polarization rely on cleanly

01002003004005006007001e−071e−050.0010.1l(l+1)CTTl/2π [µK2]TT01002003004005006007001e−071e−050.0010.1l(l+1)CTEl/2π [µK2]TE01002003004005006007001e−071e−050.0010.1l(l+1)CEEl/2π [µK2]EE  →  EE01002003004005006007001e−071e−050.0010.1l(l+1)CBBl/2π [µK2]BB  →  BB01002003004005006007001e−071e−050.0010.1l(l+1)CBBl/2π [µK2]EE  →  BBMultipole, l01002003004005006007001e−071e−050.0010.1l(l+1)CEEl/2π [µK2]BB  →  EEMultipole, l05010015020025030035000.20.40.60.81Suppression FactorMultipole, l  mapbeamfiltertotal0.010.020.030.04BPWFMatrix based E/B Separation

19

serve as the starting point for each realization of the signal
simulations. Lacking any constraints on the realizations, the
maps generated from the power spectra will vary for both
the temperature and polarization ﬁelds. However, Planck has
measured the temperature ﬁeld of the CMB to high signal to
noise. Since the goal of BICEP2 and the Keck Array is to
measure the polarization sky and not the temperature sky, our
ensemble of simulations does not need to contain variation in
the well measured temperature sky. We therefore use the tem-
perature ﬁeld of the CMB measured by Planck as the template
for constrained realizations of the polarization ﬁeld.

We have developed a technique for creating realizations of
the E-mode sky consistent with the known T E correlation and
the measured temperature ﬁeld. These constrained realiza-
tions have been shown to contain the same T E correlations
and EE spectra over many realizations of the temperature sky.
However, any particular set of constrained realizations based
on one temperature sky has a slightly different distribution of
T E and EE than the full ensemble average.

The primary motivation for ﬁxing the temperature ﬁeld is
to make the deprojection operation discussed in Section 4.10
into a linear operator. Recall that deprojection involves a re-
gression against a ﬁxed template of the temperature sky. If
the temperature sky varies from realization to realization, de-
projection becomes non-linear and cannot be expressed as a
matrix operation.

A.1. T E correlation

We start by ﬁxing the coefﬁcients of the spherical harmon-
ics of the temperature sky, aT
lm. The alm for the constrained
E-modes is found in Dvorkin et al. (2008) and can be derived
following the steps of a simple Cholesky decomposition. The
2× 2 covariance between T and E for each mode (l,m) is:

(A1)
The lower triangle Cholesky decomposition of this 2× 2 ma-
trix determines the variance and covariance in each mode:

CT E

l
l

l
l

.

(cid:20) aT

(cid:21)

(cid:21)(cid:20)nT

(cid:21)

lm
nE
lm

0

l − (CT E

l

)2/CT T

l

=

lm
aE
lm,

(A2)

(cid:20) (cid:112)CT T
l /(cid:112)CT T

CT E

l

l

(cid:20)CT T

(cid:21)

CT E
CEE

(cid:112)CEE
(cid:113)
(cid:113)

(cid:113)

where nT
Since aT
equations:

lm and nE
lm are unit norm, complex random numbers.
lm are known constraints, we can solve the system of

l nT
CT T

lm = aT
lm

CT E
l /

l nT
CT T

lm +

l − (CT E
CEE

l

)2/CT T

l nE

lm = aE
lm,

(A3)

lm in terms of aT

substituting the ﬁrst equation into the second to arrive at an
expression for aE
lm and the power spectra, Cl.
To ensure the maps are real, the condition a∗
lm = (−1m)al−m is
demanded.
lm to have lower
variance in its power spectrum than the unconstrained aE
lm

Naively, we might expect the constrained aE

since there is signiﬁcant T E correlation and the temperature
component is ﬁxed. However, this is not necessarily the case.
When the aT
lm ﬂuctuate high, the mean of the constrained en-
semble of aE
lm’s is also high, resulting in increased variance in
the ensemble of simulations. For particularly high aT
lm, this
can result in larger variance for the constrained simulations
than the unconstrained simulations. This happens to be the
case in the BICEP ﬁeld near l = 150, as seen in Figure 23.

In practice, we take the aT

lm from the Planck temperature
Needlet Internal Linear Combination (NILC) map (Planck
Collaboration XII 2014). This map uses the multi-frequency
coverage of Planck to remove the galactic contribution to mi-
crowave emission, leaving a high signal to noise map of the
CMB temperature ﬁeld. The map has some contamination
near the galactic plane. However, we have found that the im-
pact of this is very local and does not affect the higher galactic
latitudes where the BICEP ﬁeld is located. The noise level in
the Planck temperature map is fractionally small compared
to the temperature signal, and we have found that this noise
contributes a similarly small fraction to the constrained real-
ization of E-modes.

A.2. Lensing

lm. Ideally, the aT

The temperature anisotropies in the Planck NILC map have
been lensed by the intervening structure between us and the
surface of last scattering. This means the aT
lm calculated
from the Planck NILC map contain the effects of lensing and
when used in Equation A3, the lensing distortion propagates
through to the constrained aE
lm in Equation
A3 would be from the unlensed sky, however, in the absence
of an accurate map of the lensing deﬂection ﬁeld, we have no
way of de-lensing the aT
lm.
Because our power spectrum analysis is insensitive to the
off-diagonal correlations among modes with l = l(cid:48) that are
produced by lensing, a reasonable workaround for this prob-
lem is to use the Planck NILC but also to use the lensed CT T
l
spectrum. The result is an ensemble of aE
lm for the lensed aT
lm,
but which have the correct covariance given by CT E
. For the
multipole range of interest in BICEP2, lensing has a small im-
pact on aT
lm. We use the unlensed power spectra for of CT E
and CEE

Another subtlety incorporating lensing into constrained re-
alizations is the question of how to simulate lensing of the
polarization sky. This can be accomplished using LensPix
(Lewis 2011) to numerically lens the primordial E-modes,
which creates B-modes with the correct statistics. For the
constrained realizations, this is impossible because the NILC
map is lensed by the true sky lensing ﬁeld. The true sky lens-
ing ﬁeld is not known with high signal to noise, and therefore
we cannot lens the E-modes by the same ﬁeld.

Our solution to this problem is to lens the E-modes with
a random realization of the lensing ﬁeld, but use the Planck
143 GHz map as the temperature ﬁeld. This procedure ignores
lensing correlations in T E and T B because the deﬂection ﬁeld
is different for the polarization and temperature. However,
the mean of the lensing T E and T B is zero, and the additional
variance in T E and T B caused by lensing is small enough that
it can be ignored on degree scales.

.

l

l

l

Aikin, R. W. 2013, PhD thesis, California Institute of Technology
BICEP1 Collaboration. 2014, Astrophys. J., 783, 67
BICEP2/Keck and Spider Collaborations. 2015, Astrophys. J., 812, 176

BICEP2 Collaboration I. 2014, Physical Review Letters, 112, 241101
BICEP2 Collaboration II. 2014, Astrophys. J., 792, 62
BICEP2 Collaboration III. 2015, Astrophys. J., 814, 110

REFERENCES

20

FIG. 23.— Power spectra of unconstrained and constrained simulations. For the constrained simulations the T sky is ﬁxed to the Planck NILC map. By chance,
the T T power in the BICEP ﬁeld is above average near l = 150, and this leads to increased power and variance in T E and EE for these multipoles. The BB
spectrum is computed with the Smith estimator for both constrained and unconstrained simulations. It therefore contains both E/B leakage and lensing signal.
The leaked B-mode power creates a signiﬁcant T B signal in the constrained simulations, since the leaked B-modes correlate with the temperature template sky.

200040006000l(l+1)CTTl / 2π−50050100150l(l+1)CTEl / 2π  constrainedunconstrained0.511.5l(l+1)CEEl / 2π0.010.020.030.04l(l+1)CBBl / 2π050100150200250300350−4−20246l(l+1)CTBl / 2πMultipole ,  l050100150200250300350−0.1−0.0500.050.10.15l(l+1)CEBl / 2πMatrix based E/B Separation

21

Bischoff, C., Hyatt, L., McMahon, J. J., et al. 2008, Astrophys. J., 684, 771
Bond, J., Jaffe, A. H., & Knox, L. 1998, Phys.Rev., D57, 2117
Bunn, E. F., & White, M. 1997, The Astrophysical Journal, 480, 6
Bunn, E. F., Zaldarriaga, M., Tegmark, M., & Oliveira-Costa, A. d. 2003,

Phys.Rev., D67, 023501

Dvorkin, C., Peiris, H. V., & Hu, W. 2008, Phys.Rev., D77, 063008
Goldberg, J. N., Macfarlane, A. J., Newman, E. T., Rohrlich, F., &

Sudarshan, E. C. G. 1967, Journal of Mathematical Physics, 8, 2155
Gorski, K., Hivon, E., Banday, A., et al. 2005, Astrophys.J., 622, 759
Grain, J., Tristram, M., & Stompor, R. 2009, Phys. Rev. D, 79, 123515
Hamaker, J. P., & Bregman, J. D. 1996, aaps, 117, 161
Hanson, D., Hoover, S., Crites, A., et al. 2013, Physical Review Letters, 111,

Hivon, E., Górski, K. M., Netterﬁeld, C. B., et al. 2002, Astrophys. J., 567, 2
Kamionkowski, M., Kosowsky, A., & Stebbins, A. 1997, Phys.Rev., D55,

141301

7368

Keck Array and BICEP2 Collaborations V. 2015, Astrophys. J., 811, 126
Keck Array and BICEP2 Collaborations VI. 2015, ArXiv e-prints,

arXiv:1510.09217

Kovac, J. M., Leitch, E. M., Pryke, C., et al. 2002, Nature, 420, 772
Kuo, C.-l., et al. 2004, Astrophys.J., 600, 32
Lawson, C. L., Hanson, R. J., Kincaid, D. R., & Krogh, F. T. 1979, ACM

Trans. Math. Softw., 5, 308

Lewis, A. 2011, LensPix: Fast MPI full sky transforms for HEALPix,

astrophysics Source Code Library, ascl:1102.025

Planck Collaboration I. 2015, ArXiv e-prints, arXiv:1502.01582
Planck Collaboration XII. 2014, Astr. & Astroph., 571, A12
Polarbear Collaboration. 2014, Astrophys. J., 794, 171
Pryke, C., Ade, P., Bock, J., et al. 2009, Astrophys. J., 692, 1247
Readhead, A. C. S., Myers, S. T., Pearson, T. J., et al. 2004, Science, 306,

836

Sheehy, C. D. 2013, Progress toward a detection of inﬂationary B-modes
with the BICEP2 and Keck Array polarimeters, copyright - Copyright
ProQuest, UMI Dissertations Publishing 2013; Last updated -
2014-02-11; First page - n/a; M3: Ph.D.

Smith, K. M. 2006, Phys. Rev. D, 74, 083002
Smith, K. M., & Zaldarriaga, M. 2007, Phys.Rev., D76, 043001
Tegmark, M. 1997, Phys. Rev. D, 55, 5895
Tegmark, M., & de Oliveira-Costa, A. 2001, Phys. Rev. D, 64, 063001
van Engelen, A., et al. 2015, Astrophys. J., 808, 7
Zaldarriaga, M. 1998, The Astrophysical Journal, 503, 1
Zaldarriaga, M., & Seljak, U. 1997, Phys.Rev., D55, 1830

