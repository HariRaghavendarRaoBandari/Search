6
1
0
2

 
r
a

M
2

 

 
 
]
T
S
h
t
a
m

.

[
 
 

1
v
4
8
7
0
0

.

3
0
6
1
:
v
i
X
r
a

TheArrowofTimeinMultivariateTimeSeriesStefanBauerstefan.bauer@inf.ethz.chDepartmentofComputerScience,ETHZurich8092Zurich,SwitzerlandBernhardSch¨olkopfbs@tuebingen.mpg.deMaxPlanckInstituteforIntelligentSystems72076T¨ubingen,GermanyJonasPetersjonas.peters@tuebingen.mpg.deMaxPlanckInstituteforIntelligentSystems72076T¨ubingen,GermanyAbstractWeprovethatatimeseriessatisfyinga(linear)multivariateautoregressivemovingaverage(VARMA)modelsatisﬁesthesamemodelassumptioninthereversedtimedirection,too,ifallinnovationsarenormallydistributed.Thisreversibilitybreaksdowniftheinnovationsarenon-Gaussian.ThismeansthatundertheassumptionofaVARMAprocesswithnon-Gaussiannoise,thearrowoftimebecomesdetectable.Ourworktherebyprovidesatheoreticjustiﬁcationofanalgorithmthathasbeenusedforinferringthedirectionofvideosnippets.Wepresentaslightlymodiﬁedpracticalalgorithmthatestimatesthetimedirectionforagivensampleandproveitsconsistency.Wefurtherinvestigatehowtheperformanceofthealgorithmdependsonsamplesize,numberofdimensionsofthetimeseriesandtheorderoftheprocess.Anapplicationtorealworlddatafromeconomicsshowsthatconsideringmultivariateprocessesinsteadofunivariateprocessescanbebeneﬁcialforestimatingthetimedirection.Ourresultextendsearlierworkonunivariatetimeseries.Itrelatestotheconceptofcausalinference,whererecentmethodsexploitnon-Gaussianityoftheerrortermsforcausalstructurelearning.1.IntroductionThegoalofthisworkistoinferthedirectionofagivenmultivariatetimeseries.Figure1showsanexampleofatimeseriesinforwardandbackwarddirection.Thetaskistode-cide,whichofbothdirectioncorrespondstothecorrecttimedirection.Thisquestionismainlyacademicbuthasreceivedalotofattentioninliterature,especiallyinphysics,seeReichenbach(1956)orPrice(1996).Hern´andez-Lobatoetal.(2011),Morales-Mombielaetal.(2013)andHern´andez-Lobatoetal.(2014)discussthederivationandapplicationofGaussianitymeasurestodetectthedirectionofcausaltimeseries.However,theirapproachisbasedontheempiricalobservationthattheresidualsofalinearﬁtintheforwarddirec-tionarelessGaussianthantheresidualsinthebackwarddirection.Wearenotawareofanytheoreticalresultthatclariﬁesunderwhichassumptionthisheuristicholds.Themainthrustofthepresentpaperistoprovidesuchidentiﬁabilityresults.Pickupetal.(2014)estimatethedirectionofavideosnippetthatisplayedeitherforwardsorbackwards.While1Figure1:QuarterlygrowthratesinpercentageofrealgrossdomesticproductsfortheUnitedKingdom,CanadaandUSA((Tsay,2014)).Whilethecorrecttimedirectionisontheleft,thetimeseriesontherightisreversed.Thegoalofthisworkistoinvestigateunderwhichconditionsthecorrecttimedirectionbecomesidentiﬁable,withoutusinganyadditionalpriorknowledgeofthedatadomain.theauthorsuseanalgorithmthatissimilartotheonewepresentinhere,theydonotprovideatheoreticaljustiﬁcationfortheirapproachandrefertotheunivariateversionofthisproblem(Petersetal.,2009).OurworkprovidesaposthocjustiﬁcationofPickupetal.(2014)byprovingidentiﬁabilitystatements.ItfurtherprovidesaconsistencyresultforaversionofthealgorithmﬁrstderivedinPetersetal.(2009);consistencywasunknownbothintheunivariateandthemultivariatecase.Thequestionoftime-reversibilityisfurther-moreinterestingfromacausalpointofview.Incausaldiscovery,weobserveani.i.d.samplefromamultivariatedistributionandtrytoidentifytheunderlyingcausalstructure.Becausecausesarewidelyacceptedtoprecedetheireﬀects(ifwehaveaccurateandinstantaneousmeasurements),similarprinciplescanbeappliedtotheproblemoftimereversibility.Moreconcretely,ourresultsarebasedontheDarmois-Skitovichtheorem(Ibragimov,2014),theunivariateversionofwhichisatthebasisofthecausaldiscoverymethodLiNGAM(Shimizuetal.,2006).Bothapproachesmakeuseofnon-Gaussianresidualsinlinearmodels.Whileitisdiﬃculttoﬁnddatasetswithaknowncausalstructure,wehaveaccesstothecor-recttimedirectionofalmostallobservedtimeseries.Shimizuetal.(2006)proposedtoapplyLiNGAMtothetimedirectionproblem,seeSection5fordetails.Duetopossibleconfounding,however,theirmethodlacksaprecisetheoreticaljustiﬁcation(Shimizuetal.,2006).Wewillseethatitperformswellonlyinlowdimensions.ThemainideaofourmethodfollowstheunivariateprocedureofPetersetal.(2009).Weconsidervector-valuedautoregressivemovingaveragemodels(VARMA)withinnovationsthatareindependentofprecedingvaluesofthetimeseries.Weshowthatthetimedirectionisreversible,i.e.,thetimeseriesfollowssuchaVARMAmodelinthereverseddirection,onlyiftheinnovationsareGaussian.Thisleadstothefollowingsimplepracticalprocedureforthedeterminationofthearrowoftime:afterﬁttingaVARMAmodeltotheobservedtimeseries,wetestwhethertheresidualsareindependentoftheprecedingvaluesinbothtime2directions.Ifthemodelassumptioniscorrectandtheinnovationsareindeednon-Gaussian,wewillﬁndtheindependenceonlyinoneofthetwopossibledirections.IntheremainderofSection1,weintroducemultivariateautoregressivemovingaverage(VARMA)processesandformalizetheproblem.Section2containsidentiﬁabilityresultsaboutVARMAprocessesoforderonethataregeneralizedtohigherorderprocessesinSection3.WepresentapracticalmethodinSection4andshowresultsonsimulatedandrealdatasetsinSection5.1.1NotationandﬁrstpropertiesofVARmodelsAK-dimensionaltimeseriesXtiscalledavectorautoregressivemovingaverageprocessVARMA(p,q)ifitisweaklystationaryandifthereisani.i.d.whitenoisesequenceZtwithzeromeansuchthatXt−Φ1Xt−1−···−ΦpXt−p=Zt+Θ1Zt−1+···+ΘqZt−q.(1)Here,XtbeingweaklystationarymeansthatitsmeanisconstantintimeandthecovariancebetweenXtandXt+hdependsonlyonthetimelagh∈Z.Inmorecompactform,theaboveequationcanbewrittenasΦ(B)Xt=Θ(B)Zt,(2)whereΦ(z)=1−Φ1z−···−Φpzp,Θ(z)=1+Θ1z+···+ΘqzqandBisthebackwardshiftoperator.WecallthisprocessaVARprocessforp=0,andanMAprocessforq=0.AVARMA(p,q)processisfurthersaidtobecausalifthereexistsasequenceofmatricesΨ0,Ψ1,...withabsolutelysummablecomponentssuchthatXt=∞Xj=0ΨjZt−j.(3)Theimportantconditionhereisthattheindexjstartsatzero,anexpansionwithj∈Zusuallyexists(BrockwellandDavis,1991,Section11.3).Awaytocheckifatimeseriesiscausalisgivenbythefollowingsuﬃcientcriterion:Lemma1(Causalitycriterion,Theorem11.3.1in(BrockwellandDavis,1991))IfdetΦ(z)6=0∀z∈Csuchthat|z|≤1,thenΦ(B)Xt=Θ(B)ZtwithZtbeingwhitenoise,hasexactlyonestationarysolution,Xt=P∞j=0ΨjZt−j,wherethematrices{Ψj}j≥0haveabsolutelysummablecomponentsandareuniquelydeterminedbyΨ(z)=∞Xj=0Ψjzj=Φ−1(z)Θ(z),|z|≤1.Inthiswork,werequireyetanothercharacterizationofcausaltimeseries.Asforallotherresults,theproofcanbefoundinSection6.Lemma2AVARMAprocessiscausalifandonlyifforalli<tthenoiseZtisindepen-dentoftheprecedingvalueofthetimeseriesXi(writtenasZt⊥⊥Xi).3Inthiswork,weinvestigatethetime-reversibilityoftimeseriesthatfollowsuchacausalVARMAmodel.Moreprecisely,wecallacausalVARMAprocesstime-reversibleifthereisani.i.d.noisesequenceeZtandcoeﬃcientmatriceseΦ1,...,eΦpandeΘ1,...,eΘpsuchthatXt−eΦ1Xt+1−···−eΦpXt+p=eZt+eΘ1eZt+1+···+eΘqeZt+qwhereforalli>t,eZt⊥⊥Xi,seeLemma2.InSections2and3,wetrytoﬁndsuitablecriteriawhichallowustodeterminewhetheraprocessistime-reversible.There,theindependencebetweennoiseandvaluesofthetimeserieswillplayacrucialrole.1.2RelationtotheunivariatecaseSomespecialcasesofVARMAprocessesrelatedirectlytotheunivariatecase.Someofthesecasesaredegenerateandwillbeexcludedfromouranalysis.InthecaseofaVAR(1)processwithdiagonalcoeﬃcientmatrixoffullrank,eachcomponentcanbeconsideredasaseparateunivariatetimeseriesandonecaninferthetruetemporalorderingbydirectlyapplyingthemethodsofPetersetal.(2009).Foratwo-dimensionalVAR(1)processwithcoeﬃcientmatrixoftheformΦ1=(cid:20)α000(cid:21),onecanagainapplytheunivariateresultsfortheﬁrstelement.Sincethesecondtimeseriescomponentcorrespondstoi.i.d.noise,itisclearthatthiscomponentistime-reversibleindependentlyofthenoisedistribution.Inouranalysisofthemultivariatecase,wewillexcludethelatter(degenerate)case,e.g.,byassumingfullrankofthecoeﬃcientmatrix.2.TimereversibilityofVARprocessesoforderoneInthefollowingsubsectionweonlyconsiderVAR(1)processesXt=ΦXt−1+ZtandassumethatΓ0:=cov(Xt,Xt)hasfullrank,seeSection1.2.Thissectioncontainsthekeytheoreticalargumentofthiswork.Theorem7extendsthisargumenttoVARMAprocessesofanyarbitrarybutﬁniteorder.WeﬁrstshowthatwecannotinferthetimedirectionoflinearGaussiantimeseries.TheproofisbasedonmatrixalgebraandtheYule-Walkerequations.Proposition3(Gaussianerrorsleadtotime-reversibility)AssumethattheerrorsofacausalVAR(1)processXt=ΦXt−1+ZtarenormallydistributedandthatΓ0:=cov(Xt,Xt)isoffullrank.Then,theprocessistime-reversible:thereisamatrixeΦandanoisesequenceeZtsuchthatXt=eΦXt+1+eZt,whereforalli>t,eZtisindependentofXi.Thefollowingresultispositiveinthesensethatnon-Gaussianinnovationsintroduceanasymmetryinthetimedirection.Theorem4(Non-Gaussianerrorsleadtotime-identiﬁability)ConsideracausalVAR(1)processXt=ΦXt−1+Ztandassumethattheprocessistime-reversible,i.e.,thereisamatrixeΦandanoisesequenceeZtsuchthatXtcanbewrittenas:Xt=eΦXt+1+eZt,4whereforalli>t,eZtisindependentofXi.(i)IfthecoeﬃcientmatrixΦisinvertible,thenallelementsofthenoisesequencevectorsarenormallydistributed.(ii)IfthecoeﬃcientmatrixΦisnotnilpotent,thensomeelementsofthenoisesequencevectorsarenormallydistributed.Ouridentiﬁabilityresultscomeclosetonecessaryandsuﬃcientconditions.ThecasewhenΦissingularandnotnilpotentandsomebutnotallinnovationsarenon-Gaussianisnotcovered.BothproofscanbefoundinSection6.TheDarmois-Skitovictheoremisusedforprovingtheidentiﬁabilityofindependentcomponentanalysis(Comon,1994)andliesattheheartoftheproofofTheorem4.Lemma5(VectorisedDarmois-Skitovichtheoremforinﬁnitesums)LetX1,X2,...beindependentd-dimensionalrandomvectorsandconsiderthelinearcombina-tionsL1=P∞j=1AjXjandL2=P∞j=1BjXjwhereAj,Bjarenon-singulard×dmatrices.IfL1andL2areindependentand{AjB−1j}j≥1aswellas{BjA−1j}j≥1areboundedinsomematrixnorm,thentherandomvectorsX1,X2,...arenormallydistributed.3.TimereversibilityofVARMAprocessesofhigherorder3.1DeﬁnitionsandparametrizationToensureauniquesolutionto(1)intheunivariatecase,onerequiresthatΦ(z)andΘ(z)oftheunivariateARMA(p,q)processΦ(B)Xt=Θ(B)thavenocommonzeros(Bellmann,1987).Inordertoguaranteeauniquesolutioninthemultivariatecase,theconditionsbecomeslightlymorecomplex.Asanexample,consideratwo-dimensionalVARMA(1,1)processXt=Φ1Xt−1+Θ1Zt−1+ZtwithΦ1=(cid:20)0α+m00(cid:21)andΘ1=(cid:20)0−m00(cid:21),whereα6=0andm∈R.ThesamemodelcanbewrittenasapuremovingaverageprocesswithΦ1=0andΘ1=(cid:20)0α00(cid:21).SincemintheVARMA(1,1)presentationisarbitrary,themodelparametersarenotidentiﬁable.Thisnon-identiﬁabilityproblemintroducesonemorediﬃcultytotheproblemoftime-reversibility.Intheunivariatesetting(Petersetal.,2009),oneofthekeyideasistorepresentaVARprocessasaMA(∞)process.Formultivariatetimeseries,however,theorderofthecorrespondingMAprocessmaybeﬁnite.ForaVAR(1)processwithΦ1=(cid:20)00.500(cid:21),forexample,weﬁndthatΨj=Φj=0forj>1andthusXtcanbewrittenasXt=Zt+ΦZt−1,whichisapureMAprocessofﬁniteorder.Theseexamplesaretakenfrom(L¨utkepohl,2010,Section12.1.1).Here,wesolvethisproblembyassumingthatΦ1isnotnilpotent.Alternatively,onecanrequirethattheVARMAprocessisinthesocalledﬁnalequationsorechelonform(L¨utkepohl,2010,Section12.1.2).53.2RepresentingaVARMAprocessasaVARprocessoforderoneItiswellknown(e.g.L¨utkepohl,2010,Section11.3.2)thataK-dimensionalVARMA(p,q)processXt−Φ1Xt−1−···−ΦpXt−p=Zt+Θ1Zt−1+···+ΘqZt−q(4)canbewrittenasaK(p+q)-dimensionalVAR(1)processbXt=ΥbXt−1+Ut,withnewnoiseinnovationsUtandcoeﬃcientsΥgivenbybXt=(cid:2)Xt...Xt−p+1Zt...Zt−q+1(cid:3)T,Ut=(cid:2)Zt0···0Zt0···0(cid:3)TeachofdimensionK(p+q)×1,andΥ=(cid:20)Υ11Υ120Kq×KpΥ22(cid:21)withΥ11:=Φ1Φ2...Φp−1Φp1K0...0001K...00......0...0...01K0,Υ12:=Θ1Θ2...Θq−1Θq00...0000...00.........00...00Υ22:=00...001K0...0001K...00......0...0...01K0.TheimportantpropertyisthattheﬁrstrowsofΥequal(cid:2)Φ1···ΦpΘ1···Θq(cid:3).WiththisandLemma1wethereforehaveLemma6TheVARMA(p,q)processiscausalifandonlyifitscorrespondingVAR(1)representationiscausal.ThusthecaseofaVARMA(p,q)processreducestoaVAR(1)processandwecanapplytheresultsfromSection2.Summarizing,wehavethefollowingtheorem.Theorem7ConsideraVARMA(p,q)processwithnot-nilpotentcoeﬃcientmatrixΥ.Iftheerrorvectorsarenormallydistributed,theprocessistime-reversibleandiftheprocessistime-reversible,thenatleastsomeoftheelementsofthenoisevectorsarenormallydistributed.(NotethatΥisnotnilpotentifandonlyifΦ1intherepresentation(4)isnotnilpotent.)4.AlgorithmWenowpresentapracticalmethodforﬁnitetimeseriesdataandprovideaconsistencyresultforaversionofthisalgorithm.Forpracticalpurposes,werestrictourselvestoVAR(p)processes;seeL¨utkepohl(2010)forthetechnicaldiﬃcultieswithﬁttingVAR(p,q)processes.6ToestimatethecorrectdirectionofmultivariatetimeserieswefollowPetersetal.(2009).ThegeneralideaisthatunderthediscussedassumptionsGaussiancausalVARMAprocessesaretime-reversiblebutforanyothererrordistributionweareabletoidentifythetruetemporalordering,seeTheorems4and7.ThemainideanowistoﬁtVARmodelsinbothdirectionsandcheckinwhichdirectionweﬁndthattheresidualsareindependentofprecedingvalues.TheindependencetestisbasedontheHilbert-SchmidtIndependenceCriterion(HSIC)(Grettonetal.,2007).InordertocheckwhethertheresidualtimeseriesZtisindependentofthepastofXt,wesimplycheckforindependencebetweenZtandXt−1(althoughhigherlagsmaybeconsidered).Themethoddecidescorrectlyifthehypothesisofindependenceisrejectedinthebackwarddirection,whileitisnotrejectedintheforwarddirection.InthecaseofGaussianinnovations,forexample,weexpecttoacceptthenullhypothesesinbothdirectionsandthemethodremainsundecided.Forpracticalpurposes,weintroduceasmallgapbetweenthesigniﬁcancelevelsandincludetheoptiontoworkwiththestatisticsitselfratherwiththep-value.ThepreciseprocedureispresentedinAlgorithm1.Forsimulating(functionvgxproc)andﬁtting(functionvgxvarx)VAR(p)processesweusedAlgorithm1Detectingthedirectionofmultivariatetimeseries1:procedureInput(f=(x1,...,xn),b=(xn,...,x1),sig1,sig2),2:(a)fct:=−HSIC,(b)fct:=p−valueHSIC3:modelf=VAR.ﬁt(f);resf=residuals(modelf);fw=fct(f,resf)4:modelb=VAR.ﬁt(b);resb=residuals(modelb);bw=fct(b,resb)5:ifmax(fw,bw)>sig1&&min(fw,bw)<sig2then6:decision=argmax(fw,bw)7:elsedecision=“Idonotknow.”8:endif9:Returndecision10:endprocedurethe”EconometricsToolbox”withinMatlab.ThecorrectorderoftheprocessisestimatedusingAIC.Thecodeisavailableathttp://people.inf.ethz.ch/bauers/.Inpractice,wemightﬁndthatthemodelassumptionsareviolatedduetotheexistenceofhiddenconfoundersornonlinearrelationships.Thenweexpectthattheindependencewillberejectedinbothdirectionsandthemethodremainsundecided.Thisisdiﬀerentfromthenon-decisionintheGaussiancase,whereweexpectbothdirectionstoleadtoagoodmodelﬁt(seealsoPetersetal.,2009).ItcanbeshownthatAlgorithm1isconsistentinthesenseofTheorem8below.Thisresultisnotimmediatelystraightforwardsincetheindependencemeasureisbasedones-timatedresidualsratherthan“true”innovations(seealsoMooijetal.,2014).Again,theproofisprovidedinSection6.Theorem8Let(Xt)t∈ZbeaVARprocessoforderonewithnoisevariables(Zt)t∈Z.Letthe(cid:16)Zfwt(cid:17)t∈Zbetheresidualsinforwardand(cid:0)Zbwt(cid:1)t∈Ztheresidualsinbackwarddirection(correspondingtothebestVARﬁt)andassumethatXt6⊥⊥Zbwt+1(seeTheorem4(i)andRemark9below).Assumethatallprocessesarestrictlystationaryanduniformlymixing7withα(m)≤m−3,asdeﬁnedin(8).ThenAlgorithm1consistentlyestimatesthearrowoftimeusinganempiricalHSICscorewithaGaussiankernel.Remark9•ForsimplicityweassumethatXt6⊥⊥Zbwt+1.Onecanusemultipletestingtocorrectforadependenceatadiﬀerenttimelag.•UndersometechnicalassumptionsMarkovChains(andthusARMAprocesses)areuniformlymixing(e.gDoukhan,1994;Mokkadem,1988).•Theuniformlymixingassumptioncanbereplacedbyassumingthattheprocessisabsolutelyregular(ChwialkowskiandGretton,2014,Lemma2).5.ExperimentsWecompareourmethodwithaLiNGAM-basedapproachproposedbyShimizuetal.(2006),whichconstructsacausalgraphgiveni.i.d.samplesofarandomvector.Ifthegeneratedgraphistimeconsistentinthesensethatalllinksgofromlowertohigherlabeledvariables(ortheopposite),LiNGAMproposesthisdirectionasthecorrectone.5.1SimulateddataWesimulateVARprocessesofdiﬀerentorderanddimensionalityandtesttheperformanceofbothapproaches.Weuseversion(b)ofourAlgorithm1inordertobetterinterpretourresults.Forallexperiments,weusesigniﬁcancelevelsofsig1=0.1andsig2=0.05.Thisisaconservativebutinterpretablechoicethatcouldbechangedinordertoincreasetheperformanceinthesimulations.SimulationparametersForaﬁxedparameterλ=2.5,thei-thcoeﬃcientmatrixofthesimulatedVARprocessofdimensionkisgeneratedbyΦi=λ−iR−(2λ)−iQ,whereRconsistsofuniformlydrawnnumbersbetweenzeroandoneandQisamatrixcontainingonlyones.DeviationfromGaussiannoisefordiﬀerentlagsanddimensionsForrrangingbetweenzerototwowesampledeachcomponentofthenoisevectorasZtiid∼sgn(Z)·|Z|r,whereZisGaussiandistributed.Onlythecaser=1resultsinanormaldistributionandweshouldonlythenbeunabletodetectthetruedirectionofthetimeseries.ThisisveriﬁedfordiﬀerentlagorderspanddimensionskoftheVARprocessinFigure2.VaryingnumberofGaussianerrordimensionsTheorem7showsthatonecandetectthetruedirectionofthetimeseriesifallerrordimensionshaveanon-Gaussiandistribution,whilewecannotinferthearrowiftimewhenallerrorsarenormallydistributed.WethereforeincreasedthenumberofGaussianerrorsfrom20%to100%.Figure3supportsourtheoreticalresultsandshowsthatouralgorithmdoesnotmakeadecisionwhenallerrorsareGaussiandistributed.Inaddition,itsuggeststhatwithonlyonecomponentnotnormallydistributedwecanstillinferthetruedirection.ThisindicatesthatanevenstrongerversionofTheorem7mighthold.ComparisontoLiNGAMFigure4showsresultsofsomeofthesettingsshowninFig-ure2.Ingeneral,theperformanceiscomparablebuttheLiNGAMperformancedecreasesforincreasingdimension.Interestingly,LiNGAMmakesnomistakesfork=3andp=38(a)n=1000(b)n=1000(c)n=1000(d)n=100(e)n=100(f)n=900Figure2:Correctlyandincorrectlyclassiﬁedunivariatetimeseriesforvaryinglagvalues,samplesizesanddimensions.Foreachvalueofrwegeneratedandtestedouralgorithmon100timeseries.Onlyr=1correspondstoGaussiannoise,forwhichtheprocessisreversible.Forthesevaluesourmethodremainsundecidedsincebothdirectionsleadtoagoodmodelﬁt.Itisinterestingtonotethattheincreaseddimensionality(k=3)introducesmoremodelparametersbutdoesnotleadtoworseperformancewithrespecttoidentiﬁcationofthetimedirection.Ifwecomparesituations,inwhichwehavethesamenumberofdatapointsforeachARcoeﬃcient(namely100,seesecondrow(d)and(f)),theperformanceissigniﬁcantlybetterfork=3.andGaussiandata.Thismightbeduetotheexistenceofv-structuresinthegraph(noinstantaneouseﬀects),seeFigure4(b).Thisisnotthecasefork=1.5.2Realdata:GDPgrowthforUnitedKingdom,CanadaandUnitedStatesInadatasetcontainingthequarterlygrowthratesofrealgrossdomesticproduct(GDP)ofUK,CanadaandUSAfrom1980to2011(Tsay,2014),wetestedourapproachfordiﬀerenttimelags,seeFigure1.InFigure5thep-valuesoftheindependencetestforforwardandbackwarddirectionareplottedfortimelagsbetweenoneandten.TheoptimalorderchosenbyAICisfour.Ifwetreatthethreetimeseriesindividually,themethodremainsundecidedinallcases.Onlyifwetreattheprocessasamultivariatetimeseries,themethodoutputsthecorrectresult.Theresultsdonotchange,whenusingversion(a)ofourAlgorithm1.LiNGAMdoesneitherdecidefortheone-dimensionalnorthethree-dimensionalcase.Here,wetookaﬁrstorderdiﬀerencewhichisoftendoneinordertoensurestationarity.9Figure3:DependenceofouralgorithmonthenumberofGaussianerrordimensions.AﬁvedimensionalVARprocessistestedwithincreasingnumberofGaussianerrors.Theremain-ingerrorelement(s)followanon-Gaussiannoisedistributionwithr=0.5(cf.Section5.1).Ineachcase,theperformanceofthealgorithmistestedon100timeserieswith1000timepointseach.Asexpected,ourmethodfailsoncethenoisevectoriscompletelynormallydistributed.Aslongasatleastoneelementinthenoisevectorisnon-Gaussiandistributed,ourmethodperformswell.(a)(b)(c)Figure4:CorrectlyandwronglyclassiﬁedtimeserieswithLiNGAM.Whiletheperfor-manceseemstobeslightlybetterintheunivariatecase,theperformancedecreasessigniﬁ-cantlywiththedimensionkandlagorderpofthetimeseries,comparewithFigure2.5.3Realdata:videosnippetsPickupetal.(2014)Inacomputervisionapplication,Pickupetal.(2014)aimtodetermineifvideosareshowninforwardorbackwarddirection.Apartfromtwootherapproaches(discriminativeapproachwithtrainingdataandaheuristicclaimingitisunlikelythatmultiplemotionscollapseintoonemotion)theauthorsapplyanalgorithmsimilartotheonepresentedbyPetersetal.(2009)andourAlgorithm1(b).TheauthorsmodelthevelocitiesofmovingpointswithaVAR(2)modelandasoutlinedabove,performanindependencetestbetweenvelocitiesandmodelresiduals(assumingthattheunivariateresultsofPetersetal.(2009)applyinhigherdimensions).Incorrespondencetoourresults,theauthorsﬁndthattheapproachworkswelliftheassumptionslikelineardynamicsandnon-Gaussianerrorsaresatisﬁed.10Figure5:Left:logp-valuefortheindependencetestofresidualsandtimeseriesvaluesinforwardandbackwarddirectionforthemultivariateVARprocessandthethreeunivariateprocesses.Forillustrationpurposes,dashedbluelinesareshownatthevalueslog(0.05)andlog(0.1).Ourmethoddecidesonlyifthep-valuesofbothdirectionslieondiﬀerentsidesofthisgap.Whileintheunivariatecasethealgorithmdoesnottakeadecision,itisabletodecidesforthetruetemporalorderinginthemultivariatecase.Theoptimalordersare4forthemultivariateprocessand3,5,9inbothdirectionsforUK,CanadaandUSA.Right:thelogp-valuesoftheindependencetestforthemultivariateprocessareshownfordiﬀerentorders.Theperformanceofouralgorithmisrelativelyrobusttodeviationsfromtheoptimalorder.Figure6:Left:HSICvaluesoftheindependencetestofresidualsandtimeseriesvaluesinforwardandbackwarddirectionforthemultivariateVARprocessandthethreeunivariateprocesses.ForthemultivariateandtheUKtimesseries,thealgorithmdecidescorrectlywhileforthetimeseriesofCanadaandtheUS,thealgorithmdecideswrongly.Right:theHSICvaluesoftheindependencetestforthemultivariateprocessareshownfordiﬀerentorders.Onlyforhighlagsandtheirinherentﬁttingproblemsthealgorithmdecideswrongly.5.4Realdata:dailyNASDAQ-stockvaluesInaddition,wetestedasetof50timeseriesconsistingofdailyreturnsofNASDAQstocksfromthe1stOctober2004to30thSeptember2007(Yah,2015).Wegroupedthetimeseriesintosubsetsofdimensionsk=3,5,10and50.Fork=3,k=5andk=10wechosenotallbut100randomlyselectedsubsets.Withsig1=0.1andsig2=0.05themethodremainedundecidedinallcases.Apparently,theVARmodeldoesnotprovideagoodﬁtforthese11stockmarketdata.Thismaybethecaseforotherdatasets,too,andweregarditasapositivefeaturethatinthosecasesofmodelmisspeciﬁcationourmethodremainsundecidedratherthangivingwronganswers.TheauthorsmodelthevelocitiesofmovingpointswithaVAR(2)modelandasoutlinedabove,performanindependencetestbetweenvelocitiesandmodelresiduals(assumingthattheunivariateresultsfromPetersetal.(2009)alsoholdinhigherdimensions).Incorre-spondencetoourresults,theauthorsﬁndthattheapproachworkswelliftheassumptionslikelinearityofthedynamicsandnon-Gaussianerrorsaresatisﬁed.6.Proofs6.1ProofofLemma2ProofTheprooffollowsitsunivariateversion(Petersetal.,2009).WeﬁrstshowthatifXt=P∞j=0ΨjZt−j,thenZtisindependentofXi,foralli<t.BydeﬁningX(n)t:=Pnj=0ΨjZt−j,wehavethatX(n)tconvergesweaklytoXtandthusthecharacteristicfunctionof(Xt,Zt+1)obeysforalluandvϕP(Xt,Zt+1)(u,v)=limn→∞ϕP(cid:18)X(n)t,Zt+1(cid:19)(u,v)=limn→∞ϕPX(n)t(u)ϕPZt+1(v)==ϕPXt(u)ϕPZt+1(v)=ϕPXt⊗PZt+1(u,v).ThisresultsinindependenceofZtandXi,i<tbyuniquenessofthecharacteristicfunction.Inordertoprovethe“if”-part,weneedtoshowthatforacausalprocessXt,allcoeﬃcientsΨiareequaltozerofori<0intheLaurentexpansionXt=Pi∈ZΨiZt−i(seeL¨utkepohl(2010)).Assumeotherwise,i.e.,thereisacoeﬃcienti0<0suchthatΨi06=0.ThenΨi0Zt−i0+Xi∈Z−i0ΨiZt−i=Xt⊥⊥Ψi0Zt−i0.(5)BecauseΨi0Zt−i0andPi∈Z−i0ΨiZt−iareindependentwiththesamereasoningasabove,(5)resultsinacontradiction.6.2ProofofProposition3ProofDeﬁningeZt:=Xt−cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1Xt+1andeΦ:=cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1,itfollowsthateΦXt+1+eZt=cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1Xt+1+Xt−cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1Xt+1=Xt.12Inaddition,wehavecov(eZt,Xt+1)=cov(Xt−cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1Xt+1,Xt+1)=cov(Xt,Xt+1)−cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1cov(Xt+1,Xt+1)=0.BytheassumptionoftheGaussiandistribution,theindependenceofeZtandXt+1follows.ItremainstoshowthateZtandXt+kareindependentfork≥2.BythemulitvariateformoftheYule-WalkerequationsfortheVAR(1)process,i.e.,Γk:=cov(Xt,Xt+k)=ΦΓk−1(see2.1.31inL¨utkepohl(2010)),weobtainthatcov(eZt,Xt+k)=cov(Xt−cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1Xt+1,Xt+k)=cov(Xt,Xt+k)−cov(Xt,Xt+1)·cov(Xt+1,Xt+1)−1cov(Xt+1,Xt+k)=cov(Xt,Xt+k)−ΦΓ0Γ−10cov(Xt+1,Xt+k)=Γk−ΦΓk−1=0.6.3ProofofTheorem4ProofWeﬁrstprovethesecondpartofthetheorem,thatisweassumethattheK×KcoeﬃcientmatrixΦisnotnilpotent.ByLemma1itfollowsthatXt=∞Xi=0ΨiZt−i=∞Xi=0ΦiZt−i(6)andeZt−1=Xt−1−eΦXt=∞Xi=0ΨiZt−1−i−eΦ∞Xi=0ΨiZt−i=∞Xi=0(cid:16)Ψi−1−eΦΨi(cid:17)Zt−i,(7)whereΨ−1:=0,sinceforaVAR(1)processΨi=Φi.DeﬁningAi:=Ψi−1−eΦΨi=(1−eΦΦ)Φi−1andBi:=Ψi=Φi=ΦΦi−1,wecanunfortunatelynotdirectlyapplythevectorizedDarmois-Skitovichtheorem(seeTheorem4ofIbragimov(2014)orourLemma5)sincethematricesAiandBiarenotinvertible.ByassumptiontheeigenvaluesofthematrixΦofacausalprocessaresmallerthanoneinabsolutevalue(seeLemma1)andthusbyGelfand’sformula(1−eΦΦ)isoffullrankK.UsingtheassumptionthatΦisnotnilpotentitfollowsthatforalargeenoughindexi≥i0andsomenumbers,wehaverank(Φi)=rank(Φi−1)=s.ApplyingtherankinequalityofSylvester,(rank(Q)+rank(P)−K≤rank(QP)≤min(rank(Q),rank(P))withQandPmatricesofsizeK×K),wegetthatrank(Ai)=sandrank(Bi)=sfori≥i0.AsingularvaluedecompositionyieldsΦi−1=UΣV∗withaunitarymatrixUandaK×KdiagonalmatrixΣ,whoseﬁrstsdiagonalelementsarenon-zero,whileitslastK−scolumnscontainonlyzeros.Wedeﬁneanewnoisevectorεt−i:=V∗Zt−iandrewrite(6)and(7)asXt=∞Xi=0ΨiZt−i=∞Xi=0ΦUΣV∗Zt−i=∞Xi=0ΦUΣεt−i13andeZt−1=∞Xi=0(cid:16)1−eΦΦ(cid:17)UΣV∗Zt−i=∞Xi=0(cid:16)1−eΦΦ(cid:17)UΣεt−i.Sincerank(Φi−1)=s,(cid:16)1−eΦΦ(cid:17)UΣandΦUΣareoftheform(M1|0)and(M2|0)forK×smatricesMjwithrank(Mj)=s,j∈{1,2}.LetusselectsindependentrowsofM2andcallthemB∗i.LetuscallA∗ithecorrespondingelementsinM1.Thisleadstoanew,reducedsystemofequationsZ∗t−1=∞Xi=0A∗iε1ε2...εst−iandX∗t=∞Xi=0B∗iε1ε2...εst−i,whereA∗iandB∗iareofdimensions×swithfullrank,andZ∗t−1andX∗tareindependent.Darmois-Skitovich(Lemma5inthesupplement)impliesnormalityofε1t,...,εstandthenormalityofsomeelementsoftheoriginalnoisevectorZtfollowsbyCramer’stheorem.ForthesecondpartofthetheoremletusnowassumethatthecoeﬃcientmatrixΦandthusAiandBiareinvertible(bytherankinequalityofSylvester).SinceAiB−1i=(1−eΦΦ)Φi−1(Φi)−1=(1−eΦΦ)Φ−1=Φ−1−eΦandBiA−1i=(AiB−1i)−1=(Φ−1−eΦ)−1donotdependoni,both{AiB−1i}i≥1and{BiA−1i}i≥1areboundedw.r.t.somenorm.TheDarmois-Skitovichtheorem(Lemma5inthesupplement)thenimpliesthenormalityofZt.6.4ProofofLemma6ProofThestatementfollowsfromconsideringdeterminants,seeLemma1.det(1K(p+q)−Υz)=det(1Kp−Υ11z)det(1Kq−Υ22z)=det(1K−Φ1z−···−Φpzp)6.5ProofofTheorem8ProofOurprooffollowsthemainargumentofTheorem20inMooijetal.(2014)andomitssomeofthedetails.WeﬁrstreportaconsistencyresultsforHSICfortimedependentdata(ChwialkowskiandGretton,2014).14Givenastationaryprocess(Wt)t∈Z:=(Xt,Zt)t∈N,let(W?t)t∈Zbeasequenceofinde-pendentcopiesofW0.LetWT:=(W1,...,WT)forasampleofsizeT.WeshowthattheempiricalHSIC(withapredeﬁned,dataindependentbandwidth)betweenestimatedresidualsandthetimeseriesconvergestoitstruevalueundersomemixingcondition.Aprocessisuniformlymixingwithα(m)ifα(m):=supnsupA∈An1supB∈A∞n+m|P(B|A)−P(B)|→0,(8)whereAcb=σ(Wb,Wb+1,...,Wc)isasigmaﬁeldspannedbyWb,Wb+1,...,Wc(ChwialkowskiandGretton,2014).Forwj:=(xj,zj),j∈{a,b,c,d}andkand‘beingGaussiankernels,deﬁneh(wa,wb,wc,wd):=k(xa,xb)[‘(za,zb)+‘(zc,zd)−2‘(zb,zc)].Wefurtherdeﬁneγ:=HSICX0,Z0=E[h(W?1,W?2,W?3,W?4)].SinceGaussiankernelsarecharacteristic,itisknownthatX0isindependentofZ0ifandonlyifγ=0(Grettonetal.,2007).Wethereforehaveforanyt∈{1,...,T},Xt⊥⊥Zt⇐⇒X0⊥⊥Z0⇐⇒E[h(W?1,W?2,W?3,W?4)]=0.Anempiricalestimate\HSIC(WT)ofγbasedonthesampleWTcanbecalculatedthroughtheV-statistic\HSIC(WT):=VT(h,WT):=1T4X1≤t1,t2,t3,t4≤Th(Wt1,Wt2,Wt3,Wt4).Notethatunlikeinthei.i.d.case,heretheWtarenotindependentfordiﬀerentvaluesoft.However,westillhavethefollowingconsistencyresult(requiringtheuniformlymixingassumptioninthisstep):ForT→∞wehaveforindependentXtandZtVT(h,WT)P→0(9)andforXtandZtbeingdependent:VT(h,WT)P→δ>0.(10)ThisfollowsfromTheorems1and2inChwialkowskiandGretton(2014)usingthatforanyrandomvariableSwithﬁnitevarianceT·XTD→SimpliesthatXTL2→0andthereforeXTP→0forT→∞.LetnowbZfwT:=(bZfw2,...,bZfwT+1)betheresidualsinforwardandbZbwT:=(bZbw2,...,bZbwT+1)theresidualsinbackwarddirection.WewillshowthatforXT=(X1,...,XT),\HSIC(cid:16)XT,bZfwT(cid:17)P→0and\HSIC(cid:16)XT,bZbwT(cid:17)P→δ>0.(11)15By(aslightlymodiﬁedversionof)Lemma16inMooijetal.(2014)itfollowsthat(cid:12)(cid:12)(cid:12)\HSIC(XT,bZT)−\HSIC(XT,ZT)(cid:12)(cid:12)(cid:12)2≤(cid:18)C√T(cid:19)2kbZT−ZTk2F,(12)forsomeconstantC∈RandFrobeniusnormk·kF.Giventhe“correct”VAR(1)representationXt=ΦXt−1+ZtandthemodelﬁtXt=bΦXt−1+bZt,wehaveE(cid:20)1TkbZT−ZTk2F(cid:21)=E"1TXtkbΦXt−1−ΦXt−1k2#≤E"kbΦ−Φk2F1TXtkXt−1k2#SincethevarianceofZtandthusXt−1isassumedtobeﬁniteandparameterestimationinVARprocessesisconsistent(L¨utkepohl,2010,Chapter3),theaboveexpressiongoestozeroforT→∞.Sincetherighthandsidein(12)vanishesasymptoticallyinexpectation,itfollowsthatlimT→∞E(cid:20)(cid:12)(cid:12)(cid:12)\HSIC(XT,bZT)−\HSIC(XT,ZT)(cid:12)(cid:12)(cid:12)2(cid:21)=0.SinceconvergenceinL2impliesconvergenceinprobabilityitfollowsthat\HSIC(XT,bZT)−\HSIC(XT,ZT)P→0.Togetherwith\HSIC(XT,ZT)P→HSIC(X0,Z0)thisimplies\HSIC(XT,bZT)P→HSIC(X0,Z0)(13)SinceXt6⊥⊥Zbwt+1ourstatement(11)followsbycombiningtheaboveconvergenceresult(13)with(9)and(10).7.DiscussionandfutureworkWehavederivedaframeworkfortheidentiﬁcationofthedirectionofmultivariatetimeseries.Byassumingthatthedatageneratingprocessexhibitslineardynamicsandnon-GaussiannoisewewereabletoextendtheresultsofPetersetal.(2009)tomultipledimen-sions.Inaddition,weprovideaconsistencyresultforouralgorithmthatcoversthoseofPetersetal.(2009)andPickupetal.(2014)asspecialcases.Theapproachworkswellonsimulatedandsomeﬁnancialdata.Theempiricalresultsforsimulateddatasetsindicatethatthedetectionofthetemporalorderingofatimesequencemightbepossibleaslongasoneelementofthenoisevectorisnormallydistributed,whichwouldbeslightlystrongerthanthetheoreticalguaranteeweprovide.Ingeneral,theperformancefordeterminingthedirectionofrealworldtimeseries(e.g.,videosnippets,seePickupetal.(2014))de-pendsonthevalidityofourassumptions;inparticular,thisincludeslineardynamicsandnon-Gaussianadditivenoise.Wefoundthatinthecaseofmodelmisspeciﬁcation,ourap-proachusuallyremainsundecidedratherthangivingincorrectanswers.Anextensionofourframeworktonon-lineardynamicscouldreducethenumberofnon-decisions.16ReferencesYahooﬁnance.Website,01.12.2015,4:55pm,2015.http://finance.yahoo.com/lookup.R.Bellmann.IntroductiontoMatrixAnalysis.SocietyforIndustrialandAppliedMathe-matics,1987.P.BrockwellandR.Davis.TimeSeries:TheoryandMethods.SpringerSeriesinStatistics,1991.K.ChwialkowskiandA.Gretton.Akernelindependencetestforrandompro-cesses.InProceedingsof31stInternationalConferenceonMachineLearning(ICML),arXiv:1402.4501,pages1422–1430,2014.P.Comon.Independentcomponentanalysis–anewconcept?SignalProcessing,36:287–314,1994.P.Doukhan.Mixing.SpringerNewYork,1994.A.Gretton,K.Fukumizu,C.Teo,L.Song,B.Sch¨olkopf,andA.Smola.Akernelstatisticaltestofindependence.InAdvancesinNeuralInformationProcessingSystems20(NIPS),2007.D.Hern´andez-Lobato,P.Morales-Mombiela,andA.Surez.Gaussianitymeasuresforde-tectingthedirectionofcausaltimeseries.InProceedingsofthe22ndInternationalJointConferenceonArtiﬁcialIntelligence(IJCAI),2011.D.Hern´andez-Lobato,P.Morales-Mombiela,D.Lopez-Paz,andA.Surez.Non-linearcausalinferenceusingGaussianitymeasures.arXivpreprintarXiv:1409.4573,2014.I.Ibragimov.OntheGhurye-Olkin-Zingertheorem.JournalofMathematicalSciences,199:174–183,2014.H.L¨utkepohl.NewIntroductiontoMultipleTimeSeriesAnalysis.Springer,2010.A.Mokkadem.MixingpropertiesofARMAprocesses.Stochasticprocessesandtheirap-plications,pages309–315,1988.J.Mooij,J.Peters,D.Janzing,J.Zscheischler,andB.Sch¨olkopf.Distinguishingcausefromeﬀectusingobservationaldata:methodsandbenchmarks.arXivpreprintarXiv:1412.3773,2014.P.Morales-Mombiela,D.Hern´andez-Lobato,andA.Surez.Statisticaltestsforthedetec-tionofthearrowoftimeinvectorautoregressivemodels.InProceedingsofthe23rdInternationalJointConferenceonArtiﬁcialIntelligence(IJCAI),2013.J.Peters,D.Janzing,A.Gretton,andB.Sch¨olkopf.Detectingthedirectionofcausaltimeseries.InProceedingsofthe26thAnnualInternationalConferenceonMachineLearning(ICML),2009.17L.Pickup,Z.Pan,D.Wei,Y.Shih,C.Zhang,A.Zisserman,B.Sch¨olkopf,andW.Free-man.Seeingthearrowoftime.InIEEEConferenceonComputerVisionandPatternRecognition(CVPR),2014.H.Price.Time’sarrowandArchimedes’point:newdirectionforthephysicsoftime.OxfordUniversityPress,1996.H.Reichenbach.Thedirectionoftime.UniversityofCaliforniaPress,Berkeley,1956.S.Shimizu,P.Hoyer,A.Hyv¨arinen,andA.Kerminen.Alinearnon-Gaussianacyclicmodelforcausaldiscovery.JournalofMachineLearningResearch,7:2003–2030,2006.R.Tsay.MultivariateTimeSeriesAnalysis:WithRandFinancialApplications.JohnWiley&Sons,2014.18