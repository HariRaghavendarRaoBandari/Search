6
1
0
2

 
r
a

M
2

 

 
 
]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[
 
 

1
v
9
9
5
0
0

.

3
0
6
1
:
v
i
X
r
a

Error correction in multi-ﬁdelity molecular dynamics
simulations using functional uncertainty quantiﬁcation

Samuel Reeve, Alejandro Strachan∗

School of Materials Engineering, Birck Nanotechnology Center, Purdue University, West

Lafayette, Indiana 47906, USA

Abstract

We use functional, Fr´echet, derivatives to quantify how thermodynamic out-
puts of a molecular dynamics (MD) simulation depend on the potential used
to compute atomic interactions. Our approach quantiﬁes the sensitivity of
the quantities of interest with respect to the input functions as opposed to
its parameters as is done in typical uncertainty quantiﬁcation methods. We
show that the functional sensitivity of the average potential energy and pres-
sure in isothermal, isochoric MD simulations using Lennard-Jones two-body
interactions can be used to accurately predict those properties for other in-
teratomic potentials (with diﬀerent functional forms) without re-running the
simulations. This is demonstrated under three diﬀerent thermodynamic con-
ditions, namely a crystal at room temperature, a liquid at ambient pressure,
and a high pressure liquid. The method provides accurate predictions as long
as the change in potential does not signiﬁcantly aﬀect the region in phase
space explored by the simulation. The functional uncertainty quantiﬁcation
approach can be used to estimate the uncertainties associated with consti-
tutive models used in the simulation and to correct predictions if a more
accurate representation becomes available.

Keywords: uncertainty quantiﬁcation, functional derivative, molecular
dynamics, interatomic potential, free energy calculation

∗Corresponding author.
Email addresses: sreeve@purdue.edu (Samuel Reeve), strachan@purdue.edu

(Alejandro Strachan )

Preprint submitted to Journal of Computational Physics

March 3, 2016

1. Introduction

Uncertainty quantiﬁcation (UQ) is becoming increasingly important in
predictive simulations of materials and devices [1]. While the majority of the
early UQ work focused on solid and ﬂuid mechanics, there is growing inter-
est in applying and extending UQ techniques to simulations at the material
level, including density functional theory [2, 3], molecular dynamics (MD)
[4, 5, 6, 7, 8], and multiscale methods [9, 10, 11]. These eﬀorts highlighted
the importance of acknowledging uncertainties in model parameters, from
measurement or averaging techniques, as well as intrinsic variability of the
systems or processes under investigation. These studies, and most UQ work
thus far, examined uncertainties in input parameters and specialized software
packages have been developed for this task: examples include DAKOTA [12],
PUQ [13], and Π4U [14]. However, in many applications – especially those
involving complex physics – accounting for uncertainty in parameters is not
enough, as the functional forms of the constitutive models themselves are
approximate. This is particularly true in materials modeling where lack of
knowledge leads to unquantiﬁed or poorly quantiﬁed uncertainties. Exam-
ples of input functions with varying degrees of accuracy include exchange and
correlation functionals used in density functional theory calculations [2, 15],
interatomic potentials for molecular dynamics (MD) [16, 17, 18], general-
ized stacking faults used in dislocation dynamics [19], and constitutive laws
for micromechanical simulations. In this paper we use functional derivatives
(FD), recently proposed as a mathematical framework to quantify uncertain-
ties that arise from constitutive models used in simulations [20], to quantify
and correct uncertainties that originate from the interatomic potential used
in MD simulations.

Functional uncertainty quantiﬁcation (FUQ) can, in principle, be used
to assess the uncertainties originating from approximate input constitutive
laws, correct predictions if a more accurate function becomes available, and
rank when and where to replace a low-ﬁdelity model used in a simulation
with one of higher ﬁdelity in order to reduce prediction error by running
additional simulations. This paper introduces a computationally eﬃcient
method to compute FDs in MD simulations involving two-body interatomic
potentials, extending ideas from thermodynamic integration and free-energy
perturbation methods [21, 22]. The FD quantiﬁes how a quantity of interest
(QoI) – in this case the total potential energy or pressure computed from an
MD simulation in the canonical ensemble – depends on the input function,

2

here the Lennard-Jones (LJ) two-body pair potential. We further show that
the FD with respect to the LJ potential can be used to compute accurate
correction to the potential energy and pressure for a family of pair potentials
without re-running the simulation. This is true as long as the discrepancy
between the potentials remains within reasonable bounds and the phase space
explored by the system with the new potential is not signiﬁcantly diﬀerent
from that of the original.

The remainder of the paper is as follows. Section 2 describes the func-
tional approach to UQ followed by simulation details and methods to cal-
culate the functional derivative numerically in Section 3.
In Section 4 we
describe speciﬁc examples of error correction using FUQ with low and high-
ﬁdelity models. Sections 5 and 6 discuss results and conclude the paper.

2. Functional uncertainty quantiﬁcation

In general, a simulation predicts a quantity of interest, Q, given some set
of input parameters Pi and constitutive functions fj, themselves functions of
an independent variable z and input parameters Nk:

Q = Q(Pi, fj(z, Nk))

(1)

In the cases of interest here, Q will be the time averaged potential energy or
pressure and f (z) the LJ potential as a function of interatomic distance used
in the MD simulation.

The most common form of UQ is concerned with uncertainty in simu-
lation outputs arising from uncertainty in the input parameters. This ap-
proach, while very valuable, ignores the fact that the functional forms used
as constitutive laws are, almost invariably, approximate and lead to errors in
the simulation. To quantify uncertainties with respect to input functions we
utilize functional derivatives (Fr´echet derivatives) of the QoI with respect to
the input functions. The FD can be written in diﬀerential form as:

δQ[f ]
δf (z)

(zi) = lim
→0

Q[f (z) +  · δ(z − zi)] − Q[f (z)]



(2)

This characterizes the functional sensitivity of the QoI with respect to the
input function. The deﬁnition in Eq. 2 uses the Dirac delta function as the
functional variation; as we describe below, to calculate the functional deriva-
tive numerically for the MD simulations we use narrow Gaussian distributions
centered at zi.

3

Besides quantifying uncertainties in the prediction given uncertain input
functions, the functional derivative can be used to correct the error that
arises from the use of a low-ﬁdelity model (f ) if a higher-ﬁdelity one (g)
becomes available. The correction is then obtained using the product of the
functional sensitivity (the FD) and functional discrepancy (g(z)− f (z)). We
call this product the functional error and the correction for the QoI is:

(cid:90) δQ[f ]

δf (z)

∆Q =

· (g(z) − f (z))dz

(3)

In the absence of a high-ﬁdelity model Eq. 3 can alternatively be used for
uncertainty propagation by replacing the discrepancy with the uncertainty
in f (z) and taking the absolute value of the functional derivative [20]. This
procedure returns a ﬁrst order bound of the uncertainty in Q.

Additionally, this equation can be used to rank high-ﬁdelity simulations
in order of their functional error to optimally reduce the error in the predicted
QoI, recently demonstrated with calculation of the functional derivative for
the restoring force in a multi-ﬁdelity radio frequency MEMS switch simu-
lation [20]. This functional derivative was used to rank model evaluations
and minimize the necessary computational cost to maximize error correction
in the simulation. In Section 3 we extend the formulation to a signiﬁcantly
more challenging problem: molecular dynamics simulations.

3. Functional derivatives in molecular dynamics

3.1. Systems of interest and simulation details

We demonstrate the FUQ method in molecular dynamics simulations
where the input function is the pairwise interatomic potential and the QoIs
are the potential energy and pressure (long-time averages) of the system. We
take the Lennard-Jones 12-6 potential as the low-ﬁdelity input function:

φ0 = 4((σ/r)12 − (σ/r)6)

(4)

and test the ability of FUQ to correct the prediction of the QoI for a family of
high-ﬁdelity potentials. The parameters for the low-ﬁdelity LJ potential are
designed to roughly describe copper (σ = 2.315˚A,  = 0.167eV ) [23], ﬁt to
the bulk melt temperature and room temperature lattice constant. We note
that this is not an accurate potential for Cu as it ignores important many
body eﬀects critical to describe elastic constants and defect energetics. Also

4

Table 1: High-ﬁdelity potential sine modiﬁcation terms
Name Modiﬁcation function
Sine 1
Sine 2 −0.47 sin(−0.15(14 + r)) · exp(−r)
Sine 3
Sine 4 −0.01 + 0.2 sin(0.3(14 + r)) · exp(−r)
Sine 5
Sine 6
Sine 7

0.44 + 0.46 sin(0.17(24.2 + r))
0.07 sin(1.2(−1.2 + r))/r2
0.7 sin(0.4(11 + r)) · exp(−r)
0.9 sin(0.4(11 + r)) · exp(−r)
1.1 sin(0.4(11 + r)) · exp(−r)

notable is the discrepancy of the liquid densities as compared to experiment
[24]. However, the goal of the paper is to demonstrate the applicability
of FUQ to an MD problem.
In this spirit, the high-ﬁdelity potentials are
similarly designed for demonstration purposes only and do not represent a
more accurate representation of an actual material. We construct seven pair
potentials by additively modifying the LJ potential with sine functions in
Table 1. This family of functions will be denoted Sine 1 to Sine 7.

A ﬁnal high-ﬁdelity model tested is the Morse potential, deﬁned as the

sum of two exponentials:

φ = D0(e−2α(r−r0) − 2e−α(r−r0))

(5)
We use D0 = 0.161eV , α = 2.09˚A−1, and r0 = 2.62˚A to similarly roughly
describe copper.

For all potentials a smoothing function is used to ensure stable dynamics
near the cutoﬀ. The function is of fourth order to create potential energy
and force curves that both smoothly tend to zero:

s(r) =

( (r−rc)
w )4
(1 + (r−rc)
w )4

(6)

where rc is the cutoﬀ distance and w is the width of the smoothing. For all
potentials the cutoﬀ is 5.79˚A (2.5σ, commonly used for LJ potentials) and
smoothing width 1.5˚A. Each potential curve is created by summing the base
equation and the modiﬁcation term and subsequently taking the product
with the smoothing function. The force curve is then created with product
rule diﬀerentiation of the potential. These potentials are shown in Figure 1.

5

Figure 1: Interatomic potentials used with inset taken from the dotted region. High-
ﬁdelity models obtained as sine modiﬁed LJ potentials are shown in color labeled with
numbers, low-ﬁdelity LJ with bold line in black, and Morse (M) with dashed line in gray.

Each system consists of 500 atoms simulated under isothermal, isochoric
conditions (canonical ensemble). Three physical states of the system were
simulated: one solid at ambient temperature and pressure (300K with density
of 9.02g/cm3), one liquid slightly above the melt temperature at ambient
pressure (1300K with density of 6.48g/cm3) and another liquid at extreme
temperature and pressure (5000K with density of 8.93g/cm3, corresponding
to 55GP a).

All MD simulations were performed using the LAMMPS package [25].
For each high-ﬁdelity potential we performed 16 independent simulations,
each 1 ns long, suﬃcient for good statistical sampling of the quantities of in-
terest. For each low-ﬁdelity potential, from which the functional derivatives
were calculated, the total sample time was 64 ns, similarly from 64 indepen-
dent simulations of 1 ns. The convergence of this sampling is shown in the
supplementary material.

3.2. Numerical functional derivatives and a perturbative approach for their

calculation

For the speciﬁc case of interest the functional derivative expression be-

comes:

δQ[φ]

δφ

(ri) = lim
→0

Q[φ0(r) +  · φ(cid:48)(r − ri)] − Q[φ0(r)]



6

(7)

where Q[φ] denotes the average QoI – the potential energy or pressure of the
system – using interatomic potential φ. The unmodiﬁed LJ potential is φ0
and φ(cid:48) a normalized Gaussian perturbation centered at interatomic distance
r = ri with width σ.

The functional derivative in Eq. 7 can be calculated by performing a set
of simulations with the low-ﬁdelity potential modiﬁed by perturbations of
varying  and computing a numerical derivative for each position ri. These
modiﬁed Lennard Jones potentials and resulting average potential energies
as a function of size of the perturbation  are shown in Fig. 2(a) and (b),
respectively. However, this brute force approach is computationally very
intensive considering that we may need to sample the functional derivative at
100 values of ri. Even with only three values of  for each separation distance
one would need to perform 300 separate MD simulations. To alleviate the
computational cost of the approach we now derive a perturbative approach to
calculate the functional derivative that can be computed with little overhead
with respect to the nominal simulation using the low-ﬁdelity potential, φ0.

At the heart of the calculation of the FD is the evaluation of canonical
averages of the QoIs with the interatomic potential and a Gaussian pertur-
bation. Recognizing that the modiﬁed Hamiltonian of the system can be ad-
ditively decomposed into the kinetic energy, the original LJ potential energy
and the functional variation (or perturbation) for these two-body potentials
we can write the canonical ensemble average of quantity Q as:

(8)
where H0 is the Hamiltonian with the LJ potential and H(cid:48) the potential
energy resulting from the Gaussian perturbation following form from Eq. 7.
Equation 8 can be re-written as the ratio between two canonical averages over

the unmodiﬁed Hamiltonian by multiplying by additional factors of(cid:82) e−βH0

and rearranging:

(cid:104)Q(cid:105)H = (cid:104)Q · e−βH(cid:48)(cid:105)H0 ·

1

(cid:104)e−βH(cid:48)(cid:105)H0

(9)

Since both canonical averages are over the unmodiﬁed potential only simu-
lation with the low-ﬁdelity potential is required. Therefore, computing the
functional derivatives requires evaluating the Gaussian perturbation poten-
tials on the trajectory obtained with the low-ﬁdelity model. Such expressions
are commonly used to compute free energies in thermodynamic integration
and free energy perturbation approaches [26, 27].

7

(cid:82) Q · e−βH0 · e−βH(cid:48)
(cid:82) e−βH0 · e−βH(cid:48)

(cid:104)Q(cid:105)H =

Figure 2: Calculation of the functional derivative with examples of modiﬁed interatomic
potentials a) and numerical derivatives with respect to perturbation height b). Perturba-
tions enlarged for visibility.

8

Quantities for the canonical average in Eq. 9 are computed every 1 ps with
a total of 48 ns of simulation time with the low-ﬁdelity LJ potential, deemed
well converged (see supplementary material). We evaluate these averages
using a binned coordination number with a total of 2000 bins to compute
H(cid:48) and Q (as it contains contributions from the perturbation), described in
more detail in the appendix. Use of the coordination number simply allows to
further reduce computation and avoid modifying the MD code. Performing
the calculation directly within the MD force loop with atomic positions would
be equivalent excluding slight discrepancies from discretization.

Using Eq. 7 with the ﬁrst term in the diﬀerence calculated using Eq. 9
we compute the functional derivative with respect to Gaussian perturbations
centered at ri with width σ = 0.1 ˚A and height  = ±0.00075 and ±0.00375
eV. The perturbation width was chosen to minimize (localize) the pertur-
bation while retaining suﬃcient sampling. The heights were similarly min-
imized, due to the diﬃculty of converging exponentially weighted averages,
while ensuring a measurable eﬀect from the perturbations. The numerical
derivative is then evaluated by computing the slope of the QoI with respect
to  (Fig. 2(b)) at a set of interatomic separations ranging from zero past
the potential cutoﬀ in increments of 0.05 ˚A.

The thick blue lines in Figure 3 show the functional derivatives obtained
in this manner for all physical conditions and both QoIs. These curves were
averaged from multiple calculations of the FD with independent randomized
samplings from the total of 64 ns of simulation time. The functional deriva-
tive displays signiﬁcant information about the physics of the systems. The
overall shapes correspond to the atomic shells as in the radial distribution
function – notably more pointed for the solid case. At very low separation
distances the FD goes to zero as atoms hit the soft-wall repulsion of the po-
tentials; for the extreme liquid system the atoms occupy smaller separations.
To assess the accuracy of the calculation the functional derivative was
also computed at equally spaced values of ri using the brute force approach
described above. For each value of ri we perform four MD simulations with
varying perturbations (identical to those in the perturbative approach) added
to the LJ potential as shown in Fig. 2(a) and obtain the functional derivative
with the same numerical derivatives as the perturbative approach. For each
separate perturbation the simulation was run for 16 ns (split between 16
independent systems). The results of the brute force approach are shown in
red in Fig. 3; the two methods of calculating the functional derivative are
nearly identical with only small numerical discrepancies.

9

Figure 3: Functional derivatives of the potential energy for the solid a) ambient liquid b)
and extreme liquid c) cases and of pressure for the solid d) ambient liquid e) and extreme
liquid f) cases. The perturbative method is shown in thick blue lines and the brute force
method in red lines with points.

10

4. Error correction using functional derivatives

To demonstrate our approach we now use the functional derivative calcu-
lated perturbatively in the previous section to correct the potential energy
and pressure predicted with the low-ﬁdelity LJ potential assuming a more ac-
curate function is available. As discussed in subsection 3.1, a family of seven
high-ﬁdelity potentials were created by modifying the LJ potential with sine
functions; see Figure 1 and Table 1. These results are discussed in sub-section
4.1; the results for the Morse potential are discussed in sub-section 4.2.

4.1. Corrections for sine modiﬁed potentials

In order to use Eq. 3 we need, in addition to the functional derivative, the
discrepancy function (φHF (r)− φLF (r)), the diﬀerence between the high and
low-ﬁdelity potentials. Figure 4 illustrates the functional derivative (a), the
discrepancy (b), and the product of the two, the functional error (c), each
as a function of interatomic distance for one case, the ambient liquid with
modiﬁed potential Sine 1. These results are shown for each physical case
and potential in the supplementary material. Note that the functional error
goes to zero both for small and large values of r; at small r it goes to zero
following the functional derivative (due to steep repulsion that keeps atoms
from coming close to one another), while for large distances the discrepancy
goes to zero as both potentials tend to zero at the same cutoﬀ.

The functional error was numerically integrated using the trapezoid rule
to obtain the total correction for the QoI. In order to verify these correc-
tion predictions we performed explicit MD simulations with the high-ﬁdelity
modiﬁed LJ potentials. Figure 5 compares the potential energy (a) and pres-
sure (b) diﬀerences explicitly simulated with low and high-ﬁdelity potentials
(gray) to the corrections obtained with FUQ (with colors matching those in
Fig. 1, as well as the hybrid LJ-Morse potential discussed in sub-section 4.2
in white). These results are shown in detail in Tables B.2 and B.3 in the
appendix.

For almost all cases, the FUQ predictions are in excellent agreement with
the direct simulations. Excluding only the Sine 6 and 7 potentials for the am-
bient liquid (discussed below) average error is 0.600% and 1.70% for potential
energy and pressure, respectively. We stress that these very accurate correc-
tions are obtained only making use of the the simulation with the unmodiﬁed
LJ potential, no additional MD simulations are required.

11

Figure 4: Method of calculating the cumulative functional error with examples of the
functional derivative a) the discrepancy b) and the product of the two c) for the ambient
liquid with the Sine 1 high-ﬁdelity potential. The shading shows the integrated area
contributing to the total correction.

12

Figure 5: Comparison of correction from FUQ (colors matching curves in Fig. 1, with
exception of the hybrid potential, shown in white and discussed in sub-section 4.2) and
direct simulation (gray). Each set of three bars shows the solid, ambient liquid, and
extreme liquid cases from left to right for each potential. Results for potential energy a)
and pressure b).

13

The ability of FUQ to correct the QoIs is impacted greatly by the degree
of phase space overlap between the high and low-ﬁdelity simulations. This
can be shown simply by the overlap in histograms of probability distributions
of diﬀerences in potential energy from the initial to ﬁnal state, a common
practice in free energy calculations [28]. In this case, the states refer to the
potential used and the distributions are taken from:

∆U0 = (U (φHF , ΓLF ) − U (φLF , ΓLF ))
∆U1 = (U (φLF , ΓHF ) − U (φHF , ΓHF ))

(10)

(11)

where each term is the energy with potential φ and set of samples in phase
space Γ = (x1, ..., xN) (each point dependent on the positions of the N atoms)
from the high or low-ﬁdelity potential trajectory. Examples are shown in Fig.
6.

Lack of phase space overlap and diﬀerence in probability distributions is
most signiﬁcant for the the ambient liquid with the Sine 6 and 7 potentials,
the same two cases with signiﬁcantly larger error. Further inspection of
the MD trajectory shows that the modiﬁed potential results in a structural
transformation while the unmodiﬁed LJ does not. This is shown in snapshots
included as insets in Fig. 6 comparing the atomic structures for the ambient
liquid with Sine 1 and Sine 7: the liquid undergoes cavitation for Sine 7 (and
to a lesser extent with Sine 5 and 6). Insets were created using the OVITO
software package [29]. Thus the low-ﬁdelity LJ explores a vastly diﬀerent
region in phase space as compared to that of the high-ﬁdelity Sine 7; however,
even under such unfavorable conditions FUQ is able to provide some level
of correction. In contrast, the solid cases have sharply peaked distributions
with strong overlap and correspondingly highly accurate predictions, with
the caveat of more diﬃcult convergence of the results. Histograms for all
physical cases and potentials are within the supplementary material.

The degree of similarity of phase space exploration can be further sum-
marized by plotting the average of ∆U0 against the average of ∆U1. The
closer to slope of unity, the more signiﬁcant the distribution overlap. Figure
7 gives results that agree with the histograms in Fig. 6 and supplementary
material; namely, for cases where the explored phase space for the low and
high-ﬁdelity trajectories is less similar and there is little histogram overlap,
the prediction error increases, particularly for the ambient liquid. Results
in this ﬁgure for the Morse (gray symbols) and hybrid LJ-Morse (white)
potentials are discussed in sub-section 4.2.

14

Figure 6: Examples of potential energy probability distributions showing various degrees
of overlap: solid with Sine 1 a) extreme liquid with Sine 1 b) ambient liquid with Sine
1 c) and ambient liquid with Sine 7 d). Overlap is close to zero for systems with phase
change in only one potential; inset d) shows an example of a void formed as compared to
the normal liquid in inset c).

15

Figure 7: Similarity in potential energy probability distribution peaks for all potentials
(colors matching Figures 1 and 5 with the exception of Morse in gray and hybrid LJ-
Morse in white, both discussed in sub-section 4.2). Solid, ambient liquid, and extreme
liquid shown with squares, circles, and triangles, respectively. The two plots are separated
to show detail.

16

Figure 8: Discrepancy between LJ and Morse potentials (red) and between hybrid LJ-
Morse and Morse (green). Both liquid perturbative functional derivatives shown in blue
to demonstrate the non-zero sensitivity at low separation distance.

4.2. Correction for the Morse potential and hybrid potential calculations

Predicting properties for the Morse potential from LJ further highlights
the challenge of attempting to correct a prediction made with a low-ﬁdelity
model. In this case the discrepancy between the two models is very large
for short interatomic distances, leading to near zero phase space overlap and
an inaccurate FUQ prediction for all physical cases. The red line in Figure
8 shows this discrepancy as a function of interatomic separation with the
functional derivatives from both liquid conditions in blue to demonstrate the
sensitivity to changes in the potential at these distances. The short range
repulsion is described with an exponential for Morse while LJ uses an inverse
power of 12. Thus the discrepancy between the two potentials diverges for
short distances and the functional derivative correction, being ﬁrst order,
produces extremely large errors. These results are therefore omitted from
Figure 5.

Our approach can, nevertheless, be useful in such circumstances, but the
high-ﬁdelity model cannot be fully replaced by the low-ﬁdelity one. Instead,
we create a hybrid potential in Eq. 12 that smoothly switches from the
low-ﬁdelity LJ to the high-ﬁdelity Morse between 2.8 and 2.4˚A using error
functions, leading to a discrepancy of reasonable magnitude shown in green
in Figure 8.

17

φLJ (r)

φHybrid =

r ≥ 2.8

φLJ (r) · [B(r) + 0.5] + φM orse(r) · [−B(r) + 0.5] 2.8 > r > 2.4
φM orse(r)

2.4 ≥ r

B(r) = 0.5 erf(8(r − 2.6))

(12)
(13)

With the hybrid potential in Eq. 12 the high-ﬁdelity model is used only where
necessary. This is similar in spirit to adaptive sampling methods in multi-
scale simulations, with examples in the literature [30, 31, 32] and codes avail-
able: the Co-design Embedded Visco-Plasticity Proxy Application (CoEVP)
[33] and the Co-design Heterogeneous Multiscale Method Proxy Application
(CoHMM) [34].

It is then possible to use FUQ to correct a low-ﬁdelity simulation run
with this hybrid potential to the result with the high-ﬁdelity Morse by using
the discrepancy between the two potentials and the functional derivative of
the hybrid potential. The hybrid potential reduces the discrepancy and the
functional approach provides an accurate correction for all cases, as shown
with the white bars in Figure 5. The solid case correction shows an ad-
ditional example of increased error, again due to poor overlap in explored
phase space between the two potentials (see supplementary material). Even
with these signiﬁcantly diﬀerent systems FUQ provides the majority of the
necessary correction. Further, all predictions for Morse from the hybrid po-
tential (white symbols) lie near the unity line in Fig. 7 (describing good
agreement between the phase space of each trajectory) in contrast to Morse
from LJ (gray symbols), furthest from the line. We note that the high-ﬁdelity
model needs to be used during the actual simulation; however, only approx-
imately 12% of the atomic force calculations fall in the range requiring the
high-ﬁdelity model. Thus, if the high-ﬁdelity model was signiﬁcantly more
intensive than the low-ﬁdelity the methodology would still greatly reduce
computational cost.

5. Discussion

The perturbative method to obtain the functional derivatives described
here is similar to techniques in free energy methods: free energy perturbation
and thermodynamic integration [35, 36]. One subset of these methods most

18

comparable to FUQ and often used in biology simulations, referred to as com-
puter alchemy, is utilized to calculate free energy changes along non-physical
paths as potentials are slowly turned on or oﬀ for the various molecules or
solvents of interest [37, 38, 39, 40]. These methods share with the work de-
scribed here the need to sample from the phase space trajectory of an initial
state (often a simple reference state for free energy calculations, e.g. the Ein-
stein crystal), ensure that phase space is not too dissimilar to that of the ﬁnal
state of interest, and to converge exponentially weighted averages. However,
while free energy methods generally focus on a single path from initial to ﬁnal
state (or a bidirectional path), using FUQ, once the functional derivative is
calculated for a given low-ﬁdelity model, the corrections can be made with
respect to any other high-ﬁdelity model as long as minimum conditions are
satisﬁed. If the low-ﬁdelity simulation does not explore the regions of phase
space relevant for the high-ﬁdelity potential at the conditions of interest the
results will be poor; this is most striking when switching potentials results
in a structural phase transition. This phase space overlap should be checked
as demonstrated here to ensure meaningful results as with free energy meth-
ods. Additionally, the functional derivative correction can only be used with
a functional discrepancy such that its eﬀect can be described to ﬁrst order.
We also note that the perturbative approach used here is applicable only to
input functions that appear linearly in the Hamiltonian so the perturbation
can be separated additively. This is not a general limitation of FUQ but of
the speciﬁc approach used here to obtain the functional derivatives.

This work demonstrates FUQ in equilibrium simulations. Continuing
work should include investigation of functional derivatives in non-equilibrium
processes as an analog of the relationships between free energy perturbation
and non-equilibrium work methods in free energy calculations. The method
can be generally used in equilibrium MD simulations and numerous other
physics problems including multi-scale simulations. Ongoing investigations
will include using FUQ to correct predictions in solid mechanics with the
plasticity model as the input constitutive law.

An important advantage of FUQ over uncertainty propagation in param-
eters is that it enables changes in the actual functional forms used in the
simulation. In our example, we are not limited to Lennard-Jones potentials
with diﬀerent parameters but can change the shape of the potential (with
the limitations discussed above).

19

6. Conclusions

In summary we demonstrated the ability to calculate functional deriva-
tives of a quantity of interest predicted by a non-trivial physics simulation
with respect to its input laws. This information can be used to quantify the
uncertainties originating in the simulation due to the use of the input func-
tion or to correct the prediction if a more accurate model becomes available.
We developed a computationally eﬃcient approach to compute the functional
derivative in a MD simulations performed using the Lennard-Jones poten-
tial and shows that this information can be used to infer thermodynamic
properties corresponding to various other potentials without re-running the
simulation. The functional uncertainty quantiﬁcation approach is quite gen-
erally applicable and we believe it will be useful to quantify uncertainties in
a variety of materials models.

Appendix A. Thermodynamic quantities using coordination num-

ber

The calculation of the functional derivative using the perturbative ap-
proach (Eq. 7 and 9) is expanded upon here, beginning with the contribu-
tion to the Hamiltonian from the perturbation. This quantity can be directly
calculated with a sum over all pairs of atoms as the potential energy in any
MD simulation:

(A.1)

(cid:88)

i<j

H(cid:48) =

φ(cid:48)(rij)

(cid:88)

k

H(cid:48) =

N
2

This would require modiﬁcation of the MD code to calculate this quantity
within the force loop or summing over a saved atomic trajectory. This ex-
pression can be replaced:

φ(cid:48)(rk) · c(rk)

(A.2)

where c(r) is the average coordination number at a given separation distance
r, discretized into k bins and N the number of atoms. This is neither invasive
to the code, nor requires signiﬁcant storage or computation past the low-
ﬁdelity simulation.

With the potential energy as the QoI, Q is simply the sum of Eq. A.2
and the low-ﬁdelity simulation potential energy. For the pressure we use the

20

virial expression (without the small ideal gas contribution as it is already
present in the low-ﬁdelity pressure):

fijrij

(A.3)

P (cid:48) =

1
3V

P (cid:48) =

1
3V

(cid:88)

i<j

(cid:88)

i<j

(cid:88)

k

Because we examine cases of two-body central forces this can be simpliﬁed:

f (rij)rij

(A.4)

and with the same motivations as above, we rewrite in terms of the coordi-
nation number, again with k bins in separation distance:

P (cid:48) =

N
2

1
3V

f (rk) · r · c(rk)

(A.5)

This quantity, added to the low-ﬁdelity simulation pressure, provides Q

in Eq. 9 for the QoI pressure.

Appendix B. Correction results

Tables B.2 and B.3 show full results for all physical conditions for poten-
tial energy and pressure, respectively. Figure 5 compares columns ∆QSim and
∆QF U Q. All results here are calculated with respect to the LJ low-ﬁdelity
potential, except the rows marked with (H). Those cases use the low-ﬁdelity
hybrid LJ-Morse potential.

Acknowledgments

This research was supported by the US Department of Energy (DOE),
Oﬃce of Advanced Scientiﬁc Computing Research (ASCR) through the Ex-
ascale Co-Design Center for Materials in Extreme Environments (ExMatEx,
exmatex.org). Computational resources of nanoHUB.org are gratefully ac-
knowledged.

21

Table B.2: Comparison of potential energy correction from functional derivatives and
direct simulation.
Temp. Potential

∆QSim ∆QF U Q ∆Q

QLF +
∆QF U Q

% Error
-
0.456
0.784
0.793
0.0132
0.988
0.993
0.995
21.9
5.89
0.0158
1.23
0.588
0.160
1.08
12.1
18.0
14.3
0.0295
0.136
0.896
0.477
0.441
0.932
0.959
1.01
93.1
0.376

-0.196
0.152
0.0522
-0.235
-0.259
-0.333
-0.407
0.0628
0.0520
-0.146
0.103
0.0379
-0.164
-0.172
-0.221
-0.271
0.0416
0.0295
-0.200
0.157
0.0527
-0.239
-0.267
-0.343
-0.420
0.00547
0.0455

QLF

QHF

(K)
300
300
300
300
300
300
300
300
300
1300
1300
1300
1300
1300
1300
1300
1300
1300
5000
5000
5000
5000
5000
5000
5000
5000
5000

-
Sine 1
Sine 2
Sine 3
Sine 4
Sine 5
Sine 6
Sine 7
Morse
Morse (H)
Sine 1
Sine 2
Sine 3
Sine 4
Sine 5
Sine 6
Sine 7
Morse
Morse (H)
Sine 1
Sine 2
Sine 3
Sine 4
Sine 5
Sine 6
Sine 7
Morse
Morse (H)

-1.08
-1.08
-1.08
-1.08
-1.08
-1.08
-1.08
-1.08
-1.05
-0.704
-0.704
-0.704
-0.704
-0.704
-0.704
-0.704
-0.704
-0.703
-0.398
-0.398
-0.398
-0.398
-0.398
-0.398
-0.398
-0.398
-0.366

(eV/atom)

-1.27
-0.927
-1.03
-1.31
-1.34
-1.41
-1.49
-1.02
-1.00
-0.850
-0.601
-0.666
-0.868
-0.876
-0.925
-0.974
-0.662
-0.673
-0.598
-0.241
-0.345
-0.637
-0.665
-0.741
-0.818
-0.393
-0.320

-0.197
0.151
0.0518
-0.235
-0.256
-0.330
-0.403
0.0804
0.0552
-0.146
0.102
0.0377
-0.164
-0.174
-0.252
-0.330
0.0485
0.0295
-0.200
0.155
0.0524
-0.238
-0.265
-0.340
-0.416
0.0774
0.0454

-1.28
-0.928
-1.03
-1.31
-1.33
-1.41
-1.48
-0.998
-0.998
-0.850
-0.602
-0.666
-0.867
-0.878
-0.956
-1.03
-0.655
-0.673
-0.598
-0.243
-0.346
-0.636
-0.663
-0.738
-0.814
-0.321
-0.320

22

Table B.3: Comparison of pressure correction from functional derivatives and direct sim-
ulation.
Temp. Potential

∆QSim ∆QF U Q ∆Q

QLF

QHF

QLF +
∆QF U Q
(GPa)
-3.25
2.70
0.538
-4.05
-5.07
-6.48
-7.90
-1.31
1.49
-1.13
1.36
0.562
-1.62
-2.03
-2.65
-3.26
-0.359
0.463
51.6
57.1
55.1
50.6
49.5
48.2
46.8
36.8
39.8

-3.26
2.81
0.630
-4.01
-4.91
-6.32
-7.72
1.54
0.781
-1.25
1.24
0.434
-1.71
-2.00
-1.88
-1.87
-0.0558
0.344
-2.77
2.72
0.7413
-3.80
-4.81
-6.18
-7.53
-14.6
0.796

-3.13
2.81
0.654
-3.94
-4.95
-6.37
-7.78
-1.19
0.998
-1.26
1.23
0.433
-1.75
-2.16
-2.77
-3.391
-0.488
0.338
-2.77
2.74
0.750
-3.81
-4.84
-6.23
-7.61
-17.5
0.794

% Error
-
3.89
0.279
3.75
1.73
0.763
0.792
0.805
177
27.7
1.44
0.498
0.219
2.34
7.70
47.3
81.5
774
1.68
0.0187
0.905
1.17
0.161
0.704
0.845
1.12
20.1
0.279

(K)
300
300
300
300
300
300
300
300
300
1300
1300
1300
1300
1300
1300
1300
1300
1300
5000
5000
5000
5000
5000
5000
5000
5000
5000

-
Sine 1
Sine 2
Sine 3
Sine 4
Sine 5
Sine 6
Sine 7
Morse
Morse (H)
Sine 1
Sine 2
Sine 3
Sine 4
Sine 5
Sine 6
Sine 7
Morse
Morse (H)
Sine 1
Sine 2
Sine 3
Sine 4
Sine 5
Sine 6
Sine 7
Morse
Morse (H)

-0.116
-0.116
-0.116
-0.116
-0.116
-0.116
-0.116
-0.116
0.491
0.129
0.129
0.129
0.129
0.129
0.129
0.129
0.129
0.124
54.4
54.4
54.4
54.4
54.4
54.4
54.4
54.4
39.0

-3.37
2.69
0.514
-4.12
-5.03
-6.43
-7.83
1.43
1.27
-1.12
1.37
0.563
-1.58
-1.87
-1.75
-1.74
0.0733
0.469
51.6
57.1
55.1
50.6
49.6
48.2
46.9
39.8
39.8

23

References

[1] A. Chernatynskiy, S. R. Phillpot, R. LeSar, Uncertainty quantiﬁcation
in multiscale simulation of materials: A prospective, Annu. Rev. Mater.
Res. 43 (1) (2013) 157–182.
URL http://dx.doi.org/10.1146/annurev-matsci-071312-121708

[2] J. J. Mortensen, K. Kaasbjerg, S. L. Frederiksen, J. K. Nørskov, J. P.
Sethna, K. W. Jacobsen, Bayesian error estimation in density-functional
theory, Phys. Rev. Lett. 95 (21).
URL http://dx.doi.org/10.1103/PhysRevLett.95.216401

[3] N. L. Anderson, R. P. Vedula, P. A. Schultz, R. M. V. Ginhoven, A. Stra-
chan, Defect level distributions and atomic relaxations induced by charge
trapping in amorphous silica, Appl. Phys. Lett. 100 (17) (2012) 172908.
URL http://dx.doi.org/10.1063/1.4707340

[4] F. Rizzi, H. N. Najm, B. J. Debusschere, K. Sargsyan, M. Salloum,
H. Adalsteinsson, O. M. Knio, Uncertainty quantiﬁcation in MD simu-
lations. Part I: Forward propagation, Multiscale Modeling & Simulation
10 (4) (2012) 1428–1459.
URL http://dx.doi.org/10.1137/110853169

[5] F. Rizzi, R. E. Jones, B. J. Debusschere, O. M. Knio, Uncertainty quan-
tiﬁcation in MD simulations of concentration driven ionic ﬂow through
a silica nanopore. I. Sensitivity to physical parameters of the pore, The
Journal of Chemical Physics 138 (19) (2013) 194104.
URL http://dx.doi.org/10.1063/1.4804666

[6] P. Angelikopoulos, C. Papadimitriou, P. Koumoutsakos, Data driven,
predictive molecular dynamics for nanoscale ﬂow simulations under un-
certainty, The Journal of Physical Chemistry B 117 (47) (2013) 14808–
14816.
URL http://dx.doi.org/10.1021/jp4084713

[7] C. Kim, O. Borodin, G. E. Karniadakis, Quantiﬁcation of sampling un-
certainty for molecular dynamics simulation: Time-dependent diﬀusion
coeﬃcient in simple ﬂuids, Journal of Computational Physics 302 (2015)
485–508.
URL http://dx.doi.org/10.1016/j.jcp.2015.09.021

24

[8] P. N. Patrone, A. Dienstfrey, A. R. Browning, S. Tucker, S. Christensen,
Uncertainty quantiﬁcation in molecular dynamics studies of the glass
transition temperature, Polymer 87 (2016) 246–259.
URL http://dx.doi.org/10.1016/j.polymer.2016.01.074

[9] M. Koslowski, A. Strachan, Uncertainty propagation in a multiscale
model of nanocrystalline plasticity, Reliability Engineering & System
Safety 96 (9) (2011) 1161–1170.
URL http://dx.doi.org/10.1016/j.ress.2010.11.011

[10] H. Kim, N. H. Shaik, X. Xu, A. Raman, A. Strachan, Multiscale contact
mechanics model for RF-MEMS switches with quantiﬁed uncertainties,
Modelling and Simulation in Materials Science and Engineering 21 (8)
(2013) 085002.
URL http://dx.doi.org/10.1088/0965-0393/21/8/085002

[11] R. P. Vedula, S. Palit, M. A. Alam, A. Strachan, Role of atomic variabil-
ity in dielectric charging: A ﬁrst-principles-based multiscale modeling
study, Phys. Rev. B 88 (20).
URL http://dx.doi.org/10.1103/PhysRevB.88.205204

[12] B. Adams, M. Ebeida, M. Eldred, J. Jakeman, L. Swiler, J. Stephens,
D. Vigil, T. Wildey, W. Bohnhoﬀ, J. Eddy, K. Hu, K. Dalbey, L. Bau-
man, P. Hough, Dakota, a multilevel parallel object-oriented framework
for design optimization, parameter estimation, uncertainty quantiﬁca-
tion, and sensitivity analysis: Version 6.0 theory manual, Tech. rep.,
Oﬃce of Scientiﬁc and Technical Information (OSTI) (May 2014).
URL http://dx.doi.org/10.2172/1177048

[13] M. Hunt, B. Haley, M. McLennan, M. Koslowski, J. Murthy, A. Stra-
chan, PUQ: A code for non-intrusive uncertainty propagation in com-
puter simulations, Computer Physics Communications 194 (2015) 97–
107.
URL http://dx.doi.org/10.1016/j.cpc.2015.04.011

[14] P. Hadjidoukas, P. Angelikopoulos, C. Papadimitriou, P. Koumout-
sakos, Π4U: A high performance computing framework for Bayesian
uncertainty quantiﬁcation of complex models, Journal of Computational
Physics 284 (2015) 1–21.
URL http://dx.doi.org/10.1016/j.jcp.2014.12.006

25

[15] M. Aldegunde, J. R. Kermode, N. Zabaras, Development of an exchange-
correlation functional with uncertainty quantiﬁcation capabilities for
density functional theory, Journal of Computational Physics 311 (2016)
173–195.
URL http://dx.doi.org/10.1016/j.jcp.2016.01.034

[16] F. Rizzi, H. N. Najm, B. J. Debusschere, K. Sargsyan, M. Salloum,
H. Adalsteinsson, O. M. Knio, Uncertainty quantiﬁcation in MD simu-
lations. Part II: Bayesian inference of force-ﬁeld parameters, Multiscale
Modeling & Simulation 10 (4) (2012) 1460–1492.
URL http://dx.doi.org/10.1137/110853170

[17] F. Rizzi, R. E. Jones, B. J. Debusschere, O. M. Knio, Uncertainty quan-
tiﬁcation in MD simulations of concentration driven ionic ﬂow through
a silica nanopore. II. Uncertain potential parameters, The Journal of
Chemical Physics 138 (19) (2013) 194105.
URL http://dx.doi.org/10.1063/1.4804669

[18] K. Farrell, J. T. Oden, D. Faghihi, A Bayesian framework for adaptive
selection, calibration, and validation of coarse-grained models of atom-
istic systems, Journal of Computational Physics 295 (2015) 189–208.
URL http://dx.doi.org/10.1016/j.jcp.2015.03.071

[19] L. Cao, A. Hunter, I. J. Beyerlein, M. Koslowski, The role of partial me-
diated slip during quasi-static deformation of 3D nanocrystalline metals,
Journal of the Mechanics and Physics of Solids 78 (2015) 415–426.
URL http://dx.doi.org/10.1016/j.jmps.2015.02.019

[20] A. Strachan, S. Mahadevan, V. Hombal, L. Sun, Functional derivatives
for uncertainty quantiﬁcation and error estimation and reduction via
optimal high-ﬁdelity simulations, Modelling and Simulation in Materials
Science and Engineering 21 (6) (2013) 065009.
URL http://dx.doi.org/10.1088/0965-0393/21/6/065009

[21] D. Frenkel, B. Smit, Understanding Molecular Simulation, 2nd Edition,

Academic Press, Inc., Orlando, FL, USA, 2001.

[22] C. Chipot, A. Pohorille (Eds.), Free Energy Calculations, Springer

Berlin Heidelberg, 2007.
URL http://dx.doi.org/10.1007/978-3-540-38448-9

26

[23] D. Wolf, S. Yip (Eds.), Materials interfaces: Atomic—level structure

and properties, 1st Edition, Chapman and Hall, London, 1992.

[24] J. A. Cahill, A. D. Kirshenbaum, The density of liquid copper from its
melting point 1356◦K to 2500◦K and an estimate of its critical constants,
The Journal of Physical Chemistry 66 (6) (1962) 1080–1082.
URL http://dx.doi.org/10.1021/j100812a027

[25] S. Plimpton, Fast parallel algorithms for short-range molecular dynam-

ics, Journal of Computational Physics 117 (1) (1995) 1–19.
URL http://dx.doi.org/10.1006/jcph.1995.1039

[26] T. P. Straatsma, J. A. McCammon, Computational alchemy, Annual

Review of Physical Chemistry 43 (1) (1992) 407–435.
URL http://dx.doi.org/10.1146/annurev.pc.43.100192.002203

[27] P. Kollman, Free energy calculations: Applications to chemical and bio-

chemical phenomena, Chemical Reviews 93 (7) (1993) 2395–2417.
URL http://dx.doi.org/10.1021/cr00023a004

[28] A. Pohorille, C. Jarzynski, C. Chipot, Good practices in free-energy cal-
culations, The Journal of Physical Chemistry B 114 (32) (2010) 10235–
10253.
URL http://dx.doi.org/10.1021/jp102971x

[29] A. Stukowski, Visualization and analysis of atomistic simulation data
with OVITO—the OpenVisualization Tool, Modelling and Simulation
in Materials Science and Engineering 18 (1) (2010) 015012.
URL http://stacks.iop.org/0965-0393/18/i=1/a=015012

[30] J. Knap, N. R. Barton, R. D. Hornung, A. Arsenlis, R. Becker, D. R.
Jeﬀerson, Adaptive sampling in hierarchical simulation, International
Journal for Numerical Methods in Engineering 76 (4) (2008) 572–600.
URL http://dx.doi.org/10.1002/nme.2339

[31] N. R. Barton, J. V. Bernier, J. Knap, A. J. Sunwoo, E. K. Cerreta,
T. J. Turner, A call to arms for task parallelism in multi-scale materials
modeling, International Journal for Numerical Methods in Engineering
86 (6) (2011) 744–764.
URL http://dx.doi.org/10.1002/nme.3071

27

[32] D. Roehm, R. S. Pavel, K. Barros, B. Rouet-Leduc, A. L. McPherson,
T. C. Germann, C. Junghans, Distributed database kriging for adaptive
sampling (D2KAS ), Computer Physics Communications 192 (2015) 138–
147.
URL http://dx.doi.org/10.1016/j.cpc.2015.03.006

[33] M. Dorr, N. Barton, J. Keasler, F. Li, CoEVP: A co-design embed-
ded viscoplasticity scale-bridging proxy app for ExMatEx, Tech. rep.,
Lawrence Livermore National Laboratory (Jun 2014).

[34] B. Rouet-Leduc, K. Barros, E. Cieren, V. Elango, C. Junghans, T. Look-
man, J. Mohd-Yusof, R. S. Pavel, A. Y. Rivera, D. Roehm, A. L.
McPherson, T. C. Germann, Spatial adaptive sampling in multiscale
simulation, Computer Physics Communications 185 (7) (2014) 1857–
1864.
URL http://dx.doi.org/10.1016/j.cpc.2014.03.011

[35] P. Bash, U. Singh, R. Langridge, P. Kollman, Free energy calculations

by computer simulation, Science 236 (4801) (1987) 564–568.
URL http://dx.doi.org/10.1126/science.3576184

[36] M. Karplus, G. A. Petsko, Molecular dynamics simulations in biology,

Nature 347 (6294).
URL http://dx.doi.org/10.1038/347631a0

[37] J. Gumbart, B. Roux, Determination of membrane-insertion free en-
ergies by molecular dynamics simulations, Biophysical Journal 102 (4)
(2012) 795–801.
URL http://dx.doi.org/10.1016/j.bpj.2012.01.021

[38] J. He, C. Chipot, X. Shao, W. Cai, Cooperative recruitment of ampho-
tericin b mediated by a cyclodextrin dimer, J. Phys. Chem. C 118 (41)
(2014) 24173–24180.
URL http://dx.doi.org/10.1021/jp507325j

[39] J. T. Wescott, L. R. Fisher, S. Hanna, Use of thermodynamic integration
to calculate the hydration free energies of n-alkanes, The Journal of
Chemical Physics 116 (6) (2002) 2361.
URL http://dx.doi.org/10.1063/1.1431588

28

[40] M. Lawrenz, J. Wereszczynski, J. M. Ortiz-S´anchez, S. E. Nichols, J. A.
McCammon, Thermodynamic integration to predict host-guest binding
aﬃnities, Journal of Computer-Aided Molecular Design 26 (5) (2012)
569–576.
URL http://dx.doi.org/10.1007/s10822-012-9542-5

29

