6
1
0
2

 
r
a

M
3

 

 
 
]

.

O
C
h
t
a
m

[
 
 

1
v
8
5
0
1
0

.

3
0
6
1
:
v
i
X
r
a

Rich square-free words

Jetro Vesti

University of Turku, Department of Mathematics and Statistics, 20014 Turku, Finland

Abstract

A word w is rich if it has |w| + 1 many distinct palindromic factors, including the empty
word. A word is square-free if it does not have a factor uu, where u is a non-empty word.

Pelantov´a and Starosta (Discrete Math. 313 (2013)) proved that every inﬁnite rich word
contains a square. We will give another proof for that result. Pelantov´a and Starosta denoted
by r(n) the length of a longest rich square-free word on an alphabet of size n. The exact
value of r(n) was left as an open question. We will give an upper and a lower bound for
r(n), and make a conjecture that our lower bound is exact.

We will also generalize the notion of repetition threshold for a limited class of inﬁnite
words. The repetition thresholds for episturmian and rich words are left as an open question.

Keywords: Combinatorics on words, Palindromes, Rich words, Square-free words,
Repetition threshold.
2000 MSC: 68R15

1. Introduction

In recent years, rich words and palindromes have been studied extensively in combina-
torics on words. A word is a palindrome if it is equal to its reversal. In [DJP], the authors
proved that every word w has at most |w| + 1 many distinct palindromic factors, including
the empty word. The class of words which achieve this limit was introduced in [BHNR]
with the term full words. When the authors of [GJWZ] studied these words thoroughly
they called them rich (in palindromes). Rich words have been studied in various papers, for
example in [AFMP], [BDGZ1], [BDGZ2], [DGZ], [RR] and [V].

The defect of a ﬁnite word w, denoted D(w), is deﬁned as D(w) = |w| + 1 − |Pal(w)|,
where Pal(w) is the set of palindromic factors in w. The defect of an inﬁnite word w is

Email address: jejove@utu.fi (Jetro Vesti)

Preprint submitted to Theoretical Computer Science

March 4, 2016

deﬁned as D(w) = sup{D(u)| u is a factor of w}. In other words, the defect tells how many
palindromes the word is lacking. Rich words are exactly those whose defect is equal to 0.

The authors of [PS] proved, in Theorem 4 of the article, that every recurrent word with
ﬁnite Θ-defect contains inﬁnitely many overlapping factors. An overlapping word is a word
of form uuv, where v is a non-empty preﬁx of u. A word is a Θ-palindrome if it is a ﬁxed point
of an involutive antimorphism Θ. The reversal mapping R is an involutive antimorphism,
which means that if Θ = R then Θ-defect is equal to the defect. This means Theorem 4
in [PS] holds also for normal defect and normal palindromes. In this article we will restrict
ourselves to the case where Θ is the reversal mapping.

Since every rich word has a ﬁnite defect and every overlapping factor uuv has a square
uu, a corollary of Theorem 4 in [PS] is that every recurrent rich word contains a square.
This was noted in [PS] as Remark 6, where the word recurrent was replaced with inﬁnite.
This can be done, since every inﬁnite rich word x has a recurrent point y in the shift orbit
closure of x (see e.g. Section 4 of [Q]). We know y has a square, which means x has a square.
In Corollary 2.8 of our article, we will give another proof of the result in Remark 6 of [PS].
In Remark 6 of [PS] there was also noted that since every rich square-free word is ﬁnite,
we can look for a longest one. The length of a longest such word, on an alphabet of size n,
was denoted by r(n). An explicit formula for r(n) was left as an open question.

In Section 2.1 we will construct recursively a sequence of rich square-free words, the
lengths of which give us a lower bound for r(n). We will also make a conjecture that r(n)
can be achieved using these words. In Section 2.2 we will prove an upper bound for r(n).

1.1. Repetition threshold

Square-free words are a special case of unavoidable repetitions of words, which has been
a central topic in combinatorics on words since Thue (see [T1] and [T2]). The repetition
threshold, on an alphabet of size n, is the smallest number r such that there exists an inﬁnite
word which avoids greater than r-powers. This number is denoted by RT (n) and it was
ﬁrst studied in [D], where Dejean gave her famous conjecture. This conjecture has now been
proven, in many parts and by several authors (see [R] and [CR]).

√5+1

The repetition threshold can be studied also for a limited class of inﬁnite words. In [MP],
it was proven that the inﬁnite Fibonacci word does not contain a power with exponent greater
than 2 + ϕ, where ϕ is the golden ratio
, but every smaller fractional power is contained.
In [CD], the authors proved that among Sturmian words, the Fibonacci word is optimal
with respect to this property. Sturmian words are equal to episturmian words when n = 2
(see [DJP]). This means the episturmian repetition threshold for n = 2 is 2 + ϕ, denoted
ERT (2) = 2 + ϕ. From [GJ], we get that the n-bonacci word is episturmian and it has
critical exponent 2 + 1/(ϕn − 1), where ϕn is the generalized golden ratio. This means
ERT (n) ≤ 2 + 1/(ϕn − 1). Notice, from [HPS] we get that ϕn converges to 2.

2

2

In the same way, we deﬁne the rich repetition threshold RRT (n). From [PS] we get
that RRT (n) ≥ 2. Since episturmian words are rich (see [DJP]), we also know RRT (n) ≤
2 + 1/(ϕn − 1) and ERT (n) ≥ 2. This means 2 ≤ RRT (n), ERT (n) ≤ 2 + 1/(ϕn − 1). The
exact values of ERT (n) and RRT (n) are left as an open problem.

Open problem 1.1. Determine the repetition threshold for episturmian words and for rich
words, on an alphabet of size n.

1.2. Preliminaries

An alphabet A is a non-empty ﬁnite set of symbols, called letters. A word is a ﬁnite
sequence of letters from A. The empty word ǫ is the empty sequence. The set A∗ of all ﬁnite
words over A is a free monoid under the operation of concatenation. The set Alph(w) is the
set of all letters that occur in w. If |Alph(w)| = n then we say that w is n-ary.

An inﬁnite word is a sequence indexed by N with values in A. We denote the set of all

inﬁnite words over A by Aω and deﬁne A∞ = A∗ ∪ Aω.

The length of a word w = a1a2 . . . an, with each ai ∈ A, is denoted by |w| = n. The
empty word ǫ is the unique word of length 0. By |w|a we denote the number of occurrences
of a letter a in w.

A word x is a factor of a word w ∈ A∞, denoted x ∈ w, if w = uxv for some u ∈ A∗,v ∈
A∞. If x is not a factor of w, we denote x /∈ w. If u = ǫ (resp. v = ǫ) then we say that x
is a preﬁx (resp. suﬃx ) of w. If w = uv ∈ A∗ is a word, we use the notation u−1w = v or
wv−1 = u to mean the removal of a preﬁx or a suﬃx of w. We say that a preﬁx or a suﬃx
of w is proper if it is not the whole w.

A factor x of a word w is said to be unioccurrent in w if x has exactly one occurrence
in w. Two occurrences of factor x are said to be consecutive if there is no occurrence of x
between them. A factor of w having exactly two occurrences of a non-empty factor u, one
as a preﬁx and the other as a suﬃx, is called a complete return to u in w.

The reversal of w = a1a2 . . . an is deﬁned as ew = an . . . a2a1. A word w is called a
Other basic deﬁnitions and notation in combinatorics on words can be found from

palindrome if w = ew. The empty word ǫ is assumed to be a palindrome.
Lothaire’s books [Lot1] and [Lot2].

Proposition 1.2. ([DJP], Prop. 2) A word w has at most |w| + 1 distinct palindromic
factors, including the empty word.

Deﬁnition 1.3. A word w is rich if it has exactly |w| + 1 distinct palindromic factors,
including the empty word. An inﬁnite word is rich if all of its factors are rich.

Proposition 1.4. ([GJWZ], Thm. 2.14) A ﬁnite or inﬁnite word w is rich if and only if
all complete returns to any palindromic factor in w are themselves palindromes.

3

Let w = vu be a word and u its longest palindromic suﬃx. The palindromic closure of
w is deﬁned as w(+) = vuev. If u is the longest proper palindromic suﬃx of w, called lpps,
we deﬁne the proper palindromic closure of w the same way as w(++) = vu˜v. We refer to
the longest proper palindromic preﬁx of w as lppp and deﬁne the proper palindromic preﬁx
closure of w as (++)w =

^
ew(++).

Proposition 1.5. ([GJWZ], Prop. 2.6) Palindromic closure preserves richness.

Proposition 1.6. ([GJWZ], Prop. 2.8) Proper palindromic (preﬁx) closure preserves rich-
ness.

2. The length of a longest rich square-free word

A word of form uu, where u 6= ǫ, is called a square and a word w which does not have a
square as a factor is called square-free. For example 1212 is a square and 01210 is square-free.
In [PS], Theorem 4 and Remark 6, it was proved that every inﬁnite rich word contains
a square. This means that every rich square-free word is of ﬁnite length. The length of a
longest such word, on an alphabet of size n, is denoted with r(n). The explicit formula for
r(n) was left as an open problem in [PS].

The ﬁrst seven exact values of r(n) are r(1) = 1, r(2) = 3, r(3) = 7, r(4) = 15, r(5) =
33, r(6) = 67 and r(7) = 145. These can be found from https://oeis.org/A269560. The
longest rich square-free word on a given alphabet is not unique. Here are all the longest
non-isomorphic ones, up to permutating the letters and taking the reversal, for n = 1, . . . , 7:
w1,1 = 1
w2,1 = 121
w3,1 = 2131213
w3,2 = 1213121
w4,1 = 131214121312141
w4,2 = 123121412131214
w4,3 = 213121343121312
w4,4 = 121312141213121
w5,1 = 421242131213531213124213121353135
w5,2 = 131242131213531213124213121353135
w6,1 = 1513121315131214121312141614121312141213151312141213121416141214161
w6,2 = 1214121315131214121312141614121312141213151312141213121416141214161
w6,3 = 4212421312135312131242131213531356531353121312421312135312131242124
w6,4 = 1312421312135312131242131213531356531353121312421312135312131242124
w6,5 = 5313531213124213121353121312421316131242131213531213124213121353135

4

w6,6 = 1312421312135312131242131213531356531353121312421312135312131242131
w7,1 = 242131213531213124213161312421312135312131242131213531357531353121312
4213121353121312421316131242131213531213124213121353135753135312135313575357
w7,2 = 242131213531213124213161312421312135312131242131213531357531353121312
4213121353121312421316131242131213531213124213121353135753135312135313575313
w7,3 = 242131213531213124212464212421312135312131242131213531357531353121312
4213121353121312421246421242131213531213124213121353135753135312135313575357
w7,4 = 242131213531213124212464212421312135312131242131213531357531353121312
4213121353121312421246421242131213531213124213121353135753135312135313575313

We can see that

w2,1 = w1,12w1,1, w3,2 = w2,13w2,1, w4,3 = w3,14gw3,1, w4,4 = w3,24w3,2,
w6,3 = w5,16gw5,1, w6,4 = w5,26gw5,1, w6,5 = gw5,26w5,2 and w6,6 = w5,26gw5,2.

Generally, we can construct rich square-free words by using a basic recursion

bn = baeb,

where b is a longest rich square-free word over an (n − 1)-ary alphabet A and a /∈ A is a new
letter. It is very easy to see that bn is rich and square-free. This gives us a recursive lower
bound for r(n): r(n) ≥ 2r(n − 1) + 1, for all n ≥ 2. We will use this inequality excessively
later in Section 2.2, when we prove an upper bound for r(n). The closed-form solution for
the recursion r(1) = 1, r(n) ≥ 2r(n − 1) + 1 is r(n) ≥ 2n − 1.

The case n = 5 reveals that the basic recursion bn = baeb is not always optimal, since

neither w5,1 nor w5,2 is of that form: |w5,1| = r(5) = 33 > 31 = 2 · r(4) + 1.

We can also see that

w3,1 = 2w1,13w1,12w1,13, w4,1 = 13w2,14w2,13w2,141, w4,2 = 213w2,14w2,13w2,14,

w5,1 = 42124w3,15gw3,14w3,153135, w5,2 = 13124w3,15gw3,14w3,153135,

w6,1 = 1513121315w4,16gw4,15w4,16141214161, w6,2 = 1214121315w4,16gw4,15w4,16141214161,

w7,1 = u1,26w5,27gw5,26w5,27v1,3, w7,2 = u1,26w5,27gw5,26w5,27v2,4,
w7,3 = u3,46w5,17gw5,16w5,17v1,3, w7,4 = u3,46w5,17gw5,16w5,17v2,4,

where u1,2 = 2421312135312131242131, u3,4 = 2421312135312131242124,

v1,3 = 53135312135313575357 and v2,4 = 53135312135313575313.

This gives us a hint how to get, in some cases, a better recursion than the basic recursion.
We will deﬁne this recursion explicitly in the next subsection.

5

2.1. A lower bound

In this subsection, we will prove another lower bound for r(n). We will use an alphabet
{A0, A1, A2, A3, B3, A4, B4, A5, B5, . . .}. The following construction of rich square-free words
wn is recursive. The ﬁrst six words are

w1 = A1, w2 = A0A2A0, w3 = v3A3w1B3w1A3w1B3u3, w4 = v4A4w2B4w2A4w2B4u4,

w5 = v5A5w3B5w3A5w3B5u5, w6 = v6A6w4B6w4A6w4B6u6,

where v3, u3 = ǫ, v4, u4 = A0, v5 = A5A3A1A3, u5 = B3A1A3A1, v6 = A0A6A0A4A0A2A0A4A0
∼= w5,2,
and u6 = A0B4A0A2A0A4A0A2A0. Notice that w6 is isomorphic (∼=) to w6,2, w5
w4

∼= w3,1. For n ≥ 7, we deﬁne

∼= w4,1 and w3

wn = vnAnwn−2Bn]wn−2Anwn−2Bnun,

where vn = (Pncn)−1 gvn−4An−2 gvn−2Anvn−2An−2vn−4An−4wn−6Bn−4]wn−6An−4 gvn−4An−2 gvn−2 and
un = gun−2Bn−2]wn−4An−2wn−4Bn−2 gun−4Bn−4]wn−6(dnfPn)−1, where Pn is the largest common
preﬁx of wn−6 and gvn−4, cn is the ﬁrst letter of (Pn)−1 gvn−4An−2 and dn is the ﬁrst letter of
(Pn)−1wn−6Bn−4.
We can see that Alph(w2k) = {A0, A2, A4, B4, A6, B6, . . . , A2k, B2k} and Alph(w2k+1) =
{A1, A3, B3, A5, B5, . . . , A2k+1, B2k+1}. This means we really have Alph(wn) = n. We also
have cn 6= dn, since An−2 /∈ wn−6 and Bn−4 /∈ gvn−4.
Before we prove that wn is rich and square-free, we will make some notation in order
to make the proof look simpler. We mark that En = Anwn−2Bn]wn−2Anwn−2Bn, Fn =
(Pncn)−1 gvn−4An−2 gvn−2, Gn = ]wn−6An−4 gvn−4An−2 gvn−2 and Hn = fPnAn−4wn−6Bn−4Gn. Now
wn = vnEnun, vn = FnAnfGnBn−4Gn and wn−2 = fHndnfun. We can also see that Hn is a
suﬃx of vn and Fn is a suﬃx of Gn.

Proposition 2.1. The word wn is square-free for all n ≥ 1.

Proof. We prove the claim by induction.
It is easy to check that wn is square-free when
1 ≤ n ≤ 6. Suppose wn is square-free for all n < k, where k ≥ 7. Now we need to prove that
wk is square-free.

The word Akwk−2Bk]wk−2Akwk−2Bkuk is square-free because wk−2 is square-free, Ak, Bk /∈
wk−2 and euk is a proper suﬃx of wk−2. The words Gk and Fk are suﬃxes of ]wk−2 and
Ak, Bk−4 /∈ Gk, Fk, which means that vk = FkAkfGkBk−4Gk is square-free.
Now, the only way wk = FkAkfGkBk−4GkAkwk−2Bk]wk−2Akwk−2Bkuk can have a square
is either 1) xAkwk−2BkyxAkwk−2Bky, where x is a suﬃx of both vk and ]wk−2, and y is a
preﬁx of both uk and ]wk−2, or 2) xAkyxAky, where x is a suﬃx of both Fk and fGkBk−4Gk,
and y is a preﬁx of both ]wk−2 and fGkBk−4Gk.

6

1) Case xAkwk−2BkyxAkwk−2Bky. Now yx = ]wk−2 = ukdkHk. Because y is a preﬁx of
uk and x is suﬃx of vk, we have that dkHk is a suﬃx of vk. We also know that ckHk is always
a suﬃx of vk. This is a contradiction since ck 6= dk.

2) Case xAkyxAky. Now y is a preﬁx of ]wk−2, which means that x has to have a suﬃx
P −1
k gvk−4Ak−2 gvk−2. This is a contradiction, since x is also a suﬃx of (Pkck)−1 gvk−4Ak−2 gvk−2.

Proposition 2.2. The word wn is rich for all n ≥ 1.

Proof. We prove the claim by induction. It is easy to check that wn is rich when 1 ≤ n ≤ 6.
Suppose wn is rich for all n < k, where k ≥ 7. Now we need to prove that wk is rich.

The following paragraph proves that it is unioccurrent in ckHkEkuk.

Since wk−2 is rich and Ak, Bk /∈ wk−2, we get that Akwk−2Bk is rich. Proposition 1.5
gives now that Akwk−2Bk]wk−2Ak is rich. The lpps of Akwk−2Bk]wk−2Ak is Ak, which means
Akwk−2Bk]wk−2Akwk−2Bk]wk−2Ak is rich by Proposition 1.6. The word uk is a preﬁx of ]wk−2,
so the factor Akwk−2Bk]wk−2Akwk−2Bkuk is also rich.
The lppp of Akwk−2Bk]wk−2Akwk−2Bkuk is Akwk−2Bk]wk−2Ak, which means that also the
proper palindromic preﬁx closure eukBk]wk−2Akwk−2Bk]wk−2Akwk−2Bkuk is rich. The word
Hk is a suﬃx of ]wk−2, which means HkAkwk−2Bk]wk−2Akwk−2Bkuk = HkEkuk is also rich.
The word ckHkEkuk has a palindromic preﬁx P P = ckfPkAk−4wk−6Bk−4]wk−6Ak−4Pkck.
The letter Bk−4 occurs only once in ckHk, in the middle of our palindromic preﬁx P P .
This occurrence of Bk−4 is preceded by ckfPkAk−4wk−6 and succeeded by ]wk−6Ak−4Pkck. The
last occurrence of Bk−4 in Ekuk is succeeded by ]wk−6(dkfPk)−1 and nothing more. Since the
word ]wk−6(dkfPk)−1 is clearly a proper preﬁx of ]wk−6Ak−4Pkck, this last occurrence of Bk−4
in Ekuk cannot occur in a factor P P . All other occurrences of Bk−4 in Ekuk are preceded
by Bk−4]wk−6Ak−4wk−6 or succeeded by ]wk−6Ak−4wk−6Bk−4. The word Bk−4]wk−6Ak−4wk−6
has a suﬃx dkfPkAk−4wk−6, which means that it cannot have a suﬃx ckfPkAk−4wk−6 because
ck 6= dk. These mean that no Bk−4 in ckHkEkuk can occur in a factor P P , except the ﬁrst
one.

Since P P is unioccurrent palindromic preﬁx in ckHkEkuk, we get that ckHkEkuk is rich
and P P is the lppp of ckHkEkuk. Now, all we need to do is to take the proper palindromic
preﬁx closure of ckHkEkuk, which is rich by Proposition 1.6.
It has a suﬃx wk, which
concludes the proof:

(++)(ckHkEkuk) = eukBk]wk−2Akwk−2Bk]wk−2AkfGkBk−4GkEkuk

∗= XFkAkfGkBk−4GkEkuk = XvkEkuk = Xwk (∗Fk is a suﬃx of ]wk−2).

7

Now we know that wn is rich and square-free, which means r(n) ≥ |wn| for all n ≥ 1.
We can compute that |w7| = 145, |w8| = 291, |w9| = 629 and |w10| = 1255. Notice that
w7 = w7,4, which means our lower bound is exact when n = 7. The cases r(8) and r(9) are
too large to compute the exact value. However, by creating a partial tree of rich square-free
words for n = 8 and 9, by leaving some branches out of it, the longest words we could
ﬁnd were of length 291 and 629, respectively. These are exactly the lengths of |w8| and |w9|.
Notice that |w8| = 291 = 2·145+1 = 2|w7|+1, which means the basic recursion bn is as good
as our recursion wn when n = 8. Notice also that |w9| = 629 > 583 = 2 · 291 + 1 = 2|w8| + 1
and |w10| = 1255 < 1259 = 2 · 629 + 1 = 2|w9| + 1, which mean wn is better than bn when
n = 9 and bn is better than wn when n = 10.

The previous paragraph suggests that it is reasonable to make the following conjecture.

Conjecture 2.3. r(n) = max{|wn|, 2 · |wn−1| + 1} for all n ≥ 1.

The recursion for the length of wn might be too complex to be solved in a closed-form,
but we want to get at least an estimate for it. Let us ﬁrst estimate the length of vn, which
will be used in Proposition 2.5.

Lemma 2.4. |vn| ≥ 3|vn−2| + 2|wn−6| + 2|vn−4| + 6, for n ≥ 7.
Proof.

|vn| = |(Pncn)−1 gvn−4An−2 gvn−2Anvn−2An−2vn−4An−4wn−6Bn−4]wn−6An−4 gvn−4An−2 gvn−2|

≥ | gvn−2Anvn−2An−2vn−4An−4wn−6Bn−4]wn−6An−4 gvn−4An−2 gvn−2|

≥ 3|vn−2| + 2|wn−6| + 2|vn−4| + 6,

where |(Pncn)−1 gvn−4An−2| ≥ 0, since cn is a letter and Pn is a preﬁx of gvn−4.
Proposition 2.5. r(n) ≥ |wn| > 2, 008n for n ≥ 5.

Proof. From our recursion of wn, we get that for n ≥ 11:

|wn| = |vnAnwn−2Bn]wn−2Anwn−2Bnun| = 3|wn−2| + |vn| + |un| + 4

= 3|wn−2| + |(Pncn)−1 gvn−4An−2 gvn−2Anvn−2An−2vn−4An−4wn−6Bn−4]wn−6An−4 gvn−4An−2 gvn−2|

+| gun−2Bn−2]wn−4An−2wn−4Bn−2 gun−4Bn−4]wn−6(dnfPn)−1| + 4

= 3|wn−2| + |(Pncn)−1 gvn−4An−2 gvn−2Anvn−2An−2vn−4| − |dnfPn| + 4

+| gun−2Bn−2]wn−4An−2wn−4Bn−2 gun−4Bn−4]wn−6| + |An−4wn−6Bn−4]wn−6An−4 gvn−4An−2 gvn−2|

8

= 4|wn−2| + |(Pncn)−1 gvn−4An−2 gvn−2Anvn−2An−2vn−4| − |dnfPn| + 4

= 4|wn−2| + 2(| gvn−4| − |Pn|) + 2|vn−2| + |An−2AnAn−2| − |dn| − |cn| + 4
≥ 4|wn−2| + 2|vn−2| + 5 ≥ 4|wn−2| + 2(3|vn−4| + 2|wn−8| + 2|vn−6| + 6) + 5
≥ 4|wn−2| + 2(3(3|vn−6| + 2|wn−10| + 2|vn−8| + 6) + 2|wn−8| + 2|vn−6| + 6) + 5

> 4|wn−2| + 4|wn−8| + 12|wn−10|.

From our recursion of wn we also know that |w10| = 1255 > 1164 = 4|w8|, |w9| = 629 >
580 = 4|w7|, |w8| = 291 > 268 = 4|w6| and |w7| = 145 > 132 = 4|w5|.

Now, for n ≥ 15 we have

|wn| > 4|wn−2| + 4|wn−8| + 12|wn−10| > 4(4|wn−4| + 4|wn−10|) + 4|wn−8| + 12|wn−10|
= 16|wn−4| + 4|wn−8| + 28|wn−10| > 16 · 4 · 4 · 4|wn−10| + 4 · 4|wn−10| + 28|wn−10|

= 1068|wn−10| > 2, 00810|wn−10|.

We can also easily check that |wn| > 2, 008n for all 5 ≤ n ≤ 14. This means we have our
result

|wn| > 2, 008n for n ≥ 5.

From the basic recursion bn alone, we get r(n) ≥ 2n − 1. Our new recursion gives a
slightly better bound r(n) > 2, 008n, which can be improved easily if we do not estimate the
length of wn in Proposition 2.5 that roughly. We only mention that it can be improved at
least to 2, 0178n, but we will not do it here.

2.2. An upper bound

In this subsection, we will prove an upper bound for r(n). First, we will prove two useful
lemmas. For that, let us mention that every square-free palindrome has to be of odd length,
because palindromes of even length create a square of two letters to the middle, for example
12011021 has a square 11 in the middle.

Lemma 2.6. The middle letter of a rich square-free palindrome is unioccurrent.

Proof. Since all square-free palindromes are of odd length, there always exists the middle
letter. Then, suppose the contrary: zbez is rich and square-free and the letter b has another
occurrence inside z. We can take the other occurrence of b to be consecutive to the b in the
middle and get that zbez = z1bz2bz2bez1, where z2 is a palindrome because of Proposition 1.4.
We get a contradiction because bz2bz2 is a square.

9

Lemma 2.7. Suppose w = u1a1u2a1 · · · a1uk−1a1uk ∈ {a1, a2, . . . , an}∗ is rich and square-
free, where n, k ≥ 3 (possibly uk = ǫ), Alph(u1) = {a2, . . . , an} and ∀i : a1 /∈ Alph(ui).

F or 2 ≤ i ≤ k − 1 : Alph(ui+1) ⊆ Alph(ui) \ {ai}, where ui = viaievi.

Proof. Since ∀i : a1 /∈ Alph(ui), we get from Proposition 1.4 that u2, . . . , uk−1 are palin-
dromes, and because w is square-free, they are of odd length and non-empty. By permutat-
ing the letters, we can suppose for 2 ≤ i ≤ k − 1: ai is the middle letter of ui = viaievi, where
ai /∈ Alph(vi) by Lemma 2.6.

We will prove the claim by induction on i.
1) The base case i = 2. Since a2 ∈ Alph(u1) = {a2, . . . , an}, we get from Proposition
1.4 that u1 = v1a2 ev2.
If a2 ∈ Alph(u3) then, by Proposition 1.4, we have u3 = v2a2v′3,
which creates a square (a2 ev2a1v2)2 in u1a1u2a1u3 = v1a2 ev2a1v2a2 ev2a1v2a2v′3. This means
a2 /∈ Alph(u3).
Suppose then that b ∈ Alph(u3) \ Alph(u2), which implies b ∈ Alph(v1). The word
between the ﬁrst occurrence of b in u3 and the last occurrence of b in v1 is a palindrome
by Proposition 1.4: u1a1u2a1u3 = t1bt2a2 ev2a1v2a2 ev2a1v2a2et2bt3, where v1 = t1bt2 and u3 =
v2a2et2bt3. We get a contradiction since we have a square (a2 ev2a1v2)2. This means Alph(u3) ⊆
Alph(u2) \ {a2}.
2) The induction hypothesis. We can now suppose k ≥ 4, since the base case proves
our claim if k = 3. Suppose then that for every j, where 2 ≤ j ≤ i < k − 1, we have:
Alph(uj+1) ⊆ Alph(uj) \ {aj}.

3) The induction step. Now we need to prove that Alph(ui+2) ⊆ Alph(ui+1) \ {ai+1}.
From the induction hypothesis we get that ai+1 ∈ Alph(ui+1) ⊆ Alph(ui)\{ai}, which means
ui = vi+1ai+1xaiexai+1gvi+1 by Proposition 1.4. If ai+1 ∈ Alph(ui+2) then, by Proposition 1.4,
we have ui+2 = vi+1ai+1y, which creates a square (ai+1gvi+1a1vi+1)2 inside uia1ui+1a1ui+2 =
vi+1ai+1xaiexai+1gvi+1a1vi+1ai+1gvi+1a1vi+1ai+1y. This means ai+1 /∈ Alph(ui+2)
Suppose then that c ∈ Alph(ui+2) \ Alph(ui+1), which implies c ∈ Alph(u1a1 . . . a1ui).
Without loss of generality, we can assume that c is the letter from Alph(ui+2) \ Alph(ui+1)
that has the rightmost occurrence in u1a1 . . . a1ui. The word between the leftmost occurrence
of c in ui+2 = zcz′ and the rightmost occurrence of c in u1a1 . . . a1ui has to be a palindrome
by Proposition 1.4. We divide this into two cases.

- Suppose c /∈ Alph(ui). Now ceza1ui+1P ui+1a1zc is a palindrome, where Alph(P ) ⊆
Alph(a1ui+1) because of the way we chose c. Now the middle letter of the palindrome
a1ui+1P ui+1a1 belongs to P and therefore has other occurrences inside it, in a1ui+1 and in
ui+1a1. This is a contradiction by Lemma 2.6.

- Suppose c ∈ Alph(ui). Now ceza1vi+1ai+1gvi+1a1zc is a palindrome, where ai+1 is its
middle letter and cez is a suﬃx of ui. If ai+1 ∈ Alph(z) then it is not unioccurrent in the

10

palindrome eza1vi+1ai+1gvi+1a1z and we get a contradiction by Lemma 2.6. Since ai+1 ∈
Alph(ui) by the induction hypothesis, we can take the rightmost occurrence of it in ui and
get that ai+1v′iceza1vi+1ai+1 is a palindrome, where v′icez = gvi+1. We get a contradiction since
this would mean c ∈ Alph(vi+1) ⊂ Alph(ui+1).

Both cases yield a contradiction, which means Alph(ui+2) ⊆ Alph(ui+1) \ {ai+1}.

Corollary 2.8. All rich square-free words are ﬁnite.

Proof. We prove this by induction. Suppose w is rich and square-free word for which
|Alph(w)| = n ≥ 4. Suppose that all rich square-free words on an alphabet of size n − 1 or
smaller are ﬁnite. Cases n = 1, 2, 3 are trivial.

Suppose that a1 is the letter of w for which w = u1a1w′, where Alph(u1) = Alph(w)\{a1}.
We partition w such that w = u1a1u2a1u3a1u4a1 . . ., where a1 /∈ Alph(ui) for all i. From
Lemma 2.7 we now get that |Alph(ui)| > |Alph(ui+1)| for all i ≥ 2. This means there are
ﬁnitely many words ui, at most n, and they are all over an alphabet of size n − 1 or smaller,
which concludes the proof.

The above corollary gives another proof for the result mentioned in Remark 6 of [PS].
The proof of the above corollary also gives us a way to get an upper bound for r(n): r(n) ≤
r(n − 1) + 1 + Pn−1
i=1 (r(n − i) + 1). This bound can be easily improved if we examine the
word also from the right side, i.e. we suppose that a1 is the letter of w for which w = w′a1u1,
where Alph(u1) = Alph(w) \ {a1}. This notice makes it reasonable to make the following
deﬁnition.

Deﬁnition 2.9. Let w = uav be a word, where a is a letter. If Alph(u) = Alph(w) \ {a}
then the leftmost occurrence of the letter a in w is called the left special letter of w.
If
Alph(v) = Alph(w) \ {a} then the rightmost occurrence of the letter a in w is called the right
special letter of w.

In Subsection 2.1, where we constructed the words wn for our lower bound, the rightmost
occurrence of An is always the right special letter of wn and the leftmost occurrence of Bn
is always the left special letter of wn, for n ≥ 3. In Lemma 2.7 and Corollary 2.8, the ﬁrst
occurrence of letter a1 is the left special letter of w.

Before we go to our upper bound for r(n), we will state a helpful lemma.

Lemma 2.10. Suppose wn = xBnyAnz is a rich square-free n-ary word, where n ≥ 3
and the letters An and Bn are the right and left special letters of wn, respectively. Now
Alph(y) = Alph(wn) \ {An, Bn} and An 6= Bn.

11

Proof. First we prove that An, Bn /∈ y. Suppose to the contrary that Bn ∈ y (case
An ∈ y is symmetric). We can take the leftmost occurrence of Bn in y and get that
wn = xBny1cey1Bny2Anz, where Bn /∈ y1cey1 and c is a letter. Since An is the right spe-
cial letter of wn, we have that c ∈ z. Since Bn is the left special letter of wn, we get from
Lemma 2.7 that c /∈ y2Anz, i.e. c /∈ z. This is a contradiction.

Then we prove that An 6= Bn. Suppose to the contrary that An = Bn. Now, since
An, Bn /∈ y, we get from Proposition 1.4 that y is a palindrome. From Lemma 2.7 we get
that the middle letter of y cannot be in x nor in z. This is a contradiction, since x and z
has to contain all the letters except An.

Then we prove that if a ∈ Alph(wn) \ {An, Bn} then a ∈ y. Suppose to the contrary
that a ∈ Alph(wn) \ ({An, Bn} ∪ Alph(y)). Since An and Bn are the right and left special
letters, we have that a ∈ x, z. If we take the leftmost occurrence of a in z and the rightmost
occurrence of a in x, then we get from Proposition 1.4 that w = x′auBnyAnvaz′, where
auBnyAnva is a palindrome, x = x′au and z = vaz′. The middle letter of the palindrome
auBnyAnva cannot be inside u nor v, since it would mean Bn ∈ u or An ∈ v, which is
impossible since An and Bn are special letters. The middle letter of auBnyAnva cannot be
inside y neither, since that would mean Bn ∈ yAn or An ∈ Bny, which we proved above to
be impossible. The only possibility is that the middle letter of auBnyAnva is either An or
Bn. Since these cases are symmetric, we can suppose Bn is the middle letter. This means
w = x′aevAneyBnyAnvaz′. Since Bn is the left special letter of w, we have Bn ∈ z = vaz′
and Bn /∈ v. This means Bn ∈ z′. If we take the leftmost occurrence of Bn in z′, we get
w = x′aevAneyBnyAnvav′Bnz′′, where BnyAnvav′Bn is a palindrome which has An as the
middle letter. This means ey = vav′ and hence a ∈ y, which is a contradiction.

There are only three cases how the right and left special letters can appear inside a word,
with respect to each other. If wn is a rich square-free n-ary word which has An and Bn as
the right and left special letters, respectively, then one the following cases must hold (the
visible occurrences of An and Bn in wn are the special letters):

1) wn = xBnyAnz. Now An 6= Bn by Lemma 2.10.
2) wn = xAnyBnz. Now An 6= Bn by the deﬁnition of special letters.
3) wn = xAnz = xBnz. Now An = Bn.

Proposition 2.11. Suppose wn is a rich square-free n-ary word, where n ≥ 3.

1) If wn = xBnyAnz, where the letters An and Bn are the right and left special letters of

wn, respectively, then |wn| ≤ 2r(n − 1) + r(n − 2) + 2.

2) If wn = xAnyBnz, where the letters An and Bn are the right and left special letters of
wn, respectively, then |wn| ≤ r(n − 1) + r(n − 2) + r(n − 3) + 2 ≤ 2r(n − 1) and |x|, |z| ≤
r(n − 2) + r(n − 3) + 1, where r(n − 3) = 0 if n = 3.

12

3) If wn = xAnz = xBnz, where the letter An = Bn is both the right and left special letter

of wn, then |wn| ≤ 2r(n − 1) + 1.

Proof. Let us denote A = Alph(wn).

1) By the deﬁnition of special letters, we have that Alph(x) = A\{Bn} and Alph(z) = A\
{An}. These mean |x|, |z| ≤ r(n−1). From Lemma 2.10 we get that Alph(y) = A\{An, Bn},
which means |y| ≤ r(n − 2), since An 6= Bn. Now

|wn| = |x|+|Bn|+|y|+|An|+|z| ≤ r(n−1)+1+r(n−2)+1+r(n−1) = 2r(n−1)+r(n−2)+2.

2) If An /∈ x, then |x| ≤ r(n − 2). If An ∈ x then we can take the rightmost occurrence of
it in x and get that xAn = x2Anx1c ex1An, where An /∈ x1c ex1 and by Lemma 2.7 c /∈ x2Anx1.
Now Alph(x2Anx1) = A \ {c, Bn} and Alph( ex1) = A \ {c, An, Bn}, where c 6= Bn since Bn is
the left special letter of wn. This means |x| = |x2Anx1| + |c| + | ex1| ≤ r(n − 2) + r(n − 3) + 1,
where r(n − 3) = 0 if n = 3. The same holds for z.

We have Alph(yBnz) = A \ {An}, which means |yBnz| ≤ r(n − 1). Now

|wn| = |x|+|An|+|yBnz| ≤ [r(n−2)+r(n−3)+1]+1+r(n−1) = r(n−1)+r(n−2)+r(n−3)+2.

From the basic recursion we know that r(n) ≥ 2r(n − 1) + 1. This means that r(n − 1) +
r(n−2)+r(n−3)+2 ≤ r(n−1)+r(n−2)+2r(n−3)+2 ≤ r(n−1)+2r(n−2)+1 ≤ 2r(n−1),
which we needed to prove.

3) By the deﬁnition of special letters, we have that Alph(x) = Alph(z) = A\ {An}, which

means |x|, |z| ≤ r(n − 1). Now

|wn| = |x| + |An| + |z| ≤ r(n − 1) + 1 + r(n − 1) = 2r(n − 1) + 1.

Corollary 2.12. r(n) ≤ 2r(n − 1) + r(n − 2) + 2, for n ≥ 3.

Proof. We get our claim from Proposition 2.11, since the proposition covered all the three
diﬀerent possible cases for wn.

We do not solve the recursion r(n) ≤ 2r(n − 1) + r(n − 2) + 2, r(2) = 3, r(1) = 1, in a
closed-form, but we will estimate it. We use the inequality r(n) ≥ 2r(n − 1) + 1 from the
basic recursion, and the fact that r(4) = 15 > 13. For n ≥ 8 we have

r(n) ≤ 2r(n−1)+r(n−2)+2 ≤ 2(2r(n−2)+r(n−3)+2)+r(n−2)+2 = 5r(n−2)+2r(n−3)+6

≤ 5(2r(n − 3) + r(n − 4) + 2) + 2r(n − 3) + 6 = 12r(n − 3) + 5r(n − 4) + 16

13

< 12r(n − 3) + 5r(n − 4) + 16 + (r(n − 4) − 13) = 12r(n − 3) + 6r(n − 4) + 3 ≤ 15r(n − 3)

< 2, 473r(n − 3) < 2, 47n,

where the last inequality comes from the fact that r(n) < 2, 47n for 1 ≤ n ≤ 7. Together
with the lower bound, we now have 2, 008n < r(n) < 2, 47n for n ≥ 5.

This upper bound can still be improved. The cases 2 and 3 from Proposition 2.11 already
give better or equal upper bounds than the basic recursion, i.e. r(n) ≤ 2r(n − 1) + 1. This
means we need to look closer only for the case 1.

Proposition 2.13. r(n) ≤ 5r(n − 2) + 4, for n ≥ 7.

Proof. Suppose wn = xBnyAnz is a rich square-free n-ary word, where n ≥ 7 and the letters
An and Bn are the right and left special letters of wn, respectively. This means An 6= Bn. If
wn is not of this form, then we already know from Proposition 2.11 that |wn| ≤ 2r(n − 1) + 1,
which means we can use the upper bound of Corollary 2.12 and get that

|wn| ≤ 2(2r(n − 2) + r(n − 3) + 2) + 1 = 4r(n − 2) + 2r(n − 3) + 5 ≤ 5r(n − 2) + 4,

where the last inequality comes from the basic recursion r(n) ≥ 2r(n − 1) + 1. From now
on, we will use the basic recursion without mentioning it.

By the deﬁnition of special letters, we have that An ∈ x and Bn ∈ z. From Lemma 2.10 we
know that An, Bn /∈ y. Since An 6= Bn, we can take the rightmost occurrence of An in x and
the leftmost occurrence of Bn in z and get, by Proposition 1.4, that wn = x1AneyBnyAneyBnz1.
We divide this proof into three diﬀerent cases depending whether An ∈ x1 or An /∈ x1
and whether Bn ∈ z1 or Bn /∈ z1.

Case 1) An /∈ x1, Bn /∈ z1.
Now we have An, Bn /∈ x1, z1, y. This means |x1|, |z1|, |y| ≤ r(n − 2). Together we get

|wn| = |x1AneyBnyAneyBnz1| ≤ 5r(n − 2) + 4.

Case 2) An ∈ x1, Bn /∈ z1 (the case An /∈ x1, Bn ∈ z1 is symmetric).
If we take the rightmost occurrence of An in x1 we get, by Proposition 1.4, Lemma 2.6
and Lemma 2.7, that wn = x2AnfxBBxBAneyBnyAneyBnz1, where B (6= An, Bn) is a letter,
An, B /∈ xB, B /∈ x2 and x1 = x2AnfxBBxB. Since Bn is a left special letter of wn, we
have that Bn /∈ x2AnfxB and Bn /∈ xB. We also have An, Bn /∈ y, z1. Together we have
|y|, |z1|, |x2AnfxB| ≤ r(n − 2) and |xB| ≤ r(n − 3).
Let us mark the left special letter of ey with Bn−2. Now we divide this into two cases
whether B 6= Bn−2 or B = Bn−2.
Case 2.1) B 6= Bn−2.

14

Since Bn−2 is the left special letter of ey, we must have Bn−2 /∈ xB. Otherwise we would
have, by Proposition 1.4, that B ∈ xB, which is impossible by Lemma 2.6. From Lemma
2.7 we now get that Bn−2 /∈ x2. Earlier, we already noted that Bn, B /∈ x2AnfxB and
An, Bn, B /∈ xB. Together we now get |x2AnfxB| ≤ r(n − 3) and |xB| ≤ r(n − 4), and
therefore

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |z1|

≤ r(n − 3) + 1 + r(n − 4) + [3r(n − 2) + 4] + r(n − 2) = 4r(n − 2) + r(n − 3) + r(n − 4) + 5

< 4r(n − 2) + r(n − 3) + r(n − 4) + 5 + r(n − 4) ≤ 5r(n − 2) + 3,

where we added the extra r(n − 4) after the second inequality only to make the use of the
basic recursion simpler.
Case 2.2) B = Bn−2.
If we can prove that |z1| ≤ r(n − 3), then we get

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |z1|

≤ r(n−2) + 1 + r(n−3) + [3r(n−2) + 4] + r(n−3) = 4r(n−2) + 2r(n−3) + 5 ≤ 5r(n−2) + 4.

So we need to prove there exists some letter, diﬀerent from An and Bn, such that it does not
belong to z1. We divide this into three cases depending of which form ey is.
Case 2.2.1) ey = y1An−2y3Bn−2y2, where the letters An−2 and Bn−2 are the right and left
special letters of ey, respectively.
Because B = Bn−2, we have fxB = y1An−2y3, by Proposition 1.4 and Lemma 2.6. Now
An−2 /∈ z1, since otherwise we could take the leftmost occurrence of An−2 in z1 and get a
square in wn:

ey1AneyBn ey2Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3An−2,

where the rightmost ey2Bn−2 ey3An−2 is a preﬁx of z1 and the leftmost ey1 is a suﬃx x1.

Case 2.2.2) ey = y1Bn−2y2, where Bn−2 is also the right special letter of ey.
Because B = Bn−2, we have fxB = y1. Now Bn−2 /∈ z1, since otherwise, similar to Case

2.2.1, we could take the leftmost occurrence of Bn−2 in z1 and get a square in wn:

ey1AneyBn ey2Bn−2 ey1AneyBn ey2Bn−2.

Case 2.2.3) ey = y1An−2y3Bn−2 ey3An−2y3Bn−2y2, where the rightmost An−2 and the left-
most Bn−2 are the right and left special letters of ey, respectively.
Because B = Bn−2, we have fxB = y1An−2y3. Again An−2 /∈ z1, since otherwise, similar
to Case 2.2.1, we could take the leftmost occurrence of An−2 in z1 and get a square in wn:

y3Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3An−2.

15

Case 3) An ∈ x1, Bn ∈ z1.
If we take the rightmost occurrence of An in x1 and the leftmost occurrence of Bn in z1,
we get that wn = x2AnfxBBxBAneyBnyAneyBnzAAfzABnz2, where A, B (6= An, Bn) are letters
and x1 = x2AnfxBBxB, z1 = zAAfzABnz2. Similar to Case 2, we have |y|, |x1|, |z1|, |x2AnfxB|,
|fzABnz2| ≤ r(n − 2) and |xB|, |zA| ≤ r(n − 3).

We divide this case now into three cases depending of which form ey is.
Case 3.1) ey = y1Bn−2y2, where Bn−2 is both the right and left special letter of ey.
If A = B = Bn−2 then xB = ey1 and zA = ey2. This would create a square in wn:

Bn−2 ey1AneyBn ey2Bn−2 ey1AneyBn ey2.

Now we divide this into two possible cases: A, B 6= Bn−2 and A = Bn−2,B 6= Bn−2.

Case 3.1.1) A, B 6= Bn−2.
Similar to Case 2.1, we get Bn, Bn−2, B /∈ x2AnfxB and An, Bn, Bn−2, B /∈ xB.
same way, we get An, A, Bn−2 /∈ fzABnz2 and An, A, Bn, Bn−2 /∈ zA. Together we have

In the

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |A| + |fzABnz2|

≤ r(n−3)+1+r(n−4)+[3r(n−2)+4]+r(n−4)+1+r(n−3) = 3r(n−2)+2r(n−3)+2r(n−4)+6

< 3r(n − 2) + 2r(n − 3) + 2r(n − 4) + 6 + 2r(n − 4) ≤ 5r(n − 2) + 2.

the left special letters of y1 and y2, respectively.

Case 3.1.2) A = Bn−2 and B 6= Bn−2 (the case A 6= Bn−2 and B = Bn−2 is symmetric).
Now zA = ey2. Let us mark y1 = u1Bn−4u2 and y2 = v1An−4v2, where Bn−4 and An−4 are
We prove B 6= Bn−4. Suppose to the contrary that B = Bn−4. Since Bn−2 is the right and
left special letter of ey, we have that An−4 ∈ y1. If we take the rightmost occurrence of An−4
in y1 then we get from Proposition 1.4 that An−4 ev1 is a suﬃx of y1 and hence An−4 is the
right special letter of y1. There are now three diﬀerent cases how An−4 and Bn−4 can appear
inside y1 with respect to each other. These all yield a square and hence a contradiction:

- If y1 = u′1An−4u3Bn−4 eu3An−4u3Bn−4u′2, where u1 = u′1An−4u3, u2 = eu3An−4u3Bn−4u′2

and v1 = eu′2Bn−4 eu3, then we have a square in wn:
An−4u3Bn−4 eu3An−4 eu′1AneyBn ey2Bn−2 eu′2Bn−4 eu3An−4u3Bn−4 eu3An−4 eu′1AneyBn ey2Bn−2 eu′2Bn−4 eu3.
- If y1 = u1Bn−4u2 = u1An−4 ev1 (i.e. An−4 = Bn−4), then u2 = ev1 and we have a square

in wn:

Bn−4 eu1AneyBn ey2Bn−2 eu2Bn−4 eu1AneyBn ey2Bn−2 eu2.

- If y1 = u′1An−4u3Bn−4u2, where u1 = u′1An−4u3 and v1 = eu2Bn−4 eu3, then we have a

square in wn:

Bn−4 eu3An−4 eu′1AneyBn ey2Bn−2 eu2Bn−4 eu3An−4 eu′1AneyBn ey2Bn−2 eu2.

16

This means B 6= Bn−4. Similar to Case 2.1 we now get that Bn, Bn−2, Bn−4, B /∈ x2AnfxB

and An, Bn, Bn−2, Bn−4, B /∈ xB. Together we have

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |Bn−2| + |fzABnz2|

≤ r(n − 4) + 1 + r(n − 5) + [3r(n − 2) + 4] + r(n − 3) + 1 + r(n − 2)

= 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 6

< 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 6 + r(n − 5) ≤ 5r(n − 2) + 3.

letter and the left special letter of ey, respectively.

Case 3.2) ey = y1An−2y3Bn−2y2, where the letters An−2 and Bn−2 are the right special
If A = An−2, B = Bn−2 then we would have a square in wn:

An−2 ey1AneyBn ey2Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3.

This means we can divide this case, similar to Case 3.1, into two diﬀerent cases: A = An−2,
B 6= Bn−2 and A 6= An−2, B 6= Bn−2.
Case 3.2.1) A 6= An−2, B 6= Bn−2.
Similar to Case 2.1, we get Bn, Bn−2, B /∈ x2AnfxB and An, Bn, Bn−2, B /∈ xB.
same way, we get An, An−2, A /∈ fzABnz2 and An, An−2, A, Bn /∈ zA. Together we have

In the

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |A| + |fzABnz2|

≤ r(n−3)+1+r(n−4)+[3r(n−2)+4]+r(n−4)+1+r(n−3) = 3r(n−2)+2r(n−3)+2r(n−4)+6

< 3r(n − 2) + 2r(n − 3) + 2r(n − 4) + 6 + 2r(n − 4) ≤ 5r(n − 2) + 2.
Case 3.2.2) A = An−2, B 6= Bn−2 (the case A 6= An−2,B = Bn−2 is symmetric).
Now zA = ey2Bn−2 ey3. We divide this case into two cases: An−2 /∈ y1 and An−2 ∈ y1.
Case 3.2.2.1) An−2 /∈ y1.
We must have An−2 /∈ x1. Otherwise we could take the rightmost occurrence of An−2 in

x1 and get a square in wn:

An−2 ey1AneyBn ey2Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3.

Similar to Case 2.1, we have Bn, Bn−2 /∈ x1. Since Bn and Bn−2 are the left special letters
of wn and ey, respectively, we have Bn, Bn−2 /∈ y1. Together with the previous paragraph
we get that An−2, Bn, Bn−2 /∈ x1Any1. Since An−2 is the right special letter of ey we have
An, Bn, An−2 /∈ y3Bn−2y2. These mean |x1Any1| ≤ r(n − 3) and |y3Bn−2y2| ≤ r(n − 3).
Together we have

|wn| = |x1Any1| + |An−2| + |y3Bn−2y2| + |BnyAneyBn| + |zA| + |An−2| + |fzABnz2|

17

≤ r(n − 3) + 1 + r(n − 3) + [2r(n − 2) + 3] + r(n − 3) + 1 + r(n − 2)

= 3r(n − 2) + 3r(n − 3) + 5 < 3r(n − 2) + 3r(n − 3) + 5 + r(n − 3) ≤ 5r(n − 2) + 3.
Case 3.2.2.2) An−2 ∈ y1.
If we take the rightmost occurrence of An−2 in y1, we get ey = y′1An−2y4By ey4An−2y3Bn−2y2,
where By is a letter, y1 = y′1An−2y4By ey4 and An−2 /∈ y4By ey4. Let us mark y3 = u1Bn−4u2,
where Bn−4 is the left special letter of y3. We will prove Bn−4 /∈ x1.
Suppose Bn−4 /∈ y1. Now Bn−4 /∈ x1, since otherwise we could take the rightmost

occurrence of Bn−4 in x1 and get a square in wn:

An−2 ey1AneyBn ey2Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3.

Suppose Bn−4 ∈ y1. Because of Lemma 2.6, we must have that By = Bn−4 and y4 = eu1.
Also now Bn−4 /∈ x1, since otherwise we would have a square in wn:

Bn−4eu1An−2ey′1AneyBney2Bn−2 ey3An−2eu1Bn−4eu1An−2ey′1AneyBney2Bn−2 ey3An−2eu1.

This means we have Bn−4 /∈ x1.

If By = Bn−4 then we get from Lemma 2.7 that Bn−4 /∈ y′1An−2y4.

If By 6= Bn−4
then, since Bn−4 is the left special letter of y3, we also get from Lemma 2.6 and 2.7 that
Bn−4 /∈ y′1An−2y4. These mean Bn−4 /∈ x1Any′1An−2y4.
From Lemma 2.6 we get that By /∈ ey4, which means An, An−2, Bn, Bn−2, By /∈ ey4. Since
An−2 is the right special letter of ey, we have that An, An−2, Bn /∈ y3Bn−2y2. Together we
have

|wn| = |x1Any′1An−2y4|+|By|+|ey4|+|An−2|+|y3Bn−2y2|+|BnyAneyBn|+|zA|+|An−2|+|fzABnz2|

≤ r(n − 3) + 1 + r(n − 5) + 1 + r(n − 3) + [2r(n − 2) + 3] + r(n − 3) + 1 + r(n − 2)

= 3r(n−2)+3r(n−3)+r(n−5)+6 < 3r(n−2)+3r(n−3)+r(n−5)+6+3r(n−5) ≤ 5r(n−2)+1.
Case 3.3) ey = y1An−2y3Bn−2 ey3An−2y3Bn−2y2, where the rightmost An−2 and the leftmost
If A = An−2, B = Bn−2 then we would have a square in wn:

Bn−2 are the right and left special letters of ey, respectively.

Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 ey3An−2 ey1AneyBn ey2Bn−2 ey3An−2y3.

This means we can divide this case, similar to Case 3.1, into two diﬀerent cases: A = An−2,
B 6= Bn−2 and A 6= An−2, B 6= Bn−2.

Case 3.3.1) A 6= An−2 and B 6= Bn−2.

18

Similar to Case 2.1, we get Bn, Bn−2, B /∈ x2AnfxB and An, Bn, Bn−2, B /∈ xB.
same way, we get An, An−2, A /∈ fzABnz2 and An, An−2, A, Bn /∈ zA. Together we have

In the

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |A| + |fzABnz2|

≤ r(n−3)+1+r(n−4)+[3r(n−2)+4]+r(n−4)+1+r(n−3) = 3r(n−2)+2r(n−3)+2r(n−4)+6

< 3r(n − 2) + 2r(n − 3) + 2r(n − 4) + 6 + 2r(n − 4) ≤ 5r(n − 2) + 2.

Case 3.3.2) A = An−2, B 6= Bn−2 (the case A 6= An−2, B = Bn−2 is symmetric).
Let An−4 be the right special letter of y3. We will divide this into two cases: An−4 /∈ y2

and An−4 ∈ y2.

square in wn:

Case 3.3.2.1) An−4 /∈ y2.
If An−4 ∈ z2 then we could take the leftmost occurrence of it in z2, which would create a

ey3An−2y3Bn−2y2Bn ey2Bn−2 ey3An−2y3Bn−2y2Bn ey2Bn−2.

This means An−4 /∈ z2. Let us now mark y3 = u1An−4u2, where the letter An−4 is the
right special letter. We get that An−4 /∈ u2Bn−2y2Bnz2. Similar to Case 2.1, we also have
An, An−2 /∈ u2Bn−2y2Bnz2. From Proposition 2.11 we get that |u1| ≤ r(n − 5) + r(n − 6) + 1.
Similar to Case 2.1, we get Bn, Bn−2, B /∈ x2AnfxB and An, Bn, Bn−2, B /∈ xB. Together we
have

|wn| = |x2AnfxB|+|B|+|xB|+|AneyBnyAneyBn|+|ey2Bn−2 eu2|+|An−4 eu1An−2u1An−4|+|u2Bn−2y2Bnz2|
≤ r(n − 3) + 1 + r(n − 4) + [3r(n − 2) + 4] + r(n − 4) + [2(r(n − 5) + r(n − 6) + 1) + 3] + r(n − 3)

= 3r(n − 2) + 2r(n − 3) + 2r(n − 4) + 2r(n − 5) + 2r(n − 6) + 10

< 3r(n − 2) + 2r(n − 3) + 2r(n − 4) + 2r(n − 5) + 2r(n − 6) + 10 + 2r(n − 6) ≤ 5r(n − 2) + 2.

Case 3.3.2.2) An−4 ∈ y2.
We will divide this case into three cases depending of which form y3 is.
Case 3.3.2.2.1) y3 = u1An−4u3Bn−4u2, where An−4 and Bn−4 are the right and left special

letters of y3, respectively.

Since An−4 ∈ y2, we have that y2 = eu2Bn−4 eu3An−4y′2, where the An−4 is the leftmost
occurrence of An−4 in y2. If Bn−4 ∈ y1 then y1 = y′1Bn−4 eu3An−4 eu1, where the Bn−4 is the
rightmost occurrence of Bn−4 in y1. This would create a square in ey:

Bn−4 eu3An−4 eu1An−2y3Bn−2 eu2Bn−4 eu3An−4 eu1An−2y3Bn−2 eu2.

19

So Bn−4 /∈ y1. Now, if B = Bn−4 then xB = eu3An−4 eu1An−2 ey1 by Lemma 2.6, since Bn−4 /∈ y1.
This would create a square in wn:

Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2
Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2.

So B 6= Bn−4. This means that, in similar way as in Case 2.1, we get Bn, Bn−2, Bn−4, B /∈
x2AnfxB and An, Bn, Bn−2, Bn−4, B /∈ xB. Together we have

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |An−2| + |fzABnz2|

≤ r(n − 4) + 1 + r(n − 5) + [3r(n − 2) + 4] + r(n − 3) + 1 + r(n − 2)

= 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5

< 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5 + r(n − 5) ≤ 5r(n − 2) + 2.

Case 3.3.2.2.2) y3 = u1Bn−4u2, where Bn−4 is both the right and left special letter.
This case is very similar to the previous, Case 3.3.2.2.1.
Now Bn−4 is both the right and left special letter, which means An−4 = Bn−4. Since
this case is a subcase of Case 3.3.2.2, we have that An−4 = Bn−4 ∈ y2, which means y2 =
eu2Bn−4y′2. If Bn−4 ∈ y1 then y1 = y′1Bn−4 eu1 and we would have a square in ey:

Bn−4 eu1An−2y3Bn−2 eu2Bn−4 eu1An−2y3Bn−2 eu2.

So Bn−4 /∈ y1. If B = Bn−4 then xB = eu1An−2 ey1. This would create a square in wn:

Bn−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2
Bn−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2.

So B 6= Bn−4. This means that, in similar way as in Case 2.1, we get Bn, Bn−2, Bn−4, B /∈
x2AnfxB and An, Bn, Bn−2, Bn−4, B /∈ xB. Again, we have

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |An−2| + |fzABnz2|

≤ r(n − 4) + 1 + r(n − 5) + [3r(n − 2) + 4] + r(n − 3) + 1 + r(n − 2)

= 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5

< 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5 + r(n − 5) ≤ 5r(n − 2) + 2.

Case 3.3.2.2.3) y3 = u1An−4u3Bn−4 eu3An−4u3Bn−4u2, where the rightmost An−4 and the

leftmost Bn−4 are the right and left special letters of y3, respectively.

20

We divide this case into two subcases: Bn−4 /∈ y1 and Bn−4 ∈ y1.
Case 3.3.2.2.3.1) Bn−4 /∈ y1.
Now B 6= Bn−4, since otherwise we would have a square in wn:

An−4u3Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3
An−4u3Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3.

Similar to Case 2.1, we get Bn, Bn−2, Bn−4, B /∈ x2AnfxB and An, Bn, Bn−2, Bn−4, B /∈ xB.
Again, we have

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |An−2| + |fzABnz2|

≤ r(n − 4) + 1 + r(n − 5) + [3r(n − 2) + 4] + r(n − 3) + 1 + r(n − 2)

= 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5

< 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5 + r(n − 5) ≤ 5r(n − 2) + 2.

Case 3.3.2.2.3.2) Bn−4 ∈ y1.
Now y1 = y′1Bn−4 eu3An−4 eu1, where the Bn−4 is the rightmost occurrence of Bn−4 in y1, and
y2 = eu2Bn−4 eu3An−4y′2, where the An−4 is the leftmost occurrence of An−4 in y2. Remember
that we really have An−4 ∈ y2, since this is a subcase of Case 3.3.2.2.
If An−2 ∈ y1 then we can take the rightmost occurrence of An−2 in y′1 and get that
y1 = y′′1 An−2u1An−4u3Bn−4 eu3An−4 eu1, which creates a square in ey:

An−4u3Bn−4 eu3An−4 eu1An−2y3Bn−2 eu2Bn−4 eu3An−4u3Bn−4 eu3An−4 eu1An−2y3Bn−2 eu2Bn−4 eu3.

This means An−2 /∈ y1.

Now we divide this case into two subcases: B 6= An−2 and B = An−2.
Case 3.3.2.2.3.2.1) B 6= An−2.
Now,

in similar way as in Case 2.1, we get that An−2, Bn, Bn−2, B /∈ x2AnfxB and

An, An−2, Bn, Bn−2, B /∈ xB. Again, we have

|wn| = |x2AnfxB| + |B| + |xB| + |AneyBnyAneyBn| + |zA| + |An−2| + |fzABnz2|

≤ r(n − 4) + 1 + r(n − 5) + [3r(n − 2) + 4] + r(n − 3) + 1 + r(n − 2)

= 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5

< 4r(n − 2) + r(n − 3) + r(n − 4) + r(n − 5) + 5 + r(n − 5) ≤ 5r(n − 2) + 2.

Case 3.3.2.2.3.2.2) B = An−2.

21

Bn−4 /∈ y′2, z2.

Now we have that xB = ey1 = u1An−4u3Bn−4 ey′1. We will ﬁrst show that An−4 /∈ y′1, x2 and
If An−4 ∈ y′1 then we have y1 = y′′1 An−4u3Bn−4 eu3An−4 eu1. This creates a square in wn:

u3Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3An−4
u3Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3An−4.

So An−4 /∈ y′1.
creates a square in wn:

If Bn−4 ∈ y′2 then we have that y2 = eu2Bn−4 eu3An−4u3Bn−4y′′2. Also this

Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3An−4u3
Bn−4 eu3An−4 eu1An−2 ey1AneyBn ey2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3An−4u3.

So Bn−4 /∈ y′2. If An−4 ∈ x2 then we could take the rightmost occurrence of An−4 in x2 and
get a square in wn:

An−4u3Bn−4 ey′1Any′1Bn−4 eu3An−4 eu1An−2u1An−4u3Bn−4 ey′1Any′1Bn−4 eu3An−4 eu1An−2u1.

So An−4 /∈ x2. If Bn−4 ∈ z2 then we could take the leftmost occurrence of Bn−4 in z2 and
get a square in wn:

u2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3An−4y′2Bn ey′2An−4u3Bn−4
u2Bn−2 ey3An−2y3Bn−2 eu2Bn−4 eu3An−4y′2Bn ey′2An−4u3Bn−4.

So Bn−4 /∈ z2. Now we know that An−4 /∈ x2Any′1Bn−4 eu3 and Bn−4 /∈ eu3An−4y′2Bnz2.
Similar to Case 2.1, we get An−2, Bn, Bn−2 /∈ x2Any′1Bn−4 eu3 and An, An−2, Bn, Bn−2 /∈
u3Bn−4 ey′1 and An, An−2 /∈ eu3An−4y′2Bnz2. From Proposition 2.11 we get that |u1|, |u2| ≤
r(n − 6) + r(n − 7) + 1, where r(n − 7) = 0 if n = 7. Since An, Bn /∈ y and An−2 is the right
special letter of ey, we trivially have An, An−2, Bn /∈ ey2Bn−2 ey3. From Lemma 2.10 we also get
easily that An, An−2, Bn, Bn−2 /∈ y3. Together we ﬁnally have

|wn| = |x2Any′1Bn−4 eu3| + |An−4 eu1An−2u1An−4| + |u3Bn−4 ey′1| + |AneyBnyAneyBn|

+|ey2Bn−2 ey3| + |An−2| + |y3| + |Bn−2| + | eu2| + |Bn−4| + | eu3An−4y′2Bnz2|

≤ r(n − 4) + [2r(n − 6) + 2r(n − 7) + 5] + r(n− 5) + [3r(n − 2) + 4] + r(n − 3) + 1 + r(n− 4) + 1+

[r(n−6)+r(n−7)+1]+1+r(n−3) = 3r(n−2)+2r(n−3)+2r(n−4)+r(n−5)+3r(n−6)+3r(n−7)+13

< 3r(n−2)+2r(n−3)+2r(n−4)+r(n−5)+3r(n−6)+3r(n−7)+13+r(n−6)+r(n−7) ≤ 5r(n−2)+2.

22

As we can see, improving our upper bound was very exhausting.

If we would like to

achieve Conjecture 2.3, we would need to use a slightly diﬀerent approach.

Let us still estimate our upper bound in a closed form. Suppose ﬁrst n ≥ 7 is even:

r(n) ≤ 5r(n − 2) + 4 ≤ 5(5r(n − 4) + 4) + 4 ≤ . . . ≤ 5(n−6)/2r(6) + 4(5(n−8)/2 + . . . + 5 + 1)

< 5(n−6)/2·(53−58)+(5(n−8)/2+1+. . .+5) = 5n/2−58·5(n−6)/2+(5(n−8)/2+1+. . .+5) < 5n/2 < 2, 237n.

Suppose then that n ≥ 7 is odd:

r(n) ≤ 5r(n − 2) + 4 ≤ 5(5r(n − 4) + 4) + 4 ≤ . . . ≤ 5(n−5)/2r(5) + 4(5(n−7)/2 + . . . + 5 + 1)

< 5(n−5)/2·(52,5−22)+(5(n−7)/2+1+. . .+5) = 5n/2−22·5(n−5)/2+(5(n−7)/2+1+. . .+5) < 5n/2 < 2, 237n.

Together with the lower bound, we ﬁnally get that 2, 008n < r(n) < 2, 237n, for n ≥ 5.

Acknowledgements

I want to thank ˇS. Starosta for making me aware of this problem, L. Zamboni and T.
Harju for insightful comments, and J. Peltom¨aki for calculating the exact value of r(7) and
adding all the values of r(n) up to n = 7 to the OEIS database https://oeis.org/A269560.

References

References

[AFMP] P. Ambroˇz, C. Frougny, Z. Mas´akov´a, E. Pelantov´a: Palindromic complexity of
inﬁnite words associated with simple Parry numbers, Ann. Inst. Fourier (Grenoble) 56
(2006), pp. 2131-2160.

[BDGZ1] M. Bucci, A. De Luca, A. Glen, L. Q. Zamboni: A connection between palindromic
and factor complexity using return words, Advances in Applied Mathematics 42 (2009),
pp. 60-74.

[BDGZ2] M. Bucci, A. De Luca, A. Glen, L. Q. Zamboni: A new characteristic property of

rich words, Theoret. Comput. Sci. 410 (2009), pp. 2860-2863.

[BHNR] S. Brlek, S. Hamel, M. Nivat, C. Reutenauer: On the palindromic complexity of

inﬁnite words, Internat. J. Found. Comput. 15 (2004), pp. 293-306.

[CD] A. Carpi, A. de Luca: Special factors, periodicity, and an application to Sturmian

words, Acta Informatica 36 (2000), pp. 983-1006.

23

[CR] J. D. Currie, N. Rampersad: A proof of Dejeans conjecture, Math. Comput. 80(274)

(2011), pp. 1063-1070.

[D] F. Dejean: Sur un th´eor`eme de Thue, J. Combin. Theory Ser. A 13 (1972), pp. 90-99.

[DGZ] A. de Luca, A. Glen, L. Q. Zamboni: Rich, Sturmian, and trapezoidal words, Theo-

ret. Comput. Sci. 407 (2008), pp. 569-573.

[DJP] X. Droubay, J. Justin, G. Pirillo: Episturmian words and some constructions of de

Luca and Rauzy, Theoret. Comput. Sci. 255 (2001), pp. 539-553.

[GJ] A. Glen, J. Justin: Episturmian words: A survey, Theor. Inform. Appl. 43(3) (2009),

pp. 403-442.

[GJWZ] A. Glen, J. Justin, S. Widmer, L. Q. Zamboni: Palindromic richness, European

Journal of Combinatorics 30 (2009), pp. 510-531.

[HPS] K. Hare, H. Prodinger, J. Shallit: Three Series for the Generalized Golden Mean,

Fibonacci Quart. 52 (2014), pp. 307-313.

[Lot1] M. Lothaire: Combinatorics on Words, in: Encyclopedia of Mathematics and its Ap-

plications, vol 17, Addison-Wesley, Reading, MA, 1983.

[Lot2] M. Lothaire: Algebraic Combinatorics on Words, in: Encyclopedia of Mathematics

and its Applications, vol 90, Cambridge University Press, UK, 2002.

[MP] F. Mignosi, G. Pirillo: Repetitions in the Fibonacci inﬁnite word, Informatique

th´eorique et applications, tome 26, n. 3 (1992), pp. 199-204.

[PS] E. Pelantov´a, ˇS. Starosta: Languages invariant under more symmetries: overlap-

ping factors versus palindromic richness, Discrete Math. 313 (2013), pp. 2432-2445.

[Q] M. Queff´elec: Substitution Dynamical Systems Spectral Analysis, Lecture Notes in

Mathematics. 2nd ed. 2010. Springer-Verlag, Berlin.

[R] M. Rao: Last cases of Dejeans conjecture, Theoret. Comput. Sci. 412(27) (2011), pp.

3010-3018.

[RR] A. Restivo, G. Rosone: Burrows-Wheeler transform and palindromic richness, Theo-

ret. Comput. Sci. 410 (2009), pp. 3018-3026.

[T1] A. Thue: Uber unendliche Zeichenvihen, Kra. Vidensk. Selsk. Skrifter. I Mat.-Nat.Kl.,

Christiana, Nr. 7, 1906.

24

[T2] A. Thue: Uber die gegenseitige Lage gleicher Teile gewisser Zeichenreihen, Kra. Vidensk.

Selsk. Skrifter. I Mat.-Nat.Kl., Christiana, Nr. 12, 1912.

[V] J. Vesti: Extensions of rich words, Theoret. Comput. Sci. 548 (2014), pp. 14-24.

25

