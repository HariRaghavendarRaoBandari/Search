6
1
0
2

 
r
a

 

M
1
1

 
 
]
T
N
h
t
a
m

.

[
 
 

1
v
4
5
5
3
0

.

3
0
6
1
:
v
i
X
r
a

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

Abstract. We study Heegner points on elliptic curves, or more generally modular abelian varieties,
coming from uniformization by Shimura curves attached to a rather general type of quaternionic or-
ders closely related to those introduced by Hijikata–Pizer–Shemanske in the 80’s. We address several
questions arising from the Birch and Swinnerton-Dyer (BSD) conjecture in this general context. In par-
ticular, under mild technical conditions, we show the existence of non-torsion Heegner points on elliptic
curves in all situations in which the BSD conjecture predicts their existence.

Introduction

This work grows on an attempt to study Shimura curves and Heegner points in arithmetically inter-

esting situations which at present are poorly understood.

To motivate our study, let us present an example ﬁrst. Suppose that E/Q is an elliptic curve of
conductor p2q, where p and q are two distinct odd primes, and let K be an imaginary quadratic ﬁeld in
which p is ramiﬁed and q is inert. In this situation one can not construct rational points on E(K) using
parametrizations by modular curves X0(N ), because the classical Heegner hypothesis fails.

However, in this scenario it may perfectly be the case that the sign of the functional equation satisﬁed
by L(E/K, s) be −1 (indeed, this holds under certain arithmetic conditions on the local root numbers
of the functional equation of L(E/K, s) at p and q which are made precise below). If in addition the
order of vanishing of L(E/K, s) at s = 1 is one, then the Birch and Swinnerton-Dyer conjecture predicts
the existence of a rational point in E(K) generating E(K) ⊗ Q. One expects to construct points of
inﬁnite order in E(K) using parametrizations by Shimura curves XU attached to the quaternion algebra
of discriminant equal to pq and open compact subgroups U of (B ⊗ ˆZ)×; note that U can not be maximal
at p because the conductor of the elliptic curve is divisible by p2.
Nevertheless, in this setting one still has a rich theory of local quaternionic orders whose level is divisible
by p2 and optimal embeddings of quadratic orders of K into them; this theory has been developed by
Pizer [Piz80], and then extended in greater generality by Hijikata–Pizer–Shemanske in [HPS89a]. Shimura
curves attached to these orders play an important role in what follows, motivating the title of this paper.
One of the main motivations that led us to work on this project is that these curves can be p-adically
uniformized by the p-adic rigid analytic space corresponding to the ﬁrst (abelian) covering of the Drinfel’d
tower over the p-adic upper half plane Hp. This rigid analytic space has an explicit description (see [Tei90])
which can be used to study p-adic aspects of Heegner points, including their connection to Iwasawa theory
and p-adic L-functions, as in the case where the elliptic curve has multiplicative reduction and can be
uniformized by Drinfel’d upper half plane (cf. [BD96], [BD98], [BD99]).

It would also be highly interesting to extend the theory of Stark–Heegner points in this context
(starting with the foundational paper [Dar01], and developed in [BD07], [BD09], [Das05], [BDD07],
[Gre09], [LRV12], [LRV13], [LV14]). Such a generalization is however not straight-forward, essentially
because the jacobian varieties of the Shimura curves referred to above have additive reduction at p (as
opposed to having toric reduction, which is a crucial feature in the above approaches). We regard this as
an exciting obstacle to overcome rather than a forbidding diﬃculty, and this note aims to settle the ﬁrst
step towards this program that we hope to pursue in the near future.

In any case let us stress from the beginning that, independently of any eventual applications of our
work building on the p-adic uniformization of elliptic curves, in this article we address much more general
questions related to the existence of Heegner points than those coming from the speciﬁc example described
above (and, therefore, use much more general orders than those introduced in [Piz80] and [HPS89a]).

During the work on this paper, M.L. was partially supported by PRIN 2010/11 “Arithmetic Algebraic Geometry and
Number Theory” and PRAT 2013 “Arithmetic of Varieties over Number Fields”; C. de V.-P. was partially supported by
Grant MTM2012-34611 and by the German Research Council via SFB/TR 45; and V. R. was partially supported by Grant
MTM2012-34611.

1

2

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

Indeed, many of our arguments involving Euler systems and applications to the conjecture of Birch and
Swinnerton-Dyer rely on the following apparently na¨ıve question:

Question. Given an elliptic curve E/Q, an imaginary quadratic ﬁeld K and an anticyclotomic character χ
of Gal(K ab/K) factoring through the ring class ﬁeld Hc of conductor c ≥ 1 of K, under which conditions
there exist non-trivial Heegner points in E(Hc)?

Let us now describe in more detail the main results of this article and their implications to the

conjecture of Birch and Swinnerton-Dyer.

As above, let E/Q be an elliptic curve of conductor N , K be an imaginary quadratic ﬁeld and

χ : GK = Gal( ¯K/K)−→C×

be a character of ﬁnite order. We assume throughout that χ is anticyclotomic, meaning that χ(τ στ −1) =
χ−1(σ) for any σ ∈ GK and τ ∈ GQ \ GK. The abelian extension cut out by χ is then a ring class ﬁeld
associated to some order Rc in K of conductor c = c(χ) ≥ 1. Let Hc denote the corresponding abelian
extension, determined by the isomorphism Gal(Hc/K) ≃ Pic(Rc) induced by the Artin map.
Let L(E/K, χ, s) denote the Rankin L-series associated to the twist of E/K by χ. Since χ is anti-
cyclotomic, the motive associated to L(E/K, χ, s) is Kummer self-dual and this implies that the global
root number ε(E/K, χ) of L(E/K, χ, s) is either +1 or −1. Assume for the remainder of the article that

hence in particular L(E/K, χ, s) vanishes at the central critical point s = 1. Deﬁne

ε(E/K, χ) = −1,

(E(Hc) ⊗ C)χ := {x ∈ E(Hc) ⊗ C : σ(x) = χ(σ)x,∀σ ∈ Gal(Hc/K)}.

In this situation, the Galois equivariant version of the Birch–Swinnerton-Dyer conjecture predicts that

L′(E/K, χ, 1) 6= 0

?⇐⇒ dimC (E(Hc) ⊗ C)χ = 1.

In this paper we are concerned with the implication “⇒”. The well-known strategy to prove this
implication, after Kolyvagin’s fundamental work [Kol88], is to exploit Euler systems of Heegner points
on E arising from Heegner points on modular curves X0(N ), via a parametrization

πE : X0(N ) → E

whose existence is a consequence of Wiles’s Modularity Theorem [Wil95], [TW95], [BCDT01]. More
generally, in order to enlarge the source of rational points on elliptic curves, one can use uniformizations of
our ﬁxed elliptic curve E by Jacobians Jac(XU ) of Shimura curves XU associated to indeﬁnite quaternion
algebras B/Q and compact open subgroups U ⊆ ˆB× = (B ⊗ ˆZ)×.
the role of B, we will sometimes write XB,U and XB,R for XU and XR, respectively.

When U = ˆR× = (R ⊗ ˆZ)× for some order R of B, we simply write XR for X ˆR×; also, to emphasize
Section 1 is devoted to introduce an explicit family of special orders R in B which shall play a central
role in our work. These orders are determined by local data at the primes of bad reduction of the elliptic
curve E, following classical work of Hijikata, Pizer and Shemanske that apparently did not receive the
attention it justly deserved.

In section 2 we study the Shimura curves XR associated to the above mentioned Hijikata–Pizer–
Shemanske orders and work out explicitly the Jacquet–Langlands correspondence for these curves, which
allows us to dispose of a rich source of modular parametrizations of the elliptic curve E. For any integer
c, there is a (possibly empty) collection of distinguished points on XR, called Heegner points of conductor
c. The set of Heegner points of conductor c on XR is in natural correspondence with the set of conjugacy
classes of optimal embeddings of the quadratic order Rc in the quaternion order R, and we denote it
Heeg(R, K, c). We say that a point in E(Hc) is a Heegner point of conductor c associated to the order R
if it is the image of a Heegner point of conductor c in XR for some uniformization map

πE : Jac(XR) → E

deﬁned over Q. The corresponding set of Heegner points is denoted HeegE(R, K, c).
In section 3 we perform a careful and detailed analysis of the rather delicate and involved theory of op-
timal embeddings of quadratic orders into Hijikata–Pizer–Shemanske orders. Combining all together this
allows to prove the main result of this article. A slightly simpliﬁed version of this result is the following.
The main virtue of the statement below with respect to previous results available in the literature is that
it is both general (removing nearly all unnecessary hypothesis on divisibility and congruence relations
among N , D and c) and precise (pointing out to a completely explicit Shimura curve).

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

3

Theorem A. Let E/Q be an elliptic curve of conductor N not divisible neither by 23 nor by 34. Let
K be an imaginary quadratic ﬁeld of discriminant −D and χ be an arbitrary anticyclotomic character of
conductor c ≥ 1. Assume that ε(E/K, χ) = −1. Then

(1) there exists an explicit Hijikata–Pizer–Shemanske order R = R(E, K, χ) for which the set of
(2) If L′(E/K, χ, 1) 6= 0 and E does not acquire CM over any imaginary quadratic ﬁeld contained in

Heegner points HeegE(R, K, c) in E(Hc) is non-empty.
Hc, then dimC (E(Hc) ⊗ C)χ = 1.

This theorem is proved in the last section of the article, where we also provide a more general statement
for elliptic curves and prove a similar but weaker result (Theorem 4.5) for modular abelian varieties; we
close the paper with a reﬁned conjecture on the existence of Heegner points on modular abelian varieties.
Theorem A follows from Theorem 4.16 below, where the condition that 23 and 34 do not divide N
is considerably relaxed into the much weaker (but more involved) Assumption 4.9. Namely, we can also
prove the above theorem in all cases where 35 divides N ; there is only one case with 34 dividing N exactly
that we can not treat with our arguments (it is a case in which 3 is inert in K and the p-power conductor
of χ is equal to 1). In addition, if val2(N ) ≥ 4 is even, then the newform f ∈ S2(Γ0(N )) associated to E by
modularity is a twist of a newform f ′ ∈ S2(Γ1(N ′)) for some level N ′ with val2(N ′) < val2(N ) ([HPS89b,
Theorem 3.9]) and in these cases it seems possible to investigate the existence of Heegner points with
diﬀerent methods (namely, prove the existence of Heegner points for the abelian variety corresponding to
f ′ and then twisting back to show the existence of Heegner points on the elliptic curve). Therefore, if we
assume that the form is primitive, in the sense that it is not a twist of a form of lower level, then we can
exclude form our discussion all cases in which val2(N ) is even and greater or equal than 4. Finally, if we
further assume the condition that the 2-component πf,2 of the automorphic representation πf associated
with f has minimal conductor among all its twists by quasi-characters of Q×
2 , then the only cases we
need to exclude in Theorem A above are the following, where ∆ is the discriminant of the quaternion
algebra:

(Missing Cases)

val3(N ) = 4, 3 ∤ ∆, 3 is inert in K and val3(c) = 1;
val2(N ) ≥ 3, 2 ∤ ∆ and 2 is ramiﬁed in K.

See Corollary 4.19 for a complete statement. However, let us stress that these missing cases, even if they
seem to be isolated in the case of elliptic curves, they are not rare at all in the more general context of
modular abelian varieties associated with modular forms of level Γ0(M pr) with p any prime number and
r arbitrarily large.

Statement (2) in the above theorem follows from (1) and well-known Kolyvagin type arguments which

are spelled out in detail in [Nek07]. Namely, given

• a parametrization of the elliptic curve E by a Shimura curve XB,U ,
• a Heegner point x in XB,U (K ab), rational over a subﬁeld K(x) ⊆ K ab, and
• a character χ factoring through Gal(K(x)/K),

Nekov´aˇr shows that if the special value of the derivative of the complex L-function at s = 1 is nonzero,
then the dimension of the C-vector space (E(K(x))⊗ C)χ is equal to 1, provided that E does not acquire
CM over any imaginary quadratic ﬁeld contained in K(x)ker(χ).
In some sense, our Theorem A reverses the logical order of the result in [Nek07], starting with a
character of a given conductor and asking for a Heegner point rational over the subextension of K ab cut
out by that character. Therefore, the whole focus of our work is on statement (1) of the above theorem.
More precisely, this work grows out from a systematic study of existence conditions for Heegner points in
all scenarios in which the BSD conjecture predicts the existence of a non-zero element in (E(Hc) ⊗ C)χ.
To understand the ﬂavour of this work, it is therefore important to stress that we do not require any
condition on the triplet (N, D, c), besides the above restrictions at 2 and 3 (cf. also Assumption 4.9).
Quite surprisingly, the interplay between local root numbers, non-vanishing of the ﬁrst derivative of the
L-function and the theory of optimal embeddings shows that these conditions match perfectly and, in all
relevant cases, Heegner points do exist.

Our approach consists in three steps. Firstly, we need to ﬁnd a suitable candidate Shimura curve XR
equipped with a non-constant map Jac(XR) → E. For this, we need to specify the ramiﬁcation set of
the quaternion algebra B, which is prescribed as usual in terms of local root numbers of ε(E/K, χ) and
ηK(−1), where ηK is the quadratic character associated with K/Q (see for example [YZZ13]).

4

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

Jacquet–Langlands theory, using works of Pizer, Chen and others.

Secondly, we need to specify a convenient order R, and this is an application of a ﬁne version of the
Thirdly, having ﬁxed our Shimura curve XR, we need to prove the existence of Heegner points of
conductor c, and this follows, as hinted above, from a careful study of relations between local root
numbers and optimal embeddings. The main new ingredient in this context is the adaptation of the
theory of local orders in quaternion division algebras developed by Hijikata–Pizer–Schemanske.

In closing this introduction, we would like to mention three interesting papers that have recently seen
the light, two of them by Kohen–Pacetti [KP16a], [KP16b] and one by Cai–Chen–Liu [CCL16], addressing
similar but non-overlapping problems in the case of Cartan level structure. As opposed to these works,
we rather focus on the case where the modular parametrization of the elliptic curve is given by a Shimura
curve associated to an order in a quaternion division algebra. In addition, it is worth remarking that
while [KP16a], [KP16b] and [CCL16] study Euler systems of Heegner points in a scenario where these
are known to exist, our goal is to show that (at least in the case of elliptic curves with local p-adic
representations not too ramiﬁed for p = 2 and p = 3) it is possible to construct a suitable Shimura curve
giving rise to a non-trivial system of Heegner points of prescribed conductor in all situations in which
the BSD Conjecture predicts their existence, covering many new cases.

1. Shimura curves

Let ˆZ denote the proﬁnite completion of Z, and write ˆR := R ⊗Z ˆZ for every Z-algebra R. Fix an
integer ∆ > 1, which is assumed to be square-free and the product of an even number of primes, and let
B be the indeﬁnite rational quaternion algebra of reduced discriminant ∆. Write ˆB = B ⊗Q ˆQ for the
ﬁnite adelization of B. We also ﬁx a maximal order O in B; recall that such an order is unique up to
conjugation by an element in B×. Finally, we shall ﬁx an isomorphism B∞ := B ⊗Q R → M2(R), under
which B× might be seen as a subgroup of GL2(R).
1.1. Shimura curves. Let H± = C − R = P1(C) − P1(R) be the union of the upper and lower complex
half planes, which might be identiﬁed with the set of R-algebra homomorphisms Hom(C, M2(R)). The
action of B× by linear fractional transformations on H± corresponds under this identiﬁcation to the
action of B× by conjugation on Hom(C, M2(R)).

For any compact open subgroup U of ˆO×, one can consider the topological space of double cosets

where notice that U acts naturally on ˆB× by multiplication on the left and B× acts both on ˆB× (diag-
onally) and on Hom(C, M2(R)). By the work of Shimura and Deligne, XU admits the structure of an
algebraic curve over Q and a canonical model, which we shall still denote by XU /Q. This will be referred
to as the Shimura curve associated with U .

Although XU is connected over Q, it might not be in general geometrically connected. Indeed, the set
of geometric connected components of XU (that is, the set of connected components of X U := XU ×Q ¯Q)
is identiﬁed with the ﬁnite set of double cosets U\ ˆB×/B×. Such components are deﬁned over an abelian
extension of Q, and via the reciprocity map from class ﬁeld theory the action of Gal(Qab/Q) ≃ ˆZ× on
them is compatible under the isomorphism

U\ ˆB×/B× ≃−→ n(U )\ ˆQ×/Q× = n(U )\ˆZ×

induced by the reduced norm n on ˆB× (by strong approximation) with the natural action of ˆZ× on
n(U )\ˆZ×.
From the very deﬁnition in (1), one can naturally deﬁne a group of automorphisms of XU , which are
often called modular. Namely, if N (U ) denotes the normalizer of U in ˆB×, then left multiplication by an
element b ∈ N (U ) induces an automorphism λ(b) : XU → XU , given on points by the rule

λ(b) : [g, f ]

7−→ [bg, f ].

Here, [g, f ] denotes the point on XU corresponding to a pair (g, f ) ∈ ˆB× × Hom(C, M2(R)).
It is
immediate to check that λ(b) deﬁnes the identity on XU if and only if b ∈ U Q×. The group Autmod(XU )
of modular automorphisms on XU is then deﬁned to be the group of all the automorphisms obtained in
this way, so that

Autmod(XU ) := U Q×\N (U ).

(1)

XU = (cid:16)U\ ˆB× × Hom(C, M2(R))(cid:17) /B×,

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

5

If U = ˆS× is the group of units in the proﬁnite completion of some order S ⊆ O, then we shall write
In this case, the set of geometric

XS := X ˆS×/Q for the Shimura curve associated with the order S.
connected components of XS is identiﬁed with the class group Pic(S) of S.
Remark 1.1. The most common setting in the literature is when S = SN + is an Eichler order of level N + in
O, where N + ≥ 1 is an integer prime to N − := ∆(B). In this case, the Shimura curve XN +,N − := XS/Q
associated with S is not only connected but also geometrically connected, and its group Autmod(XN +,N −)
of modular automorphisms is the group of Atkin-Lehner involutions, which are indexed by the positive
divisors of N +N −. Further, XN +,N −/Q is the coarse moduli space classifying abelian surfaces with
quaternionic multiplication by O and N +-level structure.
When N − = 1 (so that B is the split quaternion algebra M2(Q)), a case which we exclude in this
paper, the Shimura curve XN +,1/Q is the aﬃne modular curve Y0(N +) obtained as a quotient of the
upper half plane by the congruence subgroup Γ0(N +), whose compactiﬁcation by adding ﬁnitely many
cusps is the usual modular curve X0(N +)/Q.

In this article, we will be working with Shimura curves associated with certain suborders of O which
are not Eichler orders, but rather with more general orders that for example might have non-trivial level
at primes dividing ∆(B). The special class of quaternion order we shall be dealing with is described in
the next section.

1.2. Choice of quaternion orders. Let p be a rational prime and let Bp be a quaternion algebra over
Qp. The object of this section is introducing several families of local quaternion orders in Bp which in
turn will give rise to a fauna of Shimura curves that will serve as the appropriate host of the Heegner
systems we aim to construct.

Assume ﬁrst that Bp = Dp is the unique (up to isomorphism) quaternion division algebra over Qp and
let Op be the unique maximal order in Dp. If Lp is a quadratic extension of Qp and ν ≥ 1 is an integer,
one can deﬁne the (local) quaternion order

Rν(Lp) = OLp + πν−1

p Op,

p, then Rν (Lp) and Rν(L′

p Op.

p) are conjugated by an element in D×

where OLp denotes the ring of integers of Lp and πp is a uniformizer element in Op. Such local orders are
studied in detail by Hijikata, Pizer and Shemanske in [HPS89a]. Notice that R1(Lp) coincides with the
maximal order Op, regardless of the choice of Lp. Further, if L′
p is another quadratic extension of Qp with
Lp ≃ L′
p . For ν ≥ 2, the order Rν(Lp) is
characterized as the unique order in Dp containing OLp and πν−1
Remark 1.2. If p is odd and Lp is the unique unramiﬁed quadratic extension, then R2r+1(Lp) = R2r+2(Lp)
for every r ≥ 0, thus one can think of the orders Rν(Lp) as being indexed by odd positive integers. These
orders were studied in [Piz76], where they are called orders of level p2r+1. When p = 2 or Lp is ramiﬁed,
then Rν+1(Lp) ( Rν(Lp) for every ν ≥ 1, and the order Rν (Lp) depends in general on the choice of Lp.
However, R2(Lp) is independent of Lp, and therefore one can speak of the unique order of level p2 in Dp
(cf. [Piz80]).

p Op but not containing πν−2

Assume now that Bp = M2(Qp) is the split quaternion algebra over Qp. In this algebra the order
M2(Zp) is maximal and it is the only one up to conjugation by elements in GL2(Qp). Below we introduce,
for each positive integer, two diﬀerent GL2(Zp)-conjugacy classes of suborders in M2(Zp), which therefore
deﬁne two diﬀerent GL2(Qp)-conjugacy classes of orders in M2(Qp). Let ν ≥ 1 be an integer.

• The subring of M2(Zp) consisting of those matrices (cid:0) a b
referred to as the standard Eichler order of level pν in M2(Zp). An Eichler order of level pν is
then any order in M2(Qp) which is conjugated to the standard one. We shall denote any of them
by REic

c d(cid:1) in M2(Zp) such that pν | c is commonly

ν , whenever only its conjugacy class is relevant in the discussion.

• Let Qp2 denote the unique unramiﬁed quadratic extension of Qp, and O = Zp2 be its valuation
ring. Then O/pνO is a ﬁnite, free, commutative (Z/pνZ)-algebra of rank 2 with unit discriminant.
In particular, the choice of a basis for O/pνO gives an embedding of (O/pνO)× into GL2(Z/pνZ).
Its image Cns(pν ) is then well-deﬁned up to conjugation. The inverse image of Cns(pν )∪(cid:8)(cid:0) 0 0
0 0(cid:1)(cid:9)
under the reduction modulo pν map M2(Zp) → M2(Z/pν Z) is an order of M2(Zp), commonly
referred to as a non-split Cartan order of level pν. We shall denote any of the orders arising
in this way simply by RCar
, at any time that it is only the conjugacy class that matters in the
discussion.

ν

6

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

Now let B/Q be an indeﬁnite quaternion algebra of discriminant ∆ = ∆(B) as before.

Deﬁnition 1.3. Let NEic ≥ 1 and NCar ≥ 1 be such that (NEic, NCar) = 1 and (NEic · NCar, ∆) = 1.
For each prime p | NEic · NCar, set νp to be the p-adic valuation of NEic · NCar. For each prime p | ∆,
choose an integer νp ≥ 1 and a quadratic extension Lp of Qp. An order R in B is said to be of type
T = (NEic; NCar;{(Lp, νp)}p|∆) if the following conditions are satisﬁed:

νp in B ⊗Q Qp ≃ M2(Qp).
in B ⊗Q Qp ≃ M2(Qp).

(1) If p ∤ NEicNCar∆, then R ⊗Z Zp is a maximal order in B ⊗Q Qp ≃ M2(Qp).
(2) If p | NEic, then R ⊗Z Zp is conjugate to REic
(3) If p | NCar, then R ⊗Z Zp is conjugate to RCar
(4) For every p | ∆, R ⊗Z Zp ≃ Rνp (Lp) in B ⊗Q Qp ≃ Dp.
Fix for the rest of this section an order R in B of type T = (NEic; NCar;{(Lp, νp)}p|∆) as in Deﬁnition
Car · N∆, where we put N∆ := Qp|∆ pνp . If
1.3. Deﬁne the level of R to be the integer NR := NEic · N 2
νp = 1 for every p | ∆, we will sometimes refer to R as a Cartan–Eichler order of type (NEic; NCar) (and
level NEic · N 2
Associated with R, we have the Shimura curve XR/Q deﬁned as in the previous paragraph. The
Shimura curve XR is projective and smooth over Q, but in general it is not geometrically connected. The
reduced norm on R× is locally surjective onto Z×
ℓ at every prime ℓ ∤ ∆ (both Eichler and Cartan orders
in indeﬁnite rational quaternion algebras have class number one), but however the reduced norm on the
local orders Rνp (Lp) is not necessarily surjective onto Z×
p when restricted to the invertible elements.
Despite of this, it is easy to see that [Z×

p : n(Rνp (Lp)×)] is either 1 or 2. Thus if we set

Car).

νp

(2)
then the number of connected components of XR ×Q ¯Q is 2|C|. If ∆ is odd, or if ν2 ≤ 1 in case that ∆ is
even, it follows from [HPS89a, Theorem 3.11] that

C := {p | ∆ prime: n(Rνp (Lp)×) 6= Z×
p },

C = {p | ∆ prime: νp > 1, Lp ramiﬁed}.

The behaviour at p = 2 is a bit more involved, but one still has a characterization of whether n(Rν2 (L2)×)
has index 1 or 2 in Z×
2 (see [HPS89a, Theorem 3.11, 3) and 4)] for details). Furthermore, if ∆ is odd, the
connected components of XR×Q ¯Q are deﬁned over a polyquadratic extension: the number ﬁeld obtained
as the compositum of the quadratic extensions Q(√p∗) for p ∈ C, where p∗ = ( −1

p )p.

Example 1.4. Suppose ∆ = pq with p and q distinct odd primes, and let Lp be a quadratic ramiﬁed
extension of Qp. Consider an order R of type (M ; 1;{(Lp, 2), (Lq, 1)}) and level N = M p2q. As noticed
in the above remark, this order does not depend on the choice of Lp. The Shimura curve XR/Q has
two geometric connected components deﬁned over the quadratic ﬁeld Q(√p∗), and they are conjugated
by the Galois action (in particular, they are isomorphic over Q(√p∗)). There is a unique Eichler order
S containing R, and the morphism of Shimura curves XR → XS induced by the inclusion ˆR× ⊆ ˆS× is
cyclic of degree p + 1. Modular cusp forms in S2(Γ0(N )) which are N/M -new and not principal series
at p lift via the Jacquet–Langlands correspondence to quaternionic modular forms on the Shimura curve
XR (see below).

2. Modular forms and the Jacquet–Langlands correspondence

We ﬁx throughout this section an indeﬁnite quaternion algebra B of discriminant ∆ and an order R

of B of type T = (NEic; NCar;{(Lp, νp)}p|∆) and level NR = NEicN 2
2.1. Cusp forms with respect to R. We identify the Lie algebra of left invariant diﬀerential operators
on B×

∞ := (B ⊗Q R)× ≃ GL2(R) with M2(C), and deﬁne the diﬀerential operators
2 (cid:18) 0
√−1

(cid:19) .
Deﬁnition 2.1. Let k be an integer. A cusp form of wight k with respect to R is a function

√−1 −1 (cid:19) , X∞ = (cid:18)

−√−1
−1 (cid:19) , W∞ =

X∞ = (cid:18) 1

−√−1

−√−1

√−1

CarN∆.

1

1

0

satisfying the following properties:

f : (B ⊗Q AQ)× = ˆB× × GL2(R) −→ C

(1) if g ∈ (B⊗Q AQ)×, then the function GL2(R) → C given by x 7→ f (xg) is of C∞-class and satisﬁes

W∞f = (k/2)f , X∞f = 0;

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

7

(2) for every γ ∈ B× and every u ∈ ˆR× × R>0, f (ugγ) = f (g).

The C-vector space of all cusp forms of weight k with respect to R will be denoted Sk(R).
The product Qp|∆ B×
p acts on the space Sk(R) by left translation, and through this action one can
decompose Sk(R) into the direct sum of subspaces on which Qp|∆ B×
p acts through some admissible
representation (with trivial central character). More precisely, suppose that for each p | ∆ we are given
an irreducible admissible representation (with trivial central character) ρp of B×
p whose restriction to R×
p
is trivial (i.e., R×
p . Since the
representations ρp are ﬁnite-dimensional, the integer dρ := dim(ρ) = Qp|∆ dim(ρp) is well-deﬁned.
Deﬁnition 2.2. Let k be an integer, and ρ be a representation as above. A cusp form of weight k with
respect to (R, ρ) is a function

p ⊆ ker(ρp)). Deﬁne ρ := ⊗p|∆ρp, regarded as a representation of Qp|∆ B×

f : (B ⊗Q AQ)× = ˆB× × GL2(R) −→ Cdρ

satisfying the following conditions, for every g ∈ (B ⊗Q AQ)×:

p , f (bg) = ρ(b)f (g);

(1) for every γ ∈ B×, f (gγ) = f (g);
(2) for every b ∈ Qp|∆ B×
(3) for every prime ℓ ∤ ∆ and u ∈ R×
(4) the function GL2(R) → Cdρ given by x 7→ f (xg) is of C∞-class and satisﬁes W∞f = (k/2)f ,
(5) for every z ∈ ˆQ× × R×, f (gz) = f (g).

ℓ , f (ug) = f (g);

X ∞f = 0;

We write Sk(R, ρ) for the C-vector space of cusp forms of weight k with respect to (R, ρ).

The C-vector spaces Sk(R, ρ) enjoy the following multiplicity one property:

Proposition 2.3 (cf. Prop. 2.14 in [Hid81]). If two forms in Sk(R, ρ) are common eigenforms of the
Hecke operators Tℓ for all primes ℓ ∤ N with same eigenvalues, then they diﬀer only by a constant factor.
The subspace of Sk(R) on which Qp|∆ B×
isomorphic to Sk(R, ρ)dρ , hence one deduces that
(3)

p acts through an admissible representation ρ as above is

Sk(R) ≃ Mρ

Sk(R, ρ)dρ ,

where ρ ranges over the representations ρ = ⊗p|∆ρp as above, satisfying R×
Remark 2.4. The automorphic approach sketched before is related to the more classical point of view as
follows. Let h = h(R) denote the class number of R and choose elements ai ∈ ˆB×, i = 1, . . . , h, such
that

p ⊆ ker(ρp).

h

ˆB× =

ai=1

ˆR×aiB×.

Consider the discrete subgroups of SL2(R) deﬁned by
ˆR×ai

+ ∩ a−1

Γi := B×

i

(i = 1, . . . , h),

+ is the subgroup of units of positive reduced norm (we may write B×

+ = B× ∩ GL+
where B×
2 (R) using
our identiﬁcation of B ⊗Q R with M2(R)). If we denote by Sk(Γi) the C-vector space of cusp forms of
weight k with respect to the group Γi, then there is an isomorphism of complex vector spaces:

h

ai=1

Sk(Γi) ≃−→ Sk(R).

2.2. Jacquet–Langlands. The space Sk(R) can be equipped with a standard action of Hecke operators
and Atkin–Lehner involutions, described for example in [Hid81]. We have the following version of the
Jacquet–Langlands correspondence:

Theorem 2.5 (cf. Prop. 2.12 in [Hid81]). There is a Hecke equivariant injection of C-vector spaces

where Nρ is the conductor of ρ.

Sk(R, ρ)֒−→Sk(Γ0(NEicN 2

CarNρ)),

8

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

Combining Theorem 2.5 with (3) we can embed the space Sk(R) into a space of classical modular cusp

forms

(4)

JL : Sk(R)֒−→Mρ

Sk(NEicN 2

CarNρ)dρ.

The multiplicities dρ can be described explicitly: cf. [Car84, §5].
Example 2.6. Suppose p | ∆ is an odd prime. The quaternion algebra Bp = B ⊗Q Qp is equipped with a
natural decreasing ﬁltration O×

p (i) deﬁned by setting
O×
p (0) = O×

and O×

p

p (i) = 1 + ̟i

pO×
p ,

where Op is the unique maximal order in Bp and ̟p is a local uniformizer.
If ρp is an admissible
irreducible representation of B×
p , then its conductor is by deﬁnition pn+1, where n ≥ 0 is the smallest
integer such that O×
p (n) lies in the kernel of ρp. In particular, observe that the conductor is at least p.
Thus, if p2 ∤ NR then R×
p is precisely the group of units in the local maximal order at p, thus
the admissible irreducible representations ρp we are concerned with all have conductor p. If p2 | NR
and p3 ∤ NR, we have O×
p , and therefore the conductor of the admissible irreducible
representations ρp might be either p or p2. For each prime p | ∆, the dimension of ρp is determined by
its minimal conductor, which by deﬁnition is the smallest conductor of the representations ρp ⊗ χ, as χ
ρp = pa
ranges over the characters of Q×
with a ∈ {1, 2}, then dρp = a.

ρp be the minimal conductor of ρp. By [Car84, §5], if N min

p = O×
p (1) ⊆ R×

p . Let N min

p ⊆ O×

The above arguments give us a Hecke equivariant inclusion of Sk(R) into a direct sum of spaces of
classical modular cusp forms. In order to circumvent the problem of explicitly determining the multiplic-
ities dρ, we use Proposition 2.7 below, which beneﬁts from an explicit version of Eichler trace formula
due to Hijikata, Pizer and Shemanske.

For the reader’s convenience, we recall the classiﬁcation of Jacquet–Langlands lifts given in [HPS89b],
and from now on we focus on the weight 2 case. So let f ∈ S2(Γ0(Nf )) be a weight 2 modular cusp
form, and assume that Nf = psM for some prime p and integers s, M ≥ 1, with p ∤ M . Suppose φ is a
Jacquet–Langlands lift of f which is realized on the deﬁnite quaternion algebra B(p) of discriminant p.
We want to determine the level of φ, by which we mean the local p-type of the order R of B(p) used to
deﬁne its level structure. Such local order is of the form Rn(L), for some positive integer n and quadratic
extension L/Qp, and it is determined as follows:

(1) if p is odd:

(a) s odd: L is unramiﬁeld and n = s ([HPS89b, Theorem 8.5]).
(b) s even: L is ramiﬁed (any of the two ramiﬁed extensions) and n = s ([HPS89b, Proposition

8.8 Case D]).

(2) if p = 2:

(a) s = 1: L is the unramiﬁed quadratic extension of Q2 and n = 1 ([HPS89b, Proposition 8.8

Case C]).

(b) s odd, s ≥ 3: L is unramiﬁeld and n = s ([HPS89b, Theorem 8.5]).
(c) s = 2: L = Q2(√3) or L = Q2(√7) and n = 2 [HPS89b, Proposition 8.8 Case F Eq. (8.17)].
(d) s even, s ≥ 4: In this case, f is a twist by a non-trivial character of conductor 2s/2 of one of

the previous cases ([HPS89b, Theorem 3.9]).

Proposition 2.7. Let f ∈ S2(Γ0(Nf )) be a newform and ﬁx a set Σ of even cardinality consisting of
primes ℓ | Nf such that the local admissible representation πf,ℓ of GL2(Qℓ) attached to f is square-
integrable. Let B/Q be the indeﬁnite quaternion algebra of discriminant ∆ = Qℓ∈Σ ℓ, and NEic, NCar be
positive integers such that (NEic, NCar) = 1, NEicN 2
Then there exists an order Rmin ⊂ B of type Tmin = (NEic; NCar;{(Lp, νp)}p|∆) such that f lifts to a
quaternionic modular form on S2(Rmin) having the same Hecke eigenvalues for the Hecke operators Tℓ
at primes ℓ ∤ Nf . Further, for each prime p | ∆ the data (Lp, νp) depends only on valp(Nf ).

Car | Nf and (NEicNCar, ∆) = 1.

The subscript ‘min’ in Rmin refers to the minimal level for primes dividing ∆, determined by the
classiﬁcation explained above. We note that if νp is odd then Lp is unramiﬁed, and if νp is even then Lp
is ramiﬁed.

Proof. Since π is square integrable at all primes in Σ, [Gel75, Theorem 10.2] implies the existence of an
automorphic form π′ on the algebraic group of invertible elements of the indeﬁnite quaternion algebra B

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

9

p ≃ π(p)

p

ℓ ≃ πℓ for all primes ℓ. To specify the order R we need to describe π′

as in the statement such that π′
ℓ at
every prime ℓ. For primes ℓ ∤ NCar∆ the assertion is obvious. Fix a prime p | ∆ and let B(p) be the deﬁnite
quaternion algebra of discriminant p. Then Eichler’s trace formula in [HPS89b] shows the existence of
an automorphic form π(p) for B(p) attached to a speciﬁc order R(p) of type (L, ν(L)) depending only on
valp(Nf ) with π′
(we have sketched above the recipe for L and ν(L)). Finally, for primes dividing
NCar a similar argument works using this time the trace formula in [Che98, Sec. 6] (the proof in [Che98]
only works for p 6= 2, but one can check that it can be extended to the case p = 2).
(cid:3)
Remark 2.8. Let Nmin be the level of the order Rmin in the proposition. Then observe that Nmin divides
Nf . Even more, we have valp(Nmin) = valp(Nf ) for every odd prime p. And in case that Nf is even,
then val2(Nmin) < val2(Nf ) implies that 2 | ∆ and val2(Nf ) is even and at least 4.
Example 2.9. It follows from [Piz80] that, given a primitive (in the sense of [Piz80, Deﬁnition 8.6]) new
cuspidal eigenform f of level Γ0(p2M ) as in the proposition with p ∤ M an odd prime, the subspace of
new forms in S2(R) having the same system of Hecke eigenvalues as f (at primes outside Nf = p2M )
is two-dimensional. So we have a “multiplicity 2 phenomenon” as expected from the Example 2.6 and
Hecke-equivariant monomorphism JL in (4).

2.3. Modular parametrizations. Let JR/Q denote the Jacobian variety of XR. It is a (principally
polarized) abelian variety deﬁned over Q, of dimension equal to the genus of XR. Since XR is not in
general geometrically connected, it follows that JR might be not absolutely simple. Recall the following:

Deﬁnition 2.10. An abelian variety A/Q is said to be modular if there exists a normalized newform

f = Pn≥1 anqn of weight 2 and level Γ0(Nf ) for some Nf ≥ 1 such that

L(A, s) = Yσ:F ֒→ ¯Q

L(f σ, s),

where F stands for the number ﬁeld generated by the Fourier coeﬃcients of f , σ ranges over the embed-

dings of F into an algebraic closure of Q and f σ = Pn≥1 σ(an)qn.
Proposition 2.11. Suppose that A/Q is a modular abelian variety associated with a modular form
f = JL(φ) for some φ ∈ S2(R). Let Iφ ⊆ T be the kernel of the ring homomorphism T → Z determined
by the system of Hecke eigenvalues of φ. Then the quotient abelian variety Aφ := JR/IφJR is isogenous
to Ar for some r ≥ 1.
Proof. Let ℓ ∤ Nf be a prime and ̺ : GQ → Aut(Taℓ(A) ⊗ Qℓ) be the 2-dimensional ℓ-adic Galois
representation arising from the natural action of GQ on the ℓ-adic Tate module Taℓ(A) of A. Similarly,
let θ : GQ → Aut(Taℓ(Aφ)⊗Qℓ) be the ℓ-adic Galois representation attached to Aφ. The Eichler–Shimura
relations (proved in the required generality in [Nek]) imply that θ(σ) is annihilated by the characteristic
polynomial of ̺(σ) for every σ ∈ GQ. Then the Boston–Lenstra–Ribet Theorem [BLR91] implies that
Taℓ(Aφ) ⊗ Qℓ is isogenous to a direct sum of r copies of Taℓ(A) ⊗ Qℓ for some r ≥ 1. Finally, Faltings’
Isogeny Theorem implies that Aφ is isogenous to r copies of A.
Example 2.12. Suppose that R is of type (M ; 1;{(Lp, 2), (Lq, 1)} and level N := NR = M p2q, with p
and q distinct odd primes as in Example 1.4. Set F = Q(√p∗). Then

(cid:3)

where JR,i/F is the Jacobian variety of XR,i. Let S2(Γ0(N )) be the subspace of S2(Γ0(N )) consisting
of primitive newforms. From Example 2.9 we know that there is a 2-to-1 Hecke-equivariant morphism of
C-vector spaces

JR ×Q F ∼ JR,1 × JR,2,

S2(R) −→ S2(Γ0(N )),

where S2(R) is the subspace of modular forms φ ∈ S2(R) such that JL(φ) ∈ S2(Γ0(N )). By a slight
abuse of notation we continue to denote by JL this morphism.
Fix f ∈ S2(Γ0(N )) and assume that the Fourier coeﬃcients of f belongs to Z. Then the abelian variety
associated with f is an elliptic curve E of conductor M p2q. Let φ ∈ S2(R) be such that JL(φ) = f
(we have two linearly independent possible choices). The space S2(R) of weight 2 modular forms for R
is identiﬁed with H 0(XR, Ω1), which in turn is identiﬁed with the tangent space at the identity T0(JR)
of JR. The subspace S2(R) corresponds then to a subspace of H 0(XR, Ω1), and hence to the tangent
space T0(JR) of an abelian subvariety JR of JR. The space of modular forms S2(R) has rank 2 over

10

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

the Hecke ring T, and from this it follows that T0(JR)/T0(IφJR) has dimension 2 over Q. Hence Aφ is
2-dimensional, and therefore Aφ ∼ E × E.

3. Heegner points

3.1. Optimal embeddings. As in previous sections, B denotes an indeﬁnite rational quaternion algebra
of discriminant ∆ = ∆(B). We ﬁx an order R and a quadratic ﬁeld K. For each positive integer c write
Rc for the (unique) order of conductor c in K, R1 being the full ring of integers of K.

Deﬁnition 3.1. Let c be a positive integer. An embedding from K to B, i.e. a Q-algebra homomorphism
f : K → B, is said to be optimal with respect to R/Rc if the equality

f (K) ∩ R = Rc

holds. Since f is determined by its restriction to Rc, we also speak of optimal embeddings of Rc into R.
Two optimal embeddings f, f ′ of Rc into R will be considered to be equivalent if they are conjugate
one to each other by an element in R×. The set of R×-conjugacy classes of optimal embeddings of Rc
into R will be denoted Embop(Rc,R). We are interested in computing the integer

v(Rc,R) = | Embop(Rc,R)|,

Suppose now that R is of type T = (NEic; NCar;{(Lp, νp)}p|∆) and level NR = NEicN 2

and in particular in knowing whether the set Embop(Rc,R) is empty or not.
CarN∆. Recall
that the class number h(R) of the order R is 2|C|, where C is the set introduced in (2). Although the
class number of R is therefore not trivial in general, the lemma below asserts that the type number of R
is always trivial, which amounts to saying that all orders in B of the same type T are conjugate one to
each other.

Lemma 3.2. The type number of orders of a ﬁxed type T is 1.
Proof. Fix a type T = (NEic; NCar;{(Lp, νp)}p|∆) as in Deﬁnition 1.3, and let R and R′ be two orders
of type T in B. First of all, notice that R (resp. R′) is a suborder of a unique Cartan–Eichler order S
(resp. S′) of level NEicN 2
Car. Namely, the order which is locally equal to R (resp. R′) at every prime
p ∤ ∆ and locally maximal at primes p | ∆, hence of type (NEic; NCar;{(Lp, 1)}p|∆). Conversely, it is
clear by construction that R (resp. R′) is the unique suborder of type T of the Cartan–Eichler order S
(resp. S′). The lemma now follows from the fact that the type number of Cartan–Eichler orders in B
is 1, so that S and S′ are conjugate. By the above observation, this immediately implies that R and R′
are conjugate as well.

(cid:3)

By virtue of the above lemma, the number v(Rc,R) can be expressed essentially as a product of local
contributions that can be explicitly computed. Indeed, proceeding as in the proof of the ‘trace formula’
in [Vig80, Ch. III, 5.C] (cf. especially Theorems 5.11 and 5.11 bis, or [Brz89]) for Eichler orders, we have
that

(5)

v(Rc,R) =

h(Rc)

h(R) Yℓ

vℓ(Rc,R),

where h(Rc) (resp. h(R)) is the class number of the quadratic order Rc (resp. of R), the product ranges
over all rational primes and, for each ℓ, vℓ(Rc,R) denotes the number of local optimal embeddings of
Rc ⊗Z Zℓ into R ⊗Z Zℓ modulo conjugation by (R ⊗Z Zℓ)×. These local contributions are 1 for every
prime ℓ ∤ N . The number of local optimal embeddings is determined in §3.2 below. Here we give the
following:
Example 3.3. Assume that NCar = 1, ∆ is odd and νp ≤ 2 for all p | ∆. Then
ℓ (cid:27)(cid:19) Yp|∆

ℓ (cid:27)(cid:19) Yq|∆

(cid:18)1 −(cid:26) Rc

v(Rc,R) =

h(Rc)

h(R) Yℓ|NEic

(cid:18)1 +(cid:26) Rc

vp(Rc,R),

where for primes p | ∆ with νp = 2,

vp(Rc,R) = 


ν(q)=1

νp=2

2
p + 1
0

if p || c and p is inert in K,
if p ∤ c and p ramiﬁes in K,
otherwise.

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

11

Here (cid:8) R

ℓ (cid:9) denotes the usual Eichler symbol attached to a quadratic order R and a prime number ℓ.

3.2. Local optimal embeddings. For the reader’s convenience, we reproduce in this subsection the
criteria for the existence of local optimal embeddings of orders in quadratic ﬁelds into quaternion orders
in the Eichler, Cartan and division cases.

3.2.1. Eichler case. Let p be a prime, K/Qp be a quadratic separable algebra, and Om ⊆ K be the order
in K of conductor pm. Let also M2(Qp) be the split quaternion algebra over Qp and REic
n be the standard
Eichler order of level pn in M2(Qp). Write h(m, n) for the number of (equivalence classes of) optimal
embeddings of Om into REic
n .
Suppose ﬁrst that K = Qp ⊕ Qp is the split quadratic Qp-algebra. Then m is the smallest positive
integer such that Om/pmOm ≃ Z/pmZ. In this case, the embedding (a, b) 7→ (cid:0)
pn−m(a−b) b(cid:1) from K into
M2(Qp) deﬁnes an optimal embedding from Om into REic
lemma.
Lemma 3.4. If K is the split quadratic Qp-algebra, then Om can be optimally embedded in REic
every m ≥ 0. That is, h(m, n) 6= 0 for every m ≥ 0.

n . For later reference, we state the following

for

n

a

0

Next we assume that K/Qp is a quadratic ﬁeld extension with valuation ring O, and again for each
m ≥ 1 let Om be the order of conductor pm in K. Recall that the Eichler symbol is deﬁned as follows:

p (cid:27) = 
(cid:26)Om


−1 if m = 0 and K/Qp is unramiﬁed;
0
1

if m = 0 and K/Qp is ramiﬁed;
if m ≥ 1.

It is well known ([Hij74], [Vig80]) that if n = 0 then h(m, n) = 1, and for n = 1 one has h(m, n) =

1 + n Om

p o. Thus, in particular, every quadratic order Om can be optimally embedded in the maximal

Eichler order unless m = 0 and K/Qp is unramiﬁed, the only case when h(m, 1) = 0. More generally (see
[Brz91, Corollary 1.6]):

Lemma 3.5.

(1) If K/Qp is unramiﬁed, then h(m, n) 6= 0 if and only if m ≥ n/2.

(2) If K/Qp is ramiﬁed, then h(m, n) 6= 0 if and only if m ≥ (n − 1)/2.

3.2.2. Cartan Case. Let p be a prime, K = Qp2 be the unramiﬁed quadratic extension of Qp and O = Zp2
be its valuation ring. As above, for m ≥ 1 write Om for the order of conductor pm in K. From the very
deﬁnition of non-split Cartan orders, we have the following lemma, which we state for later reference:

Lemma 3.6. Let RCar
embedded in RCar

n

be a non-split Cartan order of level pn in M2(Qp). Then O can be optimally

n . For m > 1, the order Om does embed in RCar

n , but not optimally.

3.2.3. Division case. References: [HPS89a]. Let p be a prime, and Dp be the unique division quaternion
algebra over Qp. As above, write Rn(L) for the local order in Dp associated to the choice of an integer
n ≥ 1 and a quadratic extension L/Qp. Let K/Qp be a quadratic ﬁeld extension, and Om denote the
order of conductor pm in K as before. Recall that h(m, n, L) denotes the number of equivalence classes
of optimal embeddings of Om into Rn(L).
any quadratic ﬁeld extension L/Qp:

It might be useful ﬁrst to recall the notation used in [HPS89a] for the symbols t(L) and µ(L, L′). For

• t(L) = −1 means L unramiﬁed;
• t(L) = 0 means L ramiﬁed and p 6= 2;
• t(L) = 1 means p = 2 and L = Qp(√3) or L = Qp(√7);
• t(L) = 2 means p = 2 and L = Qp(√2), L = Qp(√6), L = Qp(√10) or L = Qp(√14).

And for any pair of quadratic ﬁeld extensions (L, L′) of Qp having discriminants ∆(L) and ∆(L′) we
have:

• µ(L, L′) = µ(L′, L) (Theorem 3.10 A (iii) of [HPS89a]);
• If ∆(L) = ∆(L′) (which is the case if L ≃ L′) then µ(L, L′) = ∞;
• If t(L) = −1 and ∆(L) 6= ∆(L′) then µ(L, L′) = 1;
• If t(L) = 0, t(L′) = 0 and ∆(L) 6= ∆(L′) then µ(L, L′) = 2;
• If t(L) = 1, t(L′) = 1 and ∆(L) 6= ∆(L′) then µ(L, L′) = 3;
• If t(L) = 1, t(L′) = 2 then µ(L, L′) = 3;

12

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

• If t(L) = 2, t(L′) = 2 and ∆(L) 6= ∆(L′) then µ(L, L′) = 5.

The criteria for the existence of optimal embeddings then reads as follows:

(1) p odd:

(2) p = 2:

(a) n = 2̺ + 1 odd, K unramiﬁed, L unramiﬁed: h(m, n, L) 6= 0 if and only if m ≤ ̺.

In
particular, if Rn(L) is maximal and Om is not maximal (i.e. m > 0 and n = 0) then
h(m, n, L) = 0.
(b) n = 2̺+ 1 odd, K ramiﬁed, L unramiﬁed: h(m, n, L) 6= 0 if and only if m = ̺. In particular,
if Rn(L) is maximal and Om is not maximal (i.e. m > 0 and n = 0) then h(m, n, L) = 0.
(c) n = 2̺ even, K unramiﬁed, L ramiﬁed: h(m, n, L) 6= 0 if and only if m = ̺.
(d) n = 2̺ even, K ramiﬁed, L ramiﬁed and K 6≃ L: h(m, n, L) 6= 0 if and only if m = ̺ − 1.
(e) n = 2̺ even, K ramiﬁed, L ramiﬁed and K ≃ L: h(m, n, L) 6= 0 if and only if m ≤ ̺ − 1.
(a) n = 1, K ramiﬁed or unramiﬁed, L unramiﬁed: h(m, n, L) 6= 0 if and only if m = 0.
(b) n = 2̺, K unramiﬁed, L = Q2(√3) or L = Q2(√7); this is the case of t(L) = 1, t(K) = −1
and therefore µ(L, K) = 1: h(m, n, L) 6= 0 if and only if m = ρ.
(c) n = 2̺, K = Q2(√3) or K = Q2(√7), L = Q2(√3) or L = Q2(√7) and K 6≃ L; this is the
case of t(L) = 1, t(K) = 1 and ∆(L) 6= ∆(K) and therefore µ(L, K) = 3: h(m, n, L) 6= 0 if
and only if m = ρ − 1.
(d) n = 2̺, K = Q2(√3) or K = Q2(√7) and K ≃ L; this is the case of t(L) = 1, t(K) = 1 and
∆(L) = ∆(K) and therefore µ(L, K) = ∞: h(m, n, L) 6= 0 if and only if m ≤ ρ − 1.
(e) n = 2̺, K = Qp(√2), K = Qp(√6), K = Qp(√10) or K = Qp(√14), L = Q2(√3) or
L = Q2(√7); this is the case of t(L) = 1, t(K) = 2 and therefore µ(L, K) = 3: h(m, n, L) 6= 0
if and only if m = ρ − 1.
(f) n = 2̺ + 1 odd, n ≥ 3, K unramiﬁed and L unramiﬁed: h(m, n, L) 6= 0 if and only if m ≤ ̺.
(g) n = 2̺ + 1 odd, n ≥ 3, K ramiﬁed and L unramiﬁed: h(m, n, L) 6= 0 if and only if m = ̺.
(h) n = 2̺, K unramiﬁed and L ramiﬁed. Then t(L) = 1 or 2 and µ(L, K) = 1: h(m, n, L) 6= 0
(i) n = 2̺, K = Q2(√3) or K = Qp(√7), L = Q2(√2), L = Q2(√6), L = Q2(√10) or
L = Q2(√14). Then t(L) = 2, t(K) = 1, µ(L, K) = 3: h(m, n, L) 6= 0 if and only if
m = ̺ − 1.
(j) n = 2̺, K = Q2(√2), K = Q2(√6), K = Q2(√10) or K = Q2(√14), L = Q2(√2),
L = Q2(√6), L = Q2(√10) or L = Q2(√14) and K 6≃ L. Then t(L) = 2, t(K) = 2,
µ(L, K) = 5: h(m, n, L) 6= 0 if and only if m = ̺ − 1 or m = ̺ − 2.
(k) n = 2̺, K = Q2(√2), K = Q2(√6), K = Q2(√10) or K = Q2(√14), and K ≃ L. Then
t(L) = 2, t(K) = 2, µ(L, K) = ∞: h(m, n, L) 6= 0 if and only if m ≤ ̺ − 1.

if and only if m = ̺.

3.3. Heegner points. Let U be any open compact subgroup of ˆB×, and assume that K is an imaginary
quadratic ﬁeld. There is a natural map

ˆB× × Hom(K, B) −→ (cid:16)U\ ˆB× × Hom(C, M2(R))(cid:17) /B× = XU (C)

obtained by extending scalars (i.e., tensoring with R). Notice that the left-hand side can certainly be the
empty set, as Hom(K, B) is empty if K does not embed into B. We shall assume that this is not the
case in the discussion below. If (g, f ) ∈ ˆB× × Hom(K, B), write [g, f ] for its image in XR(C). Points in
the image of this map are called Heegner points; the set of such Heegner points is denoted Heeg(U, K).
For each positive integer c, continue to denote by Rc the order of conductor c in K and let R be an

order of B.
Deﬁnition 3.7. A point x ∈ XR is called a Heegner point of conductor c associated to K if x = [g, f ]
for some pair (g, f ) ∈ ˆB× × Hom(K, B) such that

f (K) ∩ g−1 ˆRg = f (Rc).

This last condition means that f is an optimal embedding of Rc into the order g−1 ˆRg ∩ B. We shall
denote by Heeg(R, K, c) the set of Heegner points of conductor c associated to K in XR.

Recall that the set of geometrically connected components of the Shimura curve XR is in bijection
with ˆR×\ ˆB×/B×, and hence with the class group Pic(R) of R. In particular, the number of geometric

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

13

connected components coincides with the class number h(R). Fix representatives Ij for the distinct h(R)
ideal classes in Pic(R), and let aj ∈ ˆB× be the corresponding representatives in ˆR×\ ˆB×/B×. It is then
clear that every Heegner point in Heeg(R, K, c) can be represented by a pair of the form (aj, f ), for a
ˆRaj ∩ B. Further,
unique j ∈ {1, . . . , h(R)} and some optimal embedding f from Rc into the order a−1
two pairs (aj, f ) and (aj, g) represent the same Heegner point if and only if the embeddings f and g are
R×-conjugate. Therefore, we have the following identity relating Heegner points on XR attached to Rc
and optimal embeddings of Rc into R:

j

|Heeg(R, K, c)| = h(R)| Embop(Rc,R)| = h(R)v(Rc,R),

thus applying (5) we ﬁnd:

Proposition 3.8. The number of Heegner points on XR attached to Rc is h(Rc)Qℓ vℓ(Rc,R).
3.4. Galois action and ﬁelds of rationality. Keep the same notations as above, and assume that Rc
embeds optimally in R, so that Heegner points with respect to Rc do exist on XR. The reciprocity law,
cf. [Del71, 3.9], [Mil90, II.5.1] (with a sign corrected [Mil92, 1.10]), asserts that CM(R, K, c) ⊆ XR(K ab),
where as usual K ab denotes the maximal abelian extension of K, and further that the Galois action of
Gal(K ab/K) on CM(R, K, c) is described by
(6)
Here, recK : ˆK × → Gal(K ab/K) is the reciprocity map from class ﬁeld theory. Then, for an arbitrary
a ∈ ˆK × and every Heegner point [g, f ] we have

recK(a)[g, f ] = [ ˆf (a)g, f ],

(a ∈ ˆK ×).

recK(a)[g, f ] = [g, f ] ⇐⇒ there exist b ∈ B×, u ∈ ˆR× such that ( ˆf (a)g, f ) = (ugb, b−1f b).

It is easy to show that if f : K → B is an embedding and b ∈ B×, then the equality f = b−1f b holds if
and only if b = f (λ) for some λ ∈ K ×. Thus we deduce that

recK(a)[g, f ] = [g, f ] ⇐⇒ there exist λ ∈ K ×, u ∈ ˆR× such that ˆf (a) = g−1ugf (λ)

By class ﬁeld theory, recK induces an isomorphism

⇐⇒ a ∈ ˆf −1(g−1 ˆR×g)K × = ˆR×

c K ×.

ˆK ×/ ˆR×

c K × = Pic(Rc) ≃−→ Gal(Hc/K),
where Hc is the ring class ﬁeld of conductor c. Hence we have proved:
Proposition 3.9. With notations as above, Heeg(R, K, c) ⊆ XR(Hc), and the action of Gal(Hc/K) on
the set of Heegner points Heeg(R, K, c) is described by the rule in (6).

4. Applications

4.1. Gross–Zagier formula. We brieﬂy review the general form of Gross–Zagier formula in [YZZ13] for
modular abelian varieties. Let B/Q be an indeﬁnite quaternion algebra of discriminant ∆. If U1 ⊆ U2
are open compact subgroups of ˆB×, then we have a canonical projection map πU1,U2 : XU1
։ XU2, and
one may consider the projective limit

and let J := Jac(X) denote the Jacobian variety of X.

X = lim←−U

XU ,

Deﬁnition 4.1. A simple abelian variety A/Q is said to be uniformized by X if there exists a surjective
morphism J ։ A deﬁned over Q.

Let A/Q be a simple abelian variety uniformized by X and ﬁx U such that there is a surjective
morphism JU := Jac(XU ) ։ A deﬁned over Q. Let ξU be the normalized Hodge class in XU and deﬁne

πA := lim−→U

Hom0

ξU (XU , A),

where Hom0
ξU (XU , A) denotes morphisms of Hom(XU , A) ⊗Z Q deﬁned by using the Hodge class ξU as a
base point. Since, by the universal property of Jacobians, every morphism XU → A factors through JU ,
we also have

πA := lim−→U

Hom0

ξU (JU , A),

14

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

where Hom0
ξU (JU , A) := Hom(JU , A) ⊗Z Q. For any ϕ ∈ πA and any point P ∈ XU (H), where H/Q is a
ﬁeld extension, we then see that P (ϕ) := ϕ(P ) ∈ A(H).
Let K/Q be an imaginary quadratic ﬁeld and assume there exists an embedding ψ : K ֒→ B; this
is equivalent to say that all primes dividing ∆ are inert or ramiﬁed in K. Deﬁne X K×
to be the
subscheme of X, deﬁned over Q, consisting of ﬁxed points under the canonical action by left translation
of ˆψ : ˆK × ֒→ ˆB×. The subscheme X K×
is independent up to translation of the choice of ψ. We will
often omit the reference to ψ, viewing K simply as a subﬁeld of B. Recall that the theory of complex
( ¯Q) is deﬁned over K ab, the maximal abelian extension of
multiplication shows that every point in X K×
K, and that the Galois action is given by the left translation under the reciprocity map. Fix a point
P ∈ X K×
(K ab). This amounts to choose a point PU for all open compact subgroups U , satisfying the
condition that πU1,U2(PU1 ) = PU2 .

Let dτ denote the Haar measure of Gal(K ab/K) of total mass equal to 1 and ﬁx a ﬁnite order character
χ , where Fχ = Q(χ) is the ﬁnite ﬁeld extension of Q generated by the values of χ.

χ : Gal(K ab/K) → F ×
Deﬁne

Pχ(ϕ) := ZGal(K ab/K)

ϕ(P τ ) ⊗ χ(τ )dτ.

This is an element in A(K ab) ⊗M Fχ, where M = End0
Q(A) := EndQ(A) ⊗Z Q. This element can be
essentially written as a ﬁnite sum: suppose that P = (PU )U , and each PU is deﬁned over the abelian
extension HU of K. Suppose that χ factors through Gal(HU /K) for some U . Then the Fχ-subspace of
A(HU ) ⊗ Fχ spanned by Pχ(ϕ) and

Xσ∈Gal(HU /K)

ϕ(P )σ ⊗ χ(σ)

are the same. We also note that Pχ(ϕ) belongs to (A(HU ) ⊗Z C)χ.
Let ηK be the quadratic character of the extension K/Q. Suppose that χ satisﬁes the self-duality
condition ωA · χ|A×
Q and
ωA is the central character of the automorphic representation πA. We assume for simplicity that ωA is
= 1. For any place v of Q, let ε(1/2, πA,v, χv) ∈ {±1} be the sign of the
trivial, and therefore χ|A×
functional equation with respect to its center of symmetry s = 1/2 of the local representation πA,v ⊗ χv.
Deﬁne the set

means restriction of the character (·) to the idele group A×

Q

= 1, where (·)|A×

Q

Q

Σ(A, χ) = {v place of Q : ε(1/2, πA,v, χv) 6= ηK,v(−1)} .

Proposition 4.2. The real place ∞ belongs to the set Σ(A, χ), and every ﬁnite prime p ∈ Σ(A, χ) divides
the conductor of A.
Proof. According to [CV07, Section 1], the real place ∞ belongs to the set Σ(A, χ) if χ∞ = 1 and πA,∞
is the holomorphic discrete series (of weight at least 2). The ﬁrst condition is true by our assumptions,
while the second one holds because πA is the automorphic representation attached to an abelian variety.
On the other hand, also from loc. cit. we know that if p is a ﬁnite prime in the set Σ(A, χ), then πA,p is
either special or supercuspidal, and therefore p must divide the conductor of A.
(cid:3)
Remark 4.3. If p is a ﬁnite prime belonging to Σ(A, χ), one also knows that Kp := K ⊗Q Qp is a ﬁeld. In
particular, if B is an indeﬁnite quaternion algebra whose ramiﬁcation set is supported in Σ(A, χ), then
K splits B (i.e. K embeds as a maximal subﬁeld of B).

Let ε(1/2, πA, χ) be the sign of the functional equation with respect to its center of symmetry s = 1/2

of the global representation πA ⊗ χ. Then

ε(1/2, πA, χ) = (−1)|Σ(A,χ)|.

Recall our assumption that the central character ωA of πA is trivial, and let now χ be a character of
Gal(K ab/K). Suppose that χ factors through Gal(Hc/K) where Hc is the ring class ﬁeld of conductor c;
if there is no c′ | c such that χ factors through Gal(Hc′ /K), we say that χ has conductor c; if χ factors
through Gal(Hc/K), then the conductor of χ divides c.
Suppose we have a character χ of conductor dividing the positive integer c and a Heegner point Pc of

conductor c in X(Hc). For any ϕ ∈ πA deﬁne

P χ

c,ϕ := Xσ∈Gal(Hc/K)

ϕ(P σ

c ) ⊗ χ(σ).

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

15

If |Σ(A, χ)| is odd, by [YZZ13, Theorem 1.3.1] one can choose ϕ such that
(7)
From now on, we ﬁx such a ϕ and write simply P χ

P χ
c,ϕ 6= 0 in (A(Hc) ⊗Z C)χ ⇐⇒ L′(πA, χ, 1/2) 6= 0.

c for P χ

c,ϕ.

4.2. Euler systems and BSD conjecture. Before discussing our applications to the BSD conjecture,
we recall the following result, which in this general form is due to Nekov´aˇr [Nek07].

Theorem 4.4 (Nekov´aˇr). Suppose that A/Q is a modular abelian variety of dimension d. Fix an imag-
inary quadratic ﬁeld K and an anticyclotomic character χ factoring through Hc for some integer c ≥ 1
such that the cardinality of Σ(A, χ) is odd. Let B be the indeﬁnite quaternion algebra of discriminant
equal to the product of ﬁnite primes in Σ(A, χ). Assume that A does not acquire CM over any imaginary
quadratic ﬁeld contained in Hc, and that there exists

(1) an order R of B with an uniformization JR = Jac(XR) ։ A deﬁned over Q, and
(2) a Heegner point Pc in XR(Hc).

Then the following implication holds:

L′(πA, χ, 1/2) 6= 0 =⇒ dimC (A(Hc) ⊗Z C)χ) = d.

We ﬁrst observe that if the ramiﬁcation set of the quaternion algebra B coincides with Σ(A, χ)−{∞},
then there always exists a uniformization JU = Jac(XU ) ։ A for some open compact subgroup U of ˆB×;
so in (1) we are asking that this U is associated with an order.

Theorem 4.5. Fix the following objects:

(1) a modular abelian variety A/Q of dimension d and conductor N d,
(2) an imaginary quadratic ﬁeld K and
(3) an anticyclotomic character χ factoring through the ring class ﬁeld Hc of K of conductor c ≥ 1

such that the cardinality of Σ(A, χ) is odd.

Let B denote the indeﬁnite quaternion algebra of discriminant ∆ equal to the product of all the ﬁnite
primes in Σ(A, χ). Then there exists an order R of type T = (NEic; NCar;{(Lp, νp)}p|∆) in B and a
Heegner point Pc′ ∈ XR(Hc′ ) with c | c′ such that:

(1) A is uniformized by XR, hence there is a surjective morphism JR ։ A deﬁned over Q;
(2) N divides the level NEic · N 2
(3) c divides c′.

Car ·Qp|∆ pνp of R;

Proof. The problem is local, being equivalent to the existence of optimal local embeddings for all primes
ℓ. Fix the order Rmin of type Tmin = (NEic; NCar;{(Lp, ν′
CarN∆ as in the
proof of Proposition 2.7, choosing the integers NEic and NCar such that NCar is divisible only by primes
p which are inert in K and do not divide c.

p)}p|∆) and level Nmin = NEicN 2

the required form is non-empty (cf. Lemma 3.4).

For primes p | NEicNCar which are split in K, one knows that the set of local optimal embeddings of
Fix until the end of the proof a prime p | Nmin which is inert or ramiﬁed in K. Let m be the p-adic
valuation of c and set n := valp(Nmin). If p divides NCar, then we can apply Lemma 3.6 and show that
the maximal order Rc ⊗Z Zp embeds optimally into Rmin ⊗Z Zp. So suppose from now on that p does
not divide NCar.
Suppose ﬁrst that p 6∈ Σ(A, χ). If m ≥ n/2 (unramiﬁed case) or m ≥ (n − 1)/2 (ramiﬁed case) then
Lemma 3.5 shows that the set of local optimal embeddings of Rc ⊗Z Zp into Rmin ⊗Z Zp is non-empty. If
these conditions do not hold, replacing m by m′ such that m′ ≥ n/2 (unramiﬁed case) or m′ ≥ (n − 1)/2
(ramiﬁed case) then the local order Rc′ ⊗Z Zp with c′ = c · pm′−m embeds optimally into Rmin ⊗Z Zp.

Suppose now that p ∈ Σ(A, χ). Take any pair (m′, n′) satisfying the following condition:

• If n is odd, then n′ = 2m′ + 1;
• if n is even, then n′ = 2m′ if p is inert in K whereas n′ = 2(m′ + 1) if p ramiﬁes in K.

Choose also the pair (m′, n′) so that m′ ≥ m and n′ ≥ n. Comparing with the results recalled in §3.2.3,
we see that the set of optimal embeddings of the local quadratic order of conductor pm′
into the local
quaternion order Rn′ (Lp) ⊆ Rmin ⊗Z Zp of type (Lp, n′) is non-zero.
(cid:3)
Corollary 4.6. Let A/Q, K and χ be as in the previous theorem. If A does not acquire CM over any
imaginary quadratic ﬁeld contained in Hc and L′(πA, χ, 1/2) 6= 0, then dimC (A(Hc) ⊗Z C)χ) = d.

16

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

(cid:3)

Proof. Let R and c′ be as in the statement of Theorem 4.5 and apply Theorem 4.4, viewing χ as a
character of Gal(Hc′ /K) via the canonical projection Gal(Hc′/K) → Gal(Hc/K).
4.3. Proof of Theorem A. Theorems 4.4 and 4.5, although giving an Euler System which is suﬃcient
for the proof of our main result in the introduction, are not completely satisfying in the sense that they
are not eﬀective in the computation of the order R. Suppose we are in the situation of the theorem, so
that we are given a modular abelian variety A/Q, an imaginary quadratic ﬁeld K and an anticyclotomic
character χ of conductor c such that Σ(A, χ) has odd cardinality. Then we would like to have Heegner
points in Rmin for a choice of minimal parametrization JRmin
։ A described in Proposition 2.7, or at
least of level R with R ⊆ Rmin. We begin by discussing a couple of examples.
Example 4.7. Let A = E be an elliptic curve of conductor N = p2q, with q and p odd distinct primes
both inert in K. Assume that the automorphic representation πE attached to E is supercuspidal at
p. Let B be the quaternion algebra of discriminant pq, R = Rmin be the Hijikata–Pizer–Schemanske
order R = Rmin of level N = p2q (and type (1; 1;{(Lp, 2), (Lq, 1)}), for any choice of quadratic ramiﬁed
extension Lp/Qp), and let XR be its associated Shimura curve. Note that K embeds into B because
both p and q are inert in K.

Consider ﬁrst the case of the trivial character 1. Then εp(E/K, 1) = 1p(−1) = +1 ([Del73, (5.5.1)]),
and therefore p 6∈ Σ(E, 1). So, if the sign of the functional equation of E/K is −1 then Σ(E, 1) = {∞}
(because any prime in Σ(E, 1) must divide N ). Note also that, even if f admits a JL lift to XR, there
are no Heegner points of conductor 1 in this curve (cf. §3.2.3, case (1c)).
For a non-trivial character χ of conductor p, again by case (1c) in §3.2.3, we see that in this case
Heegner points of conductor c = p do exist in XR. Therefore, if Σ(E, χ) is odd, then the set of Heegner
points of conductor c = p in XR is non-empty.

Finally, consider the case of non-trivial conductor pm with m ≥ 2. By [Tun83, p. 1299] we know
that εp(E/K, χ) = +1, and therefore, as in the case of the trivial character, if the sign of the functional
equation of E/K is −1 then Σ(E, 1) = {∞}. Also note that, again as in the case of the trivial character,
there are no Heegner points of conductor pm in XR.
Example 4.8. As in the above example, let A = E be an elliptic curve of conductor N = p2q, with q and
p odd distinct primes and suppose that q is inert and p is ramiﬁed in K. Identify the Weil–Deligne group
p via the reciprocity map rQp , normalized in such a way that rQp (a) acts on ¯Fp by the
WQp of Qp with Q×
character x 7→ x|a|, where | · | = | · |p is the p-adic absolute value satisfying |p| = p−1. Assume that the
automorphic representation πE attached to E is supercuspidal at p, and write it as πE,p = Ind
(ψ)
where F/Qp is a quadratic extension with associated character η and ψ : W ab
F → C× is a quasi-character
not factoring through the norm map; then we have ηψ = | · |−1 as quasi-characters of Q×
p . The above
conditions force ψ to have conductor equal to 1, p ≡ 3 mod 4 and ψ|Z×
= η ([Pac13, Cor. 3.1]). Consider
the quaternion algebra B of discriminant pq, the Hijikata–Pizer–Schemanske order R of level p2q as in
the previous example and its associated Shimura curve XR. Again πE admits a Jacquet–Langlands lift
to XR. Take a character χ of conductor pm, m ≥ 1. Then εp(E/K, χ) = 1 if m ≥ 4 by [Tun83, p. 1299].
If p ≡ 3 mod 4, then ηK,p(−1) = −1 and therefore p ∈ Σ(E, χ). Assuming that Σ(E, χ) is odd, we see
that q ∈ Σ(E, χ) too. However, there are no Heegner points of conductor pm with m ≥ 1 in XR.

The above examples motivate our discussion below, leading to the proof of (a slightly reﬁned version

WQp
WF

p

of) Theorem A in the Introduction.

Fix for the rest of the article an elliptic curve E/Q of conductor N , an imaginary quadratic ﬁeld K
of discriminant −D and a ring class character χ of conductor c of K. Let ∆ be the product of the ﬁnite
primes in Σ(A, χ), which is assumed to have odd cardinality, and let B be the quaternion algebra of
discriminant ∆. Fix also R := Rmin to be the minimal order of type Tmin = (NEic; NCar;{(Lp, νp)}p|∆)
as in Proposition 2.7, on which the Jacquet–Langlands lift to B of the newform f ∈ S2(Γ0(N )) associated
with E is realized, and let NR = NEicN 2
CarN∆ be its level. We can further assume the (coprime) integers
NEic and NCar satisfy that, for every prime p dividing NEicNCar,

p | NCar if and only if p is inert in K, valp(N ) is even and p ∤ c.

From now on, we shall make the following assumption on N . Observe that under the hypothesis that
neither 23 nor 34 divide N , as in the statement of Theorem A, the assumption below is obviously satisﬁed.
Assumption 4.9. Let f ∈ S2(Γ0(N )) be the newform attached to the elliptic curve E by modularity.
With the above notations, the following holds:

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

17

(1) If 23 | NEic, then either 2 splits in K or val2(NEic) is odd and 2 is inert in K.
(2) If ∆ is even and 23 | N , then 2 is inert in K, and if in addition πE is supercuspidal at 2 then
(3) The 2-component πf,2 of the automorphic representation attached to f has minimal Artin con-

val2(N ) is odd.

ductor among its twists by quasi-characters of Q×
2 .

(4) If val3(NEic) = 4 and 3 is inert in K, then val3(c) 6= 1.

Remark 4.10. If f ∈ S2(Γ0(N )) and val2(N ) is even and greater or equal than 4, then f is a twist of a
modular form of lower level by [HPS89b, Thm. 3.9]. Conditions (1) and (2) in the above assumption
rule out these cases; in fact, one expects to treat these cases via diﬀerent methods. If f = g ⊗ χ, then
one expects to construct points on the modular abelian varieties attached to g, and then, using twisting
techniques, to construct points on the elliptic curve. It seems possible that condition (3) can be treated
by similar considerations.

Write also Rc for the order of conductor c in K of conductor c as usual. Our goal now is to investigate
under which conditions Rc embeds optimally into Rmin. And in those cases where this does not happen,
we must ﬁnd a suitable suborder of Rmin such that Rc does optimally embed into it.
The problem is clearly local, and it suﬃces to study it at those primes dividing N . So ﬁx from now
on a prime p | N , and set the following notations. We write m := valp(c) for the p-adic valuation of c,
and n := valp(NR) for that of NR. By the discussion prior to Proposition 2.7, observe that n coincides
with valp(N ) if p is odd (cf. also Remark 2.8). And if p = 2, under Assumption 4.9 the only cases with
n 6= val2(N ), and for which this unequality is relevant in our discussion, are those in Lemma 4.14 below.
In view of this, except for Lemma 4.14 we may use that n = valp(N ) without further explicit mention.
Then we denote by Ep(m, n) the set of (local) optimal embeddings of Rc ⊗Z Zp into R⊗Z Zp. Recall that
the conditions that characterize the non-emptiness of Ep(m, n), in each of the possible cases, have been
collected in Section 3.2. If p is not split in K, then we write χp for the component of χ at the unique
prime of K above p. In that case, notice that m = c(χp), the (exponent of the) conductor of χp.

If the prime p divides NEic∆ and n′ ≥ n is an integer, then we deﬁne a suborder R′ of R in the
following way. If p | NEic, then we deﬁne R′ to be locally equal to R at every prime distinct from p, and
such that R′ ⊗Z Zp is the Eichler suborder of level pn′
(hence index pn′−n) in R ⊗Z Zp. In particular,
valp(NR′) = n′. And if p | ∆, then R′ is obtained from R by replacing the local data (Lp, n) at p in
the type of R by the data (Lp, n′). Besides, given an integer m′ ≥ m, we denote by Rc′ the suborder of
Rc of conductor c′ = cpm′−m. Finally, given two integers m′ ≥ m and n′ ≥ n, we will simply denote by
Ep(m′, n′) the set of (local) optimal embeddings of Rc′ ⊗Z Zp into R′ ⊗Z Zp.

First we consider the case where p does not belong to the set Σ(E, χ), so that B is split at p.

Lemma 4.11. If p 6∈ Σ(E, χ), then Ep(m, n) 6= ∅.
Proof. First observe that if p 6∈ Σ(E, χ) then p divides NEicNCar. Having said this, notice that if p | NCar
then Ep(m, n) is non-empty by Lemma 3.6 (because if p | NCar then m = 0). So we assume for the rest
of the proof that p divides NEic. By our choice of NEic and N 2

Car, we shall distinguish three cases:

(1) p is split in K;
(2) p is inert or ramiﬁed in K and n is odd;
(3) p is inert or ramiﬁed in K, n is even and p | c.
If p is in case (1), then Lemma 3.4 implies that Ep(m, n) is non-empty. Suppose that p is in case
(2), and assume ﬁrst that n = 1, which is the only possible value if p ≥ 5.
If p ramiﬁes in K, then
Ep(m, n) 6= ∅ by part (ii) in Lemma 3.5. If p is inert in K, then we split the discussion according to
whether p ∤ c or p | c. In the former case, εp(E/K, χ) = εp(E/K, 1) = −1 but ηK,p(−1) = 1, thus p
should be in Σ(E, χ), contradicting our hypotheses. And in the latter case, we have m ≥ 1 and therefore
2m ≥ n = 1, hence Lemma 3.5 shows that Ep(m, n) 6= ∅. Thus we are left with the cases where p = 2 or
3 and n = valp(N ) > 1 is odd.

• If p = 3, then n can be either 3 or 5. Then πE,3 is supercuspidal induced from a quasicharacter
ψ of conductor n − 1 of a ramiﬁed quadratic extension F3 of Q3. If 3 is inert in K, we know
on the one hand by Lemma 3.5 that E3(m, n) 6= ∅ if and only if m ≥ n/2, hence if and only if
m > (n − 1)/2. On the other hand, being 3 inert in K the assumption that 3 6∈ Σ(E, χ) tells us
that ε3(E/K, χ) = 1, and by [Tun83, Prop. 2.8] this holds if and only if m > (n− 1)/2 = 1. Thus
it follows that E3(m, n) 6= ∅. Now suppose that 3 ramiﬁes in K. Then ηK,3(−1) = −1, hence

18

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

ε3(E/K, χ) = −1 because 3 6∈ Σ(E, χ). By Lemma 3.5 we have that E3(m, n) 6= ∅ if and only if
m ≥ (n − 1)/2. We next show that ε3(E/K, χ) = −1 implies that m ≥ (n − 1)/2. If F3 6= K3,
[Tun83, Cor. 1.9.1] implies that ε3(E/K, χ) = (−1)c(ψχ3). If it were m = c(χ3) < c(ψ) = n−1, we
would have c(ψχ3) = c(ψ) = n−1. Since n is 3 or 5, in both cases we would have ε3(E/K, χ) = 1,
thus it must be m > n − 1 > (n − 1)/2, and therefore E3(m, n) 6= ∅. If in contrast F3 = K3,
we can apply [Tun83, Prop. 1.10] instead, which tells us that ε3(E/K, χ) = (−1)c(ψτ χ3)+c(ψχ3),
where τ is the non-trivial automorphism in Gal(K3/Q3). Similarly as before, observe now that if
c(ψ) 6= c(χ3), then c(ψτ χ3) = c(ψχ3) = max(c(ψ), c(χ3)), and as a consequence ε3(E/K, χ) = 1.
Thus it must be m = c(χ3) = c(ψ) = n − 1 > (n − 1)/2, and we conclude that E3(m, n) 6= ∅.
• If p = 2, then n can be either 3, 5 or 7. And by Assumption 4.9 i), we may suppose that 2 is
inert in K, so that 2 6∈ Σ(E, χ) implies that ε2(E/K, χ) = 1.
Suppose ﬁrst that n = 3. Then [Tun83, Prop. 3.7] implies that m ≥ 2, and then by part (i) of
Lemma 3.5 we deduce that E2(m, n) 6= ∅.
Suppose now that n = 5. Now πE,2 is supercuspidal induced from a quasicharacter of conductor
3 on a ramiﬁed extension of Q2 with discriminant valuation 2. If the conductor of χ were m < 3,
then [Tun83, Cor. 1.9.1] would imply that ε2(E/K, χ) = −1, thus we deduce that m ≥ 3. And
then by part (i) of Lemma 3.5 we conclude that E2(m, n) 6= ∅.
If n = 7, then πE,2 is supercuspidal of exceptional type, and its conductor is minimal with
respect to twist. Then ε2(E/K, χ) = 1 implies, by [Tun83, Lemma 3.2], that m ≥ 4. But then we
deduce that E2(m, n) 6= ∅ thanks to Lemma 3.5, part (i) (here, and here only, we use condition
iii) in Assumption 4.9).

Finally, suppose that p is in case (3). Again let us start with the case n = 2, which is the only possible
case if p ≥ 5. Since m = valp(c) ≥ 1, we see that 2m ≥ n, hence Lemma 3.5 implies that Ep(m, n) 6= ∅,
regardless p is inert or ramiﬁed in K. Thus we are again left with the cases where p = 2 or 3 and
n = valp(N ) > 2 is even.

By Assumption 4.9 i), the case p = 2 does not arise, so we assume that p = 3. Then the only possible
In this case πE,3 is supercuspidal induced from a quasicharacter of conductor 2 of
value for n is 4.
If 3 is ramiﬁed in K, then ηK,3(−1) = −1, and therefore
the unramiﬁed quadratic extension of Q3.
ε3(E/K, χ) = −1. By [Tun83, Cor. 1.9.1], if m = 1 then we would have ε3(E/K, χ) = 1, hence we see
that m ≥ 2. On the other hand, part (ii) in Lemma 3.5 tells us that E3(m, n) 6= ∅ if and only if m ≥ 2.
Thus we deduce that indeed E3(m, n) 6= ∅.
If in contrast 3 is inert, then Assumption 4.9 iii) implies that m ≥ 2, and by part (i) in Lemma 3.5 we
conclude that E3(m, n) 6= ∅.

(cid:3)

Next we will deal with the case that p ∈ Σ(E, χ), or equivalently p | ∆. This means that εp(E/K, χ) =

−ηK,p(−1). So if p is odd, then

εp(E/K, χ) = 


−1
−1
1

if p is inert in K,
if p is ramiﬁed in K and p ≡ 1 mod 4,
if p is ramiﬁed in K and p ≡ 3 mod 4.

Let πE be the automorphic representation attached to E, and πE,p be its p-th component. The

(exponent of the) conductor of πE,p is valp(N ).

We will split our discussion into distinct lemmas, to distinguish between the cases where πE,p is
supercuspidal or Steinberg. If πE,p is supercuspidal, then it is well-known that valp(N ) ≥ 2. For p ≥ 5
this means that valp(N ) = 2, whereas for p = 3 (resp. p = 2) we have 2 ≤ val3(N ) ≤ 5 (resp.
2 ≤ val2(N ) ≤ 8). Besides, if πE,p is Steinberg, then valp(N ) can only be 1 or 2 if p is odd, whereas
if p = 2 then val2(N ) ∈ {1, 4, 6}. However, the reader should keep in mind that under Assumption 4.9,
some of the previous cases with p = 2 do not appear in our discussion.
Lemma 4.12. If p ∈ Σ(E, χ), πE is supercuspidal at p and p is inert in K then there exists n′ ≥ n such
that Ep(m, n′) 6= ∅.
Proof. The assumptions p ∈ Σ(E, χ) and p inert in K imply that εp(E/K, χ) = −1. Suppose ﬁrst that
p is odd. We have the following cases:

(1) n = 2. If m = 0, then εp(E/K, χ) = 1 by [Del73, (5.5.1)], so we may assume that m ≥ 1. But

then deﬁning n′ := 2m ≥ n we conclude by case (1c) in §3.2.3 that Ep(m, n′) 6= ∅.

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

19

(2) p = 3 and n > 2. In this case n = val3(N ) can be either 3, 4 or 5. If n 6= 4, then πE,p is induced
from a quasicharacter ψ of conductor n − 1 of a ramiﬁed quadratic extension of Q3. On the one
hand, from §3.2.3 case (1a) we see that E3(m, n) 6= ∅ if and only if m ≤ (n − 1)/2. And on the
other hand, by [Tun83, Prop. 2.8] one has that ε3(E/K, χ) = −1 if and only if m ≤ (n − 1)/2.
Thus we conclude that E3(m, n) 6= ∅.
Suppose now that n = 4. In this case, πE,3 is induced from a quasicharacter ψ of conductor
2 of the unramiﬁed quadratic extension of Q3.
If χp is unramiﬁed, that is m = 0, then by
[Del73, (5.5.1)] we would have εp(E/K, χ) = 1, hence it must be m ≥ 1. However, if m = 1
then one can use [Tun83, Prop. 1.10] (cf. also the proof of Proposition 3.5 in loc. cit.) to show
that ε3(E/K, χ) = 1, thus it follows that m ≥ 2. But then for n′ := 2m ≥ n we have that
E3(m, n′) 6= ∅ by case (1c) in §3.2.3.

Now we assume that p = 2. Again we can split the discussion into cases.

i) First suppose n = valp(N ) = 2. As above, if m = 0 then εp(E/K, χ) = 1, hence it must be

m ≥ 1. Letting n′ := 2m ≥ n, case (2b) now ensures that Ep(m, n′) 6= ∅.
ii) If valp(N ) > 2, then Assumption 4.9 ii) implies that n is odd. If n = 3, on the one hand by
[Tun83, Prop. 3.7] we have that ε2(E/K, χ) = −1 if and only if m ≤ 1. And on the other
hand, case (2f) in §3.2.3 tells us that E2(m, n) 6= ∅ if and only if m ≤ 1, thus we conclude that
E2(m, n) 6= ∅. If n is either 5 or 7, again according to §3.2.3 case (2f) we see that if m ≤ (n− 1)/2
then E2(m, n) 6= ∅. If not, deﬁning n′ := 2m + 1 we will have E2(m, n′) 6= ∅.

This concludes the proof.
Lemma 4.13. If p ∈ Σ(E, χ), πE is supercuspidal at p and p is ramiﬁed in K then there exists n′ ≥ n
such that Ep(m, n′) 6= ∅.
Proof. As in the previous lemma, we assume ﬁrst that p is odd. We have the following cases:

(cid:3)

(1) Suppose n = valp(N ) = 2. If m = 0, we deduce from §3.2.3 (cases (1d) or (1e)) that Ep(m, n) 6= ∅.
In contrast, if m > 0 the set Ep(m, n) is empty. But by virtue of §3.2.3, case (1d) or (1e), for
n′ := 2(m + 1) > n we have Ep(m, n′) 6= ∅.
(2) Suppose that p = 3 and n = val3(N ) ≥ 3. In this case, 3 ≤ n ≤ 5. Assume ﬁrst that n = 4. In
this case, the quadratic extension L3/Q3 is ramiﬁed. Up to replacing L3 by the other quadratic
ramiﬁed extension, we might assume that K3 6≃ L3. Then from case (1e) in §3.2.3 we see that
Ep(m, n) 6= ∅ if and only if m ≤ 1. If m > 1, then we take n′ := 2(m + 1), and again case (1e) in
§3.2.3 tells us that Ep(m, n′) 6= ∅.
Suppose now that n is either 3 or 5. Then case (1b) in §3.2.3 shows that Ep(m, n) 6= ∅ if and
only if m = (n − 1)/2. Provided that m ≥ (n − 1)/2, deﬁning n′ := 2m + 1 ≥ n we obtain
Ep(m, n′) 6= ∅ as we want. Thus we need to prove that m ≥ (n − 1)/2. Since 3 is ramiﬁed,
we have ηK,3(−1) = −1, and therefore the hypothesis that 3 belongs to Σ(E, χ) implies that
ε3(E/K, χ) = 1. Besides, we know that πE,3 is induced from a quasicharacter of conductor n− 1
of a ramiﬁed quadratic extension of Q3. By [Tun83, Prop. 2.8], ε3(E/K, χ) = 1 then implies that
m ≥ (n − 1)/2 as we wanted.

Now we deal with the case p = 2. By Assumption 4.9, if it were val2(N ) > 2 then 2 should be inert in
K, thus we only need to consider the case n = val2(N ) = 2. By cases (2c), (2d) or (2e) in §3.2.3 we have
that Ep(m, n) 6= ∅ if and only if m = 0. Notice ﬁrst that πE,p is of minimal conductor among its twists,
since supercuspidal representations have conductor ≥ 2. Then, by virtue of [Tun83, Proposition 3.5], we
see that εp(E/K, χ) is +1 (resp. −1) if and only if m ≥ 2 (resp. m < 2). In view of this, if ηK,2(−1) = 1,
the hypothesis that 2 ∈ Σ(E, χ) implies that m < 2. Since m cannot be 1, we deduce that m = 0, and
hence Ep(m, n) 6= ∅ as desired. In contrast, assume that ηK,2(−1) = −1. Then it follows that m ≥ 2. By
deﬁning n′ := 2(m + 1) ≥ n, we see by §3.2.3 (case (2c), (2d) or (2e)) that Ep(m, n′) 6= ∅.

(cid:3)

Next we consider the Steinberg case. Write πE,p = Sp2 ⊗ ψ where ψ : W ab

character. By [Tun83, Prop. 1.7], we know that ε(E, χ) = −1 if and only if χ−1
x 7→ Nr(x) is the norm map from Kp = K ⊗Q Qp to Qp.
Lemma 4.14. If p ∈ Σ(E, χ), πE is Steinberg at p and p is inert in K then there exists n′ ≥ n such that
Ep(m, n′) 6= ∅.
Proof. By the above discussion, p ∈ Σ(E, χ) if and only if χ−1
so that n = valp(N ) can be either 1 or 2. We split the discussion into subcases:

p = ψ ◦ Nr. We assume ﬁrst that p is odd,

Qp → C× is a quadratic
p = ψ ◦ Nr, where

20

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

(1) n = 1. Comparing with §3.2.3 (1a), we see that Ep(m, n) 6= ∅ if and only if m = 0. On the other
(2) n = 2. Looking now at §3.2.3 (1c), Ep(m, n) 6= ∅ if and only if m = 1. On the other hand, ψ is

hand, ψ is unramiﬁed and therefore if p ∈ Σ(E, χ) then m = 0.
ramiﬁed with conductor equal to 1, and therefore if p ∈ Σ(E, χ) then m = 1.

Assume now that p = 2. Then val2(N ) ∈ {1, 4, 6}.

ii) If val2(N ) = 4, then ψ is ramiﬁed with conductor 2. Since χ−1

i) If n = val2(N ) = 1, the character ψ is unramiﬁed, and then since 2 ∈ Σ(E, χ) we deduce that
m = 0. On the other hand, by case (2a) in §3.2.3 we also have Ep(m, n) 6= ∅ if and only if m = 0.
Thus Ep(m, n) 6= ∅ as we want.
p = ψ ◦ Nr, it follows that also
m = 2. By the discussion before Proposition 2.7, n = val2(NR) can be either 1, 2 or 3. If n is
either 1 or 3, deﬁning n′ := 5 ≥ n we see by case (2f) in §3.2.3 that E2(m, n′) 6= ∅. And if n = 2,
by case (2b) in §3.2.3 we conclude that for n′ := 2m = 4 ≥ n we have E2(m, n′) 6= ∅.
iii) If val2(N ) = 6, then ψ is ramiﬁed with conductor 3. Similarly as before, we deduce that χp has
also conductor m = 3. From the discussion before Proposition 2.7, we know that the possible
values for n = val2(NR) are 1, 2, 3, 4 or 5. When n is either 1, 3 or 5, L2 is the unramiﬁed
quadratic extension of Q2, and deﬁning n′ := 2m + 1 = 7 ≥ n, case (2f) in §3.2.3 implies that
E2(m, n′) 6= ∅. Finally, if n = 2 or n = 4, then we may deﬁne n′ := 2m = 6 ≥ n and now case
(2b) shows that E2(m, n′) 6= ∅.

This concludes the proof.
Lemma 4.15. If p ∈ Σ(E, χ), πE is Steinberg at p and p is ramiﬁed in K then there exists n′ ≥ n such
that Ep(m, n′) 6= ∅.
Proof. Suppose ﬁrst that p is odd, so that n = valp(N ) is either 1 or 2. By the above discussion,
p ∈ Σ(E, χ) if and only if either χ−1
6= ψ ◦ Nr and p ≡ 3 mod 4. We
have the following cases:

p = ψ ◦ Nr and p ≡ 1 mod 4, or χ−1

(cid:3)

p

(1) n = 1.

(2) n = 2. Again, for m = 0 we have Ep(m, n) 6= ∅ by case (1d) or (1e) in §3.2.3.

If m = 0, by case (1b) in §3.2.3 we see that Ep(m, n) 6= ∅. Otherwise, we can take
n′ := 2m + 1, and again case (1b) in §3.2.3 implies Ep(m, n′) 6= ∅.
If instead
m > 0, then we consider n′ := 2(m + 1) and by applying §3.2.3, case (1d) or (1e), we see that
Ep(m, n′) 6= ∅.
Now assume that p = 2. Similarly as in the previous lemma, by Assumption 4.9 we only need to deal
with the case n = val2(N ) = 1. Then notice that ψ is unramiﬁed. On the other hand, now the hypothesis
that 2 belongs to Σ(E, χ) implies that either ηK,2(−1) = 1 and χ−1
p = ψ ◦ Nr or ηK,2(−1) = −1 and
χ−1
p = ψ ◦ Nr implies that
m = 0. By case (2a) in §3.2.3 it thus follows that Ep(m, n) 6= ∅. And if ηK,2(−1) = −1, it could be
the case that m > 0. But in any case, deﬁning n′ := 2m + 1 ≥ n = 1 case (2g) in §3.2.3 implies that
Ep(m, n′) 6= ∅.

6= ψ ◦ Nr. Having this into account, if ηK,2(−1) = 1 then the equality χ−1

(cid:3)

p

Combining the above lemmas, we obtain the following:

Theorem 4.16. Let E/Q be an elliptic curve of conductor N , K be an imaginary quadratic ﬁeld and χ
be an anticyclotomic character of conductor c. Suppose that the set Σ(E, χ) has odd cardinality, so that
ε(E/K, χ) = −1 and hence L(E/K, χ, 1) = 0. If Assumption 4.9 holds, then the set of Heegner points in
E(Hc) is non-empty. And if further E does not acquire CM over any imaginary quadratic ﬁeld contained
in Hc and L′(E/K, χ, 1) 6= 0, then dimC (E(Hc) ⊗ CZ)χ = 1.
Proof. Let B be the indeﬁnite quaternion algebra ramiﬁed exactly at the ﬁnite primes in Σ(E, χ), and let
Rmin be the order in B from Proposition 2.7. The above lemmas together imply that there is a suborder
R of Rmin such that the set of Heegner points of conductor c in XR(Hc) is non-empty. The Jacobian
of XR uniformizes E as well, hence the set of Heegner points of conductor c in E(Hc) is non-empty.
By Theorem 4.4, if E does not acquire CM over any imaginary quadratic ﬁeld contained in Hc, then
dimC (E(Hc) ⊗ CZ)χ = 1.
(cid:3)

We state now the above result in more restrictive, but maybe more attractive form, introducing a

couple of deﬁnitions.
Deﬁnition 4.17. We say that a form f ∈ S2(Γ0(N )) is primitive if f 6= g ⊗ χ for any Dirichlet character
χ and any g ∈ S2(Γ0(M )) with M | N and M 6= N (see [Piz80, Def. 8.6 ] for a similar terminology).

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

21

Deﬁnition 4.18. Let p be a prime. We say that f ∈ S2(Γ0(N )) has p-minimal Artin conductor if the
p-component πf,p of the automorphic representation πf attached to f has minimal conductor among
its twists by quasi-characters of Q×
p ; in other words, if we write a(πf ) for the Artin conductor of the
automorphic representation πf , we require that a(πf ) ≤ a(πf ⊗ χ) for all quasi-characters χ of Q×
p .
Corollary 4.19. Let E/Q be an elliptic curve of conductor N , K be an imaginary quadratic ﬁeld and χ
be an anticyclotomic character of conductor c. Suppose that the set Σ(E, χ) has odd cardinality. If the
following conditions hold:

(1) f is a primitive form;
(2) f has 2-minimal Artin conductor;
(3) If val3(NEic) = 4 and 3 is inert in K, then val3(c) 6= 1;
(4) If val2(NEic) ≥ 3, then 2 is not ramiﬁed in K;

then the set of Heegner points in E(Hc) is non-empty.
imaginary quadratic ﬁeld contained in Hc and L′(E/K, χ, 1) 6= 0, then dimC (E(Hc) ⊗ CZ)χ = 1.
Proof. We only need to remark that conditions i) and ii) in Assumption 4.9 are satisﬁed if we ask that f
is primitive by [HPS89b, Thm. 3.9].
(cid:3)

If further E does not acquire CM over any

4.4. Final remarks. It might be interesting to discuss how to extend the above theorem to the general
case of abelian varieties. One can easily show that if A/Q is a modular variety of dimension d and
conductor N d, and no prime divides N to a power greater than 3, then the argument for elliptic curves
developed in the previous section also works for abelian varieties. However, it is easy to construct
examples in which we do not have Heegner points in any cover of XRmin if we allow the conductor of A
to be divisible by arbitrary powers of p if we just consider orders of type (NEic; NCar;{(Lp, νp)}), as the
following examples show:

Example 4.20. Let A/Q be a modular abelian variety of conductor N d, and suppose N = pnq with p and
q distinct odd primes and n = 2̺ + 1 an odd integer. Let χ be a character of conductor pm with m ≥ 1.
Suppose that p is ramiﬁed in and q is inert in K. Then q ∈ Σ(A, χ), and p ∈ Σ(A, χ) if and only if

εp(A, χ) = −ηK,p(−1) = −(−1)(p−1)/2.

Now assume that n is minimal among the conductor of all twists of πA,p. In this case [Tun83, Prop. 3.2]
shows that if m ≤ n − 1 then εp(A, χ) = −1, so if p ≡ 3 mod 4 then p ∈ Σ(A, χ). If now m < (n − 1)/2,
then comparing with §3.2.3 we see that there are no Heegner points of conductor pm in any cover of
XRmin associated with an order as in Deﬁnition 1.3.

Example 4.21. As in the above example, let A/Q be a modular abelian variety of conductor N d, and
suppose now that N = pnq with p and q two odd primes and n = 2̺ ≥ 4 an even integer. Let χ be
a character of conductor pm with m ≥ 1. Suppose ﬁrst that p ∈ Σ(A, χ), so εp(A, χ) = −1, and q is
inert in K, so q ∈ Σ(A, χ). Consider the quaternion algebra B of discriminant pq and the order Rmin of
B and form the corresponding Shimura curve XRmin. From §3.2.3, we see that if m < n/2, then there
are no Heegner points of conductor pm in any covering of XRmin associated with special orders as in
Deﬁnition 1.3. Secondly, suppose p 6∈ Σ(A, χ), so εp(A, χ) = +1 and q is split in K, so q 6∈ Σ(A, χ). In
this case, if m < n/2 then again there are no Heegner points of conductor pm in any cover of the Shimura
curve XRmin associated with Eichler orders (which, in this case, correspond to modular curves and usual
congruence subgroups).

As we may see from the above examples, it seems to us that that one should introduce more general

type of orders to ﬁnd other sources of Heegner points deﬁned over the predicted ring class ﬁeld.

Conjecture 4.22. Let A/Q be a modular abelian variety, K be an imaginary quadratic ﬁeld, χ be an
anticyclotomic character factoring through the ring class ﬁeld Hc of K of conductor c ≥ 1, and suppose
that the cardinality of Σ(A, χ) is odd. Let B denote the indeﬁnite quaternion algebra of discriminant ∆
equal to the product of the ﬁnite primes in Σ(A, χ), and f be the newform associated with A. Suppose
that f is primitive and has p-minimal Artin conductor, for all primes p. Then, there exists an open
compact subgroup U in ˆB× equipped with a surjective morphism JU ։ A and such that the set of
Heegner points in XU (Hc) is non-empty.

As a variant of the above conjecture, one can ask if we can take U = ˆR× for some global order R in B.
This conjecture is inspired by Corollary 4.19; we only point out that the relevant part in this conjecture

22

MATTEO LONGO, VICTOR ROTGER, AND CARLOS DE VERA-PIQUERO

is to show the existence of suitable open compact subgroups (non necessarily arising from global orders)
so that we have a good understanding of rationality questions of points arising from embeddings K ֒→ B.
This would allow us to solve cases as (Missing Cases) in the introduction and discuss Examples 4.20 and
4.21 above.

References

[BD96]

[BCDT01] Christophe Breuil, Brian Conrad, Fred Diamond, and Richard Taylor, On the modularity of elliptic curves over
Q: wild 3-adic exercises, J. Amer. Math. Soc. 14 (2001), no. 4, 843–939 (electronic). MR 1839918 (2002d:11058)
M. Bertolini and H. Darmon, Heegner points on Mumford-Tate curves, Invent. Math. 126 (1996), no. 3, 413–456.
MR 1419003 (97k:11100)
Massimo Bertolini and Henri Darmon, Heegner points, p-adic L-functions, and the Cerednik-Drinfeld uni-
formization, Invent. Math. 131 (1998), no. 3, 453–491. MR 1614543

[BD98]

[BD99]

[BD07]

[BD09]

, p-adic periods, p-adic L-functions, and the p-adic uniformization of Shimura curves, Duke Math. J.

98 (1999), no. 2, 305–334. MR 1695201

, Hida families and rational points on elliptic curves, Invent. Math. 168 (2007), no. 2, 371–431.

MR 2289868

, The rationality of Stark-Heegner points over genus ﬁelds of real quadratic ﬁelds, Ann. of Math. (2) 170

(2009), no. 1, 343–370. MR 2521118

[BDD07] Massimo Bertolini, Henri Darmon, and Samit Dasgupta, Stark-Heegner points and special values of L-series,
L-functions and Galois representations, London Math. Soc. Lecture Note Ser., vol. 320, Cambridge Univ. Press,
Cambridge, 2007, pp. 1–23. MR 2392351

[BLR91] Nigel Boston, Hendrik W. Lenstra, Jr., and Kenneth A. Ribet, Quotients of group rings arising from two-
dimensional representations, C. R. Acad. Sci. Paris S´er. I Math. 312 (1991), no. 4, 323–328. MR 1094193
(92c:11057)
J. Brzezinski, A combinatorial class number formula, J. Reine Angew. Math. 402 (1989), 199–210. MR 1022800
(90j:11127)

[Brz89]

[Brz91]

, On embedding numbers into quaternion orders, Comment. Math. Helv. 66 (1991), no. 2, 302–318.

[Car84]

[CCL16]

[Che98]

[CV07]

[Dar01]

[Das05]

[Del71]

[Del73]

[Gel75]

points

on modular

curve,

p

(2016),

preprint

and Yu Liu, Heegner

MR 1107843 (92e:11133)
H. Carayol, Repr´esentations cuspidales du groupe lin´eaire, Ann. Sci. ´Ecole Norm. Sup. (4) 17 (1984), no. 2,
191–225. MR 760676 (86f:22019)
Li Cai, Yihua Chen,
http://arxiv.org/abs/1601.04415.
Imin Chen, The Jacobians of non-split Cartan modular curves, Proc. London Math. Soc. (3) 77 (1998), no. 1,
1–38. MR 1625491 (99m:11068)
Christophe Cornut and Vinayak Vatsal, Nontriviality of Rankin-Selberg L-functions and CM points, L-functions
and Galois representations, London Math. Soc. Lecture Note Ser., vol. 320, Cambridge Univ. Press, Cambridge,
2007, pp. 121–186. MR 2392354 (2009m:11088)
Henri Darmon, Integration on H
589–639. MR 1884617
Samit Dasgupta, Stark-Heegner points on modular Jacobians, Ann. Sci. ´Ecole Norm. Sup. (4) 38 (2005), no. 3,
427–469. MR 2166341
Pierre Deligne, Travaux de Shimura, S´eminaire Bourbaki, 23`eme ann´ee (1970/71), Exp. No. 389, Springer,
Berlin, 1971, pp. 123–165. Lecture Notes in Math., Vol. 244. MR 0498581 (58 #16675)
P. Deligne, Les constantes des ´equations fonctionnelles des fonctions L, Modular functions of one variable, II
(Proc. Internat. Summer School, Univ. Antwerp, Antwerp, 1972), Springer, Berlin, 1973, pp. 501–597. Lecture
Notes in Math., Vol. 349. MR 0349635 (50 #2128)
Stephen S. Gelbart, Automorphic forms on ad`ele groups, Princeton University Press, Princeton, N.J.; University
of Tokyo Press, Tokyo, 1975, Annals of Mathematics Studies, No. 83. MR 0379375 (52 #280)

× H and arithmetic applications, Ann. of Math. (2) 154 (2001), no. 3,

[Gre09] Matthew Greenberg, Stark-Heegner points and the cohomology of quaternionic Shimura varieties, Duke Math.

[Hid81]

[Hij74]

J. 147 (2009), no. 3, 541–575. MR 2510743
Haruzo Hida, On abelian varieties with complex multiplication as factors of the Jacobians of Shimura curves,
Amer. J. Math. 103 (1981), no. 4, 727–776. MR 623136 (82k:10029)
Hiroaki Hijikata, Explicit formula of the traces of Hecke operators for Γ0(N ), J. Math. Soc. Japan 26 (1974),
56–82. MR 0337783 (49 #2552)

[HPS89a] H. Hijikata, A. Pizer, and T. Shemanske, Orders in quaternion algebras, J. Reine Angew. Math. 394 (1989),

59–106. MR 977435 (90d:11128)

[HPS89b] Hiroaki Hijikata, Arnold K. Pizer, and Thomas R. Shemanske, The basis problem for modular forms on Γ0(N ),

[Kol88]

Mem. Amer. Math. Soc. 82 (1989), no. 418, vi+159. MR 960090 (90d:11056)
V. A. Kolyvagin, The Mordell-Weil and Shafarevich-Tate groups for Weil elliptic curves, Izv. Akad. Nauk SSSR
Ser. Mat. 52 (1988), no. 6, 1154–1180, 1327. MR 984214 (90f:11035)

[KP16a] Daniel Kohen and Ariel Pacetti, Heegner points on cartan non-split curves, Canadian Journal of Mathematics,

to apper (2016), http://arxiv.org/pdf/1403.7801.pdf.

[KP16b]

, On heegner points for primes of additive reduction ramifying in the base ﬁeld, preprint (2016),

http://arxiv.org/pdf/1505.08059.pdf.

[LRV12] Matteo Longo, Victor Rotger, and Stefano Vigni, On rigid analytic uniformizations of Jacobians of Shimura

curves, Amer. J. Math. 134 (2012), no. 5, 1197–1246. MR 2975234

HEEGNER POINTS ON HIJIKATA–PIZER–SHEMANSKE CURVES

23

[LRV13]

, Special values of L-functions and the arithmetic of Darmon points, J. Reine Angew. Math. 684 (2013),

[LV14]

[Mil90]

[Mil92]

[Nek]

[Nek07]

[Pac13]

[Piz76]

[Piz80]

[Tei90]

[Tun83]

[TW95]

[Vig80]

[Wil95]

199–244. MR 3181561
Matteo Longo and Stefano Vigni, The rationality of quaternionic Darmon points over genus ﬁelds of real
quadratic ﬁelds, Int. Math. Res. Not. IMRN (2014), no. 13, 3632–3691. MR 3229764
J. S. Milne, Canonical models of (mixed) Shimura varieties and automorphic vector bundles, Automorphic
forms, Shimura varieties, and L-functions, Vol. I (Ann Arbor, MI, 1988), Perspect. Math., vol. 10, Academic
Press, Boston, MA, 1990, pp. 283–414. MR 1044823 (91a:11027)
James S. Milne, The points on a Shimura variety modulo a prime of good reduction, The zeta functions of Picard
modular surfaces, Univ. Montr´eal, Montreal, QC, 1992, pp. 151–253. MR 1155229 (94g:11041)
Jan Nekov´aˇr, Generalised Eichler-Shimura relations and semi-simplicity of ´etale cohomology of quaternionic
Shimura varieties.

, The Euler system method for CM points on Shimura curves, L-functions and Galois representa-
tions, London Math. Soc. Lecture Note Ser., vol. 320, Cambridge Univ. Press, Cambridge, 2007, pp. 471–547.
MR 2392363 (2010a:11110)
Ariel Pacetti, On the change of root numbers under twisting and applications, Proc. Amer. Math. Soc. 141
(2013), no. 8, 2615–2628. MR 3056552
Arnold Pizer, On the arithmetic of quaternion algebras. II, J. Math. Soc. Japan 28 (1976), no. 4, 676–688.
MR 0432600 (55 #5587)

, Theta series and modular forms of level p2M , Compositio Math. 40 (1980), no. 2, 177–241. MR 563541

(81k:10040)
Jeremy Teitelbaum, Geometry of an ´etale covering of the p-adic upper half plane, Ann. Inst. Fourier (Grenoble)
40 (1990), no. 1, 68–78. MR 1056774
Jerrold B. Tunnell, Local ǫ-factors and characters of GL(2), Amer. J. Math. 105 (1983), no. 6, 1277–1307.
MR 721997 (86a:22018)
Richard Taylor and Andrew Wiles, Ring-theoretic properties of certain Hecke algebras, Ann. of Math. (2) 141
(1995), no. 3, 553–572. MR 1333036 (96d:11072)
Marie-France Vign´eras, Arithm´etique des alg`ebres de quaternions, Lecture Notes in Mathematics, vol. 800,
Springer, Berlin, 1980. MR 580949 (82i:12016)
Andrew Wiles, Modular elliptic curves and Fermat’s last theorem, Ann. of Math. (2) 141 (1995), no. 3, 443–551.
MR 1333035 (96d:11071)

[YZZ13] Xinyi Yuan, Shou-Wu Zhang, and Wei Zhang, The Gross-Zagier formula on Shimura curves, Annals of Math-

ematics Studies, vol. 184, Princeton University Press, Princeton, NJ, 2013. MR 3237437

M. L.: Dipartimento di Matematica, Universit`a di Padova, Padova, Italy.
E-mail address: mlongo@math.unipd.it
URL: www.math.unipd.it/~mlongo

V. R.: Departament de Matem`atiques, Universitat Polit`ecnica de Catalunya, Barcelona, Spain.
E-mail address: victor.rotger@upc.edu
URL: https://www-ma2.upc.edu/vrotger

C. de V.-P.: Fakult¨at f¨ur Mathematik, Universit¨at Duisburg-Essen, Essen, Germany.
E-mail address: cdeverapiquero@gmail.com
URL: https://www.uni-due.de/~adf538d

