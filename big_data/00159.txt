6
1
0
2

 
r
a

M
1

 

 
 
]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[
 
 

1
v
9
5
1
0
0

.

3
0
6
1
:
v
i
X
r
a

A computable branching process for the Wigner

quantum dynamics

Sihong Shao†,

Yunfeng Xiong†

March 2, 2016

Abstract

A branching process treatment for the nonlocal Wigner pseudo-diﬀerential
operator and its numerical applications in quantum dynamics is proposed and
analyzed. We start from the discussion on two typical truncations of the non-
local term, i.e., the k-truncated and y-truncated models. After introducing
an auxiliary function γ(x), the (truncated) Wigner equation is reformulated
into the integral formulation as well as its adjoint correspondence, both of
which can be regarded as the renewal-type equations and have transparent
stochastic interpretation. We prove that the moment of a branching process
happens to be the solution for the adjoint equation, which connects rigorously
the Wigner quantum dynamics to the stochastic branching process, and thus
a sound mathematical framework for the Wigner Monte Carlo methods is es-
tablished. Within the framework, the branching process for the y-truncated
model recovers the popular signed particle Monte Carlo method which needs
a discretization of the momentum space beforehand, whereas the k-truncated
branching method allows a continuous momentum sampling. More interest-
ingly, with the help of the rigorous connection, we ﬁnd that a constant aux-
iliary function γ(x) ≡ γ0 performs better from the point of view of both
theoretical and numerical aspects. In theory, we obtain a simple but analyti-
2γ0t with t
cal calculation formula for the growth rate of particle number, i.e., e
being the time. In numerics, the constant auxiliary function may facilitate the
random sampling from the exponential distribution and improve the accuracy.
Typical numerical experiments on the Gaussian barrier scattering validate our
theoretical ﬁndings, as well as demonstrate the accuracy, the eﬃciency and
thus the computability of the Wigner branching process.

Keywords: Wigner equation; branching process; quantum dynamics; ad-
joint equation; renewal-type integral equations; importance sampling; signed
particle Monte Carlo method; Gaussian barrier scattering

†LMAM and School of Mathematical Sciences, Peking University, Beijing 100871, China.

1

1

Introduction

Connections between partial diﬀerential equations (PDE) and stochastic pro-
cesses are always heated topics in modern mathematics and provide powerful tools
for both probability theory and analysis, especially for PDE of elliptic and parabolic
type [1,2]. In the past few decades, their numerical applications have also burgeoned
with a lot of developments, such as the iterative Monte Carlo method for the Boltz-
mann transport equation [3], the random walk method for the Laplace equation [4]
and the diﬀusion Monte Carlo method for the Schr¨odinger equation [5].
In par-
ticular, the diﬀusion Monte Carlo method allows us to go beyond the mean-ﬁeld
approximation and oﬀer a direct, reliable solution to quantum many-body systems.
In this work, we focus on the probabilistic approach to the equivalent phase space
formalism of quantum mechanics, namely, the Wigner function approach [6], which
bears a close analogy to classical mechanics and has been drawing growing atten-
tion [7–10]. In recent years, the Wigner equation has been widely used in nanoelec-
tronics [11, 12], non-equilibrium statistical mechanics [13], quantum optics [14], and
many-body quantum systems [15]. Actually, a branch of experiment physics in the
community of quantum tomography are devoting to reconstructing the Wigner func-
tion from measurements [16,17]. Moreover, the intriguing mathematical structure of
the Wigner equation has also been employed in the deformation quantization [18].
Despite its theoretical advantages, solving the Wigner equation is extremely
problematic, because of the high dimensionality of the phase space, as well as the
highly oscillating structure of the Wigner function due to the spatial coherence [8,17].
Although an eﬃcient deterministic method, i.e., the conservative spectral element
method (SEM), has enabled an accurate transient simulation, it is still conﬁned to
the one-dimensional one-body case [19]. It is not until recently have the authors
made the ﬁrst attempt to solve the one-dimensional two-body problem through a
third-order advection-spectral-mixed scheme [20]. By contrast, stochastic methods
representing the (quasi-) distribution by ﬁnite number of super-particles, can signiﬁ-
cantly reduce the requirement for data storage for high dimensional simulations, and
provide satisfactory, albeit less accurate numerical solutions [21–23]. More impor-
tantly, they allow an easier fashion for parallelization in modern high performance
computing platforms, thereby facilitating their applications in quantum many-body
systems [15]. Up to now, there mainly exists three particle-based stochastic ap-
proaches for the Wigner simulations in the literature [21, 22].

The ﬁrst approach, called the ensemble Wigner Monte Carlo method, is a gener-
alization of classical Boltzmann transport simulations and each particle is endowed
with an additional particle aﬃnity to carry the quantum information [24–26]. This
method is applicable for simulating one-dimensional resonant tunneling diode, but
suﬀers from the increasing computational complexity while regarding the high di-
mensional aﬃnity evolution [21]. The second approach, designed for the stationary
Wigner-Boltzmann equation associated with a speciﬁed boundary condition, is to
exploit the ergodicity of the trajectories, so that the physical average can be obtained
through a time average over a single particle. This yields a single particle Monte
Carlo method, with the branching of signed particles to manifest the quantum ef-

2

fect [27]. As two major ingredients of the second method, both the dual system of
the Wigner equation and the branching process also play a vital role in the third
approach, called the signed particle Wigner Monte Carlo (spWMC) method [22,28].
This approach utilizes the same idea of particle branching to capture the quan-
tum coherence, and has also proven to be a promising tool for many-body Wigner
simulations [15].

Although the spWMC method has been found to be eﬀective and may probably
overcome the computational burden in fully quantum many-body simulations, to
the extent of our knowledge, there has been so far no detailed mathematical anal-
ysis about it. Only recently, its numerical accuracy for one-dimensional one-body
problem has been validated by comparing with SEM, whereas its stability as well
as the applicability range remain unclear [23]. To this end, this work makes a fur-
ther step towards the construction of ﬁrm mathematical foundations for spWMC,
and explores the inherent relation between the Wigner equation and the stochastic
process. Only by this can we thoroughly understand the underlying idea and make
further improvements on related numerical algorithms.

The main purpose of this paper is twofold. First, we would like to dig out
the inherent connection between the Wigner equation and a stochastic branching
process, which can be sketched by the diagram below.

Wigner equation

integral form

−−−−−−−→

γ(x)

Renewal-type equation

moment←−−−− Branching process

By introducing an auxiliary function γ(x), we are able to cast both the Wigner
equation and its adjoint equation into the renewal-type equations, whose solution can
be interpreted as the ﬁrst moment of a stochastic branching process. In this manner,
we arrive at the stochastic interpretation of the Wigner quantum dynamics, termed
the Wigner branching process in this work. It provides us not only an intuition, but
also a rigorous mathematical tool to study the Wigner equation. Furthermore, based
on the principle of importance sampling, such a probabilistic approach allows us
to calculate macroscopically measurable quantities, including the Wigner function
itself, by simply tracking the trajectories of signed super-particles. One possible
drawback of this method lies in the exponential growth of the particle number in
a branching system, putting the data storage extremely demanding. Fortunately,
this problem can be alleviated by exploiting the dual system of the Wigner equation
(the adjoint equation), which facilitates the use of the Markovian property of the
evolution system and permits us to annihilate the redundant particles through the
resampling procedure at a prescribed frequency.

The spWMC method is just a special case of the Wigner branching process and
might not be the best choice for many-body problems. Thus, our second goal is
to promote its reliability and applicability range. We propose a branching particle
system in which each particle carries a weight ranging in [−1, 1], instead of only in
{−1, 1} within spWMC, and its lifetime is characterized by an exponential distri-
bution with a constant parameter γ0. Such constant auxiliary function γ(x) ≡ γ0
not only improves the accuracy of the stochastic method, but also facilitates the
estimate on the growth rate of particle number. In fact, we derive an exact calcula-

3

tion formula for the growth rate of particle number which reads e2γ0t with t being
the time. In addition, we will show the necessity and feasibility of sampling in the
continuous k-space (i.e., the proposed k-truncated model), and point out the latent
weakness of the semi-discrete model (or termed the y-truncated model in this work).
The rest of this paper is organized as follows. Section 2 reviews brieﬂy the
Wigner formalism of quantum mechanics. From numerical aspects, we are only able
to solve the truncated Wigner equation, instead of the Wigner equation itself. Thus
in Section 3, we illustrate two typical ways to truncate the Wigner equation, termed
the k-truncated and the y-truncated models. Section 4 manifests the equivalence
between the k-truncated Wigner model and a renewal-type integral equation, where
an auxiliary function γ(x) is used to introduce a probability measure in its formu-
lation. Besides, the set of adjoint equation renders an equivalent representation of
the inner product problem.
In Section 5, we will show that such representation,
as well as the importance sampling, plays a vital role in the Wigner Monte Carlo
method and motivates us to discuss the Wigner branching process, namely, there
exists a branching process associated with an exit measure such that its ﬁrst mo-
ment is exactly the solution of the adjoint equation. This probabilistic approach
not only validates the branching process treatment, but also allows us to study the
mass conservation and growth of particle number rigorously. In Section 6, we turn
to discuss several numerical treatments in implementing the Wigner branching pro-
cess. Section 7 investigates the performance of the proposed stochastic methods by
employing SEM as the reference. The paper is concluded in Section 8 with a few
open discussions.

2 The Wigner equation

In this section, we brieﬂy review the Wigner representation of quantum mechan-
ics. The Wigner function f (x, k, t) living in the phase space (x, k) ∈ R2d for position
x and wavevector k,

f (x, k, t) =

dy e−ik·yρ(x +

y
2

, x − y
2

, t),

Rd

is deﬁned by the Weyl-Wigner transform of the density matrix

ρ(x1, x2, t) =

†
piΨi(x1, t)Ψ
i (x2, t),

(cid:90)

(cid:88)

i

(1)

(2)

where pi gives the probability of occupying the i-th state, 2d denotes the degree of
freedom (2×particle number×dimensionality). Although it allows possible negative
values, the Wigner function serves the role as a distribution due to the following
properties [7, 9]

• (cid:82)(cid:82)

• f (x, k, t) is a real function.

Rd×Rd f (x, k, t)dxdk = 1.

4

• The average of any function A(x, k) can be written in a form

A(x, k)f (x, k, t)dxdk.

(3)

Rd×Rd

(cid:90)(cid:90)

(cid:104)A(cid:105)t =

(cid:90)(cid:90)

(cid:104)1D(cid:105)t =

In particular, by taking A(x, k) as an indicator function 1D(x, k) on a given phase
space domain D, we obtain the Wigner (quasi-) probability on D as follows

f (x, k, t)dxdk.

D

(4)

To derive the dynamics of the Wigner function, we evaluate its ﬁrst derivative

through the Schr¨odinger equation (or the quantum Liouville equation)

i ∂
∂t

Ψi(x, t) = − 2

2m

∇2
xΨi(x, t) + V (x, t)Ψi(x, t),

combine with the Fourier completeness relation

(cid:90)

δ(k(cid:48) − k) =

1

dy ei(k−k(cid:48))·y,

(2π)d

Rd

and then obtain the Wigner equation

∂
∂t

f (x, k, t) +

where

k
m

(cid:90)

· ∇xf (x, k, t) = ΘV [f ] (x, k, t),

ΘV [f ] (x, k, t) =

Rd

(cid:90)

dk(cid:48)f (x, k(cid:48), t)Vw(x, k − k(cid:48), t),
1
dye−ik·yDV (x, y, t),

Vw(x, k, t) =

i(2π)d
y
DV (x, y, t) = V (x +
2

Rd
, t) − V (x − y
2

, t).

(5)

(6)

(7)

(8)

(9)

(10)

Here the nonlocal pseudo-diﬀerential term ΘV [f ](x, k, t) contains the quantum in-
formation, DV (x, y, t) denotes a central diﬀerence of the potential function V (x, t),
the Wigner kernel Vw(x, k, t) is deﬁned through the Fourier transform of DV (x, y, t),
 is the reduced Planck constant and m is the particle mass (for simplicity, we as-
sume all particles have the same mass throughout this work). Equivalently, we can
ﬁrst perform the integration in k(cid:48)-space and arrive at another way to formulate the
pseudo-diﬀerential term

(cid:90)

1
i
1

dyDV (x, y, t)(cid:98)f (x, y, t)e−ik·y,
(cid:90)

Rd

dk(cid:48)f (x, k(cid:48), t)eik(cid:48)·y := F−1 [f ] (x, y, t).

(11)

(12)

ΘV [f ] (x, k, t) =

(cid:98)f (x, y, t) =

Actually, (cid:98)f (x, y, t) is just another notation for ρ(x + y

(2π)d

Rd

2 , x − y

2 , t).

5

One of the most important properties of the Wigner equation lies in the anti-

symmetry of the Wigner kernel

Vw(x, k, t) = −Vw(x,−k, t),

then a simple calculation yields

(cid:90)

dk

Rd

dk(cid:48)f (x, k(cid:48), t)Vw(x, k − k(cid:48), t) = 0,

(13)

(14)

(cid:90)

d
dt

Rd

(cid:90)(cid:90)

which corresponds to the conservation of the ﬁrst moment (i.e., total particle number
or mass)

f (x, k, t)dxdk = 0.

Rd×Rd

(15)

Although the Wigner equation is formally (completely) equivalent to the Schr¨odinger

equation in the full space, we would like to point out that such an equivalence is not
necessarily true for the truncated Wigner equation (see, e.g. [29]), since for example
the truncation of y-domain may break the Fourier completeness relation (6). There-
fore, we must be more careful when doing benchmark tests for stochastic Wigner
simulations by adopting the Schr¨odinger wavefunction as the reference, because the
underlying models may not be the same. This may also explain the qualitative but
not quantitative agreement shown in [22], and gives rise to the demanding for highly
accurate deterministic algorithms, such as SEM [19] and the advection-spectral-
mixed scheme [20], which can be used to produce a reliable reference solution as
already did in [23].

3 The truncated Wigner equation

In order to solve numerically the Wigner equation, we need to discuss the trun-
cated Wigner equation on a bounded domain. It should be noted that the double
integrations with respect to k(cid:48) and y in the pseudo-diﬀerential operator (see Eq. (8)
or (11)) involves the inﬁnite domain due to the Fourier transform nature, posing a
formidable challenge in seeking numerical approximations. Intuitively, an feasible
way is either truncating k-space ﬁrst or truncating y-space ﬁrst, denoted below by
the k-truncated and y-truncated models, respectively. It is worth noting that no
matter what kind of truncation we choose, the mass conservation (15) should be
maintained in the resulting model as the physical requirement, which may yield
additional constraints.

3.1 The k-truncated Wigner equation

A reasonable approach to formulate the Wigner equation in a bounded domain
is to exploit the decay of the Wigner function when |k| → ∞, so that we can make
the truncation in k-space. Suppose that we have to evaluate the Wigner function

6

f (x, k, t) in a ﬁnite domain K = [−L1, L1] × [−L2, L2]··· × [−Ld, Ld] (Li > 0) and
make a simple nulliﬁcation outside K, then the k-truncated Wigner equation reads

∂
∂t

f (x, k, t) +

k
m

· ∇xf (x, k, t) =

with the truncated Wigner kernel

dk(cid:48)f (x, k(cid:48), t)V T

w (x, k − k(cid:48), t),

(16)

V T
w (x, k, t) = Vw(x, k, t)

d(cid:89)

i=1

rect(

ki
4Li

),

where the rectangular function rect(k) is given by
|k| <
1
2
|k| ≥ 1
2

rect(k) =

0,

,

.

(cid:90)

K

 1,
(cid:90)

2K

(17)

(18)

(19)

(20)

(21)

It has to be mentioned that V T
w is just a restriction of the Wigner kernel on a ﬁnite
bandwidth 2K = [−2L1, 2L1]× [−2L2, 2L2]···× [−2Ld, 2Ld], without any change of
its deﬁnition (i.e., k − k(cid:48) ∈ 2K when both k and k(cid:48) belong to K). Furthermore, it
can be easily veriﬁed that

(cid:90)

V T
w (x, k, t)dk =

Vw(x, k, t)dk = 0,

Rd

and thus

(cid:90)

(cid:90)

Rd

K

d
dt

f (x, k, t)dxdk = 0.

We expect that any reliable deterministic or stochastic method should preserve this
property.

can be written in a close form (cid:98)V (k, t), we can calculate Vw directly by its deﬁnition

w . If the Fourier transform of V (x, t)

The remaining problem is to evaluate V T

Vw(x, k, t) =

Otherwise, we can still evaluate V T

1

iπd (e2ik·x(cid:98)V (2k, t) − e−2ik·x(cid:98)V (−2k, t)).
(cid:35)

(cid:34)

w through the Poisson summation formula

(cid:88)

d(cid:89)

(

µ∈Zd

i=1

w (x, k, t) ≈
V T

1

i(2π)d

∆yi)DV (x, yµ, t)e−ik·yµ

,

(22)

provided that Vw(x, k) decays for |ki| > 2|Ki| with i = 1, 2,··· , d. Here yµ =
(µ1∆y1, µ2∆y2,··· , µd∆yd) with yi being the spacing and µi ∈ Z. In this situation,
we can only follow the constraint [20]

2Li∆yi = 2π, i = 1, 2,··· , d,

(23)

to both maintain the mass conservation (20) and avoid the overlapping between V T
w
and its adjacent image.

To sum up, we would like to list several advantages of the k-truncated model.

7

• The k-truncated Wigner equation is deﬁned over the continuous k-space.
• It preserves the deﬁnition of the Wigner kernel and avoids the artiﬁcial periodic

extension of DV (x, y, t) in y-space.

• When the Weyl-Wigner transform of V (x) has a close form, we can make use
of the analytical results and avoid the artiﬁcial periodic extension of Vw in
k-space.

The price to pay is that the sampling in the continuous k-space needs some
complicated and sophisticated techniques. In general we have to resort to the Gibbs
or the Metropolis sampler to tackle the high dimensional problem. We will employ
in this work a simple but rather eﬃcient rejection sampling for typical Gaussian
barrier scattering tests.

3.2 The y-truncated Wigner equation

The other way, used in [22], is based on the fact that the inverse Fourier trans-

formed Wigner function (cid:98)f (x, y, t) deﬁned in Eq. (12) decays when |y| → ∞. Thus,
we can focus on (cid:98)f (x, y, t) on a bounded domain Y = [−L1, L1] × [−L2, L2]··· ×

[−Ld, Ld](Li > 0), and deﬁne the truncated pseudo-diﬀerential operator as

ΘT

V [f ] (x, k, t) =

In this case, we only need to evaluate (cid:98)f (x, y, t) at a ﬁnite bandwidth through the

Y

(24)

(cid:90)

1
i

dyDV (x, y, t)(cid:98)f (x, y, t)e−ik·y.
(cid:35)

∆ki)f (x, m∆k, t)eiy·m∆k

Poisson summation formula

(cid:98)f (x, y, t) ≈ 1

(cid:88)

(cid:34)

d(cid:89)

(

(2π)d

m∈Zd

i=1

, y ∈ Y.

(25)

under the assumption that it decays when yi > Li. Here m∆k = (m1∆k1, m2∆k2,··· , md∆kd)
with ∆ki being the spacing, mi ∈ Z, i = 1, 2,··· d. Substituting Eq. (25) into
Eq. (24) leads to

V [f ] (x, k, t) ≈ (cid:88)

ΘT

(cid:90)

Y

m∈Zd
1
1
|Y|
i

˜Vw(x, k, t) =

dy DV (x, y, t)e−iy·k.

f (x, m∆k, t) ˜Vw(x, k − m∆k, t),

Here we have let |Y| = 2L1 × 2L2 ··· × 2Ld and used the constraint

2Li∆ki = 2π, i = 1, 2,··· , d,

(26)

(27)

(28)

which serves as the suﬃcient and necessary condition to establish the semi-discrete
mass conversation

f (x, n∆k, t)∆k = 0.

(29)

(cid:90)

d
dt

dx

Rd

(cid:88)

n∈Zd

8

Suppose the Wigner function at discrete samples k = n∆k are wanted, then we

immediately arrive at the y-truncated (or semi-discrete) Wigner equation

∂
∂t

f (x, n∆k, t)+

n∆k

(cid:88)

m

=

m∈Zd

· ∇xf (x, n∆k, t)
f (x, m∆k, t) ˜Vw(x, n∆k − m∆k, t),

(30)

which indeed provides a straightforward way for stochastic simulations as used in
the spWMC method, and possesses the following properties.

• The modiﬁed Wigner kernel ˜Vw in Eq. (27) can be treated as the Fourier
coeﬃcients of DV (x, y, t) (with a periodic extension), and can be recovered by
the inverse Fourier transform (possibly by the inverse fast Fourier transform).
• The continuous convolution is now replaced by a discrete convolution (see
Eqs. (8) and (26)), so that the sampling in discrete k-space can be simply
realized by counting the cumulative distribution function.

• The set of equidistant sampling in k-space facilitates the data storage.

However, the major disadvantage of the y-truncated model is, the modiﬁed
Wigner potential ˜Vw is not a trivial approximation to the original Wigner poten-
tial (one can refer to the diﬀerence between the Fourier coeﬃcients and continuous
Fourier transformation). The convergence ˜Vw → Vw is only valid when |Y| → ∞,
or the potential V (x, t) decays rapidly at the boundary of the ﬁnite domain (but
this condition is not true for, e.g., the Coulomb-like potential, especially for the
Coulomb interaction between two particles). By contrast, the k-truncated model
only requires the decay of the Wigner function in k-space, and can make full use of
several analytical results of the Wigner kernel. Personally speaking, we would like
to stress that the k-truncated Wigner equation is more appropriate for simulating
many-body quantum systems.

4 Renewal-type integral equations

In order to build the connection between the deterministic partial integro-diﬀerential

equation (7) and a stochastic process, we ﬁrst cast the deterministic equation into a
renewal-type integral equation. For this purpose, the ﬁrst crucial step is to introduce
an exponential distribution in its integral formulation via an auxiliary function γ(x).
The second one is to split the Wigner kernel into two positive parts [27], such that
each part can be endowed with a probabilistic interpretation. More importantly, to
make the resulting stochastic Wigner branching process computable, an equivalent
representation of the inner product (3) is derived by exploiting the adjoint equation.
in the subsequent discussion we focus on the k-
truncated Wigner equation (16), and a similar idea can be straightforwardly gener-
alized to the y-truncated equation (30) as well as the original Wigner equation (7).

Without loss of generality,

9

4.1 Integral formulation with an auxiliary function

The ﬁrst step is to cast Eq. (16) into a renewal-type equation. To this end, we
can introduce an auxiliary function γ(x) and add the term γ(x)f (x, k, t) in both
sides of Eq. (16), yielding

∂
∂t

f (x, k, t)+

k
m

=

(cid:90)

K

· ∇xf (x, k, t) + γ(x)f (x, k, t)

dk(cid:48) f (x, k(cid:48), t) [Vw(x, k − k(cid:48), t) + γ(x)δ(k − k(cid:48))] .

(31)

At this stage, we only consider a nonnegative bounded γ(x), though a time-dependent
γ(x, t) can be also introduced if necessary and analyzed in a similar way. In par-
ticular, we strongly recommend to choose a constant γ(x) ≡ γ0 in real applications,
for the convenience of both theoretical analysis and numerical computation (vide
post). Formally, we can write down its integral formulation through the variation-
of-constant formula

f (x, k, t) =etAf (x, k, 0) +

e(t−t(cid:48))A [B(x, k, t(cid:48)) + γ(x)] f (x, k, t(cid:48))dt(cid:48),

(32)

where etA denotes the semigroup generated by the operator

0

A = −k/m · ∇x − γ(x),

and

B(x, k, t)f (x, k, t) =

dk(cid:48) f (x, k(cid:48), t)Vw(x, k − k(cid:48), t)

(cid:90) t

(cid:90)

K

is the convolution operator which is assumed to be a bounded operator throughout
this work.
When γ(x) is bounded, it only imposes a Lyapunov perturbation on a hyperbolic
system, so that the operator etA is also a C0-semigroup [30]. To further determine
how the operator etA acts on a given function u(x, k, t) ∈ C 1(L2(R2d), [0, T ]), we
need to solve the following evolution system

∂
∂t

u(x, k, t) +

k
m

· ∇xu(x, k, t) + γ(x)u(x, k, t) = 0.

After performing the coordinate conversion [31]

 x(cid:48) = x − kt/m,

k(cid:48) = k,
t(cid:48) = t,

we obtain

∂

∂t(cid:48) u(cid:48)(x(cid:48), k(cid:48), t(cid:48)) = −γ(cid:48)(x(cid:48), t(cid:48))u(cid:48)(x(cid:48), k(cid:48), t(cid:48)),

10

(33)

(34)

(35)

(36)

(37)

where u(cid:48)(x(cid:48), k(cid:48), t(cid:48)) := u(x, k, t) and γ(cid:48)(x(cid:48), t(cid:48)) := γ(x(cid:48)+k(cid:48)t(cid:48)/m) = γ(x). The solution
to the above system reads

(38)
Replacing u(cid:48), γ(cid:48) by u, γ and making a shift x(cid:48) → x = x(cid:48) + kt/m in Eq. (38) leads
to

0 γ(cid:48)(x(cid:48),s)dsu(cid:48)(x(cid:48), k(cid:48), 0).

0 γ(x(t−s))dsu(x(t), k, 0),

u(cid:48)(x(cid:48), k(cid:48), t(cid:48)) = e−(cid:82) t(cid:48)
etAu(x, k, 0) = e−(cid:82) t

where

x(∆t) = x − k∆t/m

is termed the backward-in-time trajectory of (x, k) with a positive time increment
∆t.
After a simple variable substitution (s + t(cid:48) → s), the integral formulation of the

Wigner equation becomes

f (x, k, t) =e−(cid:82) t

0 γ(x(t−s))dsf (x(t), k, 0) +

dt(cid:48) e−(cid:82) t

t(cid:48) γ(x(t−s))ds

(cid:90) t

0

× [B(x(t − t(cid:48)), k, t(cid:48)) + γ(x(t − t(cid:48)))] f (x(t − t(cid:48)), k, t(cid:48)).

Let

H(t(cid:48); x, t) = 1 −

γ(x(t − τ ))e−(cid:82) t

τ γ(x(t−s))ds dτ,

and assume the auxiliary function satisﬁes

γ(x) ≥ 0,

lim
t(cid:48)→−∞

γ(x(t − s))ds = +∞, ∀ x ∈ Rd,

(39)

(40)

(41)

(42)

(43)

(cid:90) t
(cid:90) t

t(cid:48)

t(cid:48)

(cid:90) t

(cid:90) t

then we have

dH(t(cid:48); x, t) ≥ 0,

dH(t(cid:48); x, t) = 1,

(44)
implying that H(t(cid:48); x, t) is a probability measure with respect to t(cid:48) for a given (x, t)
on t(cid:48) ≤ t, characterized by the auxiliary function γ(x). Substituting this measure
into Eq. (41) gives

−∞

f (x, k, t) = [1 − H(0; x, t)] f (x(t), k, 0) +

dk(cid:48) f (x(t − t(cid:48)), k(cid:48), t(cid:48))

dH(t(cid:48); x, t)×

(cid:26) Vw(x(t − t(cid:48)), k − k(cid:48), t(cid:48))

0

γ(x(t − t(cid:48)))

(cid:27)

,

(45)

+ δ(k − k(cid:48))

(cid:90)

K

which can be regarded as a kind of renewal-type equation in the renewal theory
[32, 33].

Next we turn to consider the Wigner kernel Vw, that cannot be regarded as a
transition kernel directly as it allows negative values. Nevertheless, we can split it
into two positive semideﬁnite parts as follows

Vw(x, k, t) = V +

w (x, k, t) − V −

w (x, k, t)

(46)

11

where

V +
w (x, k, t) =
V −
w (x, k, t) =

1
2
1
2

|Vw(x, k, t)| +
1
2
|Vw(x, k, t)| − 1
2

Vw(x, k, t),

Vw(x, k, t).

Owing to the anti-symmetry of Vw (see Eq. (13)), it can be easily veriﬁed that

w (x, k, t) = V −
V +

w (x,−k, t).

We further deﬁne a function Γ on t ≥ t(cid:48), composed of three terms

Γ(x(t − t(cid:48)), k, t; x(cid:48), k(cid:48), t(cid:48)) =V +

w (x(t − t(cid:48)), k − k(cid:48), t(cid:48)) · δ(x(t − t(cid:48)) − x(cid:48))
w (x(t − t(cid:48)), k − k(cid:48), t(cid:48)) · δ(x(t − t(cid:48)) − x(cid:48))
− V −
+ γ(x(t − t(cid:48))) · δ(k − k(cid:48)) · δ(x(t − t(cid:48)) − x(cid:48)).

(47)

(48)

(49)

(50)

Finally, the k-truncated Wigner equation (16) can be cast into a Fredholm integral
equation of the second kind

f (x, k, t) = f0(x, k, t) + Sf (x, k, t),

0 ≤ t ≤ T,

where

f0(x, k, t) = e−(cid:82) t
(cid:90) t
dt(cid:48)(cid:90)
Sf (x, k, t) =
K(x, k, t; x(cid:48), k(cid:48), t(cid:48)) = e−(cid:82) t

0

dx(cid:48)(cid:90)

Rd

K

0 γ(x(t−s))dsf (x(t), k, 0),

dk(cid:48) K(x, k, t; x(cid:48), k(cid:48), t(cid:48))f (x(cid:48), k(cid:48), t(cid:48)),

t(cid:48) γ(x(t−s))dsΓ(x(t − t(cid:48)), k, t; x(cid:48), k(cid:48), t(cid:48)),

t ≥ t(cid:48).

(51)

(52)

(53)

(54)

Before discussing the probabilistic approach to the integral equation (51), we
would like ﬁrst to derive its adjoint equation and attain an equivalent representation
of (cid:104)A(cid:105)T , which serves as the cornerstone of the computable Wigner branching process
in numerics.

4.2 Dual system and adjoint equation

In quantum mechanics, we are often interested in macroscopically measurable
quantities (cid:104)A(cid:105)t, such as the Wigner probability, electron density, etc. In this regard,
we turn to consider the problem of evaluating the inner product

(cid:90)

(cid:90) T

0

(cid:90)

(cid:104)g0, f(cid:105) =

dt

dx

dk g0(x, k, t)f (x, k, t),

(55)

Rd

K

on the domain Rd × K × [0, T ](T > 0). For instance, to evaluate the average value
(cid:104)A(cid:105)T of a macroscopic quantity A(x, k) at a given ﬁnal time T , we should take

g0(x, k, t) = A(x, k)δ(t − T ),

(56)

12

then

(cid:104)A(cid:105)T = (cid:104)g0, f(cid:105).

(57)

In this section, we will give the explicit formulation of the adjoint equation, starting
from Eq. (51) and Eq. (56). For brevity, we will assume that the potential is time-
independent, and thus the kernels becomes

K(x, k, t; x(cid:48), k(cid:48), t(cid:48)) = e−(cid:82) t
Γ(x, k; x(cid:48), k(cid:48)) =(cid:2)V +

t(cid:48) γ(x(t−s))dsΓ(x(t − t(cid:48)), k; x(cid:48), k(cid:48)),
w (x, k − k(cid:48)) − V −

w (x, k − k(cid:48)) + γ(x)δ(k − k(cid:48))(cid:3) δ(x − x(cid:48)).

t ≥ t(cid:48),

(58)

(59)
Suppose the kernel K(x, k, t; x(cid:48), k(cid:48), t(cid:48)) is bounded, then it’s easy to verify that
S is a bounded linear operator. Accordingly, we can deﬁne the adjoint operator
T = S∗ by

(cid:104)g,Sf(cid:105) = (cid:104)S∗g, f(cid:105) = (cid:104)T g, f(cid:105),

Applying Theorem 4.6 in [34] directly into the Fredholm integral equation of the
second kind (51) yields

T g(x(cid:48), k(cid:48), t(cid:48)) =

dk K(x, k, t; x(cid:48), k(cid:48), t(cid:48))g(x, k, t),

t ≥ t(cid:48).

(61)

(cid:90)

(cid:90) T

t(cid:48)

dt

dx

Rd

K

(cid:90)

Formally, it suﬃces to deﬁne

g(x(cid:48), k(cid:48), t(cid:48)) = T g(x(cid:48), k(cid:48), t(cid:48)) + g0(x(cid:48), k(cid:48), t(cid:48)),

0 ≤ t(cid:48) ≤ T.

(cid:104)g, f(cid:105) = (cid:104)g,Sf + f0(cid:105) = (cid:104)T g, f(cid:105) + (cid:104)g, f0(cid:105) = (cid:104)g, f(cid:105) − (cid:104)g0, f(cid:105) + (cid:104)g, f0(cid:105),

Since

we have

namely

(cid:90) T

0

dt(cid:48)(cid:90)

Rd

(cid:104)A(cid:105)T =

Furthermore, we perform the coordinate conversion

0 γ(x(cid:48)(t(cid:48)−s))dsg(x(cid:48), k(cid:48), t(cid:48)).

(60)

(62)

(63)

(64)

(65)

(66)

K

(cid:104)g0, f(cid:105) = (cid:104)g, f0(cid:105),
dk(cid:48) f (x(cid:48)(t(cid:48)), k(cid:48), 0)e−(cid:82) t(cid:48)

dx(cid:48)(cid:90)
 r0 = x(cid:48)(t(cid:48)) = x(cid:48) − k(cid:48)t(cid:48)/m,
(cid:90)

dk0 f (r0, k0, 0)e−(cid:82) t0

k0 = k(cid:48),
t0 = t(cid:48),

dr0

13

with which the Jacobian determinant ∂(r0,k0,t0)
unchanged (i.e., dr0dk0dt = dx(cid:48)dk(cid:48)dt(cid:48)), and thus Eq. (65) becomes

∂(x(cid:48),k(cid:48),t(cid:48)) = 1 implying the volume unit keeps

(cid:90)

(cid:90) T

0

dt0

Rd

K

(cid:104)A(cid:105)T =

0 γ(r0(s))dsg(r0(t0), k0, t0),

(67)

where we have introduced a forward-in-time trajectory (in contrast to the backward-
in-time trajectory x(∆t) given in Eq. (40)) as follows
r0(∆t) = r0 + k0∆t/m,

(68)
with ∆t ≥ 0 being the time increment. Actually, Eq. (67) motivates us to combine
the exponential factor with g and deﬁne a new function ϕ(r, k, t) ∈ C 1(L2(Rd ×
K), [0, T ]) as

t γ(r(s−t))dsg(r(t(cid:48) − t), k, t(cid:48)).

t

ϕ(r, k, t) =

(69)
Please keep in mind that, it is required t(cid:48) ≥ t for convenience in the deﬁnition (69),
before which t(cid:48) ≤ t is always assumed, for example, see Eq. (61). Consequently,
from Eq. (67), the inner product (57) can be determined only by the ‘initial’ data,
as stated in the following theorem.
Theorem 1. The average value (cid:104)A(cid:105)T of a macroscopic quantity A(x, k) at a given
ﬁnal time T can be evaluated by

(cid:90) T

dt(cid:48)e−(cid:82) t(cid:48)

(cid:90)

(cid:90)

(cid:104)A(cid:105)T =

Rd

K

dr0

dk0 f (r0, k0, 0)ϕ(r0, k0, 0),

(70)

where ϕ is deﬁned in Eq. (69).

According to Eq. (70), in order to evaluate (cid:104)A(cid:105)T , the remaining task is to calcu-
late ϕ(r0, k0, 0). To this end, we need ﬁrst to obtain the expression of g(r0(t0), k0, t0)
from the dual system (62).
Replacing (x(cid:48), k(cid:48), t(cid:48)) by (r0(t0), k0, t0) and performing the coordinate conversion
x(t − t(cid:48)) → r1, k → k1, t → t1 in Eq. (62) yield

g(r0(t0), k0, t0) =g0(r0(t0), k0, t0) +

× Γ(r1, k1; r0(t0), k0)g(r1(t1 − t0), k1, t1),

where the trajectory r1(∆t) reads

r1(∆t) = r1 + k1∆t/m, ∆t ≥ 0,

γ(r1(s−t0))ds

(71)

(72)

(cid:90)

(cid:90) T

t0

dt1

dr1

Rd

K

(cid:90)

dk1 e−(cid:82) t1

t0

which is not the same as r0(∆t) given in Eq. (68) since the underlying wavevectors
k0 and k1 are diﬀerent! Substituting Eq. (71) into Eq. (67) leads to

(cid:90)

(cid:104)A(cid:105)T = (cid:104)A(cid:105)T,0 +
×

dr1

(cid:90)

Rd

K

where

(cid:90)

dr0

Rd

K

dt0

(cid:90) T
dk1e−(cid:82) t1
(cid:90)

t0

0

(cid:90)

(cid:90)

(cid:104)A(cid:105)T,0 =

dr0

Rd

K

dk0 f (r0, k0, 0)e−(cid:82) t0

0 γ(r0(s))ds

dt1

(cid:90) T

t0

γ(r1(s−t0))dsΓ(r1, k1; r0(t0), k0)g(r1(t1 − t0), k1, t1),

dk0 f (r0, k0, 0)e−(cid:82) T

0 γ(r0(s))dsA(r0(T ), k0).

14

(73)

(74)

From the dual system (62), we can also obtain a similar expression to Eq. (71) for
g(r1(t1 − t0), k1, t1), and then corresponding time integration with respect to t1 in
Eq. (73) becomes

γ(r1(s−t0))dsg(r1(t1 − t0), k1, t1) = e

(cid:90) T
dt1 e−(cid:82) t1
(cid:90) T
dt1 e−(cid:82) t1
dr2
× e−(cid:82) t2
γ(r2(s−t1))dsΓ(r2, k2; r1(t1 − t0), k1),

γ(r1(s−t0))ds

(cid:90) T

(cid:90)

(cid:90)

dt2

t0

+

Rd

t0

t1

K

t0

t0

t1

−(cid:82) T

t0

γ(r1(s−t0))dsA(r1(T − t0), k1)

dk2 g(r2(t2 − t1), k2, t2)

(75)

where

r2(∆t) = r2 + k2∆t/m, ∆t ≥ 0.

(76)

Combining Eq. (75) and the deﬁnition (69) directly gives the adjoint equation

for ϕ as stated in Theorem 2.

Theorem 2 (Adjoint equation). The function ϕ(r, k, t) deﬁned in Eq. (69) satisﬁes
the following integral equation

ϕ(r, k, t) =e−(cid:82) T

t γ(r(s−t))dsA(r(T − t), k) +
× ϕ(r(cid:48), k(cid:48), t(cid:48))e−(cid:82) t(cid:48)

K
t γ(r(s−t))dsΓ(r(cid:48), k(cid:48); r(t(cid:48) − t), k).

Rd

t

dk(cid:48)

(77)

(cid:90) T

dt(cid:48)(cid:90)

dr(cid:48)(cid:90)

We call Eq. (77) the adjoint equation of Eq. (41) is mainly because f (r, k, 0)
and ϕ(r, k, 0) constitute a dual system in the bilinear form (70) (denoted by (cid:104)·,·(cid:105)0)
for determining (cid:104)A(cid:105)T . Combining the formal solution f (r, k, T ) = eT (A+B)f (r, k, 0)
of the Wigner equation (16) as well as Eqs. (3) and (70) directly yields

(cid:104)A(cid:105)T = (cid:104)f (r, k, 0), ϕ(r, k, 0)(cid:105)0 = (cid:104)f (r, k, T ), A(r, k)(cid:105)0

= (cid:104)eT (A+B)f (r, k, 0), A(r, k)(cid:105)0 = (cid:104)f (r, k, 0), e−T (A+B)A(r, k)(cid:105)0.

(78)
In consequence, we formally obtain ϕ(r, k, 0) = e−T (A+B)A(r, k) with e−T (A+B)
being the adjoint operator of eT (A+B), indicating that Eq. (77), in some sense, can
be treated as an inverse problem of Eq. (51), which produces a quantity ϕ(r, k, 0)
from the observation A(r, k) at the ending time T .
Moreover, for given (r, t) on t(cid:48) ≥ t, we can similarly introduce a probability

measure with respect to t(cid:48) like

(cid:90) t(cid:48)

G(t(cid:48); r, t) =

γ(r(τ − t))e−(cid:82) τ

t γ(r(s−t))ds dτ,

(79)

(80)

(81)

because of

t

dG(t(cid:48); r, t) ≥ 0,

dG(t(cid:48); r, t) = 1,

under the assumption that the auxiliary function satisﬁes

∀r ∈ Rd,

γ(r) ≥ 0,

γ(r(t − s))ds = +∞.

(cid:90) +∞
(cid:90) t(cid:48)

t

lim
t(cid:48)→+∞

t

15

Substituting the measure (79) into Eq. (77) also yields a renewal-type equation

ϕ(r, k, t) = [1 − G(T ; r, t)] A(r(T − t), k)

(cid:90) T

t

(cid:90)

dr(cid:48)(cid:90)

+

dG(t(cid:48); r, t)

dk(cid:48) Γ(r(cid:48), k(cid:48); r(t(cid:48) − t), k)

γ(r(t(cid:48) − t))

Rd

K

ϕ(r(cid:48), k(cid:48), t(cid:48)).

(82)

5 The Wigner branching process

Owing to the fact that all the moments of a branching process satisfy the renewal-
type equations [32], it naturally motivates us to construct a branching process such
that its expectation is the unique solution of Eq. (45) or Eq. (82). Hereafter we
will denote such a random process by the Wigner branching process and introduce
a probabilistic model, termed the branching particle system, to describe it in a
picturesque language.
In numerics, the solution at (r, k, t) can be obtained by
tracking the branching history of weighted super-particles. The particle trajectories
are either backward or forward in time, depending on the temporal ﬂow direction.
We will devote to validating such a probabilistic approach, studying the inherent
mass conservation property and deriving a basic estimate on the growth of particle
number.

Before getting into the details of stochastic Wigner solvers, we would like to
emphasize the central role of Eq. (70) in the computable Wigner branching process.
In fact, combining the probabilistic approach with the principle of importance sam-
pling, the inner product (57) can be evaluated by a purely particle-based scheme in
which every super-particle, carrying a weight and a sign, is moving according to sev-
eral speciﬁc rules in the branching particle system. More importantly, such stochas-
tic method allows us to solve the Wigner quantum dynamics in a time-marching
manner and annihilate the super-particles with opposite signs, thereby overcoming
the potential weakness of the branching process treatment, such as the exponential
growth of particle number, and successfully saving the eﬃciency.

5.1 Importance sampling

Hereto we have shown in Eq. (70) that the average (cid:104)A(cid:105)T can be evaluated by
sampling from the initial Wigner function f (r, k, 0) and solving the adjoint equation
(77) for ϕ(r, k, 0), instead of the direct calculation based on f (r, k, T ) as shown
in Eq. (57). Actually, the bilinear form (70) for determining (cid:104)A(cid:105)T serves as the
foundation of the so-called Wigner Monte Carlo algorithm in which the importance
sampling plays a key role.
In order to calculate (cid:104)A(cid:105)t, two major obstacles must be overcomed, one is how
to seek a numerical approximation to the Wigner function, the other is how to draw
samples according to it. To this end, a simple function fS is introduced ﬁrst as
follows

(cid:90)(cid:90)

fS(x, k, t) =

|Dj| ·
1Dj (x, k) · 1

f (x, k, t)dxdk,

(83)

Dj

(cid:88)

j

16

where {Dj} gives a partition of Rd × K.
converges to f (x, k, t) as |Dj| → 0, and satisﬁes

(cid:90)(cid:90)

(cid:90)(cid:90)

It can be easily found that fS(x, k, t)

fS(x, k, t)dxdk =

Rd×K

f (x, k, t)dxdk = 1.

(84)

Rd×K

Hereafter the simple function fS serves as the numerical approximation to the
Wigner function f .

Regarding of the fact that the Wigner function may take negative value, we

further introduce an instrumental probability distribution fI as follows

fI(x, k, t) =

1

H(t)

(cid:12)(cid:12)(cid:12),

f (x, k, t)dxdk

Dj

|Dj| ·(cid:12)(cid:12)(cid:12)(cid:90)(cid:90)

(cid:88)
1Dj (x, k) · 1
(cid:88)

(cid:12)(cid:12)(cid:12)(cid:90)(cid:90)

j

Dj

(cid:12)(cid:12)(cid:12).

H(t) =

f (x, k, t)dxdk

where H(t) is the normalization factor (we assume H(t) is bounded)

It can be easily veriﬁed that

j

fI(x, k, t)H(t) = |fS(x, k, t)|.

Wigner quasi-probability(cid:82)(cid:82)

Sampling from the distribution (85) is quite convenient since it is equivalent to
allocating super-particles in each cell Dj, according to the absolute value of the
f (x, k, t)dxdk and the volume |Dj|. In consequence,
we can simply approximate (cid:104)A(cid:105)t from Eq. (57) by
· fS(x, k, t)
(cid:104)A(cid:105)t =
fI(x, k, t)

· fI(x, k, t)dxdk

Dj

Rd×K

A(x, k) · f (x, k, t)
fS(x, k, t)
A(x, k) · fS(x, k, t)
fI(x, k, t)

· fI(x, k, t)dxdk ≈(cid:88)

α

A(xα, kα) · wα(t), (88)

(cid:90)(cid:90)
(cid:90)(cid:90)

≈

Rd×K

where the ﬁrst approximation utilizes the fact that fS → f as |Dj| → 0, while the
second one is the standard rule of importance sampling with Nα discrete samples
{(xα, kα)}Nα
α=1 generated from the instrumental probability distribution fI(x, k, t),
and the ‘weight’ wα(t) reads

(85)

(86)

(87)

(89)

sα(t)(cid:80)

α sα(t)

wα(t) =

fS(xα, kα, t)

with

(90)
being either −1 or 1 due to Eq. (87). In fact, the last approximation adopted in
Eq. (88) implicitly utilizes the strong law of large number

fI(xα, kα, t)H(t)

sα(t) =

H(t)sα(t) → 1 as Nα → +∞, a.s.

(91)

(cid:88)

1
Nα

α

17

due to Eq. (84). It must be emphasized here that the sign function sα(t) indicates
that every super-particle must be endowed with a sign, either positive or negative,
for resolving the negative part of the Wigner distribution. Actually, the concept of
signed particles, which emerges naturally here via the importance sampling, is the
intrinsic feature of the Wigner Monte Carlo method, that is never seen in classical
Vlasov or Boltzmann simulations.

However, the approximation (88) is rather formal since it requires the knowl-
edge of f (x, k, t), the solution of interest! By contrast, Eq. (70) provides a more
convenient way to calculate (cid:104)A(cid:105)t
in a time stepping manner. For the sake of
brevity, we will divide the time interval [0, T ] into n equidistant steps and denote
tl = l∆t, l = 1, 2,··· , n, and ∆t = T /n, though non-equidistant time steps are also
allowed in principle. Besides, without loss of generality, we can take f (r, k, tl) as
the initial data and set the ending time to be tl+1, owing to the Markovian property
of the linear evolution system. Accordingly, based on Eq. (70), we can approximate
(cid:104)A(cid:105)tl+1 through the principle of importance sampling as follows

(cid:90)(cid:90)
≈(cid:88)

α

(cid:104)A(cid:105)tl+1 =

ϕ(r, k, tl) · f (r, k, tl)
fS(r, k, tl)

Rd×K
ϕ(rα, kα, tl) · wα(tl),

· fS(r, k, tl)
fI(r, k, tl)

· fI(r, k, tl)drdk

(92)

where the discrete sample (rα, kα), generated from fI(r, k, tl), corresponds to a
super-particle located at (rα, kα), endowed with a signed weight of wα(tl). Conse-
quently, it only remains to solve the adjoint equation with ϕ(r, k, tl+1) = A(r, k) to
get ϕ(r, k, tl) at several discrete samples (rα, kα) via the branching process treat-
ment discussed later. In particular, substituting A(r, k) = 1Dj (r, k) into Eq. (92)
yields

(cid:90)(cid:90)

f (r, k, tl+1) ≈(cid:88)

ϕ(rα, kα, tl) · wα(tl),

(93)

Dj

α

implying that we can readily attain the numerical solution fS(r, k, tl+1) and the
instrumental distribution fI(r, k, tl+1) at the next time step.

More importantly, such a time marching scheme overcomes the intrinsic weakness
of the branching process treatment, say, the exponential growth of particle number
(see Theorem 6). Within each step, we only need to evolve the particle system
for a relatively small ∆t and update the instrumental distribution, from which we
are able to draw new samples for the next loop. By exploiting the cancelation
of weights of opposite sign, the resampling procedure can signiﬁcantly reduce the
particle number and save the computational eﬃciency dramatically in practice (See
Section 7). Just because of such sampling reduction, the resampling procedure is
also called annihilation in previous works, e.g., see [15].

The rest of this section is devoted to a computable, albeit not the unique, stochas-
tic method for solving the adjoint equation based on the stochastic interpretation of
its solution. In the subsequent sections, we will focus on the probabilistic approach
for the adjoint equation (77), while all the deductions can be straightforwardly gen-
eralized to the Wigner equation due to the strong similarities between Eqs. (45) and
(82).

18

5.2 A branching particle system

The remaining problem is to estimate ϕ(rα, kα, tl) through A(r, k), as required
in Eq. (92). The calculation can be realized by tracking the evolution of a branching
particle system inherited in the renewal-type equation (82), which is described below
in picturesque language using a branching particle system associated with an exit
system. The exit system means that a particle in the branching system will be
frozen when its life-length exceeds the ﬁnal time T . All related rigorous analysis is
left for the next subsection.
Consider a system of particles moving in Rd×K×[t, T ] according to the following
rules. Without loss of generality, the particle, starting at time t at state (r, k),
having a random life-length τ and carrying an initial weight φ, is marked. The
chosen initial data corresponds to those adopted in the renewal-type equation (82).

Rule 1 The motion of each particle is described by a right continuous Markov

process.

Rule 2 The particle at (r, k) dies in the age time interval (t, t(cid:48)) with probability
G(t(cid:48); r, t), which depends on its position r and the time t (see Eq. (79)). In
particular, when using the constant auxiliary function γ(x) ≡ γ0, the particle
dies during time interval (t, t(cid:48)) with probability 1 − e−γ0(t(cid:48)−t) ≈ γ0(t(cid:48) − t) for
small t(cid:48) − t, which is totally independent of both its position and age.

Rule 3 If t+τ < T , the particle dies at age t(cid:48) = t+τ at state (r(τ ), k), and produces
(1), k(cid:48)
(3)), endowed with
(3), respectively. All these parameters can be

three new particles at states (r(cid:48)
updated weights φ(cid:48)
(2), φ(cid:48)
determined by the kernel function in Eq. (82):

(1)), (r(cid:48)

(2)), (r(cid:48)

(1), φ(cid:48)

(2), k(cid:48)

(3), k(cid:48)

Γ(r(cid:48), k(cid:48); r(τ ), k)

γ(r(τ ))

and thus

=

ξ(r(cid:48))

w (r(cid:48), k − k(cid:48))
· V −
ξ(r(cid:48))
γ(r(τ ))
w (r(cid:48), k − k(cid:48))
− ξ(r(cid:48))
· V +
+ 1 · δ(k − k(cid:48)) · δ(r(τ ) − r(cid:48)),

γ(r(τ ))

ξ(r(cid:48))

· δ(r(τ ) − r(cid:48))

· δ(r(τ ) − r(cid:48))

k − k(cid:48)

w (r(τ ), k)
ξ(r(τ ))

(1) ∝ V −
(1) = ζ(r(τ )) · φ, φ(cid:48)
φ(cid:48)

, k − k(cid:48)

(2) = r(cid:48)

r(cid:48)
(1) = r(cid:48)
(2) ∝ V +
w (r(τ ), k)
ξ(r(τ ))

(2) = −ζ(r(τ )) · φ, φ(cid:48)

(3) = r(τ ),
, k(cid:48)
(3) = k,
(3) = 1 · φ,

(94)

(95)

(96)

(97)

where the function ξ(r) is the normalization factor for both V +

w and V −

w , i.e.,

V −
w (r, k)dk,

(98)

(cid:90)

ξ(r) =

2K

(cid:90)

2K

V +
w (r, k)dk =

19

because of the mass conservation (19), and

ζ(r) =

ξ(r)
γ(r)

.

(99)

Actually, besides Eq. (96), it is required that both k(cid:48)
otherwise k(cid:48)

(2) must be rejected.

(1) and k(cid:48)

(1) ∈ K and k(cid:48)

(2) ∈ K hold,

Rule 4 If t + τ ≥ T , say, the life-length of the particle exceeds T − t, it will
immigrate to the state (r(T − t), k) and be frozen. This rule corresponds to
the ﬁrst right-hand-side term of Eq. (82), and the related probability is

Pr(τ ≥ T − t) = 1 − G(T ; r, t) = e−(cid:82) T

t γ(r(s−t))ds.

(100)

Rule 5 The only interaction between the particles is that the birth time and state

of oﬀsprings coincide with the death time and state of their parent.

Based on the above ﬁve rules, we can establish the framework of the branching
process to calculate numerically the Wigner function in the following three steps,
e.g., from tl to tl+1 with the time step ∆t, l = 1, 2,··· , n − 1. Recall that we would
like to estimate ϕ(rα, kα, tl), thus it suﬃces to take r = rα, k = kα, t = tl (i.e., the
initial state), and r(cid:48) = r(cid:48)

α for the oﬀsprings in Eq. (82).

α, k(cid:48) = k(cid:48)

α, t(cid:48) = t(cid:48)

Step 1: Sample from the instrumental distribution The ﬁrst step is to sam-
ple Nα ancestor particles according to the instrumental distribution fI(r, k, tl)
(see Eq. (85)). Each particle has a state (rα, kα) and carries a weight φα.

Step 2: Evolve the particles The second step is to evolve super-particles accord-
ing to the rules of branching particle systems. Suppose a particle is born at
α ∈ [tl, tl+1] at state (r(cid:48)
t(cid:48)
α, and it has a random life-length
τ(cid:48)
α satisfying

α) with weight φ(cid:48)

α, k(cid:48)

(cid:12)(cid:12)(cid:12)t(cid:48)=t(cid:48)

−(cid:82) t(cid:48)

α+τ(cid:48)
t(cid:48)

α

α

= γ(r(cid:48)

α(τ(cid:48)

α))e

α+τ(cid:48)

α

γ(r(cid:48)

α(s−t(cid:48)

α))ds.

(101)

α ∝ dG(t(cid:48); r(cid:48)
α, t(cid:48)
α)
τ(cid:48)
dt(cid:48)
α = tl, (r(cid:48)
α, k(cid:48)
When t(cid:48)
an ancestor in Step 1.
α ≥ tl+1 − t(cid:48)
If τ(cid:48)
probability of this event is

α) = (rα, kα), φ(cid:48)

α = φα, it indicates that such a particle is

α(tl+1 − t(cid:48)

Pr(τ(cid:48)

α, the particle is frozen at the state (r(cid:48)
−(cid:82) tl+1
α(τ(cid:48)
α) and dies at time t(cid:48)
α + τ(cid:48)

α +
α), and meanwhile, three new particles are generated

Otherwise, the particle travels to a new position r(cid:48)
τ(cid:48)
α at state (r(cid:48)
according to Rule 3, the probability of which is G(t(cid:48)

α) = 1 − G(tl+1; r(cid:48)

α ≥ tl+1 − t(cid:48)

α) and the

α), k(cid:48)

α), k(cid:48)

α) = e

α; r(cid:48)

α, t(cid:48)

γ(r(cid:48)

α(s−t(cid:48)

α(τ(cid:48)

α, t(cid:48)

α))ds.

(102)

α).

t(cid:48)

α

20

Step 3: Update the Wigner function When all particles in the branching sys-
tem are frozen, we need to record their positions, wavevectors, and weights.
Let Eα denote the index set of all frozen particles with the same ancestor
initially at state (rα, kα), {(ri,α, ki,α), i ∈ Eα} the collection of corresponding
frozen states, and φi,α the updated weight of the i-th particle. Accordingly,
the adjoint variable can be approximated as

φi,α · A(ri,α, ki,α),

φi,α · wα(tl) · A(ri,α, ki,α).

(103)

(104)

ϕ(rα, kα, tl) ≈(cid:88)
(cid:88)
(cid:104)A(cid:105)tl+1 ≈(cid:88)

i∈Eα

i∈Eα

α

and substituting it into Eq. (92) leads to

Particularly, plugging into A(r, k) = 1Dj (r, k), we obtain fS(r, k, tl+1) from
Eq. (93), which not only serves as an estimator to the Wigner distribution
f (r, k, tl+1), but also renders the instrumental distribution fI(r, k, tl+1) re-
quired in the next loop. After that, we return to the ﬁrst step, resample from
the updated instrumental distribution and continue until the ﬁnal time T is
reached. In practice, the resampling leads to a sharp decrease of particles in
the branching particle system (see Sections 6.4 and 7).

So far we have avoided the rigorous deduction and only depicted an intuitive
picture of the branching particle system. But it naturally arouses two questions
below.

Question 1 Does the approximation (104) really converge?

Question 2 How to estimate the growth rate of particle number?

To solve Question 1, a validation of the probabilistic approach through stochastic
analysis is required. For Question 2, we recourse to the theory of branching process.
Actually, the answer to Question 2 is extremely important in real applications be-
cause of the limited computational resource. We expect to give an reliable criterion
on how to suppress the growth of particle number in numerical simulations.

5.3 Stochastic interpretation

In the theory of branching process, all the moments of an age-dependent branch-
ing processes satisfy renewal-type integral equations [32], where the term “age-
dependent” means the probability that a particle, living at t, dies at (t, t + ∆t)
might not be a constant function of t. In this regard, it suﬃces to deﬁne a stochas-
tic branching Markov process (continuous in time parameter), corresponding to the
branching particle system as described before.

The random variable of a branching particle system is the family history, a
denumerable random sequence corresponding to a unique family tree. Firstly, we

21

need a sequence to identify the objects in a family. Beginning with an ancestor,
denoted by (cid:104)0(cid:105), and we can denote its ﬁrst, second and third children by (cid:104)1(cid:105), (cid:104)2(cid:105), (cid:104)3(cid:105).
Similarly, we can denote the j-th child of i-the child by (cid:104)ij(cid:105), and thus (cid:104)i1i2 ··· in(cid:105)
means in-th child of in−1-th child of ··· of the i2-child of the i1-th child, with
in ∈ {1, 2, 3}. The ancestor (cid:104)0(cid:105) is omitted here and hereafter for brevity.

Our branching particle system involves three basic elements: the position r (or
x), the wavevector k and the life-length τ , and each particle will either immigrate to
r(τ ) = r + kτ /m, then be killed and produce three oﬀsprings, or be frozen when
hitting the ﬁrst exit time T . Now we can give the deﬁnition of a family history,
starting from one particle at age t at state (r, k). In the subsequent discussion we
let (r0, k0) = (r, k).

Deﬁnition 1. A family history ω stands for a random sequence

ω = ((τ0, r0, k0); (τ1, r1, k1); (τ2, r2, k2); (τ3, r3, k3); (τ11, r11, k11);··· ),

(105)

where the tuple Qi = (τi, ri, ki) appears in a deﬁnite order of enumeration. τi,
ri, ki denote the life-length, starting position and wavevector of the i-th particle,
respectively. The exact order of Qi is immaterial but is supposed to be ﬁxed. The
collection of all family histories is denoted by Ω.

At this stage, the initial time t and the initial state (r0, k0) of the ancestor

particle (cid:104)0(cid:105) are assumed to be non-stochastic.
Deﬁnition 2. For each ω = (Q0; Q1; Q2; Q3; Q11 ··· ), the subfamily ωi is the fam-
ily history of (cid:104)i(cid:105) and its descendants, deﬁned by ωi = (Qi; Qi1; Qi2, Qi3;··· ). The
collection of ωi is denoted by Ωi.

Equivalently, we can also use the time parameter to identity the path of a particle
and all its ancestors in the family history, and denote ηs its state (i.e., starting
position and wavevector) at time s ≥ t. Taking the particle i = (cid:104)i1i2 ···(cid:105) as an
) with ti1 = t + τ0
example, we have Q0 = (τ0, ηt) with ηt = (r0, k0), Qi1 = (τi1, ηti1
and ηti1
= (ri1i2, ki1i2),
··· . To characterize the freezing behavior of the particle, we denote the ﬁrst exit
time by T , as boundary conditions are not speciﬁed.
Deﬁnition 3. Suppose the family history starts at time t. Then a particle (cid:104)i1i2 ··· in(cid:105)
is said to be frozen at T if the following conditions hold

= (ri1, ki1), Qi1i2 = (τi1i2, ηti1i2

) with ti1i2 = ti1 +τi1 and ηti1i2

t + τ0 + τi1 + τi1i2 + ··· + τi1i2···in−1 < T,
t + τ0 + τi1 + τi1i2 + ··· + τi1i2···in−1 + τi1i2···in ≥ T.

(106)
(107)
In particular, when t + τ0 ≥ T , the ancestor particle (cid:104)0(cid:105) is frozen. Sometimes the
particle (cid:104)i1i2 ··· in(cid:105) is also called alive in the time interval [t, T ]. The collection of
frozen particles is denoted by E(ω).
Remark 1. The ﬁrst exit time τe(O) from an open set O is deﬁned by

τe(O) = inf {s ≥ t : (s, ηs) /∈ O} .

Since a boundary condition is not applied yet, we have O = (−∞, T )×Rd×K(cid:48) with
K(cid:48) being an open cover of K, and thus τe(O) = T .

22

Figure 1: An example of family history tree.

Example 1. ω = (Q0; Q1; Q2; Q3; Q21; Q22; Q23; Q231; Q232; Q233) uniquely deter-
mines a family history tree, as shown in Fig. 1. ω2 = (Q2; Q21; Q22; Q23; Q231; Q232; Q233)
is a subfamily history that describes the family history of Q2 and its descendants,
and we have ω = (Q0; ω1; ω2; ω3). The collection of frozen particles is E(ω) =
{(cid:104)1(cid:105),(cid:104)21(cid:105),(cid:104)22(cid:105),(cid:104)231(cid:105),(cid:104)232(cid:105),(cid:104)233(cid:105),(cid:104)3(cid:105)}.

Hereafter we assume that all particles in the branching particle system will move
until reaching the frozen state, and still use Ω to denote the collection of the family
history of all frozen particles. Now we need to deﬁne a probability measure Πt,r,k
on Ω, corresponding to the branching process started from state (r, k) at time t.
For the Borel sets Ti ⊂ [0, +∞) (i = 0, 1,··· , n) , Ri ⊂ Rd, Ki ⊂ K (i =
) ∈ T1×R1×K1,··· , (τi1i2···in, ηti1i2···in ) ∈
(cid:90)

1, 2,··· , n) on Ω, let E = {τ0 ∈ T0, (τi1, ηti1
Tn × Rn × Kn}, then the probability of the event E is
dki1 ···

dki1i2···in

dτi1i2···in

Pr(E) =

(cid:90)

(cid:90)

(cid:90)

dτ0 ···

(cid:90)
(cid:90)
× pi1(t, r0, k0; ti1, ri1, ki1) × pi2(ti1, ri1, ki1; ti1i2, ri1i2, ki1i2) × ···
× pin(ti1i2···in−1, ri1i2···in−1, ki1i2···in−1; ti1i2···in, ri1i2···in, ki1i2···in)
× p(ti1i2···in, ri1i2···in; ti1i2···in + τi1i2···in)

dri1i2···in

dri1

(108)
with il ∈ {1, 2, 3} (l = 1, 2,··· , n). Here the transition densities pil and p are given

T0

Tn

R1

K1

Rn

Kn

23

τ0τ2τ1τ21τ22τ23τ231τ232τ233τ3t=Tt=0by

w (r(cid:48), k − k(cid:48)) · 1{k(cid:48)∈K}
p1(t, r, k; t(cid:48), r(cid:48), k(cid:48)) = p(t, r; t(cid:48)) · V −
w (r(cid:48), k − k(cid:48)) · 1{k(cid:48)∈K}
p2(t, r, k; t(cid:48), r(cid:48), k(cid:48)) = p(t, r; t(cid:48)) · V +
p3(t, r, k; t(cid:48), r(cid:48), k(cid:48)) = p(t, r; t(cid:48)) · δ(k − k(cid:48)) · δ(r(cid:48) − r(τ )),

ξ(r(cid:48))

ξ(r(cid:48))

· δ(r(cid:48) − r(τ )),

· δ(r(cid:48) − r(τ )),

(109)

(110)

(111)

p(t, r; t(cid:48)) =

dG(t(cid:48); r, t)

(cid:12)(cid:12)(cid:12)t(cid:48)=t+τ

(112)
where G(t(cid:48); r, t) has been deﬁned in Eq. (79) and the stochastic life time τ = t(cid:48) − t
is chosen according to τ ∝ p(t, r; t(cid:48)). Combining with the independence assumption
in Rule 5, we are able to deﬁne a probability measure Πt,r,k on Ω as follows

dt(cid:48)

,

Πt,r,k(1E) =

1E(ω)Πt,r,k(dω) = Pr(E),

(113)

(cid:90)

Ω

(cid:90)

ΩX

as well as a stochastic branching process (Ω, Πt,r,k). Moreover, from Eq. (108), we
can easily verify the following Markov property of the stochastic process (Ω, Πt,r,k)

Πt,r,k(XY ) =

XΠt+τ,ηt+τ (Y )Πt,r,k(dω)

(114)

for any function X in a measurable space (ΩX,T[t,t+τ ] ⊗ F[t,t+τ ]) and any function
Y in (ΩY ,T[t+τ,+∞) ⊗ F[t+τ,T ]), where TI is the σ-algebra on I ⊂ [0, +∞), FI is the
σ-algebra generated by ηs with s ∈ I, and Ω = ΩX × ΩY . That is, events observable
before and after time t + τ are conditionally independent for given state ηt+τ .
Remark 2. Since ω ∈ Ω corresponds to a denumerable random sequence, the basic
theorem of Kolmogorov (see Theorem 6.16, [33]) ensures the existence and unique-
ness of such a random process (Ω, BΩ, Πt,r,k) with the probability measure Πt,r,k
deﬁned on the Borel extension BΩ of the cylinder sets on Ω [32].

Next we need to deﬁne a random measure µ : (Rd × K, B) → R through the
particle weights and the frozen states, where B ∈ BΩ and BΩ stands for the Borel
cylinder sets on Ω. According to Rule 4, the frozen state of a particle (cid:104)i1i2 ··· in(cid:105) is
(ri1i2···in(T − ti1i2···in), ki1i2···in) with ti1i2···in = t + τ0 + ··· + τi1i2···in−1, and the frozen
state of (cid:104)0(cid:105) is (r0(T − t), k0).
Deﬁnition 4. Suppose (ri, ki) is the starting state of a frozen particle i in a given
family history ω, and let δ(r,k) mean the unit measure concentrated at state (r, k).
Then we deﬁne the exit measure as follows

µ =

φi · δ(ri(T−ti),ki),

(115)

(cid:88)

i∈E(ω)

where φi is the cumulative weight of particle i. For an object i = (cid:104)i1i2 ··· in(cid:105), φi is
given by

φi = φ · ζ(ri1) · ζ(ri1i2)··· ζ(ri1i2···in−1),

(116)

24

where φ is the initial weight of the ancestor and the function ζ(r) has been deﬁned
in Eq. (99). Moreover, for given ω and function A(r, k), we can further deﬁne a
random integral on the point distribution

µA(ω) =

A(r, k)µ(dr × dk, ω) =

φi · A(ri(T − ti), ki).

(117)

(cid:90)

(cid:88)

i∈E(ω)

(cid:90)

To ensure a bounded weight, we require |ζ(r)| ≤ 1 for any r ∈ Rd. The ﬁrst moment
of random function µA(ω) is denoted by ψ(r, k, t) which reads

ψ(r, k, t) = Πt,r,k(µA) =

µA(ω)Πt,r,k(dω).

(118)

Ω

Example 2. Suppose the initial weight φ = 1 at t = 0. For the family history ω
displayed in Fig. 1, the random integral µA(ω) is

µA(ω) = ζ(r1)A(r1(T − τ0), k1) + ζ(r2)ζ(r21)A(r21(T − τ0 − τ2), k21)

+ ζ(r2)ζ(r22)A(r22(T − τ0 − τ2), k22)
+ ζ(r2)ζ(r23)ζ(r231)A(r231(T − τ0 − τ2 − τ23), k231)
+ ζ(r2)ζ(r23)ζ(r232)A(r232(T − τ0 − τ2 − τ23), k232)
+ ζ(r2)ζ(r23)ζ(r233)A(r233(T − τ0 − τ2 − τ23), k233)
+ ζ(r3)A(r3(T − τ0), k3).

(119)

(cid:90)

In order to study the particle number in the branching particle system with the
family history ω starting from time t, we use a random function Z(ω, T − t) to stand
for the total number of frozen particles at the ﬁnal instant T . In consequence, the
ﬁrst moment of Z(ω, T − t) is

M (T − t) =

Z(ω, T − t)Πt,r,k(dω),

(120)

Ω

which also gives the expectation of the total number of alive particles in time interval
[t, T ], and should be ﬁnite (see Theorem 3). This further means that Z(ω, T − t) is
ﬁnite almost surely. As the easier case, the ﬁniteness of M (T − t) for the constant
auxiliary function is directly implied from Theorem 13.1 and its corollary of Chapter
VI in [32].

Theorem 3. Suppose the family history ω starts at time t at state (r, k), and ends
at T . Then M (T − t) < ∞ and as a consequence Pr({Z(ω, T − t) < ∞}) = 1.
Proof. We deﬁne a random function 1i1i2···in(ω) = 1 when the particle (cid:104)i1i2 ··· in(cid:105)
appears in the family history ω, otherwise 1i1i2···in(ω) = 0. From Eq. (113) and
Deﬁnition 3, we have

Πt,r,k(1i1i2···in) =

1i1i2···in(ω)Πt,r,k(dω) = Pr({t+τ0 +···+τi1i2···in−1 < T}). (121)

(cid:90)

Ω

25

Let

¯Z(ω, T − t) = 1 +

∞(cid:88)

3(cid:88)

n=1

i1,··· ,in=1

1i1i2···in(ω),

(122)

that corresponds to the number of particles born up to the ﬁnal time T . It is obvious
that

Z(ω, T − t) ≤ ¯Z(ω, T − t).

For constant γ0, we introduce an exponential distribution

G(t(cid:48)) = 1 − e−γ0(t(cid:48)−t),

t(cid:48) ≥ t,

and deﬁne its n-th convolution by

G0(t(cid:48)) = G(t(cid:48)), Gn(t(cid:48)) =

(cid:90) t(cid:48)

Gn−1(t(cid:48) − u)dG(u).

0

It can be readily veriﬁed that

dG(t(cid:48); r, u)

dt(cid:48)

≤ k
3

· dG(t(cid:48))
dt(cid:48)

, ∀ t(cid:48) ∈ [u, T ], ∀ r ∈ Rd, ∀ u ∈ [0, T ],

(126)

holds for a suﬃciently large integer k, e.g., k > 3eγ0T .

We ﬁrst show by the mathematical induction that there exists a suﬃcient large

integer k and a suﬃcient large constant γ0 > 0 such that
Pr({t + τ0 +··· + τi1i2···in−1 < T − u}) ≤ (

)n−1Gn−1(T − u), ∀u ∈ [0, T − t]. (127)

k
3

(123)

(124)

(125)

(129)

γ(r(s−t))ds

(128)

Pr({t + τ0 < T − u}) =

For n = 1, we only need γ0 ≥ max{γ(r)} and then have
= 1 − e−(cid:82) T−u
≤ 1 − e−γ0(T−u−t) = G0(T − u).
Assume Eq. (127) is true for n. Direct calculation shows

(cid:12)(cid:12)(cid:12)t(cid:48)=T−u

dG(t(cid:48); r, t)

dt(cid:48)

t

=

(cid:90) T−t−u
Pr({t + τ0 + ··· + τi1i2···in < T − u}) = Πt,r,k(1{t+τ0+···+τi1i2···in <T−u})
(cid:90) T−t−u
(cid:90) T−t−u

Πt,r,k(1{t+τ0+···+τi1i2···in−1 <T−u−v}1{τi1i2···in <v})dv
Πt,r,k(1{t+τ0+···+τi1i2···in−1 <T−u−v} · Πσ,ησ (1{τi1i2···in <v}))dv
)n−1Gn−1(T − u − v) · k
3

)nGn(T − u),

dG(v) = (

≤

k
3

k
3

=

(

0

0

0

which implies that Eq. (127) holds for n+1, where σ is short for t+τ0+···+τi1i2···in−1.
(cid:90)

Finally, using Eqs. (121) and (127) yields

∞(cid:88)

3(cid:88)

Πt,r,k(1i1i2···in) ≤ 1 + 3

kn−1Gn−1(T ),

¯Z(ω, T − t)Πt,r,k(dω) = 1 +

Ω

∞(cid:88)

n=1

n=1

i1,··· ,in=1

26

and implies(cid:82)

¯Z(ω, T − t)Πt,r,k(dω) is bounded for the inﬁnite series is convergent
(see Lemma 1 of the Appendix to Chapter VI in [32]). Hence the proof is completed
according to Eq. (123).

Ω

Moreover, according to Deﬁnition 4 and Theorem 3, we can directly show the

L1-convergence of µA, say, (cid:90)

|µA(ω)|Πt,r,k(dω) < ∞,

(130)

Ω

provided that A(r, k) is bounded. That is, both µA in Eq. (117) and ψ in Eq. (118)
are well deﬁned.

After ﬁnishing the above preparations, we begin to answer the questions raised
in the end of Section 5.2. Theorem 4 tries to answer Question 1, while the answer
for Question 2 is given in Theorem 6.

Theorem 4. The ﬁrst moment ψ(r, k, t) deﬁned in Eq. (118) happens to be a solu-
tion of the adjoint equation (77).
Proof. Let E = {τ0 : t + τ0 ≥ T} ∩ Ω correspond to the case in which the particle
travels to (r(T − t), k) and then is frozen. The probability of such event is 1 −
G(T ; r, t) by Rule 4. Then the remaining case is denoted by Ec = {τ0 : t + τ0 < T}∩
Ω. Accordingly, from Eq. (118), we have

(cid:90)

(cid:90)

ψ(r, k, t) =

µA(ω)Πt,r,k(dω) +

µA(ω)Πt,r,k(dω),

(131)

E

Ec

and direct calculation gives

(cid:90)

µA(ω)Πt,r,k(dω) = e−(cid:82) T

t γ(r(s−t))dsA(r(T − t), k),

(132)

E

which recovers the ﬁrst right-hand-side term of Eq. (77). When event Ec occurs, it
indicates that three oﬀsprings are generated. Notice that ω = (Q0; ω1; ω2; ω3) and
thus we have

µA(ω) = φ1 · µA(ω1) + φ2 · µA(ω2) + φ3 · µA(ω3),

= ζ(r(τ0)) · µA(ω1) − ζ(r(τ0)) · µA(ω2) + µA(ω3),

(133)

where we have applied Rule 3 and set the initial weight φ = 1 for simplicity.

Substitute Eq. (133) into the second right-hand-side term of Eq. (131) leads to

µA(ω3)Πt+τ0,r3,k3(dω3)

Πt,r,k(dω),

27

(cid:90)

Ec

µA(ω)Πt,r,k(dω) =

−

+

(cid:26)(cid:90)
(cid:26)(cid:90)

Ω1

Ω2

(cid:90)
(cid:90)
(cid:90)

Ec

Ec

(cid:26)(cid:90)

Ec

Ω3

(cid:27)
(cid:27)

(cid:27)

ζ(r(τ0))

µA(ω1)Πt+τ0,r1,k1(dω1)

ζ(r(τ0))

µA(ω2)Πt+τ0,r2,k2(dω2)

Πt,r,k(dω)

Πt,r,k(dω)

(134)

Ωi

(cid:90)

(cid:90)

(cid:90)

(cid:90)

Ec

×

where we have used the Markov property (114) as well as the mutual independence
among the subfamilies inherited in Rule 5.
Finally, by the deﬁnition (118), we have

µA(ωi)Πt+τ0,ri,ki(dωi) = ψ(ri, ki, t + τ0),

i = 1, 2, 3.

(135)

(cid:90) T

dt1e−(cid:82) t1

Then the ﬁrst right-hand-side term of Eq. (134) becomes

ζ(r(τ0))ψ(r1, k1, t + τ0)Πt,r,k(dω) =

(cid:8)V −
w (r(t1 − t), k − k1) · δ(r(t1 − t) − r1)(cid:9) ψ(r1, k1, t1),

t γ(r(s−t))ds

t

dr1

dk1

K

Rd

(136)

where we have let t + τ0 → t1 and used Eqs. (99) and (109). The other two right-
hand-side term of Eq. (134) terms can be treated in a similar way, and putting them
together recovers the second right-hand-side term of Eq. (77). We complete the
proof.

For the adjoint equation (77), we have proven the existence of the solution, while
its uniqueness can be deduced by the Fredholm alternative. It remains to validate
the convergence of Eq. (104). To this end, we let ν be a probability measure on the
Borel sets of Rd × K with the density fI(r, k, tl), then it yields a unique product
measure ν ⊗ Πt,r,k. Consequently, from Eq. (92), we obtain

(cid:104)A(cid:105)tl+1 ≈

ϕ(r, k, tl) · fS(r, k, tl)
fI(r, k, tl)

(cid:20)(cid:90)

Rd×K

Rd×K

(cid:90)(cid:90)
(cid:90)(cid:90)
(cid:90)(cid:90)
≈(cid:88)

=

=

Ω

µA(ω)Πtl,r,k(dω)
µA(ω) · fS(r, k, tl)
fI(r, k, tl)

(cid:88)

Rd×K×Ω
µA(ωα) · wα(tl) =

α

α

i∈E(ωα)

· fS(r, k, tl)
fI(r, k, tl)

· fI(r, k, tl)drdk

(cid:21)
(cid:88)
· ν ⊗ Πtl,r,k(dr × dk × dω)
φi,α · A(ri,α, ki,α) · wα(tl),

· ν(dr × dk)

(137)

and thus fully recover the approximation (104) (implying both Eα and E(ωα) denote
the same set), where Theorem 4 and Eq. (117) are applied in the second and fourth
lines, respectively. Here Nα independent samples (rα, kα, ωα) are generated from the
product measure ν ⊗ Πtl,r,k, and ωα stands for the family history with ancestor at
time tl at state (rα, kα). From the L1-convergence of µA in Eq. (130) and the strong
law of large number in Eq. (91), we know that the approximation (104) converges
almost surely when Nα → ∞, thus give a positive answer for Question 1.
In particular, we set t = 0, φ = 1, A(r, k) ≡ 1, and then it can be veriﬁed that
ϕ(r, k, t) ≡ 1 is the unique solution of Eq. (77) using the mass conservation (19).
By Theorem 4, the ﬁrst moment of µA also equals to 1, i.e.,

1 ≡ ϕ(r, k, 0) =

µA(ω) · Π0,r,k(dω) =

φi · Π0,r,k(dω),

(138)

(cid:90)

(cid:90)

(cid:88)

Ω

i∈E(ω)

Ω

28

(cid:90)

(cid:90)

K

and then it further implies

dk f (x, k, T ) = (cid:104)A(cid:105)T =

dr

dk f (r, k, 0),

∀ T ≥ 0,

(139)

Rd

Rd

Furthermore, for such special case, we can show below that(cid:80)

due to Eqs. (57) and (70), which is nothing but the mass conservation law (20).
i∈E(ω) φi = 1 is almost
sure for any family history ω, not just the ﬁrst moment as shown in Eq. (138). That
is, the estimator (104) using ﬁnite number of super-particles is still able to preserve
the mass conservation with probability 1, say,

(cid:90)

dx

K

(cid:90)

(cid:90)

µA(ωα) · wα(tl) =

wα(tl) = 1, a.s.

(140)

Theorem 5 (Mass conservation). Suppose the weight of ancestor particle is φ = 1.
Then we have

Rd×K

f (r, k, tl+1)drdk ≈(cid:88)
(cid:90)

α

(cid:88)

α

Pr(E) =

1E(ω)Π0,r,k(dω) = 1,

where the event E is given by

Ω

E = {ω ∈ Ω :

(cid:88)

i∈E(ω)

φi = 1}.

Proof. Since Z(ω, T − t) only takes odd values, it suﬃces to take
φi = 1; Z(ω, T − t) ≤ 2n + 1},

(cid:88)

En = {ω ∈ Ω :
n = {ω ∈ Ω : Z(ω, T − t) ≤ 2n + 1},
E∗

i∈E(ω)

(141)

(142)

(143)

(144)

(145)

(146)

(147)

and it is easy to see Pr(E0) = Pr(E∗
0 ). In the remaining part of the proof, we will
omit ω ∈ Ω for brevity. Assume that the statement that Pr(Ek) = Pr(E∗
k) is true
for 0 ≤ k ≤ n, ∀t ∈ [0, T ]. We show below by the mathematical induction that it
still holds for k = n + 1.

From ω = (Q0; ω1; ω2; ω3), it can be easily veriﬁed that
Z(ω, T − t) = Z(ω1, T − t − τ0) + Z(ω2, T − t − τ0) + Z(ω3, T − t − τ0)

thus we have

implying

Furthermore, since(cid:88)

Z(ωl, T − t − τ0) < Z(ω, T − t), ∀ l ∈ {1, 2, 3},

n+1 ⊂ {Z(ωl, T − t − τ0) ≤ 2n + 1}, ∀ l ∈ {1, 2, 3}.
E∗

(cid:88)

φi − (cid:88)

(cid:88)

φi = φ(r(τ0)) · [

i∈E(ω)

i∈E(ω1)

i∈E(ω2)

i∈E(ω3)

φi] +

φi,

(148)

29

Combining Eqs. (147) and (149) with the conditionally independence of ωl yields

i∈E(ω)

l=1

i∈E(ωl)

φi = 1}.

3(cid:92)
{ (cid:88)
φi = 1} ⊂ {(cid:88)
3(cid:92)
3(cid:89)
{ (cid:88)
φi = 1}(cid:12)(cid:12)E∗
φi = 1}(cid:12)(cid:12)E∗
Pr({ (cid:88)
φi = 1}(cid:12)(cid:12){Z(ωl, T − t − τ0) ≤ 2n + 1} ∩ E∗

Pr({ (cid:88)

n+1) =

l=1

i∈E(ωl)

i∈E(ωl)

l=1

n+1)

n+1)

i∈E(ωl)

(149)

we obtain

Pr(En+1)
Pr(E∗
n+1)

≥ Pr(

3(cid:89)

=

l=1

= 1,

where the induction hypothesis is applied in the last line, and thus Pr(En+1) ≥
n+1) for it is obvious that Pr(En+1) ≤
Pr(E∗
Pr(E∗

n+1). Accordingly, we have Pr(En+1) = Pr(E∗
n+1).
Finally, according to the fact that E0 ⊂ E1 ⊂ ··· En ⊂ En+1 ··· ⊂ E, we have

Pr(E) = lim

n→+∞ Pr(En) = 1,

(150)

due to the monotone convergence theorem. Hence we complete the proof by setting
t = 0.

In the proof of Theorem 5, the latent assumption, namely, two particles carrying
the same weight but opposite sign must be generated in pair, is required to conserve
numerically the mass.
Now we turn to Question 2. For the constant auxiliary function γ(r) ≡ γ0, the
random life-length τ of a particle starting at time t is characterized by an exponential
distribution

G(t(cid:48)) = Pr(τ < t(cid:48) − t) = 1 − e−γ0(t(cid:48)−t),

t(cid:48) ≥ t.

(151)

In this case, the growth of particle number has been thoroughly studied in the
literature and we are able to obtain a simple calculation formula of the particle
number as shown in Theorem 6.

Theorem 6. Suppose the family history ω starts at t = 0 and the constant auxiliary
function γ(r) ≡ γ0 is adopted. Then the expectation of the total number of frozen
particles in time interval [0, T ] is

(152)
Proof. According to Theorem 15.1 of Chapter VI in [32], the expectation M (t(cid:48))
satisﬁes the following renewal integral equation

M (T ) = e2γ0T .

M (t(cid:48)) = 1 − G(t(cid:48)) + 3

M (t(cid:48) − u)dG(u), M (0) = 1.

(153)

We substitute Eq. (151) into Eq. (153) and then can easily verify that M (t(cid:48)) = e2γ0t(cid:48)
is the solution. The proof is ﬁnished.

0

30

(cid:90) t(cid:48)

However, a direct estimate of number of frozen particles for a general auxiliary
function γ(r) is still unknown in theory.
In numerical simulations, Theorem 6
provides an upper bound of M (T ) when the variable auxiliary function satisﬁes
γ(r) ≤ γ0. Whatever the auxiliary function is, it is clear that the particle number
will grow exponentially. To suppress the particle number, we can either decrease the
parameter γ0 or choose a smaller ﬁnal time T . Theorem 6 also guides us on how to
estimate the memory requirement for given γ0 and T in practice.

Finally, suppose we would like to evolve the branching particle system until the
ﬁnal time T . Usually, there are two ways. One is to evolve the system until each
particle is frozen at the ﬁnal time T in a single step. The other is to divide T into
0 = t0 < t1 < ··· < tn−1 < tn = T with tn = n∆t, and then we evolve the system
successively in n steps. However, the following theorem tells us that both produce
the same M (T ).
Theorem 7 (Theorem 11.1 of Chapter VI in [32]). Suppose G(t) = 1− e−γ0t. Then
Z(ω, t) is a Markov branching process. In addition, Z(ω, ∆t), Z(ω, 2∆t),···
is a
Galton-Watson process.

We recall that for a Galton-Watson model, if M (∆t) = β, then M (n∆t) = βn.
From Eq. (152), we know that β = e2γ0∆t, so that M (n∆t) = e2γ0T . Therefore, we
cannot expect to reduce the particle number by simply dividing T into several steps
and evolve the particle system successively, which also manifests the indispensability
of the resampling (or annihilation) procedure.

6 Numerical treatments

We turn to discuss the numerical aspects. The whole picture has been described
in Section 5.2, so we only need to clarify several key treatments in numerical sim-
ulations. In this work, as an example, our numerical experiments focus on a one
dimensional problem, where length, time and energy are measured in nanometer
(nm), femtosecond (fs) and electron volt (eV), respectively. The potential function
V (x) is chosen as the Gaussian barrier

V (x) = HB exp

,

(154)

(cid:20)

−(x − xB)2

2

(cid:21)

where HB and xB are the barrier height and the barrier center, respectively. From
Eq. (21), we can readily obtain the explicit expression of corresponding Wigner
kernel

Vw(x, k) =

2HB


e−2k2 sin(2k(x − xB)).

(155)

6.1 Computing the normalization factor ξ(x)

For k-truncated Wigner equation, the normalization factor ξ(x) is given by

ξ(x) =

V +
w (x, k)dk.

(156)

(cid:114) 2

π

(cid:90)

2K

31

Figure 2: The normalization factor ξ(x) for the Gaussian barrier (154) with HB = 0.3eV
and xB = 30nm is utilized in the k-truncated Wigner simulations.

(cid:113) 2

In general, the calculation of ξ(x) and sampling from V +
w (x, k)/ξ(x) can be realized
simultaneously, say, we can calculate the normalization factor through sampling. In
e−2k2 in Eq. (155) is the probability density of the normal
this case, we ﬁnd that
distribution N (0, 1/2), which provides an eﬃcient way to calculate the integral. In
actual simulations, the number of samples are chosen as 2 × 108 for each x, and the
numerical ξ(x) is shown in Fig. 2 for HB = 0.3eV and xB = 30nm. We ﬁnd there
that the normalization factor has a sharp decrease around x = 30, whereas it is very
ﬂat outside the neighborhood of x = 30.

π

For the y-truncated model, the computation of ξ(x) is relatively easier since it
only involves the summation of discrete samples, while the modiﬁed Wigner kernel
˜Vw(x, k) in Eq. (27) can be approximated by the rectangular formula. A similar
proﬁle to that shown in Fig. 2 is also observed.

6.2 Choosing the auxiliary function γ(r)

To randomly choose the lifetime of each particle, we need to choose the auxiliary
function γ(r). The original signed particle Wigner Monte Carlo method employs
[22, 28]

(cid:90)

2K

(cid:12)(cid:12)(cid:12)t(cid:48)=t0+τ

τ ∝ dG(t(cid:48); r, t0)

dt(cid:48)

32

γ(r) = ξ(r) =

V +
w (r, k)dk,

(157)

with which the cumulative weight of particle i deﬁned in Eq. (116) can only take
±1, i.e., φi ∈ {−1, 1}. This choice may facilitate the understanding of the particle
model. However, we will show below that it may not be a good choice for numerical
applications.

The main problem lies in the generation of a random life-length for each particle.

Recall that the lifetime of each particle, initially at time t0, satisﬁes

.

(158)

01020304050600.050.10.150.20.250.3xξ(x)To draw samples from such a distribution, we can generate a random number R
from U [0, 1] such that

R = G(t0 + τ ; r, t0),

and then a simple calculation yields

(cid:90) t0+τ

γ(r(s − t0))ds = − ln(1 − R).

t0

However, it is entirely not trivial to solve Eq. (160) for τ . To this end, we always
have to use an approximation like [22, 28]

and thus

γ(r(s − t0)) ≈ γ(r),
τ ≈ −ln(1 − R)

.

γ(r)

(161)

(162)

Usually, the approximation (161) is reasonable when γ(r) = ξ(r) is very ﬂat. But,
for example, around the neighborhood of x = 30nm as shown in Fig. 2, such ap-
proximation may be too rough to be used and will give rise to additional numerical
errors. By contrast, when choosing the constant auxiliary function γ(r) ≡ γ0, the
life-length τ of each particle turns out to be

τ = −ln(1 − R)

γ0

.

Meanwhile, it is also required that

γ0 ≥ ˇξ := max

r

ξ(r)

(163)

(164)

to ensure the boundedness of the cumulative weights (see Deﬁnition 4) as well as
the L1-convergence of µA in Eq. (130).

6.3 Sampling in the continuous k-space

The sampling in the discrete k-space is relatively simple, so we only focus on the
sampling in the continuous k-space here. For the one-dimensional Gaussian barrier
test, it can be achieved by the rejection sampling for we have the following estimate

(159)

(160)

(cid:114) 2

π

w (x, k) ≤ 2H
V +

 h(k) and h(k) =

e−2k2,

(165)

from Eq. (155). Here h(k) is nothing but the normal probability density. We apply
the following procedure:

1. Draw a sample k from h(k) and compute the ratio

α =


2H

V +
w (x, k)
h(k)

≤ 1;

33

2. Generate a random number R from U [0, 1]. If R < α, accept k; otherwise,

reject it and go back to the above step.

In this manner, the accepted samples will follow the target distribution V +

w (x, k)/ξ(x).
For high dimensional problems, the direct rejection sampling is not very eﬃcient.
So we need to resort to the Metropolis sampling or the Gibbs sampling and use a
Markov chain to approximate the target distribution.

6.4 Resampling

As stated in Theorem 6, the particle number in the branching process will grow
exponentially and may soon exceed the computational capacity. For example, when
we draw O(Nα) samples according to the instrumental distribution fI(r, k, tl), then
the number of frozen particles at tl+1 is about O(Nα · e2γ0(tl+1−tl)). However, after
applying the resampling procedure, we only need to record the updated instrumental
distribution fI(r, k, tl+1) and draw O(Nα) new samples from it, without storing
O(Nα · e2γ0(tl+1−tl)) super-particles. In this way, the resampling procedure sharply
reduces the memory requirement for the data storage.

7 Numerical experiments

We now report a detailed description of numerical experiments performed for sim-
ulating the interaction dynamics of one-dimensional one-body Gaussian wavepacket
with the Gaussian barrier potential (154). By setting the SEM solution with a
ﬁne mesh as the reference like we did in [23], we will compare the performance of
the k-truncated (see Eq. (16), the model parameter is ∆y) and y-truncated (see
Eq. (30), the model parameter is ∆k) branching particle models, both of which can
be regarded as approximations of the same Wigner equation in the unbounded do-
main. Comparable results are expected on the same footing because both Gaussian
wavepacket and Gaussian barrier possess a very nice localized structure. It should
be noted that the results for the k-truncated Wigner branching process are reported
here for the ﬁrst time. Moreover, we want to verify the theoretical predictions as
we discussed earlier, such as the eﬀect of constant γ0, the increasing behavior of the
particle number, as well as the eﬀect of the time step and the annihilation frequency.
We employ the relative L2 error to study the accuracy. Let f ref(x, k, t) denote the
reference Wigner function (wf) which could be the exact solution or the numerical
solution on a relatively ﬁne mesh, and f num(x, k, t) the numerical solution. Then,
the relative errors are written as

(cid:82)
(cid:82)

errwf (t) = (

X×K(∆f (x, k, t))2dxdk
X×K(f ref(x, k, t))2dxdk

1

2 ,

)

(166)

where ∆f (x, k, t) = |f num(x, k, t)−f ref(x, k, t)|, and the integrals above are evaluated

34

using a simple rectangular rule over a uniform mesh
xmax − xmin

xi = xmin + (i − 1/2)∆x, ∆x =
kj = kmin + (j − 1)∆k, ∆k =

200
kmax − kmin

400

i = 1, 2,··· , 200,

,

j = 1, 2,··· , 400.

,

(167)

In order to obtain a more complete view of the accuracy, we also measure corre-
sponding relative errors for physical quantities, e.g. the spatial marginal (sm) prob-
ability distribution and the momental marginal (mm) probability distribution in a
similar way, denoted by errsm(t) and errmm(t), respectively. For the k-truncated
branching particle model, we set the model parameter ∆y = 0.6nm and thus
the computational domain in the k-space K = [kmin, kmax] = [−π/∆y, π/∆y] ≈
[−5.2360nm−1, 5.2360nm−1] due to the constraint (23), and the mesh given in Eq. (167)
is adopted to calculate the Wigner function. In order to put the comparison on the
same footing, we use the same mesh for the y-truncated branching particle model,
implying that the y-domain turns out to be Y = [−π/∆k, π/∆k] = [−200∆y, 200∆y].
This y-domain is large enough to provide highly accurate calculation of the Wigner
potential for Gaussian barriers with the height H = 0.3eV and 1.3eV when using
the Poisson summation formula [19]. For both models, we further set the x-domain
to be X = [xmin, xmax] = [0nm, 60nm]. The reference solutions by SEM are ob-
tained with 10 × 20 non-overlapping elements as well as a uniform mesh composed
of 31 × 30 collocation points on each element. The spectral accuracy of these refer-
ence solutions was well demonstrated in [19, 23] and more details can be also found
there.

The motion of a Gaussian wavepacket [12, 19] is simulated to investigate the
performance of the branching processes for time-dependent Wigner equation (7).
The Gaussian wavepacket in the free space is

f (x, k, t) =

(cid:20)
(cid:21)
−(x − x0 − v0t)2
(cid:40)
(cid:20)
(k − k0) − βt(x − x0 − v0t)

2a2(1 + β2t2)
−2a2(1 + β2t2)

2a2(1 + β2t2)

exp

1
π
× exp

(cid:21)2(cid:41)

,

(168)

0



k0
m is the
where x0 is the center at t = 0, a is the minimum position spread, v0 =
2ma2 . The kinetic energy of such Gaussian wavepacket
average velocity, and β =
2k2
is E0 =
2m . Actually, the Gaussian wavepacket (168) is the analytical solution to
the Wigner equation without a Wigner potential [12]. In the following numerical
simulations, we take a = 2.825nm, m = 0.0665me with me being the eﬀective mass
of electron, x0 = 15nm, k0 = 0.7nm−1 (i.e., E0 ≈ 0.2807eV), and the ﬁnal time
tf in = 20fs.

Once the Wigner branching process starts, the number of particles increases
exponentially with time, thus necessary annihilation operations are required to make
the simulation go on well, though they are not inherited in the branching process
from the theoretical point of view.
In this work, we do such annihilations at a

35

constant frequency, say 1/TA. That is, we divide equally the time interval [0, tf in]
into nA subintervals with the partition being

0 = t0 < t1 < t2 < ··· < tnA = tf in, nA = tf in/TA.

The annihilations occur exactly at the time instant ti for 1 ≤ i ≤ nA−1, at which the
particle number decreases signiﬁcantly from #b
P (resp. #a
P )
represents the particle number before (resp. after) the annihilation. For convenience,
we denote the particle number at t0 and tnA by #a
P (tnA), respectively.
In each time period [ti−1, ti], the particle number increases from #a
P (ti)
and corresponding multiple is denoted by

P (ti−1) to #b

P (t0) and #b

P (ti) to #a

P (ti), where #b

Mi = #b

P (ti)/#a

P (ti−1).

(169)

For the k-truncated Wigner branching particle model with constant auxiliary func-
tion γ(x) ≡ γ0, it has been proved in Theorem 6 that such increasing multiple only
depends on the time increment TA and γ0, which means the same increasing mul-
tiple exists for each time period, i.e., Mi ≡ e2γ0TA for any i ∈ {1, 2,··· , nA}. We
will verify this theoretical prediction in the following numerical simulations, during
which the initial particle number is ﬁxed to be #a

P (t0) = 1641810 as did in [23].

All the numerical results are obtained with our own serial Fortran implementa-
tions of the Wigner branching processes as well as SEM on the computing platform:
Dell Poweredge R820 with 4× Intel Xeon processor E5-4620 (2.2 GHz, 16 MB Cache,
7.2 GT/s QPI Speed, 8 Cores, 16 Threads) and 256GB memory. A ﬁxed time step
∆t is applied and then the total number of time steps becomes

n = tf in/∆t.

When the branching process evolves from tj−1 = (j−1)∆t to tj = j∆t for 1 ≤ j ≤ n,
particle oﬀspring will be generated.
• Experiment 1 To be convenient for comparison, we ﬁrst take the same exper-
iment as utilized before in [23], in which the barrier height is set to be H = 0.3eV
so that the Gaussian wavepacket will be partially reﬂected. Such partial reﬂection
is clearly shown in Fig. 3. Five groups of tests with diﬀerent time steps and anni-
hilation frequencies are performed and related data are displayed in Table 1, from
which we are able to ﬁnd several observations below concerning the accuracy.
(1) The idea of choosing constant auxiliary function γ(x) ≡ γ0 works very well. As
we expected, with the same ∆t and TA, the larger value γ0 takes, the more ac-
curate solution we obtain, though more running time it spends. Interestingly,
both accuracy and eﬃciency of the model with γ(x) = ξ(x) are very close to
those of the model with γ(x) ≡ ˇξ, where ˇξ = maxx∈X ξ(x). This also justiﬁes
the proposed mathematical framework, the algorithm of branching process as
well as the implementation in some sense.

(2) Highly frequent annihilation operations, e.g., TA = 0.1fs, destroy the accuracy,
even larger constant auxiliary function cannot save it. But this does not mean

36

a low annihilation frequency should be appreciated. Actually, when using
TA = 4fs, the accuracy becomes worse than that using TA = 1fs or 2fs, which
may be due to the accumulated numerical errors, such as the variance. That
is, as we mentioned before, the annihilation adopted here is nothing but a
kind of resampling to keep the mean value, and thus possibly suppresses some
random noises.

(3) While using the same annihilation frequency, say TA = 1fs, smaller time step,
e.g., ∆t = 0.008fs, cannot improve the accuracy, as predicted by Theorem 7. In
fact, the accuracy with ∆t = 0.008fs is almost identical to that with ∆t = 1fs.
But the former takes much more running time than the latter. Moreover, too
small time steps will signiﬁcantly reduce the probability of branching, which is
crucial to capture the quantum information in stochastic Wigner simulations,
so that nearly all particles do ﬁeld-less travel in phase space. This point has
been also mentioned in [23] when choosing the time step.

Next we focus on the eﬃciency. One of the main variables shaping the eﬃciency
is the particle number. Since the same initial particle distribution is employed for all
runs, we only need to consider the growth rate of particle number. Once choosing the
constant auxiliary function γ0 and the annihilation frequency 1/TA, the increasing
multiple of particle number can be exactly determined by e2γ0TA from Theorem 6,
and the eighth column of Table 1 shows corresponding theoretical predictions. In our
numerical simulations, within every annihilation period [ti−1, ti] with 1 ≤ i ≤ nA,
we record the starting particle number #a
P (ti),
and the related growth rate Mi in Eq. (169). Let

P (ti−1), the ending particle number #b

nA(cid:88)

i=1

ˇ#a

P = max

0≤i≤nA−1

{#a

P (ti)},

ˇ#b

P = max
1≤i≤nA

{#b

P (ti)}, M =

1
nA

Mi.

Table 1 gives numerical values of above three quantities, see the ﬁfth, sixth and
seventh columns. According to Table 1, we can ﬁgure out the following facts on the
eﬃciency.

(1) Agreement between the mean value M and the theoretical prediction e2γ0TA
is readily seen in all situations. Actually, the growth rates in the ﬁrst ﬁve
annihilation periods, e.g. for TA = 1fs and γ0 = 3 ˇξ, are 5.92, 5.87, 5.88, 5.89,
and 5.88, all of which are almost identical to the mean value of 5.89. When
TA = 1, 2, 4fs, the former is a little less than the latter, because the particles
moving outside the computational domain X × K are not taken into account.
Within each annihilation period, the maximum travel distance of particles can
be calculated by


m

· max
k∈K {|k|} · TA,

implying that, the larger value TA is, the more particles move outside the
domain. This explains the slight deviation between M and e2γ0TA increases
from almost zero to at most 1.33 as TA increases from 0.1fs to 4fs. Moreover,

37

when TA = 1fs, the increasing multiples for ∆t = 0.008fs are identical to
those for ∆t = 1fs, i.e., M is independent of ∆t, which has been also already
predicted by the theoretical analysis. More details about the agreement of the
growth rates of particle number with the theoretical prediction for TA = 1fs
and ∆t = 0.008fs can be found in Fig. 4.

(2) Not like using the constant auxiliary function, we do not have a simple cal-
culation formula so far for the growth rate of particle number when using
the variable auxiliary function (i.e., depending both on time and trajectories).
However, we can still utilize the growth rate for the case of γ0 = ˇξ to provide a
close upper bound for the case of γ(x) = ξ(x). As shown in the seventh column
of Table 1, the variation of the mean growth rate between them is about 0,
0.03, 0.12 and 0.74 for TA = 0.1fs, 1fs, 2fs and 4fs, respectively. Fig. 4 further
compares the curves of growth rate for TA = 1fs and ∆t = 0.008fs within
four typical annihilation periods. By comparing with the Wigner functions
shown in Fig. 3, we ﬁnd that the closer to the center the Gaussian wavepacket
lives, the larger the deviation between the curves for the constant and variable
auxiliary functions becomes. Such deviation in accordance with the analysis
of ξ(x) shown in Fig. 2 (see Section 6.1) validates the proposed mathematical
theory again.

(3) During the resampling (annihilation) procedure, the main objective is to re-
construct the Wigner distribution using less particles, which explores the can-
celation of the weights with opposite signs, see Eq. (90). The sixth column
of Table 1 tells us that the maximum particle numbers after resampling for
TA = 1, 2, 4fs are all around 3.00 million, implying that there should be a min-
imal requirement of particle number to achieve a comparable accuracy. Other-
wise, the accuracy will decrease, for example, the values of ˇ#a
P for TA = 0.1fs
are around 2.55 million. Fig. 5 shows more clearly the typical history of #a
P (t).
We can ﬁnd there that, no matter how huge the particle number before the
annihilation #b
P (t) (which depends on both γ(x) and TA) is, the particle num-
ber after the annihilation #a
P (t) for the simulations with comparable accuracy
exhibits almost the same behavior, which recovers and extends the so-called
“bottom line” structure described in [23]. Such behavior may depend only on
the oscillating structure of the Wigner function. On the other hand, highly
frequent annihilations like TA = 0.1fs destroy this bottom line structure and
thus the accuracy, see Fig. 5(b), implying that there are no enough particles
to capture the oscillating nature.

As we expected, all above observations can also be found in integrating the y-
truncated Wigner branching model, and thus the detailed discussion is skipped here
for saving the space. But many researchers in the literature are still working on the
model, so we would also like to provide the running data in Table 2 for their possible
reference.
• Experiment 2 In this example, we increase the barrier height to H = 1.3eV
so that the Gaussian wavepacket will be totally reﬂected, see Fig. 6. Such augment

38

of the barrier height implies that the growth rate of particle number now is about
1.3/0.3 ≈ 4.33 times larger than that for Experiment 1, and thus it is more diﬃcult
to simulate accurately. Based on the observations in Experiment 1, we only test
two groups of annihilation periods, TA = 0.1, 1fs, using the k-truncated Wigner
branching process. Table 3 summarizes the running data and conﬁrms again that,
the larger constant auxiliary function improves the accuracy, whereas the higher
annihilation frequency destroies the accuracy. In order to get a more clear picture
on this accuracy issue, we plot both spatial and momental probability distributions
at diﬀerent time instants t = 5, 20, 15, 20fs in Figs. 7 and 8 against the reference
solutions by SEM. We can easily see there that, the loss of accuracy when using
TA = 0.1fs is mainly due to that there are no enough generated particles to capture
the peaks reﬂecting oﬀ the barrier; while the increase of accuracy when using a
larger constant auxiliary function, e.g., γ0 = 2 ˇξ, comes from the smaller variation.
Actually, similar phenomena also occur in Experiment 1.

8 Conclusion and discussion

In this work, we have established a sound mathematical framework for the
Wigner branching process, which provides a probabilistic approach to the Wigner
equation in theory, as well as yielding an eﬃcient numerical method. We intro-
duced a branching particle system associated with an exit system to depict the
Wigner branching process in picturesque language, and exploited its theoretical
background, namely, the solution of the Wigner equation or its adjoint equation is
equivalent to the ﬁrst moment of a stochastic branching process. Furthermore, when
the life-length of super-particles is characterized by an exponential distribution with
a constant parameter γ0, we showed that the growth rate of particle number is ex-
pected to be e2γ0t for a given time t, thereby providing a simple but rather reliable
criterion to suppress the particle number in the simulations. Through typical nu-
merical experiments, we demonstrated the feasibility of sampling in the continuous
k-space, that also validates the k-truncated Wigner branching process, as well as
the numerical accuracy of the proposed algorithms.

We would like to discuss the following topics in our future work.
• So far we have restricted our discussion on the ﬁrst moment of the stochastic
branching process, while the second moment is also very important as it is
related to the variance, that also characterizes the numerical accuracy. In order
to suppress the random noise more eﬃciently, it is necessary to thoroughly
analyze the variance of the Wigner branching process.

• We have found in the simulations that when the Wigner function becomes
more oscillating in the phase space, it requires more super-particles to capture
the oscillating structure. Therefore, we would like to discuss the sophisticated
techniques to adjust the distribution of particles adaptively, aiming at striking
a balance between accuracy and eﬃciency.

39

• Moreover, we are urged to use the Wigner branching process to study many-
body quantum systems, e.g., the Coulomb system where the Hamiltonian is
given by the Hartree approximation. We expect to combine several advanced
statistical techniques, such as an eﬃcient Gibbs sampling and high dimensional
clustering, in simulating the fully quantum many-body dynamics.

Acknowledgement

This research was supported by grants from the National Natural Science Foun-
dation of China (Nos. 11471025, 91330110, 11421101). The authors are grateful to
the useful discussions with Zhenzhu Chen, Mihail Nedjalkov and Jean Michel Sellier
on the signed particle Monte Carlo method for the y-truncated Wigner equation.

References

[1] J. L. Doob. Classical Potential Theory and Its Probabilistic Counterpart.

Springer-Verlag, Berlin, reprint edition, 2001.

[2] E. B. Dynkin. Diﬀusions, Superdiﬀusions and Partial Diﬀerential Equations.

American Mathematical Society, 2002.

[3] M. Nedjalkov and P. Vitanov. Application of the iteration approach to the

ensemble Monte Carlo technique. Solid-State Electron., 33:407–410, 1990.

[4] C. Yan, W. Cai, and X. Zeng. A parallel method for solving Laplace equations
with Dirichlet data using local boundary integral equations and random walks.
SIAM J. Sci. Comput., 35:B868–B889, 2013.

[5] M. Hairer and J. Weare. Improved diﬀusion Monte Carlo. Commun. Pure Appl.

Math., 67:1995–2021, 2014.

[6] E. Wigner. On the quantum corrections for thermodynamic equilibrium. Phys.

Rev., 40:749–759, 1932.

[7] V. I. Tatarski˘ı. The Wigner representation of quantum mechanics. Sov. Phys.

Usp, 26:311–327, 1983.

[8] W. H. Zurek. Decoherence and the transition from quantum to classical. Phys.

Today, October:36–44, 1991.

[9] C. Jacoboni and P. Bordone. The Wigner-function approach to non-equilibrium

electron transport. Rep. Prog. Phys., 67:1033–1071, 2004.

[10] N. C. Dias and J. N. Prata. Admissible states in quantum phase space. Ann.

Phys., 313:110–146, 2004.

40

[11] P. A. Markowich, C. A. Ringhofer, and C. Schmeiser. Semiconductor Equations.

Springer-Verlag, Wien-New York, 1990.

[12] B. A. Biegel. Quantum Electronic Device Simulation. PhD thesis, Stanford

University, 1997.

[13] R. Balescu. Equilibrium and Nonequilibrium Statistical Mechanics. John Wiley

& Sons, New York, 1975.

[14] W. P. Schleich. Quantum Optics in Phase Space. Wiley-VCH, Berlin, 2011.

[15] J. M. Sellier, M. Nedjalkov, and I. Dimov. An introduction to applied quantum
mechanics in the Wigner Monte Carlo formalism. Phys. Rep., 577:1–34, 2015.

[16] U. Leonhardt. Measuring the Quantum State of Light. Cambridge University

Press, New York, 1997.

[17] D. Leibfried, T. Pfau, and C. Monroe. Shadows and mirrors: Reconstructing

quantum states of atom motion. Phys. Today, April:22–28, 1998.

[18] C. Zachos. Deformation quantization: quantum mechanics lives and works in

phase-space. Int. J. Mod. Phys. A, 17:297–316, 2002.

[19] S. Shao, T. Lu, and W. Cai. Adaptive conservative cell average spectral ele-
ment methods for transient Wigner equation in quantum transport. Commun.
Comput. Phys., 9:711–739, 2011.

[20] Y. Xiong, Z. Chen, and S. Shao. An advective-spectral-mixed method for time-
dependent many-body Wigner simulations. Submitted, 2015 [arXiv:1602.08853].

[21] D. Querlioz and P. Dollfus. The Wigner Monte Carlo Method for Nanoelec-
tronic Devices: A Particle Description of Quantum Transport and Decoherence.
Wiley-ISTE, London, 2010.

[22] J. M. Sellier, M. Nedjalkov, I. Dimov, and S. Selberherr. A benchmark study of
the Wigner Monte-Carlo method. Monte Carlo Methods Appl., 20:43–51, 2014.

[23] S. Shao and J. M. Sellier. Comparison of deterministic and stochastic methods
for time-dependent Wigner simulations. J. Comput. Phys., 300:167–185, 2015.

[24] L. Shifren and D. K. Ferry. Particle Monte Carlo simulation of Wigner function

tunneling. Phys. Lett. A, 285:217–221, 2001.

[25] L. Shifren and D. K. Ferry. A wigner function based ensemble monte carlo
approach for accurate incorporation of quantum eﬀects in device simulation. J.
Comput. Electron., 1:55–58, 2002.

[26] L. Shifren, C. Ringhofer, and D. K. Ferry. A Wigner function-based quan-
tum ensemble Monte Carlo study of a resonant tunneling diode. IEEE Trans.
Electron Devices, 50:769–773, 2003.

41

[27] M. Nedjalkov, H. Kosina, S. Selberherr, C. Ringhofer, and D. K. Ferry. Uni-
ﬁed particle approach to Wigner-Boltzmann transport in small semiconductor
devices. Phys. Rev. B, 70:115319, 2004.

[28] M. Nedjalkov, P. Schwaha, S. Selberherr, J. M. Sellier, and D. Vasileska.
Wigner quasi-particle attributes – An asymptotic perspective. Appl. Phys.
Lett., 102:163113, 2013.

[29] H. Jiang, W. Cai, and R. Tsu. Accuracy of the Frensley inﬂow boundary
condition for Wigner equations in simulating resonant tunneling diodes. J.
Comput. Phys., 230:2031–2044, 2011.

[30] A. Pazy. Semigroups of Linear Operators and Applications to Partial Diﬀeren-

tial Equations. Springer-Verlag, New York, 1983.

[31] I. Dimov, M. Nedjalkov, J. M. Sellier, and S. Selberherr. Boundary conditions

and the Wigner equation solution. J. Comput. Electron., 14:859–863, 2015.

[32] T. E. Harris. The Theory of Branching Processes. Springer-Verlag, Berlin, 1963.

[33] O. Kallenberg. Foundations of Modern Probability. Springer, New York, second

edition, 2002.

[34] R. Kress. Linear Integral Equations. Springer, New York, third edition, 2014.

42

Table 1: Partial reﬂection: Numerical data for the k-truncated Wigner branching particle
model. The errors in the second, third and fourth columns are calculated at the ﬁnal time
tf in = 20fs. The particle numbers in the ﬁfth and sixth columns and the running CPU
time in the last column are measured in million and minutes, respectively. While using
constant auxiliary function γ(x) ≡ γ0 the increasing multiple of particle number within an
2γ0TA. Three kinds of constant auxiliary functions, γ0 = ˇξ, 2 ˇξ, 3 ˇξ,
annihilation period is e
are tested, where ˇξ = maxx∈X{ξ(x)} ≈ 2.96E-01.
ˇ#b
P

e2γ0TA Time

errmm

ˇ#a
P

γ(x)

errwf

errsm

M

–

286.28

∆t = 0.008fs, TA = 1fs

9.08E-02

3.08E-02

3.20E-02

9.01E-02

3.16E-02

3.05E-02

7.95E-02

2.74E-02

2.46E-02

5.34

5.44

9.62

3.02

3.02

2.95

7.51E-02

2.52E-02

1.97E-02

17.25

2.93

∆t = 1fs, TA = 1fs

9.25E-02

3.21E-02

3.31E-02

8.98E-02

3.32E-02

2.73E-02

7.94E-02

2.68E-02

2.21E-02

5.35

5.44

9.61

3.02

3.02

2.95

7.55E-02

2.51E-02

1.99E-02

17.26

2.93

∆t = 2fs, TA = 2fs

9.43E-02

3.18E-02

3.75E-02

9.72

3.12

9.00E-02

3.45E-02

3.43E-02

10.07

3.10

1.77

1.80

3.26

5.89

1.77

1.80

3.26

5.89

3.13

3.25

1.81

3.27

5.91

–

1.81

3.27

5.91

–

3.27

291.45

297.72

314.83

3.38

3.37

4.57

6.55

2.22

2.95

5.50

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

ξ(x)
ˇξ
2 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

6.32E-02

2.70E-02

2.36E-02

31.62

2.98

10.62

10.68

5.48E-02

2.45E-02

2.30E-02

102.25

2.94

34.71

34.88

14.63

∆t = 4fs, TA = 4fs

1.39E-01

4.63E-02

4.66E-02

30.69

3.26

9.72

–

1.27E-01

4.93E-02

4.74E-02

33.19

3.21

10.46

10.68

2.25

2.63

6.69E-02

2.83E-02

2.79E-02

326.99

2.92

112.65

113.98

25.10

∆t = 0.1fs, TA = 0.1fs

2.86E-01

8.12E-02

6.82E-02

2.87E-01

8.02E-02

6.53E-02

2.84E-01

8.01E-02

6.61E-02

2.84E-01

8.10E-02

6.60E-02

2.73

2.73

2.87

3.04

2.58

2.57

2.55

2.55

1.06

1.06

1.13

1.19

–

1.06

1.13

1.19

23.67

23.82

24.07

24.83

43

Table 2: Partial reﬂection: Numerical data for the y-truncated Wigner branching particle
model. Detailed explanations are referred to Table 1, except for ˇξ ≈ 2.90E-01 now.
e2γ0TA Time

γ(x)

M

errsm

errmm

errwf

ˇ#b
P

ˇ#a
P

–

290.22

∆t = 0.008fs, TA = 1fs

9.41E-02

2.66E-02

3.14E-02

9.32E-02

2.57E-02

2.87E-02

8.22E-02

2.16E-02

2.18E-02

5.13

5.36

9.33

2.93

3.01

2.93

7.86E-02

2.04E-02

1.85E-02

16.54

2.91

∆t = 1fs, TA = 1fs

9.52E-02

3.24E-02

3.03E-02

9.56E-02

2.69E-02

2.97E-02

8.34E-02

2.15E-02

2.05E-02

5.14

5.36

9.33

2.94

3.01

2.93

7.95E-02

2.20E-02

1.94E-02

16.54

2.92

1.75

1.78

3.18

5.67

1.75

1.78

3.18

5.67

∆t = 2fs, TA = 2fs

9.49E-02

2.73E-02

2.76E-02

8.99E-02

2.90E-02

3.03E-02

9.22

9.76

3.03

3.09

3.06

3.17

1.79

3.19

5.70

–

1.79

3.19

5.70

–

3.19

291.37

303.30

312.25

3.07

3.22

4.37

6.57

2.22

2.32

5.57

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

ξ(x)
ˇξ
2 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

6.47E-02

1.99E-02

1.96E-02

30.00

2.97

10.10

10.18

5.56E-02

1.48E-02

1.55E-02

94.54

2.94

32.17

32.46

16.45

∆t = 4fs, TA = 4fs

1.40E-01

4.46E-02

4.41E-02

28.35

3.16

1.30E-01

4.59E-02

4.37E-02

31.54

3.20

9.27

9.96

–

10.18

2.92

3.15

6.81E-02

2.12E-02

2.01E-02

294.29

2.91

101.82

103.54

28.77

∆t = 0.1fs, TA = 0.1fs

2.87E-01

7.57E-02

7.07E-02

2.88E-01

7.80E-02

6.91E-02

2.88E-01

7.95E-02

7.19E-02

2.86E-01

7.82E-02

7.08E-02

2.64

2.71

2.86

3.02

2.49

2.56

2.54

2.54

1.06

1.06

1.12

1.19

–

1.06

1.12

1.19

23.53

23.47

23.98

24.65

44

(a) t = 5.

(b) t = 10.

(c) t = 15.

(d) t = 20.

Figure 3: Partial reﬂection: Numerical Wigner functions at diﬀerent time instants
t = 5, 20, 15, 20fs. The reference solution by SEM is displayed in the left-hand-side col-
umn, while the right-hand-side column shows the numerical solution obtained from the
k-truncated branching particle method with the auxiliary function γ(x) = 3 ˇξ as well as
∆t = 1fs and TA = 1fs.

45

xk  0102030405060−2−1.5−1−0.500.511.5200.050.10.150.20.250.3xk  0102030405060−2−1.5−1−0.500.511.5200.050.10.150.20.250.3xk  0102030405060−2−1.5−1−0.500.511.52−0.0500.050.10.150.20.250.3xk  0102030405060−2−1.5−1−0.500.511.52−0.0500.050.10.150.20.250.3xk  0102030405060−2−1.5−1−0.500.511.52−0.1−0.0500.050.10.150.20.25xk  0102030405060−2−1.5−1−0.500.511.52−0.1−0.0500.050.10.150.2xk  0102030405060−2−1.5−1−0.500.511.52−0.2−0.15−0.1−0.0500.050.10.150.2xk  0102030405060−2−1.5−1−0.500.511.52−0.2−0.15−0.1−0.0500.050.10.150.2(a) The ﬁfth period.

(b) The tenth period.

(c) The ﬁfteenth period.

(d) The twentieth period.

Figure 4: Partial reﬂection: Growth rates of particle number within diﬀerent annihilation
periods for the k-truncated branching particle method with ∆t = 0.008fs and TA = 1fs.
2γ0t when using a
The curve of theoretical prediction can be described analytically by e
constant auxiliary function γ0. Here we set the constant auxiliary function γ0 = ˇξ and the
variable one γ(x) = ξ(x).

46

44.24.44.64.8511.11.21.31.41.51.61.71.81.9timegrowthrateofparticlenumber  theoreticalpredictionvariableauxiliaryfunctionconstantauxiliaryfunction99.29.49.69.81011.11.21.31.41.51.61.71.81.9timegrowthrateofparticlenumber  theoreticalpredictionvariableauxiliaryfunctionconstantauxiliaryfunction1414.214.414.614.81511.11.21.31.41.51.61.71.81.9timegrowthrateofparticlenumber  theoreticalpredictionvariableauxiliaryfunctionconstantauxiliaryfunction1919.219.419.619.82011.11.21.31.41.51.61.71.81.9timegrowthrateofparticlenumber  theoreticalpredictionvariableauxiliaryfunctionconstantauxiliaryfunction(a) Diﬀerent γ(x).

(b) Diﬀerent TA.

Figure 5: Partial reﬂection: Particle number after resampling (annihilation). The left
plot shows the behavior for diﬀerent auxiliary functions γ(x) with the same annihilation
period TA = 1fs. The right plot displays the behavior for diﬀerent annihilation periods
with the same constant auxiliary function γ0 = 2 ˇξ.

Table 3: Total reﬂection: Numerical data for the k-truncated Wigner branching particle
model. Detailed explanations are referred to Table 1, except for ˇξ ≈ 1.28 here.

γ(x)

errwf

errsm

errmm

ˇ#b
P

ˇ#a
P

M

e2γ0TA Time

∆t = 1fs, TA = 1fs

ξ(x)
ˇξ
2 ˇξ

ξ(x)
ˇξ
2 ˇξ
3 ˇξ

2.6210E-01

7.1421E-02

7.6208E-02

48.63

3.95

12.45

–

11.33

2.5998E-01

6.7069E-02

8.4044E-02

49.58

3.94

12.71

13.04

12.48

1.3034E-01

3.1041E-02

5.5122E-02

479.96

2.87

167.36

170.12

113.62

∆t = 0.1fs, TA = 0.1fs

3.3899E-01

1.0171E-01

1.9413E-01

3.4201E-01

1.0674E-01

1.9785E-01

3.3697E-01

1.0959E-01

1.9413E-01

3.4011E-01

1.1157E-01

1.9734E-01

3.22

3.23

4.05

5.18

2.50

2.50

2.43

2.40

1.29

1.29

1.67

2.16

–

1.29

1.67

2.16

25.33

25.87

28.98

29.80

47

051015201.61.822.22.42.62.833.2x 106timeparticlenumberafterresampling#aP(t)  ξ(x)ˇξ2ˇξ3ˇξ051015201.61.822.22.42.62.83x 106timeparticlenumberafterresampling#aP(t)  TA=0.1fsTA=1fsTA=2fsTA=4fs(a) t = 5.

(b) t = 10.

(c) t = 15.

(d) t = 20.

Figure 6: Total reﬂection: Numerical Wigner functions at diﬀerent time instants
t = 5, 20, 15, 20fs. The reference solution by SEM is displayed in the left-hand-side col-
umn, while the right-hand-side column shows the numerical solution obtained from the
k-truncated branching particle method with the auxiliary function γ(x) = 2 ˇξ as well as
∆t = 1fs and TA = 1fs.

48

xk  0102030405060−2−1.5−1−0.500.511.5200.050.10.150.20.250.3xk  0102030405060−2−1.5−1−0.500.511.5200.050.10.150.20.250.3xk  0102030405060−2−1.5−1−0.500.511.52−0.2−0.15−0.1−0.0500.050.10.150.2xk  0102030405060−2−1.5−1−0.500.511.52−0.2−0.15−0.1−0.0500.050.10.150.2xk  0102030405060−2−1.5−1−0.500.511.52−0.2−0.15−0.1−0.0500.050.10.150.2xk  0102030405060−2−1.5−1−0.500.511.52−0.2−0.15−0.1−0.0500.050.10.150.2xk  0102030405060−2−1.5−1−0.500.511.52−0.1−0.0500.050.10.150.20.25xk  0102030405060−2−1.5−1−0.500.511.52−0.1−0.0500.050.10.150.20.25(a) t = 5.

(b) t = 10.

(c) t = 15.

(d) t = 20.

Figure 7: Total reﬂection: Spatial marginal probability distributions at diﬀerent time
instants t = 5, 20, 15, 20fs.

49

0102030405060−0.0200.020.040.060.080.10.120.14xspatialmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM0102030405060−0.0500.050.10.150.20.250.3xspatialmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM0102030405060−0.0500.050.10.150.20.250.3xspatialmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM0102030405060−0.0100.010.020.030.040.050.060.070.080.09xspatialmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM(a) t = 5.

(b) t = 10.

(c) t = 15.

(d) t = 20.

Figure 8: Total reﬂection: Momental marginal probability distributions at diﬀerent time
instants t = 5, 20, 15, 20fs.

50

−505−0.500.511.522.5kmomentalmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM−505−0.200.20.40.60.811.21.41.6kmomentalmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM−505−0.200.20.40.60.811.21.41.6kmomentalmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM−505−0.500.511.522.5kmomentalmarginaldistribution  γ(x)=ˇξ,TA=1fsγ(x)=2ˇξ,TA=1fsγ(x)=2ˇξ,TA=0.1fsReferencebySEM