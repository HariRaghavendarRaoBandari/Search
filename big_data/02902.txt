6
1
0
2

 
r
a

M
9

 

.

 
 
]
P
C
n
i
f
-
q
[
 
 

1
v
2
0
9
2
0

.

3
0
6
1
:
v
i
X
r
a

Interacting Default Intensity with Hidden Markov

Process

Feng-Hui Yu ∗

Wai-Ki Ching †

Jia-Wen Gu ‡

Tak-Kuen Siu §

March 10, 2016

Abstract

In this paper we consider a reduced-form intensity-based credit risk model with a hidden

Markov state process. A ﬁltering method is proposed for extracting the underlying state

given the observation processes. The method may be applied to a wide range of problems.

Based on this model, we derive the joint distribution of multiple default times without

imposing stringent assumptions on the form of default intensities. Closed-form formulas for

the distribution of default times are obtained which are then applied to solve a number of

practical problems such as hedging and pricing credit derivatives. The method and numerical

algorithms presented may be applicable to various forms of default intensities.

Keywords: Reduced-form Intensity Model; Default Risk; Credit Derivatives; Hidden Markov

Model (HMM).

1

Introduction

Modeling credit risk has long been a critical issue in credit risk management. Attention has been

given to it especially since the global ﬁnancial crisis in 2008. Credit risk modeling has a lot of

applications, for example, pricing and hedging the credit derivatives, as well as the management

of credit portfolios. Models adopted in the ﬁnance industry may be grouped into two major

∗Advanced Modeling and Applied Computing Laboratory, Department of Mathematics, The University of

Hong Kong, Pokfulam Road, Hong Kong. E-mail: maggie.yufenghui@gmail.com.

†Corresponding author. Advanced Modeling and Applied Computing Laboratory, Department of Mathematics,

The University of Hong Kong, Pokfulam Road, Hong Kong. E-mail: wching@hku.hk.

‡Department of Mathematical Science, University of Copenhagen, Denmark. E-mail: jwgu.hku@gmail.com.
§Department of Applied Finance and Actuarial Studies, Faculty of Business and Economics, Macquarie Uni-

versity, Sydney, NSW 2109, Australia. Email: Ken.Siu@mq.edu.au;ktksiu2005@gmail.com

1

categories: structural ﬁrm value models and reduced-form intensity-based models. For the ﬁrst

class of models, it was pioneered by Black and Scholes (1973) and Merton (1974). The key idea

of the structural ﬁrm’s value model is to model the default of a ﬁrm by using its asset value,

where the asset value is governed by a geometric Brownian motion. When the asset value falls

below a certain prescribed level, the default of the ﬁrm is triggered. For the second kind of

model, it was pioneered by Jarrow and Turnbull (1995) and Madan and Unal (1998). The main

idea of reduced-form intensity-based models is to consider the defaults as exogenous processes

and describe their occurrences with Poisson processes and their variants.

The interacting intensity-based default models are widely adopted to model the portfolio

credit risk and defaults. Since we focus on contagion models in this paper as in, for example,

Giesecke (2008), we diﬀerentiate intensity-based credit risk models into top-down models and

bottom-up models. The top-down models focus on modeling the default times at the portfolio

level without reference to the intensities of individual entities. Based on this, one can also

recover the individual entity’s intensity with some method like random thinning, etc. Some

works related to this class of models include Davis and Lo (2001), Giesecke, Goldberg and Ding

(2005), Brigo, Pallavicini and Torresetti (2006), Longstaﬀ and Rajan (2008) and Cont and Minca

(2011), etc. While the bottom-up model focuses on modeling the default intensities of individual

reference entities and their aggregation to form a portfolio default intensity. Some works related

to this class of models include Duﬃe and Garleanu (2001), Jarrow and Yu (2001), Sch¨onbucher

and Schubert (2001), Giesecke and Goldberg (2004), Duﬄe et al. (2006) and Yu (2007), etc.

The diﬀerences between these two classes of models are the form of individual entity’s default

intensities and the way the portfolio aggregation is formed. In this paper we shall focus on a

bottom-up model.

Based on the model developed by Lando (1998), Yu (2007) extended the model and applied

the extended model multiple defaults and their correlation. In addition, Yu adopted the total

hazard construction method proposed by Norros (1986) and Shaked and Shathanthikumar (1987)

to simulate the distribution of default times which have interacting intensities. Zheng and Jiang

(2009) then adopted this method and derived closed-form formulas for the multiple default

distributions under their contagion model. Gu et al. (2013) introduced a recursive method to

calculate the distribution of ordered default times, and Gu et al. (2014) further proposed a

hidden Markov reduced-form model with a speciﬁc form of default intensities.

In this paper we develop a generalized reduced-form intensity-based credit model with hidden

Markov process. The model is applicable to a wide class of default intensities with various forms

2

of dependent constructions. For the hidden Markov process, we also discuss a ﬂexible method

to extract the hidden state process given the observations processes, which may hopefully have

applications in diverse ﬁelds. Then using the total hazard construction method by Yu (2007),

we derive closed-form formulas for the joint default distribution. When the intensities are

homogeneous, analytic algorithm for the calculation of the joint distribution of ordered default

times is provided. The explicit formula may enhance the computational eﬃciency in applications,

for instance, pricing of credit derivatives. We remark that the results in Gu et al. (2014) is a

special case of the method discussed here. In addition, we extend the total hazard construction

method to the cases with hidden process to simulate the joint distribution of default times. We

remark that hidden Markov models have been employed in studying credit risk, see for instance,

Frey and Runggaldier (2010, 2011), Frey and Schmidt (2011), Elliott and Siu (2013) and Elliott

et al. (2014).

The rest of this paper is structured as follows. Section 2 gives a snapshot of the interacting

intensity-based default model with hidden Markov process. Section 3 presents the method for

extracting the hidden state process from the observation processes. Section 4 derives the closed-

form expression for the joint default distribution based on the total hazard construction method,

and also presents an analytic formula for the distribution of ordered default times. Besides,

the extended total hazard construction method under a hidden Markov process to obtain the

joint distribution of default times is also presented. Section 5 provides numerical methods for

some situation in Section 3 which may be used in both Sections 3 and 4, and error analysis

is also discussed. Section 6 illustrates an application of the proposed method in pricing credit

derivatives. Finally, Section 7 concludes the paper.

2 Model Setup

Let (Ω, F , P ) be a complete probability space where P is a risk-neutral probability measure,

which is assumed to exist. Suppose there are K interacting entities, and we let Ni(t) :=

1{τi≤t}, where τi is a stopping time, representing the default time of credit name i, for each

i = 1, 2, · · · , K. Suppose we have an underlying state process (Xt)t≥0 describing the dynamics

of the economic condition. Let F X
t

:= σ(Xs, 0 ≤ s ≤ t) ∨ N where N represents all the null

subsets of Ω in F and C1 ∨ C2 is the minimal σ-algebra containing both the σ-algebras C1 and

C2. We also let Ht := σ(Xt) ∨ F N

t where

F N

t = F 1

t ∨ F 2

t ∨ . . . ∨ F K
t

and F i

t := σ(1{τi≤s}, 0 ≤ s ≤ t) ∨ N .

3

We assume that for each i = 1, 2, . . . , K, Ni(t) possesses a nonnegative, {Ht}t≥0-adapted, inten-

sity process λi satisfying

such that the compensated process

E(cid:18)Z t

0

λi(s)ds(cid:19) < ∞,

t ≥ 0,

Mi(t) := Ni(t) −Z t∧τi

0

λi(s)ds ,

t ≥ 0,

(1)

(2)

is an ({Ht}t≥0, P )-martingale. Note that after the default time τi, Ni(t) will stay at the value

one, so there is no need to compensate for Ni(t) after time τi, see, for example, Elliott et al.

(2000).

For all the market participants, we assume that they cannot observe the underlying process

(Xt)t≥0 directly.

Instead, they observe the process (Yt)t≥0, revealing the delayed and noisy

information of (Xt)t≥0, and also observe the default process (N i

t )t≥0. Hence, the common

information set available to the market participants at time t is Ft := F Y

t ∨ F N

t where F Y
t

:=

σ(Ys, 0 ≤ s ≤ t) ∨ N . We further assume that (Xt)t≥0 is an “exogenous” process to (N i

t )t≥0, i =

1, 2, . . . , K, i.e., For any t, the σ-ﬁelds F X

∞ and F N

t are conditionally independent given F X

t and

P (τi 6= τj) = 1, i 6= j.

To simplify our discussion, throughout the paper, we suppose that (Xt)t≥0 is a two-state

Markov chain taking a value in {x0, x1}. We assume the transition rates of the chain for

“x0 → x1” and “x1 → x0” are θ0 and θ1, respectively. The observable process (Yt)t≥0 is

again a two-state Markov chain taking value in {y0, y1}, with transition rates depending on Xt,

i.e., η0(Xt)(y0 → y1) and η1(Xt)(y1 → y0), where η0 and η1 are real-valued functions. At time

0, we suppose that X0 is in state x0 and Y0 is in state y0. The methods introduced later in

our paper may still be applicable when the Markov chains X and Y have more than two states

though more complicated notation may involve.

3 Extraction of Hidden State Process with Observable Pro-

cesses

To specify the form of the intensities, we give the following notations. Suppose that at time t,

N D

t defaults have already occurred at t1, t2, . . . , tN D

such that

t

0 = t0 < t1 < · · · < tN D

t

≤ t.

Then we denote TN D
the corresponding N D

t

= (t1, · · · , tN D

t

) the ordered N D

t default times and IN D

= (j1, · · · , jN D

t

)

t

t defaulters, and the mth (1 ≤ m ≤ K) defaulted obligor is jm. We

4

assume that i > N D

t and t < τ i, where τ i is the obligor i’s default time. Each process λi

(i = 1, . . . , K), is {Ht}t≥0-predictable, that is to say λi(t) is known given information about

the chain X and all the default processes prior to time t. Then the intensity of τ i may be

written as λi

t = λi(t|IN D

t

, TN D

t

, Xt) where Xt is the state of chain X at time t. Note that

(IN D

t

, TN D

t

, Xt) ∈ Ht.

Since the path of X is unobservable, while the path of Y and Ni, (i = 1, . . . , K) are observ-

able, we can use the relationship between X, Y and Ni, (i = 1, . . . , K) to ﬁnd the probability

law of X. We apply the recursive method proposed in Gu et al. [15] to calculate the conditional

probability P (Xt = xi|Ft), (i = 0, 1, t ≥ 0). Before discussing the method, we need to ﬁnd the

expressions for all the unknown items in the recursive formulas. In the process of ﬁnding the

expressions, we also present moment generating function method to achieve our goal.

3.1 Some Preliminaries

Let ¯Ti,k,j(s0, ∆s) be the union of subintervals of time of the chain X in state xk in the time

interval [s0, s0 + ∆s] given the chain starts from Xs0 = xi and ends at Xs0+∆s = xj. For each

i, j = 0, 1, we let

¯Ti,j(s0, t) = ( ¯Ti,0,j(s0, t), ¯Ti,1,j(s0, t))T

and u(¯t) = (u0(¯t), u1(¯t))T

where ¯t ∈ [s0, s0 + t]. Note that ¯Ti,1,j(s0, t) = [s0, s0 + t]\ ¯Ti,0,j(s0, t). Since jumps in chain Y

and defaults are Poisson processes, using the concept of moment generating function, we deﬁne

¯Ψij(s0, u, t) = E"exp(Z ¯Ti,0,j (s0,t)

u0(¯t)d¯t +Z ¯Ti,1,j (s0,t)

u1(¯t)d¯t)# .

Note that u(¯t) is an arbitrary integrable function. This means, in this case, we can adopt this

moment generating function. For instance, u(¯t) can be the transition rates of jumps in chain Y

or the default rates which are the default intensities accumulated by all the entities by time ¯t

before default.

Proposition 1 Let ¯Φij(s0, u, t) = Pij(t) ¯Ψij(s0, u, t), where Pij(t) is the probability that a pro-

cess in state xi will be in state xj after a time of t, and i, j = 0, 1. Then

¯Φij(s0, u, t) = θiZ t
¯Φii(s0, u, t) = θiZ t

0

0

exp(cid:18)Z s0+t−s
exp(cid:18)Z s0+t−s

s0

s0

(ui(¯t) − θi)d¯t(cid:19) ¯Φjj(s0 + t − s, u, s)ds
(ui(¯t) − θi)d¯t(cid:19) ¯Φji(s0 + t − s, u, s)ds + exp(cid:18)Z s0+t

s0

(ui(¯t) − θi)d¯t(cid:19)

(3)



where i, j = 0, 1.

5

Proof:

¯Ψij(s0, u, t)

θi

=

e−θis · e

= E"exp Z ¯Ti,0,j (s0,t)
Pij(t)Z t
Pij(t)Z t
Pij(t)Z t

exp(cid:18)Z s0+s
exp(cid:18)Z s0+t−s

R s0+s
s0

=

0

0

0

θi

θi

s0

s0

=

u0(¯t)d¯t +Z ¯Ti,1,j (s0,t)

u1(¯t)d¯t!#

ui(¯t)d¯t

Pjj(t − s)E"exp Z ¯Tj,0,j (s0+s,t−s)
(ui(¯t) − θi)d¯t(cid:19) Pjj(t − s) ¯Ψjj(s0 + s, u, t − s)ds
(ui(¯t) − θi)d¯t(cid:19) Pjj(s) ¯Ψjj(s0 + t − s, u, s)ds.

u0(¯t)d¯t +Z ¯Tj,1,j (s0+s,t−s)

u1(¯t)d¯t!# ds

We also have

¯Ψii(s0, u, t) =

θi

Pii(t)Z t

0

R s0+t−s
e
s0

(ui(¯t)−θi)d¯t

Pji(s) ¯Ψji(s0 + t − s, u, s)ds +

R s0+t
e
s0

(ui(¯t)−θi)d¯t

Pii(t)

.

Replace ¯Ψij(s0, u, t) by

¯Φij (s0,u,t)

Pij (t)

, we can then get the system of equations in the proposition.

We ﬁnd that when the expression of u(¯t) satisﬁes some “good” property, Eq. (3) in the

above proposition has a unique solution. The property is that u(¯t) does not have any direct

relationship with time ¯t even though it may have implied relationship with ¯t. This means u(¯t)

can be written as u. Then, not only the problem of solving Eq. (3) can be simpliﬁed, but

some related deﬁnitions can also be simpliﬁed as well. Similar as before, let Ti,k,j(∆s) be the

occupation time of the chain X in state xk in the time interval [s, s+∆s] given the chain starting

from Xs = xi and ending at Xs+∆s = xj. For each i, j = 0, 1, we let

Ti,j(t) = (Ti,0,j(t), Ti,1,j (t))T

and u = (u0, u1)T ∈ R2.

The moment generating function of Ti,j(t) is given by

Ψij(u, t) = E(exp{uT Ti,j(t)}).

Apply the same method to Ψij(u, t) as we have done to ¯Ψij(u, t), and let

Φij(u, t) = Ψij(u, t) · Pij(t).

We can also get the equivalent Eq.

(3) for Φij(u, t), i.e., replacing ¯Φij(u, t) with Φij(u, t),
(ui(¯t) − θi) with ui − θi in Eq. (3). Then to solve the equivalent equation, it suﬃces to solve a

linear system of O.D.E.s (c.f. Gu et al. [15]):

∂Φ(u, t)

∂t

= AΦ(u, t),

6

where

Φ(u, t) =

Φ11(u, t) Φ12(u, t)

Φ21(u, t) Φ22(u, t)  and A =

u0 − θ0

θ0

θ1

u1 − θ1

 .

This linear system of O.D.E.s is known as the fundamental matrix equation in the literature.

Then it is well-known that the equation has a unique solution which is called the fundamental

matrix solution with the initial condition Φij(u, 0) = 1, i, j = 0, 1 as

Φ(u, t) = eAt1 · 1T

where 1 is the two-dimensional column vector with all entries being equal to 1. Hence we can

get the solution for Ψij(u, t) by

Ψij(u, t) =

Φij(u, t)

Pij(t)

.

In practice, when the expressions of ui(¯t), (i = 0, 1) are given, we can substitute them into

the above Eq.

(3), then intuitively we can check whether it has a solution. Note that the

expressions of ui(¯t), (i = 0, 1) determine whether the system is solvable. If it is solvable, then
we can obtain the solution ¯Φij(s0, u, t), (i, j = 0, 1). Note that the results in [15] can be regarded

as a special case that has a unique solution.

3.2 Recursive Formulas for Extracting Hidden Process

For eωt ∈ Ft, we can express eωt in a more clear way as follows:

t , N D

t , SN Y

t

, IN D

, TN D

)

t

t

eωt = (N Y

where

• SN Y

t

= (s1, s2, . . . , sN Y

t

),

• IN D

t

= (j1, j2, . . . , jN D

t

),

• TN D

t

= (t1, t2, . . . , tN D

t

),

• N Y

t counts the number of jumps in chain Y by time t,

• N D

t counts the number of defaults by time t,

• (s1, s2, . . . , sN Y

t

) is the collection of ordered jump times of the chain Y by time t, i.e.,

0 < s1 < . . . < sN Y

t

≤ t,

7

• (t1, t2, . . . , tN D

t

tN Y

t

≤ t,

) is the collection of ordered default times by time t, i.e., 0 < t1 < . . . <

• (j1, j2, . . . , jN D

t

) is the collection of ordered corresponding name of defaulters by time t,

i.e., name ji defaults at time ti.

Here eωt can be interpreted as the state of the stochastic dynamical system at time t. Given the

information up to time t, i.e., Ft, we divide the time period [0, t] into (N Y

t ) sub-periods,

t + N D

[0, h1], (h1, h2], . . . , (hN Y

t +N D

t −1, hN Y

t +N D
t

]. In each of them, exactly one default or one jump

in Y is observed. When there is no default or jump occurred by time t, the calculation of

P (Xt = xi | Ft) can be simpliﬁed and we shall introduce it later.

Deﬁne ¯IN D

t

= (1, 2, . . . , K)\IN D

t

. Suppose that s and s + ∆s are two endpoints of one

sub-period. The following characterizes the computational method for P (Xt = xi | Ft). For

eω ∈ {tk = s + ¯tk ∈ (s, s + ∆s]},

=

and

P (Xs = xi | Fs+∆s) = P (Xs = xi | Fs, tk = s + ¯tk, jk = β)

P (Xs = xi | Fs) ·(cid:16)Pl=0,1 f i,l
Pj=0,1 P (Xs = xj | Fs) ·(cid:16)Pl=0,1 f j,l

(s + ¯tk; β, s, ∆s)(cid:17)
(s + ¯tk; β, s, ∆s)(cid:17)

tk

tk

P (Xs+∆s = xi | Fs+∆s) = Xj=0,1
= Xj=0,1

P (Xs = xj | Fs+∆s)P (Xs+∆s = xi | Fs+∆s, Xs = xj)

P (Xs = xj | Fs+∆s)

f j,i
tk

(s + ¯tk; β, s, ∆s)

(s + ¯tk; β, s, ∆s)

Pl=0,1 f j,l

tk

(t; β, s, ∆s)dt = P (tk ∈ dt, jk = β, Xs+∆s = xi | Xs = xj, N D

s , N Y

s , IN D

).

s

where

f j,i
tk

(4)

(5)

(6)

(7)

Similarly, we have for eω ∈ {sk = s + ¯sk ∈ (s, s + ∆s]},

P (Xs = xi | Fs+∆s) =

P (Xs = xi | Fs)(cid:16)Pl=0,1 f i,l
P (Xs = xj | Fs)Xl=0,1
Xj=0,1

f j,l

sk (s + ¯sk; s, ∆s(cid:17)
sk (s + ¯sk; s, ∆s
(cid:16)Pl=0,1 f j,l
sk (s + ¯sk; s, ∆s(cid:17)

f j,i
sk (s + ¯sk; s, ∆s)

and

where

P (Xs+∆s = xi | Fs+∆s) = Xj=0,1

P (Xs = xj | Fs+∆s)

f j,i
sk (t; s, ∆s)dt = P (sk ∈ dt, Xs+∆s = xi | Xs = xj , N D

s , N Y

s , IN D

s

).

8

Combining Eqs. (4), (5), (6) and (7), we obtain a recursive method for computing P (Xt =
xi | Ft) in terms of f j,i
tk

sk (s + ¯sk; s, ∆s). That is to say, with the fact

(s + ¯tk; β, s, ∆s) and f j,i

that P (X0 = x0|F0) = 1 and P (X0 = x1|F0) = 0, we can apply them to Eq. (4) or Eq. (6)

according to Ft, and then to get P (X0 = xi|F∆s) which are unknown in the calculation of

P (X∆s = xi|F∆s) in Eq. (5) or Eq. (7). The equation to calculate P (X∆s = xi|F∆s) should be

chosen according to Ft as well. By repeating this recursion procedure, we can obtain the desired

conditional probabilities.

To get the expressions for the desired f j,i
tk

(s + ¯tk; β, s, ∆s) and f j,i

sk (s + ¯sk; s, ∆s), we need

to use the method introduced in section 3.1. Replace u by −(ηi(x0), ηi(x1)), i = 0, 1 and we
know that there exists unique solutions for Ψij, i, j = 0, 1. Replace u(¯t) by −(λi(x0), λi(x1)),

i = 1, · · · , K in Eq. (3), we then could have a direct sense of whether it is solvable or not. If it
is solvable and has an analytical solution, then from the deﬁnition of f j,i
tk
f j,i
sk (s + ¯sk; s, ∆s), we get

(s + ¯tk; β, s, ∆s) and

f j,i

sk (s + ¯sk; s, ∆s) = Xl=0,1

Pjl(¯sk)Pli(∆s − ¯sk)ηC(N Y

s )(xl)

s )(x0), ηC(N Y
s +1)(x0), ηC(N Y

s )(x1))T , ¯sk(cid:1)
s +1)(x1))T , ∆s − ¯sk(cid:1)

(λi(¯t|IN D

s

, TN D

s

, x0), λi(¯t|IN D

, TN D

s

s

(λi(¯t|IN D

s

, TN D

s

, x0), λi(¯t|IN D

s

×Ψjl(cid:0)−(ηC(N Y
×Ψli(cid:0)−(ηC(N Y
× ¯Ψjls, − Xi∈ ¯IN D
× ¯Ψlis + ¯sk, − Xi∈ ¯IN D

s

s

, x1))T , ¯sk
, x1))T , ∆s − ¯sk ,

s

, TN D

f j,i

tk (s + ¯tk; β, s, ∆s) = Xl=0,1

Pjl(¯tk)Pli(∆s − ¯tk)λβ (s + ¯tk|IN D

s

, TN D

s

, Xs = xl)

s )(x0), ηC(N Y
s )(x0), ηC(N Y

s )(x1))T , ¯tk)

s )(x1))T , ∆s − ¯tk(cid:1)

(λi(¯t|IN D

s

, TN D

s

, x0), λi(¯t|IN D

, TN D

s

s

(λi(¯t|I ∗

, T ∗

N D
s

N D
s

, x0), λi(¯t|I ∗

N D
s

, x1))T , ¯tk
, x1))T , ∆s − ¯tk(cid:19)

, T ∗

N D
s

where I ∗

N D
s

= IN D

s S{β}, T ∗

1, x + Y0 ≡ 0 (mod 2)

0, x + Y0 ≡ 1 (mod 2).

×Ψjl(−(ηC(N Y

s

×Ψli(cid:0)−(ηC(N Y
× ¯Ψjls, − Xi∈ ¯IN D
× ¯Ψli(cid:18)s + ¯tk, −Pi∈ ¯I ∗
s S{tβ} and
C(x) =

= TN D

N D
s

N D
s

9

If up to time t, no jump or default has been observed, then we have the following: for eω ∈ {no

jump or default observed in [0, t]},

P (Xt = xi | Ft) =

where

Xj=0,1

P (Xt = xi, no jump or default in[0, t])

P (Xt = xj , no jump or default in[0, t])

P (Xt = xj, no jump or default in[0, t]) = P (Xt = xj)Ψ0j(cid:0)−(ηC(0)(x0), ηC(0)(x1))T , t(cid:1) × ¯Ψ0j(0,

, x1))T , t).

, x0), λi(¯t|IN D

, TN D

0

0

−Pi∈I (λi(¯t|IN D

0

, TN D

0

Note that if the jump intensities of chain Y : ηi (i = 0, 1), are not as simple as in our as-
sumptions and they are also related with time directly, i.e., ηi(¯t), all the algorithms intro-

duced above are still applicable and we just need to replace Ψij(cid:0)−(ηC(0)(x0), ηC(0)(x1))T , t(cid:1) by
¯Ψij(cid:0)−(ηC(0)(x0), ηC(0)(x1))T , t(cid:1), i, j = 0, 1. This replacement holds only when Eq. (3) given

u(¯t) = −(η0(¯t), η1(¯t)) has an analytical solution.

If Eq.

(3) does not admit an analytical solution given ui(¯t), (i = 0, 1), we also provide

numerical method in Section 5. Now we know how to get P (Xt = xi|Ft).

4 Default Distributions

We derive the default distributions in this section. Besides deriving closed-form expressions for

default distributions, extended total hazard construction method for hidden Markov model to

derive the joint default distribution is also presented.

4.1 Closed-Form Expressions for Default Distributions

In this subsection, we compute the conditional joint distribution of default times

P (τ 1 > t1, τ 2 > t2, . . . , τ K > tK | Ft)

and the distribution of ordered default times

P (τ k > s | Ft),

k = 1, 2, . . . , K.

Notice that when t = 0, we don’t have any information, the above two conditional probabilities

become unconditional probabilities. As for the ﬁrst probability, due to the Markov property of

Xt and the structure of λi(t), we have

P (τ 1 > t1, τ 2 > t2, . . . , τ K > tK | Ft)

= Xi=0,1

P (τ 1 > t1, τ 2 > t2, . . . , τ K > tK | F N
t

, Xt = xi) × P (Xt = xi | Ft).

10

Since we know how to calculate P (Xt = xi | Ft), we only need to compute the conditional joint

probability P (τ 1 > t1, τ 2 > t2, . . . , τ K > tK | F N
t

, Xt = xi).

Assume we ﬁrst enter the market immediately after the N D

t th default of the K obligors

at time t, to simplify the notations, we denote m = N D

t , that means we already know the

information Tm = (t1, · · · , tm), Im = (j1, · · · , jm) and F Y

t by time t. Then we can get the

following equation:

P (τ 1 > t1, τ 2 > t2, . . . , τ K > tK | F N
t

, Xt = xi)

= P (τ jm+1 > tjm+1, . . . , τ jK > tjK | τ j1 = t1, . . . , τ jm = tm, Xt = xi).

Furthermore, we also know the relationship that

f (tjm+1, . . . , tjK | Ft) = (−1)K−m

dK−m

dtjm+1 . . . dtK P (τ 1 > t1, τ 2 > t2, . . . , τ K > tK | F N

t , Xt = xi)

where f (tjm+1, . . . , tjK | Ft) is the conditional joint density function. Therefore, to obtain the

desired conditional probability, it suﬃces to ﬁnd its conditional joint density function.

Here we employ the approach introduced by Yu (2007) [27] (called the total hazard construc-

tion method) to derive the conditional density function.

Proposition 2 The expression of the density function that we intend to get is in the form of

expectation

f (tjm+1, . . . , tjK | Ft) = E

KXl=m+1Xi∈ ¯Il

λi(tjl|Il, Tl, Xtjl ) · exp−

KXl=m+1

(Xi∈ ¯IlZ tjl

tl

λi(u|Il, Tl, Xu)du) .

Proof: Without loss of generality, we assume that tjm+1 < . . . < tjK . In this case, τ m+1 − τ m

would be the ﬁrst default time we observed after entering the market. By using the total hazard

construction method pioneered by Yu (2007) [27] with the information already known, we draw

a collection of independent standard exponential random variables: (Ejm+1 , · · · , EjK ). Then we

know

τ m+1 − τ m = min
i∈ ¯Im

Λ−1

i

(Ei) = min
i∈ ¯Im

inf{s ≥ 0 : Λi(s) ≥ Ei}

which implies that

P(cid:0)τ m+1 − τ m > t | Fτ m(cid:1) = P(cid:18)min

i∈ ¯Im

inf{s ≥ 0 : Λi(s) ≥ Ei} > t(cid:19) .

11

Suppose the information F X

∞ is known, then

P(cid:18)Ei >Z tm+t
P (τ m+1 − τ m > t | Fτ m) = Yi∈ ¯Im
exp(cid:18)−Z tm+t
= Yi∈ ¯Im
= exp−Xi∈ ¯ImZ tm+t

λi(u|Im, Tm, Xu)du(cid:19)
λi(u|Im, Tm, Xu)du(cid:19)
λi(u|Im, Tm, Xu)du .

tm

tm

tm

Then if we assume that τ m < t < τ m+1 and ti > τ i, i = 1, . . . , m, and let λm+1(t) denote

the (m + 1)th default rate at time t, then

λm+1(t) = Xi∈ ¯ImZ t

tm

λi(u|Im, Tm, Xu)du.

Since

we have

P (τ m+1 > t | Fτ m , Xs(tm<s<∞)) = e− Pi∈ ¯Im R t

tm

λi(u|Im,Tm,Xu)du = e−λm+1(t)

P (τ jm+1 > tjm+1, . . . , τ jK > tjK | Ft, Xs(tm<s<∞))

=

=

KYl=m+1
KYl=m+1
= exp−

P (τ jl > tjl | Ft, Xs(tm<s<∞))

e−λl(tjl ) =

KXl=m+1

λi(u|Il−1, Tl−1, Xu)du

KYl=m+1
( Xi∈ ¯Il−1Z tjl

tl−1

tl−1

exp− Xi∈ ¯Il−1Z tjl
λi(u|Il−1, Tl−1, Xu)du)

and therefore

f (tjm+1, . . . , tjK | Ft, Xs(tm<s<∞))

dK−m

= (−1)K−m

= (−1)K−m

KYl=m+1 Xi∈ ¯Il−1

=

and

dtjm+1 . . . dtK P (τ jm+1 > tjm+1, . . . , τ jK > tjK | Ft, Xs(tm<s<∞))

dK−m

dtjm+1 . . . dtK exp−
( Xi∈ ¯Il−1Z tjl
KXl=m+1
λi(tjl|Il−1, Tl−1, Xtjl ) · exp−
KXl=m+1

tl−1

λi(u|Il−1, Tl−1, Xu)du) |tl−1=tjl−1
λi(u|Il−1, Tl−1, Xu)du)
( Xi∈ ¯Il−1Z tjl

tjl−1

f (tjm+1, . . . , tjK | Ft) = E[f (tjm+1 , . . . , tjK | Ft, Xs(tm<s<∞))]

12

= E
= E

KYl=m+1 Xi∈ ¯Il−1
KYl=m+1 Xi∈ ¯Il−1

λi(tjl|Il−1, Tl−1, Xtjl ) · exp−
λi(tjl|Il−1, Tl−1, Xtjl ) · exp−

KXl=m+1
KXl=m+1

tjl−1

( Xi∈ ¯Il−1Z tjl
(Z tjl
tjl−1 Xi∈ ¯Il−1

λi(u|Il−1, Tl−1, Xu)du)
λi(u|Il−1, Tl−1, Xu)du) .

If Eq. (3) in the previous section given u(¯t) = −(λi(x0), λi(x1)), i = 1, . . . , K, has unique

solutions, then we further have the following result.

Proposition 3 The explicit formula for calculating the desired density function is in this form:

· · · XlK =0,1

f (tjm+1, . . . , tjK | Ft) = (−1)K−m · Xlm+1=0,1 Xlm+2=0,1
d( ¯Ψilm+1 (tjm, −Pi∈ ¯Im(λi(¯t|Im, Tm, x0), λi(¯t|Im, Tm, x1))T , tjm+1 − tjm))
d( ¯Ψlm+1lm+2(tjm+1 , −Pi∈ ¯Im+1
d( ¯ΨlK−1lK (tjK−1 , −Pi∈ ¯IK−1

dtjm+2

dtjm+1

dtjK

· · · ·

·

·

·

where ¯Ψij, i, j = 0, 1 are the moment generating function deﬁned in Section 3.

(λi(¯t|Im+1, Tm+1, x0), λi(¯t|Im+1, Tm+1, x1))T , tjm+2 − tjm+1))

(λi(¯t|IK−1, TK−1, x0), λi(¯t|IK−1, TK−1, x1))T , tjK − tjK−1))

λi(tjl |Il−1, Tl−1, Xtjl ) · e

− PK

l=m+1(R t

jl
jl−1 Pi∈ ¯Il−1

t

λi(u|Il−1,Tl−1,Xu)du)

Proof: We note that

· · · XlK =0,1

E
KYl=m+1 Xi∈ ¯Il−1
= Xlm+1=0,1 Xlm+2=0,1
EXi∈ ¯Im
· E Xi∈ ¯Im+1
· · · · E Xi∈ ¯IK−1
= (−1)K−m · Xlm+1=0,1 Xlm+2=0,1

·

jm+2
jm+1 Pi∈ ¯Im+1

R t
t

d(cid:18)E(cid:20)e

d(cid:18)E(cid:20)e

· · · ·

·

·

jK
jK−1 Pi∈ ¯IK−1

R t
t

λi(tjm+1|Im, Tm, Xtjm+1 ) · eR t

jm+1
tjm Pi∈ ¯Im

λi(tjm+2 |Im+1, Tm+1, Xtjm+2 ) · e

jm+2
jm+1 Pi∈ ¯Im+1

R t
t

λi(tjK |IK−1, TK−1, XtjK ) · e

jK
jK−1 Pi∈ ¯IK−1

R t
t

λi(u|Im,Tm,Xu)du|Xtjm = i, Xtjm+1 = lm+1

λi(u|Im+1,Tm+1,Xu)du|Xtjm+1 = lm+1, Xtjm+2 = lm+2
λi(u|IK−1,TK−1,Xu)du|XtjK−1 = lK−1, XtjK = lK
λi(u|Im,Tm,Xu)du|Xtjm = i, Xtjm+1 = lm+1(cid:21)(cid:19)

dtjm+1

d(cid:18)E(cid:20)eR t

jm+1
tjm Pi∈ ¯Im

· · · XlK =0,1

λi(u|Im+1,Tm+1,Xu)du|Xtjm+1 = lm+1, Xtjm+2 = lm+2(cid:21)(cid:19)
λi(u|IK−1,TK−1,Xu)du|XtjK−1 = lK−1, XtjK = lK(cid:21)(cid:19)

dtjm+2

dtjK

13

· · · XlK =0,1

= (−1)K−m · Xlm+1=0,1 Xlm+2=0,1
d( ¯Ψlm+1lm+2(tjm+1 , −Pi∈ ¯Im+1
d( ¯ΨlK−1lK (tjK−1 , −Pi∈ ¯IK−1

· · · ·

·

·

d( ¯Ψilm+1 (tjm , −Pi∈ ¯Im

(λi(¯t|Im, Tm, x0), λi(¯t|Im, Tm, x1))T , tjm+1 − tjm ))

dtjm+1

(λi(¯t|Im+1, Tm+1, x0), λi(¯t|Im+1, Tm+1, x1))T , tjm+2 − tjm+1 ))

dtjm+2

(λi(¯t|IK−1, TK−1, x0), λi(¯t|IK−1, TK−1, x1))T , tjK − tjK−1 ))

dtjK

Similarly if the equations related to ¯Ψij do not have analytical solutions, then we can use
the same approximation method which will be discussed in the next section to approximate ¯Ψij

with Ψij. Thus one can obtain an explicit approximation expression for the density function

f (tjm+1, . . . , tjK | Ft). When the expressions of the default intensities are homogeneous and

symmetric,

P (τ jm+1 < · · · < τ jk < s < τ jk+1 < · · · < τ jK | Ft)

tmZ t
= Z t

tjm+1

· · ·Z t

tjk−1Z ∞

t

Z ∞

tjk+1

· · ·Z ∞

tjK−1

f (tjm+1, tjm+2, . . . , tjK | Fs)dtjK · · · dttjm+1 .

Because they are homogeneous and symmetric,

P (τ jk ≤ s < τ jk+1 | Ft) = (K − m)!P (τ jm+1 < · · · < τ jk < s < τ jk+1 < · · · < τ jK | Ft).

Furthermore, we have

P (τ jk > s | Ft) =

k−1Xi=m

P (τ ji ≤ s < τ ji+1 | Ft).

4.2 Extended Total Hazard Construction Method for HMM

We further extend the total hazard construction method to make it applicable to various forms

of default intensities modulated by a hidden Markov process, then to gain the joint default

distribution.

The total hazard accumulated by obligor i by time t, denoted by ψi(t|IN D

t

, TN D

t

, Xt), can be

deﬁned as follows:

ψi(t|IN D

t

, TN D

t

, Xt) =

N D

t −1Xl=0

Λi(tl+1 − tl|Il, Tl, Xtl+1) + Λi(t − tN D

t

|IN D

t

, TN D

t

, Xt)

(8)

where

Λi(s|Il, Tl, Xtl+s) =Z tl+s

tl

λi(µ|Il, Tl, Xµ)dµ

(9)

is the total hazard accumulated by obligor i in the time interval [tl, tl + s]. Note that the default

processes are independent unit exponential random variables. And we deﬁne the inverse function

Λ−1

i

(x|Ik, Tk, N Y

∞, SN Y

∞

) = inf{s : Λi(s|Ik, Tk, Xtk+s) ≥ x}, x ≥ 0

(10)

14

where (N Y

∞, SN Y

∞

) ∈ F Y

∞ is the entire history of the path of Y , N Y

∞ is the entire number of jump

in the chain Y and SN Y

∞

is the collection of corresponding ordered jump times.

The total hazard can be constructed by the following recursive procedure:

Step 1. Generate a complete sample path of Y , and denote it as (N Y

∞, SN Y

∞

) ∈ F Y
∞.

Generate a collection of i.i.d. unit exponential random variables (E1, · · · , EK).
Step 2. Let j1 = arg min{Λ−1
Note that T1 = (t1), t1 = ˆτ j1, I1 = (j1).

i (Ei) : i = 1, · · · , K} and deﬁne ˆτ j1 = Λ−1
j1

(Ej1).

Step 3. (i) Assume that (ˆτ j1 , . . . , ˆτ jm−1 ) and the simulated path of Xs(0 ≤ s < ˆτ jm−1) are

already obtained as Tm−1 = (t1, . . . , tm−1), tl = ˆτ jl, l = 1, . . . , m − 1 and Im−1 = (j1, . . . , jm−1),

where m ≥ 2. By using the conditional probability of
P (Xs = xi| ˜Fs),

i = 0, 1, x0 = 0, x1 = 1, s ≥ ˆτ jm−1 and ˜Fs = F Y

s ∨ Tm−1 ∨ Im−1,

we can generate a sequence of random numbers of Xs under this conditional probability.

i (x|Im−1, Tm−1, N Y

We can then obtain the simulated path of Xs, s ≥ ˆτ jm−1 which will be useful in the calculation of
Λ−1
(ii) Note that ¯Im−1 = (1, 2, . . . , K)\Im−1.
Therefore, with the information of Tm−1, Im−1 and the path of Xs(0 ≤ s < ˆτ jm−1) ∪ Xs(s ≥ ˆτ jm−1),

∞, SN Y

).

∞

i.e., the path of X. We let
jm = arg min{Λ−1

i

(Ei − ψi(tm−1|Im−1, Tm−1, Xtm−1 )|Im−1, Tm−1, N Y

∞, SN Y

∞

) : i ∈ ¯Im−1}

where ψi(tm−1|Im−1, Tm−1, Xtm−1 ) is the total hazard accumulated by Name i under the condition

of defaults and information of chain X by the (m − 1)th default time, i.e., tm−1.

Then we let
ˆτ jm = tm−1 + Λ−1
and reserve the simulated path of Xs, ˆτ jm−1 ≤ s < ˆτ jm at this step.

jm (Ejm − ψjm(tm−1|Im−1, Tm−1, Xtm−1 )|Im−1, Tm−1, N Y

∞, SN Y

∞

)

Thus, with the simulated path, we can get the simulated path of Xs, 0 ≤ s < ˆτ jm.

Step 4. If m = K, then stop. Otherwise, increase m by 1 and go to Step 3.

From the recursive procedure, we can obtain the distribution of ˆτ . According to Shaked and

Shanthikumar (1987) [25] and Yu (2007) [27], the distribution of ˆτ obtained from the above

recursive processes is equal to the distribution of the original default time τ . This gives the

following results.

Proposition 4 Let τ be the default time with the intensities

λi
t = λi(t|IN D

t

, TN D

t

, Xt),

i = 1, . . . , K

15

and the related jump processes satisfying the assumptions mentioned in Section 2. Construct ˆτ

according to Steps 1 − 4 with the intensity equal to

λi(t|IN D

t

, TN D

t

, Xt),

i = 1, 2, . . . , K.

Let F ′

t be the minimal ﬁltration containing F Y

t and the information of the default processes
related to ˆτ by time t, and P ′ be the distribution of (Y, ˆτ ). Then every element in ˆτ i has

(P ′, F ′

t)-intensity of the form:

λi(t|IN D

t

, TN D

t

, Xt),

i = 1, 2, . . . , K.

Therefore, we can generate τ by just generating ˆτ .

5 Numerical Approximation Method

In this section, we consider an outstanding problem in Section 3. If Eq. (3) does not admit an

analytical solution given ui(¯t), (i = 0, 1) then we shall try to use another method to approximate
the conditional probability P (Xt = xi|Ft). We can consider approximating ¯Ψij(s0, u, t) directly.

As we mentioned before, it is because of the default intensities λi, (i = 1, . . . , K) which give Eq.

(3) with

u(¯t) = −(λi(x0), λi(x1)),

i = 1, . . . , K

does not have an analytical solution, and hence we cannot obtain closed-form expressions for
¯Ψij(s0, u, t). Thus, we need to approximate the moment generating function ¯Ψij(s0, u, t) when
If the error of ¯Ψij(s0, u, t) is less than any arbitrary ǫ
sk (s + ¯sk; s, ∆s) and f j,i
(s + ¯tk; β, s, ∆s) given below, we
tk

the default intensities are applied.
then according to the expression of f j,i

know that their relative errors can be controlled. Furthermore, from the recursive method for

P (Xt = xi|Ft) presented in Section 3, the error of this conditional probability may be controlled.

In the following, we are going to illustrate how the approximation works. When the length

of the time interval length is small enough, without loss of generality, we can approximately

assign t in the default intensities λi(t) to be the left value of the concerned time interval, i.e.,

t = s0 when the time interval is [s0, s0 + ∆¯s]. Then we can still apply the moment generating
function given u(¯t) = u(s0) = ¯u, and we know the corresponding Eq. (3) has a unique solution.
But we need to ensure that by using this method, the error of ¯Ψij(s0, u, ∆¯s) can be controlled

such that it can be less than any arbitrarily given ǫ.

16

Proposition 5 The error control ∆Ψij(s0, u, ∆¯s) < ǫ < 1, where ǫ is arbitrary, can be achieved

by requiring ∆¯s to satisfy

∆¯s <

− ln(1 − ǫ)
K · λmax(s0)

where

and

and

and

λmax(s0) = max

i=1,...,K

{λi(s), s ∈ [0, s0]}

∆Ψij(s0, u, ∆¯s) = |Ψij(¯u, ∆¯s) − ¯Ψij(s0, u, ∆¯s)|

¯u(t) = u(˜sk−1)

for

t ∈ (˜sk−1, ˜sk]

[0, s0] = [˜s0, ˜s1][(˜s1, ˜s2][ · · ·[(˜sn−1, ˜sn].

Proof: Note that there are K entities, so when the default intensity is applied, i.e.,

u(¯t) = −(λi(x0), λi(x1))

or u = −(λi(x0), λi(x1)), i = 1, . . . , K,

we notice the relationships that

E[e−K·λmax(s0)·∆¯s] ≤ Ψij(¯u, ∆¯s) ≤ E[eK·0·∆¯s]

and

E[e−K·λmax(s0)·∆¯s] ≤ ¯Ψij(s0, u, ∆¯s) ≤ E[eK·0·∆¯s].

Since all λi, i = 1, . . . , K are nonnegative, therefore, we have the following relationship:

∆Ψij(s0, u, ∆¯s) ≤ E[eK·0·∆¯s − e−K·λmax(s0)·∆¯s] < ǫ

if and only if

if and only if

eK·λmax(s0)·∆¯s <

1

1 − ǫ

∆¯s <

− ln(1 − ǫ)
K · λmax(s0)

.

We can simply let ∆¯s = − ln(1−ǫ)

lable. Here we are in the position to approximate f j,i

K·λmax(s0) , it is enough to make the error of ¯Ψij(s0, u, ∆¯s) control-
sk (s + ¯sk; s, ∆s). First, we partition the time

17

interval [s, s+¯sk] evenly with step size equal to ∆¯s = − ln(1−ǫ)

That is to say,

K·λmax(s+∆s) , and denote M1(s, ∆¯s) =(cid:2) ¯sk
∆¯s(cid:3).

[s, s + ¯sk] = [s, s + ∆¯s][[s + ∆¯s, s + 2∆¯s][ · · ·[[s + M1(s, ∆¯s) · ∆¯s, ¯sk]

Moreover, we do the same thing for the remaining time interval:

M2(s, ∆¯s) = h ∆s−¯sk

∆¯s i. We denote M1 = M1(s, ∆¯s) and M2 = M2(s, ∆¯s). Now the explicit

approximation formula is given as follows:

[s + ¯sk, ∆s] and denote

Pjl(¯sk)Pli(∆s − ¯sk)ηC(N Y

s )(xl)

· · · XlM1 =0,1 X¯l1=0,1

s )(x0), ηC(N Y

s +1)(x0), ηC(N Y

· · · X¯lM2 =0,1
s )(x1))T , ¯sk(cid:17)
s +1)(x1))T , ∆s − ¯sk(cid:17)

(λi(s|IN D

s

, TN D

s

, x0), λi(s|IN D

s

, TN D

s

(λi(s + ∆¯s|IN D

s

, TN D

s

, x0), λi(s + ∆¯s|IN D

s

, TN D

s

(λi(s + M1 · ∆¯s|IN D

s

, TN D

s

, x0), λi(s + M1 · ∆¯s|IN D

s

, TN D

s

(λi(¯sk|IN D

s

, TN D

s

, x0), λi(¯sk|IN D

s

, TN D

s

(λi(¯sk + ∆¯s|IN D

s

, TN D

s

, x0), λi(¯sk + ∆¯s|IN D

s

, TN D

s

f j,i
sk (s + ¯sk; s, ∆s) =

ND
s

ND
s

× · · ·

Xl=0,1 Xl1=0,1
×Ψjl(cid:16)−(ηC(N Y
×Ψli(cid:16)−(ηC(N Y
×Ψjl1− Xi∈ ¯I
×Ψl1l2− Xi∈ ¯I
×ΨlM1 l− Xi∈ ¯I
×Ψl¯l1− Xi∈ ¯I
×Ψ¯l1¯l2− Xi∈ ¯I
×Ψ¯lM2 i− Xi∈ ¯I

× · · ·

ND
s

ND
s

ND
s

ND
s

, x1))T , ∆¯s

, x1))T , ∆¯s

, x1))T , ∆¯s

, x1))T , ∆¯s

, x1))T , ¯sk − s − M1 · ∆¯s

(λi(¯sk + M2 · ∆¯s|IN D

s

, TN D

s

, x0), λi(¯sk + M2 · ∆¯s|IN D

s

, TN D

s

, x1))T , ∆s − ¯sk − M2 · ∆¯s .

18

Similarly, we can get

f j,i
tk (s + ¯tk; β, s, ∆s) =

=0,1

, TN D

s

, xl)

s

s

s

× · · ·

×Ψl ¯M1

, TN D

s

s

, T ∗

N D
s

N D
s

, T ∗

N D
s

N D
s

, TN D

s

s

, TN D

s

s

, TN D

s

s

, TN D

s

s

(λi(¯tk|I ∗

, x0), λi(s|IN D

, x0), λi(¯tk|I ∗

(λi(s + ∆¯s|IN D

(λi(s|IN D

s

, TN D

s

, x0), λi(s + ∆¯s|IN D

(λi(s + ¯M1 · ∆¯s|IN D

, x0), λi(s + ¯M1 · ∆¯s|IN D

=0,1 X¯l1=0,1

s )(x0), ηC(N Y
s )(x0), ηC(N Y

Pjl(¯tk)Pli(∆s − ¯tk)λβ (s + ¯tk|IN D

, x1))T , ∆¯s

, x1))T , ∆¯s

, x1))T , ∆¯s

· · · X¯l ¯M2
s )(x1))T , ¯tk(cid:1)
s )(x1))T , ∆s − ¯tk(cid:1)

Xl=0,1 Xl1=0,1
· · · Xl ¯M1
×Ψjl(cid:0)−(ηC(N Y
×Ψli(cid:0)−(ηC(N Y
×Ψjl1− Xi∈ ¯IN D
×Ψl1l2− Xi∈ ¯IN D
l− Xi∈ ¯IN D
×Ψl¯l1− Xi∈ ¯I ∗
×Ψ¯l1¯l2− Xi∈ ¯I ∗
i− Xi∈ ¯I ∗
where ¯M1 =h ¯tk
∆¯si and ¯M2 =h ∆s−¯tk
∆¯s i.
= Xl1=0,1 Xl2=0,1
· · · XlM =0,1
P (Xt = xj)Ψ0j(cid:0)−(ηC(0)(x0), ηC(0)(x1))T , t(cid:1)
×Ψ0l1(−Pi∈I (λi(0|IN D
×Ψl1l2(−Pi∈I (λi(∆¯s|IN D
×ΨlM j(−Pi∈I (λi(M · ∆¯s|IN D
∆¯s(cid:3).
where M =(cid:2) t

P (Xt = xj, no jump or default in[0, t])

, x0), λi(¯sk + ¯M2 · ∆¯s|I ∗

, x0), λi(M · ∆¯s|IN D

, TN D

, x0), λi(∆¯s|IN D

, TN D

, TN D

, x0), λi(0|IN D

, TN D

(λi(¯sk + ¯M2 · ∆¯s|I ∗

, x0), λi(¯tk + ∆¯s|I ∗

(λi(¯tk + ∆¯s|I ∗

, x1))T , ∆¯s)

×Ψ¯l ¯M2

, TN D

0

, TN D

0

, T ∗

N D
s

N D
s

, T ∗

N D
s

N D
s

, T ∗

N D
s

N D
s

, T ∗

N D
s

N D
s

× · · ·

0

0

0

0

0

0

0

0

N D
s

N D
s

0

0

s

N D
s

× · · ·

, x1))T , ∆¯s

Now we know how to ensure ∆Ψij(s0, u, ∆¯s) < ǫ, and have the formulas for calculating
(s + ¯tk; β, s, ∆s) and P (Xt = xj , no jump or default in[0, t]). We can then

sk (s + ¯sk; s, ∆s), f j,i
f j,i
tk

discuss how to choose ǫ such that the relative error of them can be controlled as small as we

19

, x1))T , ¯tk − s − ¯M1 · ∆¯s

, x1))T , ∆s − ¯tk − ¯M2∆¯s

, x1))T , ∆¯s)

, x1))T , t − M · ∆¯s)

wish, i.e., ζ. Taking f j,i

sk (s + ¯sk; s, ∆s) as an example in the following discussion, the results

related to the others are similar.

Proposition 6 To ensure the relative error of f j,i

sk (s + ¯sk; s, ∆s), i.e.,

| ¯f j,i

sk (s + ¯sk; s, ∆s) − f j,i

sk (s + ¯sk; s, ∆s)|

f j,i
sk (s + ¯sk; s, ∆s)

where f j,i

sk (s + ¯sk; s, ∆s) denotes the real value, ¯f j,i

sk (s + ¯sk; s, ∆s) denotes the value calculated

according to the approximation formula, be less than any arbitrary percentage ζ, we can require
the error of ¯Ψij(s + ∆s, u, ∆¯s) : ǫ, where ∆¯s = − ln(1−ǫ)

K·λmax(s+∆s) , to satisfy the following conditions:

¯sk ·K·λmax(s+∆s)

− ln(1−ǫ)

− ln(1−ǫ)

K

)

¯sk ·K·λmax(s+∆s)

− ln(1−ǫ)

(∆s−¯sk )·K·λmax(s+∆s)

− ln(1−ǫ)

− ln(1−ǫ)

K

)

(∆s−¯sk )·K·λmax(s+∆s)

− ln(1−ǫ)

(cid:20)(1 + ǫ · e

(cid:20)(1 + ǫ · e

+1 − 1(cid:21) < ζ

2

+1 − 1(cid:21) < ζ

2 .

2

2



Proof: Notice that when s1 < s2, the following relationship

− ln(1 − ǫ)
K · λmax(s2)

≤

− ln(1 − ǫ)
K · λmax(s1)

would always be valid. That is to say, when we choose the numerical time step size ∆¯s to
ensure the error of ¯Ψij(s + ∆s, u, ∆¯s) be less than ǫ, this step size would also ensure the error of
¯Ψij(s0, u, ∆¯s) where s0 ∈ [0, s+∆s] be less than ǫ as well. Because P (Xt = xj) and ¯Ψij(s0, u, ∆¯s)
are always less than 1, from the expressions for calculating f j,i

sk (s + ¯sk; s, ∆s) above, to make

sure that the error be less than ζ, we have the following relationships

Xl1=0,1

which implies

and

X¯l1=0,1

which implies

ǫ
¯Ψjl1

ǫ

¯Ψl1l2

) · (1 +

) · · · (1 +

¯Ψjl1 · ¯Ψl1l2 · · · ¯ΨlM1 l

· · · XlM1 =0,1 (1 +

· · · XlM1 =0,1  ( ¯Ψjl1 + ǫ) · ( ¯Ψl1l2 + ǫ) · · · ( ¯ΨlM1 l + ǫ) − ¯Ψjl1 · ¯Ψl1l2 · · · ¯ΨlM1 l
) − 1! <

Xl1=0,1
· · · X¯lM2 =0,1  ( ¯Ψl¯l1 + ǫ) · ( ¯Ψ¯l1¯l2 + ǫ) · · · ( ¯Ψ¯lM2 i + ǫ) − ¯Ψl¯l1 · ¯Ψ¯l1¯l2 · · · ¯Ψ¯lM2 i
) − 1! <

¯Ψl¯l1 · ¯Ψ¯l1¯l2 · · · ¯Ψ¯lM2 i

· · · X¯lM2 =0,1 (1 +

X¯l1=0,1

ǫ
¯Ψ¯l1¯l2

ǫ

¯ΨlM1 l

ǫ

¯Ψ¯lM2 i

) · (1 +

) · · · (1 +

ǫ
¯Ψl¯l1

ζ
2

ζ
2

! <

ζ
2

! <

ζ
2

20

where l = 0, 1. Notice that ¯Ψij(s0, u, ∆¯s), s0 ∈ [s, s + ∆s] in the above would always be greater
K . Thus we can replace each ¯Ψij(s0, u, ∆¯s) in the
than e−λmax(s+∆s)·∆¯s which is equal to e

ln(1−ǫ)

above with e

ln(1−ǫ)

K

to ﬁnd ǫ according to ζ. Also, note that

M1 ≤

¯sk · K · λmax(s + ∆s)

− ln(1 − ǫ)

and M2 ≤

(∆s − ¯sk) · K · λmax(s + ∆s)

− ln(1 − ǫ)

,

then the above equations can be rewritten as follows:

2M1(cid:20)(1 +
2M2(cid:20)(1 +

ǫ

ln(1−ǫ)

K

ǫ

ln(1−ǫ)

K

e

e

)M1+1 − 1(cid:21) ≤ 2
)M2+1 − 1(cid:21) ≤ 2



¯sk ·K·λmax(s+∆s)

− ln(1−ǫ)

¯sk ·K·λmax(s+∆s)

− ln(1−ǫ)

)

(∆s−¯sk )·K·λmax(s+∆s)

− ln(1−ǫ)

(∆s−¯sk )·K·λmax(s+∆s)

− ln(1−ǫ)

(cid:20)(1 +

ln(1−ǫ)

ǫ

K

e

(cid:20)(1 +

ǫ

ln(1−ǫ)

e

K

)

+1 − 1(cid:21) < ζ

2

+1 − 1(cid:21) < ζ

2

All the conditions related to the relative errors of f j,i

sk (s + ¯sk; s, ∆s), f j,i
tk

(s + ¯tk; β, s, ∆s) and

P (Xt = xj , no jump or default in[0, t]) similar to the above proposition should be satisﬁed to

ﬁnd a suitable ǫ. Therefore, the relative errors are controlled and the error of P (Xt = xi|Ft) is

also controlled.

We remark that suppose the expiry time is denoted as Texpiry, then all λmax(s0), s0 ∈ [0, Texpiry]

in proposition 5 and proposition 6 could simply be replaced by λmax = λmax(Texpiry).

6 Numerical Experiments

In the following numerical experiments, for the conﬁguration of the parameters value in the

hidden Markov chain Xt, we let the transition rates be θ0 = 0.1 and θ1 = 0.1, the initial state

x0 = 0. For the observable chain Yt, we set the transition rates

and

η0(x) =
η1(x) =

0.1, x = x0

0.2, x = x1

0.2, x = x0

0.1, x = x1.

and the initial state is y0 = 0 as we assumed. The risk-free interest rate r is assumed to be 5%.

6.1 Numerical Example 1

We consider the pricing of Credit Default Swaps (CDS). Assume that the buyer of the CDS

agrees to pay premiums to the seller continuously over time at a ﬁxed rate until the expiration

time of the CDS contract. If the reference asset defaults prior to the expiry, then the seller will

21

pay $1 to the buyer. Denote the seller as entity A, buyer as entity B and the reference asset of

the CDS as entity C. Denote τ A, τ B, τ C the default times and λA, λB, λC the default intensities

of entities A, B and C, respectively. Here the default intensities of these homogeneous three

entities are assumed in the following form:

λi(t) = a + b · X(t) + c ·Xj6=i

1{τ j ≤t} ,

i, j = A, B, C

where a, b and c are constants, X(t) represents the hidden state process andPj6=i 1{τ j ≤t} repre-

sents the default processes which are observable. Let y be the ﬁxed premium rate, and suppose

the issue time of the swap contract is 0, the expiry time is T , and we are at time s, then the

present value of the premium payment from the buyer should be

E(cid:20)Z T

0

e−rsy1{s<τ A,s<τ B,s<τ C }ds(cid:21) .

This means if any one of the three entities defaults, the buyer of the CDS contract would stop

paying the premium. Similarly, the present the value of the seller should be

Ehe−rT 1{T <τ A,T <τ B,τ C ≤T }dsi .

According to these two expressions, one can obtain the premium of the CDS in the following

form:

y =

E(cid:16)e−rT 1{T <τ A,T <τ B,τ C ≤T }ds(cid:17)
E(cid:16)R T
0 e−rs1{s<τ A,s<τ B,s<τ C }ds(cid:17) .

From the above formula, we know that to calculate y, we need to compute the joint density

function f (s < τ A, s < τ B, s < τ C) and the joint probability P (T < τ A, T < τ B, τ C ≤ T ).

Notice that f (s < τ A, s < τ B, s < τ C ) is actually equal to f (τ 1 > s) where τ 1 denotes the time

of the ﬁrst default out of the 3 entities, and P (T < τ A, T < τ B, τ C ≤ T ) = P (τ 1 ≤ T < τ 2).

Here τ 1 has the same meaning as before, τ 2 denotes the time of the second default in the reference

portfolio. Then we can apply the methods introduced in the previous sections to calculate the

ﬁxed premium rate y. The base setting of parameters are as follows. For the contagion factors,

we let a = 1, b = 0.1, c = 0.1. The expiry T is 5 years, and the initial time is 0. We change the

coeﬃcients a, b and c in the expressions of default intensities separately, and each time we keep

the remaining coeﬃcients unchanged to investigate the change in the CDS premium rate y.

From the above three ﬁgures, we ﬁnd that the value of CDS premium rate y decreases as

the coeﬃcients a, b, and c increase.

22

×10-3

8

7

6

5

4

3

i

y
 
m
u
m
e
r
p
 
S
D
C

2
1.5

1.51

1.52

1.53

1.54

1.55

1.56

change with a

×10-3

8

7.5

i

y
 
m
u
m
e
r
p
 
S
D
C

7

6.5

6

1.57

1.58

1.59

1.6

5.5

0.1

0.11

0.12

0.13

×10-3

8

7.5

i

y
 
m
u
m
e
r
p
 
S
D
C

7

6.5

6

5.5

0.1

0.17

0.18

0.19

0.2

0.11

0.12

0.13

0.14

0.15

change with c

0.16

0.17

0.18

0.19

0.2

0.14

0.15

0.16

change with b

(a) premium y change with respect to a

(b) premium y change with respect to b

(c) premium y change with respect to c

Figure 1: Change of premium y with coeﬃcients

6.2 Numerical Example 2

We then consider a kth-to-default basket CDS contact. Assume that our portfolio contains

K = 10 homogeneous entities, if k entities out of this portfolio default prior to the expiry time,

then $1 will be paid. For simplicity, this payment only occurs at the expiry time, but the

payment of premium occurs at the initial time. Similar to the previous experiment, the entity

i’s default intensity is given by

λi(t) = a + b · X(t) + c ·Xj6=i

1{τ j ≤t} ,

i, j = 1, 2, · · · , K.

The value of this kth-to-default basket CDS at time t can be written as

Vk(t) = exp{−r(T − t)}P (τ k ≤ T | Ft)

where τ k denotes the kth-to-default time. For the state of chain X, x0 and x1 represent the

“good” and “bad” economic state, respectively. While States y0 and y1 of chain Y represent

the delayed information of “bad” economic state and “good” economic state, respectively. Here

we also assume that the total number of entities in the portfolio is K = 10. The calculation of

P (τ k ≤ T | Fs) can be obtained from 1 − P (τ jk > T | Fs) where

P (τ jk > t | Fs) =

k−1Xi=m

P (τ ji ≤ t < τ ji+1 | Fs).

The calculation of the probability P (τ ji ≤ t < τ ji+1 | Fs) is similar to the calculation of

P (τ 1 ≤ t < τ 2) in Experiment 1. Without loss of generality, for simplicity, we consider the

1st-to-default basket CDS as k = 1. We further assume that the initial time is 0, and that

we are at time t = 10 days now, and that the expiry time is T = 100 days. In the following

23

0.7635

0.763

0.7625

e
m

i
t
 

e
h

t
 

no jump or default

one jump occurred at day 21

0.762

l

g
n
o
a
S
D
C

 

 
t

e
k
s
a
b

 
f

o

 

e
u
a
v

l

0.7615

0.761

0.7605

0.76

10

15

20

25

30

time: days

35

40

45

50

Figure 2: Change of CDS’s value from day to day with the 1st default intensities

experiments, we consider two scenarios. In Scenario 1, there is no jump in chain Y and default

observed by expiry time. In Scenario 2, there is one jump in chain Y between day 21 and day

22 but no default observed by expiration. According to the assumptions presented in Section 2,

we know that the initial state of chain X is x0 = 0 and the initial state of chain Y is y0 = 0. In

addition, let the coeﬃcients in default intensities be a = 0.001, b = 0.001, and c = 0.001. Then

one can see the change of basket CDS values from day to day, and here we only provide the

values from day t = 10 to day t = 50 as an example.

From the ﬁgure we can see that as time goes by, the general tendency of basket CDS’s value

is increasing. When there is one jump in chain Y from state y0 to state y1, the value will drop

suddenly. It is because at the beginning, the information of chain Y reﬂected a “bad” economic

condition, when it changed to state y1 which representing a “good” economic state, intuitively,

the probability of defaults will drop suddenly, and the value of basket CDS will therefore drop

suddenly as well.

As we mentioned before, our model and methods may be applicable to various forms of

24

e
m

i
t
 

e
h

t
 

l

g
n
o
a
S
D
C

 

 
t

e
k
s
a
b

 
f

o

 

e
u
a
v

l

0.3775

0.377

0.3765

0.376

0.3755

0.375

0.3745

0.374

0.3735

0.373

0.3725

10

no jump or default

one jump occurred at day 21

15

20

25

30

time: days

35

40

45

50

Figure 3: Change of CDS’s value from day to day with the 2nd default intensities

default intensities. Therefore, we further consider another form of default intensities which

decay exponentially with time. The expression is as follows:

λi(t) =a + c ·Xj6=i

1{τ j ≤t} e−t + b · X(t),

i, j = 1, 2, . . . , K.

Same as before, all parameters in this default intensity keep the same as the previous case, then

we can also calculate the value of basket CDS and observe it from day to day.

From the ﬁgure, we notice that the overall value based on this form of default intensity is

smaller than the previous one. The phenomenon can be explained as follows. As the default

intensity exponentially decreased with time, the default probability will become smaller accord-

ingly and therefore the value of basket CDS. For the same reason and similar explanations like

before, the value will also jump down suddenly when one jump in observable chain Y from state

y0 to y1 occurred.

25

7 Concluding Remarks

In this paper we present a reduced-form intensity-based credit risk model with a hidden Markov

process modeling the evolution of economic condition over time. We also discuss a method to

extract the underlying hidden state process from observable processes: the default processes and

the stochastic process which reﬂects the delayed and noisy information about the hidden state

process. The method may have a wide range of applications. Based on this, we develop a closed-

form expression to obtain the joint default distribution with the hidden state process. After

deriving this general formula, for the homogeneous contagion portfolio, we also give analytical

formulas for the distribution of ordered default times. Beside, we extend the total hazard

construction method to get the joint distribution of default times for hidden markov models.

We remark that the methods discussed may be applicable to various forms of default intensities.

Algorithms for practical implementation of the methods are presented and their uses for pricing

credit derivatives are illustrated.

In the numerical experiments, we consider valuations for

the CDSs premium rates of the regular and basket type with diﬀerent expressions of default

intensities which cover an exponential decay and a stochastic intensity process. We also study

the sensitivities of premium rates with respect to changes in the underlying parameters in the

regular CDS as an example.

Acknowledgements

This research work was supported by Research Grants Council of Hong Kong under Grant

Number 17301214 and HKU CERG Grants and HKU strategic Research Theme in Information

and Computing.

References

[1] F. Black and M. Scholes, The pricing of options and corporate liabilities, Journal of Political

Economy, 81(3), 637–654, 1973

[2] D. Brigo, A. Pallavicini & R. Torresetti, Calibration of CDO tranches with the dy-

namical generalized-Poisson loss model, Working Paper, Banca IMI, 2006, available at

http://papers.ssrn.com/sol3/papers.cfm?abstract id=900549.

26

[3] R. Cont and A. Minca, Recovering portfolio default intensities implied by CDO quotes, Math-

ematical Finance. doi: 10.1111/j.1467-9965.2011.00491.x, 2011

[4] M. Davis and V. Lo, Modeling default correlation in bond portfolios, in C. Alexander (Ed.),

Mastering Risk Volume 2: Applications, Prentice Hall, 141-151, 2001.

[5] R. J. Elliott, M. Jeanblanc and M. Yor, (2000), On Models of Default Risk, Mathematical

Finance, 10(2), 179195.

[6] R.J. Elliott and T.K. Siu, (2013), An HMM Intensity-Based Credit Risk Model and Filtering,

State-Space Models and Applications in Economics and Finance, Statistics and Econometrics

in Finance, Volume 1, (edited by Yong Zeng and Shu Wu), Springer-Verlag, pp. 169-184.

[7] R.J. Elliott, T.K. Siu and E.S. Fung, (2014), A Double HMM Approach to Altman Z-scores

and Credit Ratings, Expert Systems With Applications, 41(4-2), pp. 1553-1560.

[8] Frey, R., and W. Runggaldier, (2010), Pricing credit derivatives under incomplete informa-

tion: a nonlinear-ﬁltering approach, Finance and Stochastics, 14 (4) pp. 495-526.

[9] Frey, R., and W. Runggaldier, (2011), Nonlinear Filtering in Models for Interest Rate and

Credit Risk, Chapter 32 in Handbook of Nonlinear Filtering, D. Crisan, B. Rozovski, eds.,

Oxford University Press.

[10] Frey, R., and T. Schmidt, (2011) Filtering and Incomplete Information in Credit Risk,

Chapter 7 in Recent Advancements in the Theory and Practice of Credit Derivatives, Dami-

ano Brigo, Tom Bielecki and Frederic Patras, ed., Wiley, New Jersey.

[11] Giesecke, K. (2008), Portfolio Credit Risk: Top-Down vs. Bottom-Up Approaches, in: Fron-

tiers in Quantitative Finance: Credit Risk and Volatility Modeling, R. Cont (Ed.), Wiley.

[12] K. Giesecke and L. Goldberg, Sequential defaults and incomplete information, Journal of

Risk, 7(1), 1–26, 2004.

[13] K. Giesecke, L. Goldberg and X. Ding, A top down approach to multi-name credit, Opera-

tions Research, 59(2), 283–300, 2011.

[14] J. Gu, W. Ching, T. Siu and H. Zheng, On pricing basket credit default swaps, Quantitative

Finance, 13(12), 1845–1854, 2013.

27

[15] J. Gu, W. Ching and H. Zheng, A hidden Markov reduced-form risk model, Computational

Intelligence for Financial Engineering & Economics, 2014 IEEE Conference, 190–196, 2014.

[16] D. Duﬃe and N. Garleanu, Risk and valuation of collateralized debt obligations, Financial

Analysts Journal, 57(1), 41–59, 2001.

[17] D. Duﬃe, L. Saita and K. Wang, Multi-period corporate default prediction with stochastic

covariates, Journal of Financial Economics, 83(3), 635–665, 2006.

[18] R. Jarrow and S. Turnbull, Pricing derivatives on ﬁnancial securities subject to credit risk,

Journal of Finance, 50, 53–86, 1995.

[19] R. Jarrow and F. Yu, Counterparty risk and the pricing of defaultable securities, Journal of

Finance, 56(5), 555–576, 2001.

[20] D. Lando, On Cox processes and credit risky securities, Review of Derivatives Research, 2,

99–120, 1998.

[21] F. Longstaﬀ and A. Rajan, An empirical analysis of collateralized debt obligations, Journal

of Finance, 63(2), 529–563, 2008.

[22] R. Merton, On the pricing of corporate debt: the risk structure of interest rates, Journal of

Finance, 29(2), 449–470, 1974.

[23] D. Madan and H. Unal, Pricing the risks of default, Review of Derivatives Research, 2(2-3),

121–160, 1998.

[24] I. Norros, A compensator representation of multivariate life length distributions, with ap-

plications, Scand. J. Stat., 13, 99–112, 1986.

[25] M. Shaked and G. Shanthikumar, The multivariate hazard construction, Stoch. Proc. Appl,

24, 241–258, 1987.

[26] P. Sch¨onbucher and D. Schubert, Copula-dependent default risk in intensity models, Work-

ing paper, Universit at Bonn, 2001.

[27] F. Yu, Correlated defaults in intensity-based models, Mathematical Finance, 17(2), 155–173,

2007.

[28] H. Zheng and L. Jiang, Basket CDS pricing with interacting intensities, Finance and

stochastics, 13, 445–469, 2009.

28

