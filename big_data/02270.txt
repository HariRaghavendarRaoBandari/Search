The Astrophysical Journal Supplement
Preprint typeset using LATEX style emulateapj v. 5/2/11

INSIGHTS FROM SYNTHETIC STAR-FORMING REGIONS:

I. RELIABLE MOCK OBSERVATIONS FROM SPH SIMULATIONS

Christine M. Koepferl1,2, Thomas P. Robitaille1,3, James E. Dale4, and Francesco Biscani1

1 Max Planck Institute for Astronomy, K¨onigstuhl 17, D-69117 Heidelberg, Germany

2 Scottish Universities Physics Alliance (SUPA), School of Physics and Astronomy, University of St Andrews

3 Freelance Consultant, Headingley Enterprise and Arts Centre, Bennett Road Headingley, Leeds LS6 3HN

4 University Observatory Munich, Scheinerstr. 1, D-81679 Munich, Germany

North Haugh, St Andrews, KY16 9SS, UK

6
1
0
2

 
r
a

M
7

 

 
 
]

.

R
S
h
p
-
o
r
t
s
a
[
 
 

1
v
0
7
2
2
0

.

3
0
6
1
:
v
i
X
r
a

(Received 29 January 2016; Accepted 1 March 2016)

The Astrophysical Journal Supplement

ABSTRACT

Through synthetic observations of a hydrodynamical simulation of an evolving star-forming region,
we assess how the choice of observational techniques aﬀects the measurements of properties which
trace star formation. Testing and calibrating observational measurements requires synthetic observa-
tions which are as realistic as possible. In this part of the paper series (Paper I), we explore diﬀerent
techniques for how to map the distributions of densities and temperatures from the particle-based
simulations onto a Voronoi mesh suitable for radiative transfer and consequently explore their ac-
curacy. We further test diﬀerent ways to set up the radiative transfer in order to produce realistic
synthetic observations. We give a detailed description of all methods and ultimately recommend tech-
niques. We have found that the ﬂux around 20 µm is strongly overestimated when blindly coupling
the dust radiative transfer temperature with the hydrodynamical gas temperature. We ﬁnd that
when instead assuming a constant background dust temperature in addition to the radiative transfer
heating, the recovered ﬂux is consistent with actual observations. We present around 5800 realistic
synthetic observations for Spitzer and Herschel bands, at diﬀerent evolutionary time-steps, distances
and orientations. In the upcoming papers of this series (Paper II, Paper III and Paper IV), we will
test and calibrate measurements of the star-formation rate (SFR), gas mass and the star-formation
eﬃciency (SFE) using our realistic synthetic observations.

1.

INTRODUCTION

Over the last decade, progress in the ﬁeld of star for-
mation has been fueled by an increasing number of large
infrared/optical surveys of our Galaxy (e. g. from space
missions, such as Hubble, Spitzer, Herschel, Planck, and
ground missions, such as Two Micron All-Sky Survey
(2MASS), UKIRT Infrared Deep-Sky Survey (UKIDSS)
and ATLASGAL and a growing number of state-of-the-
art simulations of entire star-forming regions with in-
creasing quality and diversity (e. g. Orion, SPH-NG,
Arepo;
for more details and recent application, see
e. g. Oﬀner et al. 2012, Bate 2014, Springel 2010a).
Thanks to recent advances in radiative transfer tech-
niques (in particular 3-d Monte-Carlo radiative trans-
fer; for more details, see the review of Steinacker et al.
2013) we are now able to produce synthetic observations
of star-forming regions. Synthetic observations have the
potential, when constructed with great care and eﬀort,
to close the loop between simulations and observations.
Through synthetic observations:

1. On the one hand,

simulations can be tested
to see whether they reproduce features seen in
observations. Whether certain physical processes
are dominant over other processes can be tested
with synthetic observations by comparing the
mock observations of simulated parameter studies
to real observations.

2. On the other hand, synthetic observations allow us

cmk8@st-andrews.ac.uk

to test and calibrate techniques that are used by
the community to infer properties related to star
formation. Since the intrinsic properties of the sim-
ulations (e. g. SFRs, gas masses, ﬁlament widths)
are known, the accuracy of the observational de-
termination can be explored. Such an approach
enables us also to improve existing techniques and
to develop new techniques that can produce better
measurements.

Lately, there have been many attempts to use syn-
thetic observations with respect to their potential listed
above. For example, Kurosawa et al. (2004) used one
small-scale simulation of a star-forming region from Bate
et al. (2002a,b, 2003). They mapped their initial particle-
based simulation output onto an Adaptive Mesh Reﬁne-
ment (AMR) grid and included the density proﬁle of a
protoplanetary disk close to their stellar accretion par-
ticles (represented by sink particles, for more details on
sink particles see Bate et al. 1995). With their parameter
study that included set-ups with and without accretion
disks, they developed classiﬁcation criteria for accretion
disks in the mid-infrared (MIR).

Oﬀner et al. (2012) also used a simulation of a small-
scale star-forming region to estimates the quality and
reliability of properties inferred for protostars from SED-
ﬁtting techniques. In contrast to Kurosawa et al. (2004),
they did not reﬁne the input density of the simulation
further, e. g. with a protoplanetary disk, since the orig-
inal resolution was suﬃcient to recover the ﬂux of con-
tributing regions, while unresolved regions were too opti-

2

Koepferl, Robitaille, Dale, Biscani

cally thick to produce ﬂux in the ”observed” wavelength
bands.

Up until now, most studies with synthetic observations
have focused on simulations of star-forming regions below
the pc-scale. Moreover, usually only one snapshot from
a simulation is tested, rather than several evolutionary
time-steps of the same simulation for diﬀerent orienta-
tions and distances, which would improve the reliability
of the conclusions.

We believe that the sequence of simulations initiated
by Dale & Bonnell (2011) is a good choice for producing
and exploring the applications of synthetic observations,
since they cover large-scale single star-forming regions
with sizes on the order of several tens of pc. The ini-
tial simulation in this sequence of many published SPH
simulated star-forming regions covered only one simu-
lated star-forming cluster which satisﬁes the modiﬁed1
Larson (2005) EOS with an isothermal dust cooling part
at 7.5 K and a line cooling process, but lacks stellar feed-
back mechanisms such as heating through radiation, ion-
ization2 & winds. This initial simulation was extended
by diﬀerent high-mass stellar feedback mechanisms, such
as ionization (see Dale et al. 2007 for the formalism), in-
troduced by Dale et al. (2012) for bound and Dale et al.
(2013a) for unbound clouds. Further, Dale et al. (2013b)
introduced winds as feedback of bound and unbound
clouds (see Dale & Bonnell 2008 for the formalism). A
combination of the initial high-mass stellar feedback pa-
rameter study (ionization & wind) for bound and un-
bound clouds was presented by Dale et al. (2014). With
this large set of simulations, these authors are studying
the impact of feedback on the star-forming regions. For
example, in Dale et al. (2014), they compare the eﬀects
of diﬀerent feedback mechanisms on the SFR and SFE.
For simplicity, we will hereafter refer to this set of simu-
lations as the D14 SPH simulations.

In this paper, hereafter referred to Paper I, we will
produce realistic synthetic observations of a simulated
star-forming region at diﬀerent stages of evolution, ori-
entations and distances from the D14 SPH simulations.
We use the 3-d dust continuum Monte-Carlo radiative
transfer code Hyperion, developed by Robitaille (2011),
to produce ideal synthetic observations. Hyperion uses
a gridded density distribution. In the radiative transfer
code, photon packets are emitted from the stellar sources
and travel through the density distribution and interact
with the dust. They can get scattered, absorbed or re-
emitted by the dust grains. Hyperion calculates the
speciﬁc energy absorbed by the dust resulting from this
stellar heating and estimates the dust temperature, and
ideal synthetic images can be produced. For more de-
tails about Hyperion and radiative transfer in general
see Robitaille (2011) and Steinacker et al. (2013).

1.1. Motivation

In this paper (Paper I), we will describe the set-up
and the post-processing of radiative transfer models us-
ing particle-based simulations as input. Note that we will

1 The equation of state (EOS) has been adjusted to recover a

Jeans mass MJeans of 0.5 M(cid:12).

2 Dale & Bonnell (2011) also had an ionization description im-
plemented but the impact was rather small because their simulated
region had a large escape velocity.

TABLE 1

Summary of Properties

of the run I Simulated Star-forming Region.

time-step

(ID)

time
(Myr)

r(M1/2)

(pc)

sink

particles

Mgas
(M(cid:12))

feedback

on?

024
025
026
027
028
029
030
031
032
042
052
062
072
082
092
102
112
122
132
142
152
162
172

3.576
3.725
3.874
4.023
4.172
4.321
4.470
4.619
4.768
4.917
5.066
5.215
5.364
5.513
5.662
5.811
5.960
6.109
6.258
6.407
6.556
6.705
6.854

8.45
8.52
8.60
8.70
8.77
8.83
8.89
8.94
9.01
9.08
9.27
9.58
9.91
10.30
10.79
11.30
11.84
12.37
12.94
13.50
14.09
14.69
15.33

3
4
12
15
17
21
30
32
44
48
48
53
61
73
85
91
98
100
108
115
122
125
128

9873
9825
9750
9664
9593
9536
9476
9414
9341
8833
8643
8598
8495
8377
8187
7987
7722
7500
7254
6996
6687
6409
6105

no
no
no
no
no
no
no
no
no
yes
yes
yes
yes
yes
yes
yes
yes
yes
yes
yes
yes
yes
yes

not focus on the calculations with the radiative trans-
fer code itself. Rather we will explore diﬀerent methods
for how to set up the radiative transfer using the data
from the SPH simulations and in order to produce re-
alistic synthetic observations from the radiative transfer
output. We go through this eﬀort, so that we can ﬁnd
reliable techniques, to recover the infrared ﬂux as accu-
rately as possible, which is commonly used by observers
to interpret star-forming regions.

1.2. Outline

In Section 2, we will introduce the D14 SPH simula-
tions in more detail, show the evolution of properties over
the relevant time-steps and justify the pre-processing
steps to make the simulation sample suitable for the
radiative transfer set-up. In Section 3, we will present
diﬀerent approaches for discretizing an SPH simulation
onto a radiative transfer grid such as a Voronoi mesh.
Aspects of setting up radiative transfer photon sources
are discussed in Section 4, before the careful set-up of
circumstellar material is described in Section 5. In Sec-
tion 6, diﬀerent dust properties and temperature combi-
nations and their eﬀects on the radiative transfer output
are explored. We give suggestions in the respective sec-
tions on which of the methods (explored in Section 2 to
Section 6) to favor. The post-processing of the radiative
transfer output is described in Section 7 and the result-
ing realistic synthetic observations are presented there.
In Section 8, we summarize caveats when transferring
simulations to ”observations”.

In (Koepferl et al. 2016a, submitted) and (Koepferl
et al. 2016b, submitted), hereafter referred to Paper II
and Paper III, we use the resulting realistic synthetic
observations at diﬀerent evolutionary stages to test and
calibrate techniques which measure properties, such as
the SFR, the gas mass and the SFE.

Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

3

Fig. 1.— (Left) MIR Wide-ﬁeld Infrared Survey Explorer (WISE) observationa of the Soul Nebula star-forming region (blue: 3.4 µm,
cyan: 4.6 µm, green: 12 µm, red: 22 µm), (right) column density structure of a simulated star-forming region from the D14 smoothed
particle hydrodynamics (SPH) simulationsb with high-mass stellar feedback (ionization-only).
aOnline references accessed: 30.08.2015; http://www.jpl.nasa.gov/spaceimages/details.php?id=PIA13112
Courtesy NASA/JPL-Caltech/UCLA
bSurface density maps provided by Jim Dale.

2. HYDRODYNAMICAL SIMULATIONS

detailed review, see Springel 2010b):

The D14 SPH simulations are a set of over 20 diﬀerent
realizations with diﬀerent initial conditions for initially
bound and unbound star-forming regions. Furthermore,
for every realization, diﬀerent combinations of high-mass
stellar feedback mechanisms, such as ionization alone,
winds alone, winds & ionization coupled, are calculated.
The morphological features and physical scale of the sim-
ulations (half-mass radii r(M1/2) from 1 pc to 100 pc) are
of the same order as those of observed regions with high-
mass star formation in the Galactic plane. This can be
seen in Figure 1, where we show a three-color MIR WISE
observation of the Soul Nebula (left, Koenig et al. 2012;
Wright et al. 2010) and the column density structure of
one snapshot from the D14 SPH simulations including
high-mass stellar feedback in form of ionization (right).
As mentioned in Section 1, the D14 SPH simulations are
in some sense unique in the community since they cover
single star-forming regions on large scales of the order of
several tens of parsec with diﬀerent feedback scenarios.

2.1. Simulation Properties

The density distribution in particle-based simulations,
such as the D14 SPH simulations, is approximated by the
sum of many individual SPH particles with an analytical
description.

2.1.1. SPH Particles

From the simulation output, we know the position of
an SPH particle i, its peak density ρi,SPH, its hydro-
dynamical gas temperature Ti,SPH, its constant particle
mass of mi,SPH = 10−2 M(cid:12)3 and its smoothing length
hi. A SPH particle i has a 3-d Gaussian-like proﬁle. The
proﬁle strength at position j with distance rij from the
SPH particle i is deﬁned by the kernel function (for a

3 This is only true for the simulated clouds with a total
mass of Mcloud = 104 M(cid:12) for instance run I, since mi,SPH =
Mcloud/NSPH, with the total SPH particle number NSPH being
1e6.

Wij(rij, hi) =

(cid:40)1 − 1.5(rij/hi)2 + 0.75(rij/hi)3

0.25(2 − (rij/hi))3

×

1
h3
i π

0

∀ hi ≤ rij < 2hi.

∀ rij < hi
∀ rij > 2hi

(1)

2.1.2. Sink Particles

The stellar particles in an SPH simulations are repre-
sented by sink particles (Bate et al. 1995). They form
from SPH particles which are bound by the gravitational
potential of a forming stellar object and follow the fol-
lowing conditions:

• Density Threshold

The density threshold is evaluated from the mini-
mal resolvable Jeans mass MJeans and the isother-
mal temperature in the simulations. SPH parti-
cles, which have higher densities than the threshold
density, are tracked and the nearest neighbors are
tested by the following conditions.

• Jeans Limit

The average density and temperature of the group
of SPH particles. The resulting mean total mass
of the group should be higher than the Jeans mass
MJeans.

• Potential

The group should be gravitationally bound.

• Velocity Field

The group should have a negative divergence of the
velocity ﬁeld at the location of the densest particle
of the group which indicates a collapse.

• Energy Balance

The group of collapsing SPH should also have a
higher gravitational energy than its rotational ki-
netic energy to ensure that the collapse cannot be
stabilized by angular momentum conservation.

6pc                                                                      3pc4

Koepferl, Robitaille, Dale, Biscani

In the D14 SPH simulations, a sink particle forms once
more than 50 SPH particles satisfy the above conditions
at a given position. In Table 1 we give the number of
sink particles at diﬀerent time-steps in one of the D14
SPH simulations.

From the minimum resolved Jeans mass MJeans, a re-
spective length scale, called the accretion radius racc,
is calculated, which is comparable to the Jeans length
λJeans. SPH particles are accreted by a sink particle when
they are within the accretion radius racc, are gravitation-
ally bound by the sink particle’s potential and have low
enough rotational energies. The sink particles4 grow over
time through accretion of many SPH particles.

2.1.3. Feedback

High-mass stellar feedback is switched on in the D14
SPH simulations as soon as three high-mass sink particles
above 20 M(cid:12) have formed5. The simulation ends before
the ﬁrst supernova of a high-mass sink particle would
presumably go oﬀ.

2.1.4. Run I

In this work, we explore the run I of the D14 SPH sim-
ulations an intermediate mass cloud with a total gas mass
of 104 M(cid:12) and initially 106 SPH particles. We choose this
run because it is of relatively high resolution with a sink
accretion radius of racc = 0.005 pc. Individual stellar ob-
jects in the form of sink particles with masses between
0.5 M(cid:12) and 70 M(cid:12) are produced and can be resolved,
and therefore can be interpreted as single stars. The
ﬁrst stars formed after about 3.6 Myr after the start of
the simulation (see also Section 2.1.6). The stars in the
simulation grow through accretion (see also Section 2.1.7)
and ensures that the stellar population aquires its own
initial mass function (IMF) without imposing an initial
IMF to the simulation (see Dale et al. 2012).

We choose run I because we aim to produce synthetic
observations which are as close to real star-forming re-
gions as possible. Therefore, for our studies, we limit
ourselves to the coupled feedback scenario:
ionization
& winds. The ionizing sources in the simulations emit
a ﬂux of ionized photons ranging from 1.3 × 1048 s−1
to 1.0 × 1049 s−1. They also emit winds6 with a speed
ranging from 1780 km s−1 to 3125 km s−1 and a re-
spective mass-loss rate between 3.1 × 10−7 M(cid:12) yr−1 to
2.8 × 10−6 M(cid:12) yr−1. For a detailed description of the
high-mass feedback formalism, see Dale (2015); Dale
et al. (2013b, 2012); Dale & Bonnell (2008); Dale et al.
(2007).

In run I the ﬁrst stars formed after about 3.6 Myr,
high-mass stellar feedback is switched on about 4.8 Myr
and the simulation is stopped at about 7 Myr after the
start of the simulation. The simulation is stopped before
the ﬁrst supernova7 would presumably go oﬀ. We select

4 For the intermediate mass clouds of the D14 SPH simulations
sink particles as low as 0.5 M(cid:12) can be formed and the sink parti-
cles and represent stars. For clouds above 105 M(cid:12), which are not
subject of this paper, sink particles represent subclusters.

5 This is only true for intermediate mass clouds below 105 M(cid:12)

in the D14 SPH simulations.

6 only modeled as momentum ﬂuxes
7 Note that the supernova explosion is not part of the D14
SPH simulations. For further information about the supernova
(e. g. timing) see the D14 SPH simulations.

23 time-steps with a constant step size ∆t = 149 000 yr,
starting once the ﬁrst star has formed. At every time-
step tstep and for every sink particle, we keep track of
the physical properties, such as the sink particle mass
Msink(tstep), the age of the sink particle tage(tstep) and
the accretion rate ˙Macc(tstep). For more details see Ta-
ble 1.

2.1.5. Sink Particle Mass

The sink particle mass is deﬁned as the sum over all

Nacc accreted SPH particles i:

Nacc(cid:88)

Msink(tstep) =

mi,SPH.

(2)

i=1

2.1.6. Sink Particle Age

Hereafter, we deﬁne the age of a sink particle as

tage(tstep) = tstep − tappear + ∆t/2,

(3)

where tappear is the time of the time-step when a sink
particle ﬁrst forms (binds more then 50 SPH particles).
We add the time ∆t/2 to the age because the sink parti-
cle may have formed at any time between the time-step
when it appeared and the previous one, and therefore on
average we assume that it formed half way in between
the two.

2.1.7. Sink Accretion Rate

We consider a sink particle to be accreting between

two diﬀerent time-steps, when
accretion|tstep→tstep+1 = Msink(tstep+1) > Msink(tstep). (4)
The accretion deﬁnition becomes important when map-
ping the SPH simulation to the Voronoi mesh as de-
scribed in Section 3. We deﬁne the accretion rate at a
time tstep as the mass-gain rate between two time-steps:

˙Macc(tstep) =

Msink(tstep+1) − Msink(tstep−1)

.

(5)

2∆t

2.2. Pre-processing the SPH Simulation Output

In subsequent sections, we want to extract high-
resolution radiative transfer images (see Section 7) with
constant pixel number and pixel-size scale over all time-
steps. Since we are only interested in the inner region of
the simulation, we spatially clip the simulations in order
to save computational resources. The clear trade-oﬀ is
that we are then not always tracing the same amount of
mass in each time-step.

We clip the D14 SPH simulation output in physical
size to a cube with length 30 pc. For the ﬁrst time-steps,
the star-forming region is completely contained inside
the box; once the high-mass stellar feedback has been
switched on, the region expands beyond the boundaries
of the cube. In the ﬁnal time-steps, the boundaries of the
cube are approximately the half-mass radius r(M1/2) of
the simulations. More detailed values are provided in
Table 1, where we summarize some properties of run I
at every time-step.

In the following, we investigate two possible selection
methods to single out the appropriate sample of SPH
particles for the respective radiative transfer set-up:

Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

5

Fig. 2.— Temperature relation in density and radius of SPH particles and a 2-d projection showing the temperature increase at the edges

of the simulation at time-step 122 (6.109 Myr).

2.2.1. Method c1 — Neutral SPH Particles in Box

While the D14 SPH simulations have high-mass stellar
feedback mechanisms implemented, the simulations do
not take into account the dust heating from the stars.
In D14 SPH simulations, the external heating through
the diﬀuse Galactic radiation ﬁeld is approximated by
the Larson (2005) EOS8 rather than just an isothermal
approximation. The EOS contains the following regimes
(following Equation 1 and Figure 1 of Dale et al. 2012):

• line cooling processes

P ∼ ρ3/4
∀ ρ < 5.5 × 10−19 g cm−3

• dust cooling processes
P ∼ ρ1.0
∀ 5.5 × 10−19 g cm−3 < ρ < 5.5 × 10−15 g cm−3,

(6)

(7)

where P is the gas pressure and ρ the gas density. Since
in the ideal gas approximation (see Feynman 1977), the
pressure P always follows

P = N kBT /V = ρkBT /mp ∼ ρT,

(8)

with gas particle number N , the Boltzmann constant kB,
the gas temperature T , the gas particle mass mp and the
gas Volume V , we can also express the line cooling term
from Eq. 6 as a power-law of density ρ and temperature
T :

P ∼ ρT ∼ ρ3/4 → ρ ∼ T −4.

(9)

At high densities, dust cooling is assumed to dominate
and the EOS becomes isothermal with Tiso = 7.5 K. The
densities in large parts of the cloud are low enough that
the gas and dust should not be well coupled thermally.

In Figure 2(a), we have plotted temperature ver-
sus density for time-step 122 (at 6.109 Myr) of run I
1.341 Myr after switching on high-mass stellar feedback
(c. f. Table 1). Points regardless of color (blue, red and
black points together) represent all 106 SPH particles of
run I. The red and black points represent SPH particles

which lie within our selected box of 30 pc width. The
red points are (partly or fully) ionized particles (c. f. with
Dale et al. 2012, 2007) within the box. The horizontal
line at 104 K shows all the fully ionized SPH particles.
The other red points are partly ionized and lie within the
selected box. The black points are neutral SPH particles
in the selected box. The state of these neutral particles
is described by the EOS which is describing the depen-
dency of density and temperature (diagonal line: Eq. 6,
Eq. 8, Eq. 9; horizontal: Eq. 7).

In this work, we will use a dust radiative transfer code,
therefore we will only use SPH particles in the box which
are completely neutral since dust gets destroyed during
the ionization process (Diaz-Miller et al. 1998). Here-
after, we call the clipping for size and only neutral SPH
particles, resulting in the black particles in Figure 2(a),
method c1.

2.2.2. Method c2 — Neutral SPH Particles in Box &

Temperature Limit

In Figure 2(b), we can see that the SPH temperature
increases with radius from the center of the simulation.
Hot ionized particles (cyan) move to larger radii, but
SPH particles that still follow the EOS also have higher
temperatures at larger radii. This is a result of the EOS,
since the density decrease with radius in the centrally-
condensed clouds. These can also be seen in Figure 2(b)
and the 2-d temperature plot of Figure 2(c), where we
only plot the black sample of Figure 2(a,b). The max-
imum temperature at the boundary of the box at this
time-step lies around 400 K.

The SPH temperature of neutral particles in the box is
lower than the typical dust sublimation temperature of
1600 K (e. g. Whitney et al. 2003), but much higher than
the expected ambient dust temperature around a star-
forming region of about 18 K (see Paper II). We explore
further temperature cuts of the line cooling part of the
EOS. Hereafter, we call the clipping in size using only
neutral particles, and removing particles above a certain
threshold temperature clipping, method c2. Note that
method c2 is the same as c1, but additionally particles
above a certain threshold temperature are removed.

2.2.3. Results — Pre-processing

8 The EOS has been adjusted by the D14 SPH simulations of

intermediate clouds to recover a Jeans mass MJeans of 0.5 M(cid:12).

In Figure 3, we show the temperature histogram of
neutral particles with a box of 30 pc of the four time-

10-1510-1710-1910-2110-2310-2510-2710-29Density (g cm−3)100101102103104Temperature (K)sph particles outside boxionized sph particles inside boxEOS particles inside box10-1100101102Radis (pc)100101102103104Temperature (K)ionzied sph particlesEOS sph particles outside boxEOS sph particles inside box15105051015x (pc)15105051015y (pc)0102030405060708090100Temperature (K)6

Koepferl, Robitaille, Dale, Biscani

steps 024 (3.576 Myr), 032 (4.768 Myr), 072 (5.364 Myr)
and 122 (6.109 Myr). We can see that the temperature
peak shifts from T = 60 K to about T = 35 K once the
high-mass stellar feedback is turned on after time-step
32 (4.768 Myr). This is due to the sweeping up of the
low-density neutral gas into dense, cool clumps.

Therefore, a clipping, and hence removing of the SPH
particles above a certain temperature (e. g. 60 K) in clip-
ping method c2, is not helpful, since we would lose too
many particles for certain time-steps. Also, a thresh-
old temperature below the sublimation is hard to pick,
since it remains unclear when exactly the temperature
of the dust decouples from the temperature of the gas.
Hereafter, we will only remove non-neutral SPH particles
from the simulation, as in clipping method c1, and keep
SPH particles at all temperatures within the box, which
is always below the sublimation temperature.

Note that such a steep increase in temperature with
radius is not observed in the dust species of real star-
forming regions. Hence, implementing the hydrodynam-
ical temperature which is a result of the line cooling part
(Eq. 6) of the EOS, and therefore gas phase of the region,
should happen with caution. We will address this in de-
tail in Section 6, where we present a better treatment of
the dust temperature.

3. GRID

To create realistic synthetic observations we use Hype-
rion, a 3-d dust continuum Monte-Carlo radiative trans-
fer code (Robitaille 2011).

3.1. Diﬀerent Grids

Hyperion and other Monte-Carlo radiative transfer
codes use density and temperature structures that are
discretized onto grids. The right choice of grid is very im-
portant in terms of recovering the dynamical range of the
input structure and in terms of computational eﬃciency.
Hyperion has a variety of grid types implemented.

Regular Cartesian grids become ineﬃcient when map-
ping a particle distribution onto a high-resolution grid
to recover the dynamic range of a large-scale simulation
box. Cartesian related grids, such as Octree grids or
Cartesian AMR grids, can improve the calculation by
providing higher resolution in certain regions and can re-
cover the dynamic range of the density structure in the
simulation. But these grids are orientation dependent
which can cause observational artifacts when observing
along the axes. For example, ”observations” along the
Cartesian axes will make the edges of a cell visible.

The Voronoi tessellation (for more details, see Camps
et al. 2013; Springel 2010a) is a type of irregular grid
where each cell is described by an irregular polyhedron.
Every polyhedron is set up by a point in 3-d space, which
we refer to as a site from now onwards. The bound-
aries of the polyhedra are deﬁned by the set of points
that are closest (hence, nearest neighbors see Press et al.
1992) to the site. The polyhedra have no preferred di-
rection and resolution can be increased by adding more
Voronoi sites, which enables us to represent large dy-
namic ranges. Therefore, mapping particle-based simu-
lations onto a mesh using a Voronoi mesh9 is beneﬁcial
for our proposes. Note, Mapping SPH simulations onto a

9 The Voronoi tessellation has been recently implemented into

Voronoi mesh has also been carried out by Hubber et al.
(2016), Barcarolo et al. (2014), Starinshak et al. (2014)
and Zhou et al. (2007).

Since the primary goal of this paper is to produce re-
liable synthetic observations of star-forming regions we
choose an approach which follows the following condition
set by the radiative transfer calculation:

• satisfactory resolution around the forming stars
• mapped simulation properties follow the gradient
• number of cells manageable by the radiative trans-

of simulation properties

fer calculation

In order to fullﬁl the above requirements we can not
reﬁne the output of the SPH simulation before assign-
ing the Voronoi sites. Otherwise we would produce too
many cells. Therefore we need to construct the Voronoi
sites ﬁrst (see Section 3.2) before calculating the result-
ing properties (see Section 3.3) of the found sites.

3.2. Voronoi Sites

Choosing the Voronoi sites of the tessellation wisely is
one of the critical elements when setting up a Voronoi
mesh eﬃciently. While a rule of thumb is that regions
with higher densities should have higher resolution and
hence more sites, one has to keep in mind that very op-
tically thick regions will trap photons and many such
cells are not beneﬁcial to the radiative transfer calcula-
tion (for a discussion of this, see Camps et al. 2013). In
Figure 4, we plot density slices of diﬀerent site distribu-
tions within a box of 1 pc and highlight accreting sink
particles in red and sink particles in the ionizing bubble
in blue. The actual evaluation of the density in the cells
will be described in Section 3.3. In this section, we only
focus on the changes of the cell sizes when using three
diﬀerent methods of distributing the sites in the Voronoi
mesh:

3.2.1. Method s1 — Sites at SPH Particle Position

A ﬁrst order approach is, to put sites at the positions
of the SPH particles of the clipped sample c1 (for de-
tails about the sample selection, see Section 2.2). Here-
after, the site method s1 is deﬁned by sites at SPH posi-
tions alone. While this works rather well for isolated sink
particles (see sink particle 110753 in Figure 4(a)), very
large high-density Voronoi cells are created close to the
ionizing bubble (see 11640 and 197247 in Figure 4(a)).
These large high-density cells are an artifact of the SPH
to Voronoi mesh mapping and were not part of the initial
simulations. Artiﬁcial high-density regions create over-
estimated ﬂuxes in the radiative transfer because now
very large high-density regions lie close to very luminous
objects.

3.2.2. Method s2 — Sites at SPH & Sink Particle Position

In Figure 5, we show the radial peak density distribu-
tion of SPH particles close to sink particles for an accret-
ing source in a small cluster (11640), an isolated accret-
ing source (110753) and a source in the ionizing bubble

Hyperion by Thomas Robitaille and Francesco Biscani using the
Voro++ library (Rycroft 2009).

Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

7

Fig. 3.— Temperature histogram of neutral SPH particles for time-step 024 (3.576 Myr), 032 (4.768 Myr), 072 (5.364 Myr) and 122

(6.109 Myr). Feedback gets switched on after time-step 32. The sharp spikes at 7.5 K are SPH particles in the isothermal phase.

(115358), which lost all its material due to a close-by ion-
izing source; all proﬁles of all sources are displayed in the
online extension of Figure 5. Red vertical lines highlight
the distance of nearby accreting sink particles, while blue
lines highlight nearby sink particles in the ionizing bub-
ble. We can see that accreting sources can cause a radial
trend in the distribution of the SPH particles, which can
be seen very clearly for sink particle 110753 directly in
Figure 5 (middle), but also for the density peaks in the
density proﬁle at 1 pc distance of sink particle 11640 in
Figure 5 (middle) and of sink particle 110753 in Figure 5
(left).

Ionizing sources create (large) voids in the proﬁle (for
115358 about 0.6 pc). Physically, this void represents
ionized low-density bubbles around the ionizing stars.
Since there is a low-density region around the ionizing
sink particles, very few SPH particles are located close
to the other sink particles in the ionizing bubble. For
example, the closest SPH particle to sink particle 115358
is about 0.6 pc away.

The Voronoi cells around the sink particles are cre-
ated by distant SPH particles beyond the bubble which
have a higher density than the bubble. When ionizing
sources are present in the particle-based simulation, ar-
tiﬁcial large density cells can be avoided by putting ad-
ditional sites at the positions of the sink particles. Here-
after, we will refer to this method as site method s2,
which combines sites at the position of the SPH particles
and the sink particles.

When adding sites at the position of the sink parti-
cles, we can reproduce the low-density bubbles around
the ionizing sink particles. And hence, the size of high-
density cells reaching inside the bubbles is truncated. In
Figure 4(b), we show this eﬀect for sink particle 11640
and sink particle 197247, which have ionizing bubbles
close-by.

3.2.3. Method s3 — Sites at SPH Particle & Sink Particle

Position & Circumstellar Sites

When inspecting Figure 4(b), we see that there are
still some large high-density cells relatively close to the
accreting sink particles, which is partly due to lack of
resolution of the SPH simulation. Adding additional cir-
cumstellar sites around the accreting sink particles in-

creases the resolution around the accreting sink particles
and minimizes the artiﬁcial high-density cells as can be
seen in Figure 4(c). Hereafter, site method s3 combines
sites at the position of SPH particles, the sink particle
position and the circumstellar sites around accreting sink
particles.

On average, the distance between an accreting sink
particle and the closest SPH particle is 0.01 pc which is
about 2000 AU as can be seen for the accreting sink par-
ticles 11640 and 110753 in Figure 5 (left, middle). Con-
cretely, in the method s3 set-up, the position of the sites
is constructed using a constant probability distribution
function (PDF) (for more details, see Appendix B and
Press et al. 1992) in log-space of radius:

r = 10ξ[log10 rmax−log10 rmin]+log10 rmin ,

(10)
with rmin = 10−4 pc and rmax = 10−1 pc. The angles θ
and φ are spaced isotropically within the sphere:

θ = arccos (2ξ − 1)
φ = 2πξ.

(11)
(12)

Once we set the circumstellar sites of method s3 in this
way, we can approximate the density gradient of the en-
velope more smoothly. This will be discussed in more
detail in Section 5.1.

3.2.4. Results — Voronoi Sites

In this section, we already explained in detail diﬀerent
methods of how to distribute the sites in a Voronoi mesh
with a particle-based code as input. Site distribution
method s3, with sites at the neutral SPH positions, at
the sink particle positions and circumstellar sites around
the accreting sink particles, can increase the resolution
and remove artifacts from the particle to mesh transition.
This is why we highly recommend distributing sites in
this manner. We found that the number of circumstellar
sites Ncirc ≈ 1000 is a good estimate to increase resolu-
tion around the sink particles but not create too many
cells, which might slow down computation for the steps
described in the next sections. In the remainder of this
paper, we explicitly use the site distribution method s3.

0255075100125150Temperature T (K)0500100015002000250030003500Neutral Particles N0240255075100125150Temperature T (K)0320255075100125150Temperature T (K)0720255075100125150Temperature T (K)1228

Koepferl, Robitaille, Dale, Biscani

Fig. 4.— 2-d density slices of the Voronoi tessellation with diﬀerent site methods (s1: top, s2: middle, s3: bottom); (white stars) sink

particles with ID; (red stars) accreting sink particles and (blue stars) sink particles in the ionizing bubble within a box of 1 pc length.

3.3. Density and Temperature Mapping onto new Sites
In Figure 4, we showed slices of the density for dif-
ferent site distribution methods. To make the plot we
used for the sites coinciding with SPH particle positions
the peak density ρi,SPH at that position of the SPH par-
ticle. When adding sites to a Voronoi mesh, where no
SPH particles were located before, we need to evaluate
the properties such as density or temperature from the
SPH distribution. We need to preserve the density and
temperature structure as precisely as possible because
later those property meshes will be passed to the radia-
tive transfer set-up. In this section, we will investigate
three techniques to map the density distribution onto a
Voronoi mesh:

3.3.1. Method p1 — Evaluation of SPH Kernel Function

To evaluate the density at a new site j at the position
of the sink particle or at a circumstellar site around a
sink particle, we compute the SPH density function (for
a detailed review, see Springel 2010b) for the N closest
SPH particles:

N(cid:88)

ρj,p1 =

mi,SPHWij(rij, hi).

(13)

i=1

Where mi,SPH is the constant SPH particle mass with the
value mi,SPH = 10−2 M(cid:12) in run I of the D14 SPH sim-
ulations and the kernel function Wij(rij, hi) from Eq. 1.
We estimate the temperature at a new site j by weight-
ing (Press et al. 1992) the SPH particle temperature

110753a)116401972470.5 pc10-2210-2110-2010-19Density (g cm−3)110753b)116401972470.5 pc10-2210-2110-2010-19Density (g cm−3)110753c)116401972470.5 pc10-2210-2110-2010-19Density (g cm−3)Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

9

Fig. 5.— Radial density proﬁle in time-step 122 (6.109 Myr): (a) centered on three sink particles: 11640 is an accreting sink particle in
a small tight cluster of sink particles; 110753 is an isolated accreting sink particle; 115358 is sink particles in the ionizing bubble which lost
all its circumstellar material due to other ionizing sink particles. (b - online material) centered on all sink particles. Red lines highlight
the distance of other accreting and blue of sink particles in the ionizing bubble. The dashed cyan line shows the radius of the closest SPH
particle to the sink particle.
Ti,SPH of the closest N particles with distance10 rij

N(cid:80)

Ti,SPH mi,SPHWij(rij, hi)

Tj,p1 =

i=1

ρj,p1

(14)

with the help of Eq. 13. We explored the eﬀect of
setting N to diﬀerent values and found that setting
N > Nneighbor produces a good approximation11 of the
exact solution of the density. Hereafter, we call this prop-
erty evaluation method p1.

In Figure 6(a), we plot the density evaluation with
property method p1 and site method s3 (note the dif-
ferent scale than Figure 4(c)). We can see that even
with the site distribution method s3, we still have ar-
tifacts of large high-density cells as already mentioned
in Section 3.2. These large high-density cells are due to
the density overestimation when using the peak density
ρi,SPH at the SPH particles which lie in large cells.

When mapping the density with method p1, we recover
a total mass of 139 945 M(cid:12) which is several orders of mag-
nitude to high then the actual mass of about 7500 M(cid:12).
Therefore, we explore other techniques.

3.3.2. Method p2 — Evaluation of Splitted SPH Particles

In the community of SPH modelers, the density is
sometimes approximated in Voronoi cells using an aver-
age density ¯ρ = mSPH/Vcell (David Hubber, private com-
munication). We do not use this technique, since it can

10 The temperature can also be evaluated by weighting with the

density function. We will explore this in the next section.

11 In run I Nneighbor = 65. We found that with N = 100, which
means that N > Nneighbor, we can recover 99.9 % of the exact
solution.

only be used to evaluate the density in cells containing
SPH particles. When adding new sites, this approxima-
tion becomes untrue because the volume Vcell shrinks,
while mSPH remains constant by deﬁnition. Also, the
density evaluation of cells which contain the new sites is
not covered by that technique.

Thus, we virtually split the mass of an SPH particle i
according to the 3-d Gaussian-shaped SPH kernel func-
tion (see Eq. 1). We repeat this for all SPH particles.
Through simple counting, we reevaluate the mass in the
cells of the sites j of the existing SPH particle sites plus
the newly added sites of method s3. Hereafter, we call
this property evaluation method p2.

To space the split SPH particle k with respect to the
SPH particle i again, we use a linear spaced PDF (as
described in detail in Appendix B) and solve for the
positions of the split particles rik. We distribute the
split SPH particles isotropically (see Eq. 11 and Eq. 12).
We convert all the N p2
split split SPH particles to Carte-
sian coordinates and scale the distance by the respective
smoothing length hi of the SPH particle which got split,
since we set hi = 1 for the calculation above. The split
SPH particles do not necessarily fall in the cell of the
SPH particles they split from. By searching for the near-
est neighbor sites (Press et al. 1992) to each split SPH
particle, we can now reassess the mass of the Voronoi
cells, the split SPH particles fall into. We then calculate
the new density ρj,p2 at a cell site j as

nj(cid:88)

ρj,p2 =

mSPH,k/Vj,

(15)

k=1

with the split SPH particle mass mSPH,k = mSPH,i/N p2
split

10-310-210-1100101Radius (pc)10-2210-2110-2010-1910-1810-17Density (g cm−3)11640M = (5.80+0.24) Mﬂ10-210-1100101Radius (pc)110753M = (4.10+0.49) Mﬂ10-210-1100101Radius (pc)115358M = (3.50+0.00) Mﬂsph particlesclose ionizing sinksclose accreting sinksclosest sph particle10

Koepferl, Robitaille, Dale, Biscani

Fig. 6.— Diﬀerent methods of density translation onto the Voronoi grid (p1: top, p2: middle, p3: bottom); (white stars) sink particles

with ID; (red stars) accreting sink particles and (blue stars) sink particles in the ionizing bubble within a box of 2 pc length.

and the number nj set to the number of split SPH par-
ticles found in a cell with the volume Vj. We found that
splitting by N p2
split = 100 is a good trade-oﬀ between ﬁnd-
ing a smooth density distribution and computational ef-
ﬁciency.

Since the probability of accumulating many split SPH
particles decreases with decreasing cell size, we introduce
a threshold of N p2
threshold = 10 split SPH particles. For
cells which collect fewer than N p2
threshold, we evaluate ρj,p1
from Eq. 13.

In Figure 6(b), we plot the density evaluated with
property method p2. When comparing to Figure 6(a),
one can see that the transition between cells is smoother
and artiﬁcial high-density Voronoi cells are substantially

fewer.

To evaluate the temperature, we simply keep track
from which original SPH particle of mass mSPH,i a split
SPH particles of mass mSPH,k comes from and what tem-
perature Ti it had, we can weight the temperature ac-
cordingly by the density:

nj(cid:88)

Tj,p2 =

Ti(mSPH,k)/nj.

(16)

k=1

For the cells with nj < N p2
peratures as in method p1.

threshold, we calculate the tem-

When mapping the density with method p2, we recover
a total mass of 7530 M(cid:12) relatively close to the real mass
of 7500 M(cid:12).

110753a)116401972471 pc10-2210-2110-20Density (g cm−3)110753b)116401972471 pc10-2210-2110-20Density (g cm−3)110753c)116401972471 pc10-2210-2110-20Density (g cm−3)Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

11

3.3.3. Method p3 — Evaluation Using Random Sampling

Another possibility is to evaluate the density by sam-
pling Nrandom random positions l in the grid and cal-
culating the density from the kernel distribution (as in
method p1) of the N closest SPH particles to the posi-
tions l.

By averaging12 the density of the random points l at
nj positions in cell j, we get the total density ρj,p3 of
method p3

nj(cid:88)

N(cid:80)

nj(cid:80)

l=1

ρj,p3 =

ρl,p1/nj.

(17)

l=1

Typically, we set Nrandom ≈ 2 × 107 for NSPH,i ≈ 7 × 105
neutral SPH particles in the simulation time-step and
N p3
split = 30 as above. To ensure that every cell j has at
least N p3
threshold = 20, we add points to under-ﬁlled cells
until nj = N p3

Figure 6(c) shows the property evaluation method p3.
Density gradients are smoother and no artiﬁcial high-
density cells remain.

threshold.

The temperature of property method p3 is a weighted

version of Eq. 17 using Eq. 13

Tj,p3 = 1
nj

Ti,SPHmi,SPHWil(ril,hi)

i=1

ρl,p1

,

(18)

again N > Nneighbor as in method p1.

When mapping the density with method p1, we recover
a total mass of 7495 M(cid:12) extremely close to the actual
mass of 7500 M(cid:12).

3.3.4. Results — Mapping

In Figure 6, we show diﬀerent methods of mapping the

SPH density and temperature onto the Voronoi mesh.

We found that kernel evaluation method p1 is eﬃcient
and reliable in small cells. The solving of the kernel func-
tion using the N > Nneighbor nearest neighbors is suﬃ-
cient to approximate the properties at the new position.
But method p1 creates artifacts for large cells.

The splitting kernel method p2 is less computationally
eﬃcient but produces a smooth density or temperature
gradient between large cells. For small cells this method
breaks down, since the probability that a small cell gets
”hit” by split particles is small. Therefore, the intro-
duced threshold N p2
threshold = 10 is important. For such
small cells, we use the method p1. We found that a vir-
tual splitting the SPH particle by N p2
split = 100 produces
a solid result while being tolerably eﬃcient in time.

Method p3 removes the statistical sampling issues of
the small cells (compared to method p2) by adding ran-
dom sampling points within the cell as long as N p3
threshold
is reached. We found that a smooth gradient in temper-
ature or density can be reached when setting the num-
ber of points to sample to Nrandom ≈ 2 × 107 and the
threshold to N p3
threshold = 20. The trade-oﬀ is that this
method is less eﬃcient computationally when comparing
with method p2, but it is fast enough for the purposes of
our work.

12 This method was developed by Francesco Biscani and

Thomas Robitaille.

Below, we list the total mass within the simulation box
of time-step 122 (6.109 Myr), recovered from the density
mapping for every method present in this section:

p1 ≈ 139 945 M(cid:12)
mtot
p2 ≈ 7530 M(cid:12)
mtot
p3 ≈ 7495 M(cid:12)
mtot

(19)

(20)

(21)

SPH = 7500 M(cid:12) (c. f. Table 1).

The actual mass within the box of the SPH simulation
mtot
In respect of mass
conservation, we note that method p1 is completely un-
reliable. The small overestimate of method p2 results
from the threshold mechanism13. In method p2, when
there are less than N p2
threshold split SPH particles in the
cell, only the density at the position of the site is es-
timated. This leads to an over-prediction of the cell’s
density. For this reason, method p1 and method p2 are
faulty by deﬁnition, since they introduce too high den-
sities to certain cells. Therefore, we suggest method p3
when mapping SPH distributions onto a Voronoi tessel-
lation, since this overestimation is reduced (error below
1 %) by sampling more positions in small cells. In Fig-
ure 8 we show how well method p3 works in recovering a
density gradient from the initial simulation. Blue points
represent the simulated peak density of the SPH parti-
cles and the black points represent the p3 circumstellar
sites. Figure 8 shows that the technique succeeds to re-
cover the density structure over 2 orders of magnitude
over less than 0.1 pc.

4. SOURCES

In Hyperion, we can set up spherical

sources
(e. g. stars) which emit photon packets. The parame-
ters for spherical sources are the luminosity L∗, radius
R∗ and spectra Fν∗.

4.1. Pre-main-sequence Stellar Evolutionary Models
Assuming we want to set up a source resembling a
forming star in D14 SPH simulations with mass M∗ and
age tage (see Eq. 3), we can calculate the stellar radius R∗
and the stellar eﬀective temperature Teﬀ by interpolating
pre-main-sequence stellar evolutionary tracks.
In Fig-
ure 7, we plot the pre-main-sequence tracks of Siess et al.
(2000) for stellar masses between 0.1 M(cid:12) ≤ M∗ ≤ 7.0 M(cid:12)
and Bernasconi & Maeder (1996) for stellar masses be-
tween 9 M(cid:12) ≤ M∗ ≤ 60 M(cid:12).
We interpolate R∗, Teﬀ and L∗ from the stellar evo-
lutionary tracks using 3-d natural neighbor interpolation
(for more details, see Sibson 1981) of the discrete samples
M∗ and tage. In the rare cases, when the stellar masses
lie beyond the stellar evolutionary tracks of Bernasconi
& Maeder (1996), we interpolate the main-sequence data
from Appendix E of Carroll & Ostlie (1996) to infer the
parameters.

4.2. Spectra

We use the stellar photosphere models from Castelli &
Kurucz (2004) and Brott & Hauschildt (2005, Phoenix

13 The threshold for the methods p2 and p3 mean diﬀerent
things. A high threshold in p2 improves the gradient but also over-
estimates the mass, while in the p3, a higher threshold improves
the mass conservation.

12

Koepferl, Robitaille, Dale, Biscani

outer regions of an envelope resolved by the SPH simu-
lation (c. f. with the accreting sink particles 11640 and
110753 in Figure 5); in Figure 8, we also replotted the
sink particle 110753 to illustrate the following envelope
reﬁnement.

The blue colored points in Figure 8 represent the SPH
particles beyond the accretion radius racc = 0.005 pc.
We can see an accretion stream of SPH particles towards
the sink particle 110753. But there is a gap of about
10−2 pc (cyan dashed) between the sink particle and the
closest SPH particle. The envelope background density
between the stream (outer envelope) and the sink par-
ticle is about 2 × 10−19 g cm−3 for object 110753.
In
Section 3.2, we improved this situation by putting more
circumstellar particles around the sink particle and eval-
uated their density in Section 3.3 (see black points in
Figure 8). The evaluated reﬁned circumstellar density is
somewhat only a background density of the outer enve-
lope in the simulation and does not represent a continu-
ous envelope with an increasing density proﬁle at smaller
scales. In Figure 8, we can see the leveling oﬀ of the den-
sity proﬁle for the new sites at 2 × 10−19 g cm−3 within
the closest SPH particle of the accreting sink particles
(black).
In what follows, we extrapolate the envelope
proﬁle inwards with diﬀerent proﬁle descriptions. For
the extrapolation, we will use the s3 circumstellar sites
rather than the SPH particles close to the sink particles
because we have better number statistics with the sites.
We now describe three diﬀerent methods for extrapolat-
ing the density structure to the smallest scales:

5.1.1. Method e1 — Ulrich Envelope Proﬁles

The Ulrich envelope proﬁle (Ulrich 1976) is a rotational
ﬂattened proﬁle and follows the physical process of ac-
cretion. The proﬁle ρUlrich(r, θ) is described in spherical
coordinates and is dependent on the infall rate of ma-
˙Menv, the mass of the stellar object M∗ and the
terial
centrifugal radius Rc:

(cid:19)−3/2(cid:18)

(cid:18) r
(cid:18) cos θ

u

Rc

cos θ0

1 +

cos θ
cos θ0

(cid:19)−1

+

2Rc cos2 θ0

r

(cid:19)−1/2 ×

ρUlrich(r, θ) = ρenv

(23)

(24)

(25)

ρenv
u =

˙Menv
4π(GM∗R3

.

c)−1/2

The angle θ0 is given by the streamline equation:

0 = cos3 θ0 + cos θ0

− 1

− cos θ

(cid:19)

(cid:18) r

Rc

(cid:18) r

(cid:19)

Rc

Hereafter, we call the Ulrich envelope proﬁle14 method
e1. We calculate the infall rate ˙Menv from the accretion
rate (see Eq. 5). As can be seen in Figure 8, we found
that an Ulrich proﬁle (left panel, purple lines) derived
from the parameters of sink particle 110753 seamlessly

14 The Ulrich proﬁles are part of models in Hyperion, which
sets up young stellar object (YSO) models from analytical density
descriptions (see http://www.hyperion-rt.org). We will refer to
these models in the remainder of this paper as Analytical YSO
Models.

(cid:18) GM∗

(cid:19)

R2∗

Fig. 7.— Luminosity versus eﬀective temperature diagram of
evolutionary pre-main-sequence tracks. Colors highlight stellar
ages of the models. Arrows highlight the beginning of every mass
track. Black points highlight stellar evolutionary phases, which
have left the pre-main-sequence phase already.

models) to interpolate the spectra Fν∗ based on the pa-
rameters M∗, R∗ and Teﬀ. The Castelli & Kurucz (2004)
models are deﬁned for stars with temperatures reaching
from 3500 K ≤ Teﬀ ≤ 50 000 K, for logarithmic surface
gravities

log10 g∗ = log10

.

(22)

between log10 g∗ ∈ [0, 5] and for solar metallicities.
In
the rare cases when Teﬀ < 3500 K, we use the Phoenix
models. For a detailled description see Appendix C.

5. CIRCUMSTELLAR MATERIAL

Now that we have mapped the density and tempera-
ture directly onto the Voronoi mesh (see Section 3) and
that we have deﬁned the stellar properties (see Section 4),
it is possible to explore the regions around the accreting
objects in more detail. Note that the circumstellar mate-
rial is the most important place of the radiative transfer
calculation, unfortunately unresolved below 1000 AU by
the D14 SPH simulations. However, in the following, we
describe several methods of how to overcome this and
make sure that the density structure is as realistic as
possible close to the sources.

5.1. Extrapolating the Envelope Density

As mentioned previously, the D14 SPH simulations are
large-scale simulations and do not have as high resolution
around the sink particles as other simulations of smaller
scale. Even though the D14 SPH simulations lack the
resolution to see the inner 0.01 pc close to the sink par-
ticles, we can already see a radial trend in the density
close to accreting sink particles, which corresponds to the

103104105Effective Temperature Teff (K)10-410-310-210-1100101102103104105106107Luminosity L (Lﬂ)0.1Mﬂ0.4Mﬂ0.7Mﬂ1.4Mﬂ1.7Mﬂ2.0Mﬂ2.7Mﬂ4.0Mﬂ7.0Mﬂ9.0Mﬂ15.0Mﬂ25.0Mﬂ60.0Mﬂ103104105106107Stellar Age tage (yr)Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

13

Fig. 8.— Radial density proﬁle of SPH particles (blue) towards the sink particle 110753. The circumstellar sites of the accreting sink
particle are over-plotted in black. (Left) rotationally ﬂattened envelope ﬁt (purple) at diﬀerent angles, (middle) rotationally ﬂattened
envelope proﬁle (green) with suppressed singularity at the mid-plane, (right) diﬀerent power-law envelope proﬁles (dotted, dashed) and the
ﬁtted power-law proﬁle (solid).

matches the accretion stream inwards but also underes-
timates it at larger radii. Note that the singularity at the
centrifugal radius Rc (when cos θ = cos3 θ0; see Eq. 25)
at the mid-plane (for θ = 90◦; see Eq. 23) is caused by the
pile-up of material as a result of angular momentum con-
servation. In reality, the material would be distributed
radially to form a circumstellar disk.

is for the ﬁnal results, we also consider the case where
we use envelopes with spherically-symmetric power-law
proﬁles rather than the Ulrich collapse model (referred
to as method e3). In the right panel of Figure 8, we show
four diﬀerent radial power-law proﬁles (diagonal dashed
lines) with exponents γ = [−0.5,−1.0,−1.5,−2.0] for the
density function16

5.1.2. Method e2 — Ulrich Envelope Proﬁles without

Singularity

The Ulrich description of

the circumstellar disk
(i. e. the singularity) is not physically realistic. There-
fore, for the density proﬁle we ignore the singularity at
the mid-plane and later add a more advanced description
of the circumstellar disk in Section 5.4. In this method,
hereafter named e2, we suppress15 the Ulrich singularity
by adjusting the Ulrich density proﬁle of Eq. 23:

(cid:19)−1/2 ×

1 +

cos θ
cos θ0

(cid:19)−3/2(cid:18)
(cid:19)−1

(cid:18) r

Rc

Rc
r

ρno singularity
Ulrich

(r, θ) = ρenv

u

(cid:18)

1 + 2

.

(26)

In Figure 8 (middle), we present the rotationally ﬂat-
tened Ulrich proﬁle with the singularity removed (green).
We can see that the Ulrich distribution matches the sites
at the inner rim of the envelope resolved by the SPH sim-
ulation, but underestimates the resolved SPH envelope
proﬁle at larger radii for object 110753.

5.1.3. Method e3 — Power-Law Envelope Proﬁles

As an alternative, and in order to understand how im-
portant the assumption of the envelope density proﬁle

15 Developed by Thomas Robitaille.

ρ(r) = ρ0(r/r0)γ.

(27)

The orange solid diagonal line is the log-scaled least-
squares ﬁt (Press et al. 1992) of the density distribution
of the nearby SPH particles. The log-scaled least-square
ﬁt requires us to ﬁt the following function:

log10 ρ(r) = log10 ρ0 + γ log10(r/r0).

(28)
For this accreting sink, the best ﬁt of γ = −1.25 is a
typical value for a protostar.

Note that a ﬁtted power-law proﬁle in density typically
produces a better ﬁt in terms of absolute scaling com-
pared to the Ulrich proﬁles. However, spherical symmet-
ric power-law density proﬁles with only one slope are not
entirely physically motivated, whereas the Ulrich models
are self-consistent with respect to the infall rate.

5.1.4. Results — Envelope Proﬁles

The Ulrich description (method e1) is a physically self-
consistent envelope-infall model and is therefore consis-
tent with the general physical picture, when improv-
ing the resolution on small scales by extrapolating in-
wards. However, the singularity at the centrifugal radius
is unrealistic. Therefore, due to the singularity at the

16 Power-law envelopes are part of the Analytical YSO Models

in Hyperion as described on http://www.hyperion-rt.org.

14

Koepferl, Robitaille, Dale, Biscani

Fig. 9.— Radial density distribution of s3 sites and their envelope ﬁts in time-step 122 (6.109 Myr). Red vertical lines highlight the
distance of close accreting sink particles; cyan dotted lines show the distance of the closest SPH particle. (top) Green rotational ﬂattened
envelope proﬁle: (a) for three relevant sink particles, (b - online material) for all relevant sink particles. (bottom) Orange lines plot the ﬁt
of the blue density sample of s3 sites: (a) for three relevant sink particles, (b - online material) for all relevant sink particles.

mid-plane, we do not use the standard Ulrich envelope
(method e1).

However, we will use the Ulrich description without
singularity e2 and add a circumstellar disk later in the
radiative transfer set-up in Section 5.5. For the Ulrich
description, we set the centrifugal radius Rc, hence the
outer rim of the circumstellar disk, to Rc = 500 AU.
The choice of the centrifugal radius is dependent on the
chosen outer disk radius. 500 AU is a realistic intermedi-
ate value of typical values between 100 AU and 1000 AU.
Moreover, the disk radius needs to be smaller than the
accretion radius from the simulation (racc = 0.005 pc ≈
1000 AU), because otherwise the disk would have been
resolved by the simulation. We calculate the density ρenv

u

(see Eq. 23) for all Ulrich envelope ﬁts. In Figure 9 (top
panel), we show e2 rotationally ﬂattened envelope pro-
ﬁles for the three accreting sink particles 11640, 110753
and 197247 with the corresponding values for ρenv
and
˙Menv. To see all proﬁles for time-step 122 (6.109 Myr)
see the online extension of Figure 9 (top). While the ma-
jority of sink particle envelopes are reproduced well by
Ulrich envelopes without singularities, this model under-
predicts the density for some of the accreting objects.
However, we cannot arbitrarily scale these particular pro-
ﬁles, because the mass M∗ of the stellar object needs to
˙Menv
drop for increasing ρenv
(c. f. with Eq. 23).

and constant infall rate

u

u

The power-law method e3, which ﬁts the envelope pro-

10-410-310-210-1Radius (pc)10-2210-2110-2010-1910-1810-1710-16Density (g cm−3)11640M = (5.80+0.24) Mﬂγ=-1.75ρ0=9.6e-20g cm−3χ2=  8.510-410-310-210-1Radius (pc)10-2210-2110-2010-1910-1810-1710-16Density (g cm−3)11640M = (5.80+0.24) Mﬂ˙Menv=1.5e-06Mﬂyr−1ρu=4.1e-19g cm−3Rc=  500AU10-310-210-1Radius (pc)110753M = (4.10+0.49) Mﬂγ=-1.28ρ0=2.0e-19g cm−3χ2=  0.510-310-210-1Radius (pc)110753M = (4.10+0.49) Mﬂ˙Menv=3.5e-06Mﬂyr−1ρu=1.2e-18g cm−3Rc=  500AU10-310-210-1Radius (pc)197247M = (6.97+0.57) Mﬂγ=-2.00ρ0=1.9e-19g cm−3χ2= 21.7close ionizing sinksclose accreting sinksclosest sph particleinner envelopeouter envelopepower law fit10-310-210-1Radius (pc)197247M = (6.97+0.57) Mﬂ˙Menv=6.5e-06Mﬂyr−1ρu=1.7e-18g cm−3Rc=  500AUclose ionizing sinksclose accreting sinksclosest sph particleinner envelopeouter envelopeUlrich profileSynthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

15

ﬁle, follows the slope of the radial proﬁle of the outer
envelope resolved by the SPH simulation, since it is an
extrapolation of the gravitational collapse modeled in the
D14 SPH simulations. We ﬁt the slope of the proﬁle γ
and the density ρ0 at the radius r0, which we set as the
distance of the closest SPH particle. To extrapolate (see
Press et al. 1992) the proﬁle of the density for diﬀerent
cells j within rj < r0, we are only using s3 circumstellar
sites of the outer envelope (rj > r0), which belong to
the sink particles we want to ﬁt the proﬁle for. We only
use sites from the outer envelope (see blue sample in Fig-
ure 9), since the inner density values (black) represent the
background density of the outer envelope created by the
SPH ﬁeld close to the sink particle. In the bottom panel
of Figure 9, we show the power-law ﬁts of the accret-
ing sink particles 11640, 110753 and 197247 in time-step
122 (6.109 Myr), and we show the same for all accreting
sink particles of this time-step in the online extension
of Figure 9 (bottom). We limit the slope of the proﬁle
to the range γ ∈ [0,−2], because for γ = 0 the density
follows the ﬂat background density at the s3 circumstel-
lar sites calculated in Section 3.3. The limit γ = −2
was chosen because it corresponds to the radial proﬁle
of the ”singular isothermal sphere” in gravitational col-
lapse (see Shu 1977). From Figure 9, we can see that
the accretion stream (blue) is not spherically symmetric
when the accreting sink particles sit in a close cluster of
sink particles (11640, 197247) rather than being isolated
(110753). We use a χ2 value (see Press et al. 1992), to
quantify the quality of the envelope proﬁle ﬁt:
(log10 ρ(rj) − log10 ρﬁt(rj))2

Nj(cid:88)

.

(29)

χ2 =

j=1

| log10 ρﬁt(rj)|

We need Nj, which are all the sites that belong to the
reﬁned circumstellar sites of a sink particle with rj >
r0, and ρﬁt(rj), which is Eq. 28 evaluated for the ﬁtted
parameters γﬁt, and ρ0,ﬁt to calculate

log10 ρﬁt = log10 ρ0,ﬁt + γﬁt log10(rj/r0).

(30)

Spherically symmetric proﬁles produce a better ﬁt and
have lower χ2 values, as can be seen in the bottom panel
of Figure 9. However, when comparing with method e2,
which uses the rotational ﬂattened envelope proﬁle with-
out singularity, we see that in the central region, the
power-law density is several orders of magnitude higher.
While the Ulrich proﬁle is consistent with the phys-
ical picture of a gravitational collapse with conserva-
tion of angular momentum, the gravitational collapse
description in the D14 SPH simulations should repro-
duce power-law proﬁles on small scales. The power-
law proﬁles in the D14 SPH simulations are limited by
the isothermal accretion ﬂow of ρ ∼ r−2 at larger radii
(r > 0.1 pc). Additionally, within the accelerating col-
lapsing shell (r < 0.1 pc), the velocity is not constant
and the density proﬁle is shallower, with ρ ∼ r−3/2 (Shu
1977; Ulrich 1976). This explains the oﬀset of the ra-
dial density proﬁle of the outer envelope from the simu-
lations, compared to the rotationally ﬂattened envelope
proﬁle and why the power-law proﬁles produces a bet-
ter ﬁt. Although the power-law proﬁles are consistent
with the gravitational collapse description used in the
D14 SPH simulations, the rotational ﬂattened envelope

proﬁles are consistent with the physical picture of small
scale gravitational collapse.

To explore the eﬀects of the choice of reﬁnement tech-
niques on the synthetic observations, we will provide the
results for both methods e2 and e3 in this paper.

5.2. Envelope Superposition

In some cases, the accreting sink particles lie in com-
pact clusters that include other accreting sink particles.
As a result, the diﬀerent envelope proﬁles will overlap,
increasing the density further. An overlap means diﬀer-
ent things for the two diﬀerent envelope descriptions e2
and e3. In the self-consistent picture of an infalling en-
velope (e2: Ulrich proﬁle), the overlap is represented by
summation, since the infalling mass is increasing. For
the power-law envelope description (e3), the maximum
of the superimposed envelopes at every position is the re-
sulting envelope proﬁle, since if the envelopes of two sink
particles with the same power-law would overlap, the re-
sulting ﬁt would again be the initial power-law envelope,
and not a power-law envelope twice as dense.

By using a smooth weighting function, we combine the
density of the envelope and the background and recover
a smooth transition between the two. Additionally, for
sink particles that are close to other sink particles, we
then also weight the density of the diﬀerent envelopes ac-
cordingly, before evaluating a ﬁnal density at each point.
We describe these two cases in the next two sections.

5.2.1. Weighting

We calculate the distance rjs, envelope density ρenv
js
of every s3 circumstellar site j and every accreting sink
particle s for which we have already calculated the ”back-
ground” density of method p3 ρp3,j in Section 3.3. We
deﬁne that an envelope of a sink particle only contributes
when rjs < rmax, where rmax is the maximum distribu-
tion radius of s3 circumstellar sites that belong to a sink
particle as described in Section 3.2, otherwise we set all
elements of ρenv
js = 0. We weight (Press et al. 1992) the
density ρenv
js by:

wj,s =

1 − rjs−r0,s
rmax−r0,s

1

0

∀ rjs < r0,s
∀ r0,s ≤ rjs ≤ rmax,
∀ rjs > rmax

(31)

(cid:40)

where r0,s is the radius of the closest sink particle, as
described in Section 5.1. The ”background” density ρp3,j
is weighted with the counter weight
∼
wj,s = 1 − wj,s.

(32)

We set all weights wj,s and
ρenv
js = 0.

∼
wj,s to zero when the density

5.2.2. Weighted Superposition

For the Ulrich description of method e2 we sum the
weighted density function to get the superposition enve-
lope density ˆρj,p3 at every site j with

Ns(cid:88)

(cid:104)

s=1

(cid:105)

∼
wj,s

ˆρe2
j,p3 =

wj,sρenv

js + ρp3,j

,

(33)

16

Koepferl, Robitaille, Dale, Biscani

Fig. 10.— Extrapolated envelope density distribution of s3 sites including superposition and their envelope proﬁles in time-step 122
(6.109 Myr). Red vertical lines highlight the distance of close accreting sink particles; cyan dotted lines show the distance of the closest
SPH particle. (top) Green rotational ﬂattened envelope proﬁle: (a) for three relevant sink particles, (b - online material) for all relevant
sink particles. (bottom) Orange lines plot the ﬁt of the blue density sample of s3 sites. (a) for three relevant sink particles, (b - online
material) for all relevant sink particles.

by using the normalization Ns, which is the number of ac-
creting sink particles with envelopes. The summation is
necessary, since the Ulrich envelope was constructed from
the physical parameters, such as the infall rate ˙Menv.

As explained above, for the power-law description e3,
we take the maximum of the weighted density function
when superimposing many envelopes

(cid:104)

ˆρe3
j,p3 =

Nsmax
s=1

(cid:105)

wj,sρenv

js + ρp3,j

∼
wj,s

.

(34)

When the superposition density is lower than the back-
ground density ρp3,j,
for example in some cases the
outer regions of the Ulrich envelope ﬁts are too low,

we set ˆρj,p3 = ρp3,j.
In Figure 10, we show the
inward-extrapolated densities of the envelope proﬁles
including superposition. For all objects in time-step
122 (6.109 Myr), see the online extension of Figure 10.
For the isolated object 110753, we only see the density
extrapolation inwards, while for the object 11640 and
197247 we see a superposition. For instance, in the upper
panel in Figure 10, where we show the Ulrich description
of method e2, we can see that for the non-isolated ob-
jects 11640 and 197247, the new proﬁle is higher than
the initial ﬁt (green) with values approaching the initial
ﬁt at small radii.

For the power-law envelope of method e3 in the lower

10-410-310-210-1Radius (pc)10-2210-2110-2010-1910-1810-1710-16Density (g cm−3)11640M = (5.80+0.24) Mﬂγ=-1.75ρ0=9.6e-20g cm−3χ2=  8.510-410-310-210-1Radius (pc)10-2210-2110-2010-1910-1810-1710-16Density (g cm−3)11640M = (5.80+0.24) Mﬂ˙Menv=1.5e-06Mﬂyr−1ρu=4.1e-19g cm−3Rc=  500AU10-310-210-1Radius (pc)110753M = (4.10+0.49) Mﬂγ=-1.28ρ0=2.0e-19g cm−3χ2=  0.510-310-210-1Radius (pc)110753M = (4.10+0.49) Mﬂ˙Menv=3.5e-06Mﬂyr−1ρu=1.2e-18g cm−3Rc=  500AU10-310-210-1Radius (pc)197247M = (6.97+0.57) Mﬂγ=-2.00ρ0=1.9e-19g cm−3χ2= 21.7close ionizing sinksclose accreting sinksclosest sph particleinner envelopeouter envelopepower law fit10-310-210-1Radius (pc)197247M = (6.97+0.57) Mﬂ˙Menv=6.5e-06Mﬂyr−1ρu=1.7e-18g cm−3Rc=  500AUclose ionizing sinksclose accreting sinksclosest sph particleinner envelopeouter envelopeUlrich profileSynthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

17

Fig. 11.— Diﬀerent methods of envelope proﬁles for the sink particle 110753 in run I step 122 (6.109 Myr). Region around the sink
particle with site method s1 (left); region around the sink particle with site method s3 (middle); region around the sink particle with site
method s3 and added envelope proﬁle (right).

panel of Figure 10, this eﬀect was suppressed due to the
fact that we take the maximum of the envelope densi-
ties rather than the sum, as shown in Eq. 34. We can
see that there is a smooth transition to other envelopes
(black particles in object 11640 and 197247) and also a
seamless transition17 to the radial proﬁle of other en-
velopes resolved by the SPH simulation (blue particles).
In Figure 11, we present a 2-d slice through the density
structure in order to show the improvement in resolution
for the accreting sink particle 110753. The left panel
shows the density evaluated on the grid where each cell
corresponds to an SPH particle (s1), the central panel
shows the improvement once the circumstellar cells are
added (s3), and ﬁnally the panel on the right shows an
inward extension of the envelope including the superposi-
tion of envelope densities ˆρj,p3 for a rotationally ﬂattened
envelope (e2).

5.3. Envelope Cavities

YSOs drive outﬂows that carve out bipolar cavities in
the envelopes, mostly perpendicular to the mid-plane (for
more details, see Whitney et al. 2003). We parameterize
the outﬂow cavity walls18 as:

z(r) =±ar3/2.

(35)

We choose the opening constant a in such a way that at
the outer radius of the envelope Renv
max, the half-opening
angle θopen is equal to θopen = 10◦:

a = Renv

max cos(θopen).

(36)

We assume that the material in the cavity is optically
thin so that the radiation can escape. Therefore, we set
the cavity density

ρcavity = 0.

(37)

The cavity removes a certain fraction from the total
mass. For the rotational ﬂattened envelopes (e2) about

17 Note that superimposed envelopes close to ionization bubbles
could now create large high-density cells in the outer rim of the
circumstellar sites for an individual accreting sink particle. To
avoid this, we set in those cases (cell volume larger than 5 % of the
envelope volume at the certain radius) the superimposed density to
the background density of the cell ρj,p3 before superposition and
envelope extrapolation.

18 The description follows the Analytical YSO Models in Hy-

perion as described on http://www.hyperion-rt.org.

2 % is removed, while for the power-law envelope (e3) up
to 4 % is removed.

5.4. Circumstellar Disks

In the last three sections, we focused on the envelope
of accreting stellar objects in the D14 SPH simulations.
Physically, on smaller scales, the accreting material of
the envelope is channeled through the disk to the central
object. From the D14 SPH simulations, we extracted the
total angular momentum vector Ltot of the accreting sink
particles to determine the inclination ∆θ of all disks in
the simulation at every time-step:
x + L2

(cid:113)L2

(38)

Ltot =
y + L2
∆θ = arccos(Lz/Ltot)

z

(39)

We can evaluate the density contributed by the disk
ρdisk(r, θ) for the s3 circumstellar sites of a sink parti-
cle at a certain radius r and at an angle θ (see Eq. 11)
through the ﬂared disk19 (Armitage 2010) density pro-
ﬁle (e. g. Whitney et al. 2003; Shakura & Sunyaev 1973)
below. By replacing θ by θ − ∆θ, we incline the disk,
as set by the angular momentum vector (see Eq. 38 and
Eq. 39):

ρdisk(r, θ) =

(cid:40)
(cid:17)β−p

(cid:16) r0

r

ρdisk = ρnorm

ρdisk ∀ rd
0 ∀

min < r ≤ rd

max,

max

r > rd

(cid:18) r cos(θ − ∆θ)

(cid:34)

exp

−

4h

(cid:19)2(cid:35)

(40)

(41)

with the disk ﬂaring parameter β, the surface density ex-
ponent p, the maximum disk radius rd
max, the minimum
disk radius rd
min and disk scale height h, which is deﬁned
as a relation of the height h0 at radius r0:

h = h0

.

(42)

The integration normalization constant ρnorm is deﬁned
to satisfy that the volume integral of the disk density

19 The description follows the Analytical YSO Models in Hy-

perion as described on http://www.hyperion-rt.org.

(cid:18) r

(cid:19)β

r0

1107531107531107530.1 pc10-2310-2210-2110-2010-19Density (g cm−3)18

Koepferl, Robitaille, Dale, Biscani

function of Eq. 40 is equal to the disk mass:

2π(cid:90)

π(cid:90)

max(cid:90)

rd

0

−π

0

Mdisk =

dφ

dθ

dr r2 sin θρdisk(r, θ)

the SPH simulation, but still include circumstellar sites
to ensure that the temperature proﬁle around the sources
is resolved. The radiative transfer calculation is then set
up as listed in Table 2.

(43)

α =−1.0
β = 1.25

(cid:34)

(cid:18)

(48)
(49)
(50)

(cid:19)2(cid:35)−1/2

(51)

which can be solved numerically. Since we assume the
mass of the disk Mdisk ≈ 10−2M∗, we can solve, with the
help of Eq. 40 for ρnorm . We calculate the disk density
distribution ρdisk(r, θ, j) for all the s3 circumstellar sites
j with the following values:
Mdisk = 10−2M∗
r0 = 1000 AU
h0 = 50 AU
rd
min = rOptThin(Tdust = 1600 K)
rd
max = Rc = 500 AU

(44)
(45)
(46)

(47)

where rOptThin(Tdust = 1600 K) is the sublimation ra-
dius20, given by the radius at which the temperature
would drop to 1600K in an optically-thin medium:

rOptThin(Tdust) = R∗

1 −

1 − 2

T 4
dust
T 4
eﬀ

κB(Tdust)

κ∗

where κB is the Planck mean opacity, κ∗ is the mean
opacity of the dust weighted by the stellar photosphere
and Teﬀ is the eﬀective temperature of the star. Note
that when dust properties, including polycyclic aromatic
hydrocarbon (PAH) molecules, are used, we set the inner
radius to rOptThin(Tdust) for the largest dust grain.

5.5. Circumstellar Set-up

In Section 3, we discussed diﬀerent methods for how to
distribute sites and how to evaluate the density and tem-
perature when transferring from a particle-based SPH
simulation to a Voronoi tessellation. With a description
of the temperature Tp3 and the ”background” density
ρp3, we described how to evaluate the properties of the
stellar sources in Section 4. Further, the circumstellar
density can be computed by using the envelope proﬁles
e2 and e3 (see Section 5.1) in order to evaluate the over-
lapping envelope density ˆρp3 (see Section 5.2). We de-
scribed the bipolar outﬂow cavity set-up in Section 5.3.
For smaller scales the disk density ρdisk (Section 5.4) can
contribute at s3 circumstellar sites close to the accreting
sink particle.

In this section, we will combine the above prescriptions
and explore three diﬀerent approaches of setting up the
circumstellar material from the radiative transfer calcu-
lation.
In Figure 12, we plot sketches of the diﬀerent
methods of the circumstellar material set-up and sum-
marize the diﬀerent conﬁguration in Table 2.

5.5.1. Method CM1 — No Circumstellar Matter

The simplest approach (hereafter, CM1), is not to add
any circumstellar material on top of the density given by

20 Description from http://www.hyperion-rt.org and dereived

by Thomas Robitaille.

5.5.2. Method CM2 — e2 Envelope, Cavity & Disk from

”Analytical YSO Models”

We extend the ﬁrst approach by using the densities
from the rotationally ﬂattened envelopes (e2), we evalu-
ated in Section 5.1, and also account for their superposi-
tion (see Section 5.2) and hereafter call this circumstellar
material method, method CM2. We used the superim-
posed density ˆρj,p3 for sites of accreting sink particles,
however we set the superimposed envelope density ˆρj,p3
of sites j within the disk radius rj < rd
max = 500 AU
(as deﬁned in Eq. 48) to zero and rather include an An-
alytical YSO Model in the center. For illustration, see
Figure 14 (middle).

For the inner 500 AU, we set up the Analytical YSO
Model using the radiative transfer code Hyperion,
which is adding the spectral energy distribution (SED)
of the YSO (star, envelope, cavity & disk).

With the higher density material present, we need to
adjust the mass of the source in the radiative transfer
by the mass of the added circumstellar material (enve-
lope, cavity, disk) between r0 and rmin ≈ 0. Therefore,
we calculate the envelope mass M e2
env by numerically in-
tegrating over the envelope density proﬁle. We use the
bi-polar cavity set-up described in Section 5.3 and set
the outer radius of the envelope in the cavity descrip-
tion (Eq. 36) to Renv
max = 500 AU. The cavity removes
about 2 % from the mass of the envelope within Renv
max.
We scale the disk density ρdisk thus that the disk mass
Mdisk (from Eq. 43) is 1 % of the stellar mass M∗. The
other parameters of the Analytical YSO Models are set
up with the parameters given in Section 5.4. The new
mass of the stellar particle is then calculated as follows:

M∗ = Msink − (M e2

env − M e2

cavity) − Mdisk.

(52)

The method CM2 sets up with the parameters listed in
Table 2. We use this set-up to precompute the SED of the
Analytical YSO Model. Since the Analytical YSO Model
is not spherically symmetric, we compute the models for
diﬀerent viewing angles and determine an angle-averaged
SED that we then use in the radiative transfer calcula-
tion. Therefore, we average the computed SED over 12
isotropically spaced viewing angles.

5.5.3. Method CM3 — e3 Envelope, Cavity & Disk from

Analytical YSO Models

Method CM3 is similar to CM2 but with power-law en-
velopes instead of rotationally ﬂattened Ulrich envelopes.
The envelope mass M e3
env can be, therefore, calculated an-
alytically as the spherical volume integral of the density

Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

19

Summary of Set-ups for different Circumstellar Configurations.

TABLE 2

method

envelope ﬁtting
sites
density
density reference
Analytical YSO Model
source mass
mass references

CM1

-
s3
ρp3

Eq. 17

no

M∗ = Msink

D14 SPH simulations

CM2

e2
s3

CM3

e3
s3

ˆρe2
j,p3(rj,s > rd

max)

Eq. 34
yes
M∗ = Msink − (M e2
env − M e2
Eq. 43

cavity) − Mdisk M∗ = Msink − (M e3

cavity) − Mdisk

ˆρe3
j,p3(rj,s > rd

max)

Eq. 34
yes
env − M e3

Eq. 53, 43

function from Eq. 27 between r0 and rmin ≈ 0.

2π(cid:90)

π(cid:90)

r0(cid:90)

M e3

env =

dφ

0

−π

= 4πρ0

dθ

r0(cid:90)

rmin

dr

rmin ≈ 0

≈ 4π
γ + 3

ρ0 r3
0

dr r2 sin θρ(r)

(cid:18) r

(cid:19)γ

r0

r2

(53)

(54)

(55)

In Table 2, we summarize the set-up parameters of
method CM3. Note that the cavity removes about 4 %
from the mass of the envelope within Renv

max.

5.5.4. Results — Circumstellar Material Set-up

Above we presented the circumstellar material set-up
versions CM1 (star alone), CM2 (star & e2 Analytical
YSO Models) and CM3 (star & e3 Analytical YSO Mod-
els).

Method CM1 is the simplest approach when setting up
a radiative transfer model from simulations, because it
does not require an inward envelope extrapolation. For
instance, Oﬀner et al. (2012) used this approach without
circumstellar reﬁnement because the circumstellar mate-
rial was too optically thick to contribute to the ﬂux that
they were interested in.

However,

in this work we will present a parameter
study: From now on we will use method CM1, CM2
and CM3 to set up the circumstellar material in the ra-
diative transfer set-up and therefore explore the eﬀects
of circumstellar material on the MIR ﬂux.

6. DUST & TEMPERATURES

Now that the density has been successfully mapped
onto the radiative transfer grid and stellar sources in-
cluding the circumstellar material have been set up, we
will focus in this section on the dust and the temperature
set-up.

6.1. Dust Properties

We set the dust-to-gas ratio to a typical value of
dust
gas = 0.01 (Draine 2011). When computing the radia-
tive transfer, we explore two diﬀerent sets of dust prop-
erties:

• one that assumes thermal emission for all grain
sizes (Draine 2003; Weingartner & Draine 2001)
and

Fig. 12.— Three methods of circumstellar material set-up in the

radiative transfer calculations.

CM1CM2CM320

Koepferl, Robitaille, Dale, Biscani

Fig. 13.— Dust opacity, emissivity and albedo of the ultra-small (usg), very small (vsg) and big grains (big) of the PAH dust models

and the non-PAH Milky Way dust (MW). Note that the panels have a diﬀerent scale in wavelength.

• one that also takes into account the transient heat-
ing of very small grains and PAH molecules (Draine
& Li 2007).

We will refer to these as non-PAH dust and PAH dust re-
spectively. In Figure 13, we show the opacity, emissivity
and albedo of the diﬀerent dust components.

6.1.1. Non-PAH Dust

In Figure 13, we show the properties of the Milky Way
non-PAH dust from Weingartner & Draine (2001) with
the re-normalization of abundances from Draine (2003)
with RV = 5.5 and bc = 3.0, where RV is the ratio of the
visual extinction to reddening magnitude, and bc is the
concentration of carbon atoms in the medium. These
dust properties reproduce the ﬂuxes of the far-infrared
(FIR) well but lacks emission in the near-infrared (NIR)
and MIR up to 20 µm.

6.1.2. PAH Dust

We use an approximate method for the treatment of
the emission from dust grains and PAH molecules, fol-
lowing Robitaille et al. (2012, and private communication
with Bruce Draine therein). We separate the dust size
distribution into three grain species: 80.63 % big grains
(>200 ˚A); 13.51 % of a smaller dust species within 200 ˚A
and 20 ˚A, called very small grains (vsg); and 5.86 % of the
PAH molecules, called ultra-small grains (<20 ˚A,usg).

The very small and ultra-small grains are transiently
heated as mentioned above, while the big grains are in
local thermodynamical equilibrium (LTE), similarly to
the non-PAH dust. When comparing the non-PAH dust
(black) with the big grains (red) in Figure 13, we can see
that the opacities are not that diﬀerent, while the ultra-
small grains (blue) and very small grains (green) have
pronounced features in the MIR. The strong emissivity
values of the ultra-small grains below 20 µm causes the
PAH emission typically observed towards high-mass star-
forming regions.

6.2. Temperature Combinations

In Hyperion, it is possible to couple the calculated
radiative transfer temperature of the dust T dust
RT to the
hydrodynamical temperature mapped onto the Voronoi
mesh Tp3. We will now explore the eﬀects for diﬀerent
dust types and temperature combinations:

6.2.1. Method DT1

The method DT1 combines the radiative transfer tem-
RT , calculated from the non-PAH and PAH

perature T dust

dust with the hydrodynamical temperature Tp3.

T tot
RT : T dust

RT & Tp3

(56)

Note that for the PAH dust only the big grains can heat
thermally, and therefore, we couple only big grains with
the hydrodynamical temperature. The temperatures are
not directly summed, since this would not be physical.
In Hyperion, the temperature is actually represented
by the speciﬁc energy rate ˙ (changes in absorption and
emission process), which under the assumption of LTE
can be transferred into a corresponding temperature.
Therefore, the temperatures can be combined by con-
verting them to ˙(T ), and adding those energies before
they are converted back.

6.2.2. Method DT2

We will further explore the eﬀects when coupling T dust
with an isothermal temperature Tiso = 18 K for the two
diﬀerent dust types in method DT2. The constant tem-
perature of 18 K on average matches the temperature in
relatively empty patches in the Galactic plane (see Paper
II for more details), and is therefore a good choice for an
ambient temperature.

RT

T tot
RT : T dust

RT & Tiso

(57)

Note that for the PAH dust, the temperature is only sig-
niﬁcant for the big grains, which satisﬁes LTE. There-
fore, we couple only big grains with the isothermal tem-
perature.

6.2.3. Method DT3

In the method DT3, as a sanity check, we only run
the radiative transfer without combining with an extra
temperature.

T tot
RT : T dust
RT

(58)

6.2.4. Results — Dust & Temperature Combinations

We produce ideal synthetic observations of the meth-
ods DT1, DT2 and DT3 using non-PAH and PAH dust
at 20 µm and present them in Figure 14, where we also
show a background subtracted image at WISE 22 µm of
the Soul Nebula (Koenig et al. 2012; Wright et al. 2010),
a real star-forming region, in the right panel.

We now focus on the non-PAH dust in the upper pan-
els of Figure 14. We note that the non-PAH dust pro-
duces much too bright emission21 in comparison to the

21 Note that the white pixels at the rim of the set-up DT1 are
more than 10× brighter than the maximum value in the W5 panel.
Therefore, also the total ﬂux of the DT1 set-up is much higher than
other comparable values.

10-1100101102103Wavelength (µm)10-410-310-210-1100AlbedousgvsgbigMW100101102103104Wavelength (µm)10-1510-1410-1310-1210-1110-1010-910-810-7Emissivities (ergs s−1 g−1 Hz−1)usgvsgbigMW10-1100101102103104Wavelength (µm)10-210-1100101102103104105106Opacity (cm2g−1)usgvsgbigMWSynthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

21

Fig. 14.— Ideal synthetic observations for diﬀerent temperature combinations and dust types. The right panel shows the background
subtracted image at WISE 22 µm of the Soul Nebula (c. f. with Figure 1), a real star-forming region. Note that the images do not all have
the same color scaling. The white numbers in the individual panels represent the scaling factors of the images in respect to the colorbar.
A low scaling factor stands for low brightnesses.

real region, when coupling with the hydrodynamical tem-
perature (see method DT1). The coupling of isothermal
and radiative transfer temperature (DT2) produces dras-
tically too low brightnesses (note the colorbar scaling
factor 10−13) as does the radiative transfer temperature
alone (DT3).

We found that the PAH dust in the lower panels
of Figure 14 can reproduce the typical surface bright-
ness of the Galactic star-forming region better. While
the coupling with the hydrodynamical temperatures (see
method DT1) causes even higher brightnesses than its
non-PAH dust counterpart, neglecting the hydrodynam-
ical temperatures produces better results: When com-
bining the radiative transfer temperature with an am-
bient isothermal temperature (DT2), the brightness of
the object is consistent with real observed regions. Also
method DT3 produces a comparable result to the real
star-forming region but lacks emission in the outer re-
gions for longer wavelengths.

From Figure 14, we can see that when combining the
radiative transfer temperature with the hydrodynamical
temperature (see method DT1), the brightness in the
MIR is overestimated for non-PAH and PAH dust. The
high brightness components are produced by the high
hydrodynamical temperatures Tp3 in the outer regions,
which was coupled with the dust radiative transfer tem-
perature in Eq. 56. The gas temperatures are highest in
the low density regions, due to the Larson (2005) EOS
(c. f. Figure 2 and Section 2.2), but this is not observed
for real star-forming regions. Although the temperatures
of neutral SPH particles lie below the dust sublimation
temperature of 1600 K (see Section 5.4), the brightness
due to the hydrodynamical temperature is several orders
too high, due to the erroneous assumption that the gas
and dust are well-thermally coupled everywhere. In fact,
the heating of the gas at low densities due to the Larson
(2005) EOS used in the D14 SPH simulations, is phys-

ically due to the decoupling of the dust from the gas
and therefore it does not make sense to use these high
temperatures for the dust. Therefore, having explored
the diﬀerent ways of setting up the radiative transfer
temperatures, we recommend using method DT2 by cou-
pling the radiative transfer dust temperature T dust
RT with
the ambient isothermal temperature Tiso for big grains of
the PAH dust, which recovers the brightness features in
the MIR much better.

7. REALISTIC SYNTHETIC OBSERVATIONS

In Paper II and Paper III, we will test and calibrate
techniques commonly used by observers to infer star-
formation properties. For this task, it is critical that we
have synthetic observations which are as realistic as pos-
sible. We set up Hyperion with the preferred methods
described from Section 2 to Section 6 and produce ideal
synthetic observations. We then simulate all the eﬀects
introduced by telescopes and the Galactic environment
with the FluxCompensator (Koepferl & Robitaille, in
preparation, hereafter referred to FluxCompensator
Paper).
In the following sections, we will give a brief
description of these simulated eﬀects by the FluxCom-
pensator.

7.1. Imaging
After the total temperature T tot

RT calculation/combina-
tion in Hyperion, the images are produced by the ray-
tracing algorithm (Robitaille 2011). Note that for com-
putational reasons we are not computing the scattering:
For all the dust properties that we use, the albedo has
values smaller than 1 % above 8 µm (compare with Fig-
ure 13) and therefore, scattering is not important in the
wavelength regimes we are interested in.

We produce ideal synthetic observations for 3 viewing
angles looking down the x, y, and z axes respectively.
We compute the ideal synthetic observations in a spectral

DT1 non-PAH10xDT2 non-PAH10−13xDT3 non-PAH10−13xDT1 PAH10xDT2 PAH1xDT3 PAH1x10203040Scaled Brightness (MJy sr−1)W51x22

Koepferl, Robitaille, Dale, Biscani

Fig. 15.— Realistic synthetic observations of a star-forming region of the D14 SPH simulations in Infrared Array Camera (IRAC)
8 µm, Multiband Imaging Photometer for Spitzer (MIPS) 24 µm, Photoconductor Array Camera and Spectrometer (PACS) 70 µm, PACS
160 µm, Spectral and Photometric Imaging Receiver (SPIRE) 250 µm, SPIRE 350 µm and SPIRE 500 µm combined with a real background
of time-step 122 (6.109 Myr). Note that not all images have the same scale. The white numbers in the individual panels represent the
scaling factors with respect to the colorbar.
cube of 30 steps in wavelength from 1 µm to 750 µm. The
2-d image slices of the cube span 1200×1200 pixels.

7.4. Extinction & Background

7.2. Distance

We push the ideal synthetic observations from Hyper-
ion to a distance of d = 3 kpc to be roughly comparable
to close high-mass star-forming regions, such as the Ca-
rina Nebula, the Eagle Nebula or the Heart and Soul
Nebulae (Westerhout 4 & 5), and d = 10 kpc to repre-
sent more distant star-forming regions across the Galac-
tic plane. The resulting intrinsic pixel resolution ϑ0 is
roughly 1.(cid:48)(cid:48)7 and 0.(cid:48)(cid:48)5. For more details of the mentioned
clusters in the Milky Way, see Smith & Brooks (2008);
Oliveira (2008); Megeath et al. (2008) respectively.

7.3. Filter Bands

For the analysis of images and photometry in Pa-
per II and Paper III, we require observations in IRAC
8 µm, MIPS 24 µm, PACS 70 µm, PACS 160 µm, SPIRE
250 µm, SPIRE 350 µm and SPIRE 500 µm. For a de-
tailed description of spectral transmission, see the Flux-
Compensator Paper. We convolve the spectral cube
with the transmission curves for these bands and extract
2-d images of the respective bands. We use the Flux-
Compensator’s built-in database ﬁlters. We do not
take into account the eﬀects of saturation22.

22 Note that saturation is currently not implemented in the
FluxCompensator which might create synthetic point sources
with a large dynamic range in ﬂux. This is enhanced by the ef-
fect that in the D14 SPH simulations stars below 20 M(cid:12) do not
ionize their surrounding or blow winds. A more realistic feedback
implementation in future will improve our realistic synthetic ob-
servations.

The FluxCompensator can also account for eﬀects
introduced by the extinction between the simulation ob-
ject and the observer. We redden the synthetic obser-
vations with the extinction law from Kim et al. (1994).
We set the optical extinction to AV = 10 mag for the
distance d = 3 kpc and to AV = 20 mag for the dis-
tance d = 10 kpc. See the FluxCompensator Paper
for the description of the built-in extinction function of
the FluxCompensator.

However, the observations are not only aﬀected by in-
terstellar extinction. One of the diﬃculties when an-
alyzing real observations is the presence of non-uniform
background, and therefore, disentangling the background
from the astronomical objects is challenging. Therefore,
to make sure we do not compare apples with oranges
in Paper II and Paper III, namely to ensure that the
simulated observations are as realistic as possible,
in
this paper (Paper I) we attempt to combine the syn-
thetic observations with real observations. We use rel-
atively empty patches of the Galactic plane from the
Galactic Legacy Infrared Mid-Plane Survey Extraordi-
naire (GLIMPSE; Benjamin et al. 2003; Churchwell et al.
2009) for IRAC, from the MIPS Galactic Plane Survey
(MIPSGAL; Carey et al. 2009) for MIPS, from the Her-
schel Infrared Galactic Plane Survey (Hi-GAL; Molinari
et al. 2010) for PACS and SPIRE. The observations
have an observed pixel resolution ϑobs of 1.(cid:48)(cid:48)2 (IRAC
8 µm), 2.(cid:48)(cid:48)4 (MIPS 24 µm), 3.(cid:48)(cid:48)2 (PACS 70 µm), 4.(cid:48)(cid:48)5 (PACS
160 µm), 6.(cid:48)(cid:48)0 (SPIRE 250 µm), 8.(cid:48)(cid:48)0 (SPIRE 350 µm) and
11.(cid:48)(cid:48)5 (SPIRE 500 µm). We combine relatively empty
patches of real observations with our computed realis-
tic synthetic observations for all seven bands. We place
our synthetic observations roughly half a degree away
((cid:96) (cid:39) 17.◦1915, b (cid:39) −0.◦618 704 45) from the Eagle Nebula.

IRAC 8µm0.6xMIPS 24µm0.4xPACS 70µm3xPACS 160µm10xSPIRE 250µm6xSPIRE 350µm4xSPIRE 500µm1x150500850Scaled Brightness (MJy sr−1)Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

23

Fig. 16.— MIPS 24 µm realistic synthetic observations of diﬀerent circumstellar set-ups. No additional circumstellar material (CM1),

rotational ﬂattened envelope reﬁnement (CM2), symmetrical power-law envelope density distribution (CM3).
See the FluxCompensator Paper for the description of
the built-in observation-combination functionality in the
FluxCompensator.

7.5. Resolution & PSF

Since the intrinsic pixel resolution ϑ0 is diﬀerent from
the observed pixel resolutions ϑobs, therefore, before we
can combine the synthetic observations with real obser-
vations, we need to adjust the resolution of synthetic
observations to the resolution of the real observations.
We change the intrinsic pixel resolution ϑ0 to the pixel
resolution of the observations ϑobs. See the FluxCom-
pensator Paper for the description of the built-in re-
gridding function of the FluxCompensator.

To further account for diﬀraction, we convolve the re-
gridded images in the respective bands with the point-
spread-function (PSF) of the respective telescopes. See
the FluxCompensator Paper for the description of
the built-in convolution function of the FluxCompen-
sator. We use the PSF ﬁles provided by the FluxCom-
pensator’s built-in database.

7.6. Set of Realistic Synthetic Observations

For every selected time-step in the D14 SPH simula-
tions, we produced realistic synthetic observations as de-
scribed in Section 7, using our favored techniques pre-
sented and discussed in Section 2 to Section 6.

For the time-step 122 (6.109 Myr), we show all seven
bands of the realistic synthetic observations, combined
with a real observed background in Figure 15 for a dis-
tance of 3 kpc and one viewing angle. While for the
IRAC, MIPS and PACS bands, the features of the sim-
ulated region dominate the image, in SPIRE the fea-
tures are overpowered by the background. Clearly, this
star-forming region does not contain enough mass for
the SPIRE emission to dominate, when compared to the
other material in the Galactic plane. Since the Galac-
tic plane is full of clouds, other background patches
within the Herschel
Infrared Galactic Plane Survey
(Hi-GAL) survey could not likely improve this. There-
fore, intermediate-mass clouds, such as the simulated re-
gion here, are ”lost” in SPIRE bands. This has to be
kept in mind when analyzing the realistic synthetic ob-
servations in Paper II and Paper III. However, we also
provide the realistic synthetic observations without back-
ground. Naturally, a desired background observation in
SPIRE would be slightly oﬀ the Galactic plane of a rela-

tively empty region. However, oﬀ the Galactic plane, the
Herschel Space Observatory only observed star-forming
clouds directly. We could have selected a region oﬀ the
Galactic plane with lower background, but this would not
have been typical of most observed star-forming regions,
which at that distance are all located in the Galactic
plane.

In Figure 16, we show one example for the three cir-
cumstellar set-ups described in Section 5.5. We can see
that we can ”observe” point sources for all three set-ups.
In Paper III and Paper IV, we will explore the diﬀer-
ences when counting the young stellar population in our
synthetic observations.

In Figure 17, we show an evolutionary sequence of the
run I star-forming region of the D14 SPH simulations in
PACS 70 µm at a distance of 3 kpc and for one viewing
angle. We provide all (5796) realistic synthetic obser-
vations for the 3 circumstellar material set-ups, 23 time-
steps, 3 viewing angles, 2 distances, 7 spectral bands and
both with and without combined realistic background as
FITS ﬁles in Appendix A.

8. SUMMARY

In this paper (Paper I), we produced realistic synthetic
observations of the coupled high-mass stellar feedback
run I of winds and ionization of the D14 SPH simula-
tions. We showed that mapping of SPH particles onto
a Voronoi mesh has to be done with caution. We have
tested several techniques which can perform this task
and found that the following methods produce the best
results:

• Pre-processing

Diﬀerent radiative transfer codes treat diﬀerent
physics, such as dust continuum or molecular line
transfer. Therefore, it is important to ﬁlter away
those SPH particles from the SPH distribution
(e. g. ionized particles), which are meaningless for
the radiative transfer code in question, before map-
ping onto the radiative transfer mesh.

• Grid

Within a Voronoi mesh, resolution can be increased
by gradually putting in more cells at regions of in-
terest, for instance around accreting stars. The
absence of a preferred direction of the mesh cre-
ates smoother images than Cartesian grids when
”observing” along a grid axis.

CM1CM220200400600800100012001400Brightness (MJy sr−1)CM324

Koepferl, Robitaille, Dale, Biscani

Fig. 17.— PACS 70 µm realistic synthetic observations (including background) over all time-steps of the D14 SPH simulations.

3.576 Myr02425010001750Brightness (MJy sr−1)3.725 Myr0253.874 Myr0264.023 Myr0274.172 Myr0284.321 Myr0294.470 Myr0304.619 Myr0314.768 Myr0324.917 Myr0425.066 Myr0525.215 Myr0625.364 Myr0725.513 Myr0825.662 Myr0925.811 Myr1025.960 Myr1126.109 Myr1226.258 Myr1326.407 Myr1426.556 Myr1526.705 Myr1626.854 Myr172Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

25

• Sites

When a Voronoi mesh is set up to represent an SPH
simulation, including large low-density regions can
cause artifacts when mapping only the positions
of the SPH particles onto the mesh. Artifacts are
reduced by placing Voronoi sites also at the posi-
tions of the sink particles in addition to the sites
at the positions of the SPH particles. Additionally,
adding circumstellar sites around the accreting sink
particles reduces artifacts and increases the resolu-
tion in the circumstellar material.

• Mapping

The mapping of the properties, such as density and
temperature, from the SPH simulation onto the ra-
diative transfer mesh has to preserve the gradients
of the original distributions. We presented a ran-
dom sampling technique which ensures a smooth
density and temperature mapping from the SPH
simulations onto the mesh, while conserving mass.

• Envelope Fitting

We present three diﬀerent ways of reﬁning the
circumstellar material beyond the resolution limit
of the SPH simulation. We presented methods
to extrapolate the inner circumstellar material
with rotational ﬂattened and spherically symmet-
ric power-law proﬁles. However, inward extrapola-
tions are only an approximation. In order to have
a consistent physical picture, in future, simulations
with higher resolution would be ideal.

• Circumstellar Material

We produced a set of realistic synthetic observa-
tions with and without circumstellar material to
evaluate the impact of circumstellar material on
observed ﬂuxes. We will explore the eﬀects on the
total ﬂux in Paper III and the point-source count-
ing in Paper III and Paper IV.

• Dust

To recover the NIR and MIR ﬂux (below 70 µm),
dust distributions which include PAH molecules
(e. g. Draine & Li 2007) should be used when cal-
culating the radiative transfer.

• Temperatures

Coupling the SPH temperature, following Larson
(2005)’s EOS, with the iterated radiative trans-
fer dust temperature produces unphysical emission
within a dust radiative transfer code, although the
hydrodynamical temperature is below the dust sub-
limation temperature. The line cooling part of Lar-
son (2005)’s EOS causes a gas temperature rise
in low density regions at the edges of the simula-
tion, which produces unphysical/unobserved ﬂuxes
when comparing to real star-forming regions, when
blindly coupling the hydrodynamical temperature
with the dust radiative transfer temperature. How-
ever, the heating term in Larson (2005)’s EOS at
low densities implies a decoupling from gas and
dust. Therefore, we conclude that, at least for
dust radiative transfer codes, the hydrodynamical
temperature (hence gas temperature) should be re-
placed by a constant background temperature.

In this paper (Paper I), we will provide online about
5800 realistic synthetic observations of the 3 circumstel-
lar material set-ups, 23 time-steps, 3 viewing angles, 2
distances, 7 spectral bands and with combined back-
ground and without of the synthetic star-forming region.
The FITS ﬁles of the ”observations” are stored in Ap-
pendix A. In Paper II, Paper III and Paper IV, we will
analyze these ”observations”.

9. ACKNOWLEDGEMENTS

We thank the referee for a constructive report that
helped us improve the clarity and the strength of the
results presented in our paper. This work was carried
out in the Max Planck Research Group Star formation
throughout the Milky Way Galaxy at the Max Planck
Institute for Astronomy. C. K. is a fellow of the Interna-
tional Max Planck Research School for Astronomy and
Cosmic Physics (IMPRS) at the University of Heidelberg,
Germany and acknowledges support. C. K. acknowledges
support from STFC grant ST/M001296/1. J. E. D. was
supported by the DFG cluster of excellence Origin and
Structure of the Universe. This research made use of
Astropy, a community-developed core Python package
for Astronomy (Astropy Collaboration et al. 2013), mat-
plotlib, a Python plotting library (Hunter 2007), Scipy,
an open source scientiﬁc computing tool (Jones et al.
2001–), the NumPy package (van der Walt et al. 2011)
and IPython, an interactive Python application (P´erez
& Granger 2007).

REFERENCES

Armitage, P. J. 2010, Astrophysics of Planet Formation, 1st edn.

Brott, I., & Hauschildt, P. H. 2005, in ESA Special Publication,

(Cambridge University Press)

Astropy Collaboration, Robitaille, T. P., Tollerud, E. J., et al.

2013, A&A, 558, A33

Barcarolo, D., Le Touz´e, D., OGER, G., & De Vuyst, F. 2014, in

9th Int. SPHERIC Workshop, Paris, France

Bate, M. R. 2014, MNRAS, 442, 285
Bate, M. R., Bonnell, I. A., & Bromm, V. 2002a, MNRAS, 332,

L65

—. 2002b, MNRAS, 336, 705
—. 2003, MNRAS, 339, 577
Bate, M. R., Bonnell, I. A., & Price, N. M. 1995, MNRAS, 277,

362

Benjamin, R. A., Churchwell, E., Babler, B. L., et al. 2003,

PASP, 115, 953

Bernasconi, P. A., & Maeder, A. 1996, A&A, 307, 829

Vol. 576, The Three-Dimensional Universe with Gaia, ed.
C. Turon, K. S. O’Flaherty, & M. A. C. Perryman, 565
Camps, P., Baes, M., & Saftly, W. 2013, A&A, 560, A35
Carey, S. J., Noriega-Crespo, A., Mizuno, D. R., et al. 2009,

PASP, 121, 76

Carroll, B. W., & Ostlie, D. A. 1996, An Introduction to Modern
Astrophysics, 1st edn. (Addison Wesley Publishing Company)
Castelli, F., & Kurucz, R. L. 2004, ArXiv Astrophysics e-prints,

astro-ph/0405087

Churchwell, E., Babler, B. L., Meade, M. R., et al. 2009, PASP,

121, 213

Dale, J. E. 2015, New Astronomy Reviews, 68, 1
Dale, J. E., & Bonnell, I. 2011, MNRAS, 414, 321
Dale, J. E., & Bonnell, I. A. 2008, MNRAS, 391, 2
Dale, J. E., Ercolano, B., & Bonnell, I. A. 2012, MNRAS, 424, 377

26

Koepferl, Robitaille, Dale, Biscani

—. 2013a, MNRAS, 430, 234
Dale, J. E., Ercolano, B., & Clarke, C. J. 2007, MNRAS, 382,

1759

Dale, J. E., Ngoumou, J., Ercolano, B., & Bonnell, I. A. 2013b,

MNRAS, 436, 3430

—. 2014, MNRAS, 442, 694
Diaz-Miller, R. I., Franco, J., & Shore, S. N. 1998, ApJ, 501, 192
Draine, B. T. 2003, ARA&A, 41, 241
—. 2011, Physics of the Interstellar and Intergalactic Medium, 1st

edn. (Princeton Universtiy Press)

Draine, B. T., & Li, A. 2007, ApJ, 657, 810
Feynman, R. P. 1977, Feynman lectures on physics - Volume 1,

6th edn. (Addison-Wesley)

Hubber, D. A., Ercolano, B., & Dale, J. 2016, MNRAS, 456, 756
Hunter, J. D. 2007, Computing In Science & Engineering, 9, 90
Jones, E., Oliphant, T., Peterson, P., et al. 2001–, SciPy: Open

source scientiﬁc tools for Python, [Online; accessed 2012-2015]
Kim, S.-H., Martin, P. G., & Hendry, P. D. 1994, ApJ, 422, 164
Koenig, X. P., Leisawitz, D. T., Benford, D. J., et al. 2012, ApJ,

744, 130

Koepferl, C. M., & Robitaille, T. P. (in preparation,

FluxCompensator Paper)

Koepferl, C. M., Robitaille, T. P., & Dale, J. E. 2016a, ApJ

(submitted, Paper II)

—. 2016b, ApJ (submitted, Paper III)
Koepferl, C. M., Robitaille, T. P., Dale, J. E., & Biscani, F.

2016c, ApJS (accepted, Paper I)

Koepferl, C. M., Robitaille, T. P., Morales, E., & Dale, J. E. (in

preparation, Paper IV)

Oﬀner, S. S. R., Robitaille, T. P., Hansen, C. E., McKee, C. F., &

Klein, R. I. 2012, ApJ, 753, 98

Oliveira, J. M. 2008, Star Formation in the Eagle Nebula, ed.

B. Reipurth (Astronomical Society of the Paciﬁc Monograph
Publications), 599

P´erez, F., & Granger, B. 2007, Computing in Science

Engineering, 9, 21

Press, W. H., Teukolsky, S. A., Vetterling, W. T., & Flannery,

B. P. 1992, Numerical Recipes in FORTRAN. The Art of
Scientiﬁc Computing, 2nd edn. (Cambridge University Press)

Robitaille, T. P. 2011, A&A, 536, A79
Robitaille, T. P., Churchwell, E., Benjamin, R. A., et al. 2012,

A&A, 545, A39

Rycroft, C. H. 2009, Chaos, 19, 041111
Shakura, N. I., & Sunyaev, R. A. 1973, A&A, 24, 337
Shu, F. H. 1977, ApJ, 214, 488
Sibson, R. 1981, Interpreting multivariate data, 21, 21
Siess, L., Dufour, E., & Forestini, M. 2000, A&A, 358, 593
Smith, N., & Brooks, K. J. 2008, The Carina Nebula: A

Laboratory for Feedback and Triggered Star Formation, ed.
B. Reipurth (Astronomical Society of the Paciﬁc Monograph
Publications), 138

Springel, V. 2010a, MNRAS, 401, 791
—. 2010b, ARA&A, 48, 391
Starinshak, D., Owen, J., & Johnson, J. 2014, Computer Physics

Communications, 185, 3204

Steinacker, J., Baes, M., & Gordon, K. D. 2013, ARA&A, 51, 63
Ulrich, R. K. 1976, ApJ, 210, 377
van der Walt, S., Colbert, S., & Varoquaux, G. 2011, Computing

Kurosawa, R., Harries, T. J., Bate, M. R., & Symington, N. H.

in Science Engineering, 13, 22

2004, MNRAS, 351, 1134

Larson, R. B. 2005, MNRAS, 359, 211
Megeath, S. T., Townsley, L. K., Oey, M. S., & Tieftrunk, A. R.
2008, Low and High Mass Star Formation in the W3, W4, and
W5 Regions, ed. B. Reipurth (Astronomical Society of the
Paciﬁc Monograph Publications), 264

Molinari, S., Swinyard, B., Bally, J., et al. 2010, PASP, 122, 314

Weingartner, J. C., & Draine, B. T. 2001, ApJ, 548, 296
Whitney, B. A., Wood, K., Bjorkman, J. E., & Wolﬀ, M. J. 2003,

ApJ, 591, 1049

Wright, E. L., Eisenhardt, P. R. M., Mainzer, A. K., et al. 2010,

AJ, 140, 1868

Zhou, J., Li, M., Zhang, Z., Zou, W., & Zhang, L. 2007, Computer

Methods in Applied Mechanics and Engineering, 196, 1958

ONLINE OBSERVATIONS OF SYNTHETIC STAR-FORMING REGIONS

We provide ∼5800 realistic synthetic observations (FITS ﬁles) of the synthetic star-forming region for the combi-
nations of the 3 circumstellar material set-ups, 23 time-steps, 3 viewing angles, 2 distances, 7 spectral bands, with
combined background and without. We analyze these ”observations” and we will publish the results in Paper II, Paper
III and Paper IV. The realistic synthetic observations can be accessed here:

APPENDIX

http://dx.doi.org/10.5281/zenodo.31293

The ﬁlename of the ”observations” is constructed of the combinations of abbreviations which refer to methods/algo-
rithms from Paper I and are separated by underscores:

both I122 s3 p3 voronoi DraineLiPAH c1 DT2 CM1 O1 D1 MIPS1 R1 B2 . f i t s

The ﬁlenames are set up through the following system:

both
I 1 2 2
s 3

: <f e e d b a c k type>
: <SPH ID>
: < s i t e d i s t r i b u t i o n >

p3

: <parameter d i s t r i b u t i o n >

v o r o n o i
DraineLiPAH : <d u s t
c1

: <g r i d type>
type>

: <c l i p p i n g >

DT2

CM1

: <RT t e m p e r a t u r e & dust>

: <c i r c u m s t e l l a r m a t e r i a l >

( s 1 ) ,

s i n k p a r t i c l e s

( s 2 ) ,

s i t e s

( s 3 )

s i t e s a t
c i r c u m s t e l l a r

# both ( winds & i o n i z a t i o n )
# SPH s i m u l a t i o n s e t−up type & time−s t e p
# s i t e s a t SPH p a r t i c l e s
# a d d i t i o n a l
# a d d i t i o n a l
# SPH f u n c t i o n ( p1 ) ,
# SPH s p l i t t i n g ( p2 ) ,
# random s a m p l i n g method ( p3 )
# Voronoi
# DraineLiPAH , DraineMW
# f o r e q u a t i o n o f
# f o r
# combined t e m p e r a t u r e s
# i s o t h e r m a l
# r a d i a t i v e
# none (CM1) ,
# U l r i c h a n a l y t i c a l model (CM2) ,
# power−law a n a l y t i c a l model (CM3)

t e m p e r a t u r e (DT2) ,

t e m p e r a t u r e ( c2 )

t e s s e l l a t i o n

s t a t e ( c1 ) ,

(DT1) ,

t r a n s f e r

t e m p e r a t u r e a l o n e (DT3)

Synthetic Star-forming Regions - I. Reliable Mock Observations from SPH Simulations

27

O1
D1
MIPS1
R1

B2

: <o r i e n t a t i o n plane >
: <d i s t a n c e >
: <d e t e c t o r >
: <r e s o l u t i o n type>

: <background type>

# O1 ( xy ) , O2 ( xz ) , O3( yz )
# D1 ( 3 kpc ) , D2 ( 1 0 kpc )
# D e t e c t o r o f
r e a l i s t i c
# d e t e c t o r
r e s o l u t i o n (R1) ,
# t e c h n i q u e r e s o l u t i o n (R2)
# w i t h o u t background ( B1 ) ,
# with background ( B2 )

s y n t h e t i c o b s e r v a t i o n

The diﬀerent methods and their abbreviations are described in Paper I. In the header of the respective FITS ﬁle, the
information from the ﬁle name is stored additionally. The FITS ﬁles include world coordinate information similarly to
real observations from the respective detectors. As an example, we show the FITS header of a MIPS 24 µm observation
below:

−64 / a r r a y data type

t o FITS s t a n d a r d

2 / number o f a r r a y d i m e n s i o n s

2 / Number o f c o o r d i n a t e a x e s

−781.75 / P i x e l c o o r d i n a t e o f
1 3 5 8 . 2 5 / P i x e l c o o r d i n a t e o f

r e f e r e n c e p o i n t
r e f e r e n c e p o i n t

−0.000666666666 / [ deg ] C o o r d i n a t e i n c r e m e n t a t
0 . 0 0 0 6 6 6 6 6 6 6 6 6 / [ deg ] C o o r d i n a t e i n c r e m e n t a t

r e f e r e n c e p o i n t
r e f e r e n c e p o i n t

860
860

= ’MJy/ s r

T / conforms

SIMPLE =
BITPIX =
NAXIS
=
NAXIS1 =
NAXIS2 =
WCSAXES =
CRPIX1 =
CRPIX2 =
CDELT1 =
CDELT2 =
CUNIT1 = ’ deg ’
CUNIT2 = ’ deg ’
CTYPE1 = ’GLON−CAR’
CTYPE2 = ’GLAT−CAR’
CRVAL1 =
CRVAL2 =
LONPOLE =
LATPOLE =
BUNIT
DISTANCE=
FEEDBACK= ’ both
RUNTYPE = ’ I
TIMESTEP= ’ 1 2 2
SITETYPE= ’ s 3
PARATYPE= ’ p3
GRIDTYPE= ’ v o r o n o i
DUSTTYPE= ’ DraineLiPAH ’
’
CLIPTYPE= ’ c1
’
DTTYPE = ’DT2
’
CMTYPE = ’CM1
’
ORIETYPE= ’O1
’
DISTTYPE= ’D1
RTCODE = ’HYPERION’
SYNOBS = ’ FluxCompensator ’
DETECTOR= ’ MIPS1
RESTYPE = ’R1
BGTYPE = ’ B2
COMMENT For more d e s c r i p t i o n s e e Appendix .
END

’
’
’
’
’
’

’
’
’

’

/ U n i t s o f c o o r d i n a t e i n c r e m e n t and v a l u e
/ U n i t s o f c o o r d i n a t e i n c r e m e n t and v a l u e
/ g a l a c t i c l o n g i t u d e , p l a t e c a r e e p r o j e c t i o n
/ g a l a c t i c

1 8 . 0 / [ deg ] C o o r d i n a t e v a l u e a t
0 . 0 0 0 1 / [ deg ] C o o r d i n a t e v a l u e a t
0 . 0 / [ deg ] N a t i v e l o n g i t u d e o f

l a t i t u d e , p l a t e c a r e e p r o j e c t i o n
r e f e r e n c e p o i n t
r e f e r e n c e p o i n t
c e l e s t i a l p o l e

8 9 . 9 9 9 9 / [ deg ] N a t i v e l a t i t u d e o f

c e l e s t i a l p o l e

3 . 0 / D i s t a n c e t o o b j e c t

s2 ,

s1 ,

s t e l l a r

i n u n i t s o f kpc

/ U n i t s o f a r r a y
/ High−mass
f e e d b a c k
/ SPH s i m u l a t i o n s e t−up type
/ SPH s i m u l a t i o n time−s t e p
/ S i t e d i s t r i b u t i o n :
s 3
/ Parameter mapping : p1 , p2 , p3
/ Grid t y p e s : Voronoi
/ Dust t y p e s : DraineLiPAH , DraineMW
/ C l i p p i n g SPH sample : c1 , c2
/ R a d i a t i v e t r a n s f e r
/ C i r c u m s t e l l a r m a t e r i a l : CM1, CM2, CM3
/ O r i e n t a t i o n p l a n e : O1 ( xy ) , O2 ( xz ) , O3( yz )
/ D i s t a n c e : D1 ( 3 kpc ) , D2 ( 1 0 kpc )
/ 3−d d u s t continuum r a d i a t i v e
/ Tool
/ D e t e c t o r o f
/ R e s o l u t i o n type : R1 ( d e t e c t o r ) , R2 ( o t h e r )
/ Background type : B1 ( w i t h o u t ) , B2 ( with )

s e t−up : DT1, DT2, DT3

t r a n s f e r code

t e s s e l l a t i o n

t o c r e a t e

r e a l i s t i c

r e a l i s t i c

s y n t h e t i c o b s e r v a t i o n s

s y n t h e t i c o b s e r v a t i o n s

RANDOM SAMPLING WITH PROBABILITY DISTRIBUTION FUNCTIONS

A PDF is dependent on a variable x that we want to distribute. A random number ξ is sampled between [0, 1]
and the distributed variable x(ξ) is equated through analytical or numerical integration of the PDF through inverse
transform sampling (for more information on PDFs, see Press et al. 1992):

x(cid:82)
xmax(cid:82)

xmin

ξ =

P (x(cid:48))dx(cid:48)

P (x(cid:48))dx(cid:48)

→ x(ξ)

(B1)

Following Section 3.2.3, we can sample the radial log-spaced PDF through a step-by-step evaluation of the integral
over the normalized PDF. The log-spaced probability distribution produces more sites at small radii. Hence, the size
of the Voronoi cells will decrease and we recover a smoother gradient of density across the dynamic range (this will
be discussed further in Section 5.1). With a constant PDF = const = c, we can solve the integral for the radius r

xmin

28

Koepferl, Robitaille, Dale, Biscani

analytically using inverse transform sampling:

r(cid:90)

rmax(cid:90)

ξ =

d log10(r)PDF PDF=c= c

rmin

rmin

r = 10ξ/c+log10 rmin .

1 =

d log10(r)PDF PDF=c= c
c = 1/ [log10 rmax − log10 rmin] ,

rmin

rmin

r(cid:90)

d log10(r) = c [log10 r − log10 rmin]

rmax(cid:90)
d log10(r) = c [log10 rmax − log10 rmin]

Eq. B2 uses the random numbers ξ from 1 to zero and the normalization constant c

to calculate the distribution function:

r = 10ξ[log10 rmax−log10 rmin]+log10 rmin .

Following Section 3.3.2, to space the split SPH particle k with respect to the SPH particle i again, we use the PDF

(as in Eq. B2). However, this time the

PDF =

∼
c Wik(rik, hi) (cid:54)= const

(B6)

with the spacing rik and the SPH particle smoothing length hi. We determine the spacing rik, by setting up the
integral over the PDF (i. e. Eq. B2) but this time with linear spacing:

dr r2Wik(rik, hi = 1)

(B7)

for a constant smoothing length hi = 1, with the random numbers ξ and the normalizing constant
is not constant, we have to solve for the values of distance rik numerically (see Press et al. 1992).

∼
c. Since the PDF

rmin

rmin

Following Section 4.2, we will describe here in more detail the spectra interpolation. We pick the four closest model

SPECTRA INTERPOLATION

rik(cid:90)

ξ =

dr r2 PDF =

∼
c

rik(cid:90)

spectra Fmod(T1, T2, g1, g2), which have values between

log10 T2 ≥ log10 Teﬀ ≥ log10 T1
log10 g2 ≥ log10 g∗ ≥ log10 g1

and deﬁne the model diﬀerences as follows:

(B2)

(B3)

(B4)

(B5)

(C1)
(C2)

(C3)
(C4)
(C5)
(C6)

(C7)

(C8)

Through bilinear interpolation (for more details, see Press et al. 1992), we weight the four spectra

with the diﬀerences from Eq. C3 to Eq. C6 and extract the spectra Fν∗ of a source with mass M∗:

∆T = log10 T2 − log10 T1
∆g = log10 g2 − log10 g1
∆Te = log10 T2 − log10 Teﬀ
∆g∗ = log10 g2 − log10 g∗.

(cid:19)
(cid:18)Fmod(T1, g1) Fmod(T1, g2)
(cid:18) ∆g∗

Fmod(T2, g1) Fmod(T2, g2)

(cid:19)

Fmod =

Fν∗ = (∆Te ∆T − ∆Te)

Fmod
∆T ∆g

∆g − ∆g∗

.

