Multilayer optical calculations

Steven J. Byrnes

Current aﬃliation: Charles Stark Draper Laboratory, Cambridge, Massachusetts, USA

Contact: steven.byrnes@gmail.com

March 10, 2016

Abstract

When light hits a multilayer planar stack, it is reﬂected, refracted, and absorbed in
a way that can be derived from the Fresnel equations. The analysis is treated in many
textbooks, and implemented in many software programs, but certain aspects of it are
diﬃcult to ﬁnd explicitly and consistently worked out in the literature. Here, we derive
the formulas underlying the transfer-matrix method of calculating the optical proper-
ties of these stacks, including oblique-angle incidence, absorption-vs-position proﬁles,
and ellipsometry parameters. We discuss and explain some strange consequences of
the formulas in the situation where the incident and/or ﬁnal (semi-inﬁnite) medium
are absorptive, such as calculating T > 1 in the absence of gain. We also discuss some
implementation details like complex-plane branch cuts. Finally, we derive modiﬁed
formulas for including one or more “incoherent” layers, i.e. very thick layers in which
interference can be neglected. This document was written in conjunction with the
“tmm” Python software package, which implements these calculations.

6
1
0
2

 
r
a

M
6

 

 
 
]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[
 
 

1
v
0
2
7
2
0

.

3
0
6
1
:
v
i
X
r
a

1

Contents

1 Introduction

2 Wave propagation

2.1 What is complex refractive index? . . . . . . . . . . . . . . . . . . . . .
2.2 Explicit E, H, and k for s-polarization and p-polarization . . . . . . . .

3 Single-interface reﬂection and transmission amplitudes

4 Multilayer thin ﬁlms

4.1 Complex amplitudes for reﬂection and transmission . . . . . . . . . . . .
4.2 Ellipsometric parameters . . . . . . . . . . . . . . . . . . . . . . . . . . .
4.3 Calculating Poynting vector . . . . . . . . . . . . . . . . . . . . . . . . .
4.4 T (transmitted intensity) and R (reﬂected intensity) . . . . . . . . . . .
4.4.1 Counter-intuitive results when the initial medium is absorptive .
4.5 Absorbed energy density . . . . . . . . . . . . . . . . . . . . . . . . . . .

5 Branch cuts

6 Thick “incoherent” ﬁlms

6.1
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6.2 Calculation method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6.3 Absorption proﬁle, Coherence length . . . . . . . . . . . . . . . . . . . .

7 Acknowledgments

A Appendix: Sign convention for reﬂection amplitude

B Appendix: R and T with an absorptive starting medium

B.1 Accounting for this eﬀect in the incoherent calculation . . . . . . . . . .

C Appendix: Stimulated emission

3

3
4
4

5

5
5
7
7
8
8
9

10

10
10
11
12

13

14

14
17

17

D Appendix: Branch cuts

18
18
D.1 Case that Im n > 0, Re n > 0 . . . . . . . . . . . . . . . . . . . . . . .
19
D.2 Implementation for Im n > 0, Re n > 0 . . . . . . . . . . . . . . . . . .
19
D.3 Case that Im n = 0, Re n > 0 . . . . . . . . . . . . . . . . . . . . . . .
D.3.1 Case Im n = 0, Re n > 0, Total internal reﬂection . . . . . . . .
20
D.3.2 Case Im n = 0, Re n > 0, Total internal reﬂection implementation 20
20
D.3.3 Case Im n = 0, Re n > 0, Normal refraction . . . . . . . . . . .
20
D.3.4 Case Im n = 0, Re n > 0, Normal refraction implementation . .
20
D.4 Case that Im n < 0, Re n < 0 . . . . . . . . . . . . . . . . . . . . . . .
D.5 Everything else . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
21

2

1

Introduction

I originally wrote these notes to record and explain the calculations implemented
by the “tmm” (short for “transfer matrix method”) Python software package: See
https://pypi.python.org/pypi/tmm.

The derivations (at least through Sec. 4) can be found, in whole or part, in quite a
few textbooks and references. I found Bo Sernelius’s lecture notes1 an especially useful
starting point.

Apart from my tmm program, there are many other programs that calculate some
or all of the same formulas.2 I have done a few consistency checks between my program
and others. They tend to agree perfectly except in the tricky (and somewhat unusual)
case of calculating reﬂected power or transmitted power when the semi-inﬁnite incom-
ing and/or outgoing medium has a complex index of refraction.

I assume non-magnetic (µ = µ0) and isotropic (as opposed to birefringent) materials

throughout the document.

2 Wave propagation

We assume our structure is a stack of one or more smooth planar layers, such as a ﬂat
piece of glass with an antireﬂective coating on top. The interfaces between layers are
all normal to ˆz, and everything is uniform in the x and y directions. We assume the
wavevector of the light is in the x–z plane. (Or just along ˆz if it’s normal-incidence).
The “forward” direction (direction that normally-incident incoming light is traveling)
is +ˆz.

All sinusoidally-oscillating quantities are given as complex numbers; to get the

actual value at any particular time, multiply by e−iωt and take the real part.

The electric ﬁeld at any given point is a superposition of the forward-moving and

backwards-moving electromagnetic waves:

E(r) = E0

f eikf ·r + E0

beikb·r

(1)

f and E0

Here, kf and kb are the [angular] wavevectors for forward- and backwards-moving
waves; E0
b are some constant vectors; and E(r) is the complex electric ﬁeld at
any given point r within a certain layer. The y-components of the kf and kb are zero
because, like I said above, the wavevector is assumed to be in the x–z plane. The x-
components of kf and kb are always real, because we are assuming it’s a plane wave, so
the light intensity is uniform along the x and y directions. However, the z component
might be complex, representing a wave that is attenuating as it travels through the
stack, due to absorption.

The wavevectors is related to the [complex] index of refraction n by:

kf =

2πn
λvac

(ˆz cos θ + ˆx sin θ)

, kb =

2πn
λvac

(−ˆz cos θ + ˆx sin θ)

(2)

1http://people.ifm.liu.se/boser/elma/–especially lecture 13
2I have a list at: http://sjbyrnes.com/multilayer-film-optics-programs/

3

where θ is the angle from the normal, and λvac is the vacuum wavelength. That means
n sin θ is always a real number, but n cos θ might not be. This is consistent with Snell’s
law:

ni sin θi = nj sin θj

(3)

i.e., n sin θ should be the same real number in every layer. Snell’s law is the same as
saying that the component of k in the x − y plane is the same in each layer.

2.1 What is complex refractive index?

When the refractive index is complex, the imaginary part is sometimes called “extinc-
tion coeﬃcient”. The larger it is, the more quickly light gets absorbed as it tries to
travel through the material. Negative extinction coeﬃcient corresponds to stimulated
emission. Extinction coeﬃcient, like refractive index, is a unitless number. It should
NOT be confused with “molar extinction coeﬃcient” or “mass extinction coeﬃcient” in
chemistry, which are not unitless.3 For real-world materials, the extinction coeﬃcient,
like the refractive index, is diﬀerent at diﬀerent frequencies.

Again, with the conventions used here, Im n > 0 means absorption and Im n < 0

means stimulated emission.

2.2 Explicit E, H, and k for s-polarization and p-polarization

As usual, s-polarization is where the E-ﬁeld points in the y-direction, and p-polarization
is where the H-ﬁeld points in the y-direction. There is no diﬀerence between s and
p-polarization for normal-incident light. However, the way our sign conventions work,
the reﬂection amplitude for a normal-incidence wave is given with the opposite sign
depending on whether you call it “s” or “p“! For s-polarization, our sign convention is
based on the direction of the E-ﬁeld—e.g., if two waves have E pointing parallel, then
their amplitudes have the same sign. Whereas for p-polarization, our sign convention is
based on the direction of the H-ﬁeld. Half of textbooks use the opposite sign convention
for p from this one, so don’t be surprised to see discrepancies between diﬀerent sources.
See Appendix A for further discussion.

Maxwell’s equations imply that H = 1

µ0ω k × E for a plane wave. [This works even

if k and/or E is a complex vector.] Therefore the explicit E, H, k are:

s-polarization

kf =

2πn
λvac

(cos θˆz + sin θˆx)

2πn
λvac
Ef = Ef ˆy , Eb = Eb ˆy

, kb =

(− cos θˆz + sin θˆx)

Hf ∝ nEf (− cos θˆx + sin θˆz)

, Hb ∝ nEb (cos θˆx + sin θˆz)

(4)

3However,

if

you

know

one

you

can

ﬁgure

out

the

other.

See

https://en.wikipedia.org/w/index.php?title=Mathematical_descriptions_of_opacity&oldid=695422502.

4

and

p-polarization

kf =

2πn
λvac

(cos θˆz + sin θˆx)

, kb =

2πn
λvac

(− cos θˆz + sin θˆx)

Ef = Ef (− sin θˆz + cos θˆx)

, Eb = Eb(− sin θˆz − cos θˆx)

Hf ∝ nEf ˆy , Hb ∝ nEb ˆy

(5)

3 Single-interface reﬂection and transmission am-
plitudes

If you have the interface between two layers 1 and 2, and shine light from 1, then
there are three relevant wave amplitudes: The incident amplitude (Ef on the layer 1
side), the reﬂected amplitude (Eb on the layer 1 side), and the transmitted amplitude
(Ef on the layer 2 side). The reﬂection coeﬃcient r is the ratio of reﬂected amplitude
to incident amplitude, and the transmission coeﬃcient t is the ratio of transmitted
amplitude to incident amplitude.

To derive the equations for r and t (“The Fresnel Equations”), we start with Eqs. (4-
5) on both sides of the interface, with Ef = E0, Eb = rE0 on the starting side and
Ef = tE0, Eb = 0 on the destination side. Then we plug in the boundary conditions for
E and H: Hx, Hy, Hz, Ex, Ey, and n2Ez are all continuous across the boundary. Two
clariﬁcations: (1) These boundary conditions refer to components of the total ﬁelds
E = Ef + Eb and H = Hf + Hb; (2) The criterion is actually that Bz and Dz are
continuous across the boundary, but I just rephrased it in terms of Hz and Ez using
µ = µ0, ǫ = n2ǫ0.

Readers may check the algebra themselves, or refer to any optics textbook; traveling

from medium 1 into medium 2:

rs =

ts =

n1 cos θ1 − n2 cos θ2
n1 cos θ1 + n2 cos θ2

2n1 cos θ1

n1 cos θ1 + n2 cos θ2

,

,

rp =

tp =

n2 cos θ1 − n1 cos θ2
n2 cos θ1 + n1 cos θ2

2n1 cos θ1

n2 cos θ1 + n1 cos θ2

(6)

4 Multilayer thin ﬁlms

4.1 Complex amplitudes for reﬂection and transmission

Now we have N materials, numbered 0, 1, . . . , N − 1, where the ﬁrst (“0”) and last
(“N − 1”) layer are semi-inﬁnite. Light with amplitude 1 is in layer 0, heading towards
layer 1 (Fig. 1).

At the interface between the (n − 1)st and nth material, let vn be the amplitude of
the wave on the nth side heading forwards (away from the boundary), and let wn be

5

Layer 3

Layer 2

Layer 1

Layer 0

v3=t

w3=0

v2

w2

v1

1

w1
r

"
s
d
r
a
w
r
o
f
"

"
s
d
r
a
w
k
c
a
b
"

n
o
i
t
c
e
r
i
d
 
z
+

Figure 1 – Sample stack with N = 4 (two ﬁnite layers between two semi-inﬁnite layers).
The labels next to the small arrows indicate wave amplitudes.

the amplitude on the nth side heading backwards (towards the boundary). (Fig. 1.)
((v0, w0) are undeﬁned, while vN −1 = t and wN −1 = 0.) We deﬁne

δn ≡ (thickness of layer n)(kz for the forward-traveling wave in layer n)

(7)

i.e., δn characterizes the phase [and when kz is complex, also the absorption] that comes
from passing through layer n. Now from the deﬁnitions of r and t, we get:

vn+1 = (vneiδn)tn,n+1 + wn+1rn+1,n
wne−iδn = wn+1tn+1,n + (vneiδn)rn,n+1

(8)

where ra,b and ta,b are reﬂection and transmission for light heading from layer a into
layer b. Using the identities ra,b = −rb,a and ta,btb,a − ra,brb,a = 1 (which follow from
Eqs. (6)), we can transform these into:

wn(cid:19) = Mn(cid:18) vn+1
(cid:18) vn
wn+1(cid:19)

for n = 1, . . . , N − 2, where

Mn ≡ (cid:18)e−iδn

0

0

eiδn(cid:19)(cid:18) 1

rn,n+1

rn,n+1

1 (cid:19) 1

tn,n+1

(9)

(10)

Now we want the matrix relating the waves entering the structure to the waves exiting,
i.e.:

(cid:18)1
r(cid:19) = ˜M (cid:18)t

0(cid:19) .

(11)

(12)

(13)

˜M is given by:

˜M =

1

t0,1 (cid:18) 1

r0,1

r0,1

1 (cid:19) M1M2 · · · MN −1

Combining these two equations allows r and t to be written in terms of the four entries
of the matrix ˜M :

r(cid:19) = (cid:18) ˜M00
(cid:18)1
˜M10

˜M01
˜M11(cid:19)(cid:18)t
0(cid:19)

6

t = 1/ ˜M00,

r = ˜M10/ ˜M00

(14)

So now we know how to calculate r and t for an arbitrary multi-layer thin ﬁlm. (And
incidentally, it is straightforward from here to also calculate vn and wn for every n.)

4.2 Ellipsometric parameters

If we know rs and rt, we can also calculate the two parameters measured in ellipsometry:

ψ ≡ tan−1(|rp/rs|)

, ∆ ≡ phase(−rp/rs)

(15)

where “phase” means complex phase angle.

However, I found that diﬀerent textbooks have diﬀerent deﬁnitions. So you may

need to ﬂip the signs, add or subtract π/2, etc.

4.3 Calculating Poynting vector

INCOMING

LIGHT

P

o

v

e

y

ntin
ctor

g

L

o

a

b

s

c

al

orptio

n

n

=

n=1

2

.

2

+

0

.

2

i

n=3.3+0.3i

n=1

Figure 2 – Sample calculation of local absorption and Poynting vector in a two-layer struc-
ture with air on both sides (refractive indices written below the graph).

The next few sections relate to power ﬂows and power absorption: The goal is to
be able to generate graphs like Fig. 2. The relevant equations are somewhat hard
to ﬁnd (without typos) in the literature, but I veriﬁed them by various consistency
checks, such as continuity across interfaces when appropriate, agreement with R and
T in simple cases, etc.

I will start by deriving the expression for the normal component of the Poynting
vector S, i.e. S · ˆz. This dot-product represents the net power ﬂowing forward through
the structure at a given point. We compute it as a unitless fraction of the total incoming
power. Start with s-polarization, using Eq. (4):

E = Ef ˆy + Eb ˆy
H ∝ nEf (− cos θˆx + sin θˆz) + nEb (cos θˆx + sin θˆz)

S · ˆz =

1
2

Re[ˆz · (E∗ × H)] ∝ Re[(E∗

f + E∗

b )(Ef − Eb)n cos θ]

(16)

7

I am really only interested in power ﬂow as a fraction of incoming power. The incoming
power is what you would get with Ef = 1, Eb = 0. So here is the ﬁnal result:

s-polarization:

S · ˆz =

Next, p-polarization, from Eq. (5):

Reh(n)(cos θ)(E∗

f + E∗
Re [n0 cos θ0]

b )(Ef − Eb)i

E = Ef (− sin θˆz + cos θˆx) + Eb(− sin θˆz − cos θˆx)
H ∝ nEf ˆy + nEb ˆy

S · ˆz =

1
2

Re[ˆz · (E∗ × H)] ∝ Re[(cos θ)∗(E∗

f − E∗

b )(Ef + Eb)n]

Again we normalize to incident power:

p-polarization:

S · ˆz =

Reh(n)(cos θ∗)(Ef + Eb)(E∗

b )i
f − E∗

Re [n0 cos θ∗
0]

(17)

(18)

(19)

(If I omitted parentheses somewhere, it’s because cos(θ∗) = (cos θ)∗.)

4.4 T (transmitted intensity) and R (reﬂected intensity)

To get the formula for T , the fraction of power transmitted, we simply take Eqs. (17),(19)
and apply it to the ﬁnal medium by plugging in Eb = 0 (no light is ﬂowing backwards
in the ﬁnal layer):

s-polarization:

p-polarization:

T = |t|2 Re [n cos θ]
Re [n0 cos θ0]
T = |t|2 Re [n cos θ∗]
Re [n0 cos θ∗
0]

(20)

(21)

where T is the fraction of power transmitted and t = Ef /E0 is the transmission am-
plitude.4

The formula for R is just what you expect:

R = |r|2

(22)

4.4.1 Counter-intuitive results when the initial medium is absorptive

When the initial medium is absorbing, these formulas give very strange results. Most
strikingly, you can get T > 1 in the absence of stimulated emission, and you can
get R + T > 1 or R + T < 1 for an interface between two semi-inﬁnite media. The
issue more speciﬁcally is that the power entering the ﬁrst layer of the stack (called
power_entering in the tmm software) is not necessarily equal to 1 − R, as one would

4In some references, the complex conjugation for p-polarization is omitted, but I’m very conﬁdent it’s
correct. Usually the incident and ﬁnal media are non-absorbing, e.g. air, so cos θ is real and it doesn’t matter
whether you conjugate θ or not.

8

expect (energy 1 moving forwards, minus energy R moving backwards). I explain and
discuss this in Appendix B.

Quick summary of Appendix B: The diﬀerence between power_entering and 1 −
R—which can only happen when the starting medium is absorptive—is related to an
excess or deﬁcit of absorption just before the ﬁrst interface, arising from interference
between the incoming and reﬂected waves. In other words, R and T are normalized to
incoming power far from the interface, extrapolated to the interface assuming exponen-
tial decay; but due to the interference, that extrapolation is inaccurate. So the actual
power at the interface may be higher or lower than the power-normalization factor.

4.5 Absorbed energy density

Next, absorbed energy density at a given depth. In principle this has units of [power]/[volume],
but we can express it as a multiple of incoming light power density on the material,
which has units [power]/[area], so that absorbed energy density has units of 1/[length].
This is the negative derivative (with respect to distance) of the S · ˆz expressions above.
Diﬀerentiating is straightforward, using Ef (z) ∝ eikzz and Eb(z) ∝ e−ikzz. (Reminder:
kz = 2πn cos θ/λvac.) The result is:

s-polarization:

a(z) =

|Ef + Eb|2 Im [n cos(θ)kz]

Re [n0 cos θ0]

p-polarization:

a(z) =

Im(cid:2)n cos(θ∗)(cid:0)kz|Ef − Eb|2 − k∗

Re [n0 cos θ∗
0]

z |Ef + Eb|2(cid:1)(cid:3)

(23)

Within a given layer, absorption is an analytical function:

a(z) = A1e2z Im(kz) + A2e−2z Im(kz) + A3e2iz Re(kz) + A∗

3e−2iz Re(kz)

where:

s-polarization : A1 =

A2 =

A3 =

p-polarization : A1 =

A2 =

A3 =

|w|2

Im [n cos(θ)kz]
Re [n0 cos θ0]
Im [n cos(θ)kz]
Re [n0 cos θ0]
Im [n cos(θ)kz]
Re [n0 cos θ0]
2 Im [kz] Re [n cos(θ∗)]

|v|2

vw∗

Re [n0 cos θ∗
0]

2 Im [kz] Re [n cos(θ∗)]

Re [n0 cos θ∗
0]

2 Re [kz] Im [n cos(θ∗)]

Re [n0 cos θ∗
0]

|w|2

|v|2

vw∗

where v = Ef (0) and w = Eb(0). (For the purpose of this section, z = 0 is the start
of the layer in question. n0 and θ0 refer as usual to the incident semi-inﬁnite medium;
remember, we are calculating absorption per unit incident power.)

9

5 Branch cuts

Snell’s law gives θi = arcsin(n0 sin(θ0)/ni). However, the arcsine function is ambiguous–
it has branch cuts in the complex plane. How do we get the right θ?

There are actually only two non-equivalent choices. If θ is one solution, then π −θ is
the other. You may recognize that we are choosing which of the two waves in medium
i is called “forward-traveling” and which one is called “backward-traveling”. How do
we make the right choice?

Good news: In the intermediate, ﬁnite-thickness layers, the choice actually doesn’t
matter. We solve for both the forward- and backward-traveling waves, so it doesn’t
matter which wave has which name. The two choices of θi will switch vi with wi, but
won’t aﬀect observable quantities like reﬂectance, absorption, etc.

Bad news: The choice of θ versus π − θ does matter very much in the starting
semi-inﬁnite layer (where the “forward-traveling” wave amplitude is set to 1), and in
the ﬁnal semi-inﬁnite layer (where the “backwards-traveling” wave amplitude is set to
0). In these layers, we need to choose θ correctly.

I’ve only checked the case I care about, Re n > 0 and Im n ≥ 0. In that case, the
naive calculation (using the default behavior of arcsine) gives the correct answer for all
cases, in both Python5 and Mathematica. I think I checked this pretty carefully, see
Appendix D for details.

In more specialized cases, like negative-index materials (Re n < 0) or stimulated-
emission (active) media ((Im n)/(Re n) < 0), results are not guaranteed! If your start-
ing or ending layer is one of these, please check this before using the tmm software—or
for that matter, any other software. See also Appendix C for additional warnings about
active media.

6 Thick “incoherent” ﬁlms

6.1

Introduction

That ﬁnishes the discussion of thin-ﬁlm interference. Next, thick ﬁlms. Here we are
interested in hybrid structures containing both thick and thin layers (or even just thick
layers). Light loses its coherence when traveling through the thick layers—i.e., the
Fabry–P´erot fringes are so close together that they cannot be resolved by the experi-
mental measurement, due to factors such as random thickness variations, propagation
angle variations, and/or wavelength variations. Instead of seeing the fringes, you just
see the average.

I reiterate that an incoherent analysis is never strictly necessary.

If incoherence
comes from having a variety of wavelengths / angles / thicknesses, the obvious way to
proceed is to do many coherent simulations across a variety of wavelengths / angles
/ thicknesses and then average the results. However, the incoherent analysis is a
convenient shortcut when appropriate.

5Note: For python, you need to use the arcsine function in SciPy, not the one in NumPy, so that when
you calculate the arcsine of a real number greater than 1, e.g. total internal reﬂection, you get a complex
angle instead of nan. Or, you can use NumPy arcsine if you cast its argument to complex.

10

In the tmm software approach, there are two types of layers: Coherent layers
(treated as in the sections above), and incoherent layers. Generally, a layer should
be treated as incoherent only if it is much much larger than the light wavelength, and
if you have strong reason to believe that Fabry–P´erot fringes within that layer are
getting averaged out.

As soon as light enters an incoherent layer, its phase information is thrown out, and
only its intensity is remembered. This approach does not allow partial coherence, it’s
all or nothing! If that’s not good enough, you can always fall back on the universally-
valid method of running coherent simulations and averaging the results, as mentioned
above.6

6.2 Calculation method

Layer 5
 = Stack 1

Layers 2 & 3
     = Stack 0

Layer 5 = Incoherent layer 3

V3=T

W3=0

Layer 4 = Incoherent layer 2

Layer 1 = Incoherent layer 1

Layer 0 = Incoherent layer 0

V2

W2

V1

1

W1

R

Figure 3 – Variable deﬁnitions related to the incoherent calculation program. A “stack”
is one or more consecutive coherent layers. Note the three numbering systems: Each layer
has a layer index, each incoherent layer has an incoherent layer index, and each stack has
a stack index. Vi, Wi are power ﬂows (note the capital letters, not to be confused with the
amplitudes vi, wi in Fig. 1).

We have a number of incoherent layers 0,1,...,N − 1. Let Vi be the forward propaga-
tion intensity and Wi be the backwards intensity at the beginning of the ith incoherent
layer. (Capital letters to distinguish from v, w, the amplitudes in the coherent algo-
rithm, see previous section.) Let Xi and Yi be forward and backwards at the end of
the ith incoherent layer. (Xi and Yi are not explicitly calculated in the tmm software.)
Let Ti,j be transmissivity from the ith to jth incoherent layer (where j = i ± 1, and
Ri,j the reﬂectivity. Then:

Yi = XiRi,i+1 + Wi+1Ti+1,i

Vi+1 = XiTi,i+1 + Wi+1Ri+1,i

Yi(cid:19) =
(cid:18)Xi

1

Ti,i+1 (cid:18) 1

Ri,i+1 Ti+1,iTi,i+1 − Ri+1,iRi,i+1(cid:19)(cid:18) Vi+1

Wi+1(cid:19) .

−Ri+1,i

(24)

Let Pi be the fraction of light that passes successfully through layer i (in a single pass)
without getting absorbed, calculated by

Pi = e−αdi, α =

4π Im[ni cos θi]

λvac

(25)

6There are more sophisticated methods for dealing with incoherence than the simple one used here; see

Refs. [1, 2] for example.

11

where di is the layer thickness. Then:

(cid:18) Vi
Wi(cid:19) = (cid:18)1/Pi

0

0

Pi(cid:19)(cid:18)Xi
Yi(cid:19)

Deﬁne the matrices Ln by

Ln =

1

Ti,i+1 (cid:18)1/Pi

0

0

Pi(cid:19)(cid:18) 1

Ri,i+1 Ti+1,iTi,i+1 − Ri+1,iRi,i+1(cid:19)

−Ri+1,i

(26)

(27)

for n = 1, . . . , N − 1. Now we want the matrix relating the intensities entering the
structure to the intensities exiting, i.e.:

(cid:18) 1
R(cid:19) = ˜L(cid:18)T

0(cid:19) .

Then the formula for ˜L is
T0,1 (cid:18) 1

˜L =

1

R0,1 T1,0T0,1 − R1,0R0,1(cid:19) L1L2 · · · LN −1 = (cid:18) ˜L00
˜L10

−R1,0

T = 1/ ˜L00, R = ˜L10/ ˜L00

(28)

(29)

˜L01
˜L11(cid:19)

6.3 Absorption proﬁle, Coherence length

Absorption as a function of depth for incoherent layers is not implemented in the tmm
software; this section explains why.

Calculating the absorption proﬁle within an “incoherent” layer is not simple to
do correctly. If you look up close, the absorption as a function of position would be
oscillatory near an interface due to interference between the incoming and outgoing
beams; with the oscillations gradually dying down into a smooth exponential farther
away from the interface. The “coherence length” describes how far from the interface
you need to go before the oscillations die down. For example, if the incoherence is
caused by using a not-quite-monochromatic light source, the coherence length would
be related to the bandwidth of the light.

If you are only interested in calculating the total amount of light absorbed in each
layer, it turns out that you do not need to know the coherence length!! More precisely,
the coherence length does not aﬀect the total absorption in (and transmission through)
an incoherent layer under two assumptions (which are usually satisﬁed): (1) The co-
herence length is large compared to a wavelength; (2) The coherence length is small
compared to the layer thickness.

This is an example of the more general mathematical fact that when you have
sinusoidal oscillations that gradually die away, their integral is independent of the
−ik ; the
integral is approximately independent of α as long as α ≪ k, i.e. as long as the decay
length is much larger than the oscillation length.

precise decay properties. Here is an example: R ∞

0 eikxe−αxdx =

−ik+α ≈ 1

1

That’s the reason that you are not prompted to input coherence lengths in any of

the calculations above.

12

On the other hand, if you want to calculate absorption as a function of depth in an

incoherent layer, you do need to know exactly what the coherence length is.

It is generally hard to know a coherence length quantitatively. Therefore absorption
as a function of depth is not implemented for incoherent layers in the tmm software. If
you want to see absorption as a function of depth for an incoherent layer, you need to
use the coherent program and average over slightly varying wavelengths / thicknesses
/ angles (as appropriate).

7 Acknowledgments

I thank Francis Loignon-Houle, John Honig, and especially Mikhail Kats for helpful
feedback.

References

[1] B. Harbecke. Coherent and incoherent reﬂection and transmission of multilayer

structures. Applied Physics B, 39(3):165–170, 1986.

[2] Charalambos C. Katsidis and Dimitrios I. Siapkas. General transfer-matrix method
for optical multilayer systems with coherent, partially coherent, and incoherent
interference. Applied Optics, 41(19):3978, 2002.

[3] Bertil Nistad and Johannes Skaar. Causality and electromagnetic properties of

active media. Physical Review E, 78(3):036603, 2008.

[4] Yi-Fan Chen, Peer Fischer, and Frank W. Wise. Negative refraction at optical fre-
quencies in nonmagnetic two-component molecular media. Physical Review Letters,
95(6):067402, 2005.

13

A Appendix: Sign convention for reﬂection am-
plitude

A common point of confusion for students is the sign convention for reﬂection amplitude
in the Fresnel equations. For p polarization in particular, half of textbooks use one
sign convention, the other half use the opposite one.7 The confusion more speciﬁcally
is that it does not seem like it should be a convention (i.e., arbitrary choice) at all!
After all, light interferes with its reﬂection. So the relative phase between light and its
reﬂection does not seem like it should be arbitrary; it should have a right and wrong
answer.

At normal incidence, we can understand the source of the ambiguity as follows.
When light in air reﬂects oﬀ glass at normal incidence, the electric ﬁeld switches sign
(changes phase by π), while the magnetic ﬁeld keeps the same sign (changes phase
by 0). Related to this, there are two ways to deﬁne the relative phase of oppositely-
propagating light beams, the one based on whether the magnetic ﬁeld is in phase or
not (“Convention A”), and the one based on whether the electric ﬁeld is in phase or
not (“Convention B”). These two conventions line up with the two possible signs of
rp. In Convention A, rp > 0 for light in air reﬂecting oﬀ glass at normal incidence; in
Convention B, rp < 0 in the same situation.

At normal incidence, there is a compelling reason to prefer Convention B: This is the
convention based on whether or not the electric ﬁeld of the incident and reﬂected light
are in phase. The electric ﬁeld is generally more important for light-matter interaction
than the magnetic ﬁeld. Relatedly, this gives rs = rp at normal incidence, which neatly
agrees with the fact that s and p are equivalent at normal incidence. (Everyone uses
the same sign convention for rs.)

However, at glancing angle, there is an equally compelling reason to prefer Conven-
tion A! At glancing angle, light and its reﬂection are traveling in the same direction, so
there is a unique and natural way to say whether the waves are in or out of phase at the
interface. For example, if r = −1 at glancing angle, then that intuitively suggests that
the reﬂected light is equal and opposite the incident light, so we expect destructive in-
terference at the interface (both zero electric ﬁeld and zero magnetic ﬁeld). Convention
A agrees with that expectation.

Again, there is no right or wrong convention, but we still have to pick one. So in

this document we use Convention A.

B Appendix: R and T with an absorptive start-
ing medium

In this section, we discuss in more detail how we are deﬁning R and T , and why this
can lead to unexpected results like T > 1 when the starting medium is absorptive.

7For example, the following textbooks use “Convention A” (as deﬁned shortly): Jackson (Eq. (7.41)),
Hecht (Eq. (4.38)), Zangwill (Eq. (17.34)); whereas the following textbooks use “Convention B”: Feynman
Lectures on Physics (Eq. 33.8), Griﬃths (3rd edition, Eq. (9.109)), Lipson-Lipson-Lipson (Eq (5.42)).

14

As shown in Fig. 4, I deﬁne R and T by the following operation:
• Assume that the light starts out a large distance L behind the ﬁrst interface, with

power P1 ﬂowing towards the interface.

• The light travels the distance L, bounces oﬀ, then travels the same big distance

L back through the initial medium, at which point it now has power P2...

• R is deﬁned by R = e2αLP2/P1, in the limit L → ∞. (The exponential factor
here cancels out the absorption in the initial medium, so that this limit exists.)
(We don’t really need L → ∞; all that really matters is that L is big enough
that it is beyond the area where the incoming and outgoing beams have coherent
interference.)

• Similarly, let P3 be the ﬂowing away from the last interface (immediately after

the interface)...

• T is deﬁned as T = eαLP3/P1, in the limit L → ∞.

+z

z=0

t

e

d

g

min

o
c
In

|E(z)|~e+ |z|/2
P(z) ~ e+ |z|

|E(z)|~r e– |z|/2
P(z) ~ R e– |z|

Figure 4 – How the reﬂected intensity R is deﬁned. Electric ﬁeld E and power transported
P are shown.

(Are these good ways to deﬁne R and T ? Well, it depends on what you’re trying
to do. For example, if you are putting an antireﬂective coating on tinted glass, these
are great deﬁnitions. They make it very easy to calculate the overall reﬂection and
transmission. My incoherent tmm calculation is based on situations like that. So, I
like these deﬁnitions, although I admit that they are not the only possible deﬁnitions.)
We obviously expect R = |r|2 here (as usual), and that’s correct with this deﬁnition.
The interesting thing—which had me confused at ﬁrst—is that the normalized
Poynting vector passing through the ﬁrst interface is not necessarily equal to (1 − R),
as one would expect (energy 1 moving forwards minus energy R moving backwards).
Likewise, it is possible to have R + T 6= 1 for an interface between two semi-inﬁnite
media. This strange situation only comes up when the starting semi-inﬁnite medium
is absorbing. Why does this happen?

15

To get the exact formulas for Poynting vector at the initial interface, called power_entering

in the program, we just plug into the normal Poynting vector formula with Ef = 1 and
Eb = r, to get:

s-polarization:

power entering =

Re [n0 cos θ0(1 + r∗)(1 − r)]

Re [n0 cos θ0]

= (1 − R) + 2 Im[r]

Im[n0 cos θ0]
Re[n0 cos θ0]

power entering =

= (1 − R) − 2 Im[r]

Re [n0 cos θ∗

p-polarization:
0(1 + r)(1 − r∗)]

Re [n0 cos θ∗
0]

Im[n0 cos θ∗
0]
Re[n0 cos θ∗
0]

The ﬁrst term is what we expect, the second term is strange. We naively expect

the Poynting vector for z < 0 in Fig. 4 to satisfy

S(z) · ˆz = eα|z| − Re−α|z|

[formula for without wave interference]

(30)

where the ﬁrst term comes from the incoming wave and the second term from the
reﬂected wave.
It is ﬁne to demand this when the beams do not overlap, but we
CANNOT use this expression in the “Interference here” triangle region of Fig. 4.
Instead, there is interference between the forward- and backward-moving waves, which
causes oscillations in the absorption proﬁle (“hot-spots” and “nodes”) (see Fig. 2), so
there are corresponding oscillations in the Poynting vector (it’s a bit hard to see them
in Fig. 2 but they’re there). A bit of extra energy is ﬂowing from the nodes to the
nearby hot-spots. Thanks to these oscillations, the Poynting vector right at the edge
before the start of the structure may not be 1 − R.

If r is real, then there is a node or hot-spot of absorption right at the interface. It
turns out that this sort of corresponds to having an integer number of oscillatory cycles,
so the oscillations do not aﬀect the power passing through the interface. R + T = 1 is
still valid. But if r is complex, then you have an extra bit of absorption, or deﬁcit of
absorption, compared to the non-oscillating baseline expectation of Eq. (30).

Instead of R + T = 1, the formula is:

R + T ± (extra bit or deﬁcit of absorption from how the oscillations cut oﬀ) = 1

Again, this comes from the fact that R is deﬁned by Eq. (30), which is not valid when
there is interference.

To verify that R = |r|2 is the correct expression to use, we use the Poynting vector
formula, plugged in at an arbitrary depth z < 0, using Ef = exp(2πinz cos θ/λvac) and
Eb = r exp(−2πinz cos θ/λvac). I’ll just do the s-polarized case:

S(z) · ˆz =

Re[n0 cos θ0(E∗

f + E∗
Re[n0 cos θ0]

b )(Ef − Eb)]

= (cid:16)e−4πz Im[n0 cos θ0]/λvac − |r|2e+4πz Im[n0 cos θ0]/λvac)(cid:17) +

+(cid:18) 2

Im[n0 cos θ0]
Re[n0 cos θ0]

Im[re4πiz Re[n0 cos θ0]/λvac](cid:19)

16

The ﬁrst term corresponds exactly to Eq. (30) with R = |r|2, and the second term is a
sinusoidal oscillation corresponding to interference. When the beams stop overlapping
(i.e., below the triangle in Fig. 4), the oscillation term goes away but the other term
remains.

In the program, I use the variable “power_entering” to describe the net power
entering the structure, i.e.
the Poynting vector at the front of the ﬁrst layer. For
an interface between two semi-inﬁnite media with light coming from just one side,
power_entering is always equal to T . When the incident semi-inﬁnite medium has
real refractive index, power_entering is always equal to 1 − R.

B.1 Accounting for this eﬀect in the incoherent calcula-
tion

One of the things I want to compute in the incoherent calculation is how much light
gets absorbed in each layer. Part of that absorption is the “extra” absorption due to
the oscillation cut-oﬀ at the interface.

At the interface between two incoherent layers, say 0 and 1, let’s say the power
ﬂows on the two sides are Pf,0, Pf,1, Pb,0, Pb,1, where f and b stand forward-moving and
backward-moving. The important thing to remember is that the net power actually
crossing the interface is exactly Pf,0T01 − Pb,1T10. Why? Because the transmitted light
beams have no funny corrections due to oscillations; they have nothing to coherently
interfere with them.

Therefore, the “extra” absorption near the interface, not accounted for in the ex-

ponential decay of the waves, is exactly equal to

(Pf 0 − Pb0) − (Pf 0T01 − Pb1T10) = Pf 0(1 − R01 − T01)

extra near-interface absorption on the 0 side, and likewise

extra near-interface absorption on the 1 side.

Pb1(1 − R10 − T10)

C Appendix: Stimulated emission

With stimulated-emission (a.k.a. “gain” or “active”) media, there is a possibility for
confusion. It turns out that Maxwell’s equations always have a unique ﬁnite steady-
state solution, and the algorithm described herein will always ﬁnd this solution. But
this solution may be unphysical! There is, after all, another possibility: The system
may be unstable, with ﬁelds exponentially growing (until the gain saturates). So you
can ﬁnd various papers exploring surprising aspects of Fresnel reﬂection and refrac-
tion with gain—but where the results are all nonsense, because they are exploring
unphysical solutions. A very helpful paper in this area is Ref. [3].

The same paper also explains why knowing n at one wavelength is not enough infor-
mation to do a multilayer fresnel analysis when the initial or ﬁnal layer has stimulated

17

emission: The whole wavelength-vs-n dispersion is required to ﬁgure out which choice
of arcsine to use (cf. Section 5).

If a medium has gain at λ1 but loss at λ2, it can require you to use the unexpected
choice of arcsine even at λ2! An example along those lines is constructed in Ref. [4],
where a certain dielectric function at a certain wavelength has negative refraction,
even though it has (at that wavelength) neither negative permittivity nor negative
permeability nor gain.

D Appendix: Branch cuts

Snell’s law gives θi = arcsin(n0 sin(θ0)/ni). However, the arcsine function is ambiguous–
it has branch cuts. How to get the right θ?? Remember here, ni may be an arbitrary
complex number, ideally the program will work even for unusual cases like negative-
index materials (Re n < 0) or stimulated-emission media (Im n < 0).

Actually, we never care about θ itself, just sin θ and cos θ. The sine has no ambi-

guity:

sin θi =

n0 sin θ0

ni

The cosine is more problematic, because there are two choices consistent with Snell’s
law:

cos θi = ±

i − (n0 sin θ0)2

1

niqn2

Do we want the + or −?? In other words, we can pick between two angles θ and π − θ.
See Section 5 for an explanation of what the choice really means, and more impor-
tantly, why it only matters in the starting and ending semi-inﬁnite layers, but doesn’t
matter in the intermediate, ﬁnite-thickness layers.

D.1 Case that Im n > 0, Re n > 0

For an absorbing material (Im n > 0), a clear requirement is that Im(n cos θ) > 0.
That way, Im kz > 0, so the Ef wave in the medium decays rather than amplifying.
Another clear requirement is that R > 1 or T < 0 cannot occur. This translates to
Re[n cos θ] ≥ 0 for s-polarization and Re[n cos θ∗] ≥ 0 for p-polarization. This amounts
to the same thing as saying that the Poynting vector associated with an Ef wave should
point forward not backwards.

Important question: Are these two “clear requirements” consistent with each other.

Yes!

Theorem: If we choose the θ with Im(n cos θ) > 0, then it will also be true that

Re[n cos θ] > 0.

Proof: As above,

ni cos θi = ±qn2

i − (n0 sin θ0)2

Given that Im ni > 0 and Re ni > 0, it follows that Im n2
(the wave intensity is assumed to be uniform in the lateral direction), (n2

i > 0. Since n0 sin θ0 is real
i −(n0 sin θ0)2)

18

also has a positive imaginary part. Therefore, its square root is in the ﬁrst or third
quadrant of the complex plane. That ﬁnishes the proof.

Theorem: If we choose the θ with Im(n cos θ) > 0, then it will also be true that

Re[n cos θ∗] > 0.

Proof:

Re[ni cos θ∗

i ] = Re[n∗

i cos θi] = ±

n∗
i

niqn2

i − (n0 sin θ0)2

Let φ with 0 < φ < π/2 be the complex phase of ni. We have

arg

n∗
i
ni

= −2φ

Using the fact that (n0 sin θ0)2 is a nonnegative real number,

arg n2

i = 2φ,

2φ ≤ arg(n2

i − (n0 sin θ0)2) < π

If we choose the square-root with positive imaginary part,

φ ≤ argqn2

i − (n0 sin θ0)2 < π/2

Therefore,

−π/2 < −φ ≤ arg(cid:20) n∗

i

niqn2

i − (n0 sin θ0)2(cid:21) < −2φ + π/2 < π/2

That ﬁnishes the proof.

D.2

Implementation for Im n > 0, Re n > 0

If we use the naive

do we get the θi which satisﬁes

θi = arcsin(n0 sin θ0/ni)

Im(ni cos θi) > 0

in all cases? The answer is “Yes”, using the default arcsine branch-cut behavior of
Python and Mathematica (which are the same). At least, I randomly generated a few
million examples and it always worked in both Python and Mathematica, even when
n0 sin θ0 < 0.

D.3 Case that Im n = 0, Re n > 0

As before,

cos θi = ±

1

niqn2

i − (n0 sin θ0)2

There are three cases: Total internal reﬂection where n0 sin θ0 > ni and cos θi is pure
imaginary; the ordinary case where n0 sin θ0 < ni and cos θi is pure real, and the
boundary case where n0 sin θ0 = ni and cos θi = 0. The third one has no ambiguity
because cos θi = − cos θi. Let’s look at the other two cases.

19

D.3.1 Case Im n = 0, Re n > 0, Total internal reﬂection

Here, Re[ni cos θi] = 0 and Re[n∗
i ] = 0, so no need to worry about the sign of
the Poynting vector or R > 1 or T < 0. The only requirement is that the wave decay
rather than amplify, i.e.

i cos θ∗

Im(ni cos θi) > 0

D.3.2 Case Im n = 0, Re n > 0, Total internal reﬂection implementa-
tion

If we use the naive

do we get the θi which satisﬁes

θi = arcsin(n0 sin θ0/ni)

Im(ni cos θi) > 0

in all cases? The answer is “Yes”, using the default arcsine branch-cut behavior of
Python and Mathematica (which are the same). At least, I randomly generated a few
million examples and it always worked in both Python and Mathematica, even when
n0 sin θ0 < 0.

D.3.3 Case Im n = 0, Re n > 0, Normal refraction

Here, Im(ni cos θi) = 0, so we get no information from whether the wave is decaying or
amplifying. The only criterion is Re[ni cos θi] > 0 and Re[n∗
i ] > 0 (meaning the
Poynting vector points forward, R < 1, T > 0). In this case it simpliﬁes to ni cos θi > 0.

i cos θ∗

D.3.4 Case Im n = 0, Re n > 0, Normal refraction implementation

If we use the naive

do we get the θi which satisﬁes

θi = arcsin(n0 sin θ0/ni)

ni cos θi > 0

in all cases? The answer is “Yes”: In both Python and Mathematica, arcsine for real
arguments between −1 and 1 returns an angle between −π/2 and π/2, i.e. an angle
with positive cosine.

D.4 Case that Im n < 0, Re n < 0

This is not stimulated emission, despite Im n < 0. It is absorption. [Remember, with
Re n < 0, the direction the wave is “really moving” (the direction of the Poynting
vector) is opposite the direction of the wavevector. When Im n < 0, the wave is
amplifying in the direction of the wavevector, so it’s “really” decaying.]

Therefore the required criteria are the same as for ordinary absorbing media with
Im n > 0 and Re n > 0: Im(n cos θ) > 0 (the Ef wave decays rather than ampliﬁes),

20

Re[n cos θ] ≥ 0 for s-polarization and Re[n cos θ∗] ≥ 0 for p-polarization (the Ef wave
carries energy forwards and R < 1 and T > 0.)

If we ﬂip the sign of ni, we do not aﬀect qn2

i − (n0 sin θ0)2, so we do not aﬀect
cos θi (up to a possible sign-ﬂip) nor do we aﬀect (ni cos θi) (up to a possible sign-
ﬂip). Therefore the proof is exactly the same as before that the two requirements are
consistent with each other.

I have not, however, checked whether implementations of arcsine choose the correct

value here.

D.5 Everything else

As mentioned above, active media cannot be analyzed in this way, because knowing n
at one wavelength is not enough information to determine which solution is which—see
Ref. [3].

There are other cases too, like n = 0, which I have not looked into.

21

