CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Scale New Heights!

the place where the ﬁrst author started his PhD under the supervision of the second author)

(Motto of International (now Jacobs) University Bremen,

Abstract. Let K be a number ﬁeld and let C/K be a curve of genus 2 with Jacobian
variety J. In this paper, we study the canonical height ˆh : J(K) → R. More speciﬁ-
cally, we consider the following two problems, which are important in applications:
(1) for a given P ∈ J(K), compute ˆh(P ) eﬃciently;
(2) for a given bound B > 0, ﬁnd all P ∈ J(K) with ˆh(P ) ≤ B.
We develop an algorithm running in polynomial time (and fast in practice) to deal
with the ﬁrst problem. Regarding the second problem, we show how one can tweak
the naive height h that is usually used to obtain signiﬁcantly improved bounds for the
diﬀerence h − ˆh, which allows a much faster enumeration of the desired set of points.
Our approach is to use the standard decomposition of h(P ) − ˆh(P ) as a sum of
local ‘height correction functions’. We study these functions carefully, which leads
to eﬃcient ways of computing them and to essentially optimal bounds. To get our
polynomial-time algorithm, we have to avoid the factorization step needed to ﬁnd the
ﬁnite set of places where the correction might be nonzero. The main innovation at
this point is to replace factorization into primes by factorization into coprimes.

Most of our results are valid for more general ﬁelds with a set of absolute values
satisfying the product formula.

6
1
0
2

 
r
a

M
2

 

 
 
]
T
N
h
t
a
m

.

[
 
 

1
v
0
4
6
0
0

.

3
0
6
1
:
v
i
X
r
a

Date: March 1, 2016.

1

2

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Contents

1.

Introduction

Acknowledgments
Part I: Generalities on Heights and Genus Two Jacobians

2. Generalized naive heights

3. Local height correction functions for genus 2 Jacobians

4. Canonical local heights on Kummer coordinates

5. Stably minimal Weierstrass models

Igusa invariants

6.
Part II: Study of Local Height Correction Functions

7. The ‘kernel’ of µ

8. N´eron functions and reduction graphs

9. Formulas and bounds for µ(P ) in the nodal reduction case

10. Formulas and bounds for µ(P ) in the cuspidal reduction case
11. General upper and lower bounds for ¯β
Part III: Eﬃcient Computation of Canonical Heights

12. Computing µ at non-archimedean places

13. Computing µ at archimedean places

14. Computing the canonical height of rational points

15. Examples
Part IV: Eﬃcient Search for Points With Bounded Canonical Height

16. Bounding the height diﬀerence at archimedean places

16.1. Bounding ˜ε closely

16.2.

Iterating Stoll’s bound

17. Optimizing the naive height

18. Eﬃcient enumeration of points of bounded canonical height

19. Example

References

3

6

7

7

9

15

17

19

21

21

25

29

34

41

44

44

47

49

53

56

56

56

57

58

60

61

64

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

3

1. Introduction

Let K be a global ﬁeld and let C/K be a curve of genus 2 with Jacobian variety J.
There is a map κ : J → P3 that corresponds to the class of twice the theta divisor on J;
it identiﬁes a point on J with its negative, and its image is the Kummer surface KS
of J. Explicit versions of κ can be found in the book [CF96] by Cassels and Flynn for C
given in the form y2 = f (x) and in the paper [M¨ul10] by the ﬁrst author for general C
(also in characteristic 2). Thus κ gives rise to a height function h : J(K) → R, which
we call the naive height on J. It is deﬁned by

h(P ) =

log max{|κ1(P )|v,|κ2(P )|v,|κ3(P )|v,|κ4(P )|v} ,

(cid:88)

v∈MK

(cid:89)

v∈MK

where MK is the set of places of K, κ(P ) = (κ1(P ) : κ2(P ) : κ3(P ) : κ4(P )), and |·|v is
the v-adic absolute value, normalized so that the product formula

|x|v = 1

for all x ∈ K×

holds.

By general theory [HS00, Chapter B] the limit

ˆh(P ) = lim
n→∞

h(nP )

n2

it is called the canonical height (or N´eron-Tate height) of P ∈ J(K). The
exists;
diﬀerence h − ˆh is bounded. The canonical height induces a positive deﬁnite quadratic
form on J(K)/J(K)tors (and on the R-vector space J(K) ⊗Z R).
In this paper, we tackle the following two problems:

Problem 1.1. Find an eﬃcient algorithm for the computation of ˆh(P ) for a given point
P ∈ J(K).
Problem 1.2. Find an eﬃcient algorithm for the enumeration of all P ∈ J(K) which
satisfy ˆh(P ) ≤ B, where B is a given real number.

These problems are important because such algorithms are needed if we want to satu-
rate a given ﬁnite-index subgroup of J(K) (see the discussion at the end of Section 18).
This, in turn, is required for the computation of generators of J(K). Such generators are
required, for instance, to carry out the method described in [BMS+08] for the compu-
tation of all integral points on a hyperelliptic curve over Q. Furthermore, the regulator
of J(K) appearing in the conjecture of Birch and Swinnerton-Dyer is the Gram deter-
minant of a set of generators of J(K)/J(K)tors with respect to the canonical height. So
Problem 1.1 and Problem 1.2 are also important in the context of gathering numerical
evidence for this conjecture as in [FLS+01].
It is a classical fact, going back to work by N´eron [N´er65], that ˆh(P ) and the diﬀerence
h(P )−ˆh(P ) can be decomposed into a ﬁnite sum of local terms. In our situation, this can
be done explicitly as follows. The duplication map P (cid:55)→ 2P on J induces a morphism
δ : KS → KS, given by homogeneous polynomials (δ1, δ2, δ3, δ4) of degree 4; explicit
equations can again be found in [CF96] and [M¨ul10]. For a point Q ∈ J(Kv), where Kv
is the completion of K at a place v ∈ MK, such that κ(Q) = (x1 : x2 : x3 : x4) ∈ KS(Kv),
we set

˜εv(Q) = − log max{|δj(x1, x2, x3, x4)|v : 1 ≤ j ≤ 4} + 4 log max{|xj|v : 1 ≤ j ≤ 4} .

∞(cid:88)

n=0

ˆh(P ) = h(P ) − (cid:88)
∞(cid:88)

v∈MK

˜µv(Q) =

4−(n+1) ˜εv(2nP )

We set, for Q ∈ J(Kv) as above,

(1.1)

and we deduce the decomposition

(1.2)

h(P ) − ˆh(P ) =

n=0

4−(n+1) ˜εv(2nQ) ,

(cid:88)

v∈MK

˜µv(P ) ,

4

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Note that this does not depend on the scaling of the coordinates. We can then write
ˆh(P ) in the following form (compare Lemma 2.4):

which is valid for all points P ∈ J(K). In addition, ˜εv = ˜µv = 0 for all but ﬁnitely
many v (the exceptions are among the places of bad reduction, the places where the given
equation of C is not integral and the archimedean places). The maps ˜εv : J(Kv) → R
are continuous maps (with respect to the v-adic topology) with compact domains, so
they are bounded. Therefore ˜µv is also bounded.

(which is easy) and (cid:80)
approach is that we need integer factorization to compute the sum ˜µf(P ) :=(cid:80)

Let us ﬁrst discuss Problem 1.1. Because of equation (1.2), it suﬃces to compute h(P )
˜µv(P ) in order to compute ˆh(P ) for a point P ∈ J(K).
Building on earlier work of Flynn and Smart [FS97], the second author introduced an
algorithm for the computation of ˜µv(P ) in [Sto02]. One of the main problems with this
v ˜µv(P ),
where v runs through the ﬁnite primes v such that ˜µv(P ) (cid:54)= 0, because we need to ﬁnd
these primes, or at least a ﬁnite set of primes containing them.

v∈MK

We use an idea which was already exploited in [MS15] to ﬁnd a polynomial-time algo-
rithm for the computation of the canonical height of a point on an elliptic curves (in
fact we ﬁrst used this technique in genus 2 and only later realized that it also works,
and is actually easier, for elliptic curves). When v is non-archimedean, then there is a
constant cv > 0 such that the function

µv := ˜µv/cv

maps J(Kv) to Q. In fact ˜µf(P ) is a sum of rational multiples of logarithms of positive
integers. As in [MS15], we ﬁnd a bound on the denominator of µv that depends only on
the valuation of the discriminant; this allows us to devise an algorithm that computes
˜µf(P ) in quasi-linear time. We can compute ˜µv(P ) for archimedean v essentially from
the deﬁnition of ˜µv. This leads to a factorization-free algorithm that computes ˆh(P ) in
polynomial time. More precisely:
Theorem 1.3. Let J be the Jacobian of a curve of genus 2 deﬁned over Q, and let
P ∈ J(Q). There is an algorithm that computes ˆh(P ) in time quasi-linear in the size of
the coordinates of P and the coeﬃcients of the given equation of C, and quasi-quadratic
in the desired number of digits of precision.

See Theorem 14.5 for a precise statement. We expect a similar result to be true for any
number ﬁeld K in place of Q.
We now move on to Problem 1.2. If we have an upper bound β for h− ˆh, then the set of
all points P ∈ J(K) such that h(P ) ≤ B + β contains the set {P ∈ J(K) : ˆh(P ) ≤ B}.
Since the naive height h is a logarithmic height, β contributes exponentially to the size

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

5

of the box we need to search for the enumeration. Therefore it is crucial to keep β as
small as possible.
We write ˜βv = max{˜µv(Q) : Q ∈ J(Kv)}, and we obtain the bound

h(P ) − ˆh(P ) ≤ (cid:88)

˜βv

v∈MK

from (1.2). If we write ˜γv = max{˜εv(Q) : Q ∈ J(Kv)}, then clearly ˜γv/4 ≤ ˜βv ≤ ˜γv/3.
In [Sto99], it is shown that for curves given in the form y2 = f (x), where f has v-adically
integral coeﬃcients, we have

˜γv ≤ − log |24 disc(f )|v = − log |2−4∆|v ,

with disc(f ) denoting the discriminant of f considered as a polynomial of degree 6 and
∆ denoting the discriminant of the given equation of C. When v is non-archimedean
and the normalized additive valuation of ∆ is 1, then we can take ˜γv = ˜βv = 0 [Sto02].
The results of the present paper improve on this; they are based on a careful study of the
functions ˜µv. It turns out that when v is non-archimedean, the set of points where µv
(or equivalently, ˜µv) vanishes forms a group. Moreover, the function µv factors through
the component group of the N´eron model of J when the given model of C/Kv, which
we assume to have v-integral coeﬃcients in the following, has rational singularities; see
Theorem 7.5. If the minimal regular model of C is semistable, then we can use results
of Zhang and Heinz to give explicit formulas for µv in terms of the resistance function
on the reduction graph of C (which is essentially the dual graph of the special ﬁber
of the minimal regular model, suitably metrized). We use this to ﬁnd simple explicit
formulas for µv that apply in the most frequent cases of bad reduction, namely nodal or
cuspidal reduction. These explicit formulas give us the optimal bounds for ˜µv in these
cases. By reducing to the semistable case and tracking how µv changes as we change
the Weierstrass equation of C, we deduce the general upper bound

(1.3)

˜βv ≤ − 1
4
for non-archimedean v; see Theorem 11.3.

log |∆|v

When v is archimedean, we also get a new bound for ˜µv by iterating the bound obtained
by the second author in [Sto99], leading to vast improvements for ˜βv. Combining the
archimedean and non-archimedean bounds, we ﬁnd a nearly optimal bound β for h− ˆh.
To get even smaller search spaces for the enumeration, we make use of the observation
that we can replace the naive height h by any function h(cid:48) such that |h(cid:48) − h| is bounded.
Using the results on nearly optimal bounds for µv and such a modiﬁed naive height h(cid:48)
(which is also better suited than h for the enumeration process itself) we get a much
smaller bound on the diﬀerence h(cid:48) − ˆh than what was previously possible. This makes
the enumeration feasible in many cases that were completely out of reach so far.

As an example, we compute explicit generators for the Mordell-Weil group of the Jaco-
bian of the curve

(1.4)

C : y2 = 82342800x6 − 470135160x5 + 52485681x4

+ 2396040466x3 + 567207969x2 − 985905640x + 247747600

over Q, conditional on the Generalized Riemann Hypothesis (which is needed to show
that the rank is 22). See Proposition 19.1. This curve has at least 642 rational points,
which is the current record for the largest number of known rational points on a curve
of genus 2, see [Stob].

6

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

The paper is divided into four parts. In Part I, we ﬁrst generalize the usual notion of the
naive height on projective space and clarify the relation between these generalized naive
heights and suitable canonical heights, all in Section 2. We then introduce local height
correction functions ε and µ (= µv in the notation introduced above) on the Jacobian
of a genus 2 curve over a non-archimedean local ﬁeld in Section 3. This is followed in
Section 4 by a study of certain canonical local heights constructed in terms of µ. We
close Part I by introducing and investigating the notion of stably minimal Weierstrass
models of curves of genus 2 in Section 5 and recalling some well-known results on Igusa
invariants in Section 6.

Part II is in some sense the central part of the present paper. Here we study the
local height correction function µ over a non-archimedean local ﬁeld. Using Picard
functors, we show in Section 7 that µ factors through the component group of the N´eron
model of the Jacobian when the given model of the curve has rational singularities.
We then relate µ to the reduction graph of C in Section 8. Building on this, the
following sections contain simple explicit formulas for µ when the reduction of the curve
is nodal (Section 9), respectively cuspidal (Section 10). A simple argument then gives
the improved general upper bound (1.3) for µ, see Section 11.
In Part III we describe our factorization-free algorithm for the computation of ˆh(P ) for
P ∈ J(K), where K is a global ﬁeld. We start in Section 12 by showing how to compute
µv(P ) for non-archimedean v, using a bound on its denominator. The following section
deals with archimedean places, before we ﬁnally combine these results in Section 14 into
an algorithm for the computation of ˆh(P ) that runs in polynomial time; this proves
Theorem 1.3. Some examples are discussed in Section 15.

In the ﬁnal Part IV we turn to Problem 1.2. Section 16 contains two methods for
bounding ˜µv for archimedean v.
In the following Section 17 we describe a modiﬁed
naive height h(cid:48) such that the bound on the diﬀerence h(cid:48) − ˆh becomes small. We use this,
the results of Section 16, and our nearly optimal bounds for the non-archimedean height
correction functions from Part II to give an eﬃcient algorithm for the enumeration of
the set of rational points with bounded canonical height in Section 18.
In the ﬁnal
Section 19 we compute generators of the Mordell-Weil group of the record curve (1.4).

Acknowledgments. We would like to thank David Holmes for suggesting the proof of
Lemma 7.1.

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

7

Part I: Generalities on Heights and Genus Two Jacobians

2. Generalized naive heights

Let K be a ﬁeld with a set MK of places v and associated absolute values |·|v satisfying
the product formula

(cid:89)

|x|v = 1

for all x ∈ K× .

v∈MK
We write Kv for the completion of K at v. For a tuple x = (x1, . . . , xm) ∈ Km
(cid:107)x(cid:107)v = max{|x1|v, . . . ,|xm|v}.
In the following we will introduce some ﬂexibility into our notion of height on projective
spaces. (This is similar to the framework of ‘admissible families’ in [Zar95].)

v we set

Deﬁnition 2.1.
(1) Let v ∈ MK. A local height function on Pm at v is a map hv : Km+1

v

\{0} → R such

that
(i) hv(λx) = log |λ|v + hv(x) for all x ∈ Km+1

v

(ii) (cid:12)(cid:12)hv(x) − log (cid:107)x(cid:107)v

(cid:12)(cid:12) is bounded.
h(cid:0)(x1 : x2 : . . . : xm+1)(cid:1) =

(cid:88)

v∈MK

(2) A height on Pm over K is a function h : Pm(K) → R such that

hv(x1, x2, . . . , xm+1)

\ {0} and all λ ∈ K×

v , and

with local height functions hv; we require that hv(x) = log (cid:107)x(cid:107)v for all but ﬁnitely
many places v.

Note that property (i) of local height functions together with the product formula imply
that h is invariant under scaling of the coordinates and hence is well-deﬁned.

One example of such a height is the standard height hstd, which we obtain by setting
hv(x) = log (cid:107)x(cid:107)v for all v. We then have the following simple fact.
Lemma 2.2. Let h be any height on Pm over K and let hstd be the standard height.
Then there is a constant c = c(h) such that
|h(P ) − hstd(P )| ≤ c

for all P ∈ Pm(K).

Proof. This follows from property (ii) of local height functions.

(cid:3)

Example 2.3. Other examples of heights can be obtained in the following way. For
each place v, ﬁx a linear form lv(x1, . . . , xm+1) = av,1x1 + . . . + av,m+1xm+1 with
av,1, . . . , av,m+1 ∈ Kv and av,m+1 (cid:54)= 0, such that lv(x) = xm+1 for all but ﬁnitely
many v. Then

log max{|x1|v, . . . ,|xm|v,|lv(x1, . . . , xm+1)|v}

h(cid:0)(x1 : . . . : xm : xm+1)(cid:1) =

(cid:88)

v∈MK

is a height on Pm.
More generally, we could consider a family of automorphisms Av of Km+1
to the identity for all but ﬁnitely many v, and take

v

with Av equal

(cid:88)

v∈MK

h(x) =

log max(cid:107)Av(x)(cid:107)v .

8

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Now consider a variety V ⊂ Pm and an endomorphism ϕ : V → V of degree d (i.e., given
by homogeneous polynomials of degree d). Then by general theory (see, e.g., [HS00,
Thm. B.2.5]) |hstd(ϕ(P )) − dhstd(P )| is bounded on V (K). We write ϕ◦n for the n-fold
iteration of ϕ. Then the canonical height
ˆh(P ) = lim

n→∞ d−nhstd(ϕ◦n(P ))

exists (and satisﬁes ˆh(ϕ(P )) = dˆh(P )) [HS00, Thm. B.4.1]. Let h be any height on Pm.
Since |h − hstd| is bounded, we can replace hstd by h in the deﬁnition of ˆh without
changing the result. We can then play the usual telescoping series trick in our more
general setting.

Lemma 2.4. Let ϕ(cid:0)(x1 : . . . : xm+1)(cid:1) = (cid:0)ϕ1(x) : . . . : ϕm+1(x)(cid:1) with homogeneous

polynomials ϕj ∈ K[x1, . . . , xm+1] of degree d. We have

ˆh(P ) = h(P ) − (cid:88)

˜µv(P ) ,

v∈MK

where

∞(cid:88)

n=0

˜µv(P ) =

and, when P = (x1 : . . . : xm+1) and x = (x1, . . . , xm+1),

˜εv(P ) = dhv(x) − hv

d−(n+1) ˜εv(ϕ◦n(P ))

(cid:0)ϕ1(x), . . . , ϕm+1(x)(cid:1) .

Proof. Note that ˜εv is well-deﬁned: scaling x by λ adds |λ|v to hv(x) and d|λ|v to
hv(ϕ1(x), . . . , ϕm+1(x)). Let x be projective coordinates for P and write x(n) for the
result of applying (ϕ1, . . . , ϕm+1) n times to x = x(0). Then

ˆh(P ) = lim

n→∞ d−nh(ϕ◦n(P ))
d−(n+1)(cid:0)h(ϕ◦(n+1)(P )) − dh(ϕ◦n(P ))(cid:1)
d−(n+1) (cid:88)
(cid:0)hv(x(n+1)) − dhv(x(n))(cid:1)
∞(cid:88)

v∈MK

n=0

d−(n+1) ˜εv(ϕ◦n(P ))

n=0

= h(P ) +

∞(cid:88)
∞(cid:88)
= h(P ) − (cid:88)
= h(P ) − (cid:88)

= h(P ) +

v∈MK

v∈MK

n=0

˜µv(P ) .

(cid:3)

We call the functions ˜µv : Pm(Kv) → R local height correction functions.
Note that when Kv is a discretely valued ﬁeld such that |x|v = exp(−cvv(x)) for x ∈ K×
with a constant cv > 0 (and where we abuse notation and write v : K×
(cid:16) Z also for the
normalized additive valuation associated to the place v) and h = hstd, then we have

v

˜µv(P ) = cvµv(P )

and

˜εv(P ) = cvεv(P ) ,

where

and

µv(P ) =

d−(n+1)εv(P )

εv(P ) = min(cid:8)v(ϕ1(x)), . . . , v(ϕm+1(x))(cid:9) − d min{v(x1), . . . , v(xm+1)} ,

n=0

∞(cid:88)

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

9

if x = (x1, . . . , xm+1) are homogeneous coordinates for P . This is the situation that we
will study in some detail in Part II of this paper, for the special case when V ⊂ P3 is
the Kummer surface associated to a curve of genus 2 and its Jacobian J and ϕ is the
duplication map (then d = 4).

modify the standard height in such a way that the sum (cid:80)

To deal with Problem 1.1, we work with the standard height hstd. We use our detailed
results on the local height correction functions to deduce a bound on the denominator
of µv (its values are rational) in terms of the valuation of the discriminant of the curve.
This is the key ingredient that leads to our new factorization-free and fast algorithm for
computing ˆh, see Part III.
To deal with Problem 1.2, we use the ﬂexibility in choosing the (naive) height h and
sup ˜µv(J(Kv)) that
bounds the diﬀerence h− ˆh is as small as we can make it. The local height functions we
use are as in Example 2.3 above, with lv(x1, x2, x3, x4) = x4/sv for certain sv ∈ K×
v in
most cases. This choice has the property that for any P = (x1 : x2 : x3 : x4) ∈ P3(K)
diﬀerent from (0 : 0 : 0 : 1) we have
0 ≤ hstd

v∈MK

(cid:0)(x1 : x2 : x3)(cid:1) ≤ h(P ) .
(cid:0)(x1 : x2 : x3)(cid:1) ≤ B, see Part IV.

This is relevant, since we can fairly easily enumerate all points P as above that are on
the Kummer surface and satisfy hstd

3. Local height correction functions for genus 2 Jacobians

Until further notice, we let k be a non-archimedean local ﬁeld with additive valuation v,
normalized to be surjective onto Z. Let O denote the valuation ring of k with residue
class ﬁeld k and let π be a uniformizing element of O. We consider a smooth projective
curve C of genus 2 over k, given by a Weierstrass equation

(3.1)
in weighted projective space Pk(1, 3, 1), with weights 1, 3 and 1 assigned to the variables
X, Y and Z, respectively. Here

Y 2 + H(X, Z)Y = F (X, Z)

F (X, Z) = f0Z6 + f1XZ5 + f2X 2Z4 + f3X 3Z3 + f4X 4Z2 + f5X 5Z + f6X 6

and

H(X, Z) = h0Z3 + h1XZ2 + h2X 2Z + h3X 3

are binary forms of degrees 6 and 3, respectively, such that the discriminant ∆(F, H)
of the Weierstrass equation (3.1) is nonzero.
In characteristic diﬀerent from 2, this
discriminant is deﬁned as

∆(F, H) = 2−12 disc(4F + H 2) ∈ Z[h0, . . . , h3, f0, . . . , f6] ,

and in general, we deﬁne it by the generic polynomial given by this formula. The curve
deﬁned by the equation is smooth if and only if ∆(F, H) (cid:54)= 0.
For the remainder of this section we assume that F, H ∈ O[X, Z], so that equation (3.1)
deﬁnes an integral Weierstrass model C of the curve in the terminology of Section 5
below. The discriminant of this model is then deﬁned to be ∆(C) := ∆(F, H). We
may assume that C is given by such an integral equation if k is the completion at a
non-archimedean place of a number ﬁeld K and C is obtained by base change from K,
since we can choose a globally integral Weierstrass equation for the curve. But also in
general, we can always assume that C is given by an integral equation after applying
a transformation deﬁned over k, since we know from Corollary 4.6 in the next section
how the local height correction function µ deﬁned in Deﬁnition 3.1 below behaves under
such transformations.

10

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

We now generalize the deﬁnition of ε given in [Sto02] to our more general setting ([Sto02]
works with Weierstrass equations that have H = 0). As in the introduction, let J denote
the Jacobian of C and let KS be its Kummer surface, constructed explicitly together
with an explicit embedding into P3 in [CF96] in the case H = 0 and in [M¨ul10] in the
general case. Also let κ : J → P3 denote the composition of the quotient map from J
to KS with this embedding; it maps the origin O ∈ J(k) to the point (0 : 0 : 0 : 1).
A quadruple x = (x1, x2, x3, x4) ∈ k4 is called a set of Kummer coordinates on KS if
x is a set of projective coordinates for a point in KS(k); we denote the set of sets of
Kummer coordinates on KS by KSA (this is the set of k-rational points on the pointed
aﬃne cone over KS). For x ∈ KSA we write v(x) = min{v(x1), . . . , v(x4)}, and we say
that x is normalized if v(x) = 0. If P ∈ J(k), we say that x ∈ KSA is a set of Kummer
coordinates for P if κ(P ) = (x1 : x2 : x3 : x4).
We let δ denote the duplication map on KS, which is given by homogeneous polynomials
δ1, . . . , δ4 ∈ O[x1, . . . , x4] of degree 4 such that δ(0, 0, 0, 1) = (0, 0, 0, 1). We recall that
there is a symmetric matrix B = (Bij)1≤i,j≤4, where the Bij ∈ O[x1, . . . , x4, y1, . . . , y4]
are bi-homogeneous of degree 2 in x1, . . . , x4 and y1, . . . , y4 each and have the following
properties, see [CF96, Chapter 3] and [M¨ul10].
(i) Let x, y ∈ KSA be Kummer coordinates for P, Q ∈ J(k). Then there are Kummer

coordinates w, z ∈ KSA for P + Q and P − Q, respectively, such that

and hence v(w) + v(z) = v(cid:0)B(x, y)(cid:1); here nij = 1 if i (cid:54)= j and nij = 0 if i = j.

w ∗ z := (wizj + nijwjzi)1≤i,j≤4 = B(x, y)

(ii) If x ∈ KSA, then B(x, x) = δ(x) ∗ (0, 0, 0, 1).
We specialize the notions introduced in Section 2 to our situation: we consider the
Kummer surface KS ⊂ P3 with the duplication map δ of degree d = 4. We use the
standard local height on P3.
Deﬁnition 3.1. Let x ∈ KSA be a set of Kummer coordinates on KS. Then we set

ε(x) = v(δ(x)) − 4v(x) ∈ Z

and

µ(x) =

1

4n+1 ε(δ◦n(x)) ,

∞(cid:88)

n=0

where δ◦n denotes the n-fold composition δ ◦ . . . ◦ δ.
Because δ is given by homogeneous polynomials of degree 4, ε(x) does not depend on
the scaling of x, so it makes sense to deﬁne ε(P ) = ε(x) for points P ∈ KS(k), where
x ∈ KSA is any set of Kummer coordinates for P , and to deﬁne ε(P ) = ε(κ(P )) for
points P ∈ J(k). We likewise extend the deﬁnition of µ. Then we have

µ(2P ) − 4µ(P ) = −ε(P )

for all P ∈ J(k).

Note that our assumption F, H ∈ O[X, Z] implies that ε ≥ 0. If k is a local ﬁeld (as we
assume here), then KS(k) is compact in the v-adic topology, and ε is continuous, so ε is
bounded.

Remark 3.2. More generally, if k is a ﬁeld with a discrete valuation and not of charac-
teristic 2, then the arguments in [Sto99] show that when H = 0, ε ≤ v(24 disc(F )), so ε
is bounded also for these more general ﬁelds.

If k is any ﬁeld with a discrete valuation, then one can still conclude that ε is bounded,
by making use of the fact that the duplication map is well-deﬁned on KS, which implies
that the ideal generated by the δj and the polynomial δ0 deﬁning KS contains a power of
the irrelevant ideal. So for some N > 0, one can express every xN
j as a linear combination
of δ0(x), . . . , δ4(x) with coeﬃcients that are homogeneous polynomials of degree N − 4

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

11

with coeﬃcients in k. The negative of the minimum of the valuations of these coeﬃcients
then gives a bound for ε.
Remark 3.3. If k is the completion of a global ﬁeld at a place v, then for α ∈ k×,
v(α)/ log (cid:107)α(cid:107)v = −cv is a negative constant. So for P ∈ J(k) we have ε(P ) = cv ˜εv(P )
and µ(P ) = cv ˜µv(P ), where ˜εv and ˜µv are as deﬁned in the introduction.
We will also have occasion to use the following function. Let x, y ∈ KSA and deﬁne
(3.2)

ε(x, y) = v(B(x, y)) − 2v(x) − 2v(y).

In the same way as for ε(x) above, we can extend this to points in KS(k) and J(k).
Lemma 3.4. Let x, y, w, z ∈ KSA be Kummer coordinates satisfying w ∗ z = B(x, y).
Then we have

δ(w) ∗ δ(z) = B(δ(x), δ(y)) .

Proof. The proof carries over verbatim from the proof of [Sto02, Lemma 3.2].

(cid:3)

We deduce the following:
Lemma 3.5. Let x, y, w, z ∈ KSA be Kummer coordinates satisfying w ∗ z = B(x, y).
Then we have

ε(cid:0)δ(x), δ(y)(cid:1) + 2ε(x) + 2ε(y) = ε(w) + ε(z) + 4ε(x, y) .

Proof. Using Lemma 3.4, relation (3.2), and property (i) above for δ(w), δ(z), δ(x)
and δ(y), we obtain

v(cid:0)δ(w)(cid:1) + v(cid:0)δ(z)(cid:1) = v(cid:0)B(δ(x), δ(y))(cid:1) = ε(cid:0)δ(x), δ(y)(cid:1) + 2v(cid:0)δ(x)(cid:1) + 2v(cid:0)δ(y)(cid:1) .

Subtracting four times the corresponding relation for w, z, x and y, we get

ε(w) + ε(z) = ε(cid:0)δ(x), δ(y)(cid:1) − 4ε(x, y) + 2ε(x) + 2ε(y) ,

(cid:3)

which is the claim.

We state a few general facts on the functions ε and µ.
Lemma 3.6. For points P, Q ∈ J(k), we have the relation

µ(P + Q) + µ(P − Q) − 2µ(P ) − 2µ(Q) = −ε(P, Q) .

Proof. Let x and y be Kummer coordinates for P and Q, respectively; then w and z as
in Lemma 3.5 are Kummer coordinates for P + Q and P − Q (in some order). The claim
now follows from the formula in Lemma 3.5:
µ(P + Q) + µ(P − Q) − 2µ(P ) − 2µ(Q)

=

=

n=0

∞(cid:88)
∞(cid:88)
∞(cid:88)

n=0

4−n−1(cid:0)ε(2nP + 2nQ) + ε(2nP − 2nQ) − 2ε(2nP ) − 2ε(2nQ)(cid:1)
4−n−1(cid:0)ε(δ◦n(w)) + ε(δ◦n(z)) − 2ε(δ◦n(x)) − 2ε(δ◦n(y))(cid:1)
4−n−1(cid:0)ε(δ◦(n+1)(x), δ◦(n+1)(y)) − 4ε(δ◦n(x), δ◦n(y))(cid:1)

=
= −ε(x, y) = −ε(P, Q) .

n=0

(cid:3)
Lemma 3.7. If P ∈ J(k) satisﬁes µ(P ) = 0, then µ(P + Q) = µ(Q) for all Q ∈ J(k).

12

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Proof. We take (P, Q) ← (Q + nP, P ) in Lemma 3.6, where n ∈ Z. Taking into account
that µ(P ) = 0 and writing an for µ(Q + nP ), this gives

an+1 − 2an + an−1 = −ε(P, Q + nP ) .

As k is a non-archimedean local ﬁeld, the multiples of P accumulate at the origin
O ∈ J(k). Recall that ε is locally constant. This implies that every value ε(P, Q + nP )
occurs for inﬁnitely many n ∈ Z, since Q + (n + N )P will be close to Q + nP for suitably
chosen N . We have for any m > 0
am+1 − am − a−m + a−m−1 =

(an+1 − 2an + an−1) = − m(cid:88)

ε(P, Q + nP ) .

m(cid:88)

n=−m

n=−m

Since µ is bounded, the left hand side is bounded independently of m. We also know
that ε(P, Q + nP ) ≥ 0. But if ε(P, Q + nP ) were nonzero for some n, then by the
discussion above, the right hand side would be unbounded as m → ∞. Therefore it
follows that ε(P, Q + nP ) = 0 for all n ∈ Z. This in turn implies an+1 − 2an + an−1 = 0
for all n ∈ Z. The only bounded solutions of this recurrence are constant sequences. In
particular, we have
(cid:3)
Proposition 3.8. The subset U = {P ∈ J(k) : µ(P ) = 0} is a subgroup of ﬁnite index
in J(k). The functions P (cid:55)→ ε(P ) and P (cid:55)→ µ(P ) factor through the quotient J(k)/U .
Proof. Lemma 3.7 shows that U is a subgroup. We have ε(P ) = 0 for P ∈ J(k)
suﬃciently close to the origin. So taking a suﬃciently small subgroup neighborhood U(cid:48)
of the origin in J(k), we see that ε(2nP ) = 0 for all P ∈ U(cid:48) and all n ≥ 0. This
implies that µ = 0 on U(cid:48), so U ⊃ U(cid:48). Because k is a local ﬁeld, U(cid:48) and therefore also U
have ﬁnite index in J(k). By Lemma 3.7 again, µ factors through J(k)/U , and since
ε(P ) = 4µ(P ) − µ(2P ), the same is true for ε.
(cid:3)

µ(P + Q) = a1 = a0 = µ(Q) .

We will now show that we actually have

U = {P ∈ J(k) : ε(P ) = 0}

(the inclusion ‘⊂’ is clear from the deﬁnition and Proposition 3.8.) This is equivalent to
the implication ε(x) = 0 =⇒ ε(δ(x)) = 0 and generalizes [Sto02, Thm. 4.1]. For this we
ﬁrst provide a characteristic 2 analogue of [Sto02, Prop. 3.1(1)].

We temporarily let k denote an arbitrary ﬁeld. Let CF,H be a (not necessarily smooth)
curve in the weighted projective plane with respective weights 1, 3, 1 assigned to the
variables X, Y, Z that is given by an equation

Y 2 + H(X, Z)Y = F (X, Z),

(3.3)
where F, H ∈ k[X, Z] are binary forms of respective degrees 6 and 3. Let KSF,H denote
the subscheme of P3 given by the vanishing of the equation deﬁning the Kummer surface
of CF,H if CF,H is nonsingular. Then the construction of δ = (δ1, δ2, δ3, δ4) still makes
sense in this context, but we may now have δi(x) = 0 for all 1 ≤ i ≤ 4 (which we
abbreviate by δ(x) = 0) for a set x of Kummer coordinates on KSF,H . We generalize
Proposition 3.1 in [Sto02] (which assumes H = 0) to the case considered here.

Note that two equations (3.3) for CF,H are related by a transformation τ acting on an
aﬃne point (ξ, η) by

(cid:18) aξ + b

cξ + d

,

eη + U (ξ, 1)

(cξ + d)3

(cid:19)

,

(3.4)

τ (ξ, η) =

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

13

F
0
0

0
0

type

conditions

aXZ5
aXZ5
bX 3Z3

a (cid:54)= 0
a (cid:54)= 0
b (cid:54)= 0
ab (cid:54)= 0

1
2
3
4
5
6
7
8 XZ(X + Z)
9 XZ(X + Z)
10 XZ(X + Z) aXZ5 + bX 3Z3 a(a + b)(a + b + 1) (cid:54)= 0
11
12
13

b(b + 1) (cid:54)= 0

XZ2

aXZ5 + bX 3Z3

aXZ5 + bX 3Z3

bX 3Z3

XZ5
X 3Z3

ab (cid:54)= 0

H
0
Z3
Z3
XZ2
XZ2
Z3
XZ2

0
0

where A =(cid:0) a b

c d

Table 1. Representatives in characteristic 2

(cid:1) ∈ GL2(k), e ∈ k× and U ∈ k[X, Z] is homogeneous of degree 3. The
τ∗F (X, Z) = (ad − bc)−6(cid:0)e2F A + (eH A − U A) U A(cid:1)
τ∗H(X, Z) = (ad − bc)−3(cid:0)eH A − 2U A(cid:1) ,

transformation τ also acts on the forms F and H by

where we write

SA = S(dX − bZ,−cX + aZ)

for a binary form S ∈ k[X, Z].
Lemma 3.9. Let x ∈ KSF,H (k). If δ(δ(x)) = 0, then we already have δ(x) = 0.

Proof. If k has characteristic diﬀerent from 2, we can apply a transformation so that the
new Weierstrass equation will have H = 0; the statement is then [Sto02, Prop. 3.1(1)].
So from now on, k has characteristic 2. We may assume without loss of generality that
k is algebraically closed. If the given curve is smooth, then the result is obvious, because
the situation described in the statement can never occur. If it is not smooth, we can
act on F and H using transformations of the form (3.4), so it is enough to consider only
one representative of each orbit under such transformations. This is analogous to the
strategy in the proof of [Sto02, Prop. 3.1]. We can, for example, pick the representatives
listed in Table 1.

For these representatives, elementary methods as in the proof of [Sto02, Prop. 3.1] can
(cid:3)
be used to check that δ(x) = 0 indeed follows from δ(δ(x)) = 0.

We can use the above to analyze the group U .

Theorem 3.10. Suppose that k is a non-archimedean local ﬁeld and that J is the Ja-
cobian of a smooth projective curve of genus 2, given by a Weierstrass equation (3.1)
with integral coeﬃcients. Then the set {P ∈ J(k) : ε(P ) = 0} equals the subgroup U in
Proposition 3.8. In particular, U is a subgroup of ﬁnite index in J(k) and ε and µ factor
through the quotient J(k)/U . Moreover we have that ε(−P ) = ε(P ) and U contains the
kernel of reduction J(k)1 with respect to the given model of J, i.e., the subgroup of points
whose image in KS(k) equals that of O.

14

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Proof. The statement in Lemma 3.9 implies ε(P ) = 0 =⇒ ε(2P ) = 0 for points P ∈ J(k),
since ε(P ) = 0 is equivalent to δ(˜x) (cid:54)= 0 if x are normalized Kummer coordinates for P ,
with reduction ˜x. This shows that ε(P ) = 0 implies µ(P ) = 0 (and conversely), so
{P ∈ J(k) : ε(P ) = 0} = {P ∈ J(k) : µ(P ) = 0} = U . The remaining statements
now are immediate from Proposition 3.8, taking into account that for P in the kernel of
(cid:3)
reduction, we trivially have ε(P ) = 0.

An algorithm for the computation of µ(P ) which is based on Theorem 3.10 (for H = 0) is
given in [Sto02, §6]. Using the relation in Lemma 3.6, we obtain the following alternative
procedure for computing µ(P ).

1. Let x be normalized Kummer coordinates for P .

2. For n = 1, 2, . . ., do the following.

Set y0 = (0, 0, 0, 1) and y1 = x.
a. Using pseudo-addition (see [FS97, §4]), compute normalized Kummer coordinates
yn+1 for nP from x, yn−1 and yn; record ε(P, nP ), which is the shift in valuation
occurring when normalizing yn+1.
to nP ∈ U ). If yes, let N = n and exit the loop.

b. If ε(P, nP ) = 0, check whether v(δ(yn)) = 0 (by Theorem 3.10, this is equivalent

3. Return

µ(P ) =

N−1(cid:88)

1
2N

ε(P, nP ) .

To see that this works, note that by Lemma 3.6 we have

µ(cid:0)(n + 1)P(cid:1) − 2µ(nP ) + µ(cid:0)(n − 1)P(cid:1) = 2µ(P ) − ε(P, nP ) .

n=1

The sequence(cid:0)µ(nP )(cid:1)

n∈Z is periodic with period N , where N is the smallest positive
integer n such that nP ∈ U (which exists according to Theorem 3.10). Taking the sum
over one period gives

2N µ(P ) =

ε(P, nP ) =

ε(P, nP ) .

From the periodicity we can also deduce the possible denominators of µ(P ). As ε has
integral values, we see that µ(P ) ∈ 1
n∈Z. In fact, we can
show a little bit more.
Corollary 3.11. Let P ∈ J(k) and N = min{n ∈ Z>0 : µ(nP ) = 0}. Then

2N

n=1

Z if N is a period of(cid:0)µ(nP )(cid:1)

N−1(cid:88)

n=0

N−1(cid:88)

µ(P ) ∈ 1
N
µ(P ) ∈ 1
2N

Z if N is odd, and

Z if N is even.

Proof. The sequence(cid:0)ε(P, nP )(cid:1)
N−1(cid:88)

actually have

µ(P ) =

n∈Z has period N and is symmetric. So if N is odd, we

1
2N

n=1

ε(P, nP ) =

1
N

ε(P, nP ) ∈ 1
N

Z .

(cid:3)

(N−1)/2(cid:88)

n=1

Analyzing the possible denominators of µ(P ) will play a key role in Section 12, where
we discuss another algorithm for the computation of µ(P ).

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

15

4. Canonical local heights on Kummer coordinates

We now deﬁne a notion of canonical local height for Kummer coordinates. We keep the
notation of the previous section.
Deﬁnition 4.1. Let x ∈ KSA be a set of Kummer coordinates on KS. The canonical
local height of x is given by

ˆλ(x) = −v(x) − µ(x) .

Remark 4.2. We can also deﬁne the canonical local height on an archimedean local ﬁeld
in an analogous way. Then, if K is a global ﬁeld and x is a set of Kummer coordinates
for a point J(K), we have

(cid:88)

v∈MK

ˆh(P ) =

1
cv

ˆλv(x) ,

where cv is the constant introduced in Remark 3.3 for a non-archimedean place v and
cv = [Kv : R]−1 if v is archimedean.

The canonical local height ˆλ on Kummer coordinates has somewhat nicer properties than
the canonical local height deﬁned (for instance in [FS97] or, more generally, in [HS00,
§B.9]) with respect to a divisor on J.
Proposition 4.3. Let x, y, z, w ∈ KSA. Then the following hold:

(i) ˆλ(δ(x)) = 4ˆλ(x).
(ii) If w ∗ z = B(x, y), then ˆλ(z) + ˆλ(w) = 2ˆλ(x) + 2ˆλ(y).

(iii) ˆλ(x) = − limn→∞ 4−nv(cid:0)δ◦n(x)(cid:1).

(iv) If k(cid:48)/k is a ﬁnite extension of ramiﬁcation index e and ˆλ(cid:48) is the canonical local

height over k(cid:48), then we have ˆλ(cid:48)(x) = e · ˆλ(x).

Proof.

(i) This follows easily from the two relations

v(cid:0)δ(x)(cid:1) = 4v(x) + ε(x)
and µ(cid:0)δ(x)(cid:1) = 4µ(x) − ε(x) .
ˆλ(x) = 4−nˆλ(cid:0)δ◦n(x)(cid:1) = −4−nv(cid:0)δ◦n(x)(cid:1) + O(4−n) .

(ii) This is similar, using Lemma 3.6 and ε(x, y) = v(w) + v(z) − 2v(x) − 2v(y).
(iii) This follows from (i) and the fact that µ(x) is a bounded function, implying

(iv) This is obvious from the deﬁnition of ˆλ.

(cid:3)

The canonical local height on Kummer coordinates also behaves well under isogenies.
Proposition 4.4. Let α : J → J(cid:48) be an isogeny of Jacobians of dimension 2 deﬁned
over k. Then α induces a map α : KS → KS(cid:48) between the corresponding Kummer
surfaces; let d denote its degree. We also get a well-deﬁned induced map α : KSA → KS(cid:48)
A
if we ﬁx a ∈ k× and require α(0, 0, 0, 1) = (0, 0, 0, a). Then we have

ˆλ(cid:0)α(x)(cid:1) = dˆλ(x) − v(a)

for all x ∈ KSA.

16

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

v(cid:0)δ◦n(α(x))(cid:1) = dv(δ◦n(x)) + O(1) .
v(cid:0)δ◦n(α(x))(cid:1) = v(cid:0)α(δ◦n(x))(cid:1) .

Proof. All assertions except for the last one are obvious. By the deﬁnition of ˆλ, we can
reduce to the case a = 1. Using part (iii) of Proposition 4.3 it is then enough to show
that
However, we have v(α(x)) − dv(x) = O(1) by assumption, so it suﬃces to show that
(4.1)
But since α : J −→ J(cid:48) is an isogeny, δ◦n(α(x)) and α(δ◦n(x)) represent the same point
on KS(cid:48), hence they are projectively equal. Because they also have the same degree, the
factor of proportionality is independent of x. It therefore suﬃces to check (4.1) for a
single x; we take x = (0, 0, 0, 1) ∈ KSA. Because we have δ(x) = x and, by assumption,
α(x) = x(cid:48), where x(cid:48) = (0, 0, 0, 1) ∈ KS(cid:48)
δ◦n(α(x)) = x(cid:48)

and α(δ◦n(x)) = x(cid:48) ,

A(k), we ﬁnd

thereby proving (4.1) and hence the proposition.

(cid:3)

Remark 4.5. Canonical local heights with similar functorial properties were constructed
by Zarhin [Zar95] on total spaces of line bundles (without the zero section). See
also [BG06] for an approach to canonical local heights using rigidiﬁed metrized line
bundles.

The preceding proposition is particularly useful for analyzing the behavior of the canon-
ical local height under a change of Weierstrass equation of the curve.

speciﬁed by a triple (A, e, U ), where A =(cid:0) a b

(cid:1) ∈ GL2(k), e ∈ k× and

Recall that two Weierstrass equations for C are related by a transformation τ as in (3.4),

U = u0Z3 + u1XZ2 + u2X 2Z + u3X 3 ∈ k[X, Z]

c d

is homogeneous of degree 3. Such a transformation induces a map on KSA as follows:
Let x = (x1, x2, x3, x4) ∈ KSA. Then τ (x) is given by the following quadruple:

(ad − bc)−1(cid:16)

d2x1 + cdx2 + c2x3,

2bdx1 + (ad + bc)x2 + 2acx3,
b2x1 + abx2 + a2x3,
(ad − bc)−2(e2x4 + l1x1 + l2x2 + l3x3)

(cid:17)

,

where l1, l2, l3 do not depend on x. More precisely, we can write

li = li,1 + li,2 + li,3 ,

where

li,1 =

li,2 =

li,3 =

e2

(ad − bc)4 l(cid:48)
(ad − bc)4 l(cid:48)
(ad − bc)4 l(cid:48)

e

1

i,1 with l(cid:48)
i,2 with l(cid:48)
i,3 with l(cid:48)

i,1 ∈ Z[f0, . . . , f6, a, b, c, d],
i,2 ∈ Z[h0, . . . , h3, u0, . . . , u3, a, b, c, d],
i,3 ∈ Z[u0, . . . , u3, a, b, c, d]

for i = 1, 2, 3. All of the l(cid:48)
in the other variables.
So we see that τ acts on k4 as a linear map whose determinant has valuation

i,j are homogeneous of degree 8 in a, b, c, d and homogeneous

v(τ ) = 2v(e) − 3v(ad − bc) .

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

17

In this situation, Proposition 4.4 implies:

Corollary 4.6. Let τ = ([a, b, c, d], e, U ) be a transformation (3.4) between two Weier-
strass equations C and C(cid:48) of a smooth projective curve C/k of genus 2 and let KS be the
model of the Kummer surface associated to C. Then we have

ˆλ(τ (x)) = ˆλ(x) − v(τ )

for all x ∈ KSA. In particular,

µ(x) = µ(τ (x)) + v(τ (x)) − v(x) − v(τ ) .

This can be used to construct a canonical local height which does not depend on the
choice of Weierstrass equation.

Deﬁnition 4.7. Let C/k be a smooth projective curve of genus 2 given by a Weierstrass
equation (3.1) with discriminant ∆ and let KS be the associated Kummer surface. We
call the function

˜λ : KSA −→ R ,

x (cid:55)−→ ˆλ(x) +

1
10

v(∆)

the normalized canonical local height on KSA.

Corollary 4.8. The normalized canonical local height is independent of the given Weier-
strass equation of C.

Proof. Let τ be a transformation (3.4) between two Weierstrass equations of C with
respective discriminants ∆ and ∆(cid:48). Then we have
(4.2)
see [Liu96, §2].

v(∆(cid:48)) = v(∆) + 10v(τ ) ,

(cid:3)

We will not need the normalized canonical local height in the remainder of this paper.

5. Stably minimal Weierstrass models

In this section, k continues to denote a non-archimedean local ﬁeld with valuation ring O
and residue ﬁeld k. We build on results established by Liu [Liu96] in the more general
context of hyperelliptic curves of arbitrary genus.

Recall that an equation of the form (3.1) deﬁning a curve C over k of genus 2 is an
integral Weierstrass model of C if the polynomials F and H have coeﬃcients in O.
(Note that this is slightly diﬀerent from the notion of an ‘integral equation’ as de-
ﬁned in [Liu96, D´eﬁnition 2], but the diﬀerence is irrelevant for our purposes, since any
minimal Weierstrass model is actually given by an integral equation, see [Liu96, Remar-
que 4].) It is a minimal Weierstrass model of C if it is integral and the valuation of its
discriminant is minimal among all integral Weierstrass models of C [Liu96, D´eﬁnition 3].
We introduce the following variant of this notion.

Deﬁnition 5.1. An integral Weierstrass model of a smooth projective curve C over k
of genus 2 is stably minimal if it is a minimal Weierstrass model for C over k(cid:48) for every
ﬁnite ﬁeld extension k(cid:48) of k.

Stably minimal Weierstrass models can be characterized in terms of the multiplicities of
the points on the special ﬁber. The deﬁnition below is equivalent to [Liu96, D´eﬁnition 9]
when the curve is reduced, see [Liu96, Remarque 8].

18

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Deﬁnition 5.2. Only for this deﬁnition let k be an arbitrary ﬁeld, and let CF,H be a
curve in Pk(1, 3, 1) given by an equation of the form (3.1) over k; we assume that CF,H
is reduced. The multiplicity m(P, CF,H ) of P ∈ CF,H (¯k) is deﬁned as follows:

• If P is a singular point of type An, then m(P, CF,H ) = n + 1.
• If P is ﬁxed by the involution ι(X : Y : Z) = (X : −Y − H(X, Z) : Z) and is
• Otherwise m(P, CF,H ) = 0.

nonsingular, then m(P, CF,H ) = 1.

An algorithm that computes the multiplicity was given by Liu [Liu96, §6.1]. Liu deﬁnes
further multiplicities λr(P ) [Liu96, D´eﬁnition 10] for points on the special ﬁber of an
integral Weierstrass model (and r ≥ 1) that allow to characterize when such a model is
minimal. We note here that λr(P ) gives the value of λ(P ) = λ1(P ) after making a ﬁeld
extension of ramiﬁcation index r. Also, Lemme 7(e) of [Liu96] states for r suﬃciently
large that λr(P ) = m(P ) if the special ﬁber is reduced and implies that λr(P ) ≥ r if
the special ﬁber is non-reduced. In the reduced case, we also have λ(P ) ≤ m(P ).
Setting λ = λ1, Corollaire 2 in [Liu96] states (for g = 2) that the model is minimal if
and only if λ(P ) ≤ 3 and λ(cid:48)(P ) ≤ 4 (and is the unique minimal Weierstrass model up
to O-isomorphism if and only if, in addition λ(cid:48)(P ) ≤ 3) for all k-points P on the special
ﬁber, where λ(cid:48)(P ) is a number satisfying λ(cid:48)(P ) ≤ 2(cid:100)λ(P )/2(cid:101), see [Liu96, Lemme 9(c)].
Lemma 5.3. An integral Weierstrass model of a smooth projective curve C over k of
genus 2 is stably minimal if and only if its special ﬁber is reduced and the multiplicity
of every geometric point on the special ﬁber is at most 3.

If the special ﬁber is reduced and all multiplicities are at most 2, then the model is
the unique minimal Weierstrass model of C over any ﬁnite extension k(cid:48) of k, up to
isomorphism over the valuation ring of k(cid:48).

Proof. First note that the multiplicity of a point is a geometric property; it does not
change when we replace k by a ﬁnite extension.
If the special ﬁber of an integral
Weierstrass model has the given properties, then it follows from Liu’s results mentioned
above that λ(P ) ≤ m(P ) ≤ 3 and therefore λ(cid:48)(P ) ≤ 4 for all points P on the special
ﬁber, even after replacing k by a ﬁnite extension. It follows that the model is stably
minimal.
If m(P ) ≤ 2 for all P , then λ(P ) ≤ 2 and λ(cid:48)(P ) ≤ 2, so by Liu’s results, the model is
the unique minimal Weierstrass model of C over k(cid:48).
Conversely, assume that the special ﬁber does not have the given properties. Then
either the special ﬁber is non-reduced, or else there is a point P on the special ﬁber
of multiplicity m(P ) ≥ 4. If the special ﬁber is non-reduced, then after replacing k by
a suﬃciently ramiﬁed extension k(cid:48), there is a point P on the special ﬁber such that
λ(P ) > 3 over k(cid:48) (ramiﬁcation index 4 is suﬃcient). If the special ﬁber is reduced and
there is a (geometric) point P on the special ﬁber with m(P ) > 3, then again after
replacing k by a suﬃciently large ﬁnite extension k(cid:48) (such that P is deﬁned over the
residue ﬁeld and the ramiﬁcation index is at least m(P )), we have λ(P ) = m(P ) > 3
over k(cid:48). Liu’s results then show that the model is not minimal over k(cid:48).
(cid:3)
Lemma 5.4. If C is a smooth projective curve over k of genus 2, then there is a ﬁnite
extension k(cid:48) of k such that
(i) the minimal proper regular model of C over the valuation ring of k(cid:48) has semistable
(ii) each minimal Weierstrass model of C over k(cid:48) is already stably minimal.

reduction, and

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

19

Proof. That there is a ﬁnite extension with the ﬁrst property is a special case of the
semistable reduction theorem [DM69]. After a further unramiﬁed extension, we can
assume that all components of the special ﬁber of the minimal proper regular model
(which all have multiplicity 1) are deﬁned over the residue ﬁeld and that at least one
component has a smooth point deﬁned over the residue ﬁeld. This implies by Hensel’s
Lemma that C(k(cid:48)) (cid:54)= ∅. It follows from [Liu96, Corollaire 5] that every minimal Weier-
strass model of C over k(cid:48) is dominated by the minimal proper regular model. Since the
latter has reduced special ﬁber, the same is true for each minimal Weierstrass model.
Now assume that there exists a stably minimal Weierstrass model of C over k(cid:48). Then
every minimal Weierstrass model of C over k(cid:48) must already be stably minimal, since
both models must have the same valuation of the discriminant, and the discriminant of
the stably minimal model remains minimal over any ﬁnite ﬁeld extension of k(cid:48). So it is
enough to show that a stably minimal model exists.

We now consider the various possibilities for the special ﬁber of the minimal proper
regular model. The possible conﬁgurations are shown in Figures 1, 2, 3 and 5 (on pages
If the reduction type is [Im1−m2−m3] in the notation of [NU73],
29, 30, 31 and 36).
then the Weierstrass model whose special ﬁber contains the component(s) that are not
(−2)-curves has the property that all points on the special ﬁber have multiplicity at
most 2; this is then the unique minimal Weierstrass model, and it is stably minimal
by Lemma 5.3. It remains to consider reduction type [Im1 − Im2 − l]. We see that the
Weierstrass models that correspond to components in the chain linking the two polygons
and also those coming from the component of one of the polygons that is connected to
the chain satisfy the conditions of Lemma 5.3 and are thus stably minimal. On the other
hand, Weierstrass models whose special ﬁber does not correspond to a component in
the chain or to one of its neighbors have a point in the special ﬁber whose multiplicity
(cid:3)
is at least 4 and so cannot be stably minimal.

6. Igusa invariants

In this section we describe how we can easily distinguish between diﬀerent types of
reduction using certain invariants of genus 2 curves introduced by Igusa in [Igu60]. The
results of this section are essentially due to Liu [Liu93]; see also [Mes91].

Let k be an arbitrary ﬁeld of characteristic not equal to 2 and consider the invariants
J2, J4, J6, J8, J10 deﬁned in [Igu60], commonly called Igusa invariants. Then J2i(F ) is
an invariant of degree 2i of binary sextics, and if

F (X, Z) = f0Z6 + f1XZ5 + f2X 2Z4 + f3X 3Z3 + f4X 4Z2 + f5X 5Z + f6X 6

is a binary sextic, then J2i(F ) ∈ Z[ 1
2 , f0, . . . , f6]. For example, J10(F ) = 2−12 disc(F ).
It is shown in [Igu60] that the invariants J2, J4, J6, J10 generate the even degree part of
the ring of invariants of binary sextics.
Now let F and H be the generic binary forms over Z of degrees 6 and 3, respectively,
with coeﬃcients f0, . . . , f6 and h0, . . . , h3 as before. It turns out that J2i
an element of Z[f0, . . . , f6, h0, . . . , h3].
Deﬁnition 6.1. Let k be an arbitrary ﬁeld and let H, F ∈ k[X, Z] be binary forms
of respective degrees 3 and 6 over k. Let CF,H be the curve given by the equation
Y 2 + H(X, Z)Y = F (X, Z) in the weighted projective plane Pk(1, 3, 1). For 1 ≤ i ≤ 5
we deﬁne the Igusa invariant J2i(CF,H ) of CF,H as

(cid:0)4F + H 2(cid:1) is

(cid:0)4F + H 2(cid:1) .

J2i(CF,H ) = J2i

20

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Following Liu [Liu93], we also deﬁne two additional invariants, namely

I4(CF,H ) = J2(CF,H )2 − 24J4(CF,H )

and

I12(CF,H ) = −8J4(CF,H )3 + 9J2(CF,H )J4(CF,H )J6(CF,H )

− 27J6(CF,H )2 − J2(CF,H )2J8(CF,H ) .

The following is a consequence of [Liu93, Thm. 1].

Proposition 6.2. Let k be a ﬁeld and let CF,H /k be the curve given by the equation

Y 2 + H(X, Z)Y = F (X, Z)

in Pk(1, 3, 1), where H, F ∈ k[X, Z] are binary forms of degree 3 and 6, respectively.
For 1 ≤ i ≤ 5 and j ∈ {4, 12} we set J2i = J2i(CF,H ) and Ij = Ij(CF,H ).
(i) CF,H is smooth ⇐⇒ J10 (cid:54)= 0.
(ii) CF,H has a unique node and no point of higher multiplicity

⇐⇒ J10 = 0 and I12 (cid:54)= 0.
(iii) CF,H has exactly two nodes
⇐⇒ J10 = I12 = 0, I4 (cid:54)= 0, and J4 (cid:54)= 0 or J6 (cid:54)= 0.
(iv) CF,H has three nodes ⇐⇒ J10 = I12 = J4 = J6 = 0 and I4 (cid:54)= 0.
(v) CF,H has a cusp ⇐⇒ J10 = I12 = I4 = 0 and J2i (cid:54)= 0 for some i ≤ 4.
(vi) CF,H is non-reduced or has a point of multiplicity at least 4 ⇐⇒ J2i = 0 for all i.
When C is a curve of genus 2 over a non-archimedean local ﬁeld, then Igusa invariants
can also be used to obtain information on the reduction type of C, see [Liu93, Thm. 1,
Prop. 2].

Proposition 6.3. Let k be a non-archimedean local ﬁeld with normalized additive val-
uation v : k× (cid:16) Z and valuation ring O, and let C/k be a smooth projective genus 2
curve, given by a minimal Weierstrass model with reduced special ﬁber. Suppose that
the minimal regular model Cmin of C over SpecO is semistable and has reduction type
K in the notation of [NU73]. We set J2i = J2i(C) for i ∈ {1, . . . , 5} and I4 = I4(C),
I12 = I12(C).
(i) If K = [Im−0−0], where m > 0, then m = v(J10).
(ii) If K = [Im1−m2−0], where 0 < m1 ≤ m2, then

and m2 = v(J10) − m1 .

l = 1

m1 = min(cid:8)v(I12) − 3v(I4) , 1

4 v(I4) ,

m2 = v(J10) − 3v(I4) − m1 .

2 (v(J10) − 3v(I4))(cid:9)

and

(iii) If K = [Im1−m2−m3], where 0 < m1 ≤ m2 ≤ m3, then

2 v(J10)(cid:9)
m1 = min(cid:8)v(I12), 1
m1 = min(cid:8)v(J4), 1
m2 = min(cid:8)v(I12) − m1, 1

3 v(J10), 1

2 v(I12)(cid:9) ,
2 (v(J10) − m1)(cid:9)

(iv) If K = [I0 − I0 − l], then l = 1
(v) If K = [Im1 − I0 − l], where m1 > 0, then

m3 = v(J10) − m1 − m2 .
12 v(J10).
and m1 = v(J10) − v(I12) .
(vi) If K = [Im1 − Im2 − l], where m2 ≥ m1 > 0 and l > 0, then

12 v(I12)

l = 1

and

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

21

Part II: Study of Local Height Correction Functions

In Part II of the paper, k will always denote a non-archimedean local ﬁeld with residue
ﬁeld k, valuation ring O and normalized additive valuation v : k× (cid:16) Z. We let C be a
curve of genus 2 over k, given by an integral Weierstrass model C, which we consider
as a subscheme of the weighted projective plane PS(1, 3, 1), where S = Spec(O). In the
following ﬁve sections we ﬁnd explicit formulas and bounds for the local height correction
function µ for the most frequent cases of bad reduction and use these to deduce a general
bound on µ. We denote the minimal regular model of C over S by Cmin. Let J be the
Jacobian of C; we denote its N´eron model over S by J . We write Cv, Cmin
and Jv for
the respective special ﬁbers of C, Cmin and J .

v

By Theorem 3.10, the set

7. The ‘kernel’ of µ

U = {P ∈ J(k) : ε(P ) = 0}

is a group and the local height correction function µ factors through the quotient J(k)/U .
In this section we relate U to the N´eron model of J when C has rational singularities.
See [Art86] for a brief account of the theory of rational singularities on arithmetic sur-
faces.
For the remainder of this section we assume that C/S is normal and reduced. We let
∼= J and special
J 0 denote the identity component (the scheme with generic ﬁber Jk
v of the special ﬁber Jv) of the N´eron
ﬁber the connected component of the identity J 0
model J . If C(cid:48) → C is a desingularization of C, then the identity components Pic0C(cid:48)/S
and Pic0C/S of the respective relative Picard functors of C(cid:48) and C can both be represented
by separated schemes, see [BLR90, Thm. 9.7.1]. There are canonical S-group scheme
morphisms

/ Pic0C(cid:48)/S

∼ /

/ J 0 ;

Pic0C/S

(7.1)
the latter map is an isomorphism by [BLR90, Thm. 9.4.2]. Let α : Pic0C/S → J 0 denote
the composition of the morphisms from (7.1); note that α does not depend on the choice
of the desingularization C(cid:48).
Let Csm be the smooth locus of C. Essentially following [BLR90, §9.3], we deﬁne W as the
subscheme of the smooth S-scheme C(2)
sm containing the points w = {P1, P2} ∈ W such
that the hyperelliptic involution ι maps the component containing P1 to the component
containing P2 and such that H 1(Cw, OCw (Dw)) = 0, where D is the universal Cartier
divisor D ⊂ C×S C(2)
sm → Div2C/S. The latter condition
implies that if w = {P1, P2} lies on the generic ﬁber of W , then the divisor (P1) + (P2)
is non-special. Then W has the following properties:
(i) W is an open subscheme of C(2)
sm .
(ii) There is a strict S-birational group law on W , induced by the group law on PicC/S.
(iii) Pic0C/S is the S-group scheme associated with this strict S-birational group law.

sm induced by the canonical map C(2)

For (ii) and (iii) see the discussion preceding [BLR90, Thm. 9.3.7].
Let Pic(2)C/S be the open subfunctor of PicC/S whose elements have total degree 2. Let
ρ : W → Pic(2)C/S be the canonical map induced by D; by [BLR90, Lemma 9.3.5] it is an
open immersion. We can ﬁnd a section x0 ∈ P1
S(S) such that its pullback D0 under the

/
22

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

covering map C → P1
S is horizontal and does not intersect the singular locus of C. We
denote by c0 the class of D0 in Pic(2)C/S. Let w = {P1, P2} ∈ W ; using the condition on
the action of ι on the components P1 and P2 lie on, we ﬁnd that

ρ0(w) := ρ(w) − c0 ∈ Pic0C/S .

In fact ρ0 deﬁnes an open immersion ρ0 : W → Pic0C/S, see [BLR90, Lemma 9.3.6].
Lemma 7.1. If P ∈ J(k) is in the image of α and the residue characteristic of k is
not 2, then ε(P ) = µ(P ) = 0.
Proof. We may assume that C : Y 2 = F (X, Z). Let JF denote the model of J in P15
constructed in [CF96, Chapter 2] and let JF /S denote the model it deﬁnes over S.
Furthermore, we denote by J 0
F the scheme whose generic ﬁber is JF and whose special
ﬁber J 0
F,v is the connected component of the identity of the smooth locus of the special
ﬁber JF,v. We have a morphism ψ : C(2)
F , deﬁned using the expressions for the
coordinates on JF in [CF96, Chapter 2], see the proof of [BS10, Lemma 5.7]. We also
denote the restriction of this morphism to W by ψ.
By the N´eron mapping property, there is a morphism ϕ : J 0
In general, its
image can be a proper subset of J 0. Nevertheless, the following diagram of S-scheme
morphisms is commutative by [Liu02, Prop. 3.3.11], since W is reduced, J 0 is separated
and the diagram is commutative when restricted to generic ﬁbers:

F → J .

sm → J 0

(7.2)

ψ

α

W

ρ0

Pic0C/S

/ J 0

F

ϕ

/ J 0

We claim that im(α) ⊂ im(ϕ). To prove this, we will show that ϕ is surjective onto the
image of α as a morphism of sheaves on the big ´etale site over S. Let T be an S-scheme
and let x ∈ Pic0C/S(T ). By property (ii) and (iii) of W , there is an ´etale cover T (cid:48)/T and
w1, . . . , wn ∈ W (T (cid:48)) such that

x = ρ0(w1) + . . . + ρ0(wn) ,

where the sum is taken with respect to the group law on Pic0C/S. In fact we can take
n = 2; this follows from [BLR90, Lemma 5.1.4] and the discussion following [BLR90,
Lemma 5.2.4]. Setting

y = ψ(w1) + ψ(w2) ,

where now the sum is taken with respect to the group law on J 0
F , we immediately deduce
ϕ(y) = α(x) from the commutativity of the diagram (7.2).
Let P ∈ J(k). It follows from [BS10, Prop. 5.10] that ε(P ) = 0 if and only if P maps to
J 0
(cid:3)
F,v(k). Since ε(P ) = 0 implies µ(P ) = 0, the result follows.

Now suppose that the residue characteristic is 2. In this situation no explicit analogue
of the group scheme JF has been constructed yet. Instead, we will show directly that
there is an open subscheme W (cid:48) of W such that a point P ∈ J(k) in the image of
α◦ρ0|W (cid:48) : W (cid:48) → J 0 must satisfy µ(P ) = 0. This will suﬃce for our intended application.
k × A5
In analogy with [BS10, Deﬁnition 5.1], we deﬁne a subscheme ˜D ˜F , ˜H of A3
consisting of all triples
k × A4

(A, B, C) =(cid:0)(a0, a1, a2), (b0, b1, b2, b3), (c0, c1, c2, c3, c4)(cid:1) ∈ A3

k × A4
k × A5

k

k



/


/
CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

23

such that

where

AC = F − B2 − BH ,

A = a0Z2 + a1XZ + a2X 2,
B = b0Z3 + b1XZ2 + b2X 2Z + b3X 3,
C = c0Z4 + c1XZ2 + c2X 2Z2 + c3X 3Z + c4X 4.

k deﬁned as (π2×id)(cid:0)pr12( ˜D ˜F , ˜H )(cid:1),

k ×A4

˜F , ˜H

Moreover, we denote by D ˜F , ˜H the subscheme of P2
where pr12 is the projection onto the ﬁrst two factors and π2 is the canonical map
k \ {(0, 0, 0)} → P2
A3
k .
Note that if the curve C ˜F , ˜H deﬁned by Y 2 + ˜H(X, Z)Y = ˜F (X, Z) in Pk(1, 3, 1) is
nonsingular, then D ˜F , ˜H is in bijective correspondence with the possible Mumford rep-
resentations of eﬀective divisors of degree 2 on C ˜F , ˜H .
be the subset of all (A, B) ∈ D ˜F , ˜H such that A does not vanish at the
Let D(cid:48)
image in P1 of a singular point of C. We deﬁne a map ζ : D(cid:48)
→ C(2) such that
if ζ((A, B)) = { ˜P1, ˜P2}, then there are representatives (Xi, Yi, Zi) of ˜Pi (i = 1, 2)
satisfying
(i) A(X, Z) = (Z1X − X1Z)(Z2X − X2Z);
(ii) Yi = B(Xi, Zi) for i = 1, 2.
Consider the subscheme ˜W of D ˜F , ˜H given by those points (A, B) which satisfy one of
the following conditions:
(1) (A, B) ∈ D(cid:48)

, and if ζ((A, B)) = { ˜P1, ˜P2}, then ι maps the component containing

˜F , ˜H

˜F , ˜H

(2) A = c ˜L(X, Z)2, where ˜L vanishes at the projection of a singular point of C to P1

˜P1 to the component containing ˜P2.
and ˜L3 does not divide ˜F − B2 − B ˜H.

If C ˜F , ˜H is nonsingular, and (A, B) ∈ D ˜F , ˜H , then we can compose the natural surjection
D ˜F , ˜H → Jac(C ˜F , ˜H ) \ {O} with the quotient map Jac(C ˜F , ˜H ) → KS ˜F , ˜H . In the general
case one can also deﬁne a surjection ω : D ˜F , ˜H → KS ˜F , ˜H \{(0 : 0 : 0 : 1)}, where the
image of a pair (A, B) ∈ D ˜F , ˜H under ω is of the form (a0 : −a1 : a2 : x4). We only give
the form of x4 in two special cases: If b3 = b2 = 0, then we have

(7.3)

x4 = b2

1 + b1S1(a0, a1, a2) + S0(a0, a1, a2).

and if b0 = b1 = 0, then

(7.4)

x4 = b2

2 + b2T1(a0, a1, a2) + T0(a0, a1, a2).

Here S0, S1, T0, T1 are homogeneous forms in a0, a1, a2; T0 and S0 have coeﬃcients in
F2[f0, . . . , f6], whereas S1 and T1 have coeﬃcients in F2[h0, . . . , h3].
Lemma 7.2. If x ∈ ω( ˜W ) ⊂ KS ˜F , ˜H , then we have δ(x) (cid:54)= 0.

Proof. Changing the given model if necessary, we can assume that ˜H and ˜F are as in
the list of representatives 1–13 in Table 1. Table 2 contains conditions on x which are
equivalent to the vanishing of δ(x) for each representative and additional conditions
which a point x = (x1 : x2 : x3 : x4) ∈ P3 satisfying δ(x) = 0 must satisfy in order
to lie on KS ˜F , ˜H . Finally, we have listed the multiplicities that C ˜F , ˜H has at the points

24

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

type

condition

additional multiplicities

(6)
(5)
(4)

(3, 2)

(3)

(4, 2)

x4 = 0
x4 = 0
x4 = 0
x4 = 0

x1x3 = x4 = 0
x1 = x4 = 0

1
2
3
4
5
6
7
8
9
10
11
12
13
Table 2. Conditions for the vanishing of δ(x)

x1x3 = x4 = 0
x1 = x4 = 0
x1 = x4 = 0

x1 = 0
x1x3 = 0

(2, 2, 2)

(2, 2)

(2)
(3)
(5)

(3, 3)

x1 = 0
x1 = 0

x4 = 0
x4 = 0

x4 = 0
x4 = 0

(X : Z) = (1 : 0), (X : Z) = (0 : 1) and (X : Z) = (1 : 1), respectively, in case the
multiplicities there are greater than 1.
Let (A, B) ∈ ˜W be such that ω((A, B)) = x. If A(X, Z) does not vanish at the image
in P1 of a singular point, then in particular x1 (cid:54)= 0 and, if (0, 0) is a singular point, also
x3 (cid:54)= 0. Using Table 2, this already implies that δ(x) (cid:54)= 0 whenever C is irreducible.
In the reducible cases 2, 7 and 8, C has two irreducible components and one checks
easily that x4 does not vanish if ζ((A, B)) = { ˜P1, ˜P2} such that ι maps the component
containing ˜P1 to the component containing ˜P2. Hence δ(x) (cid:54)= 0 by Table 2.
We now assume that A(X, Z) vanishes at the image of a singular point. It suﬃces to
consider the cases ˜L = Z and ˜L = X. We will show that x4 (cid:54)= 0, which is enough to
prove δ(x) (cid:54)= 0 using Table 2.
If ˜L = Z, then we may assume B = b2X 2Z + b3X 3 and we have x = (0 : 0 : 1 : x4).
Because A divides ˜F + B2 + B ˜H, we get b3 = 0. A simple computation using (7.4) shows
that in all cases 1–13 we have x4 = b2(b2 + h2), but (A, B) ∈ ˜W implies b2(b2 + h2) (cid:54)= 0.
If ˜L = X, then we may assume B = b1XZ2 + b0Z3 and ﬁnd x = (1 : 0 : 0 : x4).
Using an argument analogous to the one employed for ˜L = Z we get b0 = 0 and
x4 = b1(b1 + h1) (cid:54)= 0 using (7.3).
(cid:3)
Deﬁne the subscheme W (cid:48) of W as the intersection W ∩ ζ( ˜W ) ⊂ C(2).
Lemma 7.3. If P ∈ J(k) is in the image of α and the residue characteristic of k is 2,
then ε(P ) = µ(P ) = 0.
Proof. First suppose that P ∈ J(k) is a point such that ( ˜A, ˜B) ∈ ˜W , where (A, B)
is a Mumford representative of (the eﬀective degree 2 divisor corresponding to) P . If
x ∈ KSA is a set of normalized Kummer coordinates for P , then the reduction ˜x ∈ KS ˜F , ˜H
of x satisﬁes ˜x ∈ ω( ˜W ). Lemma 7.2 implies that δ(˜x) (cid:54)= 0 and hence ε(x) = 0.
To ﬁnish the proof, we argue in a similar way as in the proof of Lemma 7.1. Note that
˜W is deﬁned in such a way that we have W (cid:48) = W if C is irreducible. If C is reducible,
then a point {P1, P2} in the special ﬁber of W lies in the special ﬁber of W (cid:48) if and only
if ι maps the component containing P1 to the component containing P2. Hence W (cid:48) is
an open subscheme of W (recall that C is assumed to be reduced).

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

25

This implies that for an S-scheme T and x ∈ Pic0C/S(T ) we can ﬁnd an ´etale cover T (cid:48)/T
and ﬁnitely many w1, . . . , wn ∈ W (cid:48)(T (cid:48)) such that x = ρ0(w1) + . . . + ρ0(wn). We already
showed that µ(α(ρ0(wi))) = 0 for all i = 1, . . . , n; by Lemma 3.7, this suﬃces to prove
(cid:3)
the lemma.

Taking Lemmas 7.1 and 7.3 together, we have now proved the following.
Proposition 7.4. Let α : Pic0C/S → J 0 be the canonical homomorphism. If P ∈ J(k)
is in the image of α, then ε(P ) = µ(P ) = 0.

Let J0(k) denote the subgroup of J(k) consisting of points whose image on the special
ﬁber of J is in J 0(k). Then the group Φ(k) of k-rational points in the component group
Φ of J satisﬁes

Φ(k) ∼= J(k)/J0(k) .

We can now give a criterion for when ε and µ factor through Φ(k).

Theorem 7.5. Let C be a smooth projective curve of genus 2 deﬁned over a non-
archimedean local ﬁeld k, given by an integral Weierstrass model C with rational singu-
larities. Then ε and µ factor through Φ(k).
Proof. First note that if C has rational singularities, then C is normal and reduced.
Moreover, according to [BLR90, Thm. 9.7.1(b)], the homomorphism α is an isomorphism
if and only if C has rational singularities. This implies that the image of α, restricted to
the generic ﬁber, is J0(k). By Proposition 7.4, we have ε(P ) = µ(P ) = 0 for P in the
(cid:3)
image of α. Theorem 3.10 implies that µ and ε factor through Φ(k).

Remark 7.6. A non-minimal Weierstrass model cannot have rational singularities. How-
ever, there are minimal (even stably minimal) Weierstrass models of curves of genus 2
that have non-rational singularities. See Example 10.4 for a stably minimal Weierstrass
model having µ(P ) (cid:54)= 0 for some points P ∈ J0(k).
This behavior cannot occur for elliptic curves; here µ always factors through Φ(k),
provided the given Weierstrass model is minimal, see [Sil88]. This is crucial for the
usual algorithms to compute canonical heights on elliptic curves. Note that a Weierstrass
model of an elliptic curve is minimal if and only if it has rational singularities by [Con05,
Corollary 8.4].

8. N´eron functions and reduction graphs

Our next goal is to derive a formula for µ(P ) in the case when the minimal proper
regular model of C is semistable and µ factors through Φ(k). To this end, we need the
notion of N´eron functions. The following result is due to N´eron; see [Lan83, §11.1].
Proposition 8.1. Let A be an abelian variety deﬁned over a local ﬁeld k. Then we can
associate to any divisor D ∈ Div(A) a function λD : A \ supp(D) → R such that the
following conditions are satisﬁed, where we write λ ≡ λ(cid:48) mod const. to indicate that the
functions λ and λ(cid:48) diﬀer by a constant.
(1) If D, E ∈ Div(A), then λD+E ≡ λD + λE mod const.
(2) If D = div(f ) ∈ Div(A) is principal, then λD ≡ v ◦ f mod const.
(3) If D ∈ Div(A) and TP : A → A is the translation map by a point P ∈ A(k), then we

have λT ∗

P D ≡ λD ◦ TP mod const.

Also, λD is uniquely determined up to adding a constant.

κ1
and we deﬁne a function ˆλi : J(k) \ supp(Di) → R by

Di = Θ±

∞ + div

(cid:18) κi
(cid:19)
(cid:18) κ(P )

κi(P )

(cid:19)

.

ˆλi(P ) = ˆλ

26

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

We call a function λD as in Proposition 8.1 a N´eron function associated with D.
We can use local heights on Kummer coordinates to construct N´eron functions on the
Jacobian J of our genus 2 curve C. If P0 ∈ C(¯k), then we have an embedding C → J,
deﬁned over ¯k, that maps a point P ∈ C to the divisor class [(P ) − (P0)] ∈ Pic0
C = J.
Its image is the theta divisor ΘP0. We set Θ±
is symmetric
and in the linear equivalence class of 2Θ (where Θ is a theta divisor coming from taking
a Weierstrass point as base-point). For the following, ﬁx a point ∞ ∈ C(¯k) at inﬁnity.
For i ∈ {1, . . . , 4}, we set

= ΘP0 + Θι(P0); then Θ±

P0

P0

Lemma 8.2. Let ∞ ∈ C(¯k) be a point at inﬁnity as above and let i ∈ {1, . . . , 4}. Then
Di is deﬁned over k and the function ˆλi is a N´eron function associated with Di.
Proof. If ∞ /∈ C(k), then we have ∞ ∈ C(k(cid:48)) for some quadratic extension k(cid:48) of k and
the nontrivial element of the Galois group Gal(k(cid:48)/k) maps ∞ to ι(∞), proving the ﬁrst
(cid:3)
assertion. For a proof of the second assertion, see [Uch11, Thm. 5.3].

Deﬁnition 8.3. Assume that C has semistable reduction over k. The reduction graph
R(C) of C is a graph with vertex set the set of irreducible components of the special
ﬁber of Cmin; two vertices Γ1 and Γ2 are connected by n edges, where n is the number
of intersection points of Γ1 and Γ2 if Γ1 (cid:54)= Γ2, and n is the number of nodes of Γ1 if
Γ1 = Γ2.

We consider R(C) as a metric graph by giving each edge length 1. For two vertices
Γ1 and Γ2, we deﬁne r(Γ1, Γ2) as the resistance between the vertices, when R(C) is
considered as an electric network with unit resistance along every edge.

Remark 8.4. We can compute r(Γ1, Γ2) as follows. Order the vertices of R(C) in some
way and let M be the intersection matrix with respect to this ordering. Since all
components of the special ﬁber have multiplicity one, the kernel of M is spanned by the
‘all-ones’ vector and the image of M consists of the vectors whose entries sum to zero.
Let v be the vector with entries zero except that the entry corresponding to Γ1 is 1 and
the entry corresponding to Γ2 is −1. Then there is a vector g with rational entries such
that M g = v, and

r(Γ1, Γ2) = −g · v

is, up to sign, the standard inner product of the two vectors.
(Note that g is not
unique, but adding a vector in the kernel of M to it will not change the result.) See for
instance [Cin11, Lemma 6.1].

Note that the linear map given by M on the space of functions on the vertices can be
interpreted as the discrete Laplace operator on the graph R(C). It is then easy to see
that g, viewed as a function on the vertices, is piecewise linear along sequences of edges
not containing Γ1, Γ2 or a vertex of degree at least 3. This makes it quite easy to ﬁnd g
and to compute r(Γ1, Γ2).

The reduction graph is unchanged when we replace k by an unramiﬁed extension. If
we base-change to a ramiﬁed extension k(cid:48) of k with ramiﬁcation index e, then the new
reduction graph is obtained by subdividing the edges of R(C) into e new edges. We can

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

27

give these new edges length 1/e; then the underlying metric space remains the same.
In particular, r(Γ1, Γ2) does not depend on k(cid:48). This allows us to replace k by a ﬁnite
extension if necessary. The scaling of the length corresponds to extending the valuation
v : k× (cid:16) Z to ¯k× → Q instead of considering the normalized valuation on k(cid:48). All notions
deﬁned in terms of the valuation (for example, intersection numbers) are then scaled
accordingly.
Proposition 8.5. We assume that Cmin is semistable. Let P = [(P1) − (P2)] ∈ J(k),
with P1, P2 ∈ C(k) mapping to components Γ1 and Γ2, respectively, of the special ﬁber
of Cmin. We make the following further assumptions.
(i) If Q1, Q2 ∈ C(k) map to Γ1 and Γ2, respectively, then µ(P ) = µ([(Q1) − (Q2)]).
(ii) There is a constant µ1 ∈ Q such that µ([(Q1) − (Q(cid:48)
1 ∈ C(k)
1)]) = µ1 for all Q1, Q(cid:48)
1 on the special ﬁber of Cmin are
mapping to Γ1 such that the images of Q1 and Q(cid:48)
distinct.
(iii) There is a constant µ2 ∈ Q such that µ([(Q2) − (Q(cid:48)
2 ∈ C(k)
2)]) = µ2 for all Q2, Q(cid:48)
2 on the special ﬁber of Cmin are
mapping to Γ2 such that the images of Q2 and Q(cid:48)
distinct.

Then we have

µ(P ) = r(Γ1, Γ2) +

µ1 + µ2

2

.

Proof. By the discussion preceding the statement of the theorem, we can assume that k
is suﬃciently large for C(k) to contain all points we might be interested in.
Let P0 ∈ C(k). The embedding with respect to P0 is obtained from the ‘diﬀerence map’
ψ : C × C → J that sends a pair of points (P1, P2) to [(P1) − (P2)] by specializing the
second argument to P0. One easily checks that

ψ∗ΘP0 = ∆C + ({ι(P0)} × C) + (C × {P0}) ,

where ∆C denotes the diagonal and ι is the hyperelliptic involution on C. We then have

ψ∗Θ±

P0

= 2∆C + pr∗

1 D0 + pr∗

2 D0 ,

where D0 = (P0) + (ι(P0)). By the results in [Hei04] this implies that, taking λ0 to be
a N´eron function associated to Θ±

(cid:0)[(P1) − (P2)](cid:1) = 2(cid:104)P1, P2(cid:105) + (cid:104)P1 + P2, P0 + ι(P0)(cid:105) + c

λ0

,

P0

for all points P1, P2 ∈ C(knr) with P1 (cid:54)= P2 and {P1, P2} ∩ {P0, ι(P0)} = ∅, where (cid:104)·,·(cid:105)
is the pairing in [Hei04, Thm. 4.4] and c ∈ R is a constant.
If Cmin has semistable reduction, then, by [Hei04, Remark 4.6], the pairing (cid:104)·,·(cid:105) coincides
with Zhang’s admissible pairing (·,·)a deﬁned in [Zha93] in terms of harmonic analysis
on the reduction graph R(C). In these terms, we have for Q, Q(cid:48) ∈ C(knr):

(cid:48)
(cid:104)Q, Q(cid:48)(cid:105) = (Q, Q(cid:48))a = i(Q, Q

) + gν(Γ, Γ(cid:48)) ,

) is the intersection multiplicity of the sections Q, Q

(cid:48)
(cid:48) ∈ Cmin(Onr) induced
where i(Q, Q
by Q and Q(cid:48), respectively, and gν(Γ, Γ(cid:48)) is the Green’s function associated to a certain
measure ν on R(C), with Γ and Γ(cid:48) being the respective components of the special ﬁber
of Cmin that Q and Q(cid:48) reduce to. See [Zha93, §4]. We extend gν to a bilinear map on
the free abelian group generated by the vertices of R(C).

28

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Lemma 8.2 gives, for P0 = ∞ and P = [(P1)−(P2)] with normalized Kummer coordinates
x(P ) = (x1(P ), . . . , x4(P )),

µ(P ) = v(x1(P )) − ˆλ1(P )

= v(x1(P )) − 2i(Q1, Q2) − i(Q1 + Q2, P 0 + ι(P0))

− 2gν(Γ1, Γ2) − gν(Γ1 + Γ2, Γ0 + Γ(cid:48)

0) − c ,

where Γ1 and Γ2 are the respective components that P1 and P2 reduce to, and Γ0 and Γ(cid:48)
0
are the respective components that P0 and ι(P0) reduce to. We assume for a moment
that the images of P1 and P2 on the special ﬁber of the original model C are distinct
from the images of the points at inﬁnity. By assumption (i), µ(P ) is unchanged when
we replace the points P1 and P2 by other points still mapping to Γ1 and Γ2, respectively.
We can therefore assume that the images of P1 and P2 on the special ﬁber of Cmin are
distinct from each other and also from the images of P0 and ι(P0). This implies that
v(x1(P )) = 0. Then the intersection numbers in the formula above are zero. We can
choose further points Q1 and Q2 that also reduce to Γ1 and Γ2 with reductions on the
special ﬁber of C distinct from those of P0 and ι(P0) and such that P1, P2, Q1 and Q2
all reduce to distinct points on the special ﬁber of Cmin. Using assumptions (ii) and (iii),
we obtain the following relations.

µ(P ) = µ(cid:0)[(P1) − (P2)](cid:1) = −2gν(Γ1, Γ2) − gν(Γ1 + Γ2, Γ0 + Γ(cid:48)

2 µ(cid:0)[(P1) − (Q1)](cid:1) = gν(Γ1, Γ1) + gν(Γ1, Γ0 + Γ(cid:48)
2 µ(cid:0)[(P2) − (Q2)](cid:1) = gν(Γ2, Γ2) + gν(Γ2, Γ0 + Γ(cid:48)

0) + 1
2 c

0) + 1
2 c

0) − c

− 1
2 µ1 = − 1

− 1
2 µ2 = − 1

Adding them together gives

µ(P ) − 1

2 (µ1 + µ2) = gν(Γ1 − Γ2, Γ1 − Γ2) = r(Γ1, Γ2) ,

as desired. See [Zha93, §3] for the last equality.
If our assumption that the images of P1 and P2 on the special ﬁber of the original
model C are distinct from the images of the points at inﬁnity is not satisﬁed, then we
choose another point P0 for which the assumption is satisﬁed. We can then perform a
change of coordinates τ over O that moves P0 to inﬁnity and apply the result above. By
Corollary 4.6 (note that v(τ ) = 0 in this case) and the fact that v(τ (x)) = v(x), µ(P ) is
(cid:3)
unchanged by τ .
Remark 8.6. We see from the proof that for two points Q, Q(cid:48) both having image on
a component Γ, but with distinct reductions that are also distinct from those of P0
and ι(P0), we always have

µ([(Q) − (Q(cid:48))]) = −2gν(Γ, Γ) − 2gν(Γ, Γ0 + Γ(cid:48)

0) − c .

So the assumption that this value does not depend on the choice of Q and Q(cid:48) is not
really necessary.

Theorem 8.7. Let C be a smooth projective curve of genus 2 deﬁned over a non-
archimedean local ﬁeld k, given by an integral Weierstrass model. Let J be the Jacobian
of C and J its N´eron model over S = SpecO. Assume that the minimal proper regular
model Cmin of C over S is semistable and that µ factors through the component group Φ(k)
of J . Let P ∈ J(k) be such that its image in Φ(k) is [Γ1 − Γ2], where Γ1 and Γ2 are
components of the special ﬁber of Cmin. Then we have

µ(P ) = r(Γ1, Γ2) .

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

29

Figure 1. The special ﬁber of reduction type [Im−0−0] and its reduction graph

Proof. Since µ factors through Φ(k), it follows that µ([(P1) − (P2)]) vanishes when P1
and P2 map to the same component on the special ﬁber of Cmin and in general depends
only on the components P1 and P2 map to. This shows that assumptions (i) to (iii) in
(cid:3)
Proposition 8.5 are satisﬁed with µ1 = µ2 = 0. The claim follows.

9. Formulas and bounds for µ(P ) in the nodal reduction case

In this section and the next, we will deduce explicit formulas for µ(P ) when we have a
stably minimal Weierstrass model C.
In this section we shall use Theorem 8.7 and Remark 8.4 to ﬁnd explicit formulas for
µ(P ) whenever C/k has nodal reduction, i.e., the special ﬁber Cv of C is reduced and
all multiplicities are at most 2. In this case C is semistable and therefore it has rational
singularities. Let ∆ = ∆(C) denote the discriminant of C; we assume that there is at
least one node, so that v(∆) > 0.
Since there are at most three nodes in the special ﬁber of C, we have to consider three
diﬀerent cases. We assume that x = (x1, x2, x3, x4) are normalized Kummer coordinates
for a point P ∈ J(k).
First suppose that there is a unique node in the special ﬁber of C and set m = v(∆). In
the notation of Namikawa and Ueno [NU73] this is reduction type [Im−0−0]. If m = 1,
then C is regular over S.
In general, there is a unique component, which we denote
by A, of genus 1 in the special ﬁber of Cmin. As in the case of multiplicative reduction of
elliptic curves (see for example [Sil94]), the singular point on the special ﬁber is replaced
by a string of m−1 components of Cmin, all of genus 0 and multiplicity 1. We choose one
of the two components intersecting A and call it B1 and number the other components
B2, . . . , Bm−1 consecutively as in Figure 1.
Using [BLR90, Thm. 9.6.1], it is easy to see that the geometric component group Φ(¯k)
of the N´eron model is generated by [B1 − A] and is isomorphic to Z/mZ. We have
[Bj − A] = j · [B1 − A] in Φ(¯k).
We set B0 := Bm := A. Then we have the following result.
Proposition 9.1. Suppose that there is a unique node in the special ﬁber of C; let m
and the notation for the components of the special ﬁber of Cmin be as above. If P ∈ J(k)
maps to [Bi − A] in the component group, then we have

µ(P ) =

i(m − i)

m

.

AB1B2Bm-1Bm-2AB1B2Bm-1Bm-230

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Figure 2. The special ﬁber of reduction type [Im1−m2−0] and its reduc-
tion graph

Proof. Since the given model is semistable, we can use Theorem 8.7 and Remark 8.4.
One choice of g as in Remark 8.4 is given by

− j(m − i)

− i(m − j)

m

g(Bj) =

if 0 ≤ j ≤ i,
if i ≤ j ≤ m.

Then

as claimed.

µ(P ) = r(Bi, A) = −(cid:0)g(Bi) − g(A)(cid:1) =

m

i(m − i)

m

,

(cid:3)

Remark 9.2. Proposition 9.1 resembles the formula for the canonical local height on an
elliptic curve with split multiplicative reduction given, for instance, in [Sil88].
Now suppose that there are precisely two nodes in the special ﬁber of C. The reduction
type is [Im1−m2−0] in the notation of [NU73], where m1, m2 ≥ 1 and m1 + m2 = v(∆).
The special ﬁber of Cmin is obtained by blowing up the two singular points of the
special ﬁber of C repeatedly and replacing them with a chain of m1 − 1 and m2 − 1
curves of genus 0, respectively. We call these components B1, . . . , Bm1−1, C1, . . . , Cm2−1,
numbered as in Figure 2, where A contains all images of points reducing to a nonsingular
point and we pick components B1 and C1 intersecting A as in the case of a unique node.
The component group Φ(¯k) is isomorphic to Z/m1Z×Z/m2Z and is generated by [B1−A]
and [C1−A]; this follows again using [BLR90, Thm. 9.6.1]. If we have m1 = 1 or m2 = 1,
then the corresponding singular point on the special ﬁber of C is regular and is therefore
not blown up.
We set B0 := Bm1 := C0 := Cm2 := A. Then every element of the component group has
a representative of the form [Bi − Cj] with 0 ≤ i ≤ m1 and 0 ≤ j ≤ m2. The following
result expresses µ(P ) in terms of this representative.
Proposition 9.3. Suppose that there are exactly two nodes in the special ﬁber of C; let
m1 and m2 and the notation for the components of the special ﬁber of Cmin be as above.
If P ∈ J(k) maps to [Bi − Cj] in the component group, then we have

i(m1 − i)

j(m2 − j)

.

m2

µ(P ) =

+

m1

Proof. This is an easy computation along the same lines as in the proof of Proposi-
(cid:3)
tion 9.1.

The ﬁnal case that we have to consider is the case of three nodes in the special ﬁber of
C, which then has two components. We call these components A and E. The special

AB1B2Bm1-1Bm1-2C1C2Cm2-1Cm2-2AB1B2Bm1-1Bm1-2C1C2Cm2-1Cm2-2CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

31

Figure 3. The special ﬁber of reduction type [Im1−m2−m3] and its re-
duction graph

ﬁber of the minimal proper regular model is obtained using a sequence of blow-ups of the
singular points; they are replaced by a chain of mi−1 curves of genus 0 and multiplicity 1,
respectively, where v(∆) = m1 + m2 + m3. Hence the special ﬁber of Cmin contains the
two components A and E, connected by three chains of curves of genus 0 that we call
B1, . . . , Bm1−1, C1, . . . , Cm2−1 and D1, . . . , Dm3−1, respectively, where B1, C1 and D1
intersect A, as shown in Figure 3. The reduction type is [Im1−m2−m3].
By [BLR90, Prop. 9.6.10], the group Φ(¯k) is isomorphic to Z/dZ × Z/nZ, where

d = gcd(m1, m2, m3)

and n =

m1m2 + m1m3 + m2m3

d

.

We set B0 := C0 := D0 := A and Bm1 := Cm2 := Dm3 := E. Then it is not hard to see
that each element of Φ(¯k) can be written in one of the forms

[Bi − Cj],

[Cj − Dl]

or

[Dl − Bi]

with 0 ≤ i ≤ m1, 0 ≤ j ≤ m2, 0 ≤ l ≤ m3. The following result allows us to express
µ(P ) for any P ∈ J(k) in terms of the component P maps to.
Proposition 9.4. Suppose that there are three nodes in the special ﬁber of C; let m1,
m2, m3 and the notation for the components of the special ﬁber of Cmin be as above. If
P maps to [Bi − Cj] in the component group for some 0 ≤ i ≤ m1 and 0 ≤ j ≤ m2, then
we have

m2i(m1 − i) + m3(i + j)(m1 − i + m2 − j) + m1j(m2 − j)

µ(P ) =

.

The formulas for [Cj − Dl] and [Dl − Bi] are analogous.

m1m2 + m1m3 + m2m3

Proof. The proof is analogous to those of Propositions 9.1 and 9.3. To ﬁnd g, use that it
is piecewise linear on the segments AB1 . . . Bi, Bi . . . Bm1−1E, AC1 . . . Cj, Cj . . . Cm2−1E
(cid:3)
and AD1 . . . Dm3−1E and the relations at the vertices A, E, Bi and Cj.
Remark 9.5. Using the relation ε(P ) = 4µ(P ) − µ(2P ), one can show by a somewhat
tedious computation involving a number of diﬀerent cases that if the image of P in Φ(k)
is [Γ1 − Γ2], where Γ1 and Γ2 are components of the special ﬁber of Cmin, then ε(P ) is
the ‘distance’ between Γ1 and Γ2 in the reduction graph, where the ‘length’ of the path
between Bi and Bj (say, analogously for Ci, Cj and Di, Dj) is min{2|i − j|, m1} and
otherwise, ‘lengths’ are additive. In particular, if Φ(k) = Φ(¯k), then

γ = max{ε(P ) : P ∈ J(k)} = max{mi + mj − δij : 1 ≤ i < j ≤ 3} ,

where δij = 0 if both mi and mj are even, and δij = 1 otherwise.

AEB1B2Bm1-1Bm1-2C1C2Cm2-1Cm2-2D1D2Dm3-1Dm3-2EAB1B2Bm1-1Bm1-2C1C2Cm2-1Cm2-2D1D2Dm3-1Dm3-232

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Remark 9.6. In order to use the results of this section to actually compute µ(P ) for a
given point P ∈ J(k), we need to be able to ﬁnd the component of Jv that P reduces
to. One approach is to ﬁnd P1 and P2 ∈ C such that P = [(P1) − (P2)] and ﬁnd the
reductions of P1 and P2 to Cmin
. Another approach is to use a transformation (possibly
deﬁned over an unramiﬁed extension of k) to move the singular points to ∞, (0, 0) and
(1, 0), respectively. Then we can (possibly after applying another transformation) read
oﬀ the component that P maps to directly from the Kummer coordinates of P .

v

The discussion of this section shows that we get the following results on the local height
constant β = max{µ(P ) : P ∈ J(k)}. Recall that γ = max{ε(P ) : P ∈ J(k)} and that
γ/4 ≤ β ≤ γ/3. We will see that in many cases the lower bound is attained.
Let P be a node on Cv; it is deﬁned over a ﬁnite extension of k. We say that the
node P is split if the two tangent directions of the branches at P are deﬁned over every
extension that P is deﬁned over, otherwise P is non-split. We say that P is even if its
contribution mi to the valuation of the discriminant is even, and odd otherwise.

Corollary 9.7. Suppose that C/k is a smooth projective curve of genus 2 given by an
integral Weierstrass model C such that there is a unique node in the special ﬁber of C
and let m = v(∆). Then we have

(cid:22) m2

(cid:23)

2

β =

1
2m

≤ v(∆)
4

.

if the node is split or even, and β = 0 otherwise.

Proof. This follows from Proposition 9.1, taking into account that if m is odd and the
(cid:3)
node is non-split, then the group Φ(k) is trivial.
Remark 9.8. Using the relation ε(P ) = 4µ(P ) − µ(2P ), one can check that

ε(P ) = 2 min{i, m − i}

if P maps to [Bi − A] in Φ(k).

If m is even (and β > 0), then β = m/4 = γ/4. If m is odd, then β = (m − 1/m)/4 and
γ = m − 1, so β/γ = (1 + 1/m)/4 approaches 1/4 as m → ∞, but for m = 3 (the worst
case), we have β = γ/3.

Corollary 9.9. Suppose that C/k is a smooth projective curve of genus 2 given by an
integral Weierstrass model C such that there are exactly two nodes in the special ﬁber of
C. Let v(∆) = m1 + m2 as above. Then we have

β =

1

2m1

+

2m2

≤ v(∆)
4

(cid:22) m2

(cid:23)

1
2

(cid:23)

1

(cid:22) m2
(cid:23)
(cid:22) m2

2
2

i
2

if each of the nodes is split or even,

β =

1
2mi

if the node corresponding to mi is split or even and the other node is non-split and odd,
and β = 0 if both nodes are non-split and odd.

Proof. This follows from Proposition 9.3, taking into account the action of Frobenius
(cid:3)
on Φ(¯k).

If we have three nodes, then it helps to take the ﬁeld of deﬁnition of the nodes into
account.

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

33

Corollary 9.10. Suppose that C/k is a smooth projective curve of genus 2 given by an
integral Weierstrass model C such that there are three nodes in the special ﬁber of C.
We say that C is split if the two components A and E of the special ﬁber of Cmin are
deﬁned over k, otherwise C is non-split. Let v(∆) = m1 + m2 + m3 as above and set
M = m1m2 + m1m3 + m2m3.
(a) If all nodes are k-rational, C is split, and we have m1 ≥ m3 and m2 ≥ m3, then

(cid:23)(cid:19)

(cid:22) m2

2
2

1
2M

β =

+ m1
(b) If all nodes are k-rational, but C is non-split, then

+ m3

m2

2

(cid:22) (m1 + m2)2

(cid:23)

1
2

(cid:23)

(cid:22) m2

(cid:18)
β = max{0} ∪(cid:110) mi + mj
(cid:22) m2
(cid:23)
(cid:26)(cid:22) m2

(cid:23)

4

max

+ m1m3,

+ m1

1
2

3
2

(cid:106) m3

(cid:107)(cid:27)

2

≤ m1 + m2

4

<

v(∆)

4

.

.

(cid:111)

: 1 ≤ i < j ≤ 3, mi and mj even

(c) If two of the nodes lie in a quadratic extension of k and are conjugate over k and

one is k-rational, then



m1
M
m1
2
0,

,

β =

,

if C is split,
if C is non-split and m1 is even,

otherwise.

where m3 corresponds to the rational node (and m1 = m2).

(d) If all nodes are deﬁned over a cubic extension of k and are conjugate over k, then

m1 = m2 = m3 = v(∆)/3 and

β =

 v(∆)

9

0,

if C is split,

,

otherwise.

Proof. The proof of (a) follows easily from Proposition 9.4.

For the other cases, note that in the non-split case, some power of Frobenius acts as
negation on the component group Φ(¯k), so the only elements of Φ(k) are elements of
order 2 in Φ(¯k), which correspond to [Bm1/2 − Cm2/2] if m1 and m2 are even (where µ
takes the value (m1 + m2)/4), and similarly with the obvious cyclic permutations.
If P = [(P1) − (P2)] ∈ J(k) and
In the situation of (c), we must have m1 = m2.
P1 ∈ C(¯k) maps to one of the conjugate nodes, then P2 must map to the other, so all
P ∈ J(k) must map to a component of the form [Bi − Cj] or [Di − Dj]. Now the result
in the split case follows from a case distinction depending on whether m1 ≤ m3 or not.
In the non-split case, the only element of order 2 that is deﬁned over k is [Bm1/2− Cm1/2]
if it exists.
In the situation of (d), the group Φ(k) is of order 3 (generated by [E − A]) in the split
(cid:3)
case and trivial in the non-split case.
Extending the valuation v : k× (cid:16) Z to ¯v : ¯k× → Q, we get extensions of ε and µ to J(¯k).
Denote max{µ(P ) : P ∈ J(¯k)} by ¯β and max{ε(P ) : P ∈ J(¯k)} by ¯γ. Then by the
discussion at the beginning of Section 8 and the results above, we ﬁnd that

¯β =

¯γ
4

=

v(∆)

4

,

when there are one or two nodes, and

v(∆)

6

≤ ¯β =

¯γ
4

=

v(∆) − min{m1, m2, m3}

4

<

v(∆)

4

,

34

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

when there are three nodes.

10. Formulas and bounds for µ(P ) in the cuspidal reduction case

In this section we consider the case of a stably minimal Weierstrass model C such that
there are (one or two) points of multiplicity 3 on the special ﬁber. In the notation of
Namikawa and Ueno [NU73], the reduction type is of the form [K1 −K2 − l], where l ≥ 0
and Kj is an elliptic Kodaira type for j ∈ {1, 2}. By [Liu94], we have

Φ(¯k) ∼= Φ1(¯k) × Φ2(¯k) ,

where Φj is the component group of an elliptic curve with Kodaira type Kj. As in the
previous section, we write ∆ = ∆(C) for the discriminant of the model C.
Lemma 10.1. Suppose that the residue characteristic of k is not 2. Let C be given by a
stably minimal Weierstrass model with reduction type [K1 − K2 − l]. Then after at most
a quadratic unramiﬁed extension of k there is a stably minimal Weierstrass model

C : Y 2 = F (X, Z) = f6X 6 + f5X 5Z + f4X 4Z2 + X 3Z3 + f2X 2Z4 + f1XZ5 + f0Z6

of C, isomorphic to the given model of C, such that the elliptic curve E1 with Weierstrass
model
has Kodaira type K1 and the elliptic curve E2 with Weierstrass model

E1 : Y 2Z = X 3 + f2X 2Z + f1XZ2 + f0Z3

E2 : Y 2Z = X 3 + f4X 2Z + f5XZ2 + f6Z3

has Kodaira type K2.

Proof. After possibly making a quadratic unramiﬁed extension and applying a transfor-
mation, we can suppose that one cusp on the special ﬁber is P = (0, 0) and that the
other singularity (if it exists) is the unique point at inﬁnity on the special ﬁber.
Because the residue characteristic is not 2, we may assume that C has H = 0 and f3 = 1
(the latter can be achieved by scaling the variables in a suitable way; note that f3 must
be a unit). By Hensel’s Lemma there is a factorization F = F1F2, where F1 is a cubic
form reducing to X 3. Similarly, F2 reduces to Z3 if there is a cusp at inﬁnity and to
Z2(aX + Z) with a (cid:54)= 0 if there is a node at inﬁnity. Consider the elliptic curves given
by the Weierstrass models

D1 : Y 2Z = F1(X, Z)
D2 : Y 2Z = F2(Z, X) .

and
Then we claim that D1 has Kodaira type K1. To see this, note that in order to desin-
gularize C (respectively, D1) in P (respectively, in the singular point Q = (0, 0) on the
special ﬁber of D1) we ﬁrst blow up C (respectively, D1) in P (respectively, Q). Under
this blow-up map, the strict transform of P (respectively, Q) is contained in the chart C1
1) obtained by dividing the x- and y-coordinates by π. But in fact C1
(respectively, D1
and D1
1 have identical special ﬁber and this continues to hold after further blow-ups (if
any are necessary), which suﬃces to prove that D1 has Kodaira type K1. An analogous
argument shows that D2 has Kodaira type K2.
To complete the proof of the lemma, we therefore only need to make sure that if F
factors as F = F1F2, then Ei has the same reduction type as Di for i = 1, 2. This is
certainly satisﬁed if the coeﬃcients of Ei and Di agree modulo πNi+1, where Ni is the
number of blow-ups needed to construct the minimal desingularization of Di. Writing
out the coeﬃcients of F in terms of the coeﬃcients of F1 and F2, we see that this can

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

35

be achieved by acting on a stably minimal Weierstrass model (with H = 0) for C via a
suitable element of GL2(O).
(cid:3)
Remark 10.2. If the residue characteristic is 2, then it is not hard to see that one can
also construct a stably minimal Weierstrass model C and elliptic Weierstrass models E1
and E2 as in the lemma in a similar way. The construction is more cumbersome, since
we cannot assume H = 0.
In view of Theorem 7.5 we want a condition for C to have rational singularities.
Lemma 10.3. The model C has rational singularities if and only if l = 0.

Proof. We may assume that C is as in Lemma 10.1 or Remark 10.2. By [Art66, Prop. 1],
the assertion that P is a rational singularity depends only on the strict transform of its
preimage under an arbitrary desingularization. So let ξ : C(cid:48) → C be the minimal desin-
gularization of P and let ξ1 : E(cid:48)
1 → E1 be the minimal desingularization of the singular
point Q = (0, 0) on the Weierstrass model E1 (cf. Lemma 10.1 and Remark 10.2). By
the proof of Lemma 10.1, the strict transforms of P and Q under ξ and ξ1, respectively,
are isomorphic to each other. In particular, P is a rational singularity if and only if
Q is a rational singularity. If ∞ is a cusp as well (if it is a node, then it is a rational
singularity anyway), then we get the analogous statement for E2 by symmetry.
However, by [Con05, Corollary 8.4] a Weierstrass model of an elliptic curve has rational
singularities if and only if it is minimal. But it is easy to see that E1 and E2 are
(cid:3)
simultaneously minimal if and only if l = 0.

Figure 4. The special ﬁber of reduction type [I0 − I∗

0 − 0]

Suppose l = 0. If both K1 and K2 are good or multiplicative, then we are in the situation
[Im1−m2−0] for some m1, m2 ≥ 0, which we have discussed in the previous section. So
we may assume that at least one of the Kj is additive, say K2. Then the special ﬁber of
the minimal proper regular model Cmin of C looks like the special ﬁber of E2, but with
one of the rational curves replaced by (see [NU73])

• a curve A of genus 1, if K1 = I0, see Figure 4 for the case K2 = I∗
0 ;
• one of the rational components of K1, otherwise.

Suppose now that l > 0. Then the special ﬁber of Cmin consists of the Kodaira types
K1 and K2, connected by a chain of l − 1 rational curves, see for example Figure 5.
According to Lemma 10.3, not all singularities of the given stably minimal Weierstrass
model C are rational. The following example shows that in this situation ε(P ) (cid:54)= 0 and
hence µ(P ) (cid:54)= 0 can indeed occur for P ∈ J0(k).

A236

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Figure 5. The special ﬁber of reduction type [Im1 − Im2 − l] and its
reduction graph

Example 10.4. Let p be an odd prime and let C/Qp be given by
Y 2 = Z(X 2 + Z2)(X 3 + p5XZ2 + p8Z3) .

Let P1 = (0, p4) ∈ C(Qp) and P2 = ι(P1). We have reduction type [I0 − III − 1] and
hence #Φ(¯k) = 2. It turns out that both P1 and P2 map to the same component and
so we have P = [(P1) − (P2)] ∈ J0(k). The image of P on the Kummer surface is of
the form (x1 : 0 : 0 : x4), where v(x4) − v(x1) = 2. We get ε(P ) = ε(2P ) = 6 and
µ(P ) = µ(2P ) = 2.
The case of semistable reduction, corresponding to reduction type [Im1 − Im2 − l], see
Figure 5, deserves special attention. Here l ≥ 1, by the discussion above. Note that
m1 = 0 (or m2 = 0) is possible; in that case A (or E) is a curve of genus 1 and there
are no components Bi (or Di). If m1 = 1 (or m2 = 1), then A (or E) is a nodal curve
(and again there are no Bi or Di). After perhaps an unramiﬁed quadratic extension,
we can assume that all components in the ‘chain’ that connects the two polygons in the
special ﬁber of Cmin are deﬁned over k. There are then l + 1 diﬀerent (meaning pairwise
non-isomorphic over O) minimal Weierstrass models of the curve, compare the proof of
Lemma 5.4. Explicitly, these models can be taken to have the form

Cj : Y 2 + (h0π3jZ3 + h1πjZ2X + h2πl−jZX 2 + h3π3(l−j)X 3)Y

(10.1)

= f0π6jZ6 + f1π4jXZ5 + f2π2jX 2Z4 + X 3Z3

+ f4π2(l−j)X 4Z2 + f5π4(l−j)X 5Z + f6π6(l−j)X 6

for j = 0, 1, . . . , l, where

y2 + h1xy + h0y = x3 + f2x2 + f1x + f0
y2 + h2xy + h3y = x3 + f4x2 + f5x + f6

and

are minimal Weierstrass equations of elliptic curves of reduction types Im1 and Im2,
respectively. Such a model corresponds to the vertex Cj of the reduction graph (where
we set C0 = A and Cl = E); the corresponding component of the special ﬁber of Cmin is
the one that is visible in the special ﬁber of Cj. The valuation of the discriminant of Cj
is m1 + m2 + 12l and does not depend on j.
Let P1, P2 ∈ C(k) reduce to components Γ1 and Γ2 of the special ﬁber of Cmin, respec-
tively. Consider the model Cj of C.
If there is a simple path from Γ1 to Γ2 in the
reduction graph that passes through Cj, then we say that Cj lies between P1 and P2.
We denote the µ-function computed with respect to Cj by µj.
Proposition 10.5. Let P1, P2 ∈ C(k) be points reducing to components Γ1 and Γ2
of the special ﬁber of Cmin and let j ∈ {0, 1, . . . , l}. Deﬁne jmin and jmax to be the

AB1B2Bm1-1Bm1-2ED1D2Dm2-1Dm2-2C1C2Cl-1Cl-2AB1B2Bm1-1Bm1-2ED1D2Dm2-1Dm2-2C1Cl-1CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

37

smallest, respectively largest, j(cid:48) ∈ {0, 1, . . . , l} such that Cj(cid:48) lies between P1 and P2. Let
P = [(P1) − (P2)] ∈ J(k). Then

r(Γ1, Γ2) + jmax − jmin ≤ µj(P ) ≤ r(Γ1, Γ2) + |j − jmax| + |j − jmin| .

If Cj lies between P1 and P2, then the inequalities are equalities.
Proof. First note that the last statement follows from the ﬁrst, since jmin ≤ j ≤ jmax
implies jmax − jmin = |j − jmax| + |j − jmin|.
Let B0 = Bm1 = A and D0 = Dm2 = E. We prove a number of lemmas.
Lemma 10.6. If j = jmax = jmin ∈ {0, l}, then µj(P ) = r(Γ1, Γ2).

Proof. We assume that j = jmax = jmin = l; the other case is analogous. Then Γ1 and Γ2
are both of the form Di, and we consider the model Cl. We ﬁrst claim that µ(P ) = 0 if
Γ1 = Γ2, but the images of P1 and P2 on Γ1 are distinct. This is clear if Γ1 = D0 = E,
since in this case P is in the image of α, compare Lemmas 7.1 and 7.3. Otherwise,
we note that the multiplicities on the special ﬁber of Cl are 1, 2 and 3. Transforming
the equation over O if necessary, we can assume that its reduction is case 7 in Table 1
of [Sto02] or (if the residue characteristic is 2) case 5 in Table 2 here.
Recall that Γ1 = Γ2 = Di, where we can assume 0 < i ≤ m2/2. Applying a transforma-
tion, we may assume that the points P1 = (ξ1 : η1 : 1) and P2 = (ξ2 : η2 : 1) both reduce
to (0 : 0 : 1) modulo π and that m2 = min{v(f0), 2v(f1)}. First suppose that i < m2/2.
We then have v(ξ1) = v(ξ2) = v(ξ1 − ξ2) = i. Normalizing the Kummer coordinates x
of P so that x1 = 1, we can check that v(x2) and v(x3) are positive, but that v(x4) = 0.
This follows because Γ1 = Di = Γ2 implies that v(f2ξ1ξ2 + 2η1η2) = 2i if char(k) (cid:54)= 2
and H = 0 and that v(ξ1η2 + ξ2η1) = 2i if char(k) = 2. By a similar argument, the
reduction of the image of P on the Kummer surface has non-vanishing last coordinate
if m2 is even and i = m2/2. According to the tables, this implies that ε(P ) = 0 and
therefore also µ(P ) = 0.

Now consider the case that Γ1 and Γ2 do not necessarily coincide. The considerations
above imply that the assumptions of Proposition 8.5 are satisﬁed with µ1 = µ2 = 0
(where we use Lemma 3.7 for the ﬁrst assumption); the proposition then establishes the
(cid:3)
claim.

Lemma 10.7. Assume that Γ1 = Γ2 = Cj with 0 < j < l. Then µj(P ) = 0.
Proof. In this case, P is in the image of α, so the claim follows by Proposition 7.4. (cid:3)

Note that Lemmas 10.6 and 10.7 establish the claim of Proposition 10.5 in all cases such
that j = jmin = jmax.
Lemma 10.8. Assume that both Cj and Cj+1 lie between P1 and P2, where 0 ≤ j < l.
Then µj(P ) = µj+1(P ).
Proof. Let τ : (ξ : η : ζ) (cid:55)→ (πξ : η : π−1ζ); then τ gives an isomorphism from the generic
ﬁber of Cj to that of Cj+1. The induced map on Kummer coordinates is

(x1, x2, x3, x4) (cid:55)−→ (π−2x1, x2, π2x3, x4) ;

we have v(τ ) = 0. Since both Cj and Cj+1 lie between P1 and P2, assuming that Γ1 is to
the left and Γ2 to the right of Cj and Cj+1, we must have that the x-coordinate of P1 on Cj
does not reduce to inﬁnity, whereas that of P2 does. For normalized Kummer coordinates
x = (x1, x2, x3, x4) of P on the Kummer surface associated to Cj, this implies v(x2) = 0
(the point is not in the kernel of reduction, so v(x4) ≥ min{v(x1), v(x2), v(x3)}) and

38

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

v(x1) > 0. Comparing valuations in the equation of Cj, we see that P2 = (1 : η : ζ)
must have v(ζ) ≥ 2, which implies v(x1) ≥ 2. It follows that v(τ (x)) = 0 = v(x). By
Corollary 4.6 we also have ˆλ(τ (x)) = ˆλ(x) (recall that v(τ ) = 0). Since
−v(x) − µj(P ) = ˆλ(x) = ˆλ(τ (x)) = −v(τ (x)) − µj+1(P ) ,

(cid:3)

(cid:0)[(P (cid:48)

µj

2)](cid:1) = µjmin

1) − (P (cid:48)

the claim follows.
Lemma 10.9. If Cj lies between P1 and P2, then µj(P ) depends only on Γ1 and Γ2.
2 ∈ C(k) be points also mapping to Γ1 and Γ2, respectively. We assume
Proof. Let P (cid:48)
without loss of generality that Γ1 is to the left of Γ2. By Lemmas 10.6 or 10.7, we have
that µjmin([(P1) − (P (cid:48)
2)]) = 0. Using Lemmas 10.8 and 3.7,
we obtain

1)]) = 0 and µjmax([(P2) − (P (cid:48)

1, P (cid:48)

(cid:0)[(P (cid:48)
(cid:0)[(P1) − (P (cid:48)

1) − (P (cid:48)

2)](cid:1) = µjmin
2)](cid:1) = µjmax

(cid:0)[(P1) − (P (cid:48)
2)](cid:1)
(cid:0)[(P1) − (P2)](cid:1) = µj(P ) .

(cid:3)
= µjmax
2 ∈ C(k) be points mapping to distinct points on the same
1, P (cid:48)
2)] ∈ J(k). Let j0 be the

Lemma 10.10. Let P (cid:48)
component of the special ﬁber of Cmin and let P (cid:48) = [(P (cid:48)
unique index such that Cj0 lies between P (cid:48)
1 and P (cid:48)
Proof. By Lemmas 10.6 and 10.7, we have µj0(P (cid:48)) = 0. Since the images of P (cid:48)
on the special ﬁber of Cmin are distinct, P (cid:48) is not in the kernel of reduction with respect
to Cj0. If

2. Then µj(P (cid:48)) = 2|j − j0|.

1 and P (cid:48)

1) − (P (cid:48)

2

are normalized Kummer coordinates for P (cid:48) on the Kummer surface associated to Cj0,
we therefore have

x(j0) = (x(j0)

, x(j0)

, x(j0)

, x(j0)

)

2

3

4

1

0 = v(x(j0)) = min{v(x(j0)

1

), v(x(j0)

2

), v(x(j0)

3

)} .

Applying a suitable power of τ (see the proof of Lemma 10.8), we ﬁnd that

x(j) = (π2(j0−j)x(j0)

1

, x(j0)

2

, π2(j−j0)x(j0)

3

, x(j0)

)

4

1

are (not necessarily normalized) Kummer coordinates for P (cid:48) on the Kummer surface
associated to Cj. For deﬁniteness, assume that j > j0, the case j = j0 being clear.
Similarly to the proof of Lemma 10.8, we ﬁnd that 0 = v(x(j0)) = v(x(j0)
), which implies
that v(x(j)) = −2(j − j0). In the same way as in the proof of Lemma 10.8, we deduce
µj(P (cid:48)) = 2(j − j0) = 2|j − j0|.
(cid:3)
To continue the proof of the proposition, we now ﬁrst consider the case that Cj lies
between P1 and P2. In this case, Lemmas 10.9 and 10.10 show that the assumptions in
Proposition 8.5 hold with µ1 = 2|j − jmin| and µ2 = 2|j − jmax| or conversely. So the
statement follows from Proposition 8.5 and |j − jmax| + |j − jmin| = jmax − jmin.
Now assume that Cj does not lie between P1 and P2. We assume for deﬁniteness that
j > jmax. For normalized Kummer coordinates x(jmax) for P = [(P1) − (P2)] on the
Kummer surface associated to Cjmax, we have v(x(jmax)
)},
), v(x(jmax)
compare the proof of Lemma 10.8 above. Then x(j) = τ j−jmax(x(jmax)) are Kummer
coordinates for [(P1) − (P2)] on the Kummer surface associated to Cj, and we have

) ≤ min{v(x(jmax)

1

3

2

v(x(jmax)) − 2(j − jmax) ≤ v(x(j)) ≤ v(x(jmax)) .

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

39

It follows that

µj(P ) − µjmax(P )

=(cid:0)−ˆλ(x(j)) − v(x(j))(cid:1) −(cid:0)−ˆλ(x(jmax)) − v(x(jmax))(cid:1)

= v(x(jmax)) − v(x(j)) ∈ {0, 1, . . . , 2(j − jmax)}.

As µjmax(P ) = r(Γ1, Γ2)+jmax−jmin by the case already discussed, the result follows. (cid:3)
Corollary 10.11. Let C be a stably minimal Weierstrass model of C with discrimi-
nant ∆; assume that C has reduction type [Im1 − Im2 − l] with l > 0. As usual, let
¯β(C) = max{µ(P ) : P ∈ J(¯k)} ,

β(C) = max{µ(P ) : P ∈ J(k)}

and

where µ is computed with respect to C. Then we have

β(C) ≤ ¯β(C) =

m1 + m2

4

+ 2l <

v(∆)

4

and

¯β ≥ v(∆)
6

.

Proof. The assumption on the reduction type implies that the model is equivalent to
one of the form (10.1). Proposition 10.5 then gives upper bounds for µ([(P1) − (P2)]),
with P1, P2 ∈ C(¯k), depending on the images Γ1 and Γ2 of P1 and P2 in the reduction
graph. The maximizing case occurs for Γ1 = Bm1/2 and Γ2 = Dm2/2, giving

µ([(P1) − (P2)]) = r(Bm1/2, Dm2/2) + l = 1

4 m1 + l + 1

4 m2 + l .

For the remaining inequalities, recall that v(∆) = m1 + m2 + 12l and that l > 0.

(cid:3)

We state a technical lemma, which will be needed for the proof of Theorem 10.13 below.

Lemma 10.12. Suppose that the residue characteristic of k is not 2. Consider a de-
generate Weierstrass equation of the form

C : Y 2 = f0Z6 + f1XZ5 + f2X 2Z4 + X 3Z3

E : y2 = f0 + f1x + f2x2 + x3

and let
be an elliptic Weierstrass equation. If Q1 = (x1, y1) and Q2 = (x2, y2) are points in E(k),
then P1 = (x1 : y1 : 1) and P2 = (x2 : y2 : 1) are points in C(k), and if x1, x2 ∈ O, then
µC([(P1) − (P2)]) ≤ µE (Q1 − Q2).
Here µE is the height correction function for the elliptic curve E and µC denotes the
height correction function deﬁned in the same way as µ in the smooth case in terms of
the equation C.

Proof. Let δC = (δC,1, δC,2, δC,3, δC,4) be the duplication polynomials on the Kummer
surface associated to C, and let δE = (δE,1, δE2) be the duplication polynomials for
the numerator and denominator of the x-coordinate associated to E. Then a generic
computation shows that, if (ξ1 : ξ2 : ξ3 : ξ4) is the image of [(P1)− (P2)] on the Kummer
surface, we have (ξ4 : ξ1) = x(Q1 − Q2). In addition, we ﬁnd that (as polynomials in
the ξj) δC,1(ξ1, ξ2, ξ3, ξ4) = δE,2(ξ4, ξ1) and δC,4(ξ1, ξ2, ξ3, ξ4) = δE,1(ξ4, ξ1).
That P1, P2 ∈ C(k) is obvious from the equations. For the last statement, we observe
that min{v(ξ1), v(ξ2), v(ξ3), v(ξ4)} = min{v(ξ1), v(ξ4)} (this is where we use that x1
and x2 are integral), which implies
µC([(P1) − (P2)]) = lim
≤ lim
= µE (Q1 − Q2) .

n→∞ 4−nv(cid:0)δ◦nC (ξ)(cid:1) − v(ξ)
n→∞ 4−nv(cid:0)δ◦nE (ξ4, ξ1)(cid:1) − min{v(ξ1), v(ξ4)}

(cid:3)

40

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

The following consequence is useful for practical purposes. For simplicity, we state it for
the case of residue characteristic (cid:54)= 2, but we expect that the statement remains true
for residue characteristic 2.
Theorem 10.13. Suppose that the residue characteristic of k is not 2. Let C be a stably
minimal Weierstrass model of C such that C has reduction type [K1 − K2 − l]. Then

β(C) ≤ β(K1) + β(K2) + 2l ,

where β(K) denotes the maximum of µ for an elliptic curve of reduction type K (taking
the action of Frobenius into account), see Table 1 in [CPS06].

Proof. We may assume that the point(s) of multiplicity 3 on the special ﬁber are deﬁned
over k, at the cost of an at most quadratic unramiﬁed extension of k. Then we can move
these points to have x-coordinates 0 and ∞, respectively, and so we can assume that
our model C is as in Lemma 10.1. Let P ∈ J(k); we write P = [(P1) − (P2)] with
points P1, P2 ∈ C(k(cid:48)) for a ﬁnite extension k(cid:48) of k such that the reduction of C over k(cid:48)
is semistable. We can ﬁnd C0, C = Cj and Cl as vertices in the reduction graph of the
minimal proper regular model of C over k(cid:48). Then the part of the graph to the left
of C0 corresponds to the reduction graph of E1 over k(cid:48), in the sense that we consider
a semistable model that dominates E1 (and is minimal with that property); the graph
then is either a line segment (potentially good reduction) or a line segment joined to
a circle (potentially multiplicative reduction), with E1 corresponding to the end of the
line segment joined to the remaining graph of C. Similarly, the part of the graph to the
right of Cl corresponds to the reduction graph of E2 over k(cid:48).
Now assume that both P1 and P2 map (strictly) to the left of C0 in the reduction graph.
This means that the x-coordinates of the points have positive valuation. We can then
2 in E1(k(cid:48)) with the same x-coordinates as P1 and P2 and nearby y-
ﬁnd points P (cid:48)
1 and P (cid:48)
1 − P (cid:48)
coordinates. Then P (cid:48)
2 have the same images as P1 and P2
in the reduction graph. By our previous results for the semistable case, the value of (or
at least the upper bound given in Proposition 10.5 for) µ0(P ) depends only on the part
of the graph to the left of C0. We can therefore let l tend to inﬁnity; then Lemma 10.12
and the discussion preceding Lemma 10.3 show that µ0(P ) is bounded by the value
of µE1 on the diﬀerence P (cid:48)
2. By the arguments in the proof of Proposition 10.5, we
have that

2 is in E1(k) and P (cid:48)

1 and P (cid:48)

1 − P (cid:48)

µC(P ) = µj(P ) ≤ µ0(P ) + 2j ≤ β(K1) + 2l .

The case that P1 and P2 both map to the right of Cl is similar.
If (say) P1 maps to the left of C0 and P2 maps to the right of C0, but not to the right
of Cl, then by the formula of Proposition 10.5, we can bound µC(P ) by µ1 + 2l, where
µ1 comes from the part of the graph between P1 and C0. By an argument similar to
the one used in the previous paragraph, µ1 can be bounded by µE1(P (cid:48)
1 is the
point on E1 corresponding to P1 and we take the second point to be on the component
visible in C0. If P2 maps to the right of Cl, then we similarly obtain a bound of the form
µ1 + µ2 + 2l ≤ β(K1) + β(K2) + 2l. The remaining cases are similar or follow directly
(cid:3)
from Proposition 10.5.

1), where P (cid:48)

The example in Section 19 demonstrates the eﬀect of the improved bounds on β as given
in the preceding section. For other examples the bounds established in this section will
be similarly useful.

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

41

11. General upper and lower bounds for ¯β

In this section we derive an upper bound for the geometric height constant ¯β(C) in the
general case by reducing to the semistable situation. We also give a lower bound of the
same order of magnitude. We note the following consequence of the results obtained so
far, see the discussion at the end of Section 9 and Corollary 10.11.
Corollary 11.1. Assume that C is a stably minimal Weierstrass model of C over k
and that the minimal proper regular model Cmin of C over k has semistable reduction.
Denoting the discriminant of C by ∆ and writing ¯β(C) = max{µC(P ) : P ∈ J(¯k)}, where
µC denotes µ with respect to the model C and J is the Jacobian of C, we have

v(∆)

6

≤ ¯β(C) ≤ v(∆)
4

.

When Cmin does not have semistable reduction, the idea is to pass to a suitable ﬁeld
extension k(cid:48)/k and apply Corollary 11.1 over k(cid:48). In order to compare the corresponding
geometric height constants ¯β, we need to analyze how µ changes under minimization.
We ﬁrst prove the following key lemma:
Lemma 11.2. There exists a transformation τ : C → C(cid:48), deﬁned over k, such that C(cid:48) is
a minimal Weierstrass model and

v(τ (x)) + v(τ ) ≤ v(x) for all x ∈ KSA .

Proof. If C is already minimal, then there is nothing to prove. Otherwise, [Liu96, Re-
marque 11] implies that we can compute a minimal Weierstrass model by going through
the following steps for ﬁnitely many points P on the special ﬁber of C.

(a) Move P to (0, 0).
(b) Scale x by 1/π.
(c) Replace C by the normalization of the resulting model.

As transformations of the form (a) do not change v(x) and have determinant of valua-
tion 0, it suﬃces to prove

v(τ (x)) + v(τ ) ≤ v(x) for all x ∈ KSA

for a transformation τ = σ ◦ ρ, where ρ is as in (b) and σ is as in (c). Note that
such a transformation decreases the valuation of the discriminant, cf. [Liu96, Lemme 9]
and [Liu96, Corollaire 2]. By the discussion following Proposition 4.4, the transformation
ρ maps x ∈ KSA to (πx1, x2, π−1x3, π3x4).
Suppose v(2) = 0 and, without loss of generality, H = 0. According to [Liu96, Remar-
que 2], the normalization can be computed using the transformation σ mapping an aﬃne
point (ξ, η) to σ(ξ, η) = (ξ, ηπ−s) for some nonnegative integer s. As v(τ ) = 3 − 2s, we
must have s ≥ 2, since otherwise τ would increase the valuation of the discriminant.
Because τ (x) = (πx1, x2, π−1x3, π3−2sx4) for x ∈ KSA, we ﬁnd that v(τ (x)) ≤ v(x) + 1,
implying

v(τ (x)) + v(τ ) − v(x) ≤ −2s + 4 ≤ 0 .

The case v(2) > 0 is slightly more complicated. Here one computes the normalization
by repeatedly applying transformations
(ξ, η) (cid:55)→

η + R(ξ, 1)

(11.1)

(cid:19)

,

(cid:18)

ξ,

π

42

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

(cid:1)

where R ∈ O[X, Z] is a certain cubic form, until the minimum of the valuations of the
coeﬃcients of F +RH−R2 is equal to 1. See [Liu96, Remarque 2]. Such a transformation
maps Kummer coordinates x = (x1, x2, x3, x4) to

(cid:0)x1, x2, x3, π−2x4 + l1x1 + l2x2 + l3x3

and the expressions for the li given in Section 4 show that v(li) ≥ −2 for all i. As
the determinant of a transformation (11.1) has valuation −2, we need to apply at least
two such transformations, because otherwise the valuation of the discriminant would
increase. In other words, σ = σs ◦···◦ σ1 where s ≥ 2 and every σi is of the form (11.1).
By the properties of the transformations (11.1), it suﬃces to show the desired inequality
for the case s = 2, since further applications of transformations σi will only make the
left hand side of the desired inequality smaller and will not change the right hand side.
So suppose that σ = σ2 ◦ σ1; then τ = σ ◦ ρ maps x ∈ KSA to

τ (x) =(cid:0)πx1, x2, π−1x3, π−1x4 + πl1x1 + πl2x2 + πl3x3 + πl(cid:48)

2x2 + π−1l(cid:48)

1x1 + l(cid:48)

(cid:1) ,

3x3

where the li arise from σ1 and the l(cid:48)
prove that

i arise from σ2. As v(τ ) = −1, it clearly suﬃces to
v(τ (x)) ≤ v(x) + 1.

(11.2)
But if (11.2) is false, then v(x) = v(x4) < min{v(x1), v(x2) + 1, v(x3) + 2}.
i) ≥ −2 that we get
situation it follows from the lower bounds v(li) ≥ −2 and v(l(cid:48)
3x3

v(cid:0)πl1x1 + πl2x2 + πl3x3 + πl(cid:48)

(cid:1) > v(x4) − 1 .

2x2 + π−1l(cid:48)

1x1 + l(cid:48)

This implies (11.2) and therefore ﬁnishes the proof of the lemma.

In this

(cid:3)

Theorem 11.3. Let C be a smooth projective curve of genus 2 deﬁned over a non-
archimedean local ﬁeld k, given by an integral Weierstrass model C. Then we have

¯β(C) ≤ v(∆(C))

.

4

Proof. By Lemma 5.4 there is a ﬁnite extension k(cid:48)/k such that the minimal proper
regular model of C over k(cid:48) is semistable and such that all minimal Weierstrass models
of C over k(cid:48) are stably minimal. By Corollary 11.1, the claim therefore holds for any
minimal Weierstrass model of C over k(cid:48).
It follows from Lemma 11.2 that there is a transformation τ : C → C(cid:48) deﬁned over k(cid:48)
such that C(cid:48) is a minimal (and hence stably minimal) Weierstrass model over k(cid:48) and
such that

(11.3)
for all x ∈ KSA.
Then by the above we have

v(τ (x)) + v(τ ) ≤ v(x)

µ(τ (x)) ≤ v(∆(C(cid:48)))

4

.

Now using Corollary 4.6 and the relation (4.2), we ﬁnd

µ(x) = µ(τ (x)) − v(x) + v(τ (x)) − v(τ )
− v(x) + v(τ (x)) − v(τ )
− v(x) + v(τ (x)) +

=

4

v(τ )

3
2

≤ v(∆(C(cid:48)))
v(∆(C))
≤ v(∆(C))

4

,

4

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

43

where we have used (11.3) and v(τ ) ≤ 0.
Remark 11.4. When the residue characteristic is not 2, then we can easily show that
¯β(C) is indeed always comparable to v(∆(C)). We can assume that H = 0 and write
F = cF0 with F0 primitive. We consider the points of order 2 on J. Such a point P
is given by a factorization F0 = G1G2 with G1 and G2 primitive of degrees 2 and 4,
respectively. An explicit computation shows that

(cid:3)

ε(P ) = 4v(c) + 2v(R(P )) ,

where R(P ) denotes the resultant of G1 and G2, and we have 4µ(P ) = ε(P ). Since
v(∆(C)) = v(disc(F )) = 10v(c) + v(disc(F0)) and 4v(disc(F0)) is the sum of the valua-
tions of the 15 resultants R(P ), we ﬁnd that

(cid:0)4v(c) + 2v(R(P ))(cid:1) ≥ v(c) +

(cid:88)

¯β(C) ≥ 1
4

max

O(cid:54)=P∈J[2]

1
30

O(cid:54)=P∈J[2]

v(R(P ))

= v(c) +

2
15

v(disc(F0)) ≥ 1
10

v(∆(C)) .

A similar statement should be true when the residue characteristic is 2.
Recall that we denote max{ε(P ) : P ∈ J(¯k)} by ¯γ(C).
Corollary 11.5. Let C be a smooth projective curve of genus 2 deﬁned over a non-
archimedean local ﬁeld k, given by an integral Weierstrass model C. Then we have

If H = 0 and char(k) (cid:54)= 2, then this can be improved to
¯γ(C) ≤ v(2−4∆(C)) .

¯γ(C) ≤ v(∆(C)) .

Proof. The ﬁrst inequality follows from 11.3 and from ε(P ) = 4µ(P ) − µ(2P ). The
(cid:3)
second inequality is Theorem 6.1 of [Sto99].
Question 11.6. If C is a minimal Weierstrass model, does ¯β(C) only depend on the
special ﬁber of Cmin?

Note that the corresponding statement holds for elliptic curves [CPS06]. In our situa-
tion, however, there may be several non-isomorphic minimal Weierstrass models, which
complicates the picture.

44

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Part III: Efficient Computation of Canonical Heights

In this part we show how to compute the canonical height ˆh(P ) eﬃciently for a point P
over a number ﬁeld, global function ﬁeld or more general ﬁeld with a system of absolute
values as in Section 2. We ﬁrst explain how to compute the local height correction
functions. We use M(d) to denote the time needed to multiply two d-bit integers.

12. Computing µ at non-archimedean places

algorithm and show that its running time is (cid:28) (log v(∆)) M(cid:0)(log v(∆))v(∆)(log #k)(cid:1),

In this section, k is a non-archimedean local ﬁeld again, with valuation ring O, uni-
formizer π, normalized valuation v and residue class ﬁeld k. Let C be an integral
Weierstrass model for a genus 2 curve C over k. We make no assumptions on the
reduction type of C. We already discussed a method for the computation of µ(P ) for
a given point P ∈ J(k) in Section 3.
In this section, we provide an alternative fast
where ∆ = ∆(C).
Lemma 12.1. Assume that M is a positive integer such that M µ(P ) ∈ Z. Further
assume that max{ε(P ) : P ∈ J(k)} ≤ B. Then

Proof. This follows from M µ(P ) ∈ Z and from

µ(P ) =

1
M

M

(cid:108)

(cid:98)log(BM/3)/ log(4)(cid:99)(cid:88)
(cid:88)

n=0

0 ≤ M

n≥m

4−n−1ε(2nP ) ≤ BM

3 · 4m .

(cid:109)

4−n−1ε(2nP )

.

(cid:3)

If we know that the reduction is nodal, then we get an upper bound B for ε(P ) and
all possible denominators of µ(P ) from the results of Section 9. More generally, if we
know the smallest positive period N of the sequence (µ(nP ))n, then we can take M = N
(respectively, M = 2N ) if N is odd (respectively, even) by Corollary 3.11. Also note that
we can always take B = v(∆) (or even B = v(2−4∆) if char(k) (cid:54)= 2 and the equation of
the curve has H = 0), see Corollary 11.5.

If we only know an upper bound for the denominator of µ(P ), then the following alter-
native approach can be used. This is analogous to [MS15, Lemma 4.2].
Lemma 12.2. Assume that M ≥ 2 is an integer such that M(cid:48)µ(P ) ∈ Z for some
0 < M(cid:48) ≤ M . Assume in addition that max{ε(P ) : P ∈ J(k)} ≤ B, and set

m =

(cid:107)

.

log 4

(cid:106) log(BM 2/3)
m(cid:88)
(cid:88)

n=0

4−n−1ε(2nP ) .

Then µ(P ) is the unique fraction with denominator ≤ M in the interval [µ0, µ0 + 1/M 2],
where

µ0 =

Proof. Note that

µ0 ≤ µ(P ) ≤ µ0 +

4−n−1B < µ0 + 1/M 2 .

But since M ≥ 2, the interval [µ0, µ0 + 1/M 2] contains at most one fraction with
(cid:3)
denominator bounded by M ; by assumption, µ(P ) is such a fraction.

n>m

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

45

In order to apply Lemma 12.2, we now ﬁnd a general upper bound M on the possible
denominators of µ. Let J denote the N´eron model of J over S = Spec(O) and write Φ
for the component group of J .
Proposition 12.3. Let N denote the exponent of Φ(¯k) and let P ∈ J(k). Then we have

If N is odd or if C has a knr-rational Weierstrass point, then we have

µ(P ) ∈ 1
2N

Z .

µ(P ) ∈ 1
N

Z .

Proof. Let i ∈ {1, . . . , 4} be such that κi(P ) (cid:54)= 0. Recall from Lemma 8.2 that the
is a N´eron function with respect to the divisor Di. As P /∈ supp Di,
function ˆλi = ˆλ◦ κ
we ﬁnd

κi

µ(P ) ≡ ˆλ(x) ≡ ˆλi(P )

(mod Z)

for any set of Kummer coordinates x for P .
and [Lan83, §11.5] that

It follows from the results of [N´er65]

ˆλi(P ) ≡ j(Di, (P ) − (O))

(mod Z) ,

where j( , ) denotes N´eron’s bilinear j-pairing, deﬁned in [N´er65, §III.3].
2N(cid:48) Z, where N(cid:48) = #Φ(¯k) It is
By [N´er65, Prop. III.2], the values of the j-pairing lie in 1
easy to see we can replace N(cid:48) by the exponent N in the proof of [N´er65, Prop. III.2], so
the ﬁrst statement of the proposition follows.
Z if N is odd, again
For the second statement, note that the j-pairing takes values in 1
N
by [N´er65, Prop. III.2] and its proof. If C has a knr-rational Weierstrass point P0, then
the divisor Di is linearly equivalent over knr to 2ΘP0, where ΘP0 is the theta divisor
with respect to P0. The N´eron model does not change under unramiﬁed extensions, and
µ(P ) mod Z does not depend on the Weierstrass model of C by Corollary 4.6. Hence
we can assume that i = 1 and D1 = 2ΘP0, so the linearity of the j-pairing in the ﬁrst
(cid:3)
variable proves the claim.

Remark 12.4. In the notation of Namikawa-Ueno [NU73], the only reduction types for
which Proposition 12.3 does not show that µ(P ) ∈ 1/NZ (where N is the exponent
of Φ(¯k)), are [2III − l] and [2III∗ − l] for l ≥ 0; [2I∗
n − l] for n, l ≥ 0; and [2In − l] for
n > 0 even and l ≥ 0. We have not found an example where µ(P ) /∈ 1/NZ.
We can compute the group Φ(¯k) in practice using [BLR90, §9.6]. For this we need to
know the intersection matrix of the special ﬁber of a regular model of C over S. This
is implemented in Magma, but can be rather slow. If the residue characteristic is not 2,
then we can apply Liu’s algorithm [Liu94] to compute the reduction type and read
oﬀ Φ(¯k).
In general, an upper bound for the exponent of Φ(¯k) suﬃces to apply Lemma 12.2. We
give a bound which only depends on the valuation of the discriminant ∆ = ∆(C).
Lemma 12.5. The exponent of Φ(¯k) is bounded from above by

(cid:26)

(cid:22) v(∆)2

(cid:23)(cid:27)

3

M := max

2,

.

Moreover, the denominator of µ(P ) is bounded from above by M for all P ∈ J(k).

Proof. This follows from a case-by-case analysis, using the list of groups Φ(¯k) from [Liu94,
§8] for all reduction types in [NU73], and Proposition 12.3.
(cid:3)

46

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Remark 12.6. By going through all reduction types, it is possible to obtain better upper
bounds for the denominator M(cid:48) of µ(P ) from the Igusa invariants discussed in Section 6.
First note that if the special ﬁber of C is non-reduced, then we have
(i) M(cid:48) ≤ 4 if v(∆) ≤ 12;
(ii) M(cid:48) ≤ max{12, v(∆) − 15} otherwise.
Suppose that C is reduced; then, by Proposition 6.2, we can use the Igusa invariants of
the special ﬁber to distinguish between the multiplicities of its singularities.
(i) If all points on the special ﬁber of C have multiplicity at most 2, then we can bound

(ii) If there is a point of multiplicity 3 on the special ﬁber, then we have

M(cid:48) using Proposition 6.3 (i–iii) and Propositions 9.1, 9.3, 9.4.
• M(cid:48) ≤ min{6, v(∆) + 1} if v(∆) ≤ 10;
• M(cid:48) ≤ 12, if v(∆) ≤ 20;

• M(cid:48) ≤(cid:106) (v(∆)−12)2
• M(cid:48) ≤(cid:106) (v(∆)−10)2

4

(cid:107)
(cid:107)

otherwise.

(iii) If there is a point of multiplicity ≥ 4 on the special ﬁber, then we have

• M(cid:48) ≤ 3v(∆) − 10 if v(∆) ≤ 10;
• M(cid:48) ≤ 4v(∆) − 20 if v(∆) > 10 and the model is minimal;

3

if the model is not minimal.

The results of this section lead to an eﬃcient algorithm for the computation of µ(P ),
which is analogous to Algorithm 4.4 of [MS15]. We assume that the coeﬃcients of F
and H and the coordinates of P are given to suﬃcient v-adic precision (in practice, they
will be given exactly as elements of a number ﬁeld or function ﬁeld).
1. If char(k) (cid:54)= 2 and H = 0, set B := v(2−4∆). Otherwise, set B := v(∆).
3. Set m := (cid:98)log(BM 2/3)/ log(4)(cid:99).
4. Set µ0 := 0. Let x be normalized Kummer coordinates for P with (m+1)B +1 v-adic

2. Set M := max(cid:8)2,(cid:98)v(∆)2/3(cid:99)(cid:9).

5. For n := 0 to m do:

digits of precision.
a. Compute x(cid:48) := δ(x) (to (m + 1)B + 1 v-adic digits of precision).
b. If v(x(cid:48)) = 0, then return µ0.
c. Set µ0 := µ0 + 4−n−1v(x(cid:48)).
d. Set x := π−v(x(cid:48))x(cid:48)

6. Return the unique fraction with denominator at most M in the interval between µ0

and µ0 + 1/M 2.

The fraction in the ﬁnal step can be computed easily, for instance using continued
fractions.
For the complexity analysis in the following proposition, we assume that elements of O
are represented as truncated power series in π, whose coeﬃcients are taken from a
complete set of representatives for the residue classes. Operations on these coeﬃcients
can be performed in time (cid:28) M(log #k).

Proposition 12.7. The algorithm above computes µ(P ). Its running time is

(cid:28) (log v(∆)) M(cid:0)(log v(∆))v(∆)(log #k)(cid:1)

as v(∆) → ∞, with an absolute implied constant.

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

47

Proof. The following proof is analogous to the proof of [MS15, Prop. 4.5]. Corollary 11.5
shows that B is a suitable upper bound for ε and Lemma 12.5 shows that M is an upper
bound for the denominator of µ. Because M ≥ 2, the loop in step 5 computes the sum
in Lemma 12.2. Note that when v(x(cid:48)) = 0 in step 5b, then µ(P ) = µ0 by Theorem 3.10.
At each duplication step, the precision loss is ε(2nP ) ≤ B, so that with our choice of
starting precision, after the m + 1 steps in the loop the resulting x still has at least one
digit of precision. This proves the correctness of the algorithm.

Clearly the running time of the algorithm is dominated by the running time of the loop
in step 5. Step 5a consists of a ﬁxed number of additions and multiplications of elements
of O which are given to a precision of (m + 1)B + 1 digits. Because steps 5b–5d take
negligible time compared to step 5a, each pass through the loop takes

operations, leading to a total running time that is

(cid:28) M(cid:0)((m + 1)B + 1)(log #k)(cid:1)
(cid:28) (m + 1) M(cid:0)((m + 1)B + 1)(log #k)(cid:1)
(cid:28) (log v(∆)) M(cid:0)(log v(∆))v(∆)(log #k)(cid:1)

(cid:28) m M(mB(log #k))

as v(∆) → ∞. Here we use that B (cid:28) v(∆) and M (cid:28) v(∆)2, so that m (cid:28) log v(∆). (cid:3)

Remark 12.8. In step 2, we can use Remark 12.6 to compute a sharper upper bound
for the denominator of µ. See also the discussion following Remark 12.4. Of course, if
we want to ﬁnd µ(P ) for several points P , the quantities M, B and m only have to be
computed once.

Remark 12.9. We can compute µ(P ) using the algorithm above in more general situ-
ations. Suppose that k is any discretely valued ﬁeld with valuation ring O and uni-
formizer π. In that case, the sequence (µ(nP ))n might not have a ﬁnite period, so the
method for the computation of µ(P ) discussed in Section 3 might not be applicable.
However, Lemma 12.1, Lemma 12.2, Proposition 12.3 and Lemma 12.5 remain valid.
If char(k) (cid:54)= 2 and if H = 0, then we have the upper bound ε(P ) ≤ v(2−4∆) (cf. Re-
mark 3.2), so the algorithm above can be used and Proposition 12.7 remains valid as
well, in the sense that the computation can be done using (cid:28) log v(∆) operations with
elements of O/πnO, where n (cid:28) v(∆) log v(∆). In the remaining cases, we can compute
an upper bound B on ε as in Remark 3.2, and we can apply the algorithm with this
choice of B.

13. Computing µ at archimedean places

In this section, k is an archimedean local ﬁeld, so k = R or k = C. We assume
that the curve C is given by a Weierstrass equation C with H = 0. In the following,
log+ x = max{0, log x}.
Let x ∈ k4 be a set of Kummer coordinates. Recall that

˜ε(x) = −[k : R] (log (cid:107)δ(x)(cid:107)∞ − 4 log (cid:107)x(cid:107)∞)

and

˜µ(x) =

4−n−1 ˜ε(δ◦n(x)) .

∞(cid:88)

n=0

48

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

We easily obtain a lower bound for ˜ε using the standard estimate for (cid:107)δ(x)(cid:107)∞. Since
the coeﬃcients of the duplication polynomials δj are universal polynomials of degree at
most 4 in the coeﬃcients of F , this gives

−˜ε (cid:28) 1 + log+ (cid:107)F(cid:107)∞ ,

where (cid:107)F(cid:107)∞ is the maximum norm of the coeﬃcient vector of F . We recall that the
method described in Section 7 of [Sto99], leading to equation (7.1) there, provides an
upper bound ˜γ for ˜ε that can be explicitly computed for any given Weierstrass equation C
of the curve (provided H = 0). It is given by

 (cid:88)

{S,S(cid:48)}

(cid:118)(cid:117)(cid:117)(cid:116) 4(cid:88)

2

˜γ = log max

i

≤ log 400 + 2 log max
i,{S,S(cid:48)}

|ai,{S,S(cid:48)}|

|b{S,S(cid:48)},j|
|ai,{S,S(cid:48)}| + log max
{S,S(cid:48)},j

j=1

|b{S,S(cid:48)},j|

with certain numbers ai,{S,S(cid:48)}, b{S,S(cid:48)},j, where i, j ∈ {1, 2, 3, 4} and {S, S(cid:48)} runs through
the ten partitions of the set of roots of F into two sets of three. Using the formulas
in [Sto99, §10] and Mignotte’s bound (see for example [vzGG99, Cor. 6.33]), we see that

log max
{S,S(cid:48)},j

|b{S,S(cid:48)},j| (cid:28) 1 + log+ (cid:107)F(cid:107)∞

and

log max
i,{S,S(cid:48)}

|ai,{S,S(cid:48)}| (cid:28) 1 + log+ (cid:107)F(cid:107)∞ + log+ max
{S,S(cid:48)}

|R(S, S(cid:48))|−1 ,

where R(S, S(cid:48)) is the resultant of the two factors G, G(cid:48) of F corresponding to the
partition of the roots. Using Mignotte’s bound again, we ﬁnd that

(cid:112)| disc G|| disc G(cid:48)|
(cid:112)| disc F|

|R(S, S(cid:48))|−1 =

(cid:28) (cid:107)F(cid:107)2∞|∆(C)|−1/2 ,

leading ﬁnally to the estimate

|˜ε| (cid:28) 1 + log+ (cid:107)F(cid:107)∞ + log+ |∆(C)|−1 =: s(F ) .

If |˜ε(x)| ≤ ˜η for all x ∈ KSA, then we have

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:88)
(cid:24) d

n≥N

2

N =

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12) ≤ ˜η

3

4−n−1 ˜ε(δ◦n(x))

4−N ,

(cid:25)

+

log(˜η/3)

log 4

(cid:28) d + log s(F )

so we need to sum the ﬁrst

terms to obtain an accuracy of 2−d. Comparing the largest term in any of the δj and
the lower bound on (cid:107)δ(x)(cid:107)∞, we obtain a bound ˜θ on the loss of relative precision (in
terms of bits) in the computation of δ(x); we have ˜θ (cid:28) s(F ). To achieve the desired
precision at the end, we therefore need to compute with an initial precision of

bits. The time needed for each duplication is then

d + 1 + N ˜θ (cid:28) (d + log s(F ))s(F )

(cid:28) M(cid:0)(d + log s(F ))s(F )(cid:1) .

A logarithm can be computed to d bits of precision in time (cid:28) (log d) M(d) by one of
several quadratically converging algorithms, see for example [BB98, Chapter 7], so we
obtain the following result.

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

49

Proposition 13.1. Given Kummer coordinates x of a point P in J(k) (or KS(k)) to
suﬃcient precision, we can compute ˜µ(P ) to an accuracy of d bits in time

(cid:28)(cid:0)d + log s(F )(cid:1)(log d) M(cid:0)(d + log s(F ))s(F )(cid:1) ,

where

s(F ) = 1 + log+ (cid:107)F(cid:107)∞ + log+ |∆(C)|−1 .

In the applications k will be the completion of a number ﬁeld at a real or complex place.
If the number ﬁeld is Q and the given equation C of C is integral, then |∆(C)| ≥ 1 and
we have s(F ) = 1 + log (cid:107)F(cid:107)∞ = 1 + h(F ), where h(F ) denotes the (logarithmic) height
of the coeﬃcient vector of F as a point in aﬃne space. In general, we have the estimate
(denoting the value of s(F ) for a place v by sv(F ))

(cid:88)

v|∞

sv(F ) ≤ [K : Q] +

(cid:88)

v|∞

(cid:88)

v|∞

log+ (cid:107)F(cid:107)v +

log+ |∆(C)|−1

v

≤ [K : Q] + h(F ) + h(∆(C)) (cid:28) h(F )

for h(F ) large. This implies that we can compute the inﬁnite part of the height correction
function in time

(cid:28)(cid:0)d + log h(F )(cid:1)(log d) M(cid:0)(d + log h(F ))h(F )(cid:1) ,

which is polynomial in d and h(F ).

14. Computing the canonical height of rational points

The ﬁrst algorithm for computing the canonical height on a genus 2 Jacobian over Q was
introduced by Flynn and Smart [FS97]. It does not require any integer factorization,
but can be impractical even for simple examples, see the discussion in [Sto02, §1]. A
more practical algorithm was introduced by the second author in [Sto02]; here the local
height correction functions are computed separately, so some integer factorization is
required. Uchida [Uch11] later introduced a similar algorithm. De Jong and the ﬁrst
author [dJM14] used division polynomials for a diﬀerent approach.

Building on the Arakelov-theoretic Hodge index theorem for arithmetic surfaces due
to Faltings and Hriljac, Holmes [Hol12] and the ﬁrst author [M¨ul14] independently
developed algorithms for the computation of canonical heights of points on Jacobians of
hyperelliptic curves of arbitrary genus over global ﬁelds. While these algorithms can be
used to compute canonical heights for genus as large as 10 (see [M¨ul14, Example 6.2]),
they are much slower than the algorithm from [Sto02] when the genus is 2.

In this section we now combine the results of Sections 12 and 13 into an eﬃcient al-
gorithm for computing the canonical height of a point on the Jacobian of a curve of
genus 2 over a global ﬁeld K.

When K is a function ﬁeld, then there are no archimedean places and factorization is
reasonably cheap. So in this case, the best approach seems to be to ﬁrst ﬁnd the places v
of K such that µv(P ) is possibly non-zero (this includes the places at which the given
equation of the curve is non-integral) and then compute the corrections µv(P ) for each
place separately as in the algorithm of Proposition 12.7, if necessary changing ﬁrst to an
integral model and correcting for the transformation afterwards. In fact this approach
can be used whenever K is a ﬁeld with a set of absolute values that satisfy the product
formula, because the algorithm before Proposition 12.7 is applicable over any discretely
valued ﬁeld, see Remark 12.9. This includes function ﬁelds such as Q(t) and C(t).

50

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

If K is a number ﬁeld, then we compute the contribution from the archimedean places as
described in Section 13. The ﬁnite part of our algorithm is analogous to our quasi-linear
algorithm for the computation of the ﬁnite part of the canonical height of a point on an
elliptic curve in [MS15]; see Proposition 14.3 below. For simplicity, we take K to be Q
in the following. We write εp and µp for the local height correction functions over Qp as
given by Deﬁnition 3.1 and ˜µ∞ for the local height correction function over R as deﬁned
in equation (1.1).
We assume that our curve is given by a model C : Y 2 = F (X, Z) with F ∈ Z[X, Z], and
we set ∆ = ∆(C). Our goal is to devise an algorithm for the computation of ˆh(P ) that
runs in time polynomial in log (cid:107)F(cid:107)∞, h(P ) and the required precision d (measured in
bits after the binary dot). We note that h(P ) can be computed in time

(cid:28) log(h(P ) + d) M(h(P ) + d) ,

since it is just a logarithm. By Proposition 13.1, the height correction function ˜µ∞(P )
can be computed in polynomial time. So we only have to ﬁnd an eﬃcient algorithm for

the computation of the ‘ﬁnite part’ ˜µf(P ) :=(cid:80)

p µp(P ) log p of the height correction.

Fix P ∈ J(Q). We call a set x of Kummer coordinates for P primitive if x ∈ Z4
and gcd(x) = 1. We set gn = gcd(δ(x(n))), where x(n) is a primitive set of Kummer
coordinates for 2nP . Then

˜µf(P ) =

4−n−1 log gn .

∞(cid:88)

n=0

(cid:23)

We also know by [Sto99] that gn divides D = |∆|/24 = 24| disc(F )|, which implies that
log gn ≤ log D for all n. To achieve a precision of 2−d, it is therefore enough to take the
sum up to

n = m :=

+ log

log D

3

(cid:28) d + log log D (cid:28) d + log log (cid:107)F(cid:107)∞ .

(cid:22) d

2

Since at each duplication step, we have to divide by gn to obtain primitive coordinates
again, it suﬃces to do the computation modulo Dm+2. This leads to the following
algorithm.
1. Let D = |∆|/16 and set m := (cid:98)d/2 + log log D − log 3(cid:99).
2. Let x be primitive Kummer coordinates for P .
3. Set µ := 0.
4. For n := 0 to m do:

a. Compute x(cid:48) := δ(x) mod Dm+2.
b. Set gn := gcd(D, gcd(x(cid:48))) and x := x(cid:48)/gn.
c. Set µ := µ + 4−n−1 log gn (to d bits of precision).

5. Return ˜µf(P ) ≈ µ.
Proposition 14.1. This algorithm computes ˜µf(P ) to d bits of precision in time

(cid:28) (d + log log D) M(cid:0)(d + log log D) log D(cid:1) + h(P ) .

Proof. The discussion preceding the algorithm shows that it is correct. The duplication
in step 4a and the gcd in step 4b can be computed in time

(cid:28) M((m + 2) log D) (cid:28) M((d + log log D) log D) ;

the division is even faster, since gn is small. The computation of the logarithm takes
time (cid:28) log(d + log D) M(d + log D); this is dominated by the time for duplication. This
gives a time complexity of

(cid:28) (d + log log D) M(cid:0)(d + log log D) log D(cid:1) + h(P ) ,

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

51

(cid:3)
where the last term comes from processing the input x.
Note that log D (cid:28) log (cid:107)F(cid:107)∞, so this bound is similar to (and even better by a factor
of log d than) the complexity for computing ˜µ∞(P ).
Remark 14.2. We note that an alternative way to proceed is to compute x(cid:48) = δ◦(m+1)(x)
mod Dm+2 (without dividing out gcd’s in between) and then use µ = 4−m−1 log gcd(x(cid:48)).
The advantage of the algorithm above is that we can actually work mod Dm+2−n, which
makes the computation more eﬃcient. The advantage of the alternative is that it can
also be used when working over a number ﬁeld with non-trivial class group (replacing
log gcd(x(cid:48)) by the logarithm of the ideal norm of the ideal generated by x(cid:48)). The resulting
complexity is similar, with the implied constant depending on the base ﬁeld.

We now show that we can in fact do quite a bit better than this, by using the strat-
egy already employed in [MS15]. Note that ˜µf(P ) is a rational linear combination of
logarithms of positive integers. We can compute such a representation exactly and eﬃ-
ciently by the following algorithm. We again assume that x is a set of primitive Kummer
coordinates for P .
1. Set x(cid:48) := δ(x), g0 := gcd(x(cid:48)) and x := x(cid:48)/g0.
2. Set D := gcd(24 disc(F ), g∞
3. If B ≤ 1, return 0.

0 ) and B := (cid:98)log D/ log 2(cid:99).

4. For n := 1 to m do:

Otherwise, set M := max{2,(cid:98)(B + 4)2/3(cid:99)} and m := (cid:98)log(B3M 2/3)/ log 4(cid:99).
a. Compute x(cid:48) := δ(x) mod Dm+1g0.
b. Set gn := gcd(D, gcd(x(cid:48))) and x := x(cid:48)/gn.

5. Using the algorithm in [DJB04] (or in [DJB05]), compute a sequence (q1, . . . , qr) of
pairwise coprime positive integers such that each gn (for n = 0, . . . , m) is a product

of powers of the qi: gn =(cid:81)r
a. Compute a :=(cid:80)m
7. Return(cid:80)r

6. For i := 1 to r do:

i=1 qei,n
n=0 4−n−1ei,n.

i

.

b. Let µi be the simplest fraction between a and a + 1/(B2M 2).

i=1 µi log qi (a formal linear combination of logarithms).
Proposition 14.3. The preceding algorithm computes ˜µf(P ) in time
(cid:28) (log log D) M((log log D)(log D)) + M(h(P )) .

Note that D ≤ |∆|/16 and log D (cid:28) log (cid:107)F(cid:107)∞.
Proof. If B ≤ 1 in step 3, then we either have g0 = 1 and ˜µf(P ) = 0, or we have
D ∈ {2, 3}. In the latter case, g0 is a power of p = 2 or 3 and vp(∆) = 1, which would
imply that εp(P ) = 0 by [Sto02, Prop. 5.2], so g0 = 1, and we get a contradiction.

If a prime p does not divide g0, then εp(P ) = 0, implying µp(P ) = 0. Suppose now
that p divides g0; then we have vp(D) ≤ B and vp(∆) ≤ B + 4, so B, M and m are
suitable values for Lemma 12.2. We have vp(gn) = εp(2nP ) for all n ≤ m, because
p(m+1)vp(D)+1 | Dm+1g0 (compare the proof of Proposition 12.7). All the gn are power
products of the qi, so there will be exactly one i = i(p) ∈ {1, . . . , r} such that p | qi(p).

Setting bp = vp(qi(p)) and a =(cid:80)m

n=0 4−n−1ei(p),n, we have

m(cid:88)

m(cid:88)

4−n−1εp(2nP ) =

4−n−1vp(gn) = bpa ,

n=0

n=0

52

implying

µp(P ) =

∞(cid:88)

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

∞(cid:88)

4−n−1εp(2nP ) = bpa +

4−n−1εp(2nP ) .

n=0

n=m+1

r(cid:88)

(cid:88)

p|qi

r(cid:88)

i=1

Here the last sum is in [0, 1/(B2M 2)] by the deﬁnition of m (compare the proof of
Lemma 12.2). Therefore

a ≤ µp(P )/bp ≤ a + 1/(bpB2M 2) ≤ a + 1/(B2M 2) .

Since the denominator of µp(P ) is at most M and since we have bp ≤ vp(D) ≤ B, the
denominator of µp(P )/bp is at most BM . Hence µp(P )/bp is the unique fraction in
[a, a + 1/(B2M 2)] with denominator bounded by BM , so µp(P )/bp = µi(p) by Step 6b.

Now (cid:88)

(cid:88)

µp(P ) log p =

µi(p)bp log p =

µi

bp log p =

µi log qi ,

p

p

i=1

so the algorithm is correct.

negligible time. Each pass through the loop in step 4 takes time (cid:28) M(cid:0)(m + 2) log D(cid:1),

The complexity analysis is as in the proof of [MS15, Prop. 6.2]. Namely, the computa-
tions in step 1 can be done in time (cid:28) M(h(P )). The computations in steps 2 and 3 take
so the total time for step 4 is (cid:28) m M(m(log D)) (cid:28) (log log D) M((log log D)(log D)),
because m (cid:28) log log D. The coprime factorization algorithm in [DJB04] (or in [DJB05])
computes suitable qi for a pair (a, b) of positive integers in time (cid:28) (log ab)(log log ab)2.
We iterate this algorithm, applying it ﬁrst to g0 and g1, then to each of the resulting
qi and g2, and so on. There are always (cid:28) log D terms in the sequence of qi’s and we
have gn ≤ D for all n. Hence step 5 takes time (cid:28) log D(log log D)3. Because this is
dominated by the time for the loop and because the remaining steps take negligible
(cid:3)
time, the result follows.

Note that the complexity of the algorithm above is quasi-linear in log D and h(P ). In
practice, the eﬃciency of this approach can be improved somewhat:
• We can split oﬀ the contributions of all suﬃciently small primes p by choosing a
suitable bound T and trial factoring ∆ up to T ; the corresponding µp can then be
computed using the algorithm of Proposition 12.7; see also Remark 12.8. In step 3, we
can then set B := (cid:98)log D(cid:48)/ log T(cid:99), where D(cid:48) is the unfactored part of D, and replace
B + 4 by B in the deﬁnition of M . If the coeﬃcients of F are suﬃciently large, then
this trial division can become quite expensive (even for small values of T ). So when
h(F ) is large, it is usually preferable to avoid trial division altogether.
• We can update the qi after each pass through the loop in step 4 using the new gn; we
can also do the computation in step 4a modulo suitable powers of the qi instead of
modulo Dm+1g0. Moreover, it is possible to use separate values of B, M and m for
each qi; these will usually be smaller than the one computed in step 2 and 3. In this
way, we can integrate steps 4, 5 and 6 into one loop.

Remark 14.4. Over a more general number ﬁeld K in place of Q the algorithm as stated
does not quite work, since we cannot always divide out greatest common divisors. In this
case we ﬁrst compute x(1) = δ(x) and the ideal g0 generated by D and the entries of x(1).
Then we compute x(2) = δ(x(1)), . . . , x(m+1) = δ(x(m)) modulo the ideal Dm+1g0. Let
Gj be the ideal generated by the entries of x(j) and Dm+1 and set

g1 = g−4

0 G2,

g2 = G−4

2 G3,

g3 = G−4

3 G4,

. . . ,

gm = G−4

m Gm+1 .

The coprime factorization algorithms in [DJB04] and [DJB05] also work for ideals. In
the ﬁnal result, log qi has to be replaced by log N (qi), where N (qi) is the norm of the

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

53

ideal qi. This should result in a complexity similar to that over Q (with the implied
constant depending on K), or at least one that is dominated by the complexity of
computing the naive height and the contributions from the archimedean places. Un-
fortunately, no complexity analysis for standard operations with ideals in number ﬁelds
seems to be available in the literature; this prevents us from making a precise statement.
Alternatively, we can take the approach described in Remark 14.2.

Combining this with the results for archimedean places, we obtain an eﬃcient algorithm
for computing the canonical height ˆh(P ) of a point P ∈ J(Q). As mentioned above, we
expect a similar result to hold for any number ﬁeld K in place of Q, with the implied
constant depending on K.
Theorem 14.5. Let C be given by the model Y 2 = F (X, Z) with F ∈ Z[X, Z] and let
P ∈ J(Q) be given by primitive Kummer coordinates x (i.e., the coordinates are coprime
integers). We can compute ˆh(P ) to d bits of precision in time

(cid:28) log(d+h(P )) M(d+h(P ))+(d+log log (cid:107)F(cid:107)∞)(log d) M(cid:0)(d+log log (cid:107)F(cid:107)∞) log (cid:107)F(cid:107)∞(cid:1) .

Proof. The ﬁrst term comes from computing h(P ). The second term is the complexity
bound for ˜µ∞(P ) from Proposition 13.1. The complexity of computing ˜µf(P ) using the
algorithm of Proposition 14.3 is dominated by their sum, since we have D ≤ |∆|/16 and
log D (cid:28) log (cid:107)F(cid:107)∞.
(cid:3)
Note that the complexity is quasi-linear in log (cid:107)F(cid:107)∞ and in h(P ), and quasi-quadratic
in d. The latter is caused by the (only) linear convergence of the computation of ˜µ∞(P ).
For elliptic curves one can use a quadratically convergent algorithm due to Bost and
Mestre [BM93], see also [MS15]; such an algorithm in the genus 2 case would lead to a
complexity that is quasi-linear in d as well.

In Section 15 below we illustrate the eﬃciency of our algorithm by applying it to a
family of curves and points with the property that the number g0 above is large, so that
the previously known algorithms have problems factoring it.

15. Examples

We have implemented our algorithm using the computer algebra system Magma [BCP97].
For the factorization into coprimes we have implemented a simple quadratic algorithm
due to Buchmann and Lenstra [BL94, Prop. 6.5] instead of the quasi-linear, but more
complicated, algorithms of [DJB04] or [DJB05]

Since the estimates for the required precision in the computation of the archimedean
contribution as given in Section 13 are too wasteful in practice, we instead compute this
contribution repeatedly using a geometrically increasing sequence of digits of precision
until the results agree up to the desired number of bits.

We now compare our implementation with Magma’s built-in CanonicalHeight (ver-
sion 2.21-2), which is based on [FS97] and the second author’s paper [Sto02], for a
family of genus 2 curves. In CanonicalHeight, the duplication on the Kummer surface
is done using arithmetic over Q, making the implementation slow when points with large
coordinates show up during the computation. No factorization of the discriminant is
required. However, to ﬁnd a set of primes such that µp(P ) (cid:54)= 0 for every prime p not in
the set, CanonicalHeight factors the integer gcd(δ(x)), where x are primitive Kummer
coordinates for P .

54

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

y2 = x5 + a2x + a2 .

Example 15.1. For an integer a (cid:54)= 0, consider the curve Ca of genus 2 deﬁned by the
integral Weierstrass model
Let Ja denote the Jacobian of Ca. Then the point P = [((0, a)) − (∞)] ∈ Ja(Q) is
non-torsion. A set of primitive Kummer coordinates is given by x = (0, 1, 0, 0) and we
have δ(x) = (4a2, 0, 0, a4). Hence CanonicalHeight needs to factor a2.
Consider a = 5807658604988570942160367122286824505787920190639678196072209904446815339845301407936102
37063603282, with partial factorization 2· 7· 643· 804743· a(cid:48), where a(cid:48) has 89 decimal digits,
and its smallest prime factor has 34 decimal digits. Our implementation computes ˆh(P )
in 0.51 seconds, whereas Magma’s CanonicalHeight needs about 15 minutes.
Next, we look at a = 200403772956059488950289789507853617719701760528626768445669337185652379002740
2225238543540575431528468305556200069359999066088091821746622820780762863572550314577271857779581968920 .
This factors as a = 23 · 5 · 17 · a(cid:48), where a(cid:48) has 178 decimal digits and no prime divisor
with less than 50 decimal digits. Here, our implementation took 1.04 seconds to compute
ˆh(P ), whereas Magma did not terminate in 8 weeks.
For a = p · q, where p (respectively, q) is the smallest prime larger than 10200 (re-
spectively, 10250), the canonical height of P was computed in 5.87 seconds using our
implementation.
For the computations in these examples, we used a single core Xeon CPU E7-8837 having
2.67GHz. All heights were computed to 30 decimal digits of precision.
We conclude this part with an example over the rational function ﬁeld Q(t).
Example 15.2. Consider the curve C/Q(t) given by the equation

y2 = x6 − 2t(t + 1)x5 + (t + 1)(t3 − 5t2 + 4t − 2)x4 + 2t(t + 1)2(3t2 + 1)x3

It has the points

− (t + 1)(3t4 − 2t2 + 4t − 1)x2 − 4t2(t + 1)3(t2 + 2t − 1)x + 4t4(t + 1)4 .

P1 = (1 : 1 : 0), P2 =(cid:0)0,−2t2(t + 1)2(cid:1), P3 =(cid:0)t + 1, 2t(t − 1)(t + 1)(cid:1)

(and also points with x-coordinate t(t + 1) and a Weierstrass point (−t − 1, 0)). Let
Q = [(P1) − 2(P2) + (P3)] ∈ J(Q(t)). Its image on the Kummer surface has coordinates

(1 : −t + 1 : −2t2(t + 1) : 0) .

Applying the duplication polynomials and looking at the gcd of the result, we see that
we have to compute the height correction functions at the places given by t = 0, t = 1
and t = −1. We also have to consider the place at inﬁnity, since our model of C is not
integral there. We use the algorithms of Section 12. Consider the place t = 0. From
the valuations of the Igusa invariants (see Section 6) we can deduce that the reduction
type is [I7−3−2], which gives us M = 41 for the exponent of the component group and
a bound B = 10 for ε. We follow Lemma 12.1 and compute

µ0(Q) =

1
41

41

4−n−1ε0(2nQ)

=

1
41

41

+

4
42 +

7
43 +

6
44

=

98
41

.

At t = 1, the model is not stably minimal. We can deduce from the Igusa invariants
that there is a stably minimal model over an extension of ramiﬁcation index 4, which
has reduction type [I12−2−2]. This shows that the denominator of µ1 is divisible by
4 · 26 = 104. With M = 104 and B = 9 we get m = 4 in Lemma 12.1; we obtain

µ1(Q) =

1
104

104

4−n−1ε1(2nQ)

=

1
104

104

+

4
42 +

3
43 +

2
44 +

2
45

=

17
13

.

(cid:108)

3(cid:88)

n=0

(cid:108)

4(cid:88)

n=0

(cid:109)

(cid:108)

(cid:16) 8

4

(cid:109)

(cid:108)

(cid:16) 4

4

(cid:17)(cid:109)

(cid:17)(cid:109)

(cid:108)

4(cid:88)

n=0

(cid:109)

(cid:108)

(cid:16) 7

4

(cid:17)(cid:109)

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

55

At t = −1, the situation is similar. There is a stably minimal model over an extension
with ramiﬁcation index 4 again, which has reduction type [I20−0−0]. This leads to
M = 4 · 20 = 80 and B = 20, so m = 4, and

µ−1(Q) =

1
80

80

4−n−1ε−1(2nQ)

=

1
80

80

+

10
42 +

8
43 +

10
44 +

8
45

=

51
20

.

Finally, at the inﬁnite place, there is a stably minimal integral model over an extension
with ramiﬁcation degree 2, which has reduction type [I8−0−0]. In a similar way as for
t = −1 and taking into account a shift of −8 coming from making the model integral,
we obtain µ∞(Q) = 19/4 − 8 = −13/4. This results in
ˆh(Q) = h(Q) − µ0(Q) − µ1(Q) − µ−1(Q) − µ∞(Q) = 3 − 98
41
To our best knowledge, the point Q is the point of smallest known nonzero canonical
height on the Jacobian of a curve of genus 2 over Q(t). The curve was found by Andreas
K¨uhn (a student of the second author) in the course of a systematic search for curves
with many points mapping into a subgroup of rank 1 in the Jacobian.

− 17
13

− 51
20

11
5330

.

13
4

+

=

˜ε(P ) = − log

max{|δ1(x1, x2, x3, x4)|, . . . ,|δ4(x1, x2, x3, x4)|}

max{|x1|,|x2|,|x3|,|x4|}4

,

56

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

Part IV: Efficient Search for Points With Bounded Canonical

Height

16. Bounding the height difference at archimedean places

We now describe two approaches for getting a better upper bound ˜β on ˜µ than the one
coming from the bound on ˜ε given in [Sto99, Equation (7.1)], when k is an archimedean
local ﬁeld and C/k is a smooth projective curve of genus 2, given by a Weierstrass
equation Y 2 = F (X, Z) in PK(1, 3, 1).
We write (cid:107)x(cid:107)∞ = max{|x1|,|x2|,|x3|,|x4|} for the maximum norm.

16.1. Bounding ˜ε closely.
For the ﬁrst approach we assume that k = R. We describe how to approximate
max{˜ε(P ) : P ∈ J(R)} to any desired accuracy, which gives us an essentially optimal
bound ˜γ. Recall that

where (x1 : x2 : x3 : x4) is the image of P ∈ J(R) on the Kummer surface. We can
normalize the Kummer coordinates in such a way that (cid:107)x(cid:107)∞ = 1 and one of the coordi-
nates is 1. We then have to minimize max{|δ1|, . . . ,|δ4|} over four three-dimensional unit
cubes, restricted to the points on the Kummer surface that are in the image of J(R).
This means that the relevant points satisfy the equation deﬁning the Kummer surface
and in addition the value of (at least) one of four further auxiliary polynomials is pos-
itive. (In general, the values of these polynomials are squares if the point comes from
the Jacobian, and the converse holds for any one of the polynomials when its value is
non-zero. One can choose four such polynomials in such a way that they do not vanish
simultaneously on the Kummer surface.)

The idea is now to successively subdivide the given cubes. For each small cube, we check
if it may contain points in the image of J(R), by evaluating the various polynomials at
the center of the cube and bounding the gradient on the cube. If it can be shown that
the deﬁning equation cannot vanish on the cube or that one of the auxiliary polynomials
takes only negative values on the cube, then the cube can be discarded. Otherwise, we
ﬁnd upper and lower estimates for max{|δ1|, . . . ,|δ4|} in a similar way.
If the lower
bound is larger than our current best upper bound for the minimum, the cube can also
be discarded. (At the beginning, we have a trivial upper bound of 1 for the minimum,
coming from the origin.) Otherwise, we keep it and subdivide it further. We continue
until the diﬀerence of the upper and lower bounds for ˜ε on the cube with the smallest
lower bound for max{|δ1|, . . . ,|δ4|} becomes smaller than a speciﬁed tolerance. The
upper bound for ˜ε on that cube is then our bound ˜γ, and we take (as before) ˜β = ˜γ/3.

We have implemented this approach in Magma [BCP97]. After a considerable amount
of ﬁne-tuning, our implementation usually takes a few seconds to produce the required
bound. In many cases the new bound, which is essentially optimal as a bound on ˜ε, is
considerably better than the bound of [Sto99, (7.1)], but there are also cases for which
it turns out that the old bound is actually pretty good.

We used the following tricks to get the implementation reasonably fast.
• We keep the polynomials shifted and rescaled so that the cube under consideration is

[−1, 1]3.

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

57

cients and matrices) and not using polynomial arithmetic.

• The shifting and scaling is done using linear algebra (working with vectors of coeﬃ-
• The coordinates of the centers and vertices of all cubes are dyadic fractions. We scale
everything (by 24 = 16 at each subdivision step — note that the polynomials involved
are of degree 4) so that we can compute with integers instead.

16.2. Iterating Stoll’s bound.

We now describe a diﬀerent approach that also works for complex places. Instead of
trying to get an optimal bound on ˜ε, we aim at a bound on ˜µ by iterating the bound
obtained from equation (7.1) in [Sto99]. We recall how this bound was obtained. There
is an elementary abelian group scheme G of order 32 that maps onto J[2] and acts on the
space of quadratic forms in the coordinates of the P3 containing the Kummer surface.
This representation splits into a direct sum of ten one-dimensional representations that
correspond to the ten partitions {S, S(cid:48)} of the set of ramiﬁcation points of the double
cover C → P1 into two sets of three. We write y{S,S(cid:48)} for suitably normalized generators
of these eigenspaces ([Sto99] gives explicit formulas in the case H = 0). We can then
express the squares x2

i as linear combinations of these quadratic forms:

(cid:88)

{S,S(cid:48)}

x2
i =

ai,{S,S(cid:48)}y{S,S(cid:48)}(x)

for certain complex numbers ai,{S,S(cid:48)} that can be explicitly determined. On the other
hand, y2{S,S(cid:48)} is a quartic form invariant under the action of J[2] (the representation
of G on quartic forms descends to a representation of J[2]) and is therefore a linear
combination of the duplication polynomials δj and the quartic deﬁning the Kummer
surface. So there are complex numbers b{S,S(cid:48)},j that can also be explicitly determined
such that

y{S,S(cid:48)}(x)2 =

b{S,S(cid:48)},jδj(x)

 (cid:88)

{S,S(cid:48)}

if x is a set of Kummer coordinates. Taking absolute values and using the triangle
inequality, we obtain

|xi|4 ≤

|ai,{S,S(cid:48)}||y{S,S(cid:48)}(x)|

|ai,{S,S(cid:48)}|

|b{S,S(cid:48)},j||δj(x)|

for all (x1 : x2 : x3 : x4) ∈ KS(C). This gives a bound for ˜ε in terms of the ai,{S,S(cid:48)}
and b{S,S(cid:48)},j as in equation (7.1) of [Sto99].
We reﬁne this as follows. Deﬁne a function

2

j=1

≤

4(cid:88)
 (cid:88)
(cid:118)(cid:117)(cid:117)(cid:117)(cid:116) (cid:88)


{S,S(cid:48)}

(cid:118)(cid:117)(cid:117)(cid:116) 4(cid:88)

j=1

(cid:118)(cid:117)(cid:117)(cid:116) 4(cid:88)

j=1

2



.

1≤i≤4

ϕ : R4≥0 −→ R4≥0,

(d1, d2, d3, d4) (cid:55)−→

{S,S(cid:48)}
Lemma 16.1. Deﬁne a sequence (bn)n in R4≥0 by

|ai,{S,S(cid:48)}|

|b{S,S(cid:48)},j|dj

b0 = (1, 1, 1, 1)

and

bn+1 = ϕ(bn) .

Then (bn) converges to a limit b and we have
˜µ(P ) ≤ 4N

log (cid:107)bN(cid:107)∞

4N − 1

for all N ≥ 1 and all P ∈ J(C). In particular, sup ˜µ(J(C)) ≤ log (cid:107)b(cid:107)∞.

58

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

∞(cid:88)

m=0

˜µ(P ) = −

Proof. By our previous considerations, it is clear that |δj(x)| ≤ dj for all j implies
|xi| ≤ ϕi(d1, d2, d3, d4) for all i. We deduce by induction on N that
log (cid:107)x(cid:107)∞ ≤ log (cid:107)bN(cid:107)∞ + 4−N log (cid:107)δ◦N (x)(cid:107)∞

for all N ≥ 1. Writing

4−mN(cid:0)log (cid:107)κ(2mN P )(cid:107)∞ − 4−N log (cid:107)δ◦N (κ(2mN P ))(cid:107)∞(cid:1) ,
To see that (bn) converges, we consider Φ(x) =(cid:0)log ϕi(exp(x1), . . . , exp(x4))(cid:1)

we obtain an upper bound of log (cid:107)bN(cid:107)∞ for each of the terms in parentheses, which gives
the desired bound.

1≤i≤4. It
is easy to see that the partial derivatives ∂Φi
are positive and that for each i, summing
∂xj
them over j gives 1
4 . (This comes from the fact that ϕi is homogeneous of degree 1
4 .)
4(cid:107)x(cid:48) − x(cid:107)∞, so that Φ is contracting with contrac-
This implies that (cid:107)Φ(x(cid:48))− Φ(x)(cid:107)∞ ≤ 1
tion factor ≤ 1
4 . The Banach Fixed Point Theorem then guarantees the existence of a
unique ﬁxed point of Φ, which every iteration sequence converges to. This implies the
(cid:3)
corresponding statement for ϕ.

If we are dealing with a real place, then we may gain a little bit more by making use of
the fact that the δj(x) are real, while some of the coeﬃcients b{S,(cid:48)S},j may be genuinely
complex. This can lead to a better bound on |y{S,S(cid:48)}|.
For example, considering the curve with the record number of known rational points, we
get an improvement from 7.726 to 0.973 for the upper bound on −˜µ using Lemma 16.1.
See Section 19 for more details. In practice it appears that this second approach is at
the same time more eﬃcient and leads to better bounds than the approach described in
Section 16.1 above.

The approach described here can also be applied in the context of heights on genus 3
hyperelliptic Jacobians, see [Sto14].

17. Optimizing the naive height

We now consider an arbitrary local ﬁeld k, with absolute value |·|. Let C be given by
an equation

Y 2 = F (X, Z) ,

and let W be the canonical class on C. The ﬁrst three coordinates of the image of a point
P = [(X1 : Y1 : Z1) + (X2 : Y2 : Z2)]− W ∈ J on the Kummer surface are given by Z1Z2,
X1Z2 + Z1X2, X1X2, whereas the fourth coordinate is homogeneous of degree 1 in the
coeﬃcients fj of F (if we consider Y1 and Y2 to be of degree 1/2). This has the eﬀect that
the fourth coordinate usually diﬀers by a factor of about (cid:107)F(cid:107) := max{|f0|,|f1|, . . . ,|f6|}
from the other three, which gives this last coordinate a much larger (when (cid:107)F(cid:107) is large;
this is usually the case when k is archimedean) or smaller (this may occur when k is
non-archimedean) inﬂuence on the local contribution to the naive height when k = Kv
and K is a global ﬁeld. This imbalance tends to increase the diﬀerence hstd − ˆh between
naive and canonical height. This observation suggests to modify the naive height in the
following way, so as to give all coordinates roughly the same weight. Compare Section 2
for the general set-up. Let x be a set of Kummer coordinates over a global ﬁeld K and
set

log max(cid:8)|x1|v,|x2|v,|x3|v,|x4|v/(cid:107)F(cid:107)v

h(cid:48)(x) :=

(cid:88)

(cid:9) .

v∈MK

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

59

This is a height as in Example 2.3.

If v is a non-archimedean place, then this has the eﬀect of using the Kummer surface
associated to a quadratic twist C0 of C (which has a primitive polynomial on the right
hand side of its equation), since we essentially divide the coeﬃcients by their gcd. The
two Kummer surfaces are isomorphic, and so we can use the bound ¯β(C0) for the height
correction function associated to the quadratic twist as a bound for the height correction
function µv relative to the modiﬁed naive height. (We cannot necessarily use β(C0), since
the isomorphism between the Jacobians of C and of C0 is in general only deﬁned over a
quadratic extension.) Note that v(∆(C)) = v(∆(C0)) + 10v(F ), which leads to bounds
for β on C that are quite a bit larger than what we can get for C0. Note also that this
allows us to deal with non-integral equations; in this case, we again implicitly scale to
make the polynomial on the right integral and primitive.

∼= Q2 (say) and we can write F = 4F1 + H 2 with binary forms F1 and H
When k = Kv
with integral coeﬃcients, then C is isomorphic to the curve C(cid:48) given by the Weierstrass
equation

Y 2 + H(X, Z)Y = F1(X, Z) ,

and we can use the Kummer surface of the latter to deﬁne the local contribution to the
naive height. The isomorphism between the Kummer surfaces is given by (see [M¨ul10,
p. 53]; note that this is the inverse of the map given there)

(x1 : x2 : x3 : x4) (cid:55)−→(cid:0)x1 : x2 : x3 : 1
log max(cid:8)|x1|v,|x2|v,|x3|v,(cid:12)(cid:12) 1

4 x4 + 1
so deﬁning the local component at v of h(cid:48)(x) to be

2 (h0h2x1 + h0h3x2 + h1h2x3)(cid:1) ,
(cid:9) ,

2 (h0h2x1 + h0h3x2 + h1h2x3)(cid:12)(cid:12)v

we can replace the bound for µv by the bound we get on C(cid:48). If we use this at the places
above 2 where it applies (instead of, or combined with, the scaling described above), we
still obtain a height as in Example 2.3.

4 x4 + 1

If v is an archimedean place, then the approach described in Section 16.2 above can
easily be adapted to the modiﬁed naive height. We just have to replace b{S,S(cid:48)},4 = 1
by (cid:107)F(cid:107)v and a4,{S,S(cid:48)} by a4,{S,S(cid:48)}/(cid:107)F(cid:107)2
v. This will usually lead to a negative upper
bound for ˜µv, which is fairly close to − log (cid:107)F(cid:107)v, at least when F is reduced in the sense
of [SC03] and its roots are not too close together. This is because the scaled ai,{S,S(cid:48)}
are now all of size ≈ (cid:107)F(cid:107)−2∞ and the scaled b{S,S(cid:48)},j are all of size ≈ (cid:107)F(cid:107)∞, so Φ as in
the proof of Lemma 16.1 roughly satisﬁes (cid:107)Φ(x)(cid:107)∞ ≈ − 3
4(cid:107)x(cid:107)∞, which has
− log (cid:107)F(cid:107)∞ as its ﬁxed point.
Note that for a point (0 : 0 : 0 : 1) (cid:54)= P = (x1 : x2 : x3 : x4) ∈ KS(K) we have, for all
versions h(cid:48) of the modiﬁed height,
hstd

(cid:0)(x1 : x2 : x3)(cid:1) ≤ h(cid:48)(P ) .

4 log (cid:107)F(cid:107)∞ + 1

We will therefore ﬁnd all points P with h(cid:48)(P ) ≤ B, if we can enumerate all P with
hstd((x1 : x2 : x3)) ≤ B. This can be done (over Q) by using the -a option of the second
author’s program j-points, which is available at [Stoa].
In this way, enumerating
all points as above with B up to roughly log 50 000 is feasible. See the discussion in
Section 18 below.

with ˜β < 0. In this case − ˜β is a lower bound on the canonical height of any nontrivial
point in J(Q); in particular, the torsion subgroup of J(Q) must be trivial. To give an

Note that it is quite possible that we end up with a bound

(cid:0)(x1 : x2 : x3)(cid:1) ≤ h(cid:48)(P ) ≤ ˆh(P ) + ˜β

hstd

for all P ∈ J(Q) \ {O}

60

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

indication of when we can expect ˜β to be close to zero or negative, write | disc(F )| = DD(cid:48)
with D and D(cid:48) coprime and D(cid:48) squarefree. Then the contribution of the ﬁnite places
4 log D. So if D (cid:28) (cid:107)F(cid:107)4∞,
to ˜β can be bounded by 1
we are in good shape. Note that | disc(F )| (cid:28) (cid:107)F(cid:107)10∞, so this means that 60% or more
of log | disc(F )| comes from primes p dividing the discriminant exactly once. For curves
that are not very special this is very likely to be the case.

4 log D, and we get ˜β ≈ − log (cid:107)F(cid:107)∞ + 1

In Section 19 we show how this approach can be used to get a very small bound for the
height diﬀerence even for a curve with ten-digit coeﬃcients.

18. Efficient enumeration of points of bounded canonical height

Let C : y2 = f (x) be a curve of genus 2 over Q with Jacobian J. In this section we
describe the algorithm for enumerating all points P ∈ J(Q) with ˆh(P ) ≤ B that follows
from the considerations above. We assume that f ∈ Z[x] and proceed as follows.

1. Compute the complex roots of f numerically.
2. Compute the coeﬃcients ai,{S,S(cid:48)} and b{S,S(cid:48)},j from the roots and the leading coeﬃ-
cient of f according to the formulas given in [Sto99, Section 10].
3. Multiply all a4,{S,S(cid:48)} by (cid:107)f(cid:107)−2∞ and multiply all b{S,S(cid:48)},4 by (cid:107)f(cid:107)∞.
4. Iterate the function ϕ from Section 17 (but using the modiﬁed coeﬃcients) a number
of times, starting at (1, 1, 1, 1), until there is little change; let ˜β∞ be the upper bound
for ˜µ∞ as in Lemma 16.1.

5. Factor the discriminant of f .

Let g be the gcd of the coeﬃcients of f and set f1(x) = f (x)/g.

6. For each prime divisor p of 2 disc(f ), do the following.

a. Let ep be the p-adic valuation of g.
b. If p = 2 and f1 = h2 + 4f2 for polynomials f2, h ∈ Z[x], set C1 : y2 + h(x)y = f2(x);
c. If ep is even, let βp be the bound for µp on J1(Qp) as obtained in Part II. Otherwise,

otherwise set C1 : y2 = f1(x). Let J1 be the Jacobian of C1.
let βp be the bound for µp on J1( ¯Qp).

7. Set ˜β = ˜β∞ +(cid:80)

8. Use j-points with the -a option to enumerate all points O (cid:54)= P ∈ J(Q) such that

p βp log p.

(cid:0)(κ1(P ) : κ2(P ) : κ3(P ))(cid:1) ≤ B + ˜β.

hstd

9. Add O to this set and return it.

It follows from the discussion in the previous sections that the set returned by this
algorithm contains all points with canonical height at most B. If necessary, one can
compute the actual canonical heights using the algorithm from Part III and discard the
points whose height is too large.
The actual enumeration is done by running through all points (x1 : x2 : x3) ∈ P2 of
(standard) height at most B + ˜β and checking whether there are rational numbers x4
such that (x1 : x2 : x3 : x4) is on the Kummer surface. For each of these points on
the Kummer surface, we then check if it lifts to the Jacobian. Both these conditions
are equivalent to some expression in the coordinates (and the coeﬃcients of f ) being a
square. j-points tries to do this eﬃciently by using information modulo a number of
primes to ﬁlter out triples that do not lift to rational points on J. Let N = (cid:98)exp(B + ˜β)(cid:99).
Then j-points usually takes a couple of seconds when N = 1000, a few minutes when
N = 5 000 and a few days when N = 50 000. The running time scales with N 3, but

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

61

the scaling factor depends on how eﬀective the sieving mod p is. For Jacobians of high
rank, the program tends to take longer than for ‘random’ Jacobians.
Since the running time depends exponentially on B + ˜β, it is very important to obtain a
small bound ˜β for the diﬀerence between naive and canonical height. The improvement
at the inﬁnite place that we can achieve by considering a modiﬁed naive height is crucial
for making the enumeration feasible also in cases when the deﬁning polynomial has large
coeﬃcients. This is demonstrated by the example in Section 19 below.
If the discriminant of f is too large to be factored, then one can use

˜β = ˜β∞ +

log | disc(f1)|

1
4

(or use information from small prime divisors as in the algorithm above and 1
4 log D for
the remaining primes, where D is the unfactored part of the discriminant). But note
that it is usually a great advantage to know the bad primes, since we can take βp = 0 for
primes p such that vp(disc(f )) = 1. In most cases, this leads to a much smaller bound ˜β.
One of the most important applications of this enumeration algorithm is its use in
saturating a given ﬁnite-index subgroup of J(Q), which gives (generators of) the full
group J(Q). This is a necessary ingredient for the method for obtaining all integral
points on C developed in [BMS+08], for example, and for computing the regulator
of J(Q).
There are essentially two ways of performing the saturation. Let G ⊂ J(Q) denote the
known subgroup.

(i) Let ρ be (an upper bound for) the covering radius of the lattice Λ = (G/Gtors, ˆh).
Then J(Q) is generated by G together with all points P ∈ J(Q) that satisfy ˆh(P ) ≤
ρ2, see [Sto02, Prop. 7.1]. This approach is feasible when ˜β +ρ2 is suﬃciently small.
(ii) Let I = (J(Q) : G) denote the index; we assume that J(Q)tors ⊂ G. If m1, . . . , mr
are the successive minima of Λ and there are no points P ∈ J(Q)\G with ˆh(P ) < B,
then

(cid:115)

I ≤

(cid:81)r
j=1 min{mj, B} ;

R · γr

r

see [FS97, Section 7]. Here γr is (an upper bound for) the Hermite constant for
lattices of rank r and R is the regulator of G (i.e., the determinant of the Gram
matrix of any basis of Λ). This can be used to get a bound on I whenever B is
strictly positive, so for the enumeration we only need ˜β to be suﬃciently small.
(If ˜β < 0, then we can do entirely without enumeration to get an index bound.)
In a second step, one then has to check that G is p-saturated in J(Q) (or ﬁnd
the largest group G ⊂ G(cid:48) ⊂ J(Q) with (G(cid:48) : G) a power of p) for all primes p
up to the index bound. This can be done by considering the intersection of the
kernels of the maps J(Q)/pJ(Q) → J(Fq)/pJ(Fq) for a set of good primes q (such
If this intersection is trivial, then G
that the group on the right is nontrivial).
is p-saturated; otherwise it tells us where to look for points that are potentially
divisible by p. Since the index bound gets smaller with increasing B (as long as
B < mr), it makes sense to pick B in such a way as to balance the time spent in
the two steps of this approach.

19. Example

As an example that demonstrates the use of our nearly optimal upper bound for the
diﬀerence h − ˆh between naive and canonical height (which is based on the optimal

62

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

bounds for the µp obtained in Sections 9, 10 and 11 and the variation of the naive
height discussed in Section 17), we consider the curve

C : y2 = 82342800x6 − 470135160x5 + 52485681x4

+ 2396040466x3 + 567207969x2 − 985905640x + 247747600 .

This curve is of interest, since it holds the current record for the largest number of
known rational points (which is 642 for this curve), see [Stob]. A 2-descent on its
Jacobian J (assuming GRH) as described in [Sto01] and implemented in Magma gives
an upper bound of 22 for the rank of J(Q), and the diﬀerences of the known rational
points generate a group of rank 22. The latter statement can be checked by computing
the determinant R of the height pairing matrix of the following 22 points in J(Q),
which is fairly fast using the algorithm for computing canonical heights described in
Section 14. The points are given in Mumford representation (a(x), b(x)), which stands
for [(θ1, b(θ1)) + (θ2, b(θ2))] − W , where θ1, θ2 are the two roots of a(x) and W is the
canonical class. Not all of these points are diﬀerences of rational points, but they are
linear combinations of such diﬀerences.

9

3

),

(x2 + x, 18868x + 15740),
3 x − 1
3 x − 5

(x2 + 2
3 , 11747
3 x + 21131
(x2 + 4
9 , 16315x + 26195
),
(x2 − 3x − 4, 34104x + 30976),
(x2 + 8
5 x + 3
5 , 67671x + 64543),
(x2 − 3
4 x − 7
4 , 31875x + 35003),
6 x − 178
x − 10824742
9 , 3014179
),
294 x − 5459431
42 x − 37
42 , 23742013
84 x − 11
147 x − 2230444
21 , 30014567
591361 x + 16665656516
769 , 6911886712
769 , 54505985456
1774083 x + 25990632928

591361

591361

294

147

),

),

),

),

6

9

(x2 + 29
(x2 + 97
(x2 + 325
769 x − 584
2307 x − 1252

(x2 − 91
(x2 − 3073

3

6

),

12 x + 5

3 , 1433669

3 x, 216800

3 x − 15740),

(x2 − 1
(x2 + 5x + 4, 276256x + 273128),
(x2 + 53
x + 371650
(x2 − 4x − 5, 65987x + 69115),
(x2 − 5x − 6, 883626
7 x + 905522
),
(x2 + 5
7 , 432898
49 x + 279626
(x2 + 19
84 , 4287373
121 x − 15740),
(x2 − 5
(x2 − 683
140 , 45519013
(x2 − 259
72 , 52305719
(x2 − 137
51 , 47131040

7 x − 2
84 x − 65
11 x, 1089388
140 x − 279
96 x + 163
51 x + 40

294 x + 5207005

490 x + 5478709
768 x − 13101271
867 x − 8471860

576

294

490

867

),

),

49

)

7

),

),

Table 3. Generators of the known part of J(Q).

The discriminant of C factors as

The results of [Sto99, Sto02] lead to a bound of

∆ = 247 · 35 · 59 · 112 · 132 · 176 · 194 · 232 · 414 · 733

· 2707 · 43579 · 108217976921 · 8723283517315751077 .

(cid:0)43 log 2 + 3 log 3 + 9 log 5 + 2 log 11 + 2 log 13

+ 6 log 17 + 4 log 19 + 2 log 23 + 4 log 41 + 3 log 73(cid:1) ≈ 40.1

1
3

for the contribution of the ﬁnite places to the height diﬀerence bound. When trying
to get a better bound (for γp) by essentially doing an exhaustive search over the p-
adic points of the Kummer surface, Magma gets stuck at p = 2 for a long while, but
eventually ﬁnishes with a contribution of 26.434 from the ﬁnite places and a total bound
of 34.163. This contribution turns out to be (γp/3) log p in all cases except for p = 73,

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

63

3 log 73 instead of 1

where it is 2
3 log 73. Our new results from this paper give the following
bounds on the local contributions. Φp is the component group (ε and µ factor through
it in all cases) and ‘gain’ gives the gain in the bound on the height diﬀerence obtained
by using the optimal bound on µ versus the bound γ/3, where γ is the maximum of the
values of ε.

[I10−9−8]

[I0 − IV − 0]

p reduction type
2
3
5
11
13
17
19
23
41
73

[I4−3−2]
[I2−0−0]
[I2−0−0]
[I2−2−2]
[I2−1−1]
[I2−0−0]
[I2−1−1]
[I1−1−1]

Φp

Z/242Z
Z/3Z
Z/26Z
Z/2Z
Z/2Z

Z/5Z
Z/2Z
Z/5Z
Z/3Z

Z/2Z × Z/6Z

βp

2/3

γp/3

22/13

gain
2 + 1145/242 26/3 1.341
0.000
0.495
0.400
0.427
0.944
0.196
0.523
0.248
0.000

2/3
2
2/3
2/3
4/3
2/3
2/3
2/3
1/3

1/2
1/2
1
3/5
1/2
3/5
1/3

This now gives a bound of ≈ 20.429 for the contribution of the ﬁnite places. The
optimization of the naive height does not give any improvement at the odd ﬁnite places,
since the polynomial f deﬁning the curve is primitive. On the other hand, we note
that f is congruent to a square mod 4, so we can use the Kummer surface of the curve
y2 + (x2 + x)y = f1(x) (where f (x) = 4f1(x) + (x2 + x)2) for the local height at 2; this
reduces the local height diﬀerence bound at 2 by 2 log 2, so the contribution of the ﬁnite
places to the height diﬀerence h − ˆh can be bounded by ≈ 19.043.
Now we consider the contribution of the inﬁnite place. The bound obtained from [Sto99,
(7.1)] is 7.726. Using Lemma 16.1 with N = 10 improves this to 0.973; increasing N
further gives no signiﬁcant improvement. However, modifying the local height at the
inﬁnite place by scaling the contribution of the fourth coordinate by (cid:107)f(cid:107)−1∞ reduces this
bound considerably to ˜µ∞ ≤ −19.25654 (compare this to − log (cid:107)f(cid:107)∞ ≈ −21.59708).
This ﬁnally gives

h(cid:48)(P ) ≤ ˆh(P ) − 0.21357

for our modiﬁed (at the places 2 and ∞) naive height h(cid:48). Note that this is an instance
where we immediately get a strictly positive lower bound on ˆh(P ) for P (cid:54)= O (since then
h(cid:48)(P ) ≥ 0); this shows that J(Q) has trivial torsion subgroup (which is also easy to see
by computing the order of J(Fp) for a few good primes p).
So if we enumerate all points P ∈ J(Q) with h(cid:48)(P ) ≤ log N and do not ﬁnd points that
are not in the known subgroup G, then we obtain a bound for the index I = (J(Q) : G)
as follows (see the discussion at the end of Section 18).

(cid:115)

I ≤

(cid:81)22
j=1 min{mj, log N + 0.21357} ,

R · γ22

22

where R is the regulator of G and m1, m2, . . . , m22 are the successive minima of the
lattice (G, ˆh), which are

8.5276, 8.5668, 8.5956, 8.8594, 9.0256, 9.0776, 9.1426, 9.1753,
9.4456, 9.7428, 9.7747, 9.9047, 9.9465, 9.9611, 9.9704, 10.1408,

10.3472, 10.3784, 10.5284, 10.5356, 10.6318, 10.9287 .

64

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

With N = 10 000 we obtain I ≤ 1516, with N = 20 000 we get I ≤ 1024 and with
N ≥ 45 033 we obtain the best possible bound I ≤ 900. We checked that there are
no unknown points P with κ(P ) = (x1 : x2 : x3 : x4) such that hstd((x1 : x2 : x3)) ≤
log 20 000 and veriﬁed that the index is not divisible by any prime p ≤ 1024. Both
computations took about two days each on a single core. This implies the following.

Proposition 19.1. Assume the Generalized Riemann Hypothesis. Let

C : y2 = 82342800x6 − 470135160x5 + 52485681x4

+ 2396040466x3 + 567207969x2 − 985905640x + 247747600 .

and denote by J the Jacobian of C. Then J(Q) is a free abelian group of rank 22,
freely generated by the points listed in Table 3. In particular, J(Q) is generated by the
diﬀerences of rational points on C.

References

[Art66] Michael Artin, On isolated rational singularities of surfaces, Amer. J. Math. 88 (1966), 129–

[Art86] M. Artin, Lipman’s proof of resolution of singularities for surfaces, Arithmetic geometry

136. ↑10
(Storrs, Conn., 1984), Springer, New York, 1986, pp. 267–287. ↑7
54 (2005), 1–30. ↑5, 14, 14.4, 15

[DJB05] Daniel J. Bernstein, Factoring into coprimes in essentially linear time, Journal of Algorithms
, Research announcement: Faster factorization into coprimes, 2004. Preprint. ↑5, 14,

[DJB04]

[BG06] Enrico Bombieri and Walter Gubler, Heights in Diophantine geometry, New Mathematical

14.4, 15
Monographs, vol. 4, Cambridge University Press, Cambridge, 2006. ↑4.5

[BB98] Jonathan M. Borwein and Peter B. Borwein, Pi and the AGM, Canadian Mathematical
Society Series of Monographs and Advanced Texts, 4, John Wiley & Sons, Inc., New York,
1998. A study in analytic number theory and computational complexity; Reprint of the 1987
original; A Wiley-Interscience Publication. ↑13

[BLR90] Siegfried Bosch, Werner L¨utkebohmert, and Michel Raynaud, N´eron models, Ergebnisse der
Mathematik und ihrer Grenzgebiete (3) [Results in Mathematics and Related Areas (3)],
vol. 21, Springer-Verlag, Berlin, 1990. ↑7, 7, 7, 7, 7, 9, 9, 9, 12

[BCP97] Wieb Bosma, John Cannon, and Catherine Playoust, The Magma algebra system. I. The
user language, J. Symbolic Comput. 24 (1997), no. 3-4, 235–265. Computational algebra and
number theory (London, 1993). ↑15, 16.1

[BM93] Jean-Benoˆıt Bost and Jean-Fran¸cois Mestre, Calcul de la hauteur archim´edienne des points
d’une courbe elliptique par un algorithme quadratiquement convergent et application au calcul
de la capacit´e de l’union de deux intervalles, 1993. Unpublished Manuscript. ↑14
on curves, LMS J. Comput. Math. 13 (2010), 272–306. ↑7, 7

[BS10] Nils Bruin and Michael Stoll, The Mordell-Weil sieve: proving non-existence of rational points

[BL94] J. A. Buchmann and H. W. Lenstra Jr., Approximating rings of integers in number ﬁelds,
J. Th´eor. Nombres Bordeaux 6 (1994), no. 2, 221–260 (English, with English and French
summaries). ↑15
points on hyperelliptic curves, Algebra Number Theory 2 (2008), no. 8, 859–885. ↑1, 18

[BMS+08] Yann Bugeaud, Maurice Mignotte, Samir Siksek, Michael Stoll, and Szabolcs Tengely, Integral

[Con05] B. Conrad, Minimal models for elliptic curves, 2005, unpublished manuscript. Available at

[Cin11] Zubeyir Cinkir, Zhang’s conjecture and the eﬀective Bogomolov conjecture over function

[CF96] J. W. S. Cassels and E. V. Flynn, Prolegomena to a middlebrow arithmetic of curves of genus
2, London Mathematical Society Lecture Note Series, vol. 230, Cambridge University Press,
Cambridge, 1996. ↑1, 1, 3, 7
ﬁelds, Invent. Math. 183 (2011), no. 3, 517–562. ↑8.4
http://math.stanford.edu/∼conrad/papers/minimalmodel.pdf. ↑7.6, 10
over number ﬁelds, J. Number Theory 116 (2006), no. 1, 42–68. ↑10.13, 11
Hautes ´Etudes Sci. Publ. Math. 36 (1969), 75–109. ↑5

[DM69] P. Deligne and D. Mumford, The irreducibility of the space of curves of given genus, Inst.

[CPS06] J. E. Cremona, M. Prickett, and Samir Siksek, Height diﬀerence bounds for elliptic curves

CANONICAL HEIGHTS ON GENUS TWO JACOBIANS

65

[FS97] E. V. Flynn and N. P. Smart, Canonical heights on the Jacobians of curves of genus 2 and

[vzGG99] Joachim von zur Gathen and J¨urgen Gerhard, Modern computer algebra, Cambridge Univer-

[Hei04] Niels Heinz, Admissible metrics for line bundles on curves and abelian varieties over non-

[FLS+01] E. Victor Flynn, Franck Lepr´evost, Edward F. Schaefer, William A. Stein, Michael Stoll, and
Joseph L. Wetherell, Empirical evidence for the Birch and Swinnerton-Dyer conjectures for
modular Jacobians of genus 2 curves, Math. Comp. 70 (2001), no. 236, 1675–1697 (electronic).
↑1
the inﬁnite descent, Acta Arith. 79 (1997), no. 4, 333–352. ↑1, 2a, 4, 14, 15, ii
sity Press, New York, 1999. ↑13
Archimedean local ﬁelds, Arch. Math. (Basel) 82 (2004), no. 2, 128–139. ↑8
matics, vol. 201, Springer-Verlag, New York, 2000. An introduction. ↑1, 2, 4
Theory 132 (2012), no. 6, 1295–1305. ↑14
612–649. ↑6
Cambridge Philos. Soc. 157 (2014), no. 2, 357–373. ↑14

[dJM14] Robin de Jong and J. Steﬀen M¨uller, Canonical heights and division polynomials, Math. Proc.
[Lan83] Serge Lang, Fundamentals of Diophantine geometry, Springer-Verlag, New York, 1983. ↑8,

[Hol12] David Holmes, Computing N´eron-Tate heights of points on hyperelliptic Jacobians, J. Number

[Igu60] Jun-ichi Igusa, Arithmetic variety of moduli for genus two, Ann. of Math. (2) 72 (1960),

[HS00] Marc Hindry and Joseph H. Silverman, Diophantine geometry, Graduate Texts in Mathe-

[Liu93] Qing Liu, Courbes stables de genre 2 et leur sch´ema de modules, Math. Ann. 295 (1993),

, Mod`eles minimaux des courbes de genre deux, J. Reine Angew. Math. 453 (1994),

12
no. 2, 201–222 (French). ↑6, 6.1, 6, 6
137–164 (French). ↑10, 12, 12
, Mod`eles entiers des courbes hyperelliptiques sur un corps de valuation discr`ete, Trans.
Amer. Math. Soc. 348 (1996), no. 11, 4577–4610 (French, with English summary). ↑4, 5, 5,
5, 5, 11, 11, 11

[Liu94]

[Liu96]

[Liu02]

, Algebraic geometry and arithmetic curves, Oxford Graduate Texts in Mathematics,
vol. 6, Oxford University Press, Oxford, 2002. Translated from the French by Reinie Ern´e;
Oxford Science Publications. ↑7

[M¨ul14]

, Computing canonical heights using arithmetic intersection theory, Math. Comp. 83

[Sil88] Joseph H. Silverman, Computing heights on elliptic curves, Math. Comp. 51 (1988), no. 183,

[NU73] Yukihiko Namikawa and Kenji Ueno, The complete classiﬁcation of ﬁbres in pencils of curves

[N´er65] A. N´eron, Quasi-fonctions et hauteurs sur les vari´et´es ab´eliennes, Ann. of Math. (2) 82

[M¨ul10] J. Steﬀen M¨uller, Explicit Kummer surface formulas for arbitrary characteristic, LMS J.

[Mes91] Jean-Fran¸cois Mestre, Construction de courbes de genre 2 `a partir de leurs modules, Eﬀective
methods in algebraic geometry (Castiglioncello, 1990), Progr. Math., vol. 94, Birkh¨auser
Boston, Boston, MA, 1991, pp. 313–334 (French). ↑6
Comput. Math. 13 (2010), 47–64. ↑1, 1, 3, 17
(2014), no. 285, 311–336. ↑14
[MS15] J. Steﬀen M¨uller and Michael Stoll, Computing canonical heights on elliptic curves in quasi-
linear time, September 29, 2015. Preprint, arXiv:1509.08748v1 [math.NT]. ↑1, 12, 12, 12, 14,
14, 14, 14
of genus two, Manuscripta Math. 9 (1973), 143–186. ↑5, 6.3, 9, 9, 10, 10, 12.4, 12
(1965), 249–331 (French). ↑1, 12
339–358. ↑7.6, 9.2
vol. 151, Springer-Verlag, New York, 1994. ↑9
183–201. ↑1, 1, 3.2, 11, 13, 14, 16, 16.1, 16.2, 2, 19
no. 3, 245–277. ↑19
165–182. ↑1, 1, 3, 3, 3, 3, 3, 3, 3, 10, 14, 14, 15, i, 19
2014. Preprint, http://www.mathe2.uni-bayreuth.de/stoll/schrift.html#AG51. ↑16.2
http://www.mathe2.uni-bayreuth.de/stoll/programs/index.html. ↑17
http://www.mathe2.uni-bayreuth.de/stoll/recordcurve.html. ↑1, 19

[Sto99] Michael Stoll, On the height constant for curves of genus two, Acta Arith. 90 (1999), no. 2,

, Implementing 2-descent for Jacobians of hyperelliptic curves, Acta Arith. 98 (2001),

, On the height constant for curves of genus two. II, Acta Arith. 104 (2002), no. 2,

, Advanced topics in the arithmetic of elliptic curves, Graduate Texts in Mathematics,

[Sto14]

, An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three, May 15,

[Stob]

, A genus 2 curve with at least 642 rational points.

[Stoa]

, j-points, a program for searching rational points on genus 2 Jacobians.

[Sil94]

[Sto01]

[Sto02]

66

J. STEFFEN M ¨ULLER AND MICHAEL STOLL

[SC03] Michael Stoll and John E. Cremona, On the reduction theory of binary forms, J. Reine Angew.

[Uch11] Yukihiro Uchida, Canonical local heights and multiplication formulas for the Jacobians of

Math. 565 (2003), 79–99. ↑17
curves of genus 2, Acta Arith. 149 (2011), no. 2, 111–130. ↑8, 14

[Zar95] Yu. G. Zarkhin, Local heights and N´eron pairings, Trudy Mat. Inst. Steklov. 208 (1995),
no. Teor. Chisel, Algebra i Algebr. Geom., 111–127 (Russian); English transl., Proc. Steklov
Inst. Math. 208 (1995), 100-114. ↑2, 4.5
[Zha93] Shouwu Zhang, Admissible pairing on a curve, Invent. Math. 112 (1993), no. 1, 171–193. ↑8

Institut f¨ur Mathematik, Carl von Ossietzky Universit¨at Oldenburg, 26111 Oldenburg,
Germany

E-mail address: jan.steffen.mueller@uni-oldenburg.de

Mathematisches Institut, Universit¨at Bayreuth, 95440 Bayreuth, Germany.

E-mail address: Michael.Stoll@uni-bayreuth.de

