6
1
0
2

 
r
a

 

M
1
1

 
 
]

Y
S
.
s
c
[
 
 

1
v
4
2
6
3
0

.

3
0
6
1
:
v
i
X
r
a

Consensus algorithms and plug-and-play control

for current sharing in DC microgrids

Michele Tucci∗1, Lexuan Meng†2, Josep M. Guerrero‡ 2, and Giancarlo

Ferrari-Trecate§ 1

1Dipartimento di Ingegneria Industriale e dell’Informazione, Università degli Studi

2Institute of Energy Technology, Aalborg University

di Pavia

Technical Report

March, 2016

Abstract

In this paper, we propose a secondary consensus-based control layer for current sharing
and voltage balancing in DC microGrids (mGs). Diﬀerently from existing approaches based
on droop control, we assume decentralized Plug-and-Play (PnP) controllers at the primary
level as they provide voltage stabilization and their design complexity is independent of the
mG size. We analyze the behavior of the closed-loop mG by approximating local primary con-
trol loops with either unitary gains or ﬁrst-order transfer functions. Besides proving stability,
current sharing and voltage balancing in the asymptotic régime, we describe how to design sec-
ondary controllers in a PnP fashion when distributed generation units are added or removed.
Theoretical results are complemented by simulations using a 5-DGUs mG implemented in
Simulink/PLECS.

Keywords: DC microgrid, secondary control, current sharing, voltage balancing, plug-and-

play.

∗Electronic address: michele.tucci02@universitadipavia.it; Corresponding author
†Electronic address: lme@et.aau.dk
‡Electronic address: joz@et.aau.dk
§Electronic address: giancarlo.ferrari@unipv.it

1

Introduction

1
Power generation and distribution is deeply changing due to the increasing diﬀusion of renewable
energy sources, advances in energy storage, and active participation of consumers to the energy
market [1]. This shift of paradigm motivated the development of migroGrids (mGs), commonly
recognized as small-scale power system integrating Distributed Generation Units (DGUs), storage
devices and loads. In addition, mGs can operate either connected to the main grid or in islanded
mode [2, 3]. Since AC power generation is the standard for commercial, residential and industrial
utilization, several studies focused on AC mGs [4, 5, 6, 7]. However, nowadays, DC energy systems
are gaining interest [8, 9] because of the increasing number of DC loads, the availability of eﬃcient
converters, and the need of interfacing DC energy sources and batteries with minimal power losses.
In particular, DC mGs are becoming more and more popular in several application domains, such
as avionics, automotive, marine and residential systems. A key feature of DC mGs is that they
can be coupled to the main grid only through AC-DC converters. These devices always limit
the power transfer and, therefore, DC mGs can be thought as operating in islanded mode only.
The basic issues in control of DC mGs are voltage stabilization [8, 10] and current sharing, the
latter meaning that DGUs must compensate load currents proportionally to their ratings and
independently of the mG topology and line impedances. An additional goal is voltage balancing,
i.e. to keep the average output voltage of DGUs close to a prescribed level.

To realize these objectives, hierarchical control structures have been proposed. In the primary
layer, current sharing regulation is usually implemented on top of local controllers comprising
voltage and current loops. While centralized controllers can ensure voltage stabilization and
accurate current sharing [11], the computational and communication burden of these architectures
increases with the mG size. Moreover, a single-point-of-failure in the central unit may cause
the malfunction of the whole system [12, 13]. For these reasons, decentralized and distributed
regulators, such as droop controllers [9], are preferred. Droop control is a communication-less
approach, but it might cause deviations of voltages from reference values. For solving this problem,
droop controllers are often complemented with consensus algorithms [14] forming a secondary
control layer [15, 16, 12, 17].

In order to stabilize mGs with general topologies, the design of droop and consensus controllers
is often done in a centralized fashion, i.e. exploiting knowledge about all DGUs and line models
[14, 15, 12, 17]. These design approaches, however, become prohibitive when the mG size grows.
Furthermore, in order to preserve stability, the plugging-in or out of DGUs might require the
update of all local controllers in the mG. This motivated the development of scalable design
procedures for local controllers [10, 16].
In [16] the authors propose primary droop regulators
tightly coupled with secondary consensus ﬁlters for guaranteeing voltage stability and current
sharing. For analysis purposes, inner voltage and current loops are simpliﬁed as unitary gains.
For this approximation to hold, the interconnection of DGUs, equipped with inner loops only,
must be asymptotically stable.
In order to guarantee voltage stability, in [10] inner loops and
droop controllers have been replaced by a new class of primary controllers, termed Plug-and-Play
(PnP). Local PnP regulators also allow to tune the bandwidth of controlled DGUs through the
use of preﬁlters. Furthermore, when a DGU wants to join the network, the possibility of designing
PnP regulators for the DGU and its future neighbors can be automatically checked by solving local
optimization problems exploiting information only about individual DGUs and the lines connected
to them. In this way, the plug-in of DGUs is automatically denied, if dangerous for mG stability.
The goal of this paper is to enhance PnP controllers with secondary regulators for achieving
current sharing and voltage balancing. Similarly to [12, 16, 15, 17], we exploit consensus ﬁlters
requiring DGUs to communicate in real-time over a network with arbitrary, yet connected, topol-
ogy. We rigorously analyze the behavior of the closed-loop mG by approximating primary control
loops with either unit gains (as in [16]) or ﬁrst-order transfer functions.

Current sharing and voltage balancing properties, are also demonstrated in simulation using
a 5-DGUs mG implemented in Simulink/PLECS [18], accounting for the non-idealities of real
converters and lines.
Notation and basic deﬁnitions. The cardinality of the ﬁnite set S will be denoted with |S|.

2

A weighted graph is a directed graph G = (V,E, W) deﬁned by the set of nodes V = {1, . . . , n},
the set of edges E ⊆ V × V and the diagonal matrix W ∈ R|E|×|E| collecting on its diagonal
the weights wi associated to edges ei ∈ E (i.e. Wii = wi). The set of neighbors of node i ∈ V is
Ni = {j : (i, j) ∈ E or (j, i) ∈ E}. Q(G) ∈ R|V|×|E| is the incidence matrix of G [19]. The Laplacian
matrix of G is L(G) = Q(G)W Q(G)T , independently of the orientation of edges.
The eigenvalues of a square matrix A of dimension n× n are denoted with λi(A), i = 1, . . . , n.
An Hermitian matrix A ∈ Cn×n is positive (resp. negative) deﬁnite if x?Ax is real and positive
(resp. negative) for all non-zero column vectors x ∈ Cn×n (x? denotes the conjugate transpose of
x). A positive (resp. negative) semi-deﬁnite Hermitian matrix is deﬁned in the same way, except
that the expression x∗Ax is required to be always non-negative (resp. non-positive). If A ∈ Rn×n,
the above deﬁnitions can be similarly reformulated in the real sense, by just considering non-zero
column vector x ∈ Rn and replacing x? with xT . Moreover, if a real matrix is also symmetric, we
have consistency between real and complex deﬁnitions [20].

The n × 1 vector of ones (resp. zeros) is denoted as 1n (resp. 0n).
The average of a vector v ∈ Rn is hvi = 1

i vi. We denote with H1 the subspace composed
by all vectors with zero average [21, 22] i.e. H1 = {v ∈ Rn : hvi = 0}. The space orthogonal
to H1 is H1⊥. It holds H1⊥ = {α1n, α ∈ R} and dim(H1⊥) = 1. Moreover, the decomposition
Rn = H1 ⊕ H1⊥ is direct [23], i.e each vector v ∈ Rn can always be written in a unique way as

Pn

n

v = ˆv + ¯v with ˆv ∈ H1 and ¯v ∈ H1⊥.

(1)
Consider the matrix A ∈ Rn×n. With the notation A(H1|H1) we indicate the linear map
A : H1 → H1 (i.e. the restriction of the map A : Rn → Rn to the subspace H1). For a subspace
V ⊂ Rn, we denote with PV(v) the projection of v ∈ Rn on V.

The subspace V ⊆ Rn is said to be A-invariant if v ∈ V ⇒ Av ∈ V.
The subspace V ⊆ Rn is invariant for the system ˙x = Ax + Bu and U ⊆ Rm if

x(0) ∈ V ⇒ x(t) ∈ V, ∀t ≥ 0, ∀u(t) ∈ U.

Preliminaries on Laplacian matrices. Laplacian matrices have key properties summarized

in the next Proposition.
Proposition 1. For a connected graph G with weights wi > 0, A = L(G) ∈ Rn×n has the following
properties:

(i) it has non positive oﬀ-diagonal elements;
(ii) λ1(A) ≥ ··· ≥ λn−1(A) ≥ 0 = λn;
(iii) Ker(A) = H1⊥ and Range(A) = H1;
(iv) A(H1|H1) is invertible.
in [24, 25]. Point (iv) has been shown in [21] with the
Proof. Points (i)-(iii) are shown, e.g.
framework of partial diﬀerence equations. Next, we provide a proof based on linear algebra only.
We start noticing that the linear map A(H1|H1) invertible if it is surjective and injective [26].
First, we show the surjectivity of A on H1. By construction, rank(A) = n − 1 because

rank(A) = dim(Range(A)) = dim(Rn) − dim(H1⊥) = n − 1.

Moreover, since A is symmetric, each column of A has zero sum and hence is a vector in H1.
Since Range(A) is the column span, then Range(A) ⊂ H1. Since dim(H1) = n − 1, one obtains
Range(A) = H1. This proves that the map A(H1|H1) is surjective.
Next, we prove that A(H1|H1) is also injective. By deﬁnition, this holds if
(Ax = b and Ay = b) ⇒ x = y.

∀b ∈ H1 ∀x, y ∈ H1

Now, Ax = Ay = b implies that A(x − y) = 0. It means that x − y ∈ Ker(A), therefore ∃α ∈ R
such that x − y = α1n. However, since x − y ∈ H1, x − y = α1n is veriﬁed only for α = 0; this
leads to x = y.

3

2 Plug-and-play primary voltage control
2.1 DGU electrical model
As in [10], we consider a DC mG composed of N DGUs. For the sake of clarity, the electrical
scheme of the i-th DGU is shown in Figure 1. In each DGU, the generic renewable resource is
modeled as a DC voltage source and a Buck converter is used to supply a local load connected to
the Point of Common Coupling (PCC) through an RL ﬁlter. As in [27], an averaging technique
is adopted for modeling the Buck converter so as to neglect high frequency switching dynamics.
Furthermore, we assume that loads ILi are unknown and treated as current disturbances [28, 10].
The controlled variable is the voltage at each PCC. From Figure 1, by applying Kirchoﬀ’s voltage
and current laws and exploiting Quasi Stationary Line (QSL) approximation of power lines [29],
we obtain the following model of DGU i1

(cid:19)

(cid:18) Vj
Iti + 1

CtiRij

Lti

− Vi

CtiRij

Vti

− 1
Cti

ILi

(2)



Iti + X

j∈Ni
Vi − Rti
Lti

dVi
dt

dIti
dt

= 1
Cti
= − 1
Lti

DGU i :

where inputs (Vti, ILi) and Vj ∈ Ni, states (Vi, Iti), and electrical parameters Rti, Cti, Lti and
Rij are shown in Figure 1. In particular, Vj is the voltage at the PCC of each neighboring DGU
j ∈ Ni.
Remark 1. From Figure 1, we assume a “load-connected” topology, meaning that load currents
are located at the PCC of each DGU. This restriction on the mG topology is, however, mild.
Indeed, as shown in [16, 30, 31], arbitrary interconnections of DGU and load nodes can be always
mapped into load-connected mGs through a network reduction method known as Kron reduction.

2.2 Plug-and-play design
In this Section, we brieﬂy summarize the PnP scalable approach in [10] for designing primary
decentralized controllers guaranteeing voltage stability in DC mGs. Local regulator Ci of DGU i
exploits measurements of Vi and Iti to compute the command Vti of the i-th Buck converter and
make Vi track a reference signal Vref,i (see the scheme in Figure 1). Each controller is composed
by a vector matrix gain Ki and an integral action is present for zeroing the voltage tracking
error. The decentralized design of these vector gains is the core of PnP controller synthesis. More
speciﬁcally, as shown in [10]: (i) the design of Ki requires only knowledge of the dynamics of
DGU i and the parameters of power lines connecting it to its neighbors, (ii) Ki is automatically
computed solving a Linear Matrix Inequality (LMI) problem.
For modeling the interaction of multiple DGUs, we represent the mG with a directed graph
Gel = (Vel,Eel, W) (see e.g. Figure 2), where (i) each node is a DGU with local PnP controller
and local current load, (ii) edges (i, j) are power lines, and weights are the corresponding conduc-
, (iii) we set N = |Vel| and M = |Eel|. Next, we show how to handle plugging -in/-out
tances2,
of DGUs while preserving the stability of the mG. Whenever a DGU (say DGU i) wants to join
the network (e.g. DGU 6 in Figure 2), it sends a plug-in request to its future neighbors, i.e. DGUs
j ∈ Ni (e.g. DGUs 1 and 5 in Figure 2). Then, DGU i solves the LMI problem (15) in [10]. If the
optimization problem is feasible, it returns a controller Ci (i.e. a vector gain Ki) along with a local
separable Lyapunov function that can be used for certifying stability of the whole mG. Since also
DGUs j ∈ Ni will have a new neighbor, they might need to update their controller Cj by tacking
into account the impedance of the new line ji. If LMI constraints of problem (15) in [10] for DGU
j are still fulﬁlled, no update is necessary. Otherwise, DGU j solves an LMI problem analogous
to the one solved by DGU i. If one of the above LMI problems is unfeasible, plug-in of DGU i is

1
Rij

1For the detailed DGU model derivation, we defer the reader to [10].
2Line inductances Lij are neglected as we assume QSL approximations [29].

4

Figure 1: Electrical scheme of DGU i and local PnP voltage controller.

Figure 2: Graph representation of an mG composed of 5 DGUs (in black) and plug-in of DGU 6
(in red).

denied. Otherwise, DGU i can be connected and stability of the whole mG can be certiﬁed using
the sum of the computed local Lyapunov functions. Unplugging of a DGU (say DGU m) follows a
similar procedure: as line mk will be disconnected from the corresponding DGU k, all controllers
Ck, k ∈ Nm must be successfully redesigned before allowing the disconnection.
Remark 2. Local PnP controllers can be enhanced with pre-ﬁlters so as to shape in a desired way
the transfer function Gi(s) between voltages Vref,i and Vi represented in Figure 1. Therefore, it is
possible to identify a range of frequencies in which Gi(s) can be approximate as an unitary gain
or a ﬁrst-order system. In particular, the presence of an integrator in each local control scheme
allows the voltage Vi at the PCC to track constant references when the disturbances (i.e.
load
currents ILi) are constant [10].

3 Secondary control based on consensus algorithms
PnP local regulators form a primary control layer capable to regulate the voltage at each PCC
while guaranteeing stability of the overall mG. However, they do not to ensure current sharing

5

+ Ki	1	s	(cid:1) Vref,iBuckiRtiLtiItiVtiPCCiILiCtiViVjI`iRijLijDGUiLineijDGU1DGU2DGU3DGU4DGU5DGU6e1e3e5e2e4e7e6and voltage balancing, deﬁned as follows.
Deﬁnition 1. Current sharing is achieved if the overall load current is equally shared among
DGUs, i.e.

Iti = hILi

i = 1, . . . , N,

(3)

where IL = [IL1, IL2, . . . , ILN]T is the vector of local load currents.
Assumption 1. Voltage references are identical for all DGUs, i.e. Vref,i = Vref, ∀i ∈ Vel.
Deﬁnition 2. Under Assumption 1, voltage balancing is achieved if

hVi = Vref .

(4)

where vector V = [V1, V2, . . . , VN]T collects the PCC voltages.

We highlight that current sharing is desirable in order to avoid situations in which some DGUs
are not able to supply local loads, thus requiring power from other DGUs. A safe way to perform
this operation is to make DGUs proportionally share their load current, according, for instance,
to their generation capacity. This can be obtained by ensuring (3) while measuring the currents
in per-unit (p.u.), with base currents equal to the current ratings of Buck converters.

Even if current sharing holds, the voltages at PCCs may have deviation from the nominal
value.
If not well controlled, overall voltage fault may happen to some PCCs. Accordingly,
another objective is to ensure the average voltage value among all PCCs is equal to the nominal
value (Vref).

In order to guarantee current sharing and voltage balancing, we enhance primary PnP con-
trollers with a consensus-based secondary control layer.
In general, consensus algorithms can
be used to achieve information sharing and coordination among agents. In our case, as shown
in Figure 3, a basic consensus scheme with continuous-time integrators [32], adjusts the voltage
references for each PnP regulator while considering the output current diﬀerences among DGUs,
i.e.

˙∆Vi(t) = kI,i

aij(Iti(t) − Itj(t)),

(5)

NX

j=1,j6=i

where aij = 1 if DGUs i and j are connected by a communication link and aij = 0 otherwise.
Assumption 2. Integral coeﬃcients kI,i are equal for all the DGUs (i.e. kI,i = kI, i = 1, . . . , N).
We assume bidirectional communication, i.e. aij = aji. Weights aij 6= 0 induce a communica-
tion graph Gc = (Vel,Ec, Wc) with unit weights, whose topology can be diﬀerent from that of Gel.
More precisely, we assume that DGUs i and j communicate if aij 6= 0, i.e. (i, j) ∈ Ec ⇐⇒ aij 6= 0.
From now on, we will make the following standing assumption.
Assumption 3. The graph Gel is weakly connected and the graph Gc is connected.

From a system point of view, the collective dynamics of the group of DGUs following (5) can

be expressed as

˙∆V = −KI L|{z}L

It,

(6)

where ∆V = [∆V1, . . . , ∆VN]T = V−Vref, Vref = [Vref,1, Vref,2, . . . , Vref,N]T , It = [It1, It2, . . . , ItN]T
collects the converter output currents, KI = diag(kI , . . . , kI) ∈ RN×N and L = L(Gc). Further-
more, my means of Assumption 2, L is a Laplacian matrix.

4 Modeling and analysis of the complete system
The hierarchical scheme of DGU i equipped with primary and secondary control loops is shown in
Figure 3. In order to assess the behavior of the overall closed-loop mG, we perform two separate
analysis where each PnP-controlled DGU is approximated either as an unit-gain or as a ﬁrst-order
transfer function.

6

Figure 3: Complete hierarchical control scheme of DGU i.

4.1 Unit-gain approximation of PnP-controlled DGUs
By approximating primary PnP loops with ideal unitary gains, we have the relations Vi = Vref,i +
∆Vi, ∀i ∈ Vel. This approximation is reasonable at low frequencies (see Remark 2). Furthermore,
it allows us to develop, in a simple setting, methods and tools that will be also used in the more
complex case considered in Section 4.2.

The resulting hierarchical control scheme is shown in Figure 4. In order to derive the dynamics
of the overall mG as a function of the inputs IL and Vref, we write relations among variables in
Figure 4a-4b. Hence, we have (6) and

V = ∆V + Vref .

(7)

From basic circuit theory, the relation between the vector of voltages V and the vector of line
currents I‘ = [I‘1, . . . , I‘M]T is

(8)
where W is the weight matrix of Gel and B = Q(Gel) is the incidence matrix of the mG. From
Figure 4, we also get
(9)

I‘ = −W BT V

It = IL − BI‘

and, merging equations (6)-(9), we ﬁnally obtain

˙∆V = −L BW BT

∆V − LIL − L BW BT

| {z }M

| {z }M

Vref

(10)

= −Q∆V − LIL − QVref

where matrix M = L(Gel) = BW BT is the Laplacian matrix of the electrical network and Q = LM.
The matrix Q can fail to have all properties typical of Laplacian matrices. For instance, the product
of two Laplacian matrices might be not symmetric and might have positive oﬀ-diagonal entries,
even though weights of Gel and Gc are positive. However, Q has several features in common with
Laplacian matrices, as shown in the next Proposition.
Proposition 2. The matrix Q has the following properties:

7

PnP	controllerSecondary	consensus	layerDGU	iDGU	jRL	filterline	ijViIti+-+-++NetworkVtiPrimary	control	layerCommunicationkijmnBuck	iItjItkCtiILi⌃ VikIsVref,i(a) Hierarchical control scheme.

(b) i-th ideal primary PnP loop.

(c) First-order approximation of the i-th PnP loop.

Figure 4: Hierarchical control scheme and primary PnP loops approximations.

(i) Ker(Q) = H1⊥;
(ii) Range(Q) = H1;
(iii) Q is diagonalizable and has real nonnegative eigenvalues;
(iv) the linear transformation Q(H1|H1) is invertible;
(v) the zero eigenvalue of Q has algebraic multiplicity equal to one.
Proof. We start proving point (ii). Since Ker(M) = H1⊥, one has MRN = M(H1⊥ ⊕ H1) = MH1.
Furthermore, from Proposition 1-(iv), MH1 = H1. Proposition 1 applied to the Laplacian L
shows that L(MRN) = H1, which is (ii).
For proving point (i), we notice that Ker(M) = H1⊥ and then Ker(LM) ⊃ H1⊥. From (ii) we
have that dim(Range(Q)) = N − 1 and then dim(Ker(Q)) = 1. Since dim(H1⊥) = 1, we have
Ker(LM) = H1⊥.
As regards statement (iii), from [33] we know the product of two complex positive semideﬁnite
matrices is diagonalizable and has nonnegative real eigenvalues. By construction, Laplacians L
and M are positive semideﬁnite in the real sense. Moreover, they are symmetric, hence they are
positive semideﬁnite also in the complex sense [20]. Consequently, from [33], we can conclude that
point (iii) holds true.
Finally, in order to prove (iv), we exploit Proposition 1. Notably, we have that the linear
transformations L(H1|H1) and M(H1|H1) are invertible. Since the composition of invertible
maps is invertible, point (iv) follows.
Indeed, since Q is diagonalizable, algebraic and
geometric multiplicity of null eigenvalues coincide. From point (i), since dim(H1⊥) = 1, we conclude
that the null eigenvalue of Q is unique.

Point (v) follows from points (iii) and (i).

4.1.1 Analysis of equilibria
In order to evaluate the steady-state behavior of the electrical signals appearing in Figure 4a-4b,
we study the equilibria (if any) of system (10). Hence, for given constant inputs (I∗
ref), we
compute the solutions ∆V∗ of equation

L, V∗

Q∆V∗ = −LI∗

L − QV∗

ref .

(11)

8

++++VrefV1V2VN V1 V2 VN.........I`1I`2 WBT BIL1IL2ILNItNIt1It2It1It2ItN...kIskIskIs˙ V1˙ V2˙ VN......PnP1PnP2PnPNI`MVrefVref++ L++Vref ViViPnPi-+!c˙ViV i1s!c++Vref ViViPnPiProposition 3. For equation (11),

(i) there is only one solution g∆V∗ ∈ H1;

(ii) all solutions ∆V∗ ∈ RN can be written as

∆V∗ = g∆V∗

+ α1N

α ∈ R.
(12)
ref ∈ H1. From Propo-
Proof. Proposition 2-(ii) shows that (11) has solutions only if −LI∗
For the proof of statement (ii), we split ∆V∗ ∈ RN as in (1), i.e. ∆V∗ = d∆V∗
sitions 1-(iii) and 2-(ii) this is always true. Statement (i) directly follows from Proposition 2-(iv).
From (11) and Proposition 2-(i), one has that, irrespectively of ∆V∗ = α1N ∈ H1⊥, Qd∆V∗
+ ∆V∗.
= g∆V∗
=
L − QV∗

L − QV∗
ref. Moreover, from the above part of the proof, it holds d∆V∗

−LI∗
Proposition 4. Consider system (10) with constant inputs (I∗
portional current sharing is achieved. Moreover, if V∗
α in (12) is equal to zero, then the equilibrium ∆V∗ ensures also voltage balancing.
Proof. At the equilibrium, from (6), we have that

ref). At the equilibrium, pro-
ref = Vref1N (i.e. Assumption 1 holds) and

L, V∗

.

since Ker(L) = H1⊥. Moreover, by substituting (8) in (9), it holds

I∗
t = ¯It1N ,

(13)

(14)
Li. Moreover, from
Li. Consequently, the current sharing condition (3) is veriﬁed. Let now ∆V∗ be an

From (14), since MV∗ ∈ H1 (see Proposition 1-(iii)), it follows hI∗
(13), ¯It = hI∗
equilibrium for system (10). Replacing (12) in (7) and averaging the obtained vector, we get

ti = hI∗

I∗
t = I∗

L + MV∗.

hV∗i = hg∆V∗i
| {z }=0

+ N α|{z}=0

+Vref ,

which is the voltage balancing condition (4).

Through Proposition 4, we have shown the features of the equilibria associated to particular
choices of inputs IL and Vref. Next, we prove the convergence of ∆V in (10) to the equilibrium
∗ = Vref1N), i.e.
ensuring both current sharing and voltage balancing (for constant IL
provide a condition that guarantees α in (12) is equal to zero.

∗ and Vref

4.1.2 Stability analysis
In order to proceed with the stability analysis of system (10), we consider the dynamics of projec-

tions PH1⊥(∆V) = ∆V and PH1(∆V) = d∆V.

Proposition 5. If ∆V veriﬁes

(15)

(16)

(17)

(

Σ :

˙∆V = −Q∆V − LIL − QVref

then ∆V = ∆V + d∆V, where ∆V ∈ H1⊥ and d∆V ∈ H1 fulﬁll

∆V(0) = ∆V0.

(

Σ :

˙∆V = 0N

and



bΣ :

∆V(0) = h∆V0i1N

˙d∆V = −Qd∆V − LIL − QVref
d∆V(0) = ∆V0 − ∆V0.

9

Proof. We write vectors ∆V(0), IL and Vref according to the decomposition (1), i.e. using

we analyze the dynamics of ∆V by averaging both sides of (15). From Proposition 2-(i), we
have h−Q∆Vi = h−QVrefi = 0. Since Range(L) = H1 (see Proposition 1-(iii)), we also have
h−LILi = 0, hence obtaining d

“bv " and “ v " for denoting their H1 and H1⊥ components, respectively. As described in [22],
Next, we analyze d∆V = ∆V − ∆V. We have
dth∆Vi = 0. Recalling that ∆V0 = h∆V0i1N, we obtain (16).
˙d∆V = ˙∆V − ˙∆V|{z}=0N

= −Q∆V − LIL − QVref

and d∆V(0) = ∆V0 − ∆V0. From Proposition 2-(i), Q∆V = Qd∆V and then we have (17).
Remark 3. The splitting of Σ into systems Σ and bΣ implies that the subspace H1 is invariant
for Σ and (IL, Vref) ∈ RN × RN. Recalling that LIL = 0N for IL ∈ H1⊥ and QVref = 0N for
Vref ∈ H1⊥, system Σ shows that the subspace H1⊥ is invariant for Σ and (IL, Vref) ∈ H1⊥ × H1⊥.
Consequently, in order to...

According to system Σ, the value of PH1⊥(∆V) = ∆V remains constant over time and equal
to ∆V0. Hence, in order to characterize the stability of equilibria (12), it is suﬃcient to study the
dynamics (17). In an equivalent way, one can consider system (15) and the following deﬁnition of
stability on a subspace.
Deﬁnition 3. Let V be a subspace of Rn. The origin of ˙x = Ax, x(t) ∈ Rn is Globally Exponen-
tially Stable (GES) on V if ∃κ, η > 0 : kPV x(t)k ≤ κe−ηtkPV x(0)k. The parameter η is termed
rate of convergence.

Note that Σ is a linear system and, for stability analysis, we can neglect inputs, hence obtaining

(

˙∆V = −Q∆V
∆V(0) = ∆V0.

(18)

Theorem 1. The origin of (18) is GES on H1. Moreover, the rate of convergence is the smallest
strictly positive eigenvalue of Q.
Proof. The proof of Theorem 1 is reported in Appendix A.

From the above results, we can conclude that, given an initial condition ∆V0 for system
∗ and Vref = Vref1N, the state ∆V will converge to the

(15) and applying constant inputs IL
equilibrium (12) with α = h∆V0i.
Corollary 1. The conditions that ensure asymptotic current sharing and voltage balancing for
system (15) are Assumption 1 and

h∆V0i = 0.
Proof. The proof directly follows from Proposition 4.

(19)

4.2 First-order approximation of PnP-controlled DGUs
In this Section, we adopt a less restrictive approximation of DGUs equipped with primary PnP
regulators, and provide conditions guaranteeing current sharing and voltage balancing in the
asymptotic régime. Figure 4a-4c shows the overall closed-loop scheme of an mG equipped with (i)
consensus current loops and (ii) local control loops (each given by a DGU and the corresponding
PnP controller) modeled as ﬁrst-order transfer functions. Diﬀerently from the case analyzed in
Section 4.1, each local dynamics is now described by means of two states which are the state of the
consensus current loop (∆Vi) and the state of the controlled DGU (Vi in Figure 4c). We highlight
that relations (6) and (7) still hold, while the additional state equation is

˙V = ΩV◦ − ΩV,

10

(20)

1 , V ◦

N]T and V belong to RN, and the diagonal matrix Ω = ωcI ∈
where vectors V◦ = [V ◦
RN×N, ωc > 0, collects on its diagonal the approximate bandwidth of each controlled DGU. In
view of Remark 2, assuming equal approximate bandwidths for all the controlled DGUs is a mild
constraint.

2 , . . . , V ◦

Similarly to the simpliﬁed case in Section 4.1, in order to ﬁnd the dynamics of the closed-loop

scheme, we write relations among mG variables. From Figure 4a, we notice that (6) holds, and

V◦ = ∆V + Vref .

(21)

Always from Figure 4a, we have that, for line and output currents, equations (8) and (9) are still
valid. By merging relations (6), (21), (20), (8) and (9), we can write the dynamics of the overall
mG as

or, equivalently, in compact form,

˙V = Ω∆V − ΩV + ΩVref ,

( ˙∆V = −QV − LIL
(cid:20)∆V
(cid:21)
(cid:20)0N −Q
(cid:21)
{z
}
|

Ω −Ω

V

=

Q

(cid:20) ˙∆V

(cid:21)

˙V

(cid:20)0N −L

Ω −Ω

(cid:21)

(cid:21)(cid:20)Vref

IL

,

+

(22a)
(22b)

(23)

(24a)
(24b)

(25)

(26)

with Q ∈ R2N×2N and [∆VT VT ]T ∈ RN × RN.

4.2.1 Analysis of equilibria
Similarly to Section 4.1.1, we study the equilibria of system (22). For this purpose, given the
constant inputs (IL

∗), we compute the solutions [∆V∗T , V∗T ]T to the system

∗, Vref

(cid:26)QV∗ = −LI∗

L

0N = Ω∆V∗ − ΩV∗ + ΩV∗

ref .

Since matrix Ω is invertible, equation (24b) becomes

V∗ = ∆V∗ + V∗

ref .

By substituting (25) in (24a), we get

Q∆V∗ = −LI∗

L − QV∗

ref .

that is exactly (11). We can then exploit Proposition 3 for concluding that there are inﬁnitely
many solutions ∆V∗ ∈ RN in the form (12). Replacing (12) in (25), we can write equilibria of
system (22) as

(cid:21)

(cid:20) ∆V∗

V∗

=

" d∆V∗
d∆V∗

#

.

+ α1N

+ α1N + V∗
ref
Proposition 6. Consider system (22) with constant inputs I∗
L and V∗
current sharing is achieved. Moreover, if V∗
is equal to zero, then the equilibrium [∆V∗T , V∗T ]T guarantees also voltage balancing.
Proof. Since equation (6) holds, one has that, at the equilibrium, relation (13) is veriﬁed. Then,
the proof is the same as the one of Proposition 4.

ref. At the equilibrium,
ref1N (i.e. Assumption 1 holds) and α in (26)

ref = V ∗

11

=

+

V
v

(cid:21)
}

#
}

,

" d∆VbV
{z
|

4.2.2 Stability analysis
Proposition 7. If [∆VT VT ]T veriﬁes (22), then

(cid:20) ∆V
(cid:20) ∆V
(cid:21)
{z
}
|
|
{z
 ˙∆V = 0N
where ¯v ∈ H1⊥ × H1⊥ and ˆv ∈ H1 × H1 fulﬁll
˙V = Ω∆V − ΩV + ΩVref
 ˙d∆V = −QbV − LIL
˙bV = Ωd∆V − ΩbV + ΩdVref ,

eΣ1⊥ :
eΣ1 :

V
¯v

and

ˆv

respectively.

Proof. The dynamics of ∆V and d∆V can be derived proceeding as in the proof of Proposition 5.
and bV.

In a similar way, by averaging both sides of (22b), one derives the (independent) dynamics of V

analyzing dynamics (27) and (28), i.e.
ˆv = PW(v), with V = H1⊥ × H1⊥ and W = H1 × H1.

The above decomposition allows us to evaluate the evolution of state v on RN×N by separately
studying the behavior of projections ¯v = PV(v) and
First we focus on ˜Σ1⊥. Without loss of generality, for stability analysis we can neglect the input

vector Vref in (27b), thus having: ( ˙∆V = 0N

˙V = Ω∆V − ΩV.

(27a)
(27b)

(28a)
(28b)

(29a)
(29b)

(31)

By construction, (29b) collects the decoupled equations

˙V i = ωc∆Vi − ωcV i

(30)
where, according to (27a), each term ∆Vi in can be treated as an exogenous input (thus not
aﬀecting stability properties). It follows that dynamics (30) is asymptotically stable, since ωc > 0.
In summary, system (27) tells us that the average ∆V will remain constant in time (and equal to

h∆V0i), while V will converge to the origin. For studying stability properties of system eΣ1, we

∀i = 1, . . . , N,

consider (22) without inputs, i.e.

( ˙∆V = −QV

˙V = Ω∆V − ΩV

and analyze stability on H1 × H1. We have the following result.
Theorem 2. The origin of (31) is GES on H1 × H1. Furthermore, matrix Q has a simple zero
eigenvalue and the rate of convergence is the maximum among real parts of all other eigenvalues.
Proof. The proof is given in Appendix B.

By means of Theorem 2, we have that, given an initial condition [∆V0T V0T ]T for system

(22), the state [∆VT VT ]T will converge to the equilibrium in (26). with α = h∆V0i
Corollary 2. The conditions that ensure asymptotic current sharing and voltage balancing for
system (22) are Assumption 1 and (19).
Proof. The proof follows from Proposition 6.

12

When a DGU (say DGU i) sends a plug-in request at a time ¯t, a set N c

4.3 PnP design of secondary control
We now describe the procedure for designing secondary controllers in a PnP fashion.
i of “communication
neighbors” with aij = 1,∀j ∈ N c
i , is also chosen in order to design local consensus ﬁlters (6).
Theorems 1 and 2 ensure that the mG is GES over suitable subspaces, independently of N c
i . Let
Assumption 1 hold for all the interconnected DGUs in the mG before ¯t and let us denote the
common reference voltage by Vref. If DGU i sets Vref,i = Vref, then, according to Propositions 4
and 6, current sharing and voltage balancing are guaranteed in the asymptotic régime. Moreover,
by choosing ∆Vi(¯t) = 0, we have h
i = 0, where ∆V0(¯t) is the vector ∆V prior the
plugging in of DGU i. Therefore, by means of Corollaries 1 and 2, voltage balancing is guaranteed.
Similarly, when a DGU (say DGU j) is unplugged at time ¯t, provided that the new graphs Gc
and Gel fulﬁll Assumption 3, the key condition that must be guaranteed is that the vector ∆V−j
(i.e. ∆V without element j) veriﬁes h∆V−j(¯t)i = 0. If h∆V(¯t−)i = 0, this can be achieved by
re-setting

(cid:20) ∆V0(¯t)

∆Vi(¯t)

(cid:21)

∆Vi(¯t) = ∆Vi(¯t−) + ∆Vj(¯t−)
j |
|N c
j , and keeping ∆Vi(¯t) = ∆Vi(¯t−) for all i /∈ N c
j ∪ {j}. Indeed, this yields
X
∆Vi(¯t)
X

∆Vi(¯t) + 1
N − 1

∆Vj(¯t−) + X

X
X
∆Vi(¯t−) + 1
|N c
j |
(cid:0)Nh∆V(¯t−)i(cid:1) = 0.

∆Vi(¯t−)

= 1

N − 1

j ∪{j}

i /∈N c

j ∪{j}

i∈N c

j

i /∈N c

i∈N c

j

i∈N c

j

 =

for all i ∈ N c

h∆V−j(¯t)i = 1
N − 1

= 1

N − 1

5 Simulation results
In this Section, we assess the capability of the proposed control scheme to guarantee current
sharing and voltage balancing while preserving overall voltage stability when plug-in of DGUs or
load changes occur. Simulations have been performed in Simulink/PLECS.

We consider an mG composed of 5 DGUs, arranged as in Figure 5. Notice that some DGUs
have more than one neighbor, hence load disturbances inﬂuencing their dynamics will be greater.
Moreover, the presence of a loop in the electrical network further complicates voltage regulation.
We highlight that the considered mG is composed of nonidentical DGUs and heterogeneous power
lines. All the electrical and control parameters are collected in Tables 2 and 3 in Appendix C,
respectively. Furthermore, Assumption 1 holds, with Vref = 48 V.

We show two simulations, assuming diﬀerent communication graphs. Both scenarios are di-

vided into 4 stages, as shown in Figure 5.

5.1 Scenario 1
In the following, we describe in details Figure 7, which illustrates the evolution of the main electri-
cal quantities (i.e. DGU output currents, PCC voltages and averaged PCC voltage, respectively)
when Gc and Gel have the same topology. At time t0 = 0, all the DGUs are assumed to be isolated
and only the primary PnP voltage regulators are active. Therefore, as shown in stage 1, (i) each
DGU supplies its local load while keeping the corresponding PCC voltage at 48 V, and (ii) the
DGU output currents are diﬀerent. Notice that DGUs 1-4 are equipped with controllers C[i] de-
signed by taking into account couplings among them. This is possible because, as shown [10], local
PnP controllers stabilize the mG also in absence of couplings. Because of this, when stage 2 starts
(at time t1 = 5 s) and subsystems 1-4 are connected together, no update of controllers is needed.

13

Figure 5: Simulation stages: numbered nodes represent DGUs and black lines denote power
lines. The small circle next to each DGU is green if the secondary control layer is active for
the corresponding unit, red otherwise. Open switches in stages 1 and 2 denote DGUs that are
disconnected. The arrow in stage 4 represents a step up in the load current of DGU 1.

At time t1, we also activate the secondary control layer for DGUs 1-4, thus ensuring asymptotic
current sharing among them according to their capacities (see the plot of It, stage 2). This is
achieved by adjusting the voltages at PCC (as shown in the plot of VP CC, stage 2). Furthermore,
by setting ∆Vi(t1) = 0, i = 1, . . . , 4 as described in Section 4.3, condition (19) of Corollaries 1 and
2 are fulﬁlled and asymptotic voltage balancing, when DGUs 1-4 are interconnected, is guaranteed
(see Vav during stage 2).
For evaluating the PnP capabilities of our control scheme, at t2 = 25 s, stage 3 starts with
DGU 5 sending a plug-in request to DGU 4. Previous controllers C[4] and C[5] still fulﬁll the
plug-in conditions in [10]: they are therefore maintained and the plug-in of DGU 5 is performed.
At the same time, the secondary controller of DGU 5 is activated, and then the DGU contributes
to current sharing. This can be noticed in Figure 7, stage 3, as all PCC voltages change in order
to let the output currents of DGUs 1-5 converge to a common value. Furthermore, by setting
∆V5(t2) = 0 (as described in Section 4.3), we can maintain the average PCCs voltage at 48 V (see
Vav, stage 3).

Finally, at t3 = 50 s (stage 4), we halve the load of DGU 1, thus increasing the corresponding
load current IL1 and causing a peak in the corresponding output current. However, after few sec-
onds, all the DGUs share again the total load current, while the averaged PCCs voltage converges
to the reference value.

5.2 Scenario 2
In this second scenario, we assume all-to-all communication among DGUs. The simulation time
events are summarized in Table 1.

Time [s]
t0 = 0
t1 = 5
t2 = 16
t3 = 30
t4 = 40

Event

Start simulation
stage 1 → stage 2
stage 2 → stage 3
stage 3 → stage 4
End simulation

Table 1: Scenario 2 - Simulation time events.

14

Figure 6: Scenario 1 - Evolution of the output currents, voltages at PCCs and averaged PCCs
voltage. Colored lines in the plots of It and VP CC are used to denote the DGUs quantities according
to Figure 5. Simulation stages are the same as in Figure 5.

Figure 7 shows the evolution of the main electrical quantities. We notice that the proposed con-
trol schemes is capable to guarantee all the desired properties (i.e. overall mG stability, robustness
to load changes, current sharing and voltage balancing). As expected, a full-connected communi-
cation graph ensures faster convergence of the output currents when the secondary control layer
is activated (see stages 2, 3 and 4 in Figure 7).

6 Conclusions
In this paper, a secondary consensus-based control layer for guaranteeing current sharing and
voltage balancing in DC mGs has been presented. Besides overall mG stability, current sharing and
voltage balancing have been rigorously proved in the asymptotic régime. Moreover, we presented
a method for designing secondary controllers in a PnP fashion when DGUs are added. As regards
future developments, communication delays [34, 35], may be included in the mathematical analysis,
as well as more complex consensus controllers (e.g. proportional-integral regulators) for enhancing
the convergence speed.

15

Figure 7: Scenario 2 - Evolution of the output currents, voltages at PCCs and averaged PCCs
voltage. Colored lines in the plots of It and VP CC are used to denote the DGUs quantities according
to Figure 5. Simulation stages are the same as in Figure 5.

16

A Proof of Theorem 1
We introduce a preliminary Lemma, mainly taken from [23].
Lemma 1. For A ∈ Rn×n, let V and W be A-invariant subspaces of Rn such that dim(V) = k,
dim(W) = n − k and Rn = V ⊕ W. Then:

I) there is a matrix T ∈ Rn×n such that A = T −1AT has the block-diagonal structure

(cid:20) kz}|{

A11
0

z}|{
(cid:21) } k

n − k
ii0ii
A22

} n − k

A =

In particular, if {b1, . . . , bk} and {bk+1, . . . , bn} are basis for V and W, respectively, the
transformation matrix T has the block structure

Therefore, if x ∈ V, then T −1x =

with ˜x1 ∈ Rk. Similarly, if x ∈ W, then T −1x =

T = [b1|···|bk|bk+1|···|bn].

(cid:21)

(cid:20) ˜x1

0

(32)

(33)

(cid:21)

(cid:20) 0

˜x2

with ˜x2 ∈ Rn−k.

(cid:20) ˜x1
(cid:21)
(cid:20) ˜x1

˜x2

0

II) The origin of ˙x = Ax is GES on V if and only if the origin of ˙˜x1 = A11˜x1 is GES. More-
over, parameters κ, η > 0 verifying k˜x1(t)k ≤ κe−ηtk˜x1(0)k, also guarantee kPV x(t)k ≤
κe−ηtkPV x(0)k.

Proof. For the proof of Point I, we defer the reader to the proof of Theorem 19 in [23].

The proof of Point II directly follows from the block-diagonal structure of matrix A in (32).

Indeed,

˙x = Ax ⇔ ˙˜x = A

(cid:21)

⇔

( ˙˜x1 = A11˜x1

˙˜x2 = A22˜x2,

i.e. A11 is the matrix representation of the map A(V|V). In other words, studying the stability of
A on V is equivalent to study the stability of A11.

Moreover, by construction, PV(x) = T

. Then

kPV(x(t))k ≤ kTkk˜x1(t)k ≤ kTkκe−ηtk˜x1(0)k.

(34)

Since k˜x1(0)k ≤ kT −1kkPV(x(0))k, inequality (34) becomes

kPV(x)k ≤ kTkκe−ηtk˜x1(0)k ≤ κe−ηtkPV(x(0))k.

Proof of Theorem 1. Points (i) and (ii) of Proposition 2 show that subspaces H1 and H1⊥
are Q-invariant. Moreover, RN = H1 ⊕ H1⊥. It follows that Lemma 1 can be applied with V = H1
and W = H1⊥. In particular, by means of point (I), we know that there exists a transformation
matrix T ∈ RN×N such that the linear map Q can be represented as in (32). Denoting with
B1 = {b1, . . . , bN−1} and B1⊥ = 1N the basis for H1 and H1⊥, respectively, from (33), we have

Matrix Q = T −1QT is given by

Q =

T = [b1|···|bN−1|1N].

(cid:20)Q11

0

(cid:21)

0
q22

17

(35)

prove that the origin of

where Q11 ∈ R(N−1)×(N−1). Moreover, scalar q22 = 0 since, by construction, it represents the

map Q(H1⊥|H1⊥). We notice that the representations of d∆V and ∆V with respect to the basis B
are ˜v1 = T −1d∆V = [ξ1, . . . , ξN−1, 0]T and ˜v⊥ = T −1∆V = [0, . . . , 0, ξN]T , respectively. Now we

(36)
is GES. Since Q and Q are similar matrices, they have the same eigenvalues. Therefore, from
Proposition 2-(iii), all eigenvalues of Q11 are strictly positive. This shows that (36) is GES and,
as shown in [23], the convergence rate is −λ, where λ is the minimal eigenvalue of Q11. The
remainder of the proof follows directly from point II of Lemma 1.

2

˙˜v1 = −Q11˜v1

B Proof of Theorem 2
We ﬁrst present two Propositions which provide preliminary results that will be used to prove
Theorem 2.
Proposition 8. Subspaces H1 × H1 and H1⊥ × H1⊥ are Q-invariant.
(cid:21)
Proof. We ﬁrst show that, for any vector ˆv = [ˆvT1 ˆvT2 ]T , it holds Qˆv ∈ H1 × H1. Indeed,

(cid:21)

(cid:20) Qˆv1

(cid:20)0N −Q

Ω −Ω

(cid:21)(cid:20)ˆv1

ˆv2

Qˆv =

=

Ω(ˆv1 − ˆv2)

,

and, from Proposition 2-(iv), the rightmost vector belongs to H1 × H1.

Similarly, for any vector ¯v = [¯vT1 ¯vT2 ]T ∈ H1⊥ × H1⊥, we have that

(cid:20)0N −Q

Ω −Ω

(cid:21)(cid:20)¯v1

(cid:21)

¯v2

(cid:20)

=

0N

Ω(¯v1 − ¯v2)

(cid:21)

Qˆv =

and then Q¯v ∈ H1⊥ × H1⊥.
Proposition 9. Matrix Q has two eigenvalues equal to zero and −ωc, respectively. All other
eigenvalues have strictly negative real part.
Proof. By deﬁnition, vector [∆VT VT ]T 6= 02N is an eigenvector of Q, if there exists λi such that

(cid:20)0 −Q

Ω −Ω

(cid:21)(cid:20)∆V

(cid:21)

V

(cid:20)∆V

(cid:21)

.

V

= λi

(37)

(38a)
(38b)

(39)

From (37), one gets:

−QV = λi∆V

ωc(d∆V − V) = λiV.

By isolating ∆V in (38b) and substituting it in (38a), we obtain

−QV = λi(λi + ωc)
}

|

ωc

{z
bλi

V.

where ˆλi are, by construction, eigenvalues of −Q. From points (iii) and (v) of Proposition 2, we
have

ˆλN = 0
ˆλi = −γi, γi > 0

i = 1, . . . , N − 1.

(40a)
(40b)

18

From (40a) and (39), one has

λi(λi + ωc) = 0

and hence Q has a single eigenvalue equal to zero and an eigenvalue equal to −ωc. By substituting
in (40b) the expression of ˆλi in (39), one gets:

λ2
i
ωc

+ λi + γi = 0

i = 1, . . . , N − 1.

(41)

Since all the coeﬃcients of the polynomial in (41) are strictly positive, we can conclude that matrix
Q has 2(N − 1) eigenvalues with Re(λi) < 0.

Proof of Theorem 2. Similarly to the proof of Theorem 1, we can exploit Lemma 1 with
V = H1 × H1 and W = H1⊥ × H1⊥. In fact, we know that (i) subspaces H1 × H1 and H1⊥ × H1⊥ are
Q-invariant (see Proposition 8) and (ii) RN × RN = V ⊕ W. Hence, there exists a transformation
matrix T ∈ R2N×2N such that the linear map Q has an equivalent block-diagonal representation
of the form (32), i.e.

T −1QT = Q =

(42)
By construction, matrices Q11 and Q22 in (42) represent the maps Q(V|V) and Q(W|W), respec-
tively. In particular, in the light on the consideration made for system (27), we have that the
eigenvalues of Q22 are zero and −ωc. Moreover, by construction, the eigenvalues of Q11 are the
2(N − 1) eigenvalues of Q with strictly negative real part (see Proposition 9).

} 2

Q11
0

2

2z}|{
z}|{
(cid:20)2(N − 1)

(cid:21) } 2(N − 1)

ii0ii
Q22

C Electrical and simulation parameters
In this appendix, we provide the electrical and control parameters of Scenarios 1 and 2, described
in Section 5.

19

Table 2: Electrical setup and line parameters

Converter and output ﬁlter parameters

Input/Output DC voltage (V)

100/48

DGU
ˆΣDGU
[1]
ˆΣDGU
[2]
ˆΣDGU
[3]
ˆΣDGU
[4]
ˆΣDGU
[5]

Resistance Rt(Ω) Capacitance Ct(mF)

Inductance Lt(mH)

0.2
0.3
0.1
0.5
0.4

2.2
1.9
1.7
2.5
2.0

1.8
2.0
2.2
3.0
1.3

Connected DGUs (i, j)

Tie lines parameters
Resistance Rs(Ω)

Inductance Ls(µH)

(1, 3)
(2, 3)
(2, 4)
(3, 4)
(4, 5)

0.07
0.04
0.08
0.07
0.05

2.1
2.3
1.8
1
2

Table 3: Primary and secondary control layer parameters.

Primary PnP control layer

K1jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj
K2jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj
K3jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj
K4jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj
K5jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj

[−2.134 − 0.163 13.553]
[−0.869 − 0.050 48.285]
[−0.480 − 0.108 30.673]
[−6.990 − 0.175 102.960]
[−0.101 − 0.010 16.393]

Secondary consensus layer

Scenario 1
0.02

kI

Scenario 2
0.01

kI

20

References
[1] A. Ipakchi and F. Albuyeh, “Grid of the future,” Power and Energy Magazine, IEEE, vol. 7,

no. 2, pp. 52–62, 2009.

[2] N. Hatziargyriou, H. Asano, R. Iravani, and C. Marnay, “Microgrids,” Power and Energy

Magazine, IEEE, vol. 5, no. 4, pp. 78–94, July 2007.

[3] R. Lasseter, “Microgrids,” in Power Engineering Society Winter Meeting, 2002. IEEE, vol. 1,

2002, pp. 305–308 vol.1.

[4] J. M. Guerrero, M. Chandorkar, T.-L. Lee, and P. C. Loh, “Advanced control architectures
for intelligent microgrids - part I: decentralized and hierarchical control,” IEEE Transactions
on Industrial Electronics, vol. 60, no. 4, pp. 1254–1262, 2013.

[5] J. M. Guerrero, P. C. Loh, T.-L. Lee, and M. Chandorkar, “Advanced control architectures for
intelligent microgrids - part II: Power quality, energy storage, and ac/dc microgrids,” IEEE
Transactions on Industrial Electronics, vol. 60, no. 4, pp. 1263–1270, 2013.

[6] S. Riverso, F. Sarzo, and G. Ferrari-Trecate, “Plug-and-play voltage and frequency control of
islanded microgrids with meshed topology,” IEEE Transactions on Smart Grid, vol. 6, no. 3,
pp. 1176–1184, May 2015.

[7] S. Bolognani and S. Zampieri, “A distributed control strategy for reactive power compensation
in smart microgrids,” IEEE Transactions on Automatic Control, vol. 58, no. 11, pp. 2818–
2833, 2013.

[8] T. Dragicevic, X. Lu, J. Vasquez, and J. Guerrero, “Dc microgrids–part i: A review of control

strategies and stabilization techniques,” 2015.

[9] J. M. Guerrero, J. C. Vasquez, J. Matas, D. Vicuna, L. García, and M. Castilla, “Hierarchical
control of droop-controlled ac and dc microgrids—a general approach toward standardiza-
tion,” IEEE Transactions on Industrial Electronics, vol. 58, no. 1, pp. 158–172, 2011.

[10] M. Tucci, S. Riverso, J. C. V. Quintero, J. M. Guerrero, and G. Ferrari-Trecate, “Voltage con-
trol of dc islanded microgrids: a decentralized scalable approach,” in 54th IEEE Conference
on Decision and Control.

IEEE, 2015, pp. 3149–3154.

[11] J. M. Guerrero, J. C. Vasquez, J. Matas, L. G. De Vicuña, and M. Castilla, “Hierarchical
Control of Droop-Controlled AC and DC Microgrids — A General Approach Toward Stan-
dardization,” IEEE Transactions on Industrial Electronics, vol. 58, no. 1, pp. 158–172, 2011.
[12] L. Meng, T. Dragicevic, J. Roldan-Perez, J. C. Vasquez, and J. M. Guerrero,
“Modeling and sensitivity study of consensus algorithm-based distributed hierarchical
control for dc microgrids,” IEEE Transactions on Smart Grid, 2015. [Online]. Available:
http://vbn.aau.dk/ﬁles/209623112/CA_based_DCMG_modeling_0409.pdf

[13] L. Meng, J. C. Vasquez, J. M. Guerrero, and T. Dragicevic, “Agent-based distributed hierar-

chical control of dc microgrid systems,” Electrimacs 2014, pp. 281–286, 2014.

[14] A. Maknouninejad, Z. Qu, F. L. Lewis, and A. Davoudi, “Optimal, nonlinear, and distributed
designs of droop controls for dc microgrids,” IEEE Transactions on Smart Grid, vol. 5, no. 5,
pp. 2508–2516, 2014.

[15] Q. Shaﬁee, T. Dragicevic, F. Andrade, J. C. Vasquez, and J. M. Guerrero, “Distributed
consensus-based control of multiple dc-microgrids clusters,” in Industrial Electronics Society,
IECON 2014-40th Annual Conference of the IEEE.

IEEE, 2014, pp. 2056–2062.

[16] J. Zhao and F. Dörﬂer, “Distributed control and optimization in dc microgrids,” Automatica,

vol. 61, pp. 18–26, 2015.

21

[17] M. Andreasson, D. V. Dimarogonas, H. Sandberg, and K. H. Johansson, “Control of mtdc
transmission systems under local information,” in Decision and Control (CDC), 2014 IEEE
53rd Annual Conference on.

IEEE, 2014, pp. 1335–1340.
[18] J. Allmeling and W. Hammer, “Plecs-user manual,” 2013.
[19] R. Grone, R. Merris, and V. S. Sunder, “The Laplacian spectrum of a graph,” SIAM Journal

on Matrix Analysis and Applications, vol. 11, no. 2, pp. 218–238, 1990.

[20] M. C. Pease, Methods of matrix algebra. Academic Press New York, 1965.
[21] A. Bensoussan and J.-L. Menaldi, “Diﬀerence equations on weighted graphs,” Journal of

Convex Analysis, vol. 12, no. 1, pp. 13–44, 2005.

[22] G. Ferrari-Trecate, A. Buﬀa, and M. Gati, “Analysis of coordination in multi-agent systems
through partial diﬀerence equations,” IEEE Transactions on Automatic Control, vol. 51, no. 6,
pp. 1058–1063, June 2006.

[23] F. M. Callier and C. A. Desoer, Linear system theory. Springer Science & Business Media,

2012.

[24] R. Agaev and P. Chebotarev, “On the spectra of nonsymmetric laplacian matrices,” Linear

Algebra and its Applications, vol. 399, pp. 157–168, 2005.

[25] R. Diestel, Graph theory. Springer-Verlag Berlin and Heidelberg GmbH & amp, 2000.
[26] S. Lang, “Linear algebra. undergraduate texts in mathematics,” 1987.
[27] Q. Shaﬁee, T. Dragičević, J. C. Vasquez, and J. M. Guerrero, “Modeling, Stability Analysis
and Active Stabilization of Multiple DC-Microgrid Clusters,” in Proceedings of the IEEE
International Energy Conference (ENERGYCON), Dubrovnik, Croatia, May 13-16, 2014,
pp. 1284–1290.

[28] M. Babazadeh and H. Karimi, “A Robust Two-Degree-of-Freedom Control Strategy for an
Islanded Microgrid,” IEEE Transactions on Power Delivery, vol. 28, no. 3, pp. 1339–1347,
2013.

[29] V. Venkatasubramanian, H. Schattler, and J. Zaborszky, “Fast Time-Varying Phasor Analysis
in the Balanced Three-Phase Large Electric Power System,” IEEE Transactions on Automatic
Control, vol. 40, no. 11, pp. 1975–1982, 1995.

[30] F. Dörﬂer and F. Bullo, “Kron reduction of graphs with applications to electrical networks,”
IEEE Transactions on Circuits and Systems I: Regular Papers, vol. 60, no. 1, pp. 150–163,
2013.

[31] M. Tucci, A. Floriduz, S. Riverso, and G. Ferrari-Trecate, “Kron reduction methods for
plug-and-play control of ac islanded microgrids with arbitrary topology,” arXiv preprint
arXiv:1510.07873, 2015.

[32] R. Olfati-Saber and R. M. Murray, “Consensus problems in networks of agents with switching
topology and time-delays,” IEEE Transactions on Automatic Control, vol. 49, no. 9, pp. 1520–
1533, 2004.

[33] Y. Hong and R. A. Horn, “The Jordan cononical form of a product of a hermitian and a
positive semideﬁnite matrix,” Linear Algebra and Its Applications, vol. 147, pp. 373–386,
1991.

[34] P.-A. Bliman and G. Ferrari-Trecate, “Average consensus problems in networks of agents with

delayed communications,” Automatica, vol. 44, no. 8, pp. 1985–1995, 2008.

22

[35] L. Meng, T. Dragicevic, J. M. Guerrero, and J. C. Vasquez, “Dynamic consensus algorithm
based distributed global eﬃciency optimization of a droop controlled dc microgrid,” in Energy
Conference (ENERGYCON), 2014 IEEE International.

IEEE, 2014, pp. 1276–1283.

23

