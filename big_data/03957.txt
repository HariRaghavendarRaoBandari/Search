Theory of Finite Size Eﬀects for Electronic Quantum Monte Carlo Calculations of

Liquids and Solids

Markus Holzmann123, Raymond C. Clay III4, Miguel A. Morales5,

Norm M. Tubman4, David M. Ceperley4, and Carlo Pierleoni6

1LPTMC, UMR 7600 of CNRS, Universit´e Pierre et Marie Curie, F-75005 Paris, France

2LPMMC, UMR 5493 of CNRS, Universit Grenoble Alpes, F-38042 Grenoble, France

3Institut Laue-Langevin, BP 156, F-38042 Grenoble Cedex 9, France
4University of Illinois Urbana-Champaign,Urbana, Illinois 61801, USA

5Lawrence Livermore National Laboratory, Livermore, California 94550, USA

6Department of Physical and Chemical Sciences,

University of L’Aquila, Via Vetoio 10, I-67010 L’Aquila, Italy

(Dated: March 16, 2016)

Concentrating on zero temperature Quantum Monte Carlo calculations of electronic systems, we
give a general description of the theory of ﬁnite size extrapolations of energies to the thermodynamic
limit based on one and two-body correlation functions. We introduce new eﬀective procedures, such
as using the potential and wavefunction split-up into long and short range functions to simplify the
method and we discuss how to treat backﬂow wavefunctions. Then we explicitly test the accuracy
of our method to correct ﬁnite size errors on example hydrogen and helium many-body systems and
show that the ﬁnite size bias can be drastically reduced for even small systems.

PACS numbers:

Quantum Monte Carlo (QMC) methods allow us to calculate the energy per particle EN of a ﬁnite system containing
N particles, with N (cid:46) 103 for almost all simulations of electronic systems [1, 2]. However, for extended systems, we are
often interested in scaling to the thermodynamic limit, E∞; this scaling is one of the major source of bias in Quantum
Monte Carlo calculations of electronic structure. In practice, extrapolation is often performed numerically by assuming
simple functional forms for EN as a function of 1/N , often inspired by results of approximate theories, such as Kohn-
Sham DFT [3–5] or from the behavior of approximate many-body calculations, e.g. from RPA calculations [6]. These
heuristic extrapolations can be dangerous and introduce a possible systematic bias, as the exact ground state energy,
as well as other properties, are in general not a simple analytic function of 1/N . In fact, the scaling function will
depend on the electronic state, for example, it will be diﬀerent in a metal and an insulator, and can depend on the
form of the trial wave function underlying the QMC calculation.
In addition, within variational approaches, the
amount that the variational energy is above the exact energy may depend on the system size because of the values of
the variational parameters. This introduces a further source of error in a purely numerical extrapolation. Projection
methods can reduce this bias, since they are closer to the true ground state energy, but in practice it can be a diﬃcult
problem to ensure a uniform convergence concerning projection time or population size with respect to the system
size [7].

In this paper we present a general theory for understanding the ﬁnite size bias of QMC calculations. Although
we concentrate on electronic systems where ﬁnite size eﬀects represent one of the major limitations, our approach
applies equally well to other quantum systems with diﬀerent interactions and dimensionality, including bosonic ones.
As we will show, the leading order size eﬀects can be understood by looking at the analytical structure of the trial
wavefunction [8, 9] which is – at least partially – determined by singularities of the Hamiltonian and/or the boundary
conditions [10–12]. Diﬀerent types of wavefunction will, in general, have diﬀerent types of size eﬀects. In particular,
we show that backﬂow wavefunctions give rise to kinetic energy corrections which have not been considered previously.
Size eﬀects depend on the observable we are interested in. In this paper we focus on one of the most fundamental
quantities, the total energy [8, 13–15]. However, the ideas can be generalized to determine the ﬁnite size eﬀects of
diﬀerent observables such as the momentum distribution[16–19].

The paper is organized as follows. Section I is a general introduction to ﬁnite size eﬀects of quantum systems.
Focusing on electronic calculations we systematically discuss the origins of size eﬀects for the kinetic and potential
energies. In Section II we propose robust procedures to estimate the ﬁnite size bias in electronic structure calculations.
In Section III, we apply our method to QMC calculations of b.c.c. solid hydrogen with diﬀerent underlying trial
wavefunctions and calculations of liquid hydrogen and hydrogen-helium mixtures. Conclusions are presented in
Section IV. Technical aspects concerning the long-range character of the Jastrow potential, the backﬂow corrections
and details of the split-up of the long and short-range part of the potential energy via the Ewald potential are given
in the Appendices.

6
1
0
2

 
r
a

 

M
5
1

 
 
]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[
 
 

2
v
7
5
9
3
0

.

3
0
6
1
:
v
i
X
r
a

I.

INTRODUCTION TO FINITE SIZE ESTIMATION

Consider Na particles of species a = 1, . . . M with mass ma described by the Hamiltonian H = T + V where

Na(cid:88)
T = − M(cid:88)
2
(cid:88)
(cid:88)
2ma
vaa(ria − rja ) +

∇2

V =

a=1

i=1

ia

a

ia<ja

(cid:88)

(cid:88)

a<b

ia,jb

vab(ria − rjb )

are kinetic and potential energy operators. Here, ria are the coordinates of species a, vaa (vab) are the intra (inter)
species potentials. The energy per particle is then

EN = (cid:104)H(cid:105)0/N

(3)
where (cid:104). . .(cid:105)0 denotes its expectation value in the state Ψ0(R). Here, R indicates the coordinates of all particles and
we take the normalization N to be the total number of electrons, N = Ne, but it must be proportional to the volume,
Ω; one takes the thermodynamic limit so that the density is ﬁxed in the limit of N → ∞.
ab (r1, r2; r(cid:48)

Since the Hamiltonian only involves single and two-body potentials, we can express the total energy in terms of the
2) (in the latter we will
2). We write the reduced density matrices in Fourier space in

a (r; r(cid:48)) and ρ(2)

reduced single particle and two-particle density matrices of Ψ0: ρ(1)
only need the diagonal components r1 = r(cid:48)
terms of the momentum distribution, na

1 and r2 = r(cid:48)

k, and the structure factor Sab(k)

1, r(cid:48)

(cid:90)

(cid:90)
(cid:90)

dr

1
N

na

k =

1
Ω

Sab(k) = δab +

(cid:90)

dr(cid:48)eik·(r−r(cid:48))ρ(1)

a (r; r(cid:48))
dr(cid:48)eik·(r−r(cid:48))ρ(2)

dr

ab (r, r(cid:48); r, r(cid:48)) =

(cid:104)ρa
kρb−k(cid:105)

1
N

exp[ik · ria ] are collective density ﬂuctuations. Here, and in the following, we use the convention

(cid:88)

1
Ω

(cid:90)

v(r) =

vk =

vkeik·r

k

dr e−ik·rv(r)

k =(cid:80)

ia

where ρa

2

(1)

(2)

(4)

(5)

(6)

(7)

(8)

(9)

for discrete Fourier transforms of periodic functions inside a volume Ω. The kinetic and potential energy per particle
can then be expressed as

(cid:88)
(cid:88)
(cid:88)
(cid:88)

k

a

a,b

k

TN =

1
N

VN =

1
2Ω

na
k

2k2
2ma
k [Sab(k) − Na/N δab] .
vab

These expressions are our basis for understanding the size eﬀects in periodic boundary conditions. To simplify
the notation, we restrict to a single component system and consider the the momentum distribution nN
k and the
structure factor SN (k) for a ﬁnite system of N particles in a cube of linear extension L. With periodic boundary
conditions, both functions are given on a discrete grid in Fourier space of spacing 2π/L. In the thermodynamic limit
k → n∞
these functions attain their limiting forms: nN
k and
k and ˜SN (k), to all k values should provide the best estimate of the
SN (k) as a function of k, their interpolation ˜nN
ﬁnite system values to n∞
k and S∞(k). Note that special care is warranted in the interpolation near non-analytic
values of k such as k = 0 or at the Fermi surface of a metal. Then there are two diﬀerent ways ﬁnite size errors can
k and ˜SN (k) from their values in the
arise: i) changes in the correlation functions as a function of N , diﬀerences of ˜nN
thermodynamic limit; ii) diﬀerences resulting from a summation of k-points on a ﬁnite mesh in reciprocal space rather
than an integration. Changes (i.e. the ﬁrst way) in the correlation functions are expected for system sizes smaller
than a characteristic correlation length. In particular, close to phase transitions, the correlation length can get large
or even diverge, and ﬁnite size extrapolation methods based on additional scaling assumptions have been developed
for these cases in the ﬁeld of critical phenomena [20, 21]. For fermionic, and in particular electronic matter, important

k and SN (k) → S∞(k). Assuming a smooth behavior of nN

ﬁnite size eﬀects remain even in the case the system size exceeds the characteristic correlation length because of the
second reason; this article exclusively deals with methods to eliminate this ﬁnite size bias: the errors in the kinetic
and potential energy are simply quadrature errors due to the discrete underlying mesh in Fourier space and can be
expressed as

(cid:34)(cid:90)
(cid:34)(cid:90)

∆TN = T∞ − TN =

1
ρ

∆VN = ∆V∞ − VN =

Ω

dk

(2π)d − 1
(2π)d − 1

dk

Ω

(cid:35) 2k2
(cid:88)
(cid:35)
(cid:88)

2m

k

vk
2

k

˜nN
k

˜SN (k)

3

(10)

(11)

where ρ = N/Ω is the density and d is the spatial dimension.

In order to actually apply these formulas, we need a method to interpolate nN

k and SN (k) from the grid where
we have simulation data to the continuum. For local functions such as the structure factor, it would seem easy to
interpolate SN (k). However, since the momentum distribution is a non-local quantity, this direct procedure fails.
Indeed proper size extrapolation of the momentum distribution is slightly more involved [9, 16, 17] as we have to
express ﬁrst the momentum distribution in terms of local correlation functions which can be interpolated more safely.
As long as one is only interested in the kinetic energy, it is easier to express the kinetic energy in terms of a diﬀerent
– purely local – estimator and discuss size eﬀects using them.

Shell eﬀects usually dominate ﬁnite size bias of the kinetic energy; they can be drastically reduced by employing
twist averaged boundary conditions [22]. For electronic systems, the leading order size corrections of the potential and
kinetic energy [8] beyond shell eﬀects are determined by the Coulomb singularity, vk = 2(d − 1)πe2/k2 for k → 0 (e
is the electron charge). However, for typical system sizes, the leading order expressions may not be accurate enough
[13]. To go beyond leading order, one has to understand the behavior of the ground state wavefunction.

In the next section, we give a detailed discussion of size eﬀects of electronic systems and develop a robust numerical
procedure for thermodynamic limit extrapolation of kinetic and potential energy, independent of the particular system
under study and optimal for generic calculations.

II. ENERGY SIZE CORRECTIONS

In this section we will explicitly discuss the ﬁnite size error and correction schemes for electronic energies in the
Born-Oppenheimer approximation where the ions only act as a static external potential. Let us assume that for a
given ionic conﬁguration the electronic ground state can be described with the Slater-Jastrow form

ΨT = De−U

(12)

where D ensures the antisymmetry of fermions (usually by a Slater determinant) and U is a many-body symmetric
function (for electrons). Having in mind that the electrons feel an external potential created by classical ions, we
can simplify the notation to that of a one-component system. We will further assume a spin-polarized system, the
extension to spin-unpolarized system based on two determinants is straightforward.

The corresponding “local energy” is:

= −(cid:88)

i

2
2me

(cid:20)∇2

i D
D

EL =

HΨT
ΨT

where V is the potential energy of the N -electron system and me is the mass of the electrons. The total energy per
particle for this trial state, EV M C
T ,
and R = (r1, . . . , rN ) are the electronic coordinates. Performing a partial integration we get

, is then given by EV M C

N

N

(cid:21)

− ∇2

i U + (∇iU )2 − 2

∇iD
D

∇iU

+ V

= (cid:104)EL(R)(cid:105)T /N where (cid:104). . .(cid:105)T = (cid:82) dR . . . Ψ2
(cid:20)∇2

(cid:43)

(cid:21)

− (∇iU )2

i D
D

+ V

.

T

(13)

T /(cid:82) dRΨ2

(14)

(cid:42)

−(cid:88)

i

2
2me

EV M C

N

=

1
N

The trial energy provides an upper bound to the true ground state energy which can be improved by projector
Monte Carlo methods. Due to the sign-problem, it is in general impossible to project out precisely the exact Fermion
ground state but within the ﬁxed-node approximation, we can ﬁnd the best energy within the nodes of the trial
function. The ﬁxed-node ground state can be written

ΨF N = De−UF N

(15)

(cid:42)

−(cid:88)

i

(cid:20)∇2

i D
D

2
2me

(cid:21)

(cid:43)

where UF N is an optimal symmetric many-body function. Whereas the pure distribution can be obtained by Repta-
tion Monte Carlo methods [24], diﬀusion Monte Carlo algorithms (DMC) sample only the mixed distribution ΨF N ΨT ,

(cid:104). . .(cid:105)DM C =(cid:82) dR . . . ΨT ΨF N /(cid:82) dRΨT ΨF N , and the (unbiased) estimator of the ﬁxed-node DMC energy correspond-

ing to Eq. (14) can be shown to be given by:

EF N

N =

1
N

(cid:104)EL(R)(cid:105)DM C =

1
N

− (∇iU )2 − ∇iU∇i[UF N − U ]

+ V

.

(16)

DM C

In the following we will analyze separately the diﬀerent terms in Eq. (14) and Eq. (16) according to their underlying
single or two-particle character. Shell eﬀects due to the occupation of the orbitals in the Slater determinant are mainly
contained in the term involving ∇2D, whereas the other terms of the kinetic energy have a two-body character similar
to the potential energy.

A. Single particle corrections —Shell eﬀects

Let us assume that the orbitals in the Slater determinant are determined from a single particle Schr¨odinger equation,

e.g. from Kohn-Sham DFT calculations. Writing the determinant of the many-body wavefunction

(17)
where ϕni ≡ ϕn(qi) is the square matrix formed from orbital functions ϕn evaluated at generalized electron coordinates
qi. For wavefunctions which do not include backﬂow, qi = ri. We assume that the N orbitals ϕn are solutions of a
Schr¨odinger equation

D = det
in

ϕni

4

(18)

(19)

for some eﬀective potential veﬀ(r). It follows that

(cid:20)
−2∇2
(cid:88)

2me

+ veﬀ(r)

ϕn(r) = εnϕn(r)

− 2

2meD

∇2
i D =

i

n

i

εn −(cid:88)

(cid:35)

veﬀ(ri)

.

(cid:21)
(cid:34)(cid:88)

(cid:90) εF

(cid:88)

1
N

εn → 1
ρ

In the thermodynamic limit, the discrete summation over energy levels will be replaced by an integral over the density
of states

Here, νeﬀ() = (2π)−d(cid:80)

n

(cid:82) dkδ(− εnk) is the density of states of the eﬀective Schr¨odinger equation, εF is the single

d  νeﬀ()

(20)

n

0

particle Fermi energy, and ρ = N/Ω.

For metallic systems, when νeﬀ() is non-vanishing for  ≈ εF , the sharp edge of the integration at the Fermi level
will give rise to large size eﬀects, the so-called shell eﬀects. They can be reduced by using twist averged boundary
conditions, Ψ(. . . , ri + L, . . . ) = eiϑLΨ(. . . , ri, . . . ) where ϑ is a phase vector with −π/L < ϑ ≤ π/L in each direction
[22]. The single particle energies in Eq. (19) then depend on ϑ and only N orbitals with lowest energies are occupied,
e.g. only plane waves of smallest wave vectors ki + ϑ are occupied for an isotropic Fermi gas. By averaging the ﬁnal

values over all twist angles the sum becomes approximately equal to(cid:82) dε obtained in the thermodynamic limit. More

generally, imposing the twist in the single-particle Schr¨odinger equation shifts the energies of the orbitals and twist
averaging reduces the oscillatory behavior in the kinetic energy by more than an order of magnitude. Furthermore, it
restores isotropy in the mean value of other observables such as the electron-electron interaction, leading to a more
regular behavior in those quantities. However, in the case of a many-body calculation, twist averaged boundary
conditions (TABC) do not automatically introduce a sharp Fermi surface for metallic states since only the N orbitals
with lowest single particle energies for any twist are used, so that the thermodynamic limit of non-interacting electrons
is not exactly reproduced.
In order to obtain the exact single particle energy we can use grand-canonical TABC (GC-TABC) [8, 16]. There,
we occupy only orbitals below the Fermi energy εF in the Slater determinant, εn(ϑ) ≤ εF but the number of electrons
will then depend on the twist angle. GC-TABC not only reproduces exactly the non-interacting kinetic energy, but
also the non-interacting static structure factor at all reciprocal lattice vectors commensurate with the simulation

5

box. Knowledge of the single particle Fermi energy is needed for GC-TABC to determine the mean density. The
occupation of orbitals can be obtained by imposing the Fermi surface on the single particle energies of the eﬀective
Schr¨odinger equation. This Fermi energy (and therefore the mean density) is obtained purely by the single particle
eﬀective Schr¨odinger equation converged in the number of twist angles (or k-points).

To implement grand-canonical twist averaging for QMC calculations of charged fermions, we have to add an addi-
tional homogeneous background charge to ensure charge neutrality of the total system for any given twist angle ϑ. Of
course, after twist averaging the system would be neutral, but adding a neutralizing charges is a bookkeeping exercise
needed if only a ﬁnite number of selected twist angles is used.

In order to reproduce the sharp Fermi surface within GC-TABC, a very ﬁne mesh of twist angles has to be used. In
introduces a phase shift in all orbitals corresponding to a change of the total momentum, Ψϑ+δϑ(R) = Ψϑ(R)eiδϑ·(cid:80)
a system with translation symmetry such as the uniform electron gas, ﬁnite mesh errors can be completely avoided by
noting that for any ﬁnite number of particles, changes of the twist angle within a ﬁnite region, a so-called “pocket”, only
j rj .
Since the sampling weight ∝ |Ψϑ(R)|2 is unaﬀected by this change, any property inside one pocket can be calculated
from the calculation of a single twist angle in the pocket with a weight proportional to the volume of the pocket
[8]. These weights can be computed prior to the actual many-body simulation. We can also use this technique for
periodic solids. As in the fully translational invariant system, the pockets are deﬁned by the regions where the phase
of the wavefunction changes continuously. However, computing the diﬀerent pockets introduces some overhead in the
calculation, and in the following we will discuss a simpler but equally eﬀective reweighting method to reduce the error
of using a ﬁnite mesh of twist angles.

For TABC calculations with ﬁxed number of particles and given mesh size, performing calculations with neighbour-
ing twist angles via reweighting amounts in leading order to correcting the single particle kinetic energies. Therefore,
the diﬀerence between a TABC calculation done with ﬁxed number of twist-angles, Nθ, and the integration over all
twists will be dominated by the single particle expression

εn(ϑ)

(21)

(cid:35) N(cid:88)
(cid:88)

ϑ

n=1

ddϑ − 1
Nϑ

(cid:34)(cid:90)

(cid:90) εF

0

(cid:88)

(cid:88)

ϑ

n

As long as one uses a ﬁxed particle number for all twists, these corrections remain smooth. Similarly, we can correct
for the mesh error of GC-TABC calculations by imposing the single particle Fermi surface. In practice, the sharp
Fermi surface dominates the size eﬀects, so that we should correct the TABC results by imposing a sharp Fermi
surface giving a single particle energy correction of

∆TT ABC =

1
ρ

d  νeﬀ() − 1
NϑN

εn(ϑ)

(22)

where the summation on the r.h.s. goes over all wave vectors of the plane wave orbitals in the TABC or GC-TABC
determinant. Adding ∆TT ABC to energies obtained from TABC calculations at ﬁxed N , one rapidly approaches the
mesh-corrected GC-TABC results as shown in the examples below.

For electrons in an external periodic potential created by the crystal ions, one should expect that the eﬀective
potential will have the same periodicity as the lattice. However, in the case of a disordered potential, e.g. a two
component liquid [26], the potential will not be periodic. At any given system size, N , periodic or twisted boundary
conditions still impose a periodicity due to the ﬁnite size of the simulation box. To estimate thermodynamic limit
corrections the use of TABC or GC-TABC is nevertheless useful and often essential.

Indeed for electrons in a disordered medium [33, 34], the Fermi surface is, in general, destroyed by the external
potential, such that the lifetime of quasi-particle states remains ﬁnite even at the Fermi surface. As a result, the sharp
discontinuity of the momentum distribution at the Fermi surface gets smeared out. Although remaining continuous, the
momentum distribution may still have a pronounced change in the slope very close to the Fermi surface, in particular
if the disorder only weakly aﬀects the electronic properties. The resulting oscillations in real space will eventually
decay exponentially at a length scale of the mean free path of the electrons. For a disordered metallic system, this
length scale can exceed the correlation length of the external disorder potential by orders of magnitudes. Nevertheless,
the calculation of the mean-ﬁeld path does not necessarily require large system sizes, apart from situations where one
may be close to a continuous, localization driven metal-insulator transition. This surprising result can be understood
considering simple potential scattering: scattering phase shifts can be reliably calculated in ﬁnite systems that are
much smaller than what is needed to resolve a very sharp slope in the momentum distribution due to Fermi statistics.
Stated diﬀerently, twist averaging can greatly reduce size eﬀects even in disordered systems as long as the modiﬁcation
of the density of states due to disorder remains suﬃciently smooth.

B. Corrections arising from two-particle correlations

1. Potential energy correction

6

Let us start considering the interaction energy in Eq. (14), again, for simplicity, written down for a one component

system

(cid:104)VN(cid:105) =

1
2Ω

(cid:88)

k(cid:54)=0

vk [SN (k) − 1]

The ﬁnite size error of the potential energy is

(cid:104)

N→∞(cid:104)VN(cid:105)(cid:105) − (cid:104)VN(cid:105) =

lim

(cid:90)

1
2

dk

(2π)d vk [S∞(k) − 1] − 1

2Ω

(cid:88)

k(cid:54)=0

vk [SN (k) − 1]

(23)

(24)

Note that we have assumed that vN
k ; we use Ewald image method for the potentials for periodic boundary
conditions [27]. If the integrand were an analytic function for all k, the ﬁnite size error would vanish exponentially
with system size (see appendix A). In the rest of this section we explicitly consider the case of the 3D Coulomb
potential but the method can be extended to diﬀerent interactions and systems of reduced spatial extensions.

Assuming S(k → 0) = 0, the leading order size correction is given by the Madelung constant, ∆vM ,

k = v∞

(cid:90) d3k

(2π)3 − 1

Ω

 vk

2

(cid:88)

k(cid:54)=0

∆vM = −

(25)

For the 3D Coulomb potential, we have ∆vM ∼ N−1/3 where the proportionality factor depends only on the geometry
of the simulation box. For a multi-component, charge-neutral system, this term vanishes, but it must be considered
in the case of GC-TABC where a homogeneous background charge may be needed to assure charge neutrality. The
remaining term of the potential energy corrections is

(cid:90)

(cid:88)

k(cid:54)=0

∆VN =

1
2

dk

(2π)d vkS∞(k) − 1

2Ω

vkSN (k)

(26)

Non-analytical points of the integrand will give rise to slowest convergence of the integration. Potential non-
analytical behavior is around singularities of the potential, edges of the integration region, k → 0 and k → ∞ and
values k = nkF with integer n. From the local energy, we can see that the singular behavior at k = 0 also determines
the limiting behavior of the Jastrow potential and the structure factor, in particular, S(k) ∼ u−1
k ∼ k2 in d = 3
dimensions [10, 11]. The next-to-leading order corrections beyond the Madelung corrections are then related to the
long wavelength plasmon excitation ∆VN = ∆VLO + o(N−1) with [8],

k ∼ v−1

∆VLO ≡ 1
N

ωp
4

(27)

where ωp = (ρvkk2/m)1/2 is the plasma frequency [55]. Half of the plasmon zero point energy, ωp/2, is actually
potential energy, the missing other half is recovered from the kinetic energy [56]. Subleading corrections [8, 13, 16, 17]
may also be deduced by integrating asymptotic expansions of the structure factor around k = 0, taking only into
account the contributions from the volume element around the origin in Eq. (26). In the following, we will go beyond
such an asymptotic analysis, proposing a general and practical method to evaluate Eq. (26) for the thermodynamic
limit estimation using only results for a calculation at a ﬁnite size.

Our best a priori choice for S∞(k) consists of interpolating the values of SN (k) from the discrete grid in k-space
to all k-values. From this interpolated function we can calculate the diﬀerence between summation and integration.
However, since vk is a slowly decaying function, this is not straightforward. Since the noise of the structure factor is
ampliﬁed by the volume element at large wave vector, one has to conﬁne the integration to medium or small wave
vectors. Technically, this can be achieved by splitting the potential into short and long-range parts: vk = vsr
k + vlr
k .
Assuming an isotropic short range potential with vsr(r ≥ rc) = 0 for some cut-oﬀ radius rc, the long-range contribution
is then given by vlr
optimal way [28, 29], such that vlr
k is a rapidly vanishing function for increasing k. In the case of Coulomb interaction,
the short and long-range part can also be separated using the method introduced by Ewald [27, 30]. Note that in

k =(cid:82) dre−ik·rvsr(r). This splitting can be done for arbitrary potentials in an

k = vk − vsr

k , where vsr

the following section we will also use this procedure on the Jastrow factor, also a long-ranged function. The optimal
split-up is routinely used in the QMC algorithms in order to compute rapidly the potential and kinetic energy of
long-ranged interactions and wavefunctions during the Monte Carlo random walk.

Let us write the potential energy per particle in terms of this breakup

(cid:104)VN(cid:105) =

ρ
2

dr vsr(r) [gN (r) − 1] +

1
2Ω

k [SN (k) − 1]
vlr

(cid:88)

k(cid:54)=0

(cid:90) rc

0

where we have introduced the pair correlation function of the N -particle system

The natural prolongation of the pair correlations to the thermodynamic limit is by assuming g∞(r) (cid:39) gN (r) for r ≤ rc

and interpolating SN (k) to a dense grid in k-space, S∞(k) (cid:39) (cid:101)SN (k). The remaining size corrections for the potential

energy are then exclusively expressed in terms of long-range contributions

gN (r) = 1 +

1
N

e−ik·r [SN (k) − 1]

(cid:88)

k(cid:54)=0

(cid:90)

∆Vlr =

dk

(2π)d − 1

Ω

 vlr

k
2

(cid:88)

k(cid:54)=0

(cid:101)SN (k)

7

(28)

(29)

(30)

(31)

(32)

(33)

By construction, the integration and summation of the r.h.s .of Eq. (30) do not depend on the upper integration/
summation limit as vlr
In practice, we use rc = L/2 together with a cubic

spline interpolation of SN (k) to continue the values on the discrete k-grid to the continuum to obtain (cid:101)SN (k). For

k is zero for large k by construction.

a multicomponent system interacting only via Coulomb forces, only the charged structure factor is needed for the
potential energy and we impose the boundary conditions: S(0) = (dS/dk)0 = 0.

Notice, that for the derivation of Eq. (30) we have assumed that the short range part of the pair correlation
function remains unchanged in the thermodynamic limit. This would be the case if the structure factor was an
analytical function of k which is in general not the case. Although S(k) ∼ k2 for 3D, non-analytic behavior ∼ k3 is
expected beyond leading order giving rise to additional corrections of order N−2 which we neglect in the following
[57]. In appendix D we describe how to go beyond this assumption to include sub-leading corrections due to non-
analyticities in the structure factor involving also the short-range part of the potential and explicitly show how to
perform the calculations with the Ewald potential for cases where the optimized potentials are not available.

2. Kinetic energy correction

Let us now consider the kinetic energy contribution involving the Jastrow correlations, the remaining term of

Again, we analyze the expression in terms of the Fourier components. Restricting to a single component system with
U = 1
2Ω

k ukρkρ−k, we have

Eq. (14),

(cid:80)

(cid:43)

TU =

1
N

2
2mi

[∇iU ]2

(cid:42)(cid:88)

i

(cid:88)

TU = − 2
(cid:88)

2meN

(cid:39) 1
Ω

1
Ω2
2k2
2me

k(cid:54)=0

k(cid:54)=0,k(cid:48)(cid:54)=0

ρuku−kSN (k)

(k · k(cid:48))ukuk(cid:48)ρk+k(cid:48)ρ−kρ−k(cid:48)

where we have neglected all terms with k (cid:54)= −k(cid:48) corresponding to the RPA approximation which becomes exact in
the long wavelength limit [31].

In order to analyze the ﬁnite size corrections for the energy we interpolate the Jastrow potential, u(k), from its values
at discrete k-points to all values of k. As with the potential energy, the kinetic energy error from pair correlations,
∆TU = [limN→∞(cid:104)TU(cid:105)/N ] − (cid:104)TU(cid:105)/N , reduces to an integration error. The non-analytical behavior of the integrand

around k = 0 for Coulomb systems gives rise to slow convergence of the integration; the leading order is given by the
plasmon contribution [8].

∆T LO

U = ∆VLO =

ωp
4

1
N

(34)

8

To go beyond leading order, we split the long-range from the short range part of the Jastrow potential, uk =
usr(k) + ulr(k), so that we arrive at the following expression

(35)

(cid:90)

∆T lr

U =

dk

(2π)d − 1

Ω

 2k2

2me

(cid:88)

k(cid:54)=0

ρulr(k) [2uk − ulr(k)](cid:101)SN (k)

As the integrand on the r.h.s. vanishes rapidly with k, we only have to interpolate the structure factor at small k and
work out the corrections similar to those for the potential energy.

3. Backﬂow corrections

The above corrections are for a Slater-Jastrow wavefunction. Backﬂow wavefunctions considerably improve the
accuracy of QMC calculations [12, 23, 42–45] and have been generalized to systematically approach the ground state
energies [46]. Let us consider that the orbitals ϕni = ϕn(qi) inside the Slater determinant, Eq. (17), are built using
general backﬂow coordinates, qi = ri + ηi where ηi is a function of all other coordinates. The derivatives of ηi
will then give rise to additional terms of the kinetic energy with corresponding ﬁnite size corrections which have not
discussed so far. Using RPA like arguments, we can estimate the dominating terms in the laplacian of the kinetic
energy (see appendix C)
∇2D
D

(cid:42)(cid:88)

(cid:88)

(cid:43)(cid:35)

εn −

veﬀ(qi)

(cid:43)

(cid:28)

sN (k)

(cid:34)

(cid:34)

(36)

1
Ω

1
Ω

1 +

1 +

=

i

k

k

n

≈

2me

with

k2yk

sN (k)

(cid:29)

sN (k) =

− 2

qD
2meD

(cid:80)
q qyq(eiq·riρ−q − 1).

(cid:35)(cid:34)(cid:88)
(cid:35)(cid:42)
(cid:88)
− ∇2
(cid:2)2 + ρk2yk −(cid:0)2 − ρk2yk
(cid:1) SN (k)(cid:3)
(cid:101)sN (k)
(cid:90)
(cid:88)
(2π)d − 1
(cid:43)(cid:35)
(cid:34)(cid:88)
(cid:42)(cid:88)
where(cid:101)sN (k) is given by Eq. (37) where the long-range part of yk and y2

∆TBF (cid:39) t

εn −

veﬀ(qi)

1
N

k(cid:54)=0

t =

dk

Ω

d

n

i

where d is the spatial dimension and the backﬂow potential, yq, is related to the quasiparticle coordinates [53] via
ηi = i
Ω

As before, we can now derive the size corrections of the kinetic energy due to backﬂow, ∆TBF , using

(37)

(38)

(39)

k together with an interpolation of the structure

factor is used as was done with the previous kinetic energy corrections without backﬂow.

From the long-range limit of the electron electron backﬂow [12], we can estimate the leading order size eﬀects of

backﬂow for a metallic system in 3D

where t is the single particle kinetic energy, t (cid:39) 3k2

F /10me for a system with an isotropic Fermi surface.

∆T LO

BF = − t
3N

(40)

C. Projection Monte Carlo methods and mixed estimators

Starting from a trial wavefunction, the true ground state wavefunction can be sampled using Projector Monte Carlo
methods. Using the ﬁxed-node approximation for fermions to circumvent the sign problem, the optimal ground state

wavefunction constrained by the nodes of the given antisymmetric Slater determinant, D, is determined, Eq. (15).
When using twisted boundary conditions for TABC and GC-TABC, we replace the ﬁxed-node procedure with the
ﬁxed phase approximation [32]. Extrapolating the calculations imposing the nodes/phases obtained from the same
eﬀective potential will therefore lead to identical single-particle size corrections as within VMC, Eq. (22), as these
shell corrections are due to the behavior of the phase of the many-body wavefunction which is unaﬀected by the
restricted random walk of the projection.

9

Concerning the two-particle corrections, size-corrections beyond shell eﬀects are directly related to the bosonic long
wavelength modes, so that projection may lead to essential changes. Within projection Monte Carlo methods [1, 24],
the total energy of the system is most easily obtained by commuting the Hamiltonian to one end of the path where
the energy can be obtained from the mixed estimator, Eq. (16). In the case where the exact long-range behavior of
the Jastrow function is already imposed in the trial wavefunction, we can neglect size eﬀects of the term involving
UF N − U , and two-particle size eﬀects for the total energy are corrected by adding potential and kinetic energy

corrections, Eq. (30) and Eq. (35), where (cid:101)SN is obtained from the mixed estimator of the structure factor. Whereas

the total energy estimator is unbiased, separating potential from kinetic energy contributions may be biased in this
procedure.

Unbiased calculation of the structure factor can be done using reptation Monte Carlo [24], so that we can directly
apply the VMC formulas for potential and kinetic energy corrections, Eq. (30) and Eq. (35), respectively, as long as
the exact long-range behavior of the Jastrow is contained in the trial wavefunction. Although reptation Monte Carlo
can be extended to obtain unbiased estimators for oﬀ-diagonal quantities such as the momentum distribution [17], it
is simpler to determine the kinetic energy as the diﬀerence of the total energy and the potential energy.
In cases where the trial wavefunction does not contain the correct long-range behavior, the term involving UF N − U
becomes relevant for the size extrapolation. To estimate this correction, we can use a quite general relation between
the structure factor and the eﬀective Jastrow [10], ueﬀ(k), valid in the long wavelength limit

S−1(k) = S−1

0 (k) + 2ρueﬀ(k)

(41)

where S0(k) is the ideal gas structure factor (see appendix B). For metallic systems, its contribution to the eﬀective
Jastrow factor is negligible, e.g. for the DMC mixed estimator of the structure factor, we have

SDM C(k) =

1

ρ[uF N (k) + u(k)]

k → 0

,

(42)

and we can obtain uF N (k) from the mixed DMC estimator, as the Jastrow factor of the trial wavefunction, u(k), is
known. Knowledge of uF N , allow us to calculate the two-particle size corrections of the total energy from Eq. (30)
and Eq. (35) together with a similar term to take into account the corrections involving UF N − U in Eq. (16).
Let us discuss explicitly the common practice of using a short range function for the electron-electron Jastrow
factor. In this case the long-range part of limk→0 u(k) → const compared to the exact one which diverges as k−2.
Whereas the kinetic energy contribution, Eq. (35), also remains negligible, the potential energy contribution with the
use of the mixed estimator SDM C (cid:39) [ρuF N (k)]−1 is twice as large as that obtained by using the exact structure factor
S(k) (cid:39) [2ρuF N (k)]−1. We see, that the leading order corrections for the total energy are indeed correctly obtained by
the mixed estimator, however, the true potential energy as obtained by the use of the unbiased estimator contributes
only half of this correction. The other half comes from the kinetic energy. Notice that the exact structure factor also
agrees with the one obtained from the extrapolation formula S(k) (cid:39) SEXT R(k) ≡ 2SDM C(k) − SV M C(k) as long as
uF N (k) − u(k) is small. In practice, for calculations based on a short range electron-electron Jastrow, we can use
the interpolation of SDM C(k) in the potential energy extrapolation to obtain the total energy size corrections and
that of SEXT R(k) to obtain the potential energy corrections. From the diﬀerence we can estimate the kinetic energy
corrections without knowledge of the exact long-range Jastrow correlations.

Therefore, although it is not necessary to include the correct long-range behavior into the trial wavefunction, the
long-range correlations aﬀact the size extrapolation of DMC energies. Correct sampling of these long wavelength
correlations requires long projection times, since the projection time scales as L2 = N 2/3 and long projection times
require a larger population of walkers to remain unbiased.

Size extrapolations are frequently based on VMC energies, only. Without including long-range contributions to the
Jastrow, there is no guarantee that these size extrapolations can be transferred to the DMC energies. Still, as long as
the range of the short range Jastrow potential used in the trial wavefunction grows proportional to the system size,
the optimization of a suﬃciently ﬂexible functional form will converge to the correct long-range behavior and allow a
correct estimation of the size corrections.

10

D. Extension to inhomogeneous densities

The above formulas have been derived for the case of a homogeneous one-component system. Here, we brieﬂy discuss
how they should be used for inhomogeneous electronic densities. Deﬁne ρk ≡ (cid:104)ρk(cid:105) and separate the mean-values from
the ﬂuctuating quantities, δρk ≡ ρk − ρk, in the structure factor, SN (k) = SN (k) + δSN (k) with

SN (k) =

δSN (k) =

1
N
1
N

ρk ρ−k
(cid:104)δρkδρ−k(cid:105).

(43)

(44)

Extensions of SN (k) to the thermodynamic limit needed for the size corrections should be done separately for SN (k)
and δSN (k). Whereas extensions of both quantities may be needed for the potential energy corrections, Eq. (30),
only δSN (k) enters the kinetic energy, Eq. (35) and Eq. (38). However, SN (k) will have the periodicity of the unit
cell for crystal structures and only δSN (k) enters the potential energy corrections. In the following examples we will
refer to δSN (k) as the ﬂuctuating structure factor.

III. EXAMPLES

In the following, we provide examples of the ﬁnite size errors using the correction schemes discussed above. In
general, we have performed calculations averaging over twisted boundary conditions, where the twist angles, θα ∈
] − π/L, π/L] (α = x, y, z), are chosen on a linear grid with M d discretization points, θα = (m/M − 1/2)π/L,
m = 1, 2, . . . M . Bare results for the total energy per electron using TABC or GC-TABC are denoted by ET ABC and
EGC−T ABC, respectively. We then give the remaining shell corrections, ∆TT ABC, or ∆TGC−T ABC, obtained from
Eq. (22).

The leading order two-particle energy correction for static ions, assuming the correct long-range behavior of the
electronic Jastrow function, is given by the plasmon zero-point energy, ∆ELO = ωp/2N =
/(2N )Ha, in-
B/3)−1/3 is the Wigner-Seitz
dependent of the shape of the supercell used. Here and in the following, rs = (4πρea3
density parameter, ρe is the electronic density and aB = 2/mee2 is the Bohr radius. Corrections beyond leading
order ∆Elr ≡ ∆T lr
U + ∆Vlr are calculated by using the optimized long-range part of the corresponding potentials in
Eq. (30) and Eq. (35), and interpolating SN (k) using cubic splines and assuming that SN (0) = S(cid:48)

−3/2
3r
s

√

N (0) = 0.

A. Crystalline hydrogen: perfect crystal

Here we consider b.c.c. hydrogen at a density of rs = 1.31, and we neglect the zero point motion of the protons.
We present ﬁrst VMC calculations with the simplest orbitals in the Slater determinant (spherical Fermi surface),
φn(r) = eikn·r with k ≤ kF where kF is the Fermi wave vector and fully analytical potentials including long-range
parts for the many-body backﬂow and Jastrow potential. We separately study the inﬂuence of backﬂow coordinates
on the size extrapolation. We then present DMC results using realistic DFT-bandstructure orbitals without backﬂow
including only short-range Jastrow functions. The Reptation Monte Carlo method is used to obtain pure estimates
of the potential energy in the latter case.

1. Slater-Jastrow wavefunction with spherical Fermi surface

The simplest trial wavefunction is a Fermi liquid state, where the Slater determinant is formed from plane waves
ﬁlling the Fermi sea up to an isotropic Fermi wave vector kF . We have used an expression (analytic in k-space) based
on the RPA [11, 12] for the Jastrow factor. Then the trial wavefunction for various values of N is guaranteed to
approach the large N limit very smoothly. (Optimized Jastrow factors could have an additional noisy component.)
The VMC results are given in table I and Fig. 1, we can see that convergence of the energy per particle to less than
1mHa can be reached already with N = 16 electrons. For TABC, extrapolation with M is smooth, but the use of the
shell corrections, ∆TT ABC, to mimic the sharp Fermi surface at kF is essential to reach a high precision comparable
to GC-TABC results.

11

FIG. 1: Energy per atom for b.c.c. hydrogen at rs = 1.31 using a Slater-Jastrow wavefunction with plane wave orbitals
occupied up to the Fermi surface for various system sizes, N . We show the uncorrected twist averaged results, ET ABC and
U + ∆Vlr and E∞(GC − T ABC) =
EGC−T ABC , together with the size corrected ones, E∞(T ABC) = ET ABC + ∆TT ABC + ∆T lr
EGC−T ABC + ∆TGC−T ABC + ∆T lr

U + ∆Vlr. In the inset we show the corresponding values of kinetic energy.

Kinetic and potential energy corrections are given separately. Interestingly, kinetic and potential energy corrections
stemming from the two particle correlations remain equal to high precision beyond leading order, and approach the
leading order expression from below.

2. Backﬂow wavefunction with spherical Fermi surface

In table II we show the results for the same system as before but including backﬂow coordinates to evaluate the
orbitals [12]. Whereas potential energy corrections work as well as in the case without backﬂow (see Fig.2), the explicit
backﬂow corrections derived above, ∆TBF , are clearly improve the extrapolation (see Fig. 3). Still, the underlying
approximations in their derivation introduce a larger error than for the Slater-Jastrow trial function.

3. Slater-Jastrow wavefunction with DFT band structure

Next, we consider orbitals obtained from a density functional theory calculation inside the Slater determinant using
QMCPACK [49, 50]. Single particle orbitals were obtained from Quantum Espresso using the PBE functional [39].
The oribtals were generated on an 8x8x8 shifted Monkhorst pack grid using a planewave cutoﬀ of 200Ry. A hard
Troullier-Martins pseudopotential with a cutoﬀ of rc = 0.5a0 was used to eliminate the 1/r divergence in the DFT
calculation.

We used a Slater-Jastrow type trial wavefunctions without backﬂow. The Jastrows factor consisted of a sum of
radially symmetric short-ranged one and two-body terms without long-range contributions. The cutoﬀ radius for the
short-ranged terms was chosen to be the Wigner-Seitz radius of each simulation cell. A fully optimizable b-spline
form was used for all Jastrow terms, which we optimized with variational Monte Carlo using the linear method.

00.010.020.030.040.050.060.070.08 N-1-0.51-0.5-0.49-0.48 E/N(a.u.)       TABC: EN                   E! GC-TABC: EN                    E!00.020.040.060.740.7450.75N
16
54
128
250

ET ABC

M
161 -0.510358(3)
161 -0.491779(6)
161 -0.48764(2)
161 -0.486525(4)

∆TT ABC
-0.001817
-0.001377
-0.000602
-0.000013

∆T lr
U

∆Vlr

∆Elr

∆ELO
0.036100 0.013667 0.014393 0.028059
0.010696 0.004440 0.004455 0.008895
0.004512 0.002035 0.002021 0.004056
0.002310 0.001195 0.001150 0.002345

lin.extrap.

N
16
54
128
250

lin.extrap.

12

E∞(TABC)
-0.484115(3)
-0.484261(6)
-0.48419(2)
-0.48417(3)
-0.4851(1)

-0.484556(4)
-0.484743(6)
-0.484483(3)
-0.48426(2)
-0.48476(2)

M EGC−T ABC ∆TGC−T ABC ∆ELO
161 -0.512739(4)
161 -0.493581(6)
161 -0.488484(3)
81
-0.48658(2)

-0.000034
-0.000027
-0.000003
0.000012

0.036100 0.013744 0.014473 0.028217
0.010696 0.004424 0.004441 0.008865
0.004512 0.002009 0.001996 0.004005
0.002310 0.001171 0.001131 0.002302

∆T lr
U

∆Vlr

∆Elr

E∞(GC-TABC)

TABLE I: Energy corrections in Hartrees per electron for b.c.c. hydrogen at rs = 1.31 vs. number of electrons, N , with various
size correction estimates. Energies are computed with VMC and using a Slater-Jastrow trial function with plane waves orbitals.
TABC: twist-averaged boundary conditions, GC-TABC: grand-canonical twist average boundary conditions. The number of
twists in each dimension was M , ∆ELO: Leading order energy size corrections (plasmon formula), ∆Elr = ∆Tlr + ∆Vlr size
correction using ﬁt of Sk to compute all long-range corrections where Eq. (35) is used for the kinetic energy correction, ∆T lr
U ,
and Eq. (30) for potential energy correction, ∆Vlr. The a priori best estimate for E∞ using only quantities in the N -particle
system, denoted by E∞(T ABC) = ET ABC + ∆TT ABC + ∆Elr for TABC and, similar, E∞(GC − T ABC) for GC-TABC. Linear
extrapolation of ET ABC (EGC−T ABC ) using the data for 54 ≤ N ≤ 250 is given in the lines of N = 54 − 250. Statistical errors
in the last digit are given in parentheses.

FIG. 2: Energy per atom for b.c.c. hydrogen at rs = 1.31 using a backﬂow wavefunction with plane wave orbitals occupied
up to the Fermi surface for various system sizes, N . We show the uncorrected twist averaged results, ET ABC and EGC−T ABC ,
U + ∆Tbf + ∆Vlr and E∞(GC − T ABC) =
together with the size corrected ones, E∞(T ABC) = ET ABC + ∆TT ABC + ∆T lr
EGC−T ABC + ∆TGC−T ABC + ∆Tbf + ∆T lr

U + ∆Vlr. In the inset we show the corresponding values of potential energy.

00.010.020.030.040.050.060.070.08 N-1-0.53-0.52-0.51-0.5 E/N(a.u.)       TABC: EN                   E! GC-TABC: EN                    E!00.020.040.06-1.24-1.23-1.22N
16
54
128
250

ET ABC

M
161 -0.522611(2)
81
-0.50494(1)
-0.50071(1)
81
81
-0.49929(4)

∆TT ABC
-0.001817
-0.001385
-0.000604
-0.000191

∆T LO
BF

∆ELO

∆TBF

∆T lr
U

∆Vlr

∆Elr

-0.013414 0.036100 -0.012354 0.016964 0.018167 0.035132
-0.003975 0.010696 -0.004075 0.006429 0.006448 0.012877
-0.001677 0.004512 -0.001464 0.002712 0.002698 0.005410
-0.000858 0.002310 -0.000740 0.001382 0.001395 0.002777

∆ELO

∆TBF

∆T lr
U

∆Vlr

∆Elr

E∞(GC-TABC)

13

E∞(TABC)
-0.501651(2)
-0.49752(1)
-0.49737(1)
-0.49745(4)
-0.49765(4)

-0.501888(3)
-0.497991(7)
-0.49749(2)
-0.49728(2)
-0.4976(1)

lin.extrap.

N
16
54
128
250

lin.extrap.

M EGC−T ABC ∆TGC−T ABC ∆T LO
BF
161 -0.524814(3)
161 -0.506684(7)
81
-0.50147(2)
-0.49948(2)
81

-0.000034
-0.000027
-0.000005
0.000012

-0.013414 0.036100 -0.012344 0.017050 0.018254 0.035304
-0.003975 0.010696 -0.004078 0.006389 0.006409 0.012797
-0.001677 0.004512 -0.001463 0.002732 0.002718 0.005450
-0.000858 0.002310 -0.000734 0.001456 0.001131 0.002915

TABLE II: Energy corrections in Hartrees per electron for b.c.c. hydrogen at rs = 1.31 for diﬀerent number of electrons, N ,
with various size correction estimates. Energies are computed with VMC using a Slater-Jastrow trial function where plane
waves orbitals contain backﬂow coordinates. Additional kinetic energy corrections due to backﬂow are denoted by ∆T LO
BF for
the leading order formula, Eq. (40), and ∆TBF from the interpolation of the static structure factor together with Eq. (39). The
other symbols are deﬁned in the caption of table I.

FIG. 3: Kinetic energy per atom for b.c.c. hydrogen at rs = 1.31 using a backﬂow wavefunction with plane wave orbitals
occupied up to the Fermi surface for various system sizes, N . We show the uncorrected twist averaged results, TT ABC and
U + ∆Tbf and T∞(GC − T ABC) =
TGC−T ABC , together with the size corrected ones, T∞(T ABC) = TT ABC + ∆TT ABC + ∆T lr
TGC−T ABC + ∆TGC−T ABC + ∆Tbf + ∆T lr

U with and without backﬂow corrections.

For the QMC calculations, we considered supercells with N = 16, 128, 1024 atoms. Twist averaging was used to
obtain all reported quantities. To generate the twists, we used the same Monkhorst-Pack grid as used for orbital
generation. Reptation Monte Carlo (RMC) was used for the N = 16, 128 supercells to compute both mixed and pure
energy estimates. For the N = 1024 supercell, we used Diﬀusion Monte Carlo to calculate the total energy. In all
calculations a time step of τ = 0.0075Ha−1 was used. In the RMC calculations, a projection time of β = 4.5Ha−1
was used.

Results are summarized in table III and Fig. 4. The total energy corrections were obtained by the mixed estimator
for the ﬂuctuating structure factor whereas the potential energy corrections, ∆Vlr have been calculated from the pure

00.010.020.030.040.050.060.070.08 N-10.710.720.73 T/N(a.u.)       TABC: TN                   T!           T!"#TBF  GC-TABC: TN                    T!            T!"#TBF14

N
16
128
1024

lin.extrap.

TT ABC

VEXT R

M ET ABC
8 -0.53009(3) 0.7581(3) -1.2894(3) -1.2882(3) 0.00274 0.02205 0.02479 0.7608(3) -1.2662(3) -0.50530(3)
4 -0.50774(2) 0.7607(1) -1.2714(1) -1.2685(1) 0.00081 0.00254 0.00335 0.7615(1) -1.2660(1) -0.50439(2)
-0.50443(1)
2 -0.50507(1)
0.7611(3) -1.2657(3) -0.50465(1)

0.000641

∆E

V

∆T

∆V

T∞

V∞

E∞

TABLE III: Finite size corrections for b.c.c. atomic hydrogen (rs = 1.31) at zero temperature using DFT orbitals in the
Slater determinant. The potential energy per electron, V , was obtained using the pure estimator within RMC, whereas the
kinetic energy was calculated via T = E − V . From the extrapolated results of the DMC calculations using the mixed
estimatorVEXT R = 2VDM C − VV M C , we conclude that the mixed estimator introduces a bias of 3mHa which is likely to
increase with system size. Therefore, we do not consider kinetic and potential energies separately for N = 1024 where only
DMC calculations were performed. All energies per electron are given in units of Ha.

FIG. 4: Energy per atom for b.c.c. hydrogen at rs = 1.31 using a Slater-Jastrow wavefunction with DFT orbitals for various
system sizes, N . We show the uncorrected twist averaged results, EN , together with the size corrected ones, E∞ = EN +
∆T lr
U + ∆Vlr. In the inset we show the corresponding values of kinetic energy. We also show the linear ﬁts to the uncorrected
data and the corresponding extrapolated values in the thermodynamic limit.

estimator using RMC. The kinetic energy corrections, ∆Tlr, then result from the diﬀerence of total and potential
energy corrections.

We see, that the ﬁnite size error after corrections in this case of more realistic orbitals is comparable to the previous
calculations using the simple plane wave determinant, even without including long-range components in the Jastrow
potential. However, the use of “exact” estimators was essential to reach this precision for kinetic and potential energy
separately.

00.010.020.030.040.050.060.07 N-1-0.535-0.53-0.525-0.52-0.515-0.51-0.505-0.5 E/N(a.u.) EN E!00.020.040.060.7580.760.762ET ABC

∆TT ABC ∆TBF

∆T

∆V

∆E

15

rs
1.34

Ne
54

54-128

-0.51591(7) -0.000492 -0.003912

1.44

54

-0.53679(8) -0.000008 -0.00363

54-128

0.000020 0.005250 0.005270
-0.0005(10) 0.006(1) 0.0058(1)
0.00444
-0.000035
0.00441
0.003 (1)
0.003(1) 0.0056(2)

TABLE IV: Finite size corrections for liquid atomic and molecular hydrogen at T = 1200K. The kinetic energy corrections,
U sums up all contributions, whereas the total potential energy corrections, are ∆V ≡ ∆Vlr. All
∆T = ∆TT ABC + ∆TBF + ∆T lr
size corrections correspond to energies per electron in Ha.

B. Liquid atomic and molecular hydrogen at high pressure

We have used Coupled Electron-Ion Monte Carlo (CEIMC) to study high pressure hydrogen in the vicinity of
the liquid-liquid, insulator-to-metal transition [33, 35]. Here, the protonic conﬁgurations are sampled according to
the classical Boltzmann distribution ∝ exp[−βEBO] where EBO is the Born-Oppenheimer energy of the protonic
conﬁguration determined from an electronic QMC estimate [36–38]. The nuclear conﬁguration space was sampled
using the VMC energy. The trial function consisted of a Slater determinant of single electron orbitals for each spin
component and a correlation part with single, two and three body Jastrows. The single electron orbitals are from
self-consistent Kohn-Sham theory [39], dressed by a backﬂow transformation. Analytical expressions from RPA for
both correlation and backﬂow functions are employed [12, 26, 40, 41] which exactly enforce the cusp conditions
between all pairs of charges as well as the correct long-wavelength behavior of the charge oscillations. These are
complemented by empirical expressions which preserve the correct short and long distance behavior and introduce
few variational parameters that need to be optimized [26, 40].
In addition to the energy per particle, pressure corrections can be obtained from the kinetic and potential energy
corrections using the virial theorem. The calculations were performed using TABC on a 4× 4× 4 grid for N = 54 and
N = 128 hydrogen atoms. We have used Eq. (22) to correct for ﬁnite size eﬀects of the single particle kinetic energy
imposing the DFT Fermi surface. The potential energy can be written entirely in terms of the charged structure
factor

(cid:10)ρe

Sc(k) =

1
Ne

kρe−k + ρp

(cid:11)

kρp−k − 2ρe

kρp−k

(45)

averaged over electronic and protonic conﬁgurations, and we have used the potential energy corrections, Eq. (30),
with ˜SN (k) replaced by a cubic spline interpolation of Sc(k). The formula for the kinetic energy correction stemming
from the Jastrow cannot be simpliﬁed in terms of the charged structure factor only, but has been extended to include
electron-electron and electron-proton components of the Jastrow, their correct long-range are imposed in the VMC
wavefunction [58]. The two-body backﬂow correction, Eq. (39), only involves the electron-electron structure factor,
and t has been obtained by calculating the kinetic energy of the backﬂow-free Slater determinant.

In table IV, we illustrate size eﬀects of the energy on two diﬀerent systems. At the higher density, the system is
in the atomic phase with a metallic character, whereas the lower density is molecular and expected to be insulating.
Since the structure factor has a higher peak for the molecular system around k ≈ 2.5, the interpolation of it becomes
less accurate and introduces a larger uncertainty in the size extrapolation than in the atomic liquid.

C. Hydrogen-Helium mixtures

We now analyze some snapshot conﬁgurations of helium-hydrogen mixtures at high density, rs = 1.10 and rs =
1.34, generated from an ab-initio quantum molecular dynamics simulations [47]. For ﬁxed nuclei positions, we have
calculated the electronic energy using the QMCPACK [49, 50] simulation package based on a single Slater-Jastrow
wavefunction with single particle orbitals obtained from Quantum espresso [39] using the PBE functional (see Ref. [47,
48] for further details).
Using a long-range optimized uk we can ﬁt the long-range behavior of the electron-electron Jastrow uee(k) = αk−2
and the ﬂuctuating electronic structure factor δSee(k) = βk2 (using the pure estimator). We then obtain the leading
order corrections corresponding to the extrapolation of k → 0 in Eq. (33)

∆T LO

U = lim
k→0

2k2ρeu2

ee(k)δSee(k)
2meV

2ρ2

eα2β
2me

1
N

=

(46)

xHe

rs
1.10 6.7% 64

Ne ∆TT ABC ∆T LO

-0.00059

U

∆VLO
0.00125 0.00470

64-512

21%

64

-0.00024 0.000273 0.00452

16

∆T lr
U
0.00143
0.0014(5)
0.00130

∆Vlr

∆Elr
0.00735

0.00591
0.0069(9) 0.00816(3)
0.00569

0.00700

64-512

-0.0009(10) 0.0095(10) 0.00859(2)

1.34 12%

64

-0.00011 0.000178 0.00343

64-512

21%

64

-0.00008 0.000750 0.00332

64-512

0.00103
0.0017(8)
0.00097
0.0018(7)

0.00530

0.00426
0.0047(8) 0.00632(3)
0.00410
0.0046(7) 0.00640(2)

0.0051

TABLE V: Finite size corrections for snapshop conﬁgurations of a hydrogen-helium mixture at diﬀerent densities, rs, and
diﬀerent helium concentrations xHe = NHe/(NHe + NH ). We give the size corrections based only on the Ne = 64 electron
system together with a linear extrapolation of the single particle (∆TT ABC ) corrected energies using a 2 × 2 × 2 tiling of unit
cell, denoted by Ne = 64 − 512. All size corrections correspond to energies per electron in units of Ha.

and similar for the leading order potential energy corrections

∆VLO = lim
k→0

vkδSee(k)

2V

=

2πρee2β

N

(47)

In table V we show the leading order size corrections and compare them to ∆Vlr obtained from interpolating only the
pure estimator for the ﬂuctuating structure factor as described in Sec.II D. The kinetic order corrections, ∆Tlr, were
obtained from the diﬀerence of the total energy corrections using the mixed estimator for the structure factor and the
potential energy corrections from the pure estimator using a trial wavefunction without long-range components. We
compare our size eﬀects with calculations of a 2 × 2 × 2 supercell with frozen positions of the ions.

IV. CONCLUSIONS

In this paper, we have discussed in detail the origin of ﬁnite size eﬀects in quantum Monte Carlo calculations for
electronic structure in extended systems. Based only on information on the wavefunction and the Hamiltonian, we
have explicitly shown the origin of size eﬀects having either single particle or many-body character. We have proposed
robust and a priori methods to reduce ﬁnite size errors without the need of performing calculations of diﬀerent sizes
nor relying on size extrapolations based on approximate calculations. Our methods do not assume any underlying
symmetry of the unit cell and have a comparable residual errors for solid and liquid structures. Although we have
used cubic supercells as benchmark for our calculations, non-cubic systems can be treated as well.

Most of the explicit results are given for Slater-Jastrow wavefunctions, with or without backﬂow orbitals, underlying
most of the quantum Monte Carlo calculations for condensed matter. However, we want to stress that our approach
is more general and can be extended to many other situations not explicitly discussed, e.g. Bose and Fermi systems
at zero and ﬁnite temperature [51, 52].

In particular, our method based on the interpolation of the static structure factor can be directly applied to any
system with pair-wise interaction to reduce the ﬁnite size error in the potential energy without any further assumption
on the trial wavefunction or the density matrix. More delicate are corrections of the two-body kinetic energy which
require knowledge of the long wavelength behavior of the eﬀective potentials of the underlying wavefunction, e.g. of
the eﬀective two-body Jastrow factor, uk, or the eﬀective backﬂow potential, yk. We also discussed and tested the
method when such information was not explicitly available.

Our analysis of size corrections are also useful to judge the validity of diﬀerent size extrapolation schemes [3–5].
However, as we have shown in the case of backﬂow wavefunctions, size-eﬀects, in general, can depend on the form
of the wavefunction, an aspect usually not taken into account by heuristic approaches. Our theory of ﬁnite size
extrapolation is based on reasonable assumptions of the correlation function which can be veriﬁed by additional
calculations. Although our discussion was based on Quantum Monte Carlo calculations, our theory of ﬁnite size
extrapolation should be applicable also to diﬀerent computational methods, e.g. FCIQMC [54].

Appendix A: Finite size error in terms of analytic properties of Fourier transform

Let us consider the general form of ﬁnite size error

(cid:34)(cid:90)

(cid:35)
(cid:88)

k

˜fk

dk

(2π)d − 1

Ω

∆F =

17

(48)

where ˜fk is obtained from the expression of the observable in Fourier space. Assuming the existence of the Fourier
transform f (r) of ˜fk, we have

(cid:34)

f (r) −(cid:88)

n

∆F = lim
r→0

(cid:35)

(cid:88)

n(cid:54)=0

f (r + nL)

=

f (nL)

(49)

where n is a d-dimensional vector with integer components. We see that for large systems, the ﬁnite size error is
directly connected to the long range behavior of f . The functions f and ˜f are usually isotropic for r → ∞, and k → 0,

respectively, f (r) ∼(cid:82) dkkd−1(cid:82) dΩd
˜fkeik·r and ˜fk ∼(cid:82) drrd−1(cid:82) dΩdf (r)eik·r, where Ωd denotes the angular part of
r−d−k+1 for r → ∞, and ∆F = O(cid:0)N−1−(k−1)/d(cid:1). If ˜fk is an analytical function, it must be a regular function of k2,

From existence of the nth derivative of ˜fk with respect to k = |k|, we see that |f (r)| must decay faster then

the volume integration.

its Fourier transform, f (r), and therefore also ∆F , decay exponentially with system size. Odd powers of k at the origin
indicate non-analytical behavior; we can reduce the ﬁnite size error by making the observable as smooth as possible,
e.g. separating these non-analytical points from the integrand. In the case of long range (Coulomb) potentials, the
˜fk
original summations involved in energy or potential energy exclude the term with k = 0. However, since limk→0
remains in general ﬁnite, the inclusion of this term already improves the convergence to the thermodynamic limit. It
can be further accelerated by separating out the non-analytic behavior around k = 0 to make the reminder in the
integrand more regular. The diﬃculty is to ﬁnd a general way to split of part of ˜fk around k = 0 without introducing
additional, artiﬁcial irregularities in the integrand.
For a classical Lennard-Jones potential, we can in general assume that f decays at least as fast as the potential,
f (r) ∼ v(r) ∼ r−6 for large r, and Eq.(49) directly leads to a ﬁnite size error of order N−2 in the potential energy for
three dimensional systems.

For quantum systems, even in the case of short range potentials, phase ﬂuctuations introduce long-range behavior
in the correlation functions giving rise to non-analytical terms in potential and kinetic energy, independent of the
statistics of the particles (Bosons or Fermions). The sharp Fermi surface in a metallic state further introduces a
discontinuity in the momentum distribution leading to slowly decaying oscillations in direct space, the origin of the
shell eﬀects in the kinetic energy.

Appendix B: The eﬀective Jastrow potential and long-range structure factor

Assume a quite general many-body wavefunction Ψ(R), R ≡ (r1, r2, ..rN ). The mean value of any observable O(R)

is given by

which we can re-write as

(cid:104)O(cid:105) =

where Π ≡ (ρk1, ρk2, ...ρkm ), ρk ≡(cid:80)N

(cid:82) dRO(R)|Ψ(R)|2
(cid:82) dR|Ψ(R)|2
(cid:82) dΠO(Π) ˜Ψ2(Π)
(cid:82) dΠ ˜Ψ2(Π)
ρkn −(cid:88)

δ

eikn·rj

n=1

j

(cid:104)O(cid:105) =

j=1 eik·rj , and
m(cid:89)

(cid:90)

dR

˜Ψ2(Π) ≡

(50)

(51)

(52)

|Ψ(R)|2

18
It is now natural to introduce an eﬀective action Seﬀ ≡ − log | ˜Ψ|, with a functional form which respects the symmetry
of the problem. The simplest eﬀective action which respects translational invariance is given by

(cid:88)

k(cid:54)=0

(cid:101)ueﬀ(k)ρkρ−k − 1

Ω2

(cid:88)

kq

Seﬀ (cid:39) 1
2Ω

w(k, q)ρk+qρ−kρ−q . . .

(53)

and reduces to a simple Jastrow functional form in leading order. Note that fermion eﬀects are correctly included in
this eﬀective Jastrow factor.

Using the simplest eﬀective action where we neglect the second term on the rhs of Eq.(53) we get

S(k) ≡ 1
N

(cid:104)ρ−kρk(cid:105)
Ω

2N(cid:101)ueﬀ(k)

(cid:39)

1

2ρ(cid:101)ueﬀ(k)

=

which should be exact for k → 0 in the spirit of the RPA.
Applying this result to non-interacting Fermions described by a single Slater determinant, we see that the eﬀective
Jastrow potential of the Slater determinant [2ρS0(k)]−1 is completely determined by the corresponding non-interacting
structure factor S0(k). For a general Slater-Jastrow wavefunction, we therefore obtain Eq. (41) which relates the
structure factor with the eﬀective Jastrow potential in the long wavelength limit.

(54)

(55)

(56)

(57)

(58)

(59)

(60)

Since φkj are (approximate) eigenfunctions of an eﬀective Hamiltonian, terms with i = j and α = β in the ﬁrst
summation on the r.h.s. are expected to dominate the expectation value

(cid:2)eik·rj ρ−k − 1(cid:3)

k yk

∇2qα
i .

∂D
∂qα
i

(cid:88)
(cid:88)

k

iα

i
Ω

+

(cid:105)

j

i ] ·(cid:104)∇qβ
(cid:88)

(cid:104)[∇qα

i ] · [∇qα
i ](cid:105)
(cid:88)

(cid:104)εi − vef f (qi)(cid:105)

Appendix C: Derivation of backﬂow corrections

Let us consider the following backﬂow corrdinates in the orbitals of the determinant

φkj ≡ φk(qj) with qj ≡ rj + ηj, and ηj =

so that the laplacian of the determinant is

(cid:88)

ijαβ

∇2D =

∂2D
i ∂qβ

j

∂qα

[∇qα

i

iα

iα

D

D

D

=

1
N

2me

(cid:29)

2meN

∇2D

≈ t
d

∂2
∂q2
iα

− 2

t = − 2
(cid:88)
(cid:88)

(cid:28) 1
(cid:28) 1
(cid:29)
(cid:88)
(cid:0)eik·rn ρ−k − 1(cid:1)(cid:35)
(cid:0)eik·riρ−k − 1(cid:1)(cid:35)2
(cid:42)
(k · k(cid:48))2ykyk(cid:48)(cid:0)eik·riρ−k − 1(cid:1)(cid:16)

k2 yk (S(k) − 1)

kαkβ yk

kαkβ yk

(cid:35)

k

k

δαβ − 1
Ω

(cid:88)

k

ρ
dΩ

(cid:34)
(cid:42)(cid:34)
(cid:88)
(cid:88)
(cid:88)

kk(cid:48)i

k

k

where

∇β
nqα

i = δni

δαβ − 1
Ω

and

1
N

(cid:88)

(cid:68)

iαβ

i ]2(cid:69)

[∇qα

=

=

(cid:88)

iβ

1
N

(cid:34)

1 − 2
dΩ

1

+

dΩ2N
(cid:39) 1 − 2
dΩ

is the single particle kinetic energy per particle using Eq. (19). We can now simplify

(cid:88)

k

+ (1 − δni)

1
Ω

kαkβ ykeik·(ri−rn)

(cid:88)

nβ

+

(1 − δni)

1
Ω2

(cid:43)

kαkβk(cid:48)

αk(cid:48)

β ykyk(cid:48)ei(k+k(cid:48))·(ri−rn)

(cid:88)

kk(cid:48)

(cid:17)

+

(cid:88)

(1 − δni)(k · k(cid:48))2 ykyk(cid:48)ei(k+k(cid:48))·(ri−rn)

(cid:43)

eik(cid:48)·riρ−k(cid:48) − 1

k2 yk (S(k) − 1) +

k4y2

k (S(k) + 1) .

n

(61)

From this analysis, we can expect that backﬂow introduces another kinetic energy correction given by

∆TBF ≈ t∆s

(cid:34)(cid:90)

∆s =

dk

(2π)d − 1

Ω

(cid:35)
(cid:88)

k

(cid:2)2 + ρk2yk −(cid:0)2 − ρk2yk

(cid:1) S(k)(cid:3)

k2yk

d

19

(62)

(63)

where t is the mean kinetic energy of the single particle orbitals in the determinant. From the long-range limit of the
electron electron backﬂow [12, 53], yq = −c(rs)/nq2 with c(rs) ≈ 1 + 0.075
rs) for d = 3, frow which we
obtain the leading order term

rs/(1 + 0.8

√

√

or

∆sLO = − 1
3N

∆T LO

BF = − t
3N

(64)

(65)

with t (cid:39) 3k2

F /10m for a metal with spherical dispersion relation.

Appendix D: Extrapolation of potential energy based on Ewald summation and corrections due to

non-analytic behavior of the structure factor

To derive the long-range contributions for potential and kinetic energy, Eqs (30) and (35), we have assumed that
the long-range part of the underlying potentials can be separated so that the resulting expressions in Fourier space
converge rapidly. In all examples provided in the main text, this separation was done numerically using optimized
potentials [28, 29]. Analytical expressions can be obtained for power-law potentials, in particular for the Coulomb
1/r-interaction, based on the method introduced by Ewald [11, 27, 30]. In this expression, the periodic Coulomb
potential inside a box of linear extension L, can be written as
k eik·r +
vlr

vsr(|r + nL|)

(cid:88)

(cid:88)

vpp(r) =

(66)

1
Ω

k

n

with

(67)

vlr
k =

4π

k2 e−k2/4α2

,

erfc(αr)

vsr(r) =

real space. In the following, we set α =(cid:112)kc/L and cut-oﬀ the sum in reciprocal space at wave vector kc together

where the parameter α controls the speed of convergence and n indicates the summation over all image charges in

r

with nearest-image convention in real space.
We illustrate the potential energy corrections for the homogeneous electron gas within the Hartree-Fock approxi-
mation [25]. Its structure factor in the thermodynamic limit is SHF (k) = 3k/4kF − k3/16k3
F . Using GC-TABC the
kinetic energy is exactly sampled. Additionally, the ﬁnite size structure factor SN (k) is identical to the inﬁnite one,
SN (k) ≡ S∞(k), on the discrete k-mesh compatible with the simulation box [8, 22]. Thus, size eﬀects are entirely
due to the discretization error inside the calculation of the exchange energy. It is straighforward to calculate the
long-range contribution to the potential energy corrections.

In deriving the energy correction formulas in the main text, we have assumed that the short range part of the
pair correlation function is not modiﬁed by size corrections. This would be the case if the structure factor was an
analytical function of k. However, within Hartree-Fock, the linear behavior of the structure factor strongly violates
this assumption in contrast to the expected k2-behavior in more realistic calculations beyond Hartree-Fock. We can
take into account this behavior by

(cid:34)(cid:90)

∆Vsr =

dk

(2π)d − 1

(cid:35)
(cid:88)

(cid:104)(cid:101)SN (k) −(cid:101)SN (kc)

(cid:105)

vsr
k

θ(kc − k)

where (cid:101)SN (k) is the interpolation of the structure factor imposing a vanishing derivative at the cut-oﬀ kc and vsr
)/k2 for the Ewald potential. Notice, that we have inserted (cid:101)SN (kc) to force the integrand to vanish

4π(1 − e−k2/4α2
at kc, but the diﬀerence between the discrete sum and the integration vanishes to high precision by construction.

k =

Ω

k

(68)

20

FIG. 5: Diﬀerences of the potential energy per electron, VN , in units of Ha, relative to the thermodynamic limit, V∞ for the
homogeneous electron gas at rs = 1 within the Hartree-Fock approximation. The black symbols are GCTABC results of the
ﬁnite system with N electrons, red symbols corresponds to the ﬁnite size corrected ones with long and short range corrections,
∆Vlr and ∆Vsr, using the Ewald method described in appendix D. In the inset we compare the long and short range potential
corrections, ∆Vlr (pink symbols), and ∆Vsr + ∆Vlr (red symbols) with the leading order corrections (blue symbols) of Ref. [13].
Lines are guides to the eyes. For all size corrections, the value of the slope of the structure factor at the origin is estimated from
its values at the discrete k-mesh, imposing the exact value, the energy diﬀerence can be further improved and VN + ∆Vlr + ∆sr
becomes equal to the thermodynamic limit on the scale of the ﬁgures.

In Fig. 5, we show the ﬁnite size error in the exchange energy of the electron gas at rs = 1 within the Hartree-Fock
approach and the results of the potential energy corrections above in comparison with the leading order corrections
[13]. For all size corrections, the value of the slope of the structure factor around the origin is estimated by ﬁnite
diﬀerence of the ﬁnite size structure factor. Imposing the exact value of the slope, deviations to the thermodynamic
limit of our best a priori value of the exchange energy, VN + ∆Vlr + ∆Vsr, are of order (cid:46) 10−5Ha for N (cid:38) 10. Our
procedure can therefore be considered as optimal.
In realistic calculations (beyond Hartree-Fock), screening eﬀects strongly modify long-range behavior of the structure
factor compared to the Hartree-Fock behavior leading to S(k) ∼ k2 around k = 0. Although non-analytic behavior
may still occur beyond leading order (terms of order k3), the corresponding size corrections ∆Vsr are expected to be
much reduced. In practice, it is diﬃcult to use Eq. (68) to correct for non-analytical terms beyond leading order, so
that we have only taken into account Vlr for size corrections in 3D. However, if we can extract the non-analytical
behavior, S(k) = akα + bk2 + . . . ... around k = 0, we can estimate these corrections from the asymptotic expansion

∆Vsr = a

vsr
k kα

(69)

These corrections are of order N−2 in 3D (α = 3) and L−7/2 ∼ N−7/4 in 2D (α = 3/2).

Acknowledgments

CP was partially supported by the Italian Institute of Technology (IIT) under the SEED project Grant 259
SIMBEDD. MAM was supported by the U.S. Department of Energy at the Lawrence Livermore National Laboratory
under Contract DE-AC52-07NA27344. MAM, RC were supported through the Predictive Theory and Modeling for
Materials and Chemical Science program by the Basic Energy Science (BES) DMC and RC were supported by DOE
grant NA de-na0001789 and by the NanoSciences Fondation (Grenoble). MH and CP thank the Theory Group at ILL
Grenoble for hospitality. Computer time was provided by PRACE projects 2011050781 and 2013091918 and by an
allocation on the Blue Waters sustained-petascale computing project, supported by the National Science Foundation

(cid:34)(cid:90)

(cid:35)

(cid:88)

dk

(2π)d − 1

Ω

k

00.010.020.030.040.050.060.070.080.090.1 N-1-0.1-0.08-0.06-0.04-0.020 (VN-V!)/N  (a.u.) VN VN+"Vlr+"Vsr00.020.040.060.080.1-0.006-0.0030 VN+"Vlr+"Vsr VN+"Vlr VN+"VLO(award number OCI 07-25070) and the state of Illinois, and by CNRS-IDRIS, Project No. i2014051801.

21

[1] W. M. C. Foulkes, L. Mitas, R. J. Needs, and G. Rajagopal Rev. Mod. Phys. 73, 33 (2001).
[2] J. Kolorenc and L. Mitas, Rep. Prog. Phys. 74, 026502 (2011).
[3] G. Rajagopal, R. J. Needs, S. Kenny, W. M. C. Foulkes, and A. James, Phys. Rev. Lett. 73, 1959 (1994).
[4] A. J. Williamson, G. Rajagopal, R. J. Needs, L. M. Fraser, W. M. C. Foulkes, Y. Wang, and M.Y. Chou, Phys. Rev. B

55, R4851 (1997).

[5] H. Kwee, S. Zhang, and H. Krakauer, Phys. Rev. Lett. 100, 126404 (2008).
[6] M. Holzmann, B. Bernu, and D. M. Ceperley, J. Phys.: Conf. Ser. 321 012020 (2011).
[7] M. Boninsegni and S. Moroni, Phys. Rev. E 86, 056712 (2012).
[8] S. Chiesa, D.M. Ceperley, R.M. Martin, and M. Holzmann, Phys. Rev. Lett. 97, 076404 (2006).
[9] S. Chiesa, D. M. Ceperley, R. M. Martin, and M. Holzmann, AIP Conference Proceedings Volume 918 LECTURES ON
THE PHYSICS OF STRONGLY CORRELATED SYSTEMS XI: Eleventh Training Course in the Physics of Strongly
Correlated Systems, p. 284-288 (2007).

[10] T. Gaskell, Proc. Phys. Soc. London 77, 1182 (1961).
[11] D. Ceperley, Phys. Rev. B 18, 3126 (1978).
[12] M. Holzmann, D.M. Ceperley, C. Pierleoni, and K. Esler, Phys. Rev. E 68, 046707 (2003).
[13] N.D. Drummond, R.J. Needs, A. Sorouri, and W.M.C. Foulkes, Phys. Rev. B 78, 125106 (2008).
[14] L. Shulenburger and T. R. Mattsson, Phys. Rev. B 88, 245117 (2013).
[15] S. Azadi and W.M.C. Foulkes, J. Chem. Phys. 143, 102807 (2015).
[16] M. Holzmann, B. Bernu, V. Olevano, R.M. Martin, and D.M. Ceperley, Phys. Rev. B 79, 041308(R) (2009).
[17] M. Holzmann, B. Bernu, C. Pierleoni, J. McMinis, D. M. Ceperley, V. Olevano, and L. Delle Site, Phys. Rev. Lett. 107,

110402 (2011).

[18] S. Huotari, J. A. Soininen, T. Pylkknen, A. Titov, A. Issolah, K. Hmlinen, J. McMinis, J. Kim, K. Esler, D.M. Ceperley,

M. Holzmann, and V. Olevano, Phys. Rev. Lett. 105, 086403 (2010).

[19] J. McMinis and N.M. Tubman, Phys. Rev. B 87, 081108(R) (2013).
[20] J. Zinn-Justin, Quantum Field Theory and Critical Phenomena, Clarendon Press, Oxford (1996).
[21] K. Binder and D.W. Heermann, Monte Carlo Simulation in Statistical Physics, Spinger-Verlag, Berlin Heidelberg (1997).
[22] C. Lin, F.-H. Zong, and D. M. Ceperley, Phys. Rev. E 64, 016702 (2001).
[23] M. Holzmann, B. Bernu, and D.M. Ceperley, Phys. Rev. B 74, 104510 (2006).
[24] S. Baroni and S. Moroni, Phys. Rev. Lett. 82, 4745 (1999).
[25] L. Baguet, F. Delyon, B. Bernu, and M. Holzmann, Phys. Rev. Lett. 111, 166402 (2013).
[26] C. Pierleoni, K. T. Delaney, M. A. Morales, D.M. Ceperley, and M. Holzmann, Comp. Phys. Comm. 179, 89 (2008).
[27] P.P. Ewald, Ann. Phys. 64, 253 (1921).
[28] V. Natoli, D. Ceperley, J. Comput. Phys. 117, 171 (1995).
[29] M. Holzmann and B. Bernu, J. Comput. Phys. 206, 111 (2005).
[30] Mike P. Allen, Dominik J. Tildesley, Computer Simulation of Liquids, Clarendon Press, Oxford (1987).
[31] P. Nozires and D. Pines, The Theory of Quantum Liquids, Perseus Books, Cambridge, MA (1966).
[32] G. Ortiz, D.M. Ceperley, and R.M. Martin, Phys. Rev. Lett. 71, 2777 (1993).
[33] C. Pierleoni, M.A. Morales, G. Rillo, M. Holzmann, and D.M.Ceperley, Proc. Nat. Acad. Sci. USA, in press (2016).
[34] G. Mazzola and S. Sorella, Phys. Rev. Lett. 114, 105701 (2015).
[35] N.M. Tubman, E. Liberatore, C. Pierleoni, M. Holzmann, and D. M. Ceperley, Phys. Rev. Lett. 115, 045301 (2015).
[36] C. Pierleoni and D. M. Ceperley, Computer Simulations in Condensed Matter Systems: From Materials to Chemical
Biology, eds. M. Ferrario, G. Ciccotti, K. Binder, Lecture Notes in Physics Vol 703 , pgs. 641-683, Springer Berlin
Heidelberg (2006).

[37] J. M. McMahon, M.A. Morales, C. Pierleoni, D. M. Ceperley, Rev. Mod. Phys. 84, 1607 (2012).
[38] M.A. Morales, R. C. Clay III, C. Pierleoni, D.M. Ceperley, Entropy 16 (1), 287 (2013).
[39] P. Giannozzi, S. Baroni, N. Bonini, et al., J. Phys. Condens. Matter 21, 395502 (2009).
[40] D.M. Ceperley, M. Dewing and C. Pierleoni “The coupled Electronic-Ionic Monte Carlo simulation metho”, Lecture Notes

in Physics, 605, 473 (2002).

[41] D.M. Ceperley and B. J. Alder, Phys Rev B 36, 2092 (1987)
[42] M.A. Lee, K.E. Schmidt, M.H. Kalos, and G.V. Chester, Phys. Rev. Lett. 46, 728 (1981).
[43] Y. Kwon, D. Ceperley, R. Martin, Phys. Rev. B 50, 1684 (1994).
[44] P. L. Rios, A. Ma, N. D. Drummond, M. Towler, and R. J. Needs, Phys. Rev. E 74 066701 (2006).
[45] C. Pierleoni, K. T. Delaney, M. A. Morales, D.M. Ceperley, and M. Holzmann, Comp. Phys. Comm. 179, 89 (2008).
[46] M. Taddei, M. Ruggeri, S. Moroni, and M. Holzmann, Phys. Rev. B 91, 115106 (2015).
[47] R. C. Clay III, M. Holzmann, D. M. Ceperley, and M. A. Morales, Phys. Rev. B 93, 035121 (2016).
[48] supplementary material of [47].
[49] K.P. Esler, J. Kim, D.M. Ceperley, and L. Shulenburger, Computing in Science & Engineering 14, 40 (2012).

22

[50] J. Kim, K.P. Esler, J. McMinis, M.A. Morales, B.K. Clark, L. Shulenburger, and D.M. Ceperley, Journal of Physics:

Conference Series 402, 012008 (2012).

[51] E.W. Brown, B. K. Clark, J. L. DuBois, and D. M. Ceperley, Phys. Rev. Lett. 110, 146405 (2013).
[52] E.W. Brown, J.L. DuBois, M. Holzmann, and D.M. Ceperley, Phys. Rev. B 88, 081102(R) (2013); E.W. Brown, J.L.

DuBois, M. Holzmann, and D.M. Ceperley, Phys. Rev. B 88, 199901(E) (2013).

[53] Here, yq diﬀers by a minus sign from the deﬁnition in [12].
[54] J. J. Shepherd, G. Booth, A. Gr¨uneis, and A. Alavi, Phys. Rev. B 85, 081103(R) (2012).
[55] The plasma frequency is independent of the wave vector in 3D, whereas it is k-dependent in 2D.
[56] For dilute Bose gases and liquid helium we expect uk ∼ k−1 and S(k) ∼ k. The corresponding two-body corrections of the

potential and kinetic energy are of order N−4/3.

[57] Here, the discussion is limited to 3D electronic systems. In 2D or 1D, the non-analytical behavior of the structure factor
U should be added

are more important and ∆Vsr together with the corresponding corrections for the kinetic energy ∆T sr
for size extrapolation. See appendix D.

[58] Here, we consider classical protons. For quantum protons, proton-proton correlations must also be included in the kinetic

energy size corrections.

23

