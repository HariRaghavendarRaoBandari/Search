NMR signal for particles diffusing under potentials: From path integrals

and numerical methods to a new model of diffusion anisotropy

Cem Yolcu,1 Muhammet Memic¸,1 Kadir S¸ims¸ek,1 Carl-Fredrik Westin,2 and Evren ¨Ozarslan1, 2, ∗

1Department of Physics, Bo˘gazic¸i University, Bebek, ˙Istanbul, 34342, Turkey

2Department of Radiology, Brigham and Women’s Hospital,

Harvard Medical School, Boston, MA, 02215, USA

Abstract

We study the inﬂuence of diffusion on NMR experiments when the molecules undergo random motion

under the inﬂuence of a force ﬁeld, and place special emphasis on parabolic (Hookean) potentials. To this

end, the problem is studied using path integral methods. Explicit relationships are derived for commonly

employed gradient waveforms involving pulsed and oscillating gradients. The Bloch-Torrey equation, de-

scribing the temporal evolution of magnetization, is modiﬁed by incorporating potentials. A general solution

to this equation is obtained for the case of parabolic potential by adopting the multiple correlation function

(MCF) formalism, which has been used in the past to quantify the effects of restricted diffusion. Both ana-

lytical and MCF results were found to be in agreement with random walk simulations. A multi-dimensional

formulation of the problem is introduced that leads to a new characterization of diffusion anisotropy. Unlike

for the case of traditional methods that employ a diffusion tensor, anisotropy originates from the tensorial

force constant, and bulk diffusivity is retained in the formulation. Our ﬁndings suggest that some features

of the NMR signal that have traditionally been attributed to restricted diffusion are accommodated by the

Hookean model. Under certain conditions, the formalism can be envisioned to provide a viable approxima-

tion to the mathematically more challenging restricted diffusion problems.

6
1
0
2

 
r
a

 

M
1
2

 
 
]
h
p
-
d
e
m

.
s
c
i
s
y
h
p
[
 
 

1
v
3
7
3
6
0

.

3
0
6
1
:
v
i
X
r
a

∗Electronic address: evren.ozarslan@boun.edu.tr

1

I.

INTRODUCTION

Through its inﬂuence on the diffusion of spin-bearing particles, the physical characteristics of

the medium leaves its signature on the observed NMR signal. This makes NMR a powerful probe

into the microstructure of biological specimens as well as other porous media. NMR’s sensitivity

to diffusional processes can be controlled by introducing gradient waveforms into standard NMR

experiments [1].

The effect of free diffusion on experiments with general gradient waveforms has been fully

characterized [2, 3]. However, the complexity of the environment typically leads to non-Gaussian

motion, which yields interesting features in the NMR signal decay that depend on the local struc-

ture. For example, a time-dependence in the diffusion coefﬁcients [4–6] tend to emerge in complex

environments, while the large wavenumber regime of the signal decay could exhibit unique fea-

tures [7, 8] as well. Time dependence in diffusion coefﬁcients was investigated extensively with

emphasis on (non-)ergodicity and ageing [9–11]. It has also been studied as a possible indicator

of mesoscopic disorder in materials and tissues, making use of diffusion-sensitive NMR images

[12, 13] (see Ref. [14] for a comprehensive review on diffusion in tissues). Fractional Brown-

ian motion is yet another viable model in which to view the signatures of non-Gaussian motion

in NMR signals, which is amenable to path integral methods [15] similar in that regard to the

approach discussed in the present article.

In this paper, we consider the case of diffusion taking place under the inﬂuence of a Hookean

force ﬁeld. This problem is well-studied in the ﬁeld of stochastic processes [16–18]. To our

knowledge, the ﬁrst occurrence of it in the NMR literature is in a couple of papers published in

1960s [2, 19], wherein the authors consider the case of “diffusion near an attractive center” and

derive the signal expression for their then recent pulsed ﬁeld gradient framework [1]. Since then

Callaghan and Pinder used the formalism on a semi-dilute solution of an entangled polystyrene

to model the displacements of the resulting network, which is stable during the timescale of the

NMR measurement [20, 21]. Le Doussal and Sen employed the problem as an “artiﬁcial pore”

model to understand the effects of restricted diffusion in the presence of nonlinear magnetic ﬁeld

gradients [22]. Mitra and Halperin also touched upon the problem, referring to it as the “parabolic

pore” in the context of the center-of-mass propagators [23].

In this article, we have two main goals: (i) to provide an analytical framework with which

one can derive explicit relationships for the signal decay for a general time-dependent gradient

2

waveform, and (ii) develop semi-analytical and numerical tools, which could be generalized with

relative ease to complicated potentials. As demonstrated below, our formulation naturally leads

to a new characterization of diffusion anisotropy; similar in spirit to the diffusion tensor model

[24]. However, while the latter tries to ﬁt imaging data to a free diffusion model despite the un-

derlying non-free diffusion, the present framework allows taking conﬁnement into account, which

is modeled as a harmonic force. The advantage of taking conﬁnement into account is found in

the time dependence of the predicted signal proﬁle, which exhibits features more similar to that of

actual restricted diffusion. Employing a harmonic conﬁnement instead of a direct implementation

of restricted diffusion, on the other hand, offers a degree of tractability that encodes full anisotropy

easily. For instance, compared to a restricted diffusion model involving a capped cylinder [25],

which has two length parameters due to its partial isotropy, the conﬁnement tensor generally has

three distinct size parameters (related to its eigenvalues) that can capture full three-dimensional

anisotropy, much like the diffusion tensor model.

The article is organized as follows: In the next section, Sec. II, we express the NMR signal as

a path integral and evaluate it assuming a Hookean potential as stated above, providing a general

expression that can be used with arbitrary gradient sequences. As such, we end the section by

deriving analytical expressions for the expected NMR signal for the conventional pulsed ﬁeld

gradient (Stejskal-Tanner) and oscillating gradient sequences. For the sake of keeping the main

text to the point, technicalities involved in evaluating the path integral are discussed in great detail

in Appendix A. In the subsequent section, Sec. III, we introduce the formulation of the semi-

analytical multiple correlation function framework (MCF) [26–29], assuming a general conﬁning

potential.

Its application to the special case of a Hookean potential is presented in Appendix

B, along with relevant technical details. In Sec. IV, the random walk simulations are described

before proceeding with the validation of the (semi-)analytical approaches and the deliberation of

the Hookean model as an alternative tool for the characterization of diffusion anisotropy in the

Results section, followed by concluding remarks.

3

II. ANALYTICAL RESULTS THROUGH A PATH INTEGRAL FORMALISM

A. General gradient waveforms

Here, we derive an analytical expression via a path integral for the average transverse magneti-

zation in a specimen, stemming from spin-bearing random walkers subject to a Hookean potential.

In order to isolate details of the derivation from the results, we have placed most of the former in

Appendix A while restricting to the essential points in this section.

In a medium subjected to a (spatially) non-uniform magnetic ﬁeld, a diffusing spin-carrier ex-

periences a rate of (Larmor) precession that varies with respect to its spatial position. Compared

to a steady precession in the case of a uniform magnetic ﬁeld, therefore, each particle picks up

a phase in its rotation, depending on its random path. Hence, from an ensemble of such ran-

dom walkers in a (time-dependent) spatially linear magnetic ﬁeld gradient G(t) of duration tf, an
average signal of

E =(cid:28)exp(cid:18)−iγZ tf

0

dt G(t) · r(t)(cid:19)(cid:29) ,

(1)

is obtained, which is the average transverse magnetization up to a unit. Here, since the average is

to be taken over all random paths r(t), the expectation value has the form of a path integral,

E =Z Dr(t)P[r(t)] e−iγ R tf

0 dt G(t)·r(t) ,

(2)

where R Dr(t) denotes an integral over the space of paths, and P[r(t)] the weight of the path

r(t). Note that E is a normalized quantity that takes the value of 1 when G = 0, and γ is the

gyromagnetic ratio. The probability weight P[r(t)] is most easily imagined as an inﬁnite product

of stepwise probabilities of transition from each intermediate path point to the next.

In this article, we assume that the stochastic process underlying the random paths is diffusion

with diffusivity D0 under the effect of a dimensionless Hookean potential,1

V (r) =

1
2

r⊺Cr ,

(3)

where we refer to C, having dimension of inverse length squared, as the conﬁnement tensor. The

true tensorial force constant can be obtained by multiplying C by the Boltzmann constant kB and
the absolute temperature T .

1 In this article, we customarily use boldface symbols for collections of numbers, be them vectors or matrices.

4

We argue that the potential deﬁned above sufﬁces to capture relevant features of diffusion in

conﬁned spaces. The advantage of the assumption is that the stepwise probabilities mentioned

above have a simple form (see Appendix A) and the resulting path weight is analytically tractable.

We ﬁnd that the NMR signal, or average transverse magnetization, that ensues the application of

an arbitrary gradient waveform G(t) is expressed as

where

and

E = exp(cid:18)−D0Z tf

0

dt|Q(t)|2 −

D0
2

Q⊺(0)Ω−1Q(0)(cid:19) ,

Q(t) = γZ tf

t

dt′ e−Ω(t′−t)G(t′) ,

Ω = D0C

(4)

(5)

(6)

is a matrix of rate constants (inverse time), simply proportional to the conﬁnement tensor C. The

inverse of this matrix encodes the time scales involved in equilibration, namely the approach of
a distribution of diffusing particles toward the Boltzmann distribution ∼ e−V (r). Essentially, it is
the ﬁnite width of this ﬁnal Gaussian proﬁle that is regarded as a measure of conﬁnement in the

present article, by matching it to the width of an actual conﬁned geometry (Appendix A 2).

B. Explicit results for common gradient waveforms

The results derived above can be employed to obtain exact expressions for the NMR signal

intensity for any gradient waveform.

In this section, we shall consider two widely employed

experiments illustrated in Figure 1. The ﬁrst sequence is Stejskal and Tanner’s pulsed ﬁeld gradient

technique [1] while the second one features an oscillatory (sinusoidal) proﬁle [30].

1.

Stejskal-Tanner sequence

Here, we use Eqs. (4) and (5) to predict the NMR signal that should be recovered from spin-

bearing random walkers subject to a three dimensional harmonic potential in a traditional pulsed

ﬁeld gradient experiment introduced by Stejskal and Tanner [1]. As illustrated on the top panel in

Figure 1, the effective waveform comprises two gradient pulses in opposite directions with a delay

5

δ

G

Δ

2π ω

G

Figure 1: (Color online) Top: Stejskal and Tanner’s pulsed ﬁeld gradient sequence. Bottom: Oscillating

gradient waveform.

∆ between their leading edges. Each pulse has magnitude G and duration δ. Due to the tractability

of our “harmonic approximation,” an expression for the signal can be obtained easily, valid for all

possible values of the experimental parameters.

The ﬁrst thing to do is to evaluate the integral (5) for Q(t), which is straightforward (as noted

before, one may wish to consider temporarily the eigenbasis). One ﬁnds (taking the transpose for

convenience),

Q⊺(t) = γG⊺Ω−1

1 −(cid:2)e−Ω∆ + e−Ωδ − e−Ω(∆+δ)(cid:3) eΩt , 0 < t < δ
(cid:2)e−Ω(∆+δ) − e−Ω∆(cid:3) eΩt
e−Ω(∆+δ)eΩt − 1
0

, ∆ + δ < t

, δ < t < ∆

, ∆ < t < ∆ + δ

,

(7)




where 1 represents the 3 × 3 identity matrix. What remains is the tedious task of squaring2 and
integrating this expression to evaluate the signal (4). After a bit of algebra and simpliﬁcations, we

obtain the quadratic expression (in G)

E = exp(−G⊺AG) ,

(8)

2 By the square of the vector Q we of course mean Q⊺Q. It is useful to note that all the matrices that will end up
between Q⊺ and Q according to Eqs. (4) and (7) commute (since they all are eventually powers of Ω) and are
symmetric, simplifying the algebra greatly.

6

where the real symmetric matrix

A = D0γ2Ω−3h(cid:0)1 − e−Ω∆(cid:1)(cid:0)1 − e−Ωδ(cid:1)2

eΩδ −(cid:0)1 − e−2Ωδ(cid:1) eΩδ + 2Ωδi .

The last two expressions provide a model alternative to the diffusion tensor model [24, 31]

(9)

commonly used in biomedical applications of magnetic resonance imaging. The main difference

is the dependence of the predicted signal on the timing parameters of the sequence. In diffusion

tensor imaging (DTI), this dependence is the same as that for free (Gaussian) diffusion. In the

Hookean potential model, the dependence is consistent with restricted diffusion [32].

As a check, one may evaluate Eqs. (8) and (9) to order δ3, to obtain

ln E ≈ −D0γ2δ2G⊺Ω−1(cid:18)1 − e−Ω∆ −

Ωδ

3 (cid:19) G ,

(10)

which is the anisotropic generalization of Stejskal’s result [2] for a spherically symmetric harmonic
potential, with the additional O(δ3) term. In the Ω → 0 (i.e., C → 0) limit, the Stejskal-Tanner
expression for free diffusion is recovered [1] as expected.

2. Oscillating gradient

Next, we shall consider the sinusoidal waveform with angular frequency ω as depicted in the

bottom of Figure 1. Owing to the simplicity of diffusion inside a harmonic potential, we were able

to derive an analytical expression for the average magnetization for this waveform as well. Since

the gradient is applied in a ﬁxed direction, the formulation in Appendix A 2 is sufﬁcient to obtain

the exact result.

The gradient proﬁle is of the form G(t) = G cos(ωt + ϕ). We consider an experiment with N
full periods, i.e., G(t) vanishes outside the interval 0 ≤ t ≤ 2πN/ω. One ﬁnds, from Eq. (A13),
that

Q(t) =

γG

√Ω2 + ω2hcos(ωt + ϕ+) − cos ϕ+eΩ(t− 2πN

ω )i ,

(11)

where ϕ+ = ϕ + cot−1(Ω/ω). The signal then follows from Eq. (A11) after some rearrangement
as

Ω2 + ω2
D0γ2G2 ln E =

cos ϕ− cos ϕ+

Ω

with ϕ− = ϕ − cot−1(Ω/ω).

7

(cid:16)1 − e−2πN Ω

ω(cid:17) −

πN
ω

,

(12)

III. MCF FORMALISM

In this section, we shall visit the same problem using the multiple correlation function (MCF)

formalism, which has been used in the past to characterize the effect of restricted diffusion on the

NMR signal. Technical details may be found in Appendix B. We refer the reader to Ref. [33] for

a recent review of the technique consistent with the notation here, and its relations with the path

integral framework discussed in the previous section.

The multiple correlation function formalism aims to compute the NMR signal

E(t) =Z dr m(r, t)

(13)

from the time evolution of the (appropriately-normalized) magnetization density m(r, t). In the

presence of a potential V (r), diffusion is governed by the Smoluchowski equation [17], while

the transverse magnetization carried by the random walkers need also be taken into account. This

suggests that, under a magnetic ﬁeld gradient waveform G(t), the evolution of m(r, t) is governed

by an equation akin to the Bloch-Torrey equation [34], which we shall refer to as the Bloch-Torrey-

Smoluchowski (BTS) equation,

∂
∂t

m(r, t) =D0∇ ·(cid:0)e−V (r)∇eV (r)m(r, t)(cid:1)

− iγG(t) · r m(r, t) ,

(14)

where this time the diffusion term deals also with the potential. Clearly, the above expression is

reduced to the Bloch-Torrey equation when the potential is zero.

The solution m(r, t) of the BTS equation (14) is best considered in the abstract function space,

in terms of a propagator responsible for the evolution of the magnetization in time. Due to the ex-

plicit time dependence of the operator on the right hand side of Eq. (14), the associated propagator
is formally a time-ordered product of operators of the form exp{∆t[Λ + Γ(t)]} over successive
time intervals of length ∆t. The abstract operators Λ and Γ(t) correspond, respectively, to the

two operators whose position-space representations appear on the right hand side of Eq. (14). We

will refer to Λ as the Smoluchowski operator, which governs the evolution of the spin population

under an arbitrary potential V (r).

In Appendix B, we show that the signal (13) ends up being expressable in the eigenbasis of the

Smoluchowski operator as the matrix element of the propagator corresponding to the stationary

8

eigenvalue: Denoting the left and right eigenvectors with hwk| and |uki, the signal has the form

E = hw0| Y′

t

e∆t[Λ+Γ(t)] |u0i ,

(15)

where the prime on the product indicates time ordering (i.e., the earliest factor acts ﬁrst), and t is

to be understood as a time point representative of each time interval. With this perspective, the

MCF approach relies on using the eigenbasis of the Smoluchowski operator to carry out the matrix

operations involved in evaluating the propagator and thereby the signal (15). The two operators

Λ and Γ are expressed in the eigenbasis of Λ, which is done analytically in Appendix B for the

case of a Hookean potential. The remaining operations of exponentiation and matrix product are

eventually carried out by software according to the waveforms we consider in the Results section.
Note that while a general time dependence requires a continuum limit (∆t → 0) in Eq. (15),
piecewise-constant waveforms such as those of pulsed-ﬁeld-gradient experiments do not. The

latter situation lends itself readily to a product of constant exponential operators over the plateaus

of the waveform, without any discretization error. On the other hand, the case of a general time

dependence is treated as a controlled approximation based on the size of ∆t. Another inevitable

source of numerical error is the need to truncate the matrix representations, which are in principle

inﬁnite. However, one simply has to include all eigenfunctions whose time scales of decay (i.e.,

inverses of their eigenvalues) are signiﬁcant compared to the time step ∆t.

IV. RANDOM WALK SIMULATIONS

To provide a validation of the theoretical developments described above, we simulated random

walks taking place under a Hookean potential and computed the phase accumulated by each ran-

dom walker, which was subsequently used in the estimation of the NMR signal. To this end, we

performed biased Bernoulli walk simulations using Python. For the purposes of the present article,

we have employed these simulations only in one spatial dimension.

Brieﬂy put, each particle’s motion is generated based on Bernoulli trials performed at uniform
time intervals τ. The trials are biased in the sense that the probabilities p+ = p and p− = 1 − p
of changing the particle’s coordinate by a or −a, respectively, are not equal due to the presence
of a force. The desired diffusive character—corresponding to a bare diffusion constant D0—of a
random walk generated as such is met by the condition

D0 =

a2
2τ

.

9

(16)

On the other hand, if the drift velocity (p+ − p−)a/τ of the random walker is supposed to match
the drift velocity (kBT )−1D0F of a Brownian mover under a force F , then the bias must be

p+ − p− =

D0τ
kBT a

F =

a

2kBT

F .

(17)

The conditions in (16) and (17) ﬁx two of the simulation parameters p, a, and τ. As a ﬁnal

condition, one may set the resolution of the simulations by choosing τ to be smaller than the
thermalization time scale Ω−1 = (D0C)−1 of Eq. (A4a) by a desired amount.

Generating random particle trajectories according to the scheme described above, at each step

we can compute the phase that would be accumulated due to a magnetic ﬁeld gradient, and hence

“measure” the NMR signal resulting from a large number of trajectories. The simulated signal

values which will be presented in the next section have been computed thusly.

V. RESULTS

A. Validation of the approach

Here, we present and compare results obtained from (i) the application of the analytical ex-

pressions of Sec. II, (ii) the numerical implementation of the MCF scheme of Sec. III, and (iii)

simulated data as described in Sec. IV. To this end, we consider the same two waveforms dis-

cussed in Sec. II B and illustrated in Figure 1.

a. Stejskal-Tanner sequence. The ﬁrst diagram in Fig. 2 depicts the NMR signal as a func-

tion of pulse separation ∆ at ﬁxed q = γGδ. The pulse duration was δ = 1 ms, and the value of

G was chosen so that the wavenumber is q/2π = 100 mm−1. The temperature and bulk diffusivity
were taken to be T = 310 K, and D0 = 3 µm2/ms, respectively. The force constant was chosen
such that C = 0.33 µm−2; through Eq. (A6), this leads to an effective pore size Leﬀ = 6 µm, which
is roughly the size of a red blood cell. The analytical result is due to the application of Eq. (8),

whereas the numerical implementation of the MCF signal (15) is achieved via Eqs. (B19)–(B22).

The random walk simulations were performed using a step size of a = 0.1 µm, and a time step of
τ = a2/2D0 = 1.67 µs. A total of 2 million trajectories were generated.

The decay of the signal with increasing diffusion time is seen to be captured faithfully by

the MCF implementation and random walk simulations as well. In Fig. 2(bottom), we show the

absolute error of MCF and the simulations. The MCF implementation is error-free in the PFG

scheme, since the pulse sequence is actually piecewise constant.

10

Analytic

Random Walk

MCF

101

Δ (ms)

ndom Walk

MCF

0.70

0.65

0.60

E

0.55

0.50

0.45

0.40

100

−3

E
∆

100

101

Δ

Figure 2: (Color online) Top: The predicted NMR signal plotted against the gradient pulse separation

(diffusion time) in a Stejskal-Tanner pulse sequence. Bottom: Errors incurred in MCF and random walk

results. The plotted values are the absolute values of the deviations from the analytical results.

b. Oscillating gradient waveform. We show the results for the oscillating waveform in Fig-

ure 3. The same values for the temperature, bulk diffusivity, and the force constant, hence the

effective pore size, were used. The phase shift of the waveform was taken to be ϕ = 0, i.e.,

G(t) = G cos(ωt) with G = 1 T/m. In these simulations, the total duration of the waveform was

ﬁxed at 100 ms for all frequencies. Frequency was varied by changing the number of full periods

(N) within this timeframe. So, N = 1 corresponds to the lowest frequency, while the subsequent

points were generated by setting N = 2, 3, . . . The MCF results were obtained by setting the time

interval to 10 µs for all frequencies. The random walk simulations were performed in the same

way as for the case of the Stejskal-Tanner sequence.

11

The frequency dependence of the signal seems to be consistent in all three methods. The

errors in the random walk and MCF results are rather small as shown in the bottom panel of

Figure 3. Unlike before though, the MCF results do exhibit some deviation from the analytical

results. At the low end of the frequency range, errors of the MCF scheme approach zero, since

its staircase approximation of a slowly-varying waveform is sufﬁciently faithful. As the waveform

explores increasingly higher frequencies, the approximation is seen to worsen until the period
of the waveform reaches the thermalization timescale Ω−1 = (D0C)−1 ≃ 1ms. Beyond this
neighborhood of frequencies, less and less time remains for appreciable diffusion to take place in

each period of the gradient waveform. Since the sensitivity of the signal value to the magnetic ﬁeld

inhomogeneity stems from diffusion, this suppresses the inﬂuence of any misrepresentation of the

precise gradient waveform, appearing as a tapering-off of the error with increasing frequency in

spite of the worsening approximation of the MCF scheme: As long as the MCF time discretization

scale is chosen safely below the thermalization time Ω−1, the expected increase of error with

increasing frequency due to time-discretization is tamed.

The random walk simulations offered yet another test for the validity of our result for the os-

cillating gradient waveforms. For these simulations, the suppression of errors with increasing

frequency has to do with statistics. At low frequencies, the expected value of the average mag-

netization is zero, implying that the spin-bearers have a wide distribution of accumulated phase

angles, in order to have resulted in a lot of mutual cancellation. On the other hand, the expected

magnetization is maximized at high frequencies, implying a sharp distribution of phase angles. In

the extreme case of an inﬁnitely sharp distribution, one can imagine that even a single walker’s

accumulated phase angle will almost certainly match the expected value of the distribution. There-

fore the lower frequency simulations (with lower signal value) require more realizations (walkers,

trajectories) to sample the phase distribution adequately. Conversely, at a ﬁxed number of real-

izations, higher frequency simulations (with higher signal values) have better sampling and hence

better likelihood of small error.

B. Characterization of anisotropy

Incorporating a tensorial force constant (while keeping the diffusivity a scalar) leads to a char-

acterization of anisotropy alternative to the commonly employed diffusion tensor model. Here,

we shall focus on the explicit results for the Stejskal-Tanner sequence, i.e., Eqs. (8) and (9). The

12

E

1.0

0.

0.6

0.4

0.

0.0

0.0

1.4

1.

1.0

0.

)

0
1
(

E

0.6

0.4

0.

0.0

0.0

Analytic

Random Walk

MCF

0.5

1.0

1.5

.0

.5

(kH

Random Walk

MCF

0.5

1.0

1.5

.0

.5

(kH

Figure 3: (Color online) Top: The predicted NMR signal plotted against the frequency in an oscillating

gradient sequence. Bottom: Errors incurred in MCF and random walk results. The plotted values are the

absolute values of the deviations from the analytical results.

corresponding expression for the diffusion tensor model is [2, 31]

where D is the diffusion tensor.

E = exp(cid:20)−γ2δ2(cid:18)∆ −

δ

3(cid:19) G⊺DG(cid:21) ,

(18)

The diffusivity and temperature were as before while the conﬁnement tensor was taken to be

diagonal with eigenvalues chosen such that Cx = Cy corresponded to a pore size of approximately
6 µm while Cz was taken to be one-tenth of Cx so that the corresponding pore size along the z axis
was roughly 18 µm. We chose the eigenvalues of the diffusion tensor through the expression

Di =

1

Ci∆(cid:0)1 − e−Ci∆D0(cid:1) ,

13

(19)

 
which was obtained by setting the mean squared displacements, h(∆x)2i, implied by the two
models equal to each other (see Eq. (A6)). Different colors in Figure 4 represent different values

for the angle between the gradient direction and the “ﬁber,” i.e., the z-axis.

In the ﬁrst panel of Figure 4, we plot the predicted NMR signal against q2. The timing param-

eters were: ∆ = 20 ms and δ = 2 ms. As expected, the q2 dependence of the signal appears linear

for both models on a semi-logarithmic plot. The two models yield essentially the same results; the

slight deviation is due to the pulse duration.

The difference of the models becomes apparent when one considers the dependence of the

signal on the timing parameters of the sequence. To illustrate this, we depict the E vs. δ curves

in the second panel of Figure 4. In these plots, the q values were ﬁxed to 90π rad/mm and the

pulse separation was again ∆ = 20 ms. In this case, the diffusion tensor model implies a linear

appearance in the semi-logarithmic plots. However, the dependence in the conﬁnement tensor

model is more complicated with non-linearity becoming quite substantial in the most restricted

directions.

VI. DISCUSSION AND CONCLUSION

Parabolic potentials are useful in numerous physics problems when one is interested in model-

ing slight deviations away from the equilibrium state; when the perturbation is small, any potential

can be approximated by a quadratic function. In this study, however, the utility of employing a

parabolic potential model was due to a different reason. Following previous work [2, 22, 23], our

development can be regarded to yield an alternative model of restricted diffusion, which was the

main motivation of this study. Its resemblance to restricted diffusion is due to the time-dependence

of the underlying mean square displacements (hence the diffusion coefﬁcients). The mean square
displacement implied by the propagator in (A3) is h(∆x)2i = 2C −1(1−e−D0Ct), which approaches
a plateau as t → ∞ as expected in restricted geometries.

Despite this resemblance, the signal implied by the parabolic potential model has an important

difference from that for restricted diffusion models. The phases of the random walkers turn out to

be Gaussian-distributed [22]. Thus, the logarithm of the predicted signal for each isolated pore has

only a quadratic term in gradient magnitude. Consequently, features that are visible only at large

diffusion sensitivities (e.g., diffraction-like effects [7, 8]) are not accomodated by the parabolic

potential model. Although this seems like a limitation of the model, for most acquisitions in-

14

100

10

1
0

1

100

E

E

0
75
60
0

0

0
75
60

4

5

6

7

q2 ( ad mm)2

104

0

0

10

1
0

5

10

δ (ms)

15

0

Figure 4: (Color online) The predicted MR signal plotted against the pulse duration in a Stejskal-Tanner

pulse sequence. Different curves represent different values of the angle (θ) between the gradient vector and

the eigenvector of the conﬁnement tensor associated with its smallest eigenvalue.

volving microscopic pores and weak gradients, the low diffusion sensitivity behavior is the only

regime of the signal that can be measured. Under these conditions, the observed higher order

terms emerge predominantly from heterogeneities within the sample rather than true compartmen-

tal effects. Heterogeneity-induced effects would be captured by the present model as well if the

signal is represented as the superposition of signals associated with a distribution of conﬁnement

values, i.e., potentials, similar to what is done in multiple diffusion tensor [35] and diffusion tensor

distribution [36, 37] representations.

To illustrate the above points and better assess the resemblance of the Hookean model to re-

15

stricted diffusion, we consider molecules diffusing between two inﬁnite parallel plates separated

by 6 µm. For this geometry, the potential is zero within the slab and inﬁnite at the walls. Figure 5a

depicts the potential proﬁle for the slab geometry (continuous line) as well as the parabolic poten-

tial (dashed line) that could be used in lieu of it. For the latter, the conﬁnement value was obtained
through (A6) as 0.33 µm−2. In Figure 5b, we plot the signal against the quantity q2(∆ − δ/3),
which is frequently referred to as the “b-value,” and fully characterizes the signal decay for free

diffusion [38]. Here, curves in different colors represent different values of the pulse duration. For

each pulse duration, the b-value was varied by changing the gradient magnitude. Having different

signal values for the same b-value is a further manifestation of the failure of the free diffusion

model in characterizing restricted diffusion. Employing the parabolic potential however, yields a

behavior similar to that observed for restricted diffusion. We observe that the deviation between

the signal values for restricted and Hookean models becomes more pronounced as the b-value is

increased. We show the dependence of the signal on the separation of pulses in Figure 5c. To

be able to simulate shorter diffusion times, the pulse duration was ﬁxed at 1 µs. Here, different

colors represent different values of the wavenumber q. As expected, the signals for both problems

reach constant values as the pulse separation (diffusion time) is prolonged. The curves for the two

models are nearly indistinguishable at small attenuations. For stronger diffusion sensitivity, the

transition to the long diffusion-time regime occurs slightly more quickly in the case of parabolic

potential, yielding a larger eventual signal. We reiterate that the comparisons here are based on

the association in (A6), which is only one way of assigning a pore size to a particular conﬁnement

value. Many more associations could be made (e.g., based on zero displacement probabilities) that

would change the discrepancies between the curves in Figure 5 though the qualitative resemblance

afforded by the parabolic potential model would prevail.

The ﬁrst approach we employed to tackle the problem involved posing the NMR signal as

a path integral and evaluating it explicitly. As exempliﬁed by the cases of Stejskal-Tanner and

oscillating gradient sequences, this approach can be employed to obtain analytical results for the

NMR signal featuring arbitrary gradient waveforms. Formerly, the path integral method was used

to derive the expression describing the inﬂuence of free diffusion [38]. In an earlier publication,

the quadratic term of the signal decay due to restricted diffusion was calculated via an explicit

evaluation of the path integral for the simple geometries of parallel plates, cylinders, and spheres

[32]. Employing the former two geometries in perpendicular directions, the solution for a capped

cylinder geometry can be obtained [25], which had been used to model restricted diffusion in an

16

V

.5

.0

1.5

1.0

0.5

(a)

4

x

( m)

4

1.0

0.9

0.8

0.7

0.6

E

0.5

0

(b)

1.0

0.8

0.6

0.4

0.2

E

0.0

0

(c)

δ

δ

δ

δ

δ

Slab geometry
Parabolic potential

2000

4000
q2 (

8000
6000
/3)   (s / mm2)

10000

(2 )

1qLeff = 0.15

(2 )

1qLeff = 0.3

(2 )

1qLeff = 0.45

(2 )

1qLeff = 0.6

Slab geometry
Parabolic potential

2

4

6

8

10

12

14

   (ms)

Figure 5: (Color online) (a) Continuous line: Proﬁle of the dimensionless potential due to restricted dif-

fusion taking place between two parallel plates separated by 6 µm. Dashed curve: Parabolic potential that

could be employed for the same slab geometry. (b) The signal for the traditional Stejskal-Tanner sequence

plotted against the b-value for ∆ = 50 ms.

(c) The signal plotted against the pulse separation for the

Stejskal-Tanner sequence.

anisotropic pore. However, because the capped cylinder is invariant to rotations about its axis, this

model has only two size parameters—its radius and length, thus limiting its applicability. On the

17

other hand, our model has three unique conﬁnement values (Ci, where i = 1, 2, 3), each of which
can be related to an effective pore size along three spatial directions. In this respect, our model is

more general than the capped cylinder geometry for modeling anisotropy.

We note that an alternative geometry involving three size parameters is the rectangular prism.

The MR signal inﬂuenced by diffusion within a rectangular prism could be obtained by employing

the solution for parallel plates in three orthogonal directions. However, even when the three size

parameters are set equal, the resulting geometry is not truly isotropic, making it difﬁcult to isolate

the inﬂuence of structural anisotropy. This limitation, which is present also for the capped cylinder

geometry, is overcome by our method. Setting all three principal conﬁnement values equal to

each other provides the solution for a perfectly isotropic potential akin to the case of diffusion

taking place within a sphere. On the other hand, setting only two of the three eigenvalues of the

conﬁnement tensor equal to each other provides the solution for diffusion within a cylinder-like

pore.

As exempliﬁed in Figure 4, compared to the diffusion tensor model, which is based on the

assumption of free diffusion, our model has a different dependence on the timing parameters of the

gradient waveforms. This issue is likely to be important when sophisticated pulse sequences are

employed. Indeed, several different pulse sequences have been studied in recent years employing

pulsed [8, 39–41] and continuous [42–44] waveforms. Especially in the context of modeling local

diffusion anisotropy, one is faced with the choice between the Gaussian diffusion tensor model

[37, 45], and restricted capped cylinder model [25, 46]. Although, the restricted character of the

model is desirable, the capped cylinder model had two limitations, which may have prompted

some studies to adopt the diffusion tensor model instead: (i) it has only two size parameters, so

is more limited than the diffusion tensor model, (ii) the solutions are rather complicated. We

believe the conﬁnement tensor model introduced in this study overcomes both of these limitations

making it suitable to characterize global (macroscopic) as well as local (microscopic) diffusion in

heterogeneous media. For example, “diffusion imaging with conﬁnement tensor (DICT)” could

be performed by estimating the conﬁnement tensor via Eqs. (8) and (9) for each voxel of a data

set comprising multi-directional diffusion-weighted images, much like Eq. (18) is employed in

diffusion tensor imaging (DTI) studies.

Although our formulation has focused for the most part on parabolic potentials and linear gra-

dients, the MCF and random walk simulations can be generalized to more general cases. For

example, spatially nonlinear gradients can be incorporated with ease by simple manipulations of

18

the operators employed in the MCF technique [47]. Other potentials can also be incorporated

by employing exact or approximate solutions of the corresponding Helmholtz problem. Finally,

the work presented in this article may be relevant in very different contexts. For example, our

approach here could be expanded to offer some utility in modeling noise induced by Brownian

motion in magnetic resonance force microscopy [48, 49].

In conclusion, we have presented an in-depth study on the effect of diffusion taking place in

the presence of a parabolic potential on the NMR signal. The scheme enables one to incorporate

restriction-induced effects when general gradient waveforms are employed. The study lends itself

to a new formulation for diffusion anisotropy featuring three parameters like the diffusion tensor

model. However, by overcoming the limitations due to the assumption of free diffusion, the con-

ﬁnement tensor model could be considered a powerful alternative to the diffusion tensor model for

characterizing anisotropy.

Acknowledgments

We thank Dr. Chunlei Liu for his comments on the nomenclature. The authors acknowledge
funding from T ¨UB˙ITAK-EU COFUND Project 114C015, Bo˘gazic¸i University Research Fund
(grant number 8521), Bilim Akademisi BAGEP 2014 Award, NIH R01MH074794, and Swedish

Foundation for Strategic Research (No. AM13-0090).

Appendix A: Derivations within the path integral formalism

This appendix is reserved for the details of the derivation involved in arriving at the analytical

expression (4) for the average magnetization, or NMR signal. We will begin with the discretization

of the path integral (2), followed by its evaluation (and continuum limit) for a parabolic potential

in one spatial dimension, and then generalize to higher dimensions.

1. Discretization

As is usual, the path integral is evaluated via slicing the time interval 0 < t < tf into a number
n of time steps, and before the continuum limit (n → ∞) is considered, discretized versions of the
integration measure and the integrand are employed. For what follows, we deﬁne the small time

19

step τ = tf /n, and t is replaced by jτ for the discretization, with j an integer in the interval [0, n].

Also, time integralsR dt become τPj. Following the deﬁnition of the variables rj = r(jτ ) and

qj = γτ G(jτ ), the discretization amounts simply to

γZ tf

0

dt G(t) · r(t) →

qj · rj ,

n

n

Xj=0
Yj=0
P[r(t)] → ρ(r0)

Dr(t) →

drj ,

Pτ (rj−1, rj) ,

n

Yj=1

(A1a)

(A1b)

(A1c)

where ρ(r0) is the initial probability distribution of spins, and Pt(r′, r) is the probability of a
particle ending up at the later position r given that it was at the earlier position r′ a time t ago.3

As a result, the time-sliced path integral becomes

Eτ =Z dr0ρ(r0)e−iq0·r0

n

Yj=1

drjPτ (rj−1, rj)e−iqj ·rj ,

(A2)

where the subscript τ reminds us that this is not yet the exact path integral, but a discretized

approximation. Also, note how the integrals over later positions are nested inside those of the

earlier ones.

The above discussion holds for any (time-independent) potential and number of dimensions.

However, evaluating the (discretized) path integral (A2) requires an explicit form for the propaga-

tor Pτ (r′, r). We focus ﬁrst on the one dimensional case with a parabolic potential.

2. Hookean force in one dimension

The propagator Pt(x′, x) for diffusion under the effect of a dimensionless potential V (x) =

(1/2)Cx2 has the form [16, 18]

Pt(x′, x) =

With D0 being the bare diffusion constant, the inverse time Ω is deﬁned as

exp(cid:20)−

(x − stx′)2

2σ2
t

(cid:21) .

1

t

p2πσ2

Ω = D0C ,

3 We have also committed a slight abuse of notation by denoting volume integrals as dr.

20

(A3)

(A4a)

the shorthand symbols st and σt, having been used above, can be expressed as

and

st = e−Ωt ,

(A4b)

(A4c)

Note that the propagator (A3) is a normalized Gaussian in its later argument x, centered at a

σ2

t =(cid:0)1 − s2

t(cid:1) C −1 .

point that depends on its earlier argument x′. Despite its Gaussian appearance, this propagator has

an important characteristic that is consistent with restricted diffusion. To illustrate this point, we
shall consider the long time limit (t → ∞) of the propagator. In this regime, the dependence on
the initial position disappears as expected for restricted diffusion. It is instructive to also consider
the net displacements, i.e., ∆x = x−x′. Let ρ(x′) denote the equilibrium spin density. The second
moment of net displacements, deﬁned through the expression

h(∆x)2i =Z dx′ ρ(x′)Z d∆x (∆x)2 Pt(x′, x′ + ∆x)

(A5)

diverges for free diffusion as the diffusion time is prolonged. However, the same quantity for the

propagator in Eq. (A3) asymptotically approaches the constant value of 2/C. On the other hand,

if one considers a restricted diffusion process taking place between two inﬁnite plates separated

by a distance L, this quantity similarly approaches a constant value, which is L2/6. Setting the

latter two quantities equal to each other, one can obtain an effective pore size given by

Leﬀ =r12D0

Ω

=r 12

C

.

(A6)

We refer to this relationship in the Results section.

a. Evaluation of the signal

The form of the propagator (A3) helps a great deal in evaluating the signal analytically. Indeed,

the discretized path integral (A2) involves only familiar integrals, but each integration is affected

by the result of that nested immediately inside it. Consider, for instance, the inner-most integral

(over xn):

Z dxn Pτ (xn−1, xn)e−iqnxn = e− 1

2 σ2

τ q2

ne−isτ qnxn−1 .

(A7)

21

The ﬁrst factor has nothing to do with the remaining integrals in Eq. (A2). The second factor, on

the other hand, combines with the exponential in the next integral (over xn−1), shifting its “wave
number” qn−1 by an amount sτ qn. One can see that, with later (large index) wave numbers leaking
into the phase factors of earlier (smaller index) integrations as such, and getting multiplied by sτ
at each step, it should be useful to deﬁne

n

Qj =

si−j
τ qi .

(A8)

Xi=j

(The index i is not to be confused with the imaginary unit i.) Following this recursion just de-

scribed, one ﬁnds

Eτ = exp −

σ2
τ
2

n

Xj=1

Q2

j!Z dx0 ρ(x0)e−iQ0x0 .

(A9)

We assume that the distribution of spin-carriers has had enough time to reach equilibrium before

the gradient sequence is applied. Hence, the relation ρ(x0) = P∞(x−1, x0) can be employed (Eqs.
(A3) – (A4) in the limit t → ∞), with x−1 being some arbitrary pre-initial position. We can thus
perform the last remaining integration similarly to the previous ones to ﬁnd

Eτ = exp −
= exp −

n

σ2
∞
2

σ2
τ
2

Q2
j −

Xj=1
2Ω(cid:0)1 − e−2Ωτ(cid:1)

D0

Q2

0!
Xj=1

n

Q2
j −

D0
2Ω

Q2

0! .

(A10)

Continuum limit.

In the continuum limit where τ = tf/n → 0 as n → ∞, we have jτ → t
and τPj → R dt. Recalling moreover that Qj really stands for Q(jτ ), the τ → 0 limit of the

average magnetization (A10) is easily obtained as

E = exp(cid:18)−D0Z tf

0

dt Q2(t) −

D0
2Ω

Q2(0)(cid:19) .

The quantity Q(t) follows from Eq. (A8) similarly. Recalling that qj = γτ G(jτ ), and using
Eq. (A4b), the expression (A8) for Qj can be recast as

(A11)

(A12)

(A13)

In the τ → 0 limit, one ﬁnds

n

Qj = γ

Xi=j
Q(t) = γZ tf

t

τ G(iτ )e−Ωτ (i−j) .

dt′ e−Ω(t′−t)G(t′) .

Eqs. (A11) and (A13) yield the ﬁnal result for the NMR signal for the case of molecules diffusing

under the inﬂuence of a Hookean restoring force in one dimension.

22

Free diffusion. Here, we show that our expression (A11) for the signal agrees with previous

results for free diffusion NMR signal [3]

Efree = exp"−D0γ2Z tf

0

dt (cid:18)Z t

0

dt′ G(t′)(cid:19)2#

(A14)

in the limit of vanishing potential (f → 0). In this limit, Ω → 0, and thus the exponential in
Eq. (A13) drops. Along with the gradient echo condition,R tf

0 dt′ G(t′) = 0, we have

Qfree(t) = −γZ t

0

dt′ G(t′) ,

(A15)

and Q(0) = 0. Therefore, the ﬁrst term in our expression for the signal (A11) matches the free

diffusion NMR signal (A14). The second term in Eq. (A11) does not seem to disappear, due to
the Ω−1 → ∞ prefactor. However, if one recalls that this term is simply the remaining integral in
Eq. (A9), then it is recognized that the integral becomesR dx ρ(x) when Q0 = Q(0) = 0, which

is unity by deﬁnition.

3. Hookean force in three dimensions

In three dimensions, the most general harmonic potential (assuming the attraction center is at

the origin) is of the form

V =

1
2

r⊺Cr ,

(A16)

where the conﬁnement tensor C is real and can be assumed to be symmetric without loss of

generality. There exists, then, a rotation matrix R such that RR⊺ = 1, and

V =

1
2

˜r⊺ ˜C ˜r ,

(A17)

where ˜C = R⊺CR is diagonal, and ˜r = R−1r. In this basis denoted by tildes, the potential
has the coordinates ˜x, ˜y, and ˜z decoupled, and so does the Smoluchowski equation that describes
the propagator Pt( ˜r′, ˜r). Therefore, the propagator simply factorizes into three instances of the
propagator (A3) for each direction:

exp(cid:20)−

i)2
(˜ri − st,i˜r′

2σ2
t,i

(cid:21) ,

(A18)

Pt( ˜r′, ˜r) =

3

Yi=1

1

q2πσ2

t,i

23

where Eqs. (A4) become

Ωi =D0Ci ,

st,i =e−Ωit ,

(A19a)

(A19b)

(A19c)

,

σ2

i

t,i =(cid:0)1 − s2

t,i(cid:1) C −1

with Ci denoting the ith eigenvalue of C, etc.

By virtue of this factorization, one sees that the evaluation of the path integral proceeds exactly

the same way as before, only this time it is three-fold:

with

E =

3

Yi=1

exp(cid:18)−D0Z tf

0

dt ˜Q2

i (t) −

D0
2Ωi

˜Q2

i (0)(cid:19)

˜Qi(t) = γZ tf

t

dt′ e−Ωi(t′−t) ˜Gi(t′) .

(A20)

(A21)

Recall that the two equations above are valid in the rotated basis where the conﬁnement tensor C

is diagonal (hence the tildes).

In order to revert to the lab frame (the un-rotated basis), note that Ω−1

i

and e−Ωi(t′−t) are just the

ith eigenvalues of the matrices Ω−1 and e−Ω(t′−t) which are diagonalized by the same rotation R

as Ω, and hence C—see Eq. (A19a). Exploiting as well the rotation properties of R, one ﬁnds

E = exp(cid:18)−D0Z tf

0

dt|Q(t)|2 −

D0
2

Q⊺(0)Ω−1Q(0)(cid:19) ,

where

Q(t) = γZ tf

t

dt′ e−Ω(t′−t)G(t′) .

(A22)

(A23)

These are Eqs. (4) and (5) of the main text. Since one in general does not know what the principal

directions are without previous knowledge about the specimen, these general expressions are more

relevant than the diagonalized versions (A20) and (A21). However, note that in evaluating the

integral in Eq. (5) with a given gradient waveform G(t), one may have to make sense of the

exponentiated matrix in the integrand by going back and forth between the lab frame and the

eigen-basis.

24

Appendix B: MCF formalism

This appendix is reserved for the technicalities of the MCF calculations of Section III.

It is illuminating to consider the BTS equation (14) as the projection of an operator equation
for the vector |m(t)i onto the (dual) vector hr|. If one deﬁnes the operators Λ and Γ(t) such that
(B1)

hr| Λ|m(t)i = D0∇ ·(cid:0)e−V (r)∇eV (r)m(r, t)(cid:1) ,
hr| Γ(t) |m(t)i = −iγG(t) · r m(r, t) ,

Eq. (14) may be rewriten, without the projection onto spatial coordinates, as

∂
∂t |m(t)i = [Λ + Γ(t)]|m(t)i .

We will refer to the operator Λ deﬁned in Eq. (B1) as the Smoluchowski operator.

In the MCF framework, the total time interval is sliced into smaller successive intervals tj−1 <
t < tj with j = 1, 2, . . . , n. Within each of these intervals, the gradient waveform G(t), hence the
operator Γ(t), is considered to be constant. If the operator Γ(t) has the constant value Γj in the
interval tj−1 < t < tj, that is,

then Eq. (B3) implies that

Γ(t) =Γj

(tj−1 < t < tj) ,

|m(tj)i = e(Λ+Γj )∆tj |m(tj−1)i ,

where ∆tj is the duration of the jth time interval. Thus, when all n intervals have elapsed,

(B2)

(B3)

(B4)

(B5)

(B6)

|m(tn)i =

e(Λ+Γj )∆tj |m(0)i ,

n

Y′

j=1

where the prime on the product symbol is to remind us that subsequent propagators multiply from

the left. Finally, the signal becomes

E(t) =Z dr hr|

n

Y′

j=1

e(Λ+Γj)∆tj |m(0)i .

(B7)

This is the essence of the MCF formalism. What remains are details of implementation and

evaluation, which vary according to the speciﬁcations of the problem at hand. The expression

derived above becomes increasingly accurate for an arbitrary gradient waveform G(t) with ﬁner

time-slicing. Or, it may be considered exact if the gradient waveform is as a matter of fact constant

over ﬁnite time intervals.

25

1. Eigenfunction expansion

The ﬁrst step toward the evaluation of Eq. (B7) is to make the expression concrete by choosing a

basis to project the operators and vectors onto. The two most obvious choices are the eigenvectors

of the operators Λ and Γ(t). The eigenvectors of Γ(t), according to Eq. (B2), are the same set
{|ri} of vectors as the eigenvectors of the position operator. Using this basis will result in a path
integral type implementation [33].

Alternatively, one projects onto the eigenvectors of the Smoluchowski operator Λ, but there is

a catch: the operator Λ is not self-adjoint, thus a spectral decomposition may not be available.

However, it is similar to a self-adjoint operator in the sense that the operator H = eV /2Λe−V /2
satisﬁes H † = H.4 This allows Λ to have a real spectrum and a complete set of bi-orthogonal

eigenvectors, as we will brieﬂy discuss below.

If the self-adjoint operator H has a set of real eigenvalues λk and corresponding eigenvectors

|˜uki satisfying

H |˜uki = λk |˜uki ,

(B8)

it can be veriﬁed via straightforward algebraic manipulations that the vector |uki = e−V /2 |˜uki
satisﬁes

i.e., |uki is an eigenvector of Λ with eigenvalue λk. Similarly, the vector

Λ|uki = λk |uki ,

satisﬁes the eigenvalue equation

|wki = eV |uki ,

hwk| Λ = λk hwk| .

(B9)

(B10)

(B11)

It is these left and right eigenvectors, taken in pairs, which satisfy relations of orthonormality

hwk|uli = δkl

(B12)

4 Here, V is the potential operator, such that hr| V = V (r)hr|.
If one considers the self-adjoint wave vector
(or momentum) operator K such that hr| K = −i∇hr|, the operator Λ given in Eq. (B1) can be written as
Λ = −D0K · e−V KeV . One can verify directly that H = eV /2Λe−V /2 = −D0eV /2K · e−V KeV /2 satisﬁes
H † = H.

26

and completeness

1 =Xk

|ukihwk| ,

(B13)

as a result of the orthonormality and completeness of the eigenvectors |˜uki of the self-adjoint
operator H.

Now, we can use the completeness relation (B13) to rewrite the NMR signal (B7) as

E =Xk,ℓ Z dr hr|uki hwk|

a. The equilibrium state

n

Y′

j=1

e(Λ+Γj )∆tj |uℓihwℓ|m(0)i .

(B14)

When no perturbation via the gradient G(t) is applied, the BTS equation (14) must lead to
the equilibrium magnetization density ∼ e−V (r) in the t → ∞ limit. Such stability of solutions
requires the eigenvalues λk to be bounded from above: λk ≤ 0. The eigenfunction corresponding
to the maximal eigenvalue λ0 = 0, therefore, is (proportional to) the equilibrium (t → ∞) solution,
(B15)

u0(r) = Z −1/2e−V (r) ,

with Z being a normalization factor given as

Also note that, according to Eq. (B10), we have

Z =Z dr e−V (r) .

w0(r) = Z −1/2 ,

(B16)

(B17)

for the dual eigenfunction corresponding to the equilibrium eigenvalue λ0 = 0.

We can exploit the properties mentioned above of the equilibrium eigenfunctions to simplify
Eq. (B14). First, if the initial magnetization density is at equilibrium, then |m(0)i = Z −1/2 |u0i,
meaning hwℓ|m(0)i = Z −1/2δℓ0. Second, we can (ab)use Eq. (B17) to the effect,

Z dr hr|uki = Z 1/2Z dr hw0|rihr|uki = Z 1/2δ0k .

These two manipulations eliminate both summations, and the integral in Eq. (B14), to yield

E = hw0|

n

Y′

j=1

e(Λ+Γj)∆tj |u0i .

27

(B18)

(B19)

b. Matrix elements

The above analysis shows that the signal can be written as the top matrix element of the prop-

agator, expressed in the eigenbasis (and the dual basis) of the Smoluchowski operator. While it

may be possible to evaluate this matrix element analytically, it is usually necessary to resort to

numerical computations, both to compute the product, and also the exponentials. To this end, one

uses the matrix elements

and, using Eq. (B2),

Λkℓ = hwk| Λ|uℓi = λℓδkℓ

(no sum implied) ,

Γkℓ(t) = hwk| Γ(t) |uℓi = −iγG(t) · hwk| R |uℓi ,

(B20)

(B21)

where the latter matrix element of the position operator may be computed, for instance, through

hwk| R |uℓi =Z dr w∗

k(r)ruℓ(r) .

(B22)

This is most of what we can say without specifying the potential V (r) and the number of

dimensions.

2. The case of parabolic potential

a. MCF for the one-dimensional problem

Now, we will restrict to one spatial dimension, and the dimensionless potential V (x) =

(1/2)Cx2. In this case, the BTS equation reads

∂m
∂t

= D0

∂2m
∂x2 + CD0

∂(x m)

∂x − iγG(t)x m .

The eigenvalues and eigenfunctions of the Smoluchowski operator Λ can be found from

to be

D0

d2uk
dx2 + CD0

d(x uk)

dx

= λkuk ,

λk = −kCD0

(k = 0, 1, 2, . . .) ,

28

(B23)

(B24)

(B25)

and

2π(cid:19)
uk(x) =(cid:18) C

1

4 e−Cx2/2
√2kk!

Hk r C

2

x! ,

(B26)

where Hk(z) is a Hermite polynomial. Recall, also, from Eq. (B10) that wk(x) = eV (x)uk(x) =
eCx2/2uk(x).

Immediately, one can evaluate the matrix element (B21) as

Γkℓ(t) = −iγG(t)Z dx wk(x)xuℓ(x)
(cid:1)!(cid:0) 1+k−ℓ

−iγG(t)2
(cid:1)!(cid:0) ℓ+1−k

√C(cid:0) k+ℓ−1

=

k−ℓ

2 k!

(cid:1)!

2

2

2

,

(B27)

for |k − ℓ| = 1 (Γkℓ = 0 otherwise) [50]. The matrix element (B20), on the other hand, is simply
(B28)

(no sum implied) .

Λkℓ = −kCD0δkℓ

One can then employ, for a given gradient waveform G(t), a computer to use these matrix elements

for Λ + Γ(t) the computation of the exponentials and the product in the expression (B19) for the

NMR signal.

b. MCF for the three-dimensional problem

In the case of a three dimensional anisotropic potential, written as V (r) = (1/2)riCijrj in

index notation, the BTS equation becomes

∂m
∂t

= D0∂i∂im + CijD0∂i(rj m) − iγGi(t)ri m .

(B29)

Observing the middle term on the right hand side, one sees that performing a rotation to diago-

nalize the tensor C will decouple the equations over each rotated coordinate (˜r = R−1r as in

Sec. A 3). The eigenfunctions hence factorize,

uk( ˜r) =

uki(˜ri) ,

3

Yi=1

with uki(˜ri) as given in Eq. (B26), while the eigenvalues of the entire equation become

λk = −D0Ciki ,

29

(B30)

(B31)

where Ci are the eigenvalues of the conﬁnement tensor (note the vector index k = (k1, k2, k3) and
the sum implied over i). The matrix Λkℓ is just made up of the eigenvalues above.

The NMR signal (B19) is computed using extensions of Eqs. (B20), (B21), and (B22), into

three dimensions with rotated coordinates. Noting that G · r = G⊺RR−1r = ˜G · ˜r, we have

Λkℓ =λℓδkℓ

(no sum implied) ,

Γkℓ = − iγ ˜G(t) ·Z d˜r w∗

k( ˜r) ˜ruℓ( ˜r) ,

(B32)

(B33)

where Eqs. (B31) and (B30) will be used.

The orientation of the potential (hence the rotation matrix R) is not known prior to the mea-

surement of the specimen. Therefore these results are not as general as those of Sec. A 3. The

derivation of such general expressions seems intractable to us. However, this does not render the

above formulas useless. The “natural” frame of reference, hence the matrix R, established by

the orientation of the specimen can be estimated from the data set, e.g., via employing the diffu-

sion tensor model. The gradient waveform can be transformed into this natural reference frame in

which C is diagonal, and the above formulation can be used subsequently [51].

[1] E. O. Stejskal and J. E. Tanner, J Chem Phys 42, 288 (1965).

[2] E. O. Stejskal, J Chem Phys 43, 3597 (1965).

[3] R. F. Karlicek and I. J. Lowe, J Magn Reson 37, 75 (1980).

[4] L. L. Latour, K. Svoboda, P. P. Mitra, and C. H. Sotak, Proc Natl Acad Sci 91, 1229 (1994).

[5] P. N. Sen, Concept Magn Reson A 23A, 1 (2004).
[6] E. ¨Ozarslan, P. J. Basser, T. M. Shepherd, P. E. Thelwall, B. C. Vemuri, and S. J. Blackband, J Magn

Reson 183, 315 (2006), URL http://dx.doi.org/10.1016/j.jmr.2006.08.009.

[7] P. T. Callaghan, A. Coy, D. MacGowan, K. J. Packer, and F. O. Zelaya, Nature 351, 467 (1991).

[8] E.

¨Ozarslan

and

P.

J.

Basser,

J Magn

Reson

188,

285

(2007),

URL

http://dx.doi.org/10.1016/j.jmr.2007.08.002.

[9] A. Bodrova, A. V. Chechkin, A. G. Cherstvy, and R. Metzler, Phys Chem Chem Phys 17, 21791

(2015).

[10] A. S. Bodrova, A. V. Chechkin, A. G. Cherstvy, and R. Metzler, New J Phys 17, 063038 (2015).

[11] A. G. Cherstvy and R. Metzler, J Stat Mech–Theory E 2015, P05010 (2015).

30

[12] D. S. Novikov, E. Fieremans, J. H. Jensen, and J. A. Helpern, Nat Phys 7, 508 (2011).

[13] D. S. Novikov, J. H. Jensen, J. A. Helpern, and E. Fieremans, P Natl Acad Sci USA 111, 5088 (2014).

[14] E. Sykov´a and C. Nicholson, Physiol Rev 88, 1277 (2008).

[15] Y. Fan and J.-H. Gao, Phys Rev E 92, 012707 (2015).

[16] M. Smoluchowski, Bull Int Acad Sci Cracovie, Cl Sci Math Natur ser A, 418 (1913).

[17] M. Smoluchowski, Ann Phys 353, 1103 (1916).

[18] G. E. Uhlenbeck and L. S. Ornstein, Phys Rev 36, 823 (1930).

[19] J. E. Tanner and E. O. Stejskal, J Chem Phys 49, 1768 (1968).

[20] P. T. Callaghan and D. N. Pinder, Macromolecules 13, 1085 (1980).

[21] P. T. Callaghan, Aust J Phys 37, 359 (1984).

[22] P. Le Doussal and P. N. Sen, Phys Rev B 46, 3465 (1992).

[23] P. P. Mitra and B. I. Halperin, J Magn Reson A 113, 94 (1995).

[24] P. J. Basser, J. Mattiello, and D. LeBihan, Biophys J 66, 259 (1994).
[25] E. ¨Ozarslan, J Magn Reson 199, 56 (2009), URL http://dx.doi.org/10.1016/j.jmr.2009.04.002.

[26] B. Robertson, Phys Rev 151, 273 (1966).

[27] A. V. Barzykin, Phys Rev B 58, 14171 (1998).

[28] D. S. Grebenkov, Rev Mod Phys 79, 1077 (2007).
¨Ozarslan, N. Shemesh, and P. J. Basser,

[29] E.

http://dx.doi.org/10.1063/1.3082078.

[30] J. Stepiˇsnik, Physica B & C 104, 350 (1981).

J Chem Phys 130, 104702 (2009), URL

[31] P. J. Basser, J. Mattiello, and D. LeBihan, J Magn Reson B 103, 247 (1994).

[32] E.

¨Ozarslan

and

P.

J. Basser,

J Chem Phys

128,

154511

(2008),

URL

http://dx.doi.org/10.1063/1.2905765.

[33] C. Yolcu and E. ¨Ozarslan, in Visualization and Processing of Higher Order Descriptors for Multi-

Valued Data, edited by I. Hotz and T. Schultz (Springer-Verlag, 2015), pp. 3–19.

[34] H. C. Torrey, Phys Rev 104, 563 (1956).

[35] B. A. Inglis, E. L. Bossart, D. L. Buckley, E. D. Wirth, and T. H. Mareci, Magn Reson Med 45, 580

(2001).

[36] B. Jian, B. C. Vemuri, E. ¨Ozarslan, P. R. Carney, and T. H. Mareci, NeuroImage 37, 164 (2007), URL

http://dx.doi.org/10.1016/j.neuroimage.2007.03.074.

[37] C.-F. Westin, H. Knutsson, O. Pasternak, F. Szczepankiewicz, E. ¨Ozarslan, D. van Westen, C. Mattis-

31

son, M. Bogren, L. O’Donnell, M. Kubicki, et al., NeuroImage (in press).

[38] E. ¨Ozarslan, C.-F. Westin, and T. H. Mareci, Concepts Magn Reson Part A 44, 203 (2015).

[39] D. G. Cory, A. N. Garroway, and J. B. Miller, Polym Preprints 31, 149 (1990).

[40] P. P. Mitra, Phys Rev B 51, 15074 (1995).
[41] J. L. Paulsen, E. ¨Ozarslan, M. E. Komlosh, P. J. Basser, and Y.-Q. Song, NMR Biomed (in press).

[42] S. Eriksson, S. Lasiˇc, and D. Topgaard, J Magn Reson 226, 13 (2013).
[43] C.-F. Westin, F. Szczepankiewicz, O. Pasternak, E. ¨Ozarslan, D. Topgaard, H. Knutsson, and M. Nils-

son, Med Image Comput Comput Assist Interv 17, 209 (2014).

[44] E. ¨Ozarslan, A. V. Avram, P. J. Basser, and C.-F. Westin, in Proc Intl Soc Mag Reson Med (2014),

vol. 22, p. 796.

[45] S. Lasiˇc, F. Szczepankiewicz, S. Eriksson, M. Nilsson, and D. Topgaard, Frontiers in Physics 2, 11

(2014).

[46] D. Benjamini and P. J. Basser, J Chem Phys 141, 214202 (2014).

[47] F. B. Laun, J Chem Phys 137, 044704 (2012).

[48] J. A. Sidles, Appl Phys Lett 58, 2854 (1991).

[49] Sidles and Rugar, Phys Rev Lett 70, 3506 (1993).

[50] I. S. Gradshteyn and I. M. Ryzhik, Table of Integrals, Series, and Products (Academic Press, London,

2000), 6th ed.
¨Ozarslan,

[51] E.

C. G. Koay,

T. M.

Shepherd, M.

E. Komlosh, M. O.

˙Irfano˘glu,

C.

Pierpaoli,

and

P.

J. Basser, NeuroImage

78,

16

(2013), URL

http://dx.doi.org/10.1016/j.neuroimage.2013.04.016.

32

