6
1
0
2

 
r
a

 

M
4
1

 
 
]

.

O
C
h
p
-
o
r
t
s
a
[
 
 

1
v
5
0
4
4
0

.

3
0
6
1
:
v
i
X
r
a

Fast Large Scale Structure Perturbation Theory using 1D FFTs

Marcel Schmittfull,1 Zvonimir Vlah,2, 3 and Patrick McDonald4

1Berkeley Center for Cosmological Physics, Department of Physics and Lawrence Berkeley National Laboratory,

2Stanford Institute for Theoretical Physics and Department of Physics, Stanford University, Stanford, CA 94306, USA

University of California, Berkeley, CA 94720, USA

3Kavli Institute for Particle Astrophysics and Cosmology,

SLAC and Stanford University, Menlo Park, CA 94025, USA

4Lawrence Berkeley National Laboratory, One Cyclotron Road, Berkeley, CA 94720, USA

(Dated: March 15, 2016)

The usual ﬂuid equations describing the large-scale evolution of mass density in the universe can
be written as local in the density, velocity divergence, and velocity potential ﬁelds. As a result,
the perturbative expansion in small density ﬂuctuations, usually written in terms of convolutions in
Fourier space, can be written as a series of products of these ﬁelds evaluated at the same location in
conﬁguration space. Based on this, we establish a new method to numerically evaluate the 1-loop
power spectrum (i.e., Fourier transform of the 2-point correlation function) with one-dimensional
Fast Fourier Transforms. This is exact and a few orders of magnitude faster than previously used
numerical approaches. Numerical results of the new method are in excellent agreement with the
standard quadrature integration method. This fast model evaluation can in principle be extended
to higher loop order where existing codes become painfully slow. Our approach follows by writing
higher order corrections to the 2-point correlation function as, e.g., the correlation between two
second-order ﬁelds or the correlation between a linear and a third-order ﬁeld. These are then
decomposed into products of correlations of linear ﬁelds and derivatives of linear ﬁelds. The method
can also be viewed as evaluating three-dimensional Fourier space convolutions using products in
conﬁguration space, which may also be useful in other contexts where similar integrals appear.

I.

INTRODUCTION

Observations of the large-scale structure (LSS) of the universe play an important role in cosmology. In the near
future, a plethora of LSS surveys including e.g. DES [1], eBOSS [2], DESI [3], Euclid [4], WFIRST [5], LSST [6],
and possibly SPHEREx [7] are planning to improve our understanding of the nature of dark energy, the origin of
the universe, and neutrino properties. Their science return strongly depends on the precision of models for summary
statistics of the LSS, especially in the nonlinear regime where many modes are observed but modeling is rather
challenging. Commonly used perturbative models such as Eulerian standard perturbation theory (SPT) (e.g. [8–12])
or Lagrangian perturbation theory (LPT) (e.g. [13–15]) fail to describe summary statistics on nonlinear scales if they
are truncated at the lowest perturbative order; see e.g. [16] for a review and [17] for simulation comparison. The
range of validity of these models extends signiﬁcantly into the mildly nonlinear regime when including higher-order
corrections. Modern cosmological LSS analyses often include such corrections to include smaller scales in the analysis
and thus improve cosmological constraints.

The modeling improvement from higher order corrections comes however at the price of higher numerical complexity
and computational cost. Since LSS perturbation theory is used on a daily basis by a large community of researchers
working on LSS, it is useful to simplify and speed up the numerical evaluation of these model corrections. In addition
to the practical value of simplifying and speeding up higher order corrections, the expressions we derive also have a
useful physical interpretation. For example, power spectrum corrections at fourth order in the linear density involve
products of 2-point correlation functions of linear ﬁelds and derivatives of linear ﬁelds. Due to statistical isotropy,
these 2-point correlation functions depend only on the separation length between the two ﬁelds, and not on the
orientation of the separation vector. They can be interpreted as the coeﬃcients that arise when decomposing the
2-point correlation function between ﬁeld derivatives into irreducible components of the separation vector.

This approach is also useful to simplify 2-loop or higher-order loop corrections to the power spectrum, where Fourier
space integrals naively become rather high dimensional and numerical evaluation can take several hours just for a
single cosmology. For 3-point statistics, the loop integrals have to be performed for a large number of wavevector or
separation triplets, again leading to high computational cost; and the problem only becomes worse for higher-order
N -point functions that may be needed e.g. for covariances.

Adding to the motivation above, a concrete example where simpler and faster higher-order LSS models are beneﬁcial
is the exploration of cosmological parameter space with sampling methods such as Markov Monte Carlo (MCMC)
chains to interpret LSS observations. In practice, data analyses may go through various iterations of updated catalogs,
data splits, ﬁtting procedures, prior or likelihood choices, and model extensions beyond the standard ΛCDM model.
The human and computer time required for these steps can be reduced if the total time needed for MCMC chains

is reduced by faster model evaluations.
In the CMB community, examples for similar modeling speedups include
CMBFAST [18] and CAMB [19], or approximate methods like Pico [20]. These tools have been crucial for cosmology
from CMB observations in the past decade.

2

Motivated by these points, the main goal of this paper is to provide a fast algorithm to evaluate nonlinear loop
corrections for models of the LSS of the universe. The main idea of our approach can be illustrated for the 1-loop
power spectrum correction in SPT arising from correlations of two second-order densities. This 1-loop integral has
contributions of the form

(cid:90) d3q
(2π)3 f (q)g(|k − q|)Plin(q)Plin(|k − q|),

P22(k) ∼

(1)

where Plin is the linear power spectrum and f and g are general functions whose exact form is not important.1 The
integral in Eq. (1) is a three-dimensional convolution in Fourier space.
It can be evaluated eﬃciently by Fourier
transforming f Plin and gPlin to conﬁguration space, multiplying them there, and Fourier transforming the result
back to k space. Due to isotropy of the problem, the angular parts of the three-dimensional Fourier transforms are
independent of Plin and can be performed analytically independent of cosmology. We are then only left with the radial
parts of three-dimensional Fourier transforms, which reduce to one-dimensional Hankel transforms:

(cid:21)(cid:20)(cid:90) ∞

(cid:21)

(cid:90) ∞

P22(k) ∼

(cid:20)(cid:90) ∞

dr r2j0(kr)

dq q2 j0(qr)f (q)Plin(q)

dp p2 j0(pr)g(p)Plin(p)

.

(2)

0

0

0

Each of the two square brackets is a one-dimensional Hankel transform of a ﬁltered linear power spectrum, whose
result are two functions of r. The integral of their product over r is then again a one-dimensional Hankel transform.
Each one-dimensional Hankel transform can be evaluated eﬃciently with a one-dimensional Fast Fourier Transform
(FFT) by using FFTLog [21] or similar numerical packages. The algorithm to evaluate the part of P22(k) outlined
above thus scales as O(3N log N ), where N is the number of grid points where Plin is evaluated. These ∼ 3N log N
operations return the integral evaluated at all k bins at once. This should be contrasted with the standard procedure
to evaluate this type of integral, where a two-dimensional integral over radius and angle is needed for every k bin,
which scales naively like O(N 3). Although tuning the evaluation points can somewhat improve this, we generally
expect the one-dimensional FFT algorithm to be at least a few hundred times faster. Since no approximations go
into Eq. (2), the algorithm is also exact. We show in the rest of the paper how this approach can be applied to all
nonlinear power spectrum corrections that arise at fourth order in the linear density in SPT. The eﬃcient performance
of FFTLog has also recently been used in similar contexts, where the mapping of Lagrangian displacement cumulants
to the matter power spectrum was also expressed as an expansion in Hankel transforms [22, 23].

As discussed in Appendix A, the possibility of this form of evaluation is not an accident, but a consequence of the
fact that the underlying evolution equations for the ﬁelds take the form of local products, which can be evaluated by
trivial multiplication in conﬁguration space, combined with simple derivative operators that can be applied eﬃciently
in Fourier space. The complex-looking wave-vector integrals over kernels in the standard PT formulation are nothing
more than the Fourier space representation of these local ﬁeld products and derivatives. There is a ﬁnite number
of such integrals that need to be evaluated because the evolution equations only involve a small set of derivative
operators acting on the ﬁelds.

The paper is organized as follows. We start with a brief introduction to Eulerian Standard Perturbation Theory
(SPT). Section III shows how to evaluate correlations between two second-order densities in a fast way, describing
one example term in detail, followed by a more general treatment of the P22 correction in SPT. Section IV shows
similar results for the P13 correlation between linear and third-order densities. Numerical results are presented in
Section V. We conclude in Section VI. Appendices provide evolution equations for the dark matter ﬂuid motivating our
conﬁguration space approach, fast expressions for some displacement statistics appearing in Lagrangian perturbation
theory, and useful mathematical identities.

Conventions and notation

Throughout the paper, x and x(cid:48) denote conﬁguration space positions, and r denotes conﬁguration space separations.

The variables k, q and p are used for Fourier space wavevectors. We use Fourier conventions

f (k) =

d3r eik·r f (r),

f (r) =

e−ik·r f (k)

(3)

1 The exact form of f and g is determined by the equations of motion for the dark matter ﬂuid. The full P22 integrand has additional

angular dependence that we omit here for simplicity; see Section III for the full expression.

k

(cid:90)

(cid:90)

with the shorthand notation

(cid:90)

k

(cid:90) d3k

(2π)3 .

≡

3

(4)

Derivative operators act only on the single variable to their immediate right. Vectors with hats are unit vectors,
e.g. ˆk = k/k.

II. EULERIAN STANDARD PERTURBATION THEORY (SPT)

In Eulerian Standard Perturbation Theory (SPT), the nonlinear dark matter overdensity is expanded as

where δ(1) = δ0 is the linear density and δ(n) = O(δn
contributions:

0 ). The second order part has nonlinear growth, shift and tidal

n=1

δ(x) =

δ(n)(x),

(5)

∞(cid:88)

The shift term contains the linear displacement ﬁeld

and the tidal term is given by

s2(x) =

3
2

δ(2)(x) =

17
21

0(x) + Ψ(x) · ∇δ0(x) +
δ2

4
21

s2(x).

Ψ(x) =

∇
∇2 δ0(x),

(cid:18)∇i∇j∇2 − 1

3

(cid:19)

δ(K)
ij

δ0(x)

(cid:18)∇i∇j∇2 − 1

3

(cid:19)

δ(K)
ij

δ0(x).

(6)

(7)

(8)

(11)

(12)

The conﬁguration space products in Eq. (6) are commonly written as Fourier space convolutions involving the F2
kernel,2 but it is simpler for now to continue in conﬁguration space.

The nonlinear 2-point correlation function up to fourth order in the linear density is

(cid:104)δ(x)δ(x + r)(cid:105) = (cid:104)δ0(x)δ0(x + r)(cid:105) + (cid:104)δ(2)(x)δ(2)(x + r)(cid:105) + 2(cid:104)δ(1)(x)δ(3)(x + r)(cid:105) + O(δ6
0),

where we assumed Gaussian linear density δ0. We write this as

ξ(r) = ξlin(r) + ξ(22)(r) + ξ(13)(r) + O(δ6
0).

(9)

(10)

ξlin is the tree-level correlation function arising from the correlation between two linear densities separated by r.
ξ(22) is the 1-loop correction arising from the correlation between two second order densities, and ξ(13) is the 1-loop
correction from the correlation between linear and third order density.

III. FAST EVALUATION OF 2-2 TERMS

A. An example

Before computing fast expressions for the full 2-2 correlation function and power spectrum, we consider a simple

example term to illustrate the general idea of our approach:3

(cid:10)Ψ(x) · ∇δ0(x) δ0(x + r)δ0(x + r)(cid:11) + ···
(cid:10)Ψ(x)δ0(x + r)(cid:11) · (cid:10)∇δ0(x)δ0(x + r)(cid:11) + ··· .

ξ(22)(r) =

=

17
21
34
21

δ(k) = δ0(k)+(cid:82)

2 In our conventions, Ψ(k) = ik

q F2(q, k−q)δ0(q)δ0(k−q)+O(δ3

k2 δ0(k), [∇δ](k) = −ikδ(k) and s2(x) = 3
0 ), where F2(q, k−q) = 17

2 sij (x)sij (x) with sij (k) = [kikj /k2 − δ(K)
21 + 1

2 (µ2− 1

ij /3]δ0(k). Then
3 ) with µ ≡ ˆq·((cid:92)k − q).

µ+ 4
21

|k−q|

3

q

(cid:16) q|k−q| +

2

(cid:17)

3 Related calculations in the literature, e.g. [24, 25], will be discussed in Section III E.

This contribution involves the correlation between linear displacement and linear density, and the correlation between
linear density gradient and linear density. We compute these correlation functions in a way that is particularly suited
for numerical evaluation by Fourier transforming the linear ﬁelds:

(cid:10)Ψ(x)δ0(x + r)(cid:11) =

(cid:90)
(cid:90)

(cid:28) ip

p2 δ0(p)δ0(q)

(cid:29)

p,q

e−ip·x−iq·(x+r)
e−iq·r −iq
(cid:90)

q2 Plin(q)

=

q

e−iq·r q−1 ˆq · ˆr Plin(q)

q

= −ˆr i
= −ˆr ξ1−1(r).
(cid:90)
(cid:90) ∞
n(r) ≡ il
ξl

q

e−iq·r qn Pl(ˆq · ˆr) Plin(q)

=

0

dq
2π2 q2+n jl(qr) Plin(q).

Eq. (14) follows by writing Eq. (13) in terms of irreducible components of ˆr, similarly to calculations in [22].
Eq. (15) we deﬁned the generalized linear correlation function4

4

(13)

(14)

(15)

In

(17)

(18)

(19)

(20)

(21)

(22)

The angular integration follows from Eq. (C7). Pl is the lth-order Legendre polynomial and jl is the spherical
Bessel function. Crucially, Eq. (18) is a 1D Hankel transform of the linear power spectrum. This can be evaluated
numerically with a 1D Fast Fourier Transform (FFT) using FFTLog [21]. Similarly, the other correlation function
entering Eq. (12) becomes

(cid:104)∇δ0(x) δ0(x + r)(cid:105) = ˆr ξ1

1(r).

Then, the 2-2 correlation written out in Eq. (12) becomes
ξ(22)(r) = − 34
21

ξ1−1(r)ξ1

1(r) + ··· .

The corresponding power spectrum contribution is

(cid:90)

(cid:90) ∞

P22(k) =

d3r eik·r ξ(22)(r)

= 4π

dr r2 j0(kr) ξ(22)(r).

This is again a 1D Hankel transform that can be evaluated as a 1D FFT with FFTLog. The particular contribution
to P22(k) from Eq. (12) can thus be computed at all desired output values k with only three 1D FFTs. This is orders
of magnitude faster than conventional integration methods for P22, which perform 2D integrals for every value of k.

0

B. Full 2-2 correlation function and power spectrum in SPT

The example calculation above only considered a single contribution to the 2-2 correlation function. Other con-
tributions arise from all possible correlations between growth, shift and tidal term in Eq. (6). To calculate these
correlations, we only need to consider correlations between derivatives of the linear density and the linear density of
the form

(cid:28)(cid:20)
∇n∇i1 ···∇iL

∇L

(cid:21)

(cid:29)

δ0(x)

δ0(x + r)

.

(23)

4 This is deﬁned for arbitrary integer n and non-negative integer l. Note ξ0

0 (r) = ξlin(r), and see Section III C for interpretation. The

inverse relation of Eq. (18) is

knPlin(k) = 4π

(cid:90) ∞

0

dr r2jl(kr)ξl

n(r).

(16)

5

This is suﬃciently general because derivative operators can be moved from one δ0 to the other without changing the
resulting expectation value (up to a sign).5 We assume that n − L is even, so that ∇n−L = (∇2)(n−L)/2 corresponds
to the Laplace operator raised to some power. Generalizing Eq. (14), the contraction of the correlation function (23)
with ˆri1 ··· ˆriL is given by a sum over general correlation functions ξl

(cid:28)(cid:20)
∇n∇i1 ···∇iL

∇L

(cid:88)

i1···iL

(cid:21)

(cid:29)

n’s:

ˆri1 ··· ˆriL = − L(cid:88)

l=0

δ0(x)

δ0(x + r)

(2l + 1) αLl ξl

n(r).

(24)

The correlation between the derivative ﬁeld ∇n ˆ∇Lδ0 and the linear density δ0 thus generates ξl
coeﬃcients arise when changing bases to Legendre polynomials; see Eq. (32) below.

n’s with l ≤ L. The α

Applying Eq. (24) to all 2-2 correlations gives the following simple expression for the full 2-2 correlation function

in Eulerian SPT:

ξ(22)(r) =

1219
735
− 16
35

[ξ0

0(r)]2 +

1
3

ξ0−2(r)ξ0

2(r) − 124
35

ξ1−1(r)ξ1

1(r) +

1342
1029

[ξ2

0(r)]2 +

2
3

ξ2−2(r)ξ2

2(r)

ξ3−1(r)ξ3

1(r) +

64
1715

[ξ4

0(r)]2.

(25)

Using Eqs. (22) and (25), the calculation of P22 is thus reduced to computing twelve 1D Hankel transforms, which
can be evaluated eﬃciently and robustly in terms of 1D FFTs with FFTLog [21]. The computational cost to compute
P22(k) at all wavenumbers k then scales as O(12 N log N ) if the linear power spectrum is sampled at N points. This
should be signiﬁcantly faster than the standard procedure that calculates P22(k) with a 2D integral for every k, naively
using O(N 3) operations. Although there may be substantial diﬀerences in prefactors in either direction, we naively
expect a speedup factor of O(1000) for N = 100 evaluation points.

C.

Interpretation of generalized correlation functions ξl
n

The ξl

n correlation functions deﬁned in Eq. (18) can be interpreted by noting that they satisfy

n(r) = (−i)l+n(−1)L (cid:88)

ξl

T (l)
i1···iL

(ˆr)

i1···iL

(cid:28)(cid:20)
∇n∇i1 ···∇iL

∇L

(cid:21)

δ0(x)

δ0(x + r)

(cid:29)

where T (l)
normalized so that

i1···iL

(ˆr) are irreducible tensors deﬁned by T (1)

(ˆr) = ˆri, T (0)

ij (ˆr) = δij, T (2)

ij (ˆr) = 3
2

i

(cid:88)

i1···iL

ˆqi1 ··· ˆqiL T (l)

i1···iL

(ˆr) = Pl(ˆq · ˆr).

,

(cid:16)

ˆriˆrj − δij

3

(cid:17)

(26)

etc., and

(27)

Eq. (26) then follows by writing the correlation function (23) in Fourier space and contracting it with these irreducible
tensors. The inverse relation of Eq. (26) for suitably normalized tensors ˜T (ˆr) ∝ T (ˆr) is

(cid:28)(cid:20)
∇n∇i1 ···∇iL

∇L

(cid:21)

(cid:29)

L(cid:88)

l=0

δ0(x)

δ0(x + r)

=

n(r) ˜T (l)
ξl

i1···iL

(ˆr).

(28)

This follows by contracting both sides with T (ˆr), and generalizes Eqs. (15) and (19).

Eq. (28) shows that the linear correlation functions ξl

n(r) can be interpreted as the expansion coeﬃcients that
appear when decomposing the 2-point correlation function between derivatives of the linear density into irreducible
components of the separation vector r. Due to statistical isotropy, these coeﬃcients ξl
n(r) only depend on the
separation length r but not on the orientation of the separation.

5 For example, (cid:104)Ψ(x)∇δ0(x + r)(cid:105) = −(cid:104)[∇Ψ(x)]δ0(x + r)(cid:105). This follows by rewriting the expectation value in Fourier space, or from
integration by parts when replacing the ensemble average by an average over positions x.

D. Alternative Fourier space derivation of fast P22

6

In the last section we derived the fast expression (25) for the 2-2 correlation function in SPT by working mostly
in conﬁguration space. In this section we present an alternative derivation of the same result by working entirely in
Fourier space.

The 2-2 SPT power spectrum in Fourier space is

P22(k) = 2

[F2(q, k − q)]2Plin(q)Plin(|k − q|).

Expanding the square of the symmetrized second-order F2 kernel in Legendre polynomials gives

(cid:20) 1219
(cid:18) q

+

735
8
35

+

1
6

+

p

(cid:18) q2
(cid:19)

p2 +
p
q

p2
q2

P3(µ) +

P0(µ) +

62
35

64
1715

P4(µ),

(cid:18) q

(cid:19)

(cid:20) 1342

1029

(cid:18) q2

+

p
q

p

P1(µ) +

+

1
3

p2 +

(cid:19)(cid:21)

p2
q2

P2(µ)

(29)

(30)

(cid:90)
(cid:19)(cid:21)

q

where we introduced p ≡ k − q and µ ≡ ˆq · ˆp. The fast P22 expression (25) then follows from the general identity

qn1 |k − q|n2 Pl(ˆq · ((cid:92)k − q)) Plin(q) Plin(|k − q|) = (−1)l 4π

q

0

dr r2 j0(kr) ξl
n1

(r) ξl
n2

(r).

(31)

(cid:90) ∞

This expresses the Fourier space convolution on the left hand side in terms of the Fourier transform of a conﬁguration
space product on the right hand side.6

The Legendre decomposition (30) was obtained by converting between powers of wavevector scalar products and

Legendre polynomials using

(ˆx · ˆy)l =

(2l(cid:48) + 1)αll(cid:48)Pl(cid:48)(ˆx · ˆy)

2[F2(q, p)]2 =

(cid:90)

The crucial property of Eq. (33) is that the right hand side is separable, which can be exploited to separate integrals.
The coeﬃcients αll(cid:48) describing the basis change between monomials and Legendre polynomials are given by

dµ µl Pl(cid:48)(µ),

(34)

satisfying αll(cid:48) = 0 if l(cid:48) > l or if l + l(cid:48) is odd (e.g. α00 = 1, α10 = 0, α11 = 1/3, α20 = 1/3, α21 = 0, α22 = 2/15;
see Eq. (D5) in [22] for an analytic expression for related coeﬃcients bl(cid:48)
l ). The general identity (31) can then also be
rewritten as

(cid:90)

(cid:104)

(cid:105)l

qn1|k − q|n2

ˆq · ((cid:92)k − q)

Plin(q)Plin(|k − q|) = 4π

q

0

dr r2j0(kr)

(−1)l(cid:48)

(2l(cid:48) + 1)αll(cid:48) ξl(cid:48)

n1

(r) ξl(cid:48)

n2

(r).

(35)

(cid:90) ∞

l(cid:88)

l(cid:48)=0

As an example, we use this in Appendix B to derive fast expressions for displacement statistics Qn relevant for
Lagrangian Perturbation Theory.

The approach above can of course be applied to any integrals that have the general 3D convolution form of Eq. (31)
or Eq. (35), which may appear in other contexts. The integrands can be slightly generalized to any general product-
separable function of the form f1(q)f2(p), in which case the factor functions f1 and f2 will enter Eq. (18) as 1D
ﬁlters. The Fourier transform approach can also be applied to lower- or higher-dimensional convolution integrals (see
e.g. upcoming CMB lensing work [26] where some 2D convolution integrals will be evaluated with FFTs).

6 One way to obtain Eq. (31) is to introduce a Dirac delta to impose p = k− q, expand this Dirac delta in plane waves (C3), and integrate

over ˆp, ˆq and ˆr using Eq. (C7), which is based on the addition theorem for spherical harmonics.

= 4π

l(cid:48)=0

m(cid:48)=−l

αll(cid:48)Yl(cid:48)m(cid:48)(ˆx)Y ∗

l(cid:48)m(cid:48)(ˆy),

l(cid:88)
l(cid:88)

l(cid:48)=0

αll(cid:48) =

1
2

l(cid:88)

(cid:90) 1

−1

(32)

(33)

E. Related calculations in the literature

7

While we are not aware of other studies that derived the exact expression (25) for Eulerian SPT and proposed it for
fast numerical evaluation with 1D FFTs, the idea to expand in spherical harmonics and integrate over orientations is
a standard method for spherically symmetric problems that can be found throughout the physics literature.

In the context of large-scale structure, Ref. [25] obtained related results in Lagrangian perturbation theory (LPT)
under the Zel’dovich approximation (ZA), although their derivation does not easily extend to SPT. In our notation,
where the role of upper and lower indices of ξl
n is interchanged, Ref. [25] found for the perturbative 2-2 Zel’dovich
correlation function:

ξZA
(22)(r) =

19
15

[ξ0

0(r)]2 +

1
3

ξ0−2(r)ξ0

2(r) − 16
5

ξ1−1(r)ξ1

1(r) +

34
21

[ξ2

0(r)]2 +

2
3

ξ2−2(r)ξ2

2(r) − 4
5

ξ3−1(r)ξ3

1(r) +

4
35

[ξ4

0(r)]2.

(36)

This expression is similar to our Eq. (25) for SPT in the sense that it contains the same constituent terms, but the
coeﬃcients diﬀer slightly. This is expected because the Zel’dovich approximation and Eulerian SPT have slightly
diﬀerent perturbative kernels due to their diﬀerent approaches to modeling LSS. A nice feature of Eqs. (25) and (36)
is that they involve the same ξl
n’s, so that switching between the Zel’dovich approximation and SPT just involves a
change of coeﬃcients. However, in the case of the Zel’dovich approximation only linear displacements are used, which
makes the mapping to the power spectrum particularly simple. This also allows for the eﬃcient evaluation of the
closed form of the mapping, using again Hankel transforms [22].

In the context of SPT, Ref. [24] provides an expression similar to Eq. (25) based on a similar conﬁguration space
calculation. Their ﬁnal result however involves gradients of the correlation function that are not as computationally
eﬃcient as our 1D FFT approach. For P13, our result in the next section is exact and diﬀers therefore from other
approximate conﬁguration space calculations. Other formally related work that we are aware of includes e.g. [27–30].

IV. FAST EVALUATION OF 1-3 POWER SPECTRUM

A. Main expression

In conﬁguration space, 1-3 correlations involve three linear ﬁelds evaluated at the same location and one linear ﬁeld
evaluated at another location. This is diﬀerent from 2-2 correlations, which involve two linear ﬁelds at one and two
linear ﬁelds at another location. In Fourier space, this leads to a diﬀerent momentum structure for P13 compared to
P22, involving Plin(k) and Plin(q) instead of Plin(q) and Plin(|k− q|). Also, scalar products in the integrand arise from
F3(q,−q, k) instead of F 2
2 (q, k − q). We will show here that 1-3 correlations still have the form of a 3D convolution
that can be evaluated eﬃciently with 1D FFTs.

The 1-3 correlation between linear and third order density in Eulerian SPT is given by

2(cid:10)δ(3)(k)δ0(−k)(cid:11) = 2

(cid:90)

F3(q, p, k − q − p)(cid:10)δ0(q)δ0(p)δ0(k − q − p) δ0(−k)(cid:11)

q,p

= 6(2π)3Plin(k)

F3(q,−q, k)Plin(q).

Writing out the symmetric third order F3 kernel, we have7
− k2(k · q)2

− 11k · q

P13(k) = 6Plin(k)

54

6q4

Plin(q)
|k − q|2

q

(cid:20) 5k2

63

(cid:90)

63q4 − 23k2k · q
19(k · q)3

378q2 − 23(k · q)2
378q2 +

(k · q)3
9k2q2

+

This integral consists of 3D convolutions of qn(ˆk· ˆq)lPlin(q) with the function f (q) = 1/q2. The 3D Fourier transform
of the latter is

(37)

(cid:21)

.

(38)

(cid:90)

q

(cid:90)

q

e−iq·r 1

q2 =

1

4πr

,

(39)

7 This agrees with e.g. [31] if the integration variable is changed from q to −q for terms that depend on k + q instead of k − q. Eq. (38)

involves the cosine between k and q because these wavevectors enter as arguments of the F3 kernel.

which corresponds to the solution of the Poisson equation for the potential of a point particle. Expressing the 3D
convolution as a product in conﬁguration space and integrating over orientations then leads to the general identity8

1

|k − q|2 qn (ˆk · ˆq)l Plin(q) =

(2l(cid:48) + 1) αll(cid:48)

dr r jl(cid:48)(kr) ξl(cid:48)

n (r).

(40)

We therefore obtain for the 1-3 loop correction to the SPT power spectrum

P13(k) = Plin(k)

dr r j0(kr) ξ0−2(r)

(cid:90)

q

l(cid:88)

l(cid:48)=0

(cid:90) ∞

0

(cid:20) 67k2

189

(cid:90) ∞

dr r j0(kr) ξ0

0(r) − k4
3

(cid:90) ∞
(cid:90) ∞
(cid:90) ∞
(cid:90) ∞
(cid:90) ∞
dr r j1(kr) ξ1−1(r) − 37k
45
(cid:90) ∞
(cid:90) ∞
dr r j2(kr) ξ2−2(r) − 46k2
189
4k
15

dr r j3(kr) ξ3−1(r) +

+

0
227k3
315
− 2k4
3
76k3
105

+

0

0

0

0

0

0

0

dr r j1(kr) ξ1

1(r)

dr r j2(kr) ξ2

0(r)

(cid:21)

dr r j3(kr) ξ3

1(r)

.

(41)

This is a fast expression for P13 that can be evaluated with sixteen 1D spherical Hankel transforms, eight of which
are also needed to compute P22. We will use this expression for numerical evaluation in the next section. Similar
expressions for Rn integrals relevant for LPT are presented in Appendix B.
polynomials in ν ≡ ˆk · ˆq,

Note that the coeﬃcients in Eq. (41) can also be read oﬀ by decomposing the integrand of P13 in Legendre

(cid:90)

P13(k) = Plin(k)

Plin(q)
|k − q|2

q

(cid:21)

(cid:26)(cid:20) 67k2
(cid:20)

189

+

(cid:21)

(cid:20) 227k3
(cid:20) 76k3

315q

− 37kq
45

P1(ν)

(cid:21)

P2(ν) +

+

4kq
15

105q

P3(ν)

(cid:27)

.

P0(ν) +

− k4
3q2
3q2 − 46k2
− 2k4

189

(cid:21)

Also note that a slightly more general form of Eq. (40) is

(cid:90)

qn1|k − q|n2 (ˆk · ˆq)l Plin(q) =

(2l(cid:48) + 1)αll(cid:48) 4π

dr r2 jl(cid:48)(kr) ξl(cid:48)

n1

(r) Ξ0
n2

(r),

q

where

(cid:90)

q

n(r) ≡ il
Ξl

8

(42)

(43)

(44)

(cid:90) ∞
(cid:90) ∞

0

e−iq·r qn Pl(ˆq · ˆr) =

dq
2π2 q2+njl(qr).

0

B. Alternative expressions

l(cid:88)

l(cid:48)=0

(cid:18) k

q

The fast expression (41) for the P13 loop correction in SPT is not unique, because cosines ν = ˆk· ˆq in the integrand

of Eq. (38) can be substituted by noting that

ν =

1
2

(cid:19)

− |k − q|2

kq

+

q
k

.

(45)

Since the right hand side does not explicitly depend on ν, this relation can be used to lower the l indices of spherical
Bessel functions jl in Eq. (41), generating expressions that are equivalent to Eq. (41) but involve diﬀerent constituent
terms.

8 To obtain Eq. (40), we use Eq. (32), introduce p = k − q with a Dirac delta, decompose this in plane waves (C3) and integrate over ˆq

with Eq. (C7), over p with Eq. (39), and over ˆr with Eq. (C7).

This leads to

(cid:20)

− 1
2

P13(k) = Plin(k)

q

(cid:90)
(cid:90) ∞
(cid:90) ∞
(cid:90) ∞

0

0

qn(ˆk · ˆq)lPlin(q) = αl0 ξ0

n(0).

(cid:90) ∞

2
9

(cid:90) ∞
(cid:90) ∞

0

0

dr r j2(kr)ξ2

0(r)

dr r j2(kr)ξ2−2(r)

dr r j0(kr)ξ0

2(r) +

dr r j2(kr)ξ2

2(r)

0
110k2
dr r j0(kr)ξ0
189
dr r j0(kr)ξ0−2(r) − 4k4
63

0(r) +

(cid:21)

− 5k2
189
− 3k4
14
0(0) − 5k2
1
ξ0
42
2

+

0

One example to rearrange the P13 integrand (38) is to replace odd powers of ν with Eq. (45). In particular, we
choose to replace ν1 by Eq. (45), and we write ν3 = ν2ν and replace the single power of ν there with Eq. (45). This
yields

P13(k) = Plin(k)

q2 +

1
3

q2ν2 − 20
63

k2 +

55
63

k2ν2 − 23
126

k4

q2 − 2

21

k4
q2 ν2

(cid:21)

+ Plin(k)

(46)
In the large-scale limit, k (cid:28) q, the terms with coeﬃcients 11/18 and 1/3 in the ﬁrst square brackets cancel with the
terms with the same coeﬃcients in the second square brackets, implying P13(k) ∼ k2Plin(k) at low k. To obtain a fast
expression, we use Eq. (39) and

Plin(q)

q

.

ν2 +

23
126

k2

q2 − 19

21

k2
q2 ν2

(cid:90)

Plin(q)
|k − q|2

(cid:90)

q

(cid:20)
(cid:20) 11

− 11
18
− 1
3

18

(cid:21)

9

(47)

ξ0−2(0)

.

(48)

This fast expression only involves even powers of k and spherical Bessel functions jl with even l. As before, all ξl
that enter are also needed for P22.

n’s

The last line of Eq. (48) contains the mean-squared mass density and displacement ﬁeld at zero separation, which
only converge if the matter power spectrum decreases suﬃciently fast on small scales.9 Since cancellations of such
potentially divergent terms are numerically problematic, and we did not identify such divergences in Eq. (41), we use
Eq. (41) for numerical evaluation rather than Eq. (48).

Note that the coeﬃcients in Eq. (48) can also be read oﬀ by rewriting Eq. (46) in terms of Legendre polynomials,

P13(k) = Plin(k)

q

+ Plin(k)

Plin(q)
|k − q|2

(cid:90)

Plin(q)

q

P0(ν) +

− q2
2
P0(ν) − 2
9

2

2q2
9

P2(ν) − 5k2
189

P0(ν) +

110k2
189

P2(ν) − 5k2

42q2 P0(ν) +

38k2
63q2 P2(ν)

(cid:21)
P2(ν) − 3k4

14q2 P0(ν) − 4k4

63q2 P2(ν)

.

(49)

(cid:90)

(cid:20)
(cid:20) 1

(cid:21)

V. NUMERICAL EVALUATION

Fig. 1 shows P22 and P13 computed with Eqs. (22), (25) and (41) using only fast 1D Hankel transforms evaluated
with FFTLog [21]. This is compared against the traditional method of performing the convolution integrals (29) and
(38), which involves a 2D quadrature integration for every k in the case of P22, and a 1D quadrature integration for
every k in the case of P13. The relative agreement of the methods is better than 0.1% over ﬁve orders in magnitude
in scales, 0.001 h/Mpc ≤ k ≤ 100 h/Mpc. On scales where loop corrections are most relevant, the fractional diﬀerence
between the methods is around 10−5. This fractional diﬀerence is dominated by the fact that we set the accuracy
of the quadrature integration routine to 10−5. The fractional deviation of the FFT result from the true integration
result should thus be less than 10−5. In principle it should be exact up to machine level precision.

This demonstrates that the new 1D FFT/Hankel transform method to compute 1-loop power spectra is numerically

stable and extremely accurate.

9 Since P13 should not change, such divergences would have to cancel with other terms in the ﬁrst lines of Eq. (48). For example, such a
cancellation is easy to identify between the two terms with coeﬃcient 1/2 in Eq. (48) for k = 0. We do not discuss this in more detail
here because the expression (41) for P13 that we recommend for numerical evaluation does not have such obvious divergences.

10

FIG. 1. Loop corrections P22 and P13 to the SPT matter power spectrum computed with conventional quadrature integration
of the convolution integrals (29) and (38), and with the new 1D FFT method of Eqs. (22), (25) and (41). The bottom panel
shows the relative error between the two methods. Its size is dominated by the accuracy of the quadrature routine which was
set to 10−5.

VI. CONCLUSIONS

Nonlinear corrections to models for the large-scale structure of the universe are becoming an increasingly important
ingredient for future large-scale structure surveys.
In this paper, we establish a new methodology to numerically
evaluate such nonlinear corrections more eﬃciently than commonly used methods.
In particular, we derived new
expressions for the 2-2 and 1-3 loop contributions to the matter power spectrum in Eulerian Standard Perturbation
Theory, given by Eqs. (22), (25) and (41), and for loop integrals relevant for Lagrangian Perturbation Theory, listed
in Appendix B. These new expressions can be evaluated at all output wavenumbers k with just a few one-dimensional
FFTs in an exact manner. In our implementation we found excellent agreement with commonly used quadrature
integration methods. At the same time, the method is a few orders of magnitude faster because it exploits FFTs.

We expect this numerical speedup to be useful for various practical use cases where large-scale structure perturbation
theory is currently applied. For example, it can speed up Monte Carlo chains to explore the cosmological parameter
space when interpreting large-scale structure observations. The FFT method can in principle also be applied to higher
order corrections to the power spectrum where brute-force quadrature integration becomes prohibitively expensive.

The fast expressions for loop corrections to the matter power spectrum can be derived by working in conﬁgu-
ration space instead of the more commonly used Fourier space. The fact that the perturbative expansion of the
density involves products of ﬁelds in conﬁguration space simpliﬁes the calculation compared to Fourier space, where
conﬁguration space products become convolutions. An alternative derivation of our results follows by evaluating three-
dimensional convolution integrals as Fourier transforms of products in conﬁguration space (and exploiting spherical
symmetry of the problem). We derive general identities for three-dimensional convolution integrals given by Eqs. (31),
(35), (40) and (43). These may be useful in other contexts where formally similar integrals appear.

We expect that the approach proposed in this work can be extended in various ways, e.g. to halos in redshift space
or higher loop corrections and higher order N-point functions. Given the plethora of upcoming large-scale structure
experiments and cosmological inferences possible with these datasets, such extensions should be very worthwhile.

Code developed for this paper to evaluate 1-loop power spectra with 1D FFTs can be obtained from the authors

�����������������������������������(�)[���/�]��=������������-��������-���������-��������-�����������������������������-���-���-���-������������[�/���]����������=���������upon request by emailing zvlah@stanford.edu.

ACKNOWLEDGMENTS

We thank Uroˇs Seljak and Martin White for useful discussions. Z.V. is supported in part by the U.S. Department

of Energy contract to SLAC no. DE-AC02-76SF00515.

Appendix A: Conﬁguration space evolution equations

11

Using the usual well-motivated approximation that the velocity ﬁeld is irrotational, and deﬁning the velocity
divergence θ ≡ ∇ · v, and velocity potential ∇2ψ ≡ θ, we can, with simple vector calculus manipulations, write the
ﬂuid evolution equations in the following form, assuming an Einstein-de Sitter Universe for simplicity:

and

∂δ
∂τ

+ θ =

1
2

(cid:2)ψ∇2δ − δθ − ∇2 (δψ)(cid:3)

(cid:20)

(cid:21)

(A1)

∂θ
∂τ

+ Hθ +

H2δ =

3
2

1
2

∇2(ψθ) − 1
2

∇4ψ2

(A2)
where τ is the conformal time deﬁned by dτ = dt/a(t), and H ≡ d ln a/dτ = Ha. This form makes explicit the fact
that this evolution is local in δ(x), θ(x), and ψ(x) (counting Laplacians as local, as they involve only diﬀerences in the
ﬁeld at inﬁnitesimal separation). The evolution is of course not actually local in the evolution variables, density and
velocity, as evolving them requires computing the integral ψ = ∇−2θ, but we are used to doing this kind of integral
eﬃciently as a multiplication by k−2 in Fourier space. While we do not use this approach explicitly in this paper, this
form of the equations motivates writing the usual Eulerian SPT recursion relations in conﬁguration space in terms
of these ﬁelds, which can be done to produce expressions exactly equivalent to the usual integrals over Fourier space
kernels like F2, F3, etc.. From there one can derive expressions for, e.g., ξ22(r), entirely as products of correlations of
the above ﬁelds, and Laplacians of these correlation functions. This motivates the idea that we can evaluate PT terms
using a combination of products in conﬁguration space and derivatives in Fourier space, with FFTLog transformations
between them, similar to the approach used in spectral method numerical simulations. The various diﬀerent Hankel
transforms that we use in the main text turn out to be a concise way to evaluate the combinations of derivatives that
would otherwise appear in the higher order correlation function expressions.

Appendix B: Fast expressions for Qn and Rn integrals in Lagrangian Perturbation Theory (LPT)

Integrals similar to P22 and P13 often appear in the literature. Here we provide fast expressions for integrals that
arise when computing polyspectra of the displacement ﬁeld that play an important role in Lagrangian Perturbation
Theory (LPT). Since the relevant displacement kernels L(n) involve the same terms as the F (n) kernels, the integrals
contain the same type of terms as SPT 1-loop power spectra but with modiﬁed coeﬃcients.

1. Fast Qn integrals

We use the same deﬁnitions as in [32] for all Qn integrals, e.g.

(cid:90) ∞

Q1(k) =

k3
4π2

(cid:90)

= k4

q

0

dr Plin(kr)
[1 − (ˆk · ˆq)2]2

|k − q|4

dx Plin(k(1 + r2 − 2rx)1/2)

−1
Plin(q)Plin(|k − q|),

(cid:90) ∞

0

k3
4π2

dr

dx ··· =

(cid:90) d3q

(2π)3

k2

q2 ··· .

r2(1 − x2)2

(1 + r2 − 2rx)2

(B1)

(B2)

(B3)

where q = kr and x = ˆk · ˆq, so that rx = k · q/k2 and

(cid:90) 1

(cid:90) 1

−1

12
Rather than parameterizing the orientation of the integration variable q in terms of x = ˆq· ˆk, it can be parameterized
in terms of µ = ˆq · ((cid:92)k − q). Then, all Qn integrals from [32] can be expressed in terms of convolution integrals of the
general form given by Eq. (35).10

To apply this to Q1 we express it in terms of µ,

[k2q2 − (k · q)2]2

q4|k − q|4

Plin(q)Plin(|k − q|)

(1 − 2µ2 + µ4)Plin(q)Plin(|k − q|).

(cid:110)

(cid:26) 8

(B6)

(B7)

,

(B8)

0 (r)]2(cid:111)

Q1(k) =

q

q

=

(cid:90)
(cid:90)
4(cid:88)
(cid:90) ∞

l(cid:48)=0

0

(cid:18) q
(cid:26) 4
(cid:26) 38

q

15
4
3

+

Using Eq. (35) this integral becomes

(cid:90) ∞

0

Q1(k) = 4π

dr r2j0(kr)

(−1)l(cid:48)

(2l(cid:48) + 1)

α0,l(cid:48)[ξl(cid:48)

0 (r)]2 − 2α2,l(cid:48)[ξl(cid:48)

0 (r)]2 + α4,l(cid:48)[ξl(cid:48)

where we extended all sums up to l(cid:48) = 4, which does not change the result because αll(cid:48) = 0 for l(cid:48) > l. Plugging in α’s,

Q1(k) = 4π

dr r2j0(kr)

0(r)]2 − 16
[ξ0
21

[ξ2

0(r)]2 +

8
35

[ξ4

0(r)]2

15

.

(B9)

(cid:27)

This is a l = 0 1D Hankel transform of a sum of products of ξl
when computing P22 with Eq. (25).

Similar fast expressions follow for the other Qn integrals, e.g.

(cid:19)

|k − q|

(cid:21)(cid:27)

Q2(k) =

1 +

µ + µ2

Plin(q)Plin(|k − q|)

n’s which is fast to evaluate. The same terms also arise

|k − q| +

q
0(r)]2 − 4
(cid:19)
[ξ0
7

5
|k − q|

0(r)]2 − 8
(cid:21)2
[ξ2
35

µ + µ2

Plin(q)Plin(|k − q|)

0(r)]2 − 4
[ξ4
5

ξ1
1(r)ξ1−1(r) +

4
5

(cid:27)

ξ3
1(r)ξ3−1(r)

(B10)

,

(B11)

(B12)

= 4π

dr r2j0(kr)

(cid:90)

(cid:90)

q

(cid:26)(cid:0)1 − µ2(cid:1)(cid:20)
(cid:90) ∞
(cid:18) q
(cid:20)
(cid:90) ∞

1 +

0

q

= 4π

0

Q3(k) =

|k − q| +

dr r2j0(kr)

[ξ0

0(r)]2 +

ξ0−2(r)ξ0

ξ1−1(r)ξ1

1(r) +

2(r) − 32
5

ξ2−2(r)ξ2

ξ3−1(r)ξ3

1(r) +

8
35

[ξ4

0(r)]2

2
3
2(r) − 8
5

(cid:27)

[ξ2

0(r)]2

68
21

.

(B13)

As a consistency check, we conﬁrmed that 9Q1/98 + 3Q2/7 + Q3/2 = P22 is satisﬁed [15, 22], i.e. the coeﬃcients in
Q1, Q2 and Q3 add up to those of P22 in Eq. (25).

2. Fast Rn integrals

Similarly, the Rn integrals of [15, 32] are related to P13 integrals and fast expressions can be obtained similarly to

P13. For example,

R1(k) =

dr Plin(kr)

(cid:90) 1

(cid:90) ∞
(cid:20) 8
(cid:90) ∞
|k − q|2 (1 − ν2)2Plin(q)

0
k2

−1

dx

dr r j0(kr)ξ0

(cid:90)

q

15

0

k3
4π2 Plin(k)

= Plin(k)

= k2Plin(k)

r2(1 − x2)2
1 + r2 − 2rx

(cid:90) ∞

0

dr r j2(kr)ξ2

0(r) +

(cid:90) ∞

0

8
35

(cid:21)

dr r j4(kr)ξ4

0(r)

0(r) − 16
21

(B14)

(B15)

,

(B16)

10 To convert the integrands from Ref. [32], note that 1 + r2 − 2rx = |k − q|2/k2 and
|k − q|2

|k − q|2

|k − q|

1 − x2 =

(1 − µ2),

1 − rx =

x2 =

1 +

q2
k2

q

k2

k2

(cid:19)2

µ

,

(cid:18)

(cid:18)

1 +

(cid:19)

q

|k − q| µ

Powers of k can be mitigated by noting that k2 = (k − q + q)2 implies

k2

q|k − q| =

|k − q|

q

+

q

|k − q| + 2µ.

(cid:18)

1 +

q2
k2

|k − q|

q

(cid:19)

.

µ

,

rx =

(B4)

(B5)

13
where ν = x = ˆq · ˆk, and we used Eq. (40) for the last step. Due to related angular structures, Eq. (B16) for R1 and
Eq. (B9) for Q1 involve the same coeﬃcients.

For the R2 integral of [15, 32] we obtain

R2(k) = Plin(k)

Plin(q)

1

|k − q|2

(ν − ν3) + k2(ν4 − ν2)

(cid:21)

(cid:90)
(cid:20)

(cid:90)
(cid:90)

q

− 2k2
15
2k3
5

+

(cid:20) k3

q

(cid:90)

0(r) − 2k2
dr r j0(kr)ξ0
21
dr r j1(kr)ξ1−1(r) − 2k3
5

(cid:90)

(cid:90)

8k2
35

(cid:21)

.

dr r j3(kr)ξ3−1(r)

= Plin(k)

dr r j2(kr)ξ2

0(r) +

dr r j4(kr)ξ4

0(r)

We again check if the relation 10R1/21 + 6R2/7 − 2k2σ2Plin = P13 is satisﬁed [15, 22], where σ2 = 1

q Plin(q)/q2.
Contrary to the P22 case, where simply adding up the Q1, Q2 and Q3 coeﬃcients is suﬃcient to check the consistency,
in the case of P13 recurrence relations of the Bessel functions have to be used. Alternatively, these consistency checks
for both P22 and P13 can also be performed numerically.

3

(B17)

(B18)

(cid:82)

Appendix C: Useful mathematical identities

This section lists some useful mathematical identities for calculations in the main text.
The addition theorem for spherical harmonics is

The angular part of a 3D Fourier transform of a spherical harmonic yields (using Eqs. (C4) and (C1))

Pl(ˆq1 · ˆq2) =

4π

Ylm(ˆq1)Y ∗

lm(ˆq2).

2l + 1

m=−l

dΩˆq e±iaq·r Ylm(ˆq) = 4π(±i sgn a)ljl(|a|qr)Ylm(ˆr).

l(cid:88)

(cid:90)

(C1)

(C2)

(C3)

(C4)

(C5)

(cid:90)

(cid:90)

(cid:90)

The Dirac delta can be expanded in plane waves,

(2π)3δD(q) =

d3r eiq·r.

The plane wave expansion for an arbitrary parameter a ∈ R is

e±iak·r =

(2l + 1)(±i sgn(a))l jl(|a|kr) Pl(ˆk · ˆr).

This includes the case a = 0 for which jl(0) = δl0. From Eq. (C1),

e±iak·r = 4π

(±i sgn(a))l jl(|a|kr) Ylm(ˆk)Y ∗

lm(ˆr).

∞(cid:88)

l=0

∞(cid:88)

l(cid:88)

m=−l

l=0

The addition theorem for spherical harmonics (C1) implies the following orthogonality relation for the integral over

two Legendre polynomials

dΩˆq2 Pl(ˆq1 · ˆq2)Pl(cid:48)(ˆq2 · ˆq3) = δll(cid:48)

4π

2l + 1

Pl(ˆq1 · ˆq3).

(C6)

Eqs. (C4) and (C6) can be used to perform the angular part of the 3D Fourier transform of a Legendre polynomial,

dΩˆq e±iaq·r Pl(ˆq · ˆk) = 4π(±i sgn(a))l jl(|a|qr) Pl(ˆk · ˆr),

(C7)

where a ∈ R.

[1] The Dark Energy Survey Collaboration, ArXiv Astrophysics e-prints (2005), astro-ph/0510346.

14

[2] K. S. Dawson, J.-P. Kneib, W. J. Percival, S. Alam, F. D. Albareti, S. F. Anderson, E. Armengaud, ´E. Aubourg, S. Bailey,

J. E. Bautista, et al., The Astronomical Journal 151, 44 (2016), arXiv:1508.04473.

[3] M. Levi, C. Bebek, T. Beers, R. Blum, R. Cahn, D. Eisenstein, B. Flaugher, K. Honscheid, R. Kron, O. Lahav, P. McDonald,

N. Roe, D. Schlegel, and representing the DESI collaboration, ArXiv e-prints (2013), arXiv:1308.0847 [astro-ph.CO].

[4] R. Laureijs, J. Amiaux, S. Arduini, J. . Augu`eres, J. Brinchmann, R. Cole, M. Cropper, C. Dabin, L. Duvet, A. Ealet,

et al., ArXiv e-prints (2011), arXiv:1110.3193 [astro-ph.CO].

[5] D. Spergel, N. Gehrels, C. Baltay, D. Bennett, J. Breckinridge, M. Donahue, A. Dressler, B. S. Gaudi, T. Greene, O. Guyon,

C. Hirata, et al., ArXiv e-prints (2015), arXiv:1503.03757 [astro-ph.IM].

[6] LSST Dark Energy Science Collaboration, ArXiv e-prints (2012), arXiv:1211.0310 [astro-ph.CO].
[7] O. Dor´e, J. Bock, M. Ashby, P. Capak, A. Cooray, R. de Putter, T. Eiﬂer, N. Flagey, Y. Gong, S. Habib, et al., ArXiv

e-prints (2014), arXiv:1412.4872.

[8] M. H. Goroﬀ, B. Grinstein, S. J. Rey, and M. B. Wise, Astrophys. J. 311, 6 (1986).
[9] B. Jain and E. Bertschinger, Astrophys. J. 431, 495 (1994), arXiv:astro-ph/9311070 [astro-ph].

[10] R. Scoccimarro and J. Frieman, Astrophys. J. Supp. 105, 37 (1996), astro-ph/9509047.
[11] R. Scoccimarro and J. A. Frieman, Astrophys. J. 473, 620 (1996), astro-ph/9602070.
[12] D. Blas, M. Garny, and T. Konstandin, JCAP 1309, 024 (2013), arXiv:1304.1546 [astro-ph.CO].
[13] Ya. B. Zeldovich, Astron. Astrophys. 5, 84 (1970).
[14] F. R. Bouchet, S. Colombi, E. Hivon, and R. Juszkiewicz, Astron. Astrophys. 296, 575 (1995), arXiv:astro-ph/9406013

[astro-ph].

[15] T. Matsubara, Phys. Rev. D77, 063530 (2008), arXiv:0711.2521 [astro-ph].
[16] F. Bernardeau, S. Colombi, E. Gazta˜naga, and R. Scoccimarro, Physics reports 367, 1 (2002), astro-ph/0112551.
[17] J. Carlson, M. White, and N. Padmanabhan, Phys. Rev. D 80, 043531 (2009), arXiv:0905.0479 [astro-ph.CO].
[18] U. Seljak and M. Zaldarriaga, Astrophys. J. 469, 437 (1996), astro-ph/9603033.
[19] A. Lewis, A. Challinor, and A. Lasenby, Astrophys. J. 538, 473 (2000), astro-ph/9911177.
[20] W. A. Fendt and B. D. Wandelt, Astrophys. J. 654, 2 (2007), astro-ph/0606709.
[21] A. J. S. Hamilton, Mon. Not. R. Astron. Soc. 312, 257 (2000), astro-ph/9905191.
[22] Z. Vlah, U. Seljak, and T. Baldauf, Phys. Rev. D 91, 023508 (2015), arXiv:1410.1617.
[23] Z. Vlah, M. White, and A. Aviles, JCAP 1509, 014 (2015), arXiv:1506.05264 [astro-ph.CO].
[24] B. D. Sherwin and M. Zaldarriaga, Phys. Rev. D 85, 103523 (2012), arXiv:1202.3998 [astro-ph.CO].
[25] N. McCullagh and A. S. Szalay, Astrophys. J. 752, 21 (2012), arXiv:1202.1306 [astro-ph.CO].
[26] V. Boehm, M. Schmittfull, and B. Sherwin, In preparation.
[27] J. R. Fergusson, M. Liguori, and E. P. S. Shellard, Phys. Rev. D 82, 023502 (2010), arXiv:0912.5516.
[28] J. R. Fergusson, D. M. Regan, and E. P. S. Shellard, Phys. Rev. D 86, 063511 (2012), arXiv:1008.1730 [astro-ph.CO].
[29] Z. Slepian and D. J. Eisenstein, Mon. Not. R. Astron. Soc. 448, 9 (2015), arXiv:1411.4052.
[30] K. M. Smith, L. Senatore, and M. Zaldarriaga, ArXiv e-prints (2015), arXiv:1502.00635.
[31] J. J. M. Carrasco, S. Foreman, D. Green, and L. Senatore, JCAP 7, 056 (2014), arXiv:1304.4946.
[32] T. Matsubara, Phys. Rev. D 78, 083519 (2008), arXiv:0807.1733.

