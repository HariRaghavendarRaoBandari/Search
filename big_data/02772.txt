Unscented External Force Estimation for Quadrotors and Experiments

Christopher D. McKinnon and Angela P. Schoellig

6
1
0
2

 
r
a

M
9

 

 
 
]

O
R
.
s
c
[
 
 

1
v
2
7
7
2
0

.

3
0
6
1
:
v
i
X
r
a

Abstract— In this paper, we describe an algorithm, based
on the well-known Unscented Quaternion Estimator, to es-
timate external forces and torques acting on a quadrotor.
This formulation uses a non-linear model for the quadrotor
dynamics, naturally incorporates process and measurement
noise, requires only a few parameters to be tuned manually,
and uses singularity-free unit quaternions to represent attitude.
We demonstrate in simulation how the proposed algorithm
outperforms existing methods, namely a non-linear observer,
and how our approach can be used to generate force and torque
proﬁles from experimental data that are useful in controller
design. Finally, we show how the resulting controllers enable a
quadrotor to track the center of wind induced by a fan, and
avoid catastrophic loss of lift due to downwash.

I. INTRODUCTION

Quadrotors are small and agile, and are becoming increas-
ingly capable for their compact size. They are expected to
perform in a wide variety of tasks, where they are either
required to physically interact with the environment for appli-
cations such as inspection and manipulation [1]–[5], or ﬂy in
close proximity to other quadrotors for applications involving
formation ﬂight [6]–[8]. In all these cases, quadrotors may
experience a signiﬁcant external force, which is difﬁcult
to model but affects the quadrotor’s dynamic behaviour.
Accurately estimating external forces and reacting to them
appropriately can be essential to completing a given task
safely and effectively. The diverse range of applications for
quadrotors motivates the development of a method that does
not require specialized knowledge about the quadrotor’s tasks
and detailed dynamic models of the external force effects,
which are difﬁcult to derive from ﬁrst principles. This has
lead to an increased interest in external wrench (that is,
combined force and torque) estimators and their application
to quadrotors [5], [9]–[11].

To date,

the most popular approach that

incorporates
the non-linear dynamics of the quadrotor is to use a non-
linear observer, which can be applied in conjunction with
a feedback controller to improve ﬂight performance in the
presence of external forces and torques. While it provides
an effective means to estimate forces and torques in practice
in the case when the forces and torques are large and
the noise level is low, we found that the accuracy of the
estimate degrades quickly as we increased the level of noise.
Recovering good performance from the noisy signal requires

The authors are with the Dynamic Systems Lab (www.dynsyslab.org) at
the University of Toronto Institute for Aerospace Studies (UTIAS), Canada.
Email: chris.mckinnon@mail.utoronto.ca, schoellig@utias.utoronto.ca

This work was supported by the Natural Sciences and Engineering

Research Council of Canada under the grant RGPIN-2014-04634.

Video

available

at: https://www.youtube.com/watch?v=

x0RL7Jh6F9s

extensive ﬁltering of the inputs and outputs, and tuning the
many ﬁlter parameters is a time-consuming and intricate
process for which there is no systematic solution.

The goal of this paper is to present an external force
and torque estimation algorithm that can provide accurate
estimates of the external forces and torques acting on a
quadrotor in realistic experimental settings and which is
parametrized by a small number of effective tuning pa-
rameters. We develop a novel force estimation algorithm
borrowing ideas from the Unscented Quaternion Estimator,
[12]. We use the estimator to map the forces a quadrotor
experiences as it ﬂies close to objects including another
quadrotor or a fan. We quantify the accuracy of our estimate
and demonstrate in experiment how measurements of this
force ﬁeld can be used in combination with admittance
control to (i) track a fan using only estimated aerodynamic
forces, and (ii) avoid catastrophic loss of lift due to impinging
downwash.

The ﬁrst external force estimator for quadrotors was
presented in [11], which focused on human-quadrotor inter-
action. The authors used a Kalman ﬁlter and the linearized
quadrotor dynamics to estimate external force, which was
then used as input to an admittance controller. They esti-
mated the full 3-D external force vector, but their analysis is
restricted to small changes in attitude due to the linearization.
Since then, researchers have shown numerous applications
for quadrotors that use external force and torque estimates
as an input to their algorithms and accordingly, they have
developed improved force and torque estimators better suited
to the demands of their tasks. A non-linear observer was ﬁrst
applied to the task of estimating external forces and torques
by [3], and later extended in [9] and [13]. These papers
highlighted many potential applications including reducing
the risk of damage in a collision, tactile mapping, takeoff
and landing detection, identifying the material of a surface
by colliding with it [9], and impedance control [9], [13].
Non-linear observers work well in practice if forces are large
and sensor noise is small. Otherwise, inputs and outputs of
the non-linear observer must be carefully ﬁltered, since the
algorithm is based on a deterministic formulation and does
not account for process and sensor noise. The ﬁlter tuning
can be an intricate and time-consuming process.

Non-linear stochastic state estimation algorithms such as
the Unscented Kalman Filter (UKF) are designed to properly
handle sensor and process noise, and many of the tuning
parameters are derived directly from the noise properties
of the sensors making it easy to tune. We demonstrate the
effectiveness of such an approach in several experiments with
a quadrotor, and also show a comparison of this algorithm

and a non-linear observer in simulation.

The ﬁrst contribution of this work is to design a force
estimator that can adequately handle noisy measurements.
We develop an external force and torque estimation algorithm
based on an Unscented Kalman Filter (UKF) which (i) uses
a non-linear model for the quadrotor dynamics, (ii) ex-
plicitly takes into account sensor noise and imperfections
in our quadrotor model, (iii) is light-weight enough to be
implemented for applications that require high update rates,
and (iv) uses singularity-free quaternions to represent the
attitude of the quadrotor.

The second contribution is to demonstrate in experiment
how the estimated values of force and torque can be used to
react to a wide variety of aerodynamic disturbances without
explicitly modeling them. We include two illustrative experi-
ments: downwash detection, where we use force estimates to
detect downwash and invoke an avoidance strategy, and fan
following, where we use an admittance controller to enable
the quadrotor to track the center of a fan.

II. FORCE AND TORQUE ESTIMATION

The ﬁrst component of the force and torque estimation
algorithm is a simple model of the quadorotor dynamics.
External forces and torques are quantities that cannot be
explained by our ﬁrst-principles quadrotor model but are
exerted by external sources such as physical contact or air
ﬂow induced by a fan. We present a force/torque estimation
scheme based on the Unscented Kalman Filter (UKF), which
carefully models the source of process and measurement
noise.

The two basic steps in the UKF implementation are the
prediction step and the correction step. The prediction step
predicts the state of the quadrotor at the next time-step given
measurements of the motor turn rates and a model of the
quadrotor dynamics. In the correction step, the state estimate
is updated to better explain the observed vehicle motion. In
our case, this means the external force and torque estimates
are adjusted to explain differences between measurements
of the vehicle position and attitude, and the corresponding
predicted values.

A. Prediction Model

In this section, we present the discrete-time model of
quadrotor dynamics. We use a discrete-time model to accu-
rately represent both the discrete nature of the measurements
and inputs, and the corresponding uncertainties in the model.
We use subscript k to denote the discrete-time index (i.e.,
xk = x(kT ) with T being the sampling period) and make
reasonable assumptions about how quantities vary between
time-steps.
1) Translational Dynamics: The quadrotor is modeled as
a rigid body with mass m and (3 × 3) inertia matrix I. Our
model neglects aerodynamic effects but has proven accurate
in experiments at low speeds where unmodelled aerodynamic
effects are not signiﬁcant [14].
The quadrotor is actuated by four propellers. Individually,
each motor i, i ∈ {1, 2, 3, 4}, produces a thrust proportional

Fig. 1.
Coordinate frames and variable deﬁnitions for the quadrotor
with B being the body-ﬁxed frame and G the global frame. The collective
thrust ct produced by the four motors is shown in red. External forces,
z ), are shown in blue and
f e = (f e
orange, respectively, and expressed in global coordinates.

z ), and torques, τ e = (τ e

y , f e

x, f e

x, τ e

y , τ e

i , where the
to the squared motor turn rate [6], ci = kiΩ2
constant ki may vary depending on the individual propeller
efﬁciency. The individual forces sum up to give the collective
thrust,

4(cid:88)

ct =

kiΩ2
i ,

(1)

i=1

which acts along the body z-axis, Bez, see Fig. 1.

We assume constant acceleration in the global frame be-
tween time-steps (that is, constant external force and constant
thrust) where we neglect the change in direction of ct in
the global frame over one time-step. These are reasonable
assumptions for small time-steps (in our work, T = 5 ms).
Under these assumptions, the time-discretized translational
dynamics are

xk = xk−1 + T ˙xk−1 +

1
2

T 2 ¨xk−1,

˙xk = ˙xk−1 + T ¨xk−1,
¨xk = RT

k (ct,k + ηct,k)/m − g + f e

k /m,

(2)

(3)
(4)

where xk = [x, y, z]T is the position of the center of mass
k is the rotation
of the quadrotor in global coordinates, RT
matrix from the body frame to the global frame, f e
k is the
external force acting on the quadrotor in global coordinates,
g = [0, 0, 9.81]T is the gravitational vector, m is the mass
of the quadrotor, and ηct,k is the process noise.

The process noise in (4) is to account for uncertainty in
the model of the thrust produced by each propeller, (1). The
thrust mapping is derived close to hover and is not accurate
when the quadrotor’s air speed and attitude are non-zero [15].
Moreover, the measurements of the motor turn rates are
quantized to 8-bit values which adds quantization noise to
the system. To account for these effects, we add zero-mean
Gaussian noise, ηct,k ∼ N (0, Qct), to the nominal thrust.
The variance of the ﬁrst and second element of ηct,k are
non-zero because the estimate of the orientation of Bez is
not perfect, and its orientation with respect to G changes
over one time-step. The third element primarily accounts

to Fig. 1 and Fig. 2, where each motor is a distance l
away from the body x-axis and y-axis. The motors act
in pairs to produce a thrust differential that results in a
torque, which is conveniently expressed in the body frame,
z ]T . Referring to [6] and Fig. 2, the x-
τ m = [τ m
and y-components of τ m are calculated using
3 − k4Ω2
4)

τ m
x = l(k1Ω2

2 − k3Ω2

1 + k2Ω2

x , τ m

y , τ m

(8)

and

3 − k4Ω2
4).

y = l(−k1Ω2
τ m

2 + k3Ω2

1 + k2Ω2

(9)
In addition, each motor produces a torque, Mi, i ∈
{1, 2, 3, 4}, about its own axis of rotation, which is opposite
to its direction of rotation (see Fig. 2). This torque is also
proportional to the squared motor turn rate by constants pi,
i [6]. Motors 2 and 4 rotate in the positive Bez
Mi = piΩ2
direction opposite to motors 1 and 3. The resulting torque is

τ m
z = p1Ω2

1 − p2Ω2

2 + p3Ω2

3 − p4Ω2
4.

(10)

The external
torque, τ e, which comes from unmodeled
external sources, is expressed in the global frame (see Fig. 1).
To obtain the discretized rotational dynamics, we assume
constant angular velocity in the body frame during each time-
step to predict the attitude, and constant motor and external
torque during each time-step to predict the angular velocity.
Under these assumptions, the rotational dynamics are

qk = Ω(ωk−1)qk−1,
ωk = ωk−1 + T I−1(Rk−1τ e
− ωk−1 × Iωk−1),

k−1 + τ m

k−1 + ητ m,k

(11)

(12)

where ωk = [ωx, ωy, ωz]T is the angular velocity expressed
in the body frame, I is the (3 × 3) inertia matrix, and

(cid:20)cos(0.5(cid:107)ωk(cid:107) T )

ψk

Ω(ωk) =

cos(0.5(cid:107)ωk(cid:107) T )13×3 + ψ

×
k
(13)
rotates qk−1 to qk (see [17] equation (5)) with ψk =
sin(0.5(cid:107)ωk(cid:107))T )ωk/(cid:107)ωk(cid:107), where (cid:107)·(cid:107) represents the Eu-
clidean norm [16]. This is equivalent to multiplying qk−1
by the quaternion rotating through angle θ = (cid:107)ω(cid:107) T about
axis ˘u = ωk/(cid:107)ωk(cid:107) in the body frame.

The motor torque, τ m, is uncertain for the same reasons
as ct stemming from (8)-(10), which are derived close to
hover. We model this uncertainty as an additive zero-mean
Gaussian noise, ητ m,k ∼ N (0, Qτ m), with (3× 3) diagonal
covariance matrix, Qτ m.

Similar to the external force, f e, we include an external
torque, τ e, and model it as a random walk, where ητ e,k is
zero-mean Gaussian noise, ητ e,k ∼ N (0, Qτ e ), with Qτ e
being the diagonal covariance matrix,

τ e
k = τ e

k−1 + ητ e,k.

(14)

B. Observation Model

Measurements come from a high-precision, external,
camera-based motion capture system, which measures the
full 6-degree-of-freedom pose of the vehicle, yk = (xk, qk),

−ψT

k

(cid:21)

Fig. 2. Each motor is a distance l from the x- and y-axis, and produces a
thrust ci shown in red. The direction of rotation and turn rate, Ωi, for each
motor is shown in light blue.

for uncertainty in the amount of thrust produced by the
propellers.

The external forces f e are expressed in the global frame
(see Fig. 1). We do not assume any speciﬁc underlying
dynamics for the external forces. We model its dynamics
as a random walk,

(5)

k = f e
f e
is

k−1 + ηf e,k,
zero-mean

ηf e,k

Gaussian

where
noise,
ηf e,k ∼ N (0, Qf e ), and Qf e its diagonal covariance
matrix. The expected value of f e does not change over time
but its variance increases. Values farther from the mean
become more likely as time passes. This choice for the
dynamics of f e allows the UKF to explain discrepancies
between the prediction and measurements by an additional
external force acting on the system. The covariance, Qf e,
becomes a tuning parameter. A smaller covariance indicates
that we expect the force to change slowly, and a larger
covariance means that we expect it to change quickly. A
diagonal noise covariance indicates that components of
force vary independently. Modeling force dynamics as a
random walk has proven sufﬁcient to estimate unknown,
changing forces [9]–[11].

2) Rotational Dynamics: The orientation of the body
frame with respect to the global frame can be represented
by the (4 × 1) unit quaternion q = [q0, qv]T ,

(cid:20)q0

(cid:21)

qv

q (cid:44)

(cid:20) cos(θ/2)

(cid:21)

=

˘u sin(θ/2)

.

(6)

The unit quaternion describes a single rotation by an angle θ
about an axis ˘u, where the latter is a unit vector expressed
in G. Quaternions have two important properties: they are
singularity-free and less susceptible to round-off errors than
rotation matrices [16]. However, like rotation matrices, unit
quaternions must occasionally be re-normalized due to ma-
chine precision. The unit quaternion q can be converted to
the rotation matrix RT according to [17],
0 − 1)13×3 + 2qvqT

(7)
v is the skew-symmetric cross product matrix of qv,

where q×
and 13×3 is the (3 × 3) identity matrix.

v − 2q0q×
v ,

RT = (2q2

We model the quadrotor in the ‘X’ conﬁguration, refer

at 200 Hz. We include additive, zero-mean Gaussian mea-
surement noise for xk, ηx,k ∼ N (0, Gx) and qk, ηq,k ∼
N (0, Gq). The (3×3) diagonal covariance matrices Gx and
Gq depend on properties of the camera system.

is used to express a perturbation from the mean attitude
estimate. An error quaternion is converted to an MRP,

δρ =

δqv

1 + δq0

,

(16)

C. Unscented Filtering

k, f e

The goal of the UKF is to estimate the full state of the
system, sk = (qk, ωk, xk, ˙xk, τ e
k ), at each time-step. In
this work, we are particularly interested in estimating the
external force and torque. We chose to use an Unscented
Kalman Filter approach for reasons highlighted in the in-
troduction. We choose the UKF over the Extended Kalman
Filter (EKF), a common alternative, because of its superior
performance on many non-linear problems [16], [18]. The
UKF produces an approximation that is accurate to third
order for Gaussian random variables, while the EKF is only
accurate to ﬁrst order [16]. In addition, the UKF does not
require the derivation of analytic Jacobians of the dynamics
with respect to the state and process noise, which can be a
time-consuming and tedious task for high-dimensional state
variables.

The UKF is a recursive Gaussian ﬁlter. At each time-
step, the probability density function of the state is entirely
deﬁned by a mean and a covariance. The goal at each time-
step is to go from a prior belief of the mean and covariance
of the state, {ˆsk−1, ˆPk−1}, to a predicted belief, {ˇsk, ˇPk},
and then correct the prediction using measurements to get
the estimate, {ˆsk, ˆPk}, for time-step k. We denote predicted
values by ˇ(·) and corrected values by ˆ(·). The corrected value
for one time-step is the prior value for the next.

The UKF uses a special set of points called sigma points
to represent uncertainty. These points can be transformed ex-
actly through a non-linearity (e.g. the process or observation
model) and then recombined into a mean and covariance
to recover a Gaussian probability distribution. Special care
must be taken to ensure that uncertainty in the rotational
states is properly accounted for during these steps because
the Unscented Transform does not account for the unit-norm
constraint on quaternions. For this purpose, we follow an
approach ﬁrst presented in [12] for spacecraft attitude estima-
tion called the Unscented Quaternion Estimator (USQUE).
The USQUE represents the mean of a rotational state using
singularity-free, unit quaternions with rotational uncertainty
represented as a perturbation to the mean parametrized by a
(3 × 1) vector of Modiﬁed Rodrigues Parameters (MRPs).
MRPs are singular at ±2π but do not have any constraint and,
therefore, may be passed through the Unscented Transform
directly [16]. Uncertainty greater than ±2π would mean we
basically have no knowledge of the attitude of the system,
which is usually never the case.

1) Preliminaries: The USQUE requires us to frequently
convert between local error quaternions and MRPs. The local
error quaternion,

to perform operations involving the Unscented Transform.
An MRP may be transformed back to an error quaternion
using

δq0 =

1 − δρT δρ
1 + δρT δρ

,

δqv = δρ(1 + δq0),

(17)

and can then be added back to the mean rotation.

2) Prediction Step: The ﬁrst step in each iteration of
the UKF is to propagate the prior state estimate to the
next time-step using the motion model, (2)-(5), (11)-(14),
and the known input, ct,k and τ m
k , computed from the
known turn rates Ωi and (1), (8)-(10). The mean estimate
of the state of the system at time-step k is denoted by
ˆsk = (ˆqk, ˆωk, ˆxk, ˆ˙xk, ˆτ e
k ). The prediction step to go
from ˆsk−1 to the predicted belief at time k, ˇsk, is outlined
below.

k, ˆf e

ˆsk−1

is

k−1), where

prior
state
(18 × 1)

converted
δρˆsk−1
δˆρ

representation
k−1, ˆf e

to
The mean
the minimal
=
(δˆρk−1, ˆωk−1, ˆxk−1, ˆ˙xk−1, ˆτ e
is
the (3 × 1) MRP vector, where δˆρ = 0 since it
represents a perturbation from the mean, which for
the mean is zero. The state vector
is combined with
the process noise to form a (30 × 1) extended state,
ˆzk−1 = (δρˆsk−1, ˆητ m , ˆητ e , ˆηct, ˆηf e ) = (δρˆsk−1, ˆη), where
the process noise has the same mean and covariance for
all time-steps. This vector contains all uncertain quantities
of
the prediction step. We assume that we know the
the system (such as mass and
physical parameters of
inertia) exactly, however in general,
these may also be
included in the estimated state, cf. [19]. With ˆPk−1, the
(18 × 18) covariance matrix for the uncertainty in the prior
state δρˆsk−1, and Q, the (12 × 12) stacked process noise
covariance which is constant for all time-steps, the extended
mean, ˆzk−1, and covariance, ˆΣzz,k−1, become

(cid:20) ˆPk−1

012×18

(cid:21)

018×12

Q

.

(18)

(cid:20) ˆsk−1

(cid:21)

012×1

ˆzk−1 =

,

ˆΣzz,k−1 =

With L = 30 being the dimension of ˆzk−1, we compute
a set of (2L + 1) sigma points, Zk−1,i, i ∈ {1, ..., 2L + 1},
according to

Sk−1ST

k−1 = ˆΣzz,k−1
Zk−1,0 =ˆzk−1
√
Zk−1,j =ˆzk−1 +
Zk−1,j+L =ˆzk−1 − √

(19)
(20)
(21)
L + κ coljSk−1
L + κ coljSk−1, j = 1, . . . , L, (22)
where coljSk−1 is the jth column of the lower triangular
matrix from the Cholesky decomposition of ˆΣzz,k−1, and κ
is a tuning parameter, which should be set to two assuming
the state follows a Gaussian distribution [20].

δq = [δq0, δqT

v ]T ,

(15)

Each sigma point is un-stacked into the prior uncertainty

and process noise,

(cid:20)ˆsk−1,i

(cid:21)

ˆηk−1,i

.

Zk−1,i =

(23)

The MRP vector in each sigma point i is converted to an
error quaternion, δˆqk−1,i, which is multiplied by the prior
mean, ˆqk−1, to get the full orientation quaternion for that
sigma point,

i = 0, . . . , 2L,

ˆqk−1,i = δˆqk−1,i ⊗ ˆqk−1,

(24)
where ⊗ represents the quaternion multiplication and adds
the rotation δˆqk−1,k to ˆqk−1. This quaternion along with
the rest of the states from sigma point i are then passed
through the non-linear process model, (4) and (12), to get
the predicted state for each sigma point, ˇsk,i.

Once propagated through the process model, each quater-
nion is then converted back into an error quaternion, δˇqk,i,
by comparing it to the predicted mean, ˇqk,0, using,

δˇqk,i = ˇqk,i ⊗ [ˇqk,0]−1,

(25)
and then to MRPs, δˇρk,i, such that each sigma point is now
of the form δρˇsk,i. These sigma points are recombined into
the predicted mean and covariance using,

(cid:20) δρˇsk

(cid:21)

06×1

(cid:20) ˇPk

06×18

(cid:21)

measurement is the predicted mean stacked with a (6 × 1)
vector of zeros representing the mean noise. The extended
measurement covariance is a block-diagonal matrix including
the predicted uncertainty covariance, ˇPk, and the block-
diagonal measurement noise covariance, G, containing Gx
and Gρ, which are constant for all time-steps,

ˇzy
k =

,

ˇΣzz,k =

018×6

G

.

(32)

The mean and covariance from (32) are converted to a
sigma point representation using (19)-(22). This gives us a
set of predicted sigma points, which include the predicted
uncertainty and the measurement noise. These sigma points
are passed through the observation model to give us the
predicted measurements,

(cid:20) ˇxk,i + ηx,i

(cid:21)

δˇρk,i + ηρ,i

δρ ˇyk,i =

.

(33)

The sigma points are re-combined into a mean predicted
measurement, δρ ˇyk, and predicted measurement covariance,
ˇΣyy,k, by using (27) and substituting ˇPk with ˇΣyy,k and
δρˇsk with δρ ˇyk. The state-measurement covariance ˇΣxy,k is
then calculated as

(26)

ˇΣxy,k =

αi(δρˇsk,i −δρ ˇsk)(δρ ˇyk,i −δρ ˇyk)T ,

(34)

2L(cid:88)

i=0

2L(cid:88)
2L(cid:88)

i=0

δρˇsk =

ˇPk =

i=0

where

αi

αi

δρˇsk,i,

(cid:0)δρˇsk,i −δρ ˇsk
(cid:40) κ

αi =

L+κ
1
κ
2

L+κ

(cid:1)(cid:0)δρˇsk,i −δρ ˇsk

(cid:1)T

if i = 0,
otherwise.

,

(27)

(28)

Finally, the mean perturbation, δˇρk, is converted to δˇqk
added to ˇqk,0 yielding the predicted mean state, ˇsk, for this
time-step.

3) Correction Step: The second step of the UKF is to
correct our prediction of the state using measurements of
the 6-degree-of-freedom pose, yk = (xy
k), obtained
from the motion capture system. Here, we could apply a
standard Kalman ﬁlter update because the observation model
is linear, but chose to present the full UKF formulation for
completeness and generality.

k, qy

The generalized Gaussian correction equations are [20],

−1
Kk = ˇΣxy,k ˇΣ
yy,k,
ˆPk = ˇPk − Kk ˇΣ
T
xy,k,
∆ˆsk = Kk(yk − ˇyk),

(29)
(30)
(31)

where αi are from (28).

Now that we have the predicted measurements, we com-
pare it to the actual measurements from our motion capture
system. The measured attitude of the vehicle, qy
k, is com-
pared to the predicted measurement, ˇqk, to get a perturbation,
(35)
which is converted to MRPs denoted by δρy
k [12]. The
Kalman gain Kk and corrected uncertainty, ˆPk, are com-
puted using (29) and (30). The correction to the predicted
estimate is calculated by comparing the predicted measure-
ment to the actual measurement,

k ⊗ ˇq−1
k ,

k = qy

δqy

δsy

k = Kk

−δρ ˇyk

.

(36)

(cid:18)(cid:20) xy

(cid:21)

k
δρy
k

(cid:19)

MRPs from δsy
k are converted to an error quaternion, δqy
k,
which is used to update the mean of the predicted attitude.
This gives us the corrected attitude for this time-step,

ˆqk = δqy

k ⊗ ˇqk.

(37)

The other components of the prediction are updated by direct
addition, e.g. ˆxk = δxy
k + ˇxk, completing the measurement
update.

where ∆ˆsk is the correction added to the predicted state,
Kk is the Kalman Gain, ˇΣxy,k is the predicted state-
measurement covariance matrix, and ˇΣyy is the predicted
measurement covariance matrix to be deﬁned below.

The ﬁrst step to set up the correction is to form an
extended measurement state, ˇzy
k = (δρˇsk, ηx, ηρ), which
includes the predicted measurement noise. The extended

III. EXPERIMENTAL SETUP AND CALIBRATION

Our experimental platform is the Parrot AR.Drone 2.0 run-
ning ﬁrmware version 2.3.3. We interface with the AR.Drone
through ROS, an open-source robot operating system [21].
More precisely, we use ROS Hydro installed on a 64-bit
12.04 Ubuntu operating system. In addition, we used the

Fig. 3.
cases. A mixture of Gaussians was ﬁt to the data to get cluster statistics.

Force and torque measurements corresponding to the three test

ROS ardrone autonomy package [21] version 1.3.1. Mea-
surements of position and attitude are received from the
camera system at 200 Hz. The vehicle parameters such as
mass and rotational inertia are given in [22]. All experiments
were conducted with the indoor hull shown in Fig. 1, which
protects the vehicle propellers.

To quantify the accuracy of our force and torque estimator,
we consider three scenarios: hover, suspending a 53 g
test mass below the center of mass of the quadrotor, and
suspending the test mass under one set of propellers of the
quadrotor. The resulting target force-torque values are (0,0),
(-0.52,0), and (-0.52,0.067), respectively. As shown in Fig.
3, the mean value of the estimates for each scenario is within
one standard deviation of the target values, and the standard
deviation of the estimates suggests we can measure static
force and torque to within 0.05 N and 0.02 Nm, respectively.
We also tested the dynamic response of our estimator, see
Fig. 4. We can achieve a rise time of about 1 s while retaining
good noise suppression characteristics.

IV. COMPARISON TO A NON-LINEAR OBSERVER

We compare our method to the non-linear observer pro-
posed in [10] with added low-pass ﬁltering on the measure-
ments as suggested in [9]. Filtering was essential for the non-
linear observer to produce reasonable results in the presence
of noise. Fig. 5 depicts simulation results that show how
our proposed estimator converges quickly to the true value
and remains robust to noise. The non-linear observer can
be tuned to perform similar to the proposed estimator when
encountering low noise as shown in Fig. 5 a). However, the
observer is not as effective when the noise increases, see Fig.
5 b).

V. PRACTICAL APPLICATIONS

Having shown that the force estimator provides reasonable
results and having quantiﬁed its accuracy, we use it now
to measure external forces and torques when we have no
speciﬁc model for the mechanism causing these forces and
torques. We show how these estimates can be used in the

Fig. 4.
Time series showing the step response of the force and torque
estimates for a known, applied external force and torque: a mass of 53 g
is suspended from the quadrotor at about 1 s. The actual external force and
torque values are shown in black. In both cases, the estimator converges to
the correct value with a rise time of about 1 second.

(a) Force

(b) Torque

Fig. 5. A direct comparison of the proposed algorithm against a representa-
tive non-linear observer. Both algorithms perform well when measurements
are relatively noise-free (a), however the UKF-based algorithm is more
robust to noise as shown in b). For the simulation shown above, zero-mean,
Gaussian noise was added to the position and attitude measurements with
a standard deviation of 0.01 m, and 0.05 rad, respectively.

scenarios where a quadrotor experiences an aerodynamic
disturbance caused by impinging downwash or by wind
from a fan. We encourage readers to check out the asso-
ciated video at https://www.youtube.com/watch?
v=x0RL7Jh6F9s

A. Fan Tracking

In this section, we use a fan to generate a large aero-
dynamic force and show how the torque estimate is reliable
enough to guide the quadrotor to the center of the ﬂow using
an admittance controller. Fig. 6 shows two key force and
torque proﬁles due to the fan, estimated using the proposed
force estimator. The fan was placed at the origin facing
towards the positive x-axis, and the quadrotor was ﬂown in
a 0.5 m grid pattern hovering at each point for 5 s and facing
towards the negative x-axis. We used this visualization of the
force and torque induced by the fan to design an admittance
controller to track the center of the ﬂow induced by the fan
along the y-axis. The τ e
z proﬁle shown in Fig. 6 is anti-
symmetric where the sign of the torque tells us which side
of the fan the quadrotor is on. The magnitude of the torque

(a) Force f e
x

(b) Torque τ e
z

Fig. 6. Measurements of the force and torque proﬁle in the x − y plane
using the estimator in Section II. There is a strong axial force component
in the direction away from the fan which matches expectations, and an anti-
symmetric torque proﬁle. The τ e
z proﬁle makes sense intuitively since the
fan would induce a drag force which, when placed to one side of the center
of mass, produces a torque about the body z-axis.

increases to a maximum at roughly 0.5 m from the axis of
the fan. As a result, we design a proportional, admittance
controller,
z , which can keep the quadrotor in
front of the fan by reacting to the torque about the z-axis
without requiring any specialized wind sensors.

˙ycmd = kp ˆτ e

Fig. 7 shows how the force and torque estimator is
sensitive enough to allow the quadrotor to move towards the
fan from 0.8 m away, and responds quickly enough to the
quadrotor to track a moving fan.

B. Downwash Avoidance

Downwash is another aerodynamic disturbance that exerts
a large force when one quadrotor passes below another one.
Fig. 8 shows two key force and torque proﬁles for downwash
measured using the proposed estimator. We see the strongest
downwards force is contained within a 0.3 meter radius of
the upper quadrotor, which is located at (0, 0). The strong
gradient of the vertical force in this region is what causes
the external torque about the x-axis in Fig. 8 b).

Measurements of the force proﬁle allow us to design a
simple but effective means for downwash avoidance. Fig. 8
shows that the downwash force is restricted to a relatively
small area, which means the opportunity to detect downwash
(caused by an a priori unknown quadrotor on top) pre-
emptively and choose the correct action is very small. So,
rather than try to avoid the downwash or localize relative
to the source, we choose a strategy to detect it using the
strong vertical force, f e
z , and ﬂy through the affected area as
quickly as possible, which we found works well in practice.
z < −0.5 N means there is
Referring to Fig. 8, measuring f e
an almost 90% probability that the lower quadrotor is within
0.5 m of the upper quadrotor; that is, traveling another 1.0
m in a straight line will bring the lower quadrotor across
the downwash regardless of its position relative to the upper
quadrotor. In other words, we command the lower quadrotor
to move 1 m along its desired path at 1 m/s until it has passed
through the downwash stream at which point normal path
following resumes.

Fig. 7 c) shows the results of this algorithm in experiment.
The quadrotor with the avoidance strategy enabled detects
and passes through the downwash loosing just 0.30 m of

(a) Force f e
z

(b) Torque τ e
x

Fig. 8. The force and torque proﬁles measured by a quadrotor ﬂying at
0.75 m/s 1.0 m below another one.

this avoidance strategy the
altitude. In contrast, without
quadrotor is incapable of passing without
losing signiﬁ-
cant height. Moreover, without downwash avoidance, the
quadrotor saturated its control inputs while it was caught
in downwash. This suggests that for our platform, ﬂying
in the downwash stream would be very challenging for
any feedback controller, even one equipped with a special
downwash model such as the one proposed in [7], due to
physical limitations of the quadrotor. As a result, we have
presented a method for downwash avoidance that works for a
modestly capable quadrotor where adding specialized sensors
would be practically challenging due to payload restrictions.

VI. CONCLUSION

In conclusion, this paper presented an algorithm to es-
timate external forces and torques acting on a quadrotor.
We showed that
the proposed algorithm can adequately
handle noisy measurements, requires only a few intuitive
covariance values to be tuned, and serve as a basis for
reacting to aerodynamic disturbances without relying on
specialized knowledge of the underlying dynamics of the
disturbance, on the aerodynamic properties of the quadrotor,
or on specialized sensors for measuring wind speed. In
addition, we have demonstrated through a set of experiments
how the force estimate may be used in conjunction with
an admittance controller or downwash detection scheme to
enable a quadrotor to respond to a variety of tasks including
holding position relative to a wind source, and avoiding
downwash.

As future work, we hope to explore the use of external
force estimates to localize within a measurable force ﬁeld.
We would also like to examine using this approach as a basis
for physically interactive human-robot
tasks, and believe
our approach may be useful for other types of control and
interaction techniques available in the literature.

REFERENCES

[1] G Darivianakis, K Alexis, M Burri, and R Siegwart. Hybrid Predictive
Control for Aerial Robotic Physical Interaction towards Inspection
the International Conference on
Operations.
Robotics and Automation, pages 53 – 58, 2014.

In Proceedings of

[2] L Marconi and R Naldi. Control of aerial robots: Hybrid Force and
Position Feedback for a Ducted Fan. IEEE Control Systems Magazine,
32(4):43–65, 2012.

(a) Step input.

(b) Fan in motion.

(c) Downwash avoidance.

Fig. 7. Here we show results of the admittance controller and downwash avoidance strategy in action. In a) and b), the fan is 2.3 m away from the
quadrotor and pointed along the x-axis. For the step response, the quadrotor was commanded to start at y = 0.8 m and the fan was turned on after 2
seconds. The proposed admittance controller moves the vehicle to the desired location in front of the fan. Similarly, b) shows that the admittance controller
can track a moving fan consistently. In c), the upper quadrotor is 2 m above the ground and 1 m above the lower quadrotor. A z-error of -1.0 m means
the lower quadrotor is in contact with the ground. A quadrotor with the downwash avoidance strategy enabled (solid lines) is able to pass through the
downwash and fails to do so without it (dashed lines).

[17] J. Kelly and G. Sukhatme. Visual-Inertial Sensor Fusion: Localization,
Mapping and Sensor-to-Sensor Self-Calibration. International Journal
of Robotics Research, 30(1):56–79, 2011.

[18] G. B¨atz, B. Weber, M. Scheint, D. Wollherr, and M. Buss. Dynamic
Contact Force/Torque Observer: Sensor Fusion for Improved Interac-
tion Control. International Journal of Robotics Research, 32(4):446–
457, 2013.

[19] Q. Shomin Mellinger, D. Lindsey and V. M. Kumar. Design, Modeling,
Estimation and Control for Aerial Grasping and Manipulation.
In
Proceedings of the Intelligent Robots and Systems Conference, pages
2668–2673, 2011.

[20] T. D. Barfoot. State Estimation for Robotics: A Matrix-Lie-Group
Approach, Available at http://asrl.utias.utoronto.ca/~tdb/. Cambridge
University Press, 2016.

[21] ardrone autonomy package, ver. 1.3.1, available at www.ros.org, 2014.
[22] J. Pestana Puerta, J.L. S´anchez L´opez, I. Mellado Bataller, C. Fu, and
P. Campoy Cervera. AR.Drone Identiﬁcation and Navigation Control
at CVG-UPM. Journadas Nacionales de Automatica, 2012.

[3] B. Y¨uksel, C. Secchi, H. B¨ulthoff, and A. Franchi. Reshaping
the Physical Properties of a Quadrotor Through IDA-PBC and its
In Proceedings of the
Application to Aerial Physical Interaction.
International Conference on Robotics and Automation, pages 6258–
6265, 2014.

[4] A. Albers, S. Trautmann, T. Howard, T. Hai-Nguyen, M. Frietsch, and
C. Sauter. Semi-Autonomous Flying Robot for Physical Interaction
In Proceedings of the Conference on Robotics
with Environment.
Automation and Mechatronics, pages 441–446, 2010.

[5] N. Hai-Nguyen and L. Dongjun. Hybrid Force/Motion Control and
Internal Dynamics of Quadrotors for Tool Operation. In Proceedings
of the Intelligent Robots and Systems, pages 3458–3464, 2013.

[6] N. Michael, D. Mellinger, Q. Lindsey, and V. Kumar. The GRASP
Multiple Micro-UAV Testbed. IEEE Robotics & Automation Maga-
zine, 17(3):56–65, 2010.

[7] N. Sydney, B. Smyth, and D. Paley. Dynamic Control of Autonomous
Quadrotor Flight in an Estimated Wind Field. In Proceedings of the
Conference on Decision and Controls, pages 3609 – 3616, 2013.

[8] D. Yeo, N. Sydney, and D. Paley. Onboard Flow Sensing for
Downwash Detection and Avoidance with a Small Quadrotor Heli-
copter. In Proceedings of the AIAA Guidance, Navigation and Control
Conference, 2015.

[9] T. Tomic and S. Haddadin. A Uniﬁed Framework for External
Wrench Estimation, Interaction Control and Collision Reﬂexes for
In Proceedings of the International Conference on
Flying Robots.
Intelligent Robots and Systems, pages 4197–4204, 2014.

[10] B. Yuksel, C. Secchi, H. Bulthoff, and A Franchi. A Nonlinear
Force Observer for Quadrotors and Application to Physical Interactive
Tasks. In Proceedings of the International Conference on Advanced
Intelligent Mechatronics, pages 433–440, 2014.

[11] F. Augugliaro and R. D’Andrea. Admittance Control for Physical
In Proceedings of the European

Human-Quadrocopter Interaction.
Control Conference, pages 1805–1810, 2013.

[12] J. Crassidis and F. Landis Markley. Unscented Filtering for Spacecraft
Attitude Estimation. Journal of Guidance, Control, and Dynamics,
26(4):536–542, 2003.

[13] F. Ruggiero, J. Cacace, H. Sadeghian, and V. Lippiello.

Impedance
Control of VTOL UAVs with a Momentum-Based External General-
ized Forces Estimator. In Proceedings of the International Conference
on Robotics and Automation, pages 2093–2099, 2014.

[14] M. Hehn and R. D’Andrea. Quadrocopter Trajectory Generation and
Control. In Proceedings of the International Federation of Automatic
Control World Congress, pages 1485–1491, 2011.

[15] G. Hoffmann, H. M. Huang, S. L. Waslander, and C. J. Tomlin.
Quadrotor Helicopter Flight Dynamics and Control: Theory and Ex-
In Proceedings of the AIAA Guidance, Navigation, and
periment.
Control Conference, volume 2, 2007.

[16] J Kelly. On Temporal and Spatial Calibration for High Accuracy
Visual-Inertial Motion Estimation. PhD thesis, University of Southern
California, 2011.

