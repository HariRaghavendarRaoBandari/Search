6
1
0
2

 
r
a

 

M
8
1

 
 
]

.

C
O
h
t
a
m

[
 
 

1
v
6
6
9
5
0

.

3
0
6
1
:
v
i
X
r
a

Distributed Randomized Control

for Demand Dispatch

Ana Buˇsi´c and Sean Meyn∗†

March 21, 2016

Abstract

The paper concerns design of control systems for Demand Dispatch to obtain ancillary ser-
vices to the power grid by harnessing inherent ﬂexibility in many loads. The role of “local
intelligence” at the load has been advocated in prior work; randomized local controllers that
manifest this intelligence are convenient for loads with a ﬁnite number of states. The present
work introduces two new design techniques for these randomized controllers:

(i) The Individual Perspective Design (IPD) is based on the solution to a one-dimensional family
of Markov Decision Processes, whose objective function is formulated from the point of view
of a single load. The family of dynamic programming equation appears complex, but it is
shown that it is obtained through the solution of a single ordinary diﬀerential equation.

(ii) The System Perspective Design (SPD) is motivated by a single objective of the grid operator:
Passivity of any linearization of the aggregate input-output model. A solution is obtained
that can again be computed through the solution of a single ordinary diﬀerential equation.

Numerical results complement these theoretical results.

1

Introduction

Renewable energy sources such as wind and solar power have a high degree of unpredictability
and time variation, which makes balancing demand and supply increasingly challenging. One way
to address this challenge is to harness the inherent ﬂexibility in demand of many types of loads.
Loads can supply a range of ancillary services to the grid, such as the balancing reserves required
at Bonneville Power Authority (BPA), or the Reg-D/A regulation reserves used at PJM [1]. Today
these services are secured by a balancing authority (BA) in each region.

1.1 Demand dispatch

These grid services can be obtained without impacting quality of service (QoS) for consumers [1,2],
but this is only possible through design. The term Demand Dispatch is used in this paper to
emphasize the diﬀerence between the goals of our own work and traditional demand response.

Consumers use power for a reason, and expect some guarantees on the QoS they receive. The
grid operator desires reliable ancillary service, obtained from the inherent ﬂexibility in the con-
sumer’s power consumption. These seemingly conﬂicting goals can be achieved simultaneously, but
∗Research supported by French National Research Agency grant ANR-12-MONU-0019, and NSF grants CPS-

0931416 and CPS-1259040.

†A.B. is with Inria and the Computer Science Dept. of ´Ecole Normale Sup´erieure, Paris, France; S.M. is with the

Department of Electrical and Computer Engg. at the University of Florida, Gainesville.

Figure 1: Wind generation at BPA.

the solution requires local control: an appliance must monitor its QoS and other state variables,
it must receive grid-level information (e.g., from the BA), and based on this information it must
adjust its power consumption. With proper design, an aggregate of loads can be viewed at the grid-
level as virtual energy storage (VES). Just like a battery, the aggregate provides ancillary service,
even though it cannot produce energy.

Fig. 1 shows the wind generation in the BPA region during the ﬁrst week of 2015. There is
virtually no power generated on New Year’s Day, and generation ramps up to nearly 4GW on the
morning of January 5.
In this example we show how to supply a demand of exactly 4GW during
this time period, using generation from wind and other resources.

Figure 2: One power signal representing signiﬁcant energy delivery, and two zero-energy power signals combine with wind
generation to match a 4GW load.

Let Gr(t) denote the additional power required at time t, in units of GWs. For example, on the
ﬁrst day of this week we have Gr(t) ≈ 4. Day-ahead forecast of the low frequency component of
generation from wind is highly predictable. We let GLP denote the signal obtained by passing the
forecast of Gr through a low pass ﬁlter. The signal GHP is obtained by ﬁltering Gr − GLP using a
high pass ﬁlter, and GMP = Gr − GLP − GHP. Each of these ﬁlters is causal, and their parameters
are a design choice. Examples are shown in Fig. 2.
It is not diﬃcult to ramp hydro-generation up and down to accurately track the power signal

GLP. This is an energy product that might be secured in today’s day-ahead markets.

The other two signals shown in Fig. 2 take on positive and negative values. Each represents
a total energy of approximately zero, hence it would be a mistake to attempt to obtain these
services in an energy market. Either could be obtained from a large ﬂeet of batteries or ﬂywheels.
However, it may be much cheaper to employ ﬂexible loads via demand dispatch. The signal GHP
can be obtained by modulating the fans in commercial buildings (perhaps by less than 10%) [3].
The signal GMP can be supplied in whole or in part by loads such as water heaters, commercial
refrigeration, and water chillers.

Low frequency variability from solar gives rise to the famous “duck curve” anticipated at

2

GW01234Wind Generation at BPA:  First week of 2015Jan 1Jan 2Jan 3Jan 4Jan 5Jan 6Jan 1Jan 2Jan 3Jan 4Jan 5Jan 6GW01234GGGGrLPMPHPCAISO1, which is represented as the hypothetical “net-load curve” in Fig. 3a. The actual net-
load curve is the diﬀerence between load and generation from renewables; the drop from 20 to 10
GW is expected with the introduction of 10 GW of solar in the state of California. This curve
highlights the ramping pressure placed on conventional generation resources.

As shown in this ﬁgure, the volatility and steep ramps associated with California’s duck curve
can be addressed using a frequency decomposition: The plot shows how the net-load can be ex-
pressed as the sum of four signals distinguished by frequency. Variability introduced by the low
frequency component can be rejected using traditional resources such as thermal generators, along
with some ﬂexible loads (e.g., from ﬂexible industrial manufacturing). The mid-pass signal shown
in the ﬁgure would be a challenge to generators for various reasons, but this zero-mean signal, as
well as the higher frequency components, can be tracked using a variety of ﬂexible loads.

The control architecture described in this paper is not limited to handling disturbances from
wind and solar energy. Fig. 3b illustrates how the same frequency decomposition can be used to
allocate resources following an unexpected contingency, such as a generator outage.

(a) The “duck curve” is decomposed as the sum of four
signals: The three high-frequency components can be ob-
tained using VES.

(b) An unexpected power outage requires quick ramping
of power generation. The zero-energy components are
obtained using VES.

Figure 3: Frequency decomposition in two examples in which large ramps in generation are required. In each case, the low-pass
energy component can be obtained through conventional generation, or load-shedding. The remaining components of net-load
are obtained using VES.

For loads whose power consumption cannot be varied continuously, we have argued in prior
work that a distributed randomized control architecture is convenient for design [2, 4, 5]. This
architecture includes local control to maintain bounds on the quality of service delivered by the
loads, and also to ensure high quality ancillary service to the grid.

Analysis of the aggregate is based on a mean-ﬁeld model.

1.2 Mean-ﬁeld model

We restrict to the setting of the prior work [2, 4], based on the following distributed control ar-

chitecture. A family of transition matrices {Pζ : ζ ∈ R} is constructed to deﬁne local decision

making. Each load evolves as a controlled Markov chain on a ﬁnite state space, with common
input ζ = (ζ0, ζ1, . . . ).
it is assumed that the scalar signal ζ is broadcast to each load. If a load
is in state x at time t, and the value ζt is broadcast, then the load transitions to the state x(cid:48) with
probability Pζt(x, x(cid:48)). Letting X i
t denote the state of the ith load at time t, and assuming N loads,
the empirical pdf (probability mass function) is deﬁned as the average,

µN
t (x) =

1
N

1an ISO in California: www.caiso.com

N(cid:88)

i=1

I{X i

t = x},

x ∈ X.

3

One Day at CAISO 2020Net Load CurveGW-50510152012am12am3am6am9am12pm3pm6pm9pmNet Load CurveLow passMid passHigh passHigher passOne Day at CAISO:  4GW loss at 6am GW05101512am12am3am6am9am12pm3pm6pm9pmThe mean-ﬁeld model is the deterministic system deﬁned by the evolution equations,

µt+1 = µtPζt,

t ≥ 0,

(1)

in which µt is a row vector. Under general conditions on the model and on µ0 it can be shown that
µN
t

is approximated by µt.
In this prior work it is assumed that average power consumption is obtained through measure-
ments or state estimation: Assume that U(x) is the power consumption when the load is in state
x, for some function U : X → R+. The average power consumption is deﬁned by,

yN
t =

U(X i
t ),

x ∈ X.

which is approximated using the mean-ﬁeld model:

1
N

N(cid:88)
(cid:88)

i=1

x

yt =

µt(x)U(x),

t ≥ 0.

(2)

The mean-ﬁeld model is a state space model that is linear in the state µt, and nonlinear in the
input ζt. The observation process (2) is also linear as a function of the state. Assumptions imposed
in the prior work [2, 4, 5] imply that the input is a continuous function of these values.

In [4], the design of the feedback law ζt = φt(y0, . . . , yt) is based on a linearization of this state
space model. One goal of the present paper is to develop design techniques to ensure that the
linearized input-output model has desirable properties for control design at the grid level.

1.3 Contributions

Several new design techniques are introduced in this paper, and the applications go far beyond
prior work:

(i) Optimal design. In the prior work [4], the family of transition matrices {Pζ} was constructed
based on an average-cost optimal control problem (MDP). The cost function in this MDP was
parameterized by the scalar ζ. In this prior work, the optimal control problem was completely
unconstrained, in the sense that any choice of P was permissible in the optimal control formu-
lation. The optimal control formulation proposed here is far more general: We allow some
randomness by design, and some exogenous randomness that is beyond our control. These
contributions are summarized in Theorem 2.2.

(ii) Passivity by design. A discrete-time transfer function F is positive-real if it is stable (all poles

are strictly within the unit disk), and the following bound holds:

F (ejθ) + F (e

−jθ) ≥ 0,

θ ∈ R

It is strictly positive-real if the inequality is strict for all θ. A linear system is passive if it is
positive real.

Let (A, B, C) describe a state-space representative of the linearization, with transfer function

G(z) = C(Iz − A]−1B. Consider the delay-free model with transfer function G+(z) := zG(z).

That is,

G+(z) = zC[Iz − A]

−1B =

CAkBz

−k

(3)

A new approach to design of the transition matrices is introduced in this paper to ensure that
the linearization is strictly positive real. The main conclusions are summarized in Theorem 2.3.

4

∞(cid:88)

k=0

(iii) ODE methods for design. A uniﬁed computational framework is introduced. The construction

of the transition matrices {Pζ : ζ ∈ R} is obtained as the solution to a single ODE for each of

the design techniques (i) and (ii).

(iv) Applications. Prior work on distributed control for demand dispatch focused on a single collection
of loads: residential pool pumps [4–6]. The motivation was ease of exposition, and also the
fact that the design methodology required special assumptions on nominal behavior. The new
methodology developed in this paper relaxes these assumptions, and allows application to any
load with discrete power states, such as a refrigerator, or other thermostatically controlled loads
(TCLs).

1.4 Prior work

There are many recent papers with similar goals – to create a science to support demand dispatch.
In [7] and its sequels, all control decisions are at the balancing authority, and this architecture then
requires state estimation to obtain the grid-level control law. A centralized deterministic approach
is developed in [8, 9]. None of this prior work considers design of local control algorithms, which is
the focus of this paper.

Passivity was established in the prior work [10], but only for continuous time models for which
It follows that G+ is minimum

the nominal model (with ζ = 0) is a reversible Markov process.
phase, and hence the original transfer function G(z) = z−1G+(z) is also minimum phase.

The remainder of the paper is organized into four sections. Several design techniques are intro-
duced in Section 2, and Section 3 presents general methodology for constructing and analyzing the
linearized mean-ﬁeld dynamics. Examples are contained in Section 4, and conclusions in Section 5.

2 Design

We ﬁrst summarize the assumptions and notation.

2.1 Assumptions and Notation

A Markovian model for an individual load is created based on its typical operating behavior. This is
modeled by a Markov chain with transition matrix denoted P0, with state space X = {x1, . . . , xd};
it is assumed to be irreducible and aperiodic.
It follows that P0 admits a unique invariant pmf
(probability mass function), denoted π0, and satisfying π0(x) > 0 for each x.

It is assumed throughout this paper that the family of transition matrices used for distributed

control is of the form,

(cid:48)
Pζ(x, x

(cid:48)
) := P0(x, x

in which hζ is continuously diﬀerentiable in ζ, and Λhζ is the normalizing constant

) exp(cid:0)hζ(x, x

(cid:48)

) − Λhζ (x)(cid:1)
)(cid:1)(cid:17)
) exp(cid:0)hζ(x, x

(cid:48)

(cid:16)(cid:88)

x(cid:48)

Λhζ (x) := log

(cid:48)
P0(x, x

(4)

(5)

Each Pζ must also be irreducible and aperiodic.

For any transition matrix P , an invariant pmf is interpreted as a row vector, so that invariance

and we use the standard notation P f (x) =(cid:80)
can be expressed πP = π. Any function f : X → R is interpreted as a d-dimensional column vector,

x(cid:48) P (x, x(cid:48))f (x(cid:48)), x ∈ X.

5

Several other matrices are deﬁned based on P and π: The adjoint of P (in L2(π)) is the

transition matrix deﬁned by

(cid:30)

(cid:48)
(x, x

P

) =

π(x(cid:48))
π(x)

(cid:48)

P (x

, x),

x, x

(cid:48)

∈ X.

The fundamental matrix is the inverse

Z = [I − P + 1 ⊗ π]

−1 =

∞(cid:88)

n=0

[P − 1 ⊗ π]n

(6)

(7)

with [P − 1 ⊗ π]0 := I (the d × d identity matrix), 1 ⊗ π is a matrix in which each row is identical,
and equal to π, and [P − 1 ⊗ π]n = P n − 1 ⊗ π for n ≥ 1.

The Donsker-Varadhan rate function is denoted,

(cid:88)

x,x(cid:48)

K(P(cid:107)P0) =

(cid:48)
π(x)P (x, x

) log

(cid:16) P (x, x(cid:48))

P0(x, x(cid:48))

(cid:17)

(8)

(9)

It is used here to model the cost of deviation from the nominal transition matrix P0, as in [4,10–12].

Nature & nurture In many applications it is necessary to include a model of randomness from
nature along with the randomness introduced by the local control algorithm (nurture).

Consider a load model in which the full state space is the cartesian product of two ﬁnite state
spaces: X = Xu × Xn, where Xu are components of the state that can be directly manipulated
through control. The “nature” components Xn are not subject to direct control. For example,
these components may be used to model the impact of the weather on the climate of a building.

Elements of X are denoted x = (xu, xn). Any state transition matrix under consideration is

assumed to have the following conditional-independence structure,

for x ∈ X, x(cid:48)

u ∈ Xu, x(cid:48)

(cid:48)
P (x, x

n ∈ Xn, where(cid:80)

x(cid:48)

u

(cid:48)
(cid:48)
n),
) = R(x, x
u)Q0(x, x
Q0(x, x(cid:48)
R(x, x(cid:48)

u) =(cid:80)

x(cid:48)

n

is out of our control – this models load dynamics and exogenous disturbances.

n) = 1 for each x. The matrix Q0

2.2 Common structure for design

The construction of the family of functions {hζ : ζ ∈ R} in (4) is achieved using the following steps.
Step 1: The speciﬁcation of a function H that takes as input a transition matrix P that is irre-
ducible. The output H = H(P ) is a real-valued function on the product space X × X. That is,
H(x, x(cid:48)) ∈ R for each pair (x, x(cid:48)) ∈ X × X.
Step 2: The family of transition matrices {Pζ} and functions {hζ} are deﬁned by the solution to
the d-dimensional ODE:
(10)

d

dζ hζ = H(Pζ),

ζ ∈ R,

In the special case in which randomness from nature is not considered, we can apply the methods

in which Pζ is determined by hζ through (4). The boundary condition for this ODE is h0 ≡ 0.
described here using Xn = {x1
The conditional independence constraint (9) imposes constraints on the functions {hζ} and the
transformation H. To ensure that Pζ is of the form (9), it is suﬃcient to restrict to functions hζ of

n} (a singleton).

6

(x, x(cid:48)) that do not depend on x(cid:48)
convention,
(cid:48)
hζ(x, x

n, where x(cid:48) = (x(cid:48)

u, x(cid:48)

(cid:48)
) = hζ(x, x
u),

n) ∈ X. For this reason we make the notational
x ∈ X, x

(cid:48)
(cid:48)
n) ∈ X.
u, x

= (x

(cid:48)

Since hζ is constructed through the ODE (10), we impose the same constraints on H = H(P ):

(cid:48)
H(x, x

(cid:48)
) = H(x, x
u),

(cid:48)
x ∈ X, x

= (x

(cid:48)
(cid:48)
n) ∈ X.
u, x

Given any function H◦ : X → R, the function deﬁned below satisﬁes this constraint:

(cid:48)
H(x, x
u) =

(cid:48)
Q0(x, x
n)H

◦

(cid:48)
(cid:48)
u, x
n)

(x

(11)

Each of the methods that follow construct H = H(P ) of this form. Hence the design problem
reduces to choosing a mapping H◦ = H
The following normalization is imposed throughout: The transition matrix Pζ deﬁned in (4)
does not change if we add a constant to the function hζ. We are thus free to normalize H◦ = H
◦(P )
◦ so that H◦(x◦) = 0 for
by a constant. Throughout the paper we ﬁx a state x◦
any P .

∈ X, and design H

◦(P ).

The ODE method can be simpliﬁed based on these observations. The proof of Prop. 2.1 is

straightforward.

Proposition 2.1. Consider a solution to the ODE (10) in which H = H(P ) is of the form (11)
for any matrix P . It then follows that each of the functions {hζ} are of this form:

(cid:48)
hζ(x, x
u) =

◦
(cid:48)
ζ(x
n)h
Q0(x, x

(cid:48)
(cid:48)
u, x
n),

(cid:88)

x(cid:48)

n

(cid:88)

x(cid:48)

n

x ∈ X, x(cid:48) = (x(cid:48)

u, x(cid:48)

ODE,

n) ∈ X, for some h◦
ζ : X → R. Moreover, these functions solve the d-dimensional
◦
d
ζ = H
dζ h

ζ ∈ R,

(Pζ),

◦

in which Pζ is determined by hζ through (4), and with boundary condition h◦

0 ≡ 0.

2.3 Individual Perspective

In this design, the mapping H◦ = H

◦(P ) is deﬁned in terms of the fundamental matrix:

Given P , the fundamental matrix Z is obtained from (7), and then for each

IPD solution:
x ∈ X,

(cid:88)

x(cid:48)

◦

H

(x) =

(cid:48)
[Z(x, x

) − Z(x

◦

(cid:48)
, x

(cid:48)

).

)]U(x

The function H◦ speciﬁed in (12) is a solution to Poisson’s equation,

where ¯U (also written π(U)) is the steady-state mean:

◦

P H

◦

= H

− U + ¯U

(cid:88)

x

¯U :=

π(x)U(x)

7

(12)

(13)

(14)

The function (12) is the unique solution satisfying H◦(x◦) = 0 [13, Thm. 17.7.2].
This choice for H◦ is called the Individual Perspective Design (IPD) since hζ solves an opti-
mization problem formulated from the point of view of a single load. Given ζ ∈ R, the “optimal

reward” is deﬁned by the maximum,

∗
η
ζ = max
π,P

(cid:8)ζπ(U) − K(P(cid:107)P0) : πP = π(cid:9)
(cid:8)ζπ(U) − K(P(cid:107)P0) : πP = π(cid:9)
(cid:88)

ˇPζ = arg max

P

max

P

(cid:110)
x(cid:48) P (x, x(cid:48)) log(cid:0) P (x,x(cid:48))
(cid:80)

Wζ(x, P ) +

P0(x,x(cid:48))

x(cid:48)

(cid:48)
P (x, x

(cid:1).

(16)
ζ together with a relative value function h∗
(cid:111)

ζ

∗
)h
ζ(x

(cid:48)

)

∗
= h
ζ(x) + η

∗
ζ

(17)

and P is also subject to the structural constraint (9). The maximizer deﬁnes a transition matrix
that is denoted,

It is shown in Theorem 2.2 that the optimal value η∗
solve the average reward optimization equation (AROE):

where Wζ(x, P ) = ζU(x) −
We normalize this function so that h∗
working paper [14].

The relative value function is not unique, since we can add a constant to obtain a new solution.
ζ(x◦) = 0. The proof of the following can be found in the

Theorem 2.2. The IPD solution results in a collection of transition matrices {Pζ : ζ ∈ R} with

(15)

(18)

(19)

the following properties. For each ζ,
(i) The transition matrix is optimal, Pζ = ˇPζ.
(ii) For each x and x(cid:48)

u, the function hζ that deﬁnes Pζ is given by,

(cid:48)
u) =
hζ(x, x

(cid:48)
∗
ζ(x
n)h
Q0(x, x

(cid:48)
(cid:48)
n)
u, x

(cid:88)

x(cid:48)

n

ζ, η∗

where (h∗
(iii) The steady-state mean power consumption satisﬁes,

ζ ) solves the AROE (17).

d
dζ

¯U ζ = d2

dζ2 η

∗
ζ ≥ 0

and hence ¯U ζ is monotone in ζ.

2.4 System Perspective

The motivation for the following System Perspective Design (SPD) is from the point of view of
the BA. Under general conditions, the linearized aggregate model is passive, which is a desirable
property from the grid-level perspective.
◦(P ) is similar to IPD. For any matrix P with invariant pmf π,

The construction of H◦ = H

(cid:30)

recall the deﬁnition of the adjoint P

in (6). The matrix product is denoted

(cid:88)

z∈X

(cid:79)

(cid:48)
(x, x

P

) =

(cid:30)

(cid:48)
(x, z)P (z, x

),

P

(cid:48)

x, x

∈ X.

The fundamental matrix deﬁned in terms of this transition matrix is denoted Z

(cid:79)

= [I−P

(cid:79)

+1⊗π]−1.

8

SPD solution: Given P , the matrix Z

(cid:88)

x(cid:48)

(cid:79)

is obtained, and
(cid:48)
(x, x

(cid:48)
, x

(x

(cid:79)

◦

) − Z

◦

H

(x) =

(cid:79)

[Z

)]U(x

(cid:48)

) , x ∈ X.

(20)

Under additional assumptions, the algorithm obtained from SPD results in a positive real lin-

earization. The proof of the bound (21) is contained in Section 3.2.

Theorem 2.3. Suppose that the Markov chain with transition matrix P
and that P0 = R0 (a model without probabilistic constraints).

(cid:79)
0 = P

(cid:30)
0 P0 is irreducible,

Then, the solution to the SPD satisﬁes the following strict positive-real condition: the linearized

model at any constant value ζ obeys the bound,

G+

ζ (ejθ) + G+

ζ (e

−jθ) ≥ σ2

ζ ,

θ ∈ R

(21)

where σ2

The irreducibility assumption on P

ζ is the variance of U under πζ.
(cid:79)
0 does not come for free. Consider for example the Markov
chain on d ≥ 3 states deﬁned by P0(xi, xi+1) = 1 for 1 ≤ i ≤ d − 1, and P0(xd, xd) = P0(xd, x1) =
1/2. This chain is irreducible and aperiodic. The behavior of the adjoint is similar; in particular,
(cid:79)
(cid:30)
0 (xk, xk) = 1 for 2 ≤ k ≤ d, so the
0 (xi+1, xi) = 1 for each 1 ≤ i ≤ d − 1. It follows that P
P
irreducibility assumption fails.

2.5 Exponential family
Rather than solve an ODE, it is natural to ﬁx a function H◦
ζ,

e : X → R, and deﬁne for each x, x(cid:48)

u and

(cid:48)
hζ(x, x
u) = ζHe(x

(cid:48)
u | x)
(cid:48)
Q0(x, x
n)H

(cid:88)

x(cid:48)

n

◦
e (x

(cid:48)
(cid:48)
u, x
n)

with He(x

(cid:48)
u | x) :=

In this case, the transition matrices deﬁned in (4) can be regarded as an exponential family.

This is a special case of the two-step design described in Section 2.2 in which H
independent of P , and the function H = H(P ) is then obtained from (11).
The exponential family using H◦
Other designs can be obtained as linear approximations to the IPD or SPD solutions, with
H◦
◦(P0). In the linear approximation of the IPD solution, this is a solution Poisson’s equation
e = H
for the nominal model:

e = U will be called the myopic design.

where (cid:101)U 0(x) = U(x) − ¯U 0. The resulting exponential family is called the IPD0 design.

approximately optimal for ζ near zero – a proof of Theorem 2.4 can be found in [14].

P0H

e − (cid:101)U 0

◦

(22)

It is

◦
e = H

◦(P ) = H◦
e ,

Theorem 2.4. The following approximations hold for the transition matrices {Pζ} obtained from
the IPD0 design:

(i) With ˇPζ the optimal transition matrix in (16),

(cid:48)
Pζ(x, x

(cid:48)
) = ˇPζ(x, x

) + O(ζ 2),

(cid:48)
for all x, x

, ζ

(23)

9

(ii) Let ηζ = ζπζ(U) − K(Pζ(cid:107)P0) denote the value of the quantity in brackets in (15) that is
obtained using (πζ, Pζ). Then, ηζ = η∗
A similar result holds if H◦

ζ + O(ζ 4).

e is chosen based on SPD, with
−1

◦
e = [I − P
H

(cid:79)
0 + 1 ⊗ π0]

The linearization at ζ = 0 will be positive-real under the assumptions of Theorem 2.3, because (21)
continues to hold at ζ = 0,

G+

0 (ejθ) + G+

0 (e

−jθ) ≥ σ2

0,

θ ∈ R.

An example in Section 4.2 shows that passivity may fail for the linearization G+
from zero.

ζ at values of ζ far

2.6 Geometric sampling

Geometric sampling is speciﬁed by a transition matrix S0 and a ﬁxed parameter γ ∈ (0, 1). At each
time t, a weighted coin is ﬂipped with probability of heads equal to γ. If the outcome is a tail, then
the state does not change. Otherwise, a transition is made from the current state x to a new state
x(cid:48) with probability S0(x, x(cid:48)). The overall transition matrix is expressed as a convex combination,

P0 = (1 − γ)I + γS0

(24)

One motivation for sampling in [5] is to reduce the chance of excessive cycling at the loads, while
ensuring that the data rate from balancing authority to loads is not limited. It was also found that
this architecture justiﬁed a smaller state space for the Markov model.

Based on this nominal model, there are two approaches to applying the design techniques
If P0 is transformed directly, then the resulting family of transition

introduced in this paper.
matrix will be of the form,

Pζ = (1 − γζ)I + γζSζ

(25)

in which γζ is a function of x. That is, if at time t the state is X(t) = x and the input ζt = ζ, then
once again a weighted coin is ﬂipped, but with probability of success equal to γζ(x). Conditioned
on success, a transition is made to state x(cid:48) with probability Sζ(x, x(cid:48)).

In some cases it is convenient to ﬁx the statistics of the sampling process, and transform S0 using
any of the design techniques described in the previous subsections. Once the family of transition

matrices {Sζ : ζ ∈ R} is constructed, we then deﬁne

Pζ = (1 − γ)I + γSζ
Each approach is illustrated through examples in Section 4.

(26)

3 Linearized Mean-Field Model

In this section we describe structure for the linearized model in full generality. We consider a general
family of transition matrices of the form (4), maintaining the assumption that hζ is continuously
diﬀerentiable in ζ, and that P0 is irreducible and aperiodic.

10

3.1 Transfer function

Representations of the transfer function for the linearization require a bit more notation. We denote

(cid:101)U ζ = U− ¯U ζ, with ¯U ζ = πζ(U). The derivative of the transition matrix is also a d×d matrix, denoted

Eζ =

d
dζ

Pζ

A simple representation for this matrix is obtained in Prop. 3.1, in terms of the function,

(cid:48)
Hζ(x, x

) = d

(cid:48)
dζ hζ (x, x

),

(cid:48)

x, x

∈ X.

(27)

(28)

The invariant pmf πζ for Pζ is regarded as the equilibrium state for the mean-ﬁeld model
(1), with respect to the constant input value ζt ≡ ζ. The linearization about this equilibrium is
described in Prop. 3.1. The proof is omitted since it is minor generalization of [4, Prop. 2.4].

Proposition 3.1. The linearization of (1) at a particular value ζ is the state space model with
transfer function,

in which A = P T

ζ , Ci = (cid:101)U ζ(xi) for each i, and

Gζ(z) = C[Iz − A]

−1B

(cid:88)

x

Bi =

πζ(x)Eζ(x, xi),

1 ≤ i ≤ d

(29)

(30)

Another representation of B is obtained based on the product P

(cid:79)
ζ = P

(cid:30)
ζ Pζ, where P

(cid:30)
ζ denotes

the adjoint of Pζ.

Proposition 3.2. The derivative of the transition matrix can be expressed in terms of the function
(28):

where PζHζ (x) = (cid:80)

Eζ(x, x(cid:48))
Pζ(x, x(cid:48))

(cid:48)
= Hζ(x, x

x(cid:48) Pζ(x, x(cid:48))Hζ(x, x(cid:48)) for x ∈ X.

independent of x, the entries of the vector B can be expressed,

) − PζHζ (x)

(31)
In the special case in which Hζ(x, x(cid:48)) is

Proof. For each x, x(cid:48),

Bi = πζ(xi)[Hζ(xi) − P

(cid:79)
ζ Hζ (xi)]

(cid:48)
d
dζ log(Pζ(x, x

(cid:48)
)) = Hζ(x, x

) − d

dζ Λhζ (x)

(32)

dζ hζ. The derivative is computed using (5), giving

where we have used the deﬁnition Hζ = d
d
dζ Λhζ (x) =

(cid:16)(cid:88)

x(cid:48)

= d

dζ log

) exp(cid:0)hζ(x, x

)(cid:1)(cid:17)
) exp(cid:0)hζ(x, x

(cid:48)
P0(x, x

(cid:48)

(cid:48)
P0(x, x

(cid:88)

)(cid:1)Hζ(x, x

(cid:48)

)

(cid:48)

= exp(−Λhζ (x))

x(cid:48)

=

(cid:48)
Pζ(x, x

(cid:48)
)Hζ(x, x

(cid:88)

x(cid:48)

)

11

which implies (31). If Hζ depends only on x(cid:48) then,

We can write πζ(x)Pζ(x, xi) = πζ(xi)P

(cid:88)

x

Bi =

(cid:88)

x

πζ(x)Pζ(x, xi)[Hζ(xi) − PζHζ (x)]
(cid:30)
ζ (xi, x) to obtain

Bi =

(cid:30)

πζ(xi)P

(xi, x)[Hζ(xi) − PζHζ (x)]

= πζ(xi)Hζ(xi) − πζ(xi)

(cid:30)

P

(xi, x)[PζHζ (x)]

(cid:88)

x

(cid:117)(cid:116)

3.2 Power spectral density and the positive real condition

In [10] the transfer function (3) was considered for a linearized mean-ﬁeld model in continuous
time. A representation of this transfer function used in this prior work admits a counterpart in the
discrete-time setting.

The inﬁnite series on the right hand side of (3) suggests that we require a probabilistic inter-
pretation of the scalar CAkB, where (A, B, C) are given in Prop. 3.1. This is achieved on deﬁning

(cid:101)U Bζ (xi) = Bi/πζ(xi) for each i; this is a function on X whose mean is zero: 0 =(cid:80)

x πζ(x)(cid:101)U Bζ (x).

Lemma 3.3. Let X denote a stationary realization of the Markov chain with transition matrix Pζ,
so that in particular, X(k) ∼ πζ for each k. Then,

CAkB = E[(cid:101)U Bζ (X(0))(cid:101)U ζ(X(k))]

Proof. We have by deﬁnition, CAkB = BTP k

(cid:88)

BTP k

ζ C T =

ζ C T, which can be expressed as the sum,

πζ(xi)(cid:101)U Bζ (xi)P k

ζ (xi, xj)(cid:101)U ζ(xj)

This is equivalent to (33).

i,j

(33)

(cid:117)(cid:116)

With these identities in place we are ready to prove the passivity bound in Theorem 2.3.

Proof of Theorem 2.3 In the SPD solution without probabilistic constraints, it follows from

the design rule (20) and the representation for the vector B in (32) that (cid:101)U Bζ = (cid:101)U ζ. Lemma 3.3

gives the covariance interpretation,

CAkB = E[(cid:101)U(X(0))(cid:101)U(X(k))]
∞(cid:88)

Let S+(θ) denote the power spectral density,

E[(cid:101)U(X(0))(cid:101)U(X(k))][ejkθ + e
ζ = E[(cid:101)U(X(0))2]. The bound thus follows from the deﬁnitions:

S+(θ) = σ2

ζ +

k=1

−jkθ]

where σ2

G+

ζ (ejθ) + G+

ζ (e

−jθ) = S+(θ) + σ2

ζ ≥ σ2

ζ

12

4 Examples

4.1 Rational pools

The load in this case is a pool pump used to maintain water quality in a residential pool. The
pump is assumed to consume 1 kW of power when operating. In the nominal model it is assumed
that it runs for between 8 and 14 hours per day. In the original model of [4], the state space was
taken to be the ﬁnite set,

(34)
where I > 1 is an integer. For the ith load, if X(t)i = (⊕, k), this means that the pool pump is on
at time t, and has remained on for the past k time units.

X = {(m, k) : m ∈ {⊕,(cid:9)}, k ∈ {1, . . . ,I}}

Figure 4: State transition diagram for pool pump model.

In this paper we take the same state space, but with a diﬀerent interpretation of each state:
Here as in [5] we employ geometric sampling, so that the nominal state transition matrix is of the
form (24). The state transition diagram for P0 is shown in Figf:ppp.

In the experiments that follow, the transition matrix S0 is the model with 12-hour cleaning
cycle from [4], in which I = 48, and hence d = |X| = 96. It is assumed that the BA sends a signal
every ﬁve minutes, and that the geometric sampling parameter is γ = 1/6. Consequently, the state
of each load changes every 30 minutes on average.

Figure 5: H0 = H(P0) in three designs for the pool pump model.

(cid:79)
0 is irreducible, but S

(cid:79)
0 := S

only on its second variable: H(x, x(cid:48)) = H(x(cid:48)) for all (x, x(cid:48)).

There is no need to model uncertainty from nature. Hence the function H = H(P ) will depend
In each of these experiments the nominal transition matrix P0 was taken as an input to the
algorithm, and not S0. The resulting transition matrix Pζ is of the form given in (25), in which the
sampling rate is state-dependent for non-zero ζ. For the SPD solution it was necessary to use P0
(cid:30)
0S0 is not
as the input: It can be shown that the transition matrix P
irreducible in this example. Recall from Theorem 2.3 that irreducibility is required to ensure the
existence of the SPD solution.

Fig. 5 shows the function H0 = H(P0) obtained in three sets of experiments. The normalization
in the myopic design uses H0 = 30(U − 1/2). This is equivalent to using U since adding a constant

13

12...On12...I−1III−1. . .. . .24 Hours24 HoursPool OnPool O(cid:31)xOptPassiveMyopicH(x)0-60-40-200204060does not impact Rζ, and the multiplication by 30 only scales ζ. A comparison of the three transfer
functions G+ obtained through a linearization at ζ = 0 is shown in Fig. 6. The myopic design
appears to be preferable to the two others: in particular, the phase plot stays nearest to zero in
this design.

Figure 6: Bode plots obtained from three designs for the pool pump model.

One drawback with the myopic design is that we have no basis for analysis. Diﬃculties are also
observed in numerical experiments if we allow |ζ| to take on values far from zero. Of the three
designs, the IPD is found to be the most numerically stable in all of the experiments considered,
in the sense that the dynamics change predictably with ζ, and the linearization about each value
of ζ are nearly the same for a large range of ζ.

In the next subsection we move to a diﬀerent class of loads in which we cannot ignore exogenous
randomness. We consider in greater depth the diﬀerence between the myopic and IPD outcomes
for a wider range of ζ. It is found again that the two designs are very similar locally (for ζ ∼ 0),
but the myopic design is numerically unstable for ζ outside of a small neighborhood of the origin.

4.2 Thermostatically controlled loads

A thermostatically controlled load (TCL) such as a water heater, refrigerator, or air-conditioner
is a device for which temperature control is achieved using a dead-band. It is assumed here that
power consumption takes just two values (on or oﬀ). To simplify discussion, attention is directed
to a cooling device, such as a residential refrigerator.

We begin with a noise free model, described as the controlled linear system,

Θ(k + 1) = Θ(k) + (1 − )(Θa − Θ(k) − m(k)Θg),

(35)

where m(k) = 1 or 0 indicates if the unit is on or oﬀ, Θa is ambient temperature,  depends on the
dynamics of the load, and Θg the depends on the physics of the device. One example considered
in [15] is an air conditioner for which Θg = RPtrans = 2 × 14 = 28 (this and other parameters are
summarized in Table 1).
A signal from the BA is broadcast at 20 second intervals. The parameter  is obtained based on
this sampling time, and the product of thermal resistance and capacitance:  = exp[−20/(RC)],
with RC also in units of seconds. The value RC = 4 obtained from Table 1 is in units of hours —
on scaling to seconds we obtain,

−h/(RC) = e

 = e

−20/(4×602) = e

−1/720 ≈ 1 − 1/720

14

Magnitude (dB)-20-10010203010Phase (deg)-90-45045Bode DiagramOptPassiveMyopicFrequency  (rad/s)10-5-67.3×10-510-410-3Parameter Meaning

Θset

[Θmin, Θmax]

Θa
R
C

Ptrans

set temperature set-point
temperature dead-band
ambient temperature
thermal resistance
thermal capacitance
energy transfer rate

Value
20◦C
20 ± 0.5◦C
32◦C
2◦C/kW
2 kWh/◦C
14 kW

Table 1: Homogeneous air conditioner parameters — mean data from Table 4.1 of [15].

This model is based on the physics of heating and cooling, but the dynamics are accurately

captured by a constant drift model:

Θ(k + 1) = Θ(k) − m(k)δ− + (1 − m(k))δ+

(36)

With drift parameters δ± carefully chosen, the behavior of the two models is barely distinguishable.

The deterministic model (36) is the basis of a stochastic model,

Θ(k + 1) = Θ(k) − m(k)δ− + (1 − m(k))δ+ + ∆(k + 1)

(37)

in which ∆ is a zero-mean, i.i.d. sequence. In the experiments that follow the sampling time was
taken to be 2 seconds, and ∆ was taken to be Gaussian with variance 10−6 (the small variance is
justiﬁed with this fast sampling rate).

Figure 7: State transition diagram for a TCL providing cooling.

A Markov chain model can be constructed with state X(k) = (m(k), Xn(k)) evolving on X =
Xu × Xn, where Xn(k) = Θ(k) and Xu = {(cid:9),⊕}; the interpretation is the same as in the pool
ﬁltration model, with the interpretation m(k) = ⊕ is the same as m(k) = 1 in (37). Temperatures
are restricted to a lattice to obtain a ﬁnite state-space Markov chain. To obtain d states, assume
that d ≥ 4 is an even number, and discretize the interval [Θmin, Θmax] into d/2 values as follows:
Xn = {Θmin + kT∆ : 0 ≤ k ≤ d/2 − 1}, in which the increments in the lattice are T∆ = (Θmax −
Θmin)/(d/2 − 1).
A nominal randomized policy for m deﬁnes the transition matrix R0. Following the notation
of [4], the nominal transition matrix for m is deﬁned by

(cid:40)
1 − p(cid:9)(xn) x = (⊕, xn)
(cid:40)
p⊕(xn)
x = ((cid:9), xn)
p(cid:9)(xn)
x = (⊕, xn)
1 − p⊕(xn) x = ((cid:9), xn)

R0(x,⊕) =

R0(x,(cid:9)) =

15

As in [4], the deﬁnition of p(cid:9) is based on the speciﬁcation of a cumulative distribution function
F (cid:9) deﬁned on the interval [Θmin, Θmax]. This CDF is meant to model the statistics of the time

(38)

Unit onUnit o(cid:31)ΘminΘ1Θm-1Θ2Θmax......interval during which the unit is oﬀ, for the model with continuous state space. We deﬁne p(cid:9)(xn) =
1 for xn = Θmax, p(cid:9)(xn) = F (cid:9)(xn) for xn = Θmin, and for all other values,

(cid:9)

p

(xn) = [F

(cid:9)

(cid:9)

(xn) − F

(xn − T∆)]/[1 − F

(xn − T∆)]

(cid:9)

In the experiments that follow, the general form taken for F (cid:9) was chosen in the parameterized

family,

(cid:9)

F

(xn) = exp(−(Θmax − xn)ρ/(2σρ)), Θmin ≤ xn ≤ Θmax,

with σ, ρ > 0. The values T∆ = 0.05, σ = 0.02 and ρ = 0.75 were used for p(cid:9) and p⊕ in the
experiments surveyed here.

Figure 8: Trajectory of TCL model with geometric sampling γ = 1/3.

In addition, geometric sampling was applied: a family of models of the form (26) was con-
structed, in which R0 was used to deﬁne S0 in (24). The construction of a model of this form
requires a diﬀerent interpretation of the nature component of the state X n.

To obtain dynamics of the form (24), let {τk} denote the discrete renewal process in which

τ0 = 0 and {∆k = τk − τk−1 : k ≥ 1} is i.i.d., with a geometric marginal:

P{∆k > n} = γn,

n ≥ 0, k ≥ 1.

The nature component of the state is constant on each discrete-time interval (t : τk ≤ t < τk+1), with
Xn(t) = Θ(τk) on this interval. Given a nominal randomized policy for the input process X u = m,
the nominal transition matrix Q0 can be estimated via Monte-Carlo based on a simulation of (37),
or from measurements of an actual TCL.

A Markov model with this transition matrix would also require m(t) constant on each of the
intervals (t : τk ≤ t < τk+1), k ≥ 0. In simulations this constraint was violated occasionally since
m(t) = 1 when Θ(t) > Θmax, and m(t) = 0 when Θ(t) < Θmin. This leads to modeling error that
is small, provided γ is not too close to unity. Fig. 8 shows an example of the evolution of X n
with γ = 1/3. The temperature never violates the dead-band constraint because of the constraints
imposed on X u.

(cid:30)
0S0 is irreducible, so that the SPD solution is
computable. Because of exogenous randomness, there is no motivation for this approach: Theo-
rem 2.3 guarantees a passive linearization only when P0 = R0. Moreover, numerical results using
this method were not encouraging: The resulting family of transition matrices {Pζ} is extremely
sensitive to ζ.
The linearization about ζ = 0 for the myopic design was similar to the IPD solution, but as

In this example the transition matrix S

(cid:79)
0 := S

seen in Figs. 9a and 9b, the behaviors quickly diverge for values beyond |ζ| = 3.
In conclusion, although the transfer functions for the linearizations at ζ = 0 are nearly identical,
in the myopic design the input-output behavior is unpredictable for |ζ| > 3. The input-output
behavior for IPD is much closer to a linear system for a wider range of ζ. This is consistent with
results from prior research [2, 4, 5].

16

t (min)temp (C)02040608010012014016018019.52020.5m(t)=1Xn(t)(a) IPD Design

(b) Myopic Design

Figure 9: Bode plots for two designs, based on linearizations at ﬁve values of ζ. Bode plots for the myopic design are less
reliable for |ζ| > 3.

5 Conclusions

This paper has developed new approaches to distributed control for demand dispatch. There is
much more work to do on algorithm design, and large-scale testing.

References

[1] P. Barooah, A. Buˇsi´c, and S. Meyn, “Spectral decomposition of demand-side ﬂexibility for reli-
able ancillary services in a smart grid,” in Proc. 48th Annual Hawaii International Conference
on System Sciences (HICSS), Kauai, Hawaii, 2015, pp. 2700–2709.

[2] Y. Chen, A. Buˇsi´c, and S. Meyn, “Individual risk in mean-ﬁeld control models for decentral-
ized control, with application to automated demand response,” in Proc. of the 53rd IEEE
Conference on Decision and Control, Dec. 2014, pp. 6425–6432.

[3] H. Hao, Y. Lin, A. Kowli, P. Barooah, and S. Meyn, “Ancillary service to the grid through
control of fans in commercial building HVAC systems,” IEEE Trans. on Smart Grid, vol. 5,
no. 4, pp. 2066–2074, July 2014.

[4] S. Meyn, P. Barooah, A. Buˇsi´c, Y. Chen, and J. Ehren, “Ancillary service to the grid using
intelligent deferrable loads,” IEEE Trans. Automat. Control, vol. 60, no. 11, pp. 2847–2862,
Nov 2015.

[5] Y. Chen, A. Buˇsi´c, and S. Meyn, “State estimation for the individual and the population
in mean ﬁeld control with application to demand dispatch,” CoRR and to appear, IEEE
Transactions on Auto. Control, 2015. [Online]. Available: http://arxiv.org/abs/1504.00088v1

[6] S. Meyn, P. Barooah, A. Buˇsi´c, and J. Ehren, “Ancillary service to the grid from deferrable
loads: The case for intelligent pool pumps in Florida,” in Proceedings of the 52nd IEEE Conf.
on Decision and Control, Dec 2013, pp. 6946–6953.

[7] J. Mathieu, S. Koch, and D. Callaway, “State estimation and control of electric loads to manage
real-time energy imbalance,” IEEE Trans. Power Systems, vol. 28, no. 1, pp. 430–440, 2013.

17

Magnitude (dB)-50-45-40-35-30-25-2010-410-310-210-1Phase (deg)-180-135-90-4504590Frequency  (rad/s)IPD-32.9 10 ζ = -6ζ = -3ζ = 0ζ = 3ζ = 6Magnitude (dB)-50-45-40-35-30-25-20-15-1010-410-310-210-1Phase (deg)-180-135-90-4504590Myopicζ = -6ζ = -3ζ = 0ζ = 3ζ = 6-32.9 10 Frequency  (rad/s)[8] B. Sanandaji, H. Hao, and K. Poolla, “Fast regulation service provision via aggregation of ther-
mostatically controlled loads,” in 47th Hawaii International Conference on System Sciences
(HICSS), Jan 2014, pp. 2388–2397.

[9] B. Biegel, L. Hansen, P. Andersen, and J. Stoustrup, “Primary control by ON/OFF demand-

side devices,” IEEE Trans. on Smart Grid, vol. 4, no. 4, pp. 2061–2071, Dec 2013.

[10] A. Buˇsi´c and S. Meyn, “Passive dynamics in mean ﬁeld control,” in Proc. 53rd IEEE Confer-

ence on Decision and Control, Dec 2014, pp. 2716–2721.

[11] E. Todorov, “Linearly-solvable Markov decision problems,” in Advances in Neural Information
Processing Systems 19, B. Sch¨olkopf, J. Platt, and T. Hoﬀman, Eds. Cambridge, MA: MIT
Press, 2007, pp. 1369–1376.

[12] P. Guan, M. Raginsky, and R. Willett, “Online Markov decision processes with Kullback-
Leibler control cost,” IEEE Trans. Automat. Control, vol. 59, no. 6, pp. 1423–1438, June
2014.

[13] S. P. Meyn and R. L. Tweedie, Markov chains and stochastic stability, 2nd ed. Cambridge:
Cambridge University Press, 2009, published in the Cambridge Mathematical Library. 1993
edition online.

[14] A. Buˇsi´c and S. Meyn, “Respecting nature and nurture in Markov Decision Processes with

Kullback–Leibler control cost,” 2015, In preparation.

[15] J. Mathieu, “Modeling, analysis, and control of demand response resources,” Ph.D. disserta-

tion, University of California at Berkeley, 2012.

18

