Molecular MIMO: From Theory to Prototype

Bon-Hong Koo, Student Member, IEEE, Changmin Lee, Student Member, IEEE,

H. Birkan Yilmaz, Member, IEEE, Nariman Farsad, Member, IEEE, Andrew Eckford, Senior Member, IEEE, and

Chan-Byoung Chae, Senior Member, IEEE

1

6
1
0
2

 
r
a

 

M
2
1

 
 
]
T
E
.
s
c
[
 
 

1
v
1
2
9
3
0

.

3
0
6
1
:
v
i
X
r
a

Abstract—In diffusion-based molecular communication,

in-
formation transport is governed by diffusion through a ﬂuid
medium. The achievable data rates for these channels are very
low compared to the radio-based communication system, since
diffusion can be a slow process. To improve the data rate, a
novel multiple-input multiple-output (MIMO) design for molec-
ular communication is proposed that utilizes multiple molecular
emitters at the transmitter and multiple molecular detectors
at the receiver (in RF communication these all correspond to
antennas). Using particle-based simulators, the channel’s impulse
response is obtained and mathematically modeled. These models
are then used to determine inter-link interference (ILI) and inter-
symbol interference (ISI). It is assumed that when the receiver
has incomplete information regarding the system and the channel
state, low complexity symbol detection methods are preferred
since the receiver is small and simple. Thus four detection
algorithms are proposed—adaptive thresholding, practical zero
forcing with channel models excluding/including the ILI and
ISI, and Genie-aided zero forcing. The proposed algorithms are
evaluated extensively using numerical and analytical evaluations.

Index Terms—molecular

diffusion,
multiple-input multiple-output, interference, Brownian motion,
3-D simulation,
algorithm, molecular
communication testbed.

communication

via

symbol

detection

I. INTRODUCTION

T INY devices that exhibit strong cooperation via com-

munication on a small scale are capable of having an
impact at the macro-scale. In fact, communication on a small
scale (micro and possibly nano) is at a critical juncture, where
there is a need to engineer communication systems at these
scales [1]. A new paradigm called nanonetworking, focuses
on this problem. At the micro and nano scale, electromagnetic
communication is challenging because of constraints such as
the ratio of the antenna size to the wavelength of the elec-
tromagnetic signal [1]–[3]. Thus taking their cue from nature,
researchers have focused their attention on molecular commu-
nication where information is carried through chemical signals
[4]–[7]. In the literature, numerous molecular communication

B. Koo, C. Lee, H. B. Yilmaz and C.-B. Chae (Corresponding Author)
are with the Yonsei Institute of Convergence Technology, School of Inte-
grated Technology, Yonsei University, Korea. Email: {harpeng7675, cm.lee,
birkan.yilmaz, cbchae}@yonsei.ac.kr. N. Farsad is with Stanford University,
USA. Email: nfarsad@stanford.edu. A. Eckford are with the Department
of Electrical and Computer Science, York University, Canada. Email: aeck-
ford@cse.yorku.ca.

This research was supported in part by the MSIP (Ministry of Science, ICT
and Future Planning), Korea, under the “IT Consilience Creative Program”
(IITP- 2015-R0346-15-1008) supervised by the IITP (Institute for Informa-
tion & Communications Technology Promotion) and by the Basic Science
Research Program (2014R1A1A1002186) funded by the Ministry of Science,
ICT and Future Planning (MSIP), Korea, through the National Research
Foundation of Korea.

Full demo video is available at http://www.cbchae.org/.

systems have been proposed: molecular communication via
diffusion (MCvD) (such as calcium and pheromone signal-
ing), motor proteins motility over microtubules, microtubule
motility over stationary motor proteins, and bacterium-based
communication [1], [7]–[9].

An MCvD system consists of three main components: a
transmitter, a ﬂuid environment between the transmitter and
the receiver, and a receiver. The transmitter and the receiver
must have at least one antenna1 to send and receive chemical
signals. To convey information, a transmitter node emits
molecules into the medium via its transmit antennas. The
emitted molecules then propagate through the environment
according to the physical characteristics of the medium and
molecules. The propagation is generally considered to be
restricted to diffusion, unless, as in [10], [11], the environment
has ﬂow. Some of the propagating molecules arrive at the
receive antenna or antennas where they trigger a reception
process. A macro-scale counterpart
to such a system was
introduced by Farsad et al. in [12] as a tabletop testbed,
and the nonlinearity in the channel was modeled as Gaussian
noise [13].

Some of the system models in the literature, assume that
molecules are removed from the environment after hitting
the receive antenna [10], [14]. This can be modeled as the
ﬁrst-hitting process. The ﬁrst-hitting process dictates that
each molecule can contribute to the signal only once. On
the other hand, some models omit the ﬁrst-hitting process,
allowing molecules to pass through the receive antenna with
no alteration to the movement dynamics (i.e., the molecules
can go inside and out of the receiver antenna multiple time)
[15]–[17]. Furthermore, analytical models were developed for
arrival, receptor dynamics, degradation, and noise [17]–[21].
From a communications perspective, the fundamental pro-
cesses of an MCvD system are modulation, emission, signal
propagation, reception, and demodulation. A circuit-based
model of the system was introduced in [22]. In the literature,
information is modulated on various aspects of the messenger
molecules, such as molecule concentration, molecule identity,
concentration ratio, and signal frequency [6], [10], [23], [24].
The main challenge, researchers have pointed out,
is the
heavy tail nature of the molecular signal that causes severe
inter-symbol interference (ISI) and the slow propagation [17],
[25]. To increase MCvD performance, the literature suggests
many enhancements. These include incorporating ISI mitiga-
tion techniques, multiple molecule types, enzymes to reduce

1The term ‘antenna’ we use in this paper can physically be a bulge. In
Fig. 1, bulges are presented as the extensions from the transmitter and the
receiver node for interacting with the physical environment,and represent the
molecular emitters and detector.

2

ISI, protrusions to increase reception probability, and pre-
equalization methods [11], [17], [24]–[28].

The present capabilities of molecular communications are
rather primitive. Indeed, the world’s ﬁrst artiﬁcially engineered
molecular communication (even with drift) introduced in [12],
[13] has a chemical efﬁciency of 0.3 bits/s/chemical over a
free-space distance of a few meters. For commercial appli-
cations, such a rate might be too slow. A good candidate
for resolving this problem is the utilizing of the multiple-
input multiple-output (MIMO) technique [29]. The authors
in [29], however, mainly focused on multiuser interference
and assumed ISI to be negligible (i.e., the authors paid little
attention to ISI in the system model).

Therefore, we introduce a MIMO system model that in-
cludes ISI and inter-link interference (ILI) and the detection
algorithms speciﬁc to molecular MIMO systems. To the best of
our knowledge, this is the ﬁrst work that analytically considers
ISI and ILI for a molecular MIMO system. Its novelty goes
beyond the SISO work in that
the presence of additional
antennas that interfere with each other brings about the need
for a new channel model. To demonstrate the practicality of
our models, we also present measurement results via a novel
tabletop testbed.

We ﬁrst model the channel’s impulse response by using
a channel function similar to the single-input single-output
(SISO) system. By utilizing the developed MIMO simulator,
we model the channel and obtain the parameters of the modi-
ﬁed channel impulse function.2 Consequently, in a molecular
MIMO system, we utilize the channel model to model the ILI
that originates from the other antenna at the current symbol
slot and the ISI from previous emissions. The Brownian
motion of individual molecules was simulated to generate the
channel statistics, and then these statistics were used when
simulating the detection algorithms. We analyze the system
performance in terms of bit error rate (BER) and channel
model via signal distributions. For this work, we chose to
focus on an 2× 2 molecular MIMO system. However, similar
analysis can be applied to an M ×N molecular MIMO system
with appropriate channel modeling.

The main contributions of this paper are as follows:
• Modeling MIMO Systems: We model molecular MIMO
systems that consider ISI and ILI by utilizing the channel
response function.

• Formulating ISI and ILI: We derive formulations for

ISI and ILI.

• Molecular MIMO Signal Detection Algorithms: Uti-
lizing a single type of molecule, we propose detection
algorithms speciﬁc to molecular MIMO systems and
analyze the performance in terms of bit error rate (BER).
• Tabletop Molecular MIMO Testbed: We implement
our proposed algorithms on our macro-scale tabletop
molecular MIMO testbed and perform measurements to
evaluate the system’s performance.

The rest of this paper is organized as follows. In Sec-
tion II, we describe the system model, including topology,

2The fully-featured 3-D molecular MIMO simulator

http://www.cbchae.org/.

is available at

Fig. 1. Topological model of a molecular 2×2 MIMO system. The modulation
process individually modulates the information on to a physical property
of the messenger molecules. On the other hand, the demodulation process
demodulates the received signal separately.

propagation, and communication model. In Section III, we
detail the channel estimation method with channel modeling.
Section IV presents the theoretical analysis of the proposed
system. Hardware realizations of the theoretical works are
covered in Section VI. Section V shows the numerical results
and Section VII presents our conclusions.

II. SYSTEM MODEL

The molecular communication system considered in this
paper is a 3-D environment with two point sources and two
spherical receive antennas. The transmitter releases a certain
number of messenger molecules at once without a biased
direction. The emitted molecules travel via diffusion inside
the ﬂuid medium. We ignore the effect of collisions among
diffusing molecules and assume that the enzymatic reaction is
treated as an additive noise in the theoretical analysis. When a
molecule hits the boundary of one of the spherical antennas, it
is immediately absorbed by the receiving antenna and removed
from the medium. We assume that the transmitter-receiver pair
has synchronized symbol slots and the receiver can, during a
symbol slot, count the number of received molecules.

During communications, the transmit antennas convey in-
dependent messages to their corresponding receive antennas.
Both links of the molecular MIMO system use the same type
of molecule. Hence the molecules from the other transmit
antenna may cause ILI.

A. Topology and Propagation Model

As shown in Fig. 1,

there are two point antennas Tx1
and Tx2 at transmitter Tx, placed d distance apart from the
corresponding spherical antennas Rx1 and Rx2 at the receiver
Rx. The two receive antennas have the same radius rr, and
are placed h distance apart. Their centers and those of the
transmit antennas form a rectangle on a plane. The spherical
antennas are attached to the receiver body and we assume
that just the antennas are capable of receiving molecules, a
tenable assumption given the many examples found in nature.
For example, epithelial cells, neurons, and migrating cells
are polarized cells having heterogeneous receptor deployments

Tx1Rx1Tx2:Demod.Mod.Data𝑡𝑠𝑡𝑠DataTx1Tx2Rx1Rx2[30], an adaptation to the environment and the signaling mech-
anism. After the reception, the receiver demodulates the signal
using a corresponding algorithm. The candidate algorithms are
presented in Section III-B. The transceiver pair is assumed to
have synchronized time duration between consecutive symbols
denoted by ts. Many examples of synchronization among bac-
teria are observed in nature and inspired from it. For example,
a simple synchronization algorithm for communicating pairs
was proposed in [31].

When a molecule is released from a point source,

its
movement in a ﬂuid is governed by diffusion and drift (drift
is applicable if there is a ﬂow). The dynamics of diffusion
can be described by Brownian motion. The expected fraction
of absorbed molecules with respect to time, F (t|rr, d, D), is
derived in [14] when the receiver is a spherical body and
the transmitter is a point source in a 3-D environment. The
derived formula determines the expected number of hitting
molecules and hence the channel characteristics. The formula
is as follows:

(cid:19)

(cid:18) d√

4Dt

F (t|rr, d, D) =

rr

rr + d

erfc

(1)

where D denotes the diffusion coefﬁcient. The two receive
antennas in our setup, however, prevent the direct use of (1)
since hitting Rx1 and Rx2 become dependent events. The
closed form expression for the MIMO setup is still an open
problem. Therefore, for channel modeling, we simulate the
movement of released particles within the given MIMO setup
by using

(xt, yt, zt) = (xt−∆t, yt−∆t, zt−∆t) + (∆x, ∆y, ∆z),

∆x ∼ N (0, 2D∆t),
∆y ∼ N (0, 2D∆t),
∆z ∼ N (0, 2D∆t)

(2)

where xt, yt, zt, ∆t, and N (µ, σ2) are the particles’ positions
at each dimension at time t, the simulation time step, and
the normal distribution with mean µ and variance σ2. The
Brownian motion simulator for the MIMO setup is a modiﬁed
version of the simulator that was developed for a SISO case
in [24]. During its trip, if a molecule hits one of the spherical
receive antennas, then it is absorbed and removed from the
environment. A molecule can contribute to the signal just once
and we have four different F (t|rr, d, D) values depending on
the molecule’s emission source and hitting antenna. We use
the simulation data to formulate F (t|rr, d, D) for the 2×2
molecular MIMO setup and utilize it for the analysis. Note that
we have two different F (t|rr, d, D) values due to symmetry,
which enables us to combine equivalent ones to have better
estimates from simulation data.

B. Communication Model

Each receive antenna has the closer transmit antenna as
its pair source of communication, while the other transmit
antenna becomes a non-pair source. To encode information, we
use the binary concentration shift keying (BCSK) modulation
technique [6]. We denote Q1 and Q0 as the number of
molecules released to send bit-1 and bit-0. In this paper, the

3

transmitter sets Q0 as zero to reduce the energy consumption
and separate, as much as possible, the signal amplitudes. The
transmitter has independent sets of bits x1 and x2 for their
own messages. During the mth symbol, Tx1 and Tx2 send
x1[m] and x2[m] each by releasing Q1 · x1[m] and Q1 · x2[m]
molecules at the start of the symbol time, and wait until
the next emission time. This representation is valid for both
xi[m] = 0 and xi[m] = 1, since Q0 = 0. The number
of molecules absorbed at
the receiver follows a binomial
distribution with a hitting probability, which is related to ts,
d, rr, and D [7]. We deﬁne Fij(t1, t2) as the probability of
a molecule hitting Rxi when the molecule is released from a
Txj between time t1 and t2 after the transmission. So we can
deﬁne the random variable Sij(t1, t2) as follows:

Sij(t1, t2) (cid:44) B (Q1, Fij(t1, t2)) ,

(3)
where B(N, p) denotes a binomial random variable with N
trials and success probability p. Sij is utilized while evaluating
the number of received molecules at Rxi that originates from
Txj.

The number of molecules received by Rxi during the mth
time slot
is denoted by yRxi[m]. The received molecules
are composed of molecules emitted from the two transmit
antennas, at the current and the previous symbol slots. yRxi[m]
can be expressed as the sum of the number of molecules
released from 1) the pair source at the current symbol slot,
2) the pair source at previous symbol slots, 3) the non-pair
source at the current symbol slot, and 4) the non-pair source
at the previous symbol slots. Considering the events of false-
capture or mis-capture3 by the receiver that affects the number
of receptions at Rxi, we add the noise term ni[m] which is
commonly assumed to be a normal distribution N (0, σ2
n). It
should be noted that the added noise term is not the diffusion
noise and in our model the random variables Sij include the
randomness of the diffusion.

To simplify the modeling, we denote Sij[k] as follows:

Sij[k] (cid:44) Sij(kts, (k + 1)ts)

(4)

to indicate the probability of a molecule emitted from a
transmitter being captured by the receiver during the kth time
slots after the emission. In the representation, k = 0 indicates
the case where molecules came from the current symbol, while
adding all the cases of k > 0 indicates the case of molecules
from past symbols. i = j indicates the case of molecules from
the corresponding antenna, while i (cid:54)= j indicates the molecules
from the other link. In our conﬁguration of a 2× 2 MIMO
system, i and j can be either 1 or 2. As a result, yRxi[m]
yields (5) provided that i (cid:54)= j holds. We present (5) at the top
of the next page.

We write (5) in matrix form for each symbol slot in two
different forms by excluding and including the ILI term in the
channel matrix. The channel model excluding ILI for a 2 × 2

3The false-capture indicates a positive noise that can be occurred by the
invasion of outer molecules, which are indistinguishable from the target
molecules by the receiver. The mis-capture indicates a negative noise in case
of molecular decomposition.

4

(cid:125)
yRxi[m] = Sii[0] · xi[m]

(cid:123)(cid:122)

(cid:124)

desired signal

+Sij[0] · xj[m]

(cid:124)

(cid:123)(cid:122)

ILI


(cid:125)

(cid:124)(cid:123)(cid:122)(cid:125)

+ ni[m]

noise

.

(5)

(cid:125)

Sii[k] · xi[m − k]
(cid:125)
(cid:124)
(cid:123)(cid:122)

(cid:123)(cid:122)

ISI from Txi

(cid:125)

m−1(cid:88)
(cid:124)

k=1

+

total ISI

(cid:124)

+Sij[k] · xj[m − k]

(cid:123)(cid:122)

ISI from Txj

MIMO system is given as:

(cid:20)yRx1

(cid:21)

yRx2

(cid:20)S11[0]

0

=

(cid:21)(cid:20)x1

x2

0

S22[0]

(cid:21)

+

(cid:20)ζ1 + I1

(cid:21)

ζ2 + I2

(6)

where ζi and Ii denote the ‘ILI’ term and sum of the
‘total ISI’ term and the ‘noise’ term respectively from the
formulation (5). Note that the model (6) still accounts for
the ILI term in the interference vector. The name ’excluding’
comes from the fact that the ILI term is excluded from the
channel matrix. We write (6) in short as

The channel model including the ILI in HHH in is given as:

(cid:20)yRx1

(cid:21)

yRx2

=

yyy = HHH exxxx + III ex.

(cid:20)S11[0] S12[0]

S21[0] S22[0]

(cid:21)(cid:20)x1

(cid:21)

+

x2

(cid:21)

(cid:20)I1

I2

and it is written in short as

yyy = HHH inxxx + III.

(7)

(8)

(9)

Fig. 2. Fraction of hitting molecules for SISO cases and ﬁtted fraction of
hitting molecules for MIMO cases with an example parameter set (D =
50 µm2/s, h = 1 µm, rr = 4 µm, ∆t = 0.001 s).

The details of III and III ex are presented in Section IV-A.

III. CHANNEL MODELING AND PROPOSED DETECTION

ALGORITHMS

In this section, we introduce our work to ﬁnd a formula
for the ﬁrst-hitting probability in the molecular MIMO setup
to formulate Fij(t). Extensive simulations were carried out
to understand the underlying model and we use nonlinear
curve ﬁtting on the simulation data. After obtaining the ﬁtted
cumulative distribution functions (CDFs) we carry out our an-
alytical derivations by utilizing approximated functions Fij(t).
We then present the proposed signal detection algorithms.

A. Channel Modeling

We use a model function that is similar to (1) for ﬁtting
the simulation data (i.e., the formula is similar with molecular
SISO in a 3-D environment with some control coefﬁcients).
A similar model function is used in [13] for modeling noise
effects in the SISO testbed and in [32] for modeling molecular
MIMO channel via simulations. Control coefﬁcients are se-
lected to comprehend the effect on amplitude that stems from
diffusion coefﬁcient and time. The model function structure
for nonlinear ﬁtting is as follows:

F model
ij

(t|rr, dij, D) =

b1 rr
dij +rr

erfc

dij

(4D)b2 tb3

(10)

where b1, b2, and b3 are ﬁtting variables and dij is the distance
between Txj and Rxi. We run extensive simulations for 32
different parameter sets and estimate the mean CDF of the
hitting molecules. In each simulation, 5000 molecules per

(cid:18)

(cid:19)

antenna are emitted and we carry out 500 simulations. In the
simulations, the hitting molecules are separated according to
where they originated for ﬁnding F11, F12, F21, and F22. Due
to the symmetry of the topology, F11 and F22 and similarly
F12 and F21 are very close to one another (so we assume
F11 = F22 and F12 = F21 due to symmetry). Also, note
that the distance between Tx1 and Rx2 is different from the
distance between Tx1 and Rx1. Therefore, the model function
utilizes the corresponding distances for Fij as follows

d11 = d22 = d,

d12 = d21 =(cid:112)(d + rr)2 + (2rr + h)2 − rr.

(11)

The estimated CDFs are obtained from the simulation
outputs by considering the histogram of the arriving molecules
up to a sufﬁcient time. We adopt 1.5 seconds which is enough
to observe the peak of the signal under the given parameters.
Starting from zero to the end of simulation time, we obtain
a fraction of arriving molecules. Note that this function is
monotonically increasing with time as expected from (10). To
ﬁt nonlinear regression models to simulation data, this study
uses the NonLinearModel class in MATLAB. We implement
the model function and utilize the simulation outputs to have
a closed form CDF estimation that obeys (10).

Fig. 2 shows the resulting signal function that deﬁnes the
received signal at the intended receiver as F11 and the ILI sig-
nal as F12 with the given parameters. Increasing the distance
results in shifting the peak amplitude time and reducing the
peak amplitude value. The ILI term is non-negligible, but the
distance has a more severe effect on the received signal.

Fig. 3 presents distance-versus-ﬁtted model variables for

00.10.20.30.40.50.60.70.800.511.5x 10−3Time (s)Fmodelij(t+∆t)−Fmodelij(t)  FSISO; d=4 µmF11; d=4 µmF12; d=4 µmFSISO; d=6 µmF11; d=6 µmF12; d=6 µm5

(a) Fitted values of b1 for F11

(b) Fitted values of b2 for F11

(c) Fitted values of b3 for F11

(d) Fitted values of b1 for F12

(e) Fitted values of b2 for F12

(f) Fitted values of b3 for F12

Fig. 3. Fitted model parameters of F11(t) and F12(t) for different h and rr values (D = 50 µm2/s).

different h and rr values. The ﬁrst and the second rows
correspond to F11 and F12 modeling, respectively. The values
of b2 and b3 change little when the distance is increased and,
similar to the SISO case, they are close to 0.55 (in [14], for
the SISO case b2 = b3 = 0.5). We also observe that rr is more
dominant than h.

After channel modeling, we can utilize the ﬁtted functions
for simulations that consider consecutive transmissions. To do
so, we ﬁrst need to evaluate the fraction of received molecules
for consecutive symbol slots. Depending on the symbol dura-
tion, we can evaluate the channel response for each symbol
slot. Fig. 4 depicts the fraction of received molecules for each
consecutive symbol slot. Increasing ts increases the amplitude
of the desired signal and reduces the ISI at
the cost of
increasing the ILI. Therefore, while determining thresholds,
the symbol duration should also be considered. If the detection
thresholds are not selected appropriately, then ILI may cause
bit-0 to be detected as bit-1 or vice versa, which also means
‘error’.

B. Detection Algorithms

In this section, we introduce ﬁve detection algorithms.
Each of them requires a different set of particular pieces
of information given to the receiver. Fig. 5 describes the
algorithms in terms of the information required. There is a
default set that is needed commonly for all the algorithms. The
default set consists of system parameters D, ts, and topology
parameters such as d, h, and rr. The ﬁrst algorithm, which
we name the ﬁxed threshold method works with only the
default set. It uses an empirical threshold and does not adapt
to varying symbol duration or the signal power. The other

Fig. 4. Fraction of hitting molecules for different symbol durations and the
cases Tx1/Tx2 to Rx1 via utilizing ﬁtted functions. Top plot contains regions
for the desired signal and ISI from Tx1. Bottom plot contains regions for ILI
and ISI from Tx2. (D = 50 µm2/s, h = 1 µm, rr = 4 µm).

23456780.40.50.60.70.80.91d (µm)b1 of F11  h=2 µm; rr=4 µmh=1 µm; rr=4 µmh=1 µm; rr=2 µm23456780.40.50.60.70.80.91d (µm)b2 of F11  h=2 µm; rr=4 µmh=1 µm; rr=4 µmh=1 µm; rr=2 µm23456780.40.50.60.70.80.91d (µm)b3 of F11  h=2 µm; rr=4 µmh=1 µm; rr=4 µmh=1 µm; rr=2 µm23456780.20.30.40.50.60.7d (µm)b1 of F12  h=2 µm; rr=4 µmh=1 µm; rr=4 µmh=1 µm; rr=2 µm23456780.40.50.60.70.80.91d (µm)b2 of F12  h=2 µm; rr=4 µmh=1 µm; rr=4 µmh=1 µm; rr=2 µm23456780.40.50.60.70.80.91d (µm)b3 of F12  h=2 µm; rr=4 µmh=1 µm; rr=4 µmh=1 µm; rr=2 µm123456700.050.10.150.20.25Symbol SlotFraction of Molecules (F11)  Desired SignalISI from Tx1ts=0.2 sts=0.3 sts=0.4 sts=0.5 s123456700.050.10.150.20.25Symbol SlotFraction of Molecules (F12)  ILI RegionISI from Tx2ts=0.2 sts=0.3 sts=0.4 sts=0.5 s6

acquire instantaneously.4

ˆyyyg = HHH

−1
in yyy = xxx + HHH in

−1III.

(15)

Our ﬁrst contribution lies in the proof that the adaptive
thresholding and the practical ZF with HHH ex methods perform
exactly the same for the symmetrical MIMO topology.
Theorem 1. When the centers of the transmitter and the
receive antennas form a rectangular grid, the detector outputs
of the adaptive thresholding and the practical ZF with HHH ex
methods satisfy ˆyyya = A0 ˆyyyex, where A0 denotes the probability
of a molecule hitting the intended antenna at the current
symbol duration.

Fig. 5. Representation of detection algorithms and their requirements.

Proof. See the Appendix A.

four algorithms exploit the statistical analysis of a channel in
contrast to the ﬁrst one. Two of them incorporate (6) and the
other two utilize (8).

The second algorithm, which uses the channel model (6),
is called adaptive thresholding. It additionally requires Q1,
which is not a big assumption since Q1 is determined with
the communication protocol and the modulation. The output
of the detector, ˆyyya, is formulated in (12) and the algorithm
calculates the optimal decision threshold accordingly. Details
of the threshold decision will be presented in Section IV-B.

ˆyyya =

1
Q1

yyy =

1
Q1

(HHH exxxx + III ex).

(12)

The third algorithm, called practical zero forcing (ZF) with
HHH ex, needs the average channel response matrix, which is
denoted by ¯HHH ex. The formulation, inspired by the conventional
zero forcing communication strategy, is given in (13) and
was ﬁrst proposed in [32]. The output of the detector, ˆyyyex,
is formulated as

ˆyyyex = ¯HHH

−1
ex yyy = ¯HHH

−1
ex HHH exxxx + ¯HHH

−1
ex III ex.

(13)

It is far from the shape of the conventional zero forcing in RF
communication.

To check the utility of diagonal terms in the channel matrix,
we utilize the full rank channel model as in (8). Determining
how the exact channel components can be achieved is still
an open task; we take the average channel response matrix
denoted by ¯HHH in. The new strategy is named practical ZF with
HHH in and the formulation is given by

ˆyyyin = ¯HHH

−1
in yyy = ¯HHH

−1
in HHH inxxx + ¯HHH

−1
in III.

(14)

Lastly, we assume the case that the receiver somehow knows
the exact channel state for every signal reception time. Since
this is not feasible in practic for this case, we name the
algorithm Genie-aided zero forcing. The output of the de-
tector, ˆyyyg,
is formulated in (15). Though it provides the
best performance, it is not feasible. Indeed, the randomness
of the molecular communication channel originates with the
Brownian motion of molecules, something that is hard to

Theorem 1 ensures that both methods perform the same on
average, since the signal detection properties (i.e., the detector
outputs) are similar up to a constant multiplication.

IV. THEORETICAL ANALYSIS

A. Interference Formulations

In this section, we formulate the interference and ﬁnd,
analytically, the optimal decision rule for the adaptive thresh-
olding, practical ZF with HHH ex, and practical ZF with HHH in
methods. To derive the optimal decision threshold, the study
uses the maximum-a-posterior (MAP) method.

As the receiver is unaware of parameter Q1 in the case of
the ﬁxed threshold method, we have to pre-determine a range
of Q1 to use and decide the decision threshold, ηf , to minimize
the bit error rate (BER) for all Q1. Note that the analysis of
Genie-aided zero forcing inherits the difﬁculties of acquiring
instantaneous HHH in. Hence, the optimal thresholds for Genie-
aided zero forcing must be found empirically.

We should consider the interference when determining the
thresholds and consequently the received symbol. The topo-
logical symmetry ensures that all the properties of Rx1 and
Rx2 coincide in terms of interference, so it is sufﬁcient to
analyze Rx1 only. The channel output for Rx1 at the nth time
slot becomes yRx1[n] = S11[0]x1[n]+D1[n]+I1[n] from (5).
We assume I1[n] has a mean µI and a variance σ2
I . We deﬁne
Ak as the mean value of S11[k] and Bk as the mean value of
S12[k]. Lemma 2 provides the formulations for estimating the
mean and the variance of the interference.
Lemma 2. The term S11[k]x1[m − k] of (5) has mean value
of π1Q1Ak and variance of π1Q1Ak(1 − Ak) + π0π1Q2
k,
1A2
where π0 and π1 are a priori probabilities of transmitted bit-0
and bit-1.
Proof. With probability π1 and π0, S11[k]x1[m − k] follows
N (Q1Ak, Q1Ak(1−Ak)) and becomes just zero, respectively.
Therefore, the mean of the received ISI becomes π1Q1Ak and

4Note that the coherence time of molecular communications is zero unlike

RF communications.

 𝑯𝒊𝒏 𝑯𝒆𝒙𝑯𝒊𝒏Practical zero forcingGenie-aided zero forcingAdaptive thresholdingFixed threshold method(Conventional)Mod.Demod.Channelx𝑸𝟏yQ1(Proposed 1)(Proposed 2)(Proposed 3)(Proposed 4){Required informationµI = π1Q1

Ak + Bk

σ2
I = π0π1Q2
1

A2

k + B2
k

(cid:33)

,

(cid:33)

(cid:32)m−1(cid:88)
(cid:32)m−1(cid:88)
(cid:32)m−1(cid:88)

k=1

k=1

the variance becomes

σ2 = E

(cid:104)
(S11[k]x1[m − k])2(cid:105) − E [S11[k]x1[m − k]]2

1A2

k + Q1Ak(1 − Ak)) − π2
= π1(Q2
= π1Q1Ak(1 − Ak) + (π1 − π2
1)Q2
= π1Q1Ak(1 − Ak) + π0π1Q2
1A2
k.

1Q2
1A2
k

1A2
k

The second equation comes from the fact
k +
Q1Ak(1 − Ak)) is the summation of square of nonzero
outputs.

that (Q2

1A2

Similarly, we can apply Lemma 2 to ﬁnd the mean and
variance of the term S12[k]x2[m − k] and sum both to ﬁnd
the total mean and variance of I1[m]. By Lemma 2,
the
total interference mean and variance at the mth symbol slot
becomes

(cid:33)

(16)

+ σ2
n

+ π1Q1

Ak(1 − Ak) + Bk(1 − Bk)

k=1

1 S12[k]
where Bk denotes the success probability of both Q−1
1 S21[k]. Applying Lemma 2 for the case of k = 0 leads
and Q−1
to the statistics of the desired signal S11[0]x1[m]. Substituting
S11 and Q1A0 with S12 and Q1B0 provides the statistics
of D1[m]–the ILI term. Note that (16) does not require the
previously sent bit sequences. It requires only the index of
the current symbol, as it evaluates the expected value over the
cases. Hence, (16) can be used for each symbol consecutively.
After formulating the interference and the detector output,
we can now derive the thresholds for the practical ZF with
HHH ex. We denote the probability density function (PDF) of ˆyyyex
when the transmitted bit is 0 and 1 as ˆyyyex|0 and ˆyyyex|1. Each
of them becomes a vector of size 2 × 1. The ith element of
the vector represents the number of molecules received at Rxi.
From the symmetry of the system, it is enough to observe the
statistics of ˆyyyex|0(1) and ˆyyyex|1(1). By utilizing (13) and (24),
we can ﬁnd ˆyyyex = (Q1A0)−1yyy. Revisiting the matrix form (6)
with the result provides the following:

ˆyyyex(1) = (Q1A0)−1 · (S11[0]x1 + S12[0]x2 + I1) ,
ˆyyyex|0(1) = (Q1A0)−1S12[0]x2 + (Q1A0)−1I1,
ˆyyyex|1(1) = (Q1A0)−1S11[0] + ˆyyyex|0(1).
We assume that ˆyyyex|0(1) and ˆyyyex|1(1) follow Gaussian dis-

(cid:1) respectively. The

(cid:1) and N(cid:0)µex1, σ2

tribution N(cid:0)µex0, σ2

(17)

parameters in detail can be given by Lemma 2 and (16) as:

ex0

ex1

µex0 =

σ2
ex0 =

σ2
ex1 =

+

µI

π1B0
A0
Q1A0
π1B0(1 − B0)
A2
0Q1
(1 − A0)
Q1A0

+σ2

ex0.

, µex1 = 1+µex0,

+

π0π1B2
0

A2
0

+

σ2
I
1A2
Q2
0

,

7

The terms of (16) have different amplitudes and few of them
are dominant. Thus, applying CLT for the Gaussian assump-
tion is insufﬁcient. Section IV-C offers a precise observation
for a suitable distribution, while keeping the assumption to
derive a closed form of theoretical thresholds. The feasibility
of the thresholds is shown by the simulated results at the end
of this paper.

B. Decision Thresholds

βex − 1

√
√
σex1
σex0

2π
2π

Now we deﬁne a decision rule as arg max(ˆyyyex|i) and need
to ﬁnd the intersection points of the two distributions (i.e., to
ﬁnd the decision threshold, ηex, for practical ZF with HHH ex).
This leads to the equality

exp

.
(18)
Rewriting the form by taking log on both sides, it becomes a
quadratic equation and the closed form of the solution provides

= exp

2σ2

ex1

2σ2

(cid:19)

(cid:18)
− (ηex−µex0)2
−1 ±(cid:112)1 + (βex − 1) (1 + σ2

ex0

(cid:18)
− (ηex−µex1)2

(cid:19)

ex0βexlnβex)

ηex = µex0 +

(cid:26) 0

(19)
for βex = (σex1/σex0)2 > 1. We denote the bigger one as
ex and the smaller one as η−
ex. Then the decision rule for the
η+
decoded bits ˆxxx becomes:

1

ex

ˆxxx = δex(ˆyyyex) =

ex has a negligible gap(cid:0)≤ 10−4(cid:1) from the optimal single

ex > ˆyyyex > η−
η+
otherwise
where δex(·) is the decision function at
the receiver for
practical ZF with HHH ex. The solution is supported by observing
that η+
threshold obtained by Brute-force search with the simulator.
ex0 and the
−1
variance of ¯HHH
ex HHH ex. The case where βex becomes 1 means
that ˆyyyex|0 and ˆyyyex|1 have the same variances and it is trivial
that the threshold becomes µex0+µex1

Note that βex ≥ 1 because σ2

ex1 is the sum of σ2

.

We can similarly obtain the decision rule for adaptive
thresholding. We deﬁne ˆyyya|0 and ˆyyya|1 as in (17) and their
means and variances, according to Theorem 1, become
A0µex0, (A0σex0)2, A0µex1, and (A0σex1)2, respectively.
Therefore, we have an equation similar to (18) for ﬁnding
the decision threshold ηa of adaptive thresholding method
− (ηa − A0µex1)2

− (ηa − A0µex0)2

(cid:18)

(cid:19)

(cid:18)

= exp

2

exp

A0σex1
A0σex0
that can be solved similarly.

2(A0σex0)2

2(A0σex1)2

(cid:19)

In the same way, we deﬁne ˆyyyin|0 and ˆyyyin|1 as the received
signal of practical ZF with HHH in to obtain the decision
rule. They have means and variances denoted by µin0, µin1,
in0, and σ2
in1, respectively. It is enough to ﬁnd the exact
σ2
formulation of those parameters, as we can derive the decision
rule by repeating the process carried out for the two previous
algorithms.

From (8), we can achieve the formulation

(cid:20)A0 B0

(cid:21)

B0 A0

¯HHH in = Q1 ·

8

which has full rank if the inequality A2
0 > B2
deﬁnitions of A0 and B0 provide the formulation
Q1A0 = ¯S11[0] = ¯S11(0, ts) = F11(0, ts),
Q1B0 = ¯S21[0] = ¯S21(0, ts) = F21(0, ts)

0 holds. The

0 > B2

(cid:20) A0 −B0

where F11 and F21 are derived in (10) and shown in Fig. 2. It
0 holds in any of
is a trivial matter that the inequality A2
the cases. Now we are safe to claim that ¯HHH in has its inverse
matrix in the closed form of
1
0 − B2
Q1 (A2
0 )
and utilizing (8) and (20) results in
A0S11[0] − B0S12[0]
A0S21[0] − B0S22[0]

−B0 A0

ˆyyyin(1) =

−1
in =

Q1 (A2

(20)

(cid:21)

¯HHH

·

· x1
· x2 +

A0I1 − B0I2
0 − B2
Q1 (A2
0 )

.

0 − B2
0 )
0 − B2
0 )

+

Q1 (A2

As a result, the following can be achieved:
· x2 +

A0S21[0] − B0S22[0]
A0S11[0] − B0S12[0]

ˆyyyin|0(1) =

Q1 (A2

ˆyyyin|1(1) =

Q1 (A2

0 − B2
0 )
0 − B2
0 )

+ ˆyyyin|0(1).

A0I1 − B0I2
0 − B2
Q1 (A2
0 )

,

With Lemma 2, the parameters are ﬁnally obtained as:

· µI , µin1 = 1+µin0,

µin0 =

σ2
in0 =

+

σ2
in1 =

Q1 (A2

A0 − B0
0 − B2
0 )

(cid:18) A0
(cid:18) B0

(cid:19)2· π1B0(1 − B0)
(cid:19)2· π1A0(1 − A0)

0 − B2
A2
0 − B2
A2
0 (1 − B0)
0(1 − A0) + B3
A3
0 − B2
0 )2

Q1 (A2

Q1

Q1

0

0

+σ2

in0.

+

A2
1 (A2

0 + B2
0
0 − B2

0 )2 · σ2

I ,

Q2

Substituting µex0, σex0, and σex1 with µin0, σin0, and σin1
in (19) leads to the thresholds η−
in, η+
in, and the decision rule
ˆxxx = δin (ˆyyyin) of practical ZF with HHH in.

The two distributions (when the transmitted bit is 0 or 1) of
the number of received molecules have different variances. Un-
like a typical system, this leads to multiple decision thresholds.
Sketched in Fig. 6 is the error region of the case of utilizing
multiple thresholds. When the decision is red, it corresponds
to ˆyyyX|0 for X, in this paper, be either ‘ex’ or ‘in’. The region
that is labeled as Decision: Blue corresponds to ˆyyyX|1. The x-
axis values of intersections between the two curves become
η−
X and η+
X in ascending order, and the areas labeled E1 and
E2 correspond to type-I and type-II error probabilities of the
algorithm with the decision rule ˆxxx = δX (ˆyyyX ).

C. Error Probability

We deﬁne dtXi(q) as the PDF of detector output at the
receive antenna. X is the abbreviation for the detection
algorithms such as ex for practical ZF with HHH ex and in
for practical ZF with HHH in. The subscript i can be 0 or 1,
indicating that
the conveyed information is bit-0 or bit-1.
dtXi(q) values are assumed to follow the Gaussian distribution

Fig. 6. An example case of decision region with multiple thresholds when
the mean and the variance of two distributions are different.

(cid:1) in the previous section, though the simulation

N(cid:0)µXi, σ2

output ﬁts poorly with the Gaussian model in the MIMO
system, as can be observed in Fig. 7. To achieve a more
accurate model, we assume that dtXi(q) follows a generalized
Gaussian distribution (GGD) given by

Xi

(cid:16)− (|q − µXi|)βXi(cid:17)

dtXi(q) =

κXi =

σ2
Xi =

βXi

· exp

,

2αXiΓ (1/βXi)
Γ (5/βXi)Γ (1/βXi)

α2

Γ (3/βXi)2
XiΓ (3/βXi)
Γ (1/βXi)

,

(21)

where Γ (·) denotes the gamma function, αXi, βXi and κXi
denote a scale parameter, shape parameter, and the kurtosis
of the distribution. The distribution becomes the Gaussian
distribution when the shape parameter equals 2. The simulation
results demonstrate that the estimated mean and variance of
dtXi from the Gaussian assumption ﬁt well, but the kurtosis
value does not ﬁt. Hence, we need the shape parameter, β, to
generalize the arrival distribution. We do not have an analytical
model for κXi. Instead we use the simulation data to ﬁnd
βXi. The GGD approximation ﬁts the simulation better than
the Gaussian model as shown in Fig. 7, for practical ZF with
HHH ex. The corresponding shape parameters are given in Table I.
We incorporate the estimated formulations from Sec-
tion IV-B with (21) to derive the formulation of error probabil-
ity. We consider only the upper threshold as the below lower
threshold error hardly occurs in our system model in practice.
The result becomes:

P eX = fγ(µX0, αX0, βX0) + fγ(µX1, αX1, βX1),

(cid:17)β(cid:19)

(cid:18)

1
β ,

(cid:16)|η+
(cid:16) 1

α

β

2Γ

X−µ|

(cid:17)

fγ(µ, α, β) =

γ

−

1
2

(22)

where γ(·) denotes the lower incomplete gamma function.

For the following comparison, ts and the topology parame-
ters are general constant values and a, b, c are coefﬁcients for
a second order polynomial.

−6−4−20246800.050.10.150.20.250.3Decision: RedDecision: RedDecision: BlueE1E1E2xfX(x)  µ=0, σ=1.5µ=1, σ=3.0η−η+9

n, the noise power, only affects value c in Theorem 3.
that σ2
n increases the value c without changing a and b,
Decreasing σ2
which results in a lower T . This means that if σ2
n is decreased
enough so that T falls below Q1 then practical ZF with
HHH in would perform better. As a result, we could claim from
Corollary 4 that practical ZF with HHH in provides a lower
error rate when the signal-to-noise ratio (SNR) is higher than
a certain point. We will further investigate the SNR threshold
in future work.

V. NUMERICAL RESULTS

The system parameters for theoretical analysis are given in
Table II. We ﬁrst give the deﬁnition of signal-to-interference-
ratio (SIR) metric in a molecular MIMO system and analyze
the effect of distance, rr, and h. Next, we use the BER as the
performance metric and analyze the effect of Q1 and ts.

RANGE OF PARAMETERS USED IN THE ANALYSIS

TABLE II

Parameter
Diffusion cefﬁcient
Distance
Radius of the receiver
Bulge separation
# molecules for sending
bit-1
Probability of sending
bit-1
Symbol duration
Molecular noise variance
Bit sequence length
Replication

Variable
D
d
rr
h

Q1

π1

ts
σ2
n

Values
50 µm2/s
{2, 4}µm
{2, 4}µm
{1, 2}µm
{100 ∼ 1000} molecules

0.5
{0.05 ∼ 1}s
100
5 × 105
20

A. SIR Analysis

For the deﬁnition of SIR, we consider a one-shot signal
from Tx1 i.e., a bunch of molecules are emitted at t = 0. SIR
is deﬁned as the ratio of the expected number of molecules
coming from the intended transmitter in the intended time slot
to the mean ILI plus ISI for just a one-shot signal.

SIR =

F11(0, ts)

F11(ts,∞) + F12(0,∞)

.

Note that this deﬁnition is speciﬁc to the molecular communi-
cation case and explains the clearness of the mean signal term
in the received signal.

Fig. 8 shows the SIR values with varying ts for different
topology parameters (such as the distance d, radius of the
receiver rr, and receiver antenna separation h). The best
enhancement, in terms of SIR, is observed by reducing the
distance between the transmitter and the receiver. Increasing
the antenna size also gives merit. For the given parameters,
however, a higher h results in a less signiﬁcant improvement
but non-negligible. Thus, we conclude that for the given
parameters the ISI term is more dominant than the ILI term.
the
topological parameters as d = 2 µm, rr = 4 µm, h = 2 µm, and
D = 50 µm2/s. The selected system parameters and the ﬁtted
values for model parameters are given in Table III. Utilizing
the ﬁtted values enables us to estimate Fij(t) analytically.

For the rest of the performance evaluation, we set

Fig. 7. Comparison of simulated and analytical dtpi. (Q1 = 700, ts =
0.08 s, σn = 10, βex0 = 5, βex1 = 4).

TABLE I

SHAPE PARAMETERS

β

βp0
βp1

300
3.0
2.57

Q1

500
3.9
3.3

700
5.0
4.0

900
6.3
4.5

Theorem 3. A single positive root exists for function h(Q1)
that is deﬁned as follows

(cid:1) = aQ2

ex0 − σ2

(cid:0)σ2
0 )/3 >(cid:80)n

in0

1 + bQ1 + c
0 − 2B2
i + B2

h(Q1) = Q2
1

0 − 2B2

if we assume that the ILI condition A2
0 > 0 and the
ISI condition (A2
i ) are satisﬁed.
i=1(A2
We deﬁne a system satisfying these conditions as having
acceptable interference. A priori probabilities of transmitted
bit-0 and bit-1 are assumed to be equal (i.e., π0 = π1 = 0.5).
Proof. See the Appendix B.
Corollary 4. The practical ZF with HHH in has a lower error
probability than that of the practical ZF with HHH ex if and only
if Q1 is above a certain threshold T .
Proof. Since µX1−µX0 = 1 holds for both X = ex and X = in,
the error probability depends on the variances. It is intuitive
that higher variances result in higher probabilities of error.
Raising σX0 concurrently increases σX1. Hence, we can claim
that σX0 is proportional to P eX. Therefore, to compare the
error probability, it is sufﬁcient to compare the variances.

ex0 and σ2

ex0 and σ2

The variances σ2

1 with both σ2

in0 are functions of Q1. Multiply-
in0 yields them to be quadratic
ing Q2
polynomials. The difference between them becomes h(Q1) in
Theorem 3. Let T be the positive root of h(Q1). Therefore
h(Q1) is positive ∀Q1 > T since a is positive (see the
Appendix for the proof of Theorem 3). Positive h(Q1) implies
σex0 > σin0 thus P eex > P ein. Therefore, the practical ZF with
HHH in shows a lower error probability than the practical ZF with
HHH in when Q1 is larger than threshold z.

For the example case of ts = 0.08 s and σn = 10, the
computed threshold is T = 9.34 × 105. It is also observed

00.20.40.60.811.21.41.61.800.511.522.53Normalized detector outputFrequency histogram for the detector output  dtp0, Simulationdtp0, Normaldtp0, Generalized GaussianThreshold, Normaldtp1, Simulationdtp1, Normaldtp1, Generalized GaussianThreshold, GGD10

Fig. 8. SIR plots for different topologies (D = 50 µm2/s).

FITTED MODEL PARAMETERS FOR THE SELECTED TOPOLOGY (d = 2 µm,

rr = 4 µm, h = 2 µm, D = 50 µm2/s).

TABLE III

Fig. 9. BER performance comparison of the simulation results and the
theoretical formulation of the practical zero forcing algorithms (ts = 80 ms,
σn = 10).

Function
F11(t)
F12(t)

b1
0.9155
0.2981

b2
0.5236
0.5315

b3
0.5476
0.5363

B. BER Analysis

In this section, we analyze the BER with respect to varying
Q1 and ts and compare the performance gain of each of
the proposed detection algorithms. Each Tx sends 5 × 105
bits with an equal probability of sending bit-1 and bit-0.
Most prior work has shown that, with an appropriate symbol
duration, the current symbol is affected predominantly by one
previous symbol with the rest being less dominant [6], [7],
[33]. Therefore, we considered in the simulation four slots
of interference, which is enough to contain all the dominant
effects and provides a reasonable run time. We examined all
the thresholds between 0 and 1 with a 10−3 interval and
checked the optimal threshold for each Q1. The empirically
found ﬁxed threshold ηf was selected as 0.2, which is the
average of the empirical optimal values for each Q1.

Figure 9 shows the BER performance of practical ZF with
HHH ex and HHH in in both theory and simulation while Q1 varies
from 300 to 1000. As expected, we conﬁrm, through this
result, the same performance of two practical ZF algorithms.
It shows that when the value of Q1 is low (i.e., when the signal
power is low) a clear gap emerges between the theory and the
simulation. The gap between analytical and numerical results
decreases as the power increases, which implies that the GGD
approximation is better with a higher transmit power.

Figure 10 shows the BER performance of the detection algo-
rithms while Q1 varies from 300 to 1000. The ﬁrst observation
is that the adaptive thresholding and the practical ZF with
HHH ex provide the same BER results, as proved in Theorem 1.
Increasing Q1 (i.e., the signal power) decreases the BER for
all the detection algorithms. However, the improvement of
ﬁxed thresholding is signiﬁcantly lower than those of the other
methods. When the instantaneous HHH is known at the receiver,

Fig. 10. BER performance of the detection algorithms (ts = 80 ms).

Genie-aided zero forcing is applicable and gives the best
performance. Note that obtaining that information, however,
is not by nature feasible in molecular communications. On
the other hand, obtaining the optimal threshold by knowing
Q1 and π1 is feasible and leads to a performance that is close
to Genie-aided zero forcing.

Figure 11 illustrates the BER performance against ts from
50 ms to 130 ms. It shows that
increasing ts gives faster
improvements in terms of BER relative to increasing Q1. This
means that to achieve a lower BER, it is more effective to de-
crease the information rate than to increase the transmit power.
In Fig. 12 we compare the throughput of the proposed MIMO
and the conventional SISO systems. For this experiment, we
used the same amount of emission molecules. As can be seen
from the ﬁgure, we could conﬁrm that the proposed MIMO
system asymptotically achieves double throughput compared
to the SISO system. Note that the practical ZF with HHH ex and
the practical ZF with HHH in show nearly the same performance
in both Fig. 10 and Fig. 11.

0.10.20.30.40.50.60.70.80.900.511.522.53Symbol time duration (sec)SIR  d=2 µm; rr=4 µm; h=2 µmd=2 µm; rr=4 µm; h=1 µmd=2 µm; rr=2 µm; h=1 µmd=4 µm; rr=2 µm; h=1 µm30040050060070080090010−510−410−310−2Q1 (Number of Molecules for bit−1)BER  Simulated PeexSimulated PeinTheoretical PeexTheoretical Pein30040050060070080090010−610−510−410−310−2Q1 (Number of Molecules for bit−1)BER  Fixed thresholdingAdaptive thresholdingPractical ZF with HexPractical ZF with HinGenie−aided ZF11

Fig. 11. BER performance of the detection algorithms (Q1 = 500).

VI. TESTBED

We implemented our own macro-scale version to realize
the theoretical studies on molecular MIMO systems. The
transmitter and the receiver in our system are equipped with
multiple transmit nozzles and receive sensors to increase the
data rate. The system is low cost, and the testbed platform is
modiﬁable and re-programmable [34], [35].

In Fig. 13, the main components of the testbed are shown.
The testbed comprises a molecular MIMO transmitter and
receiver. The propagation distance between the transmitter and
the receiver is about one meter. The transmitter is composed
of: 1) a simple user interface for text entry, 2) a microcontroller
for executing transmitter algorithms, 3) two reservoirs for
chemicals, and 4) two chemical-releasing mechanisms (i.e.,
two sprays nozzles and an air compressor). At the receiver,
the hardware consists of: 1) two chemical sensors for a
MIMO system (i.e.,
two MQ-3 alcohol sensors), 2) two
microcontrollers that forward an electrical signal that originate
from chemical sensors to a computer, and 3) a computer for
demodulating, decoding the signal, and visualizing the results.

A. Operation

Molecular MIMO communication in our testbed is carried
out in three steps–encoding, propagation, and detection. In the
encoding step, the transmitter separates the input strings into
two parts and converts them to bit sequences using interna-
tional telegraph alphabet no. 2 (ITA2). The ITA2-encoding
method is able to convert each letter (among 26 letters) to
its corresponding 5-bit binary number (e.g., alphabet ‘A’ =
11000).

In the emission step, the transmit antennas (spray nozzles)
Tx1 and Tx2 are fed to transmit independent bit sequences
that are coded following the encoding step. The transmitter
modulates the bits using binary concentration shift keying
(BCSK). The transmit antennas spray once in a symbol
duration to transmit bit-1; for bit-0, they do not spray, as
the modulation is deﬁned theoretically in Section II-B. At
the start of communication, two transmit antennas spray once
to notify the beginning of transmission. The termination of

Fig. 12. Throughput comparisons (ts = 80 ms). Throughput = M · L/ts ·
(1 − BER), where M and L denote the modulation order and the number of
spatial streams.

communication is determined by decoding the bit sequence
00000 at both receive antennas.

The emitted molecules diffuse in the air and arrive at the
receiver. At the receiver site (i.e., chemical sensors), molecule
concentrations are converted to electrical signals (i.e., sensor
voltage). Voltages are estimated by 250Hz; ﬁve of them are
averaged to be robust on the error which results in 50Hz
of reading frequency. The coherence time is zero in the
diffusion-based molecular communication. Hence we cannot
use existing RF communication methods. Therefore, we need
algorithms that are designed for diffusion-based molecular
communications. Having a lack of control over the number
of molecules released, more consistent spray is needed to
implement various algorithms. Our testbed has a capability
of measuring the reception voltage that is proportional to the
number of received molecules. It enables us to use adaptive
thresholding for the molecular MIMO communication testbed.

B. Hardware Layout

We have two more implementable algorithms: ﬁxed thresh-
olding and practical ZF with HHH in. However, to show a clear
comparison between them, the transmitter should have the
capability of controlling the amounts of emission so that the
BER is estimated accordingly. We leave this to the future work
with an upgraded version of the testbed and instead focus in
this paper on showing the feasibility of the micro-scale strategy
on the macro-scale testbed.

In Fig. 14, the voltage information of each sensor is shown
when the message ‘YONSEI’ is sent. Two lines show a change
of each receiver sensor’s voltage. The ﬁrst two symbols are
the start signal, the next 15 symbols are the message signal,
and the ﬁnal 5 symbols are the end signal. Fig. 15 shows an
application of the adaptive thresholding to the signal depicted
in Fig. 14. After subtracting the ﬁrst reading in each symbol
duration, all
the sensors’ values are averaged respectively
over the time of the symbol duration so as to apply the
adaptive thresholding algorithm. Then we apply thresholding
to the averaged signal value. In Fig. 15, the stem plots with

0.050.060.070.080.090.10.110.1210−410−310−2Symbol time duration (sec)BER  Fixed thresholdingAdaptive thresholdingPractical ZF with HexPractical ZF with HinGenie−aided ZF105010015020025051015202530Q1 (Number of Molecules for bit−1)Throughput (bit/s/chemical)  SISOGenie−aided ZFFixed thresholdingAdaptive thresholding50Proposed methods for MIMO12

Fig. 13. The tabletop molecular MIMO communication platform.

Fig. 14. Voltage of sensors when the message ‘YONSEI’ is transmitted.

Fig. 15. Adaptive thresholding when the message ‘YONSEI’ is sent.

TABLE IV

DATA RATE AND BER COMPARISON

C. Demonstration

Type
SISO
MIMO

Transmission time (s)
148
88

Data rate (bps)
0.20
0.34

BER
4.412×10−2
9.750×10−2

circle and square markers denote data from Rx1 and Rx2.
The horizontal thick line indicates the threshold value for the
adaptive thresholding algorithm. The threshold value is a bit
different from our theoretical analysis shown in the previous
sections. This is because the receiver sensors used in our
testbed are not ideal and have quite a long turn over time
(≈ 100 × ts) to be recovered. Thus for the demonstration,
we empirically found the threshold (related to the number of
released molecules) for signal detection.

For the testbed measurement, we set the distance between
transceivers as 90 cm and the antenna separation as 40 cm.
We used 4 seconds for the symbol duration. The transmitted
message was ‘YONSEI’. Table IV compares the transmission
times, the data rates, BER of the SISO and MIMO systems.
The MIMO system shows a 1.7 times higher data rate than
the SISO system. The data rate enhancement is not exactly
double due to interference compensation and system overhead
(the start and end of communication indicators). We also sent
consecutive 500 bits each with 4 s symbol duration and we got
rough BER values, which is presented in Table IV .

For the MIMO case, the signal-to-ILI (S-ILI) ratio in the
current symbol duration is measured by sending bit-1 at Tx1

① Transmitter – Controller Controller consists of Arduino and LCD screen for choosing the transmit mode and inserting message by using 5 switches.  ② Alcohol sensor – Receive antenna Receive antenna includes Arduino and employs MQ-3 sensor, which measures concentration of alcohol around it.  ③ Spray nozzles – Transmit antenna  & ④ Angle, distance controller  Nozzles spray molecules using compressed air. Angle of nozzles and distance between two nozzles are controllable.   ⑤ Molecules reservoirs Two reservoirs can store molecules for each transmit antenna individually. Transmitter - Controller Alcohol Sensor - Receive antenna Receiver Transmitter Transmitter – Front view Transmitter – Air compressor & Air tank ① ④ ③ ③ ③ ③ ② ⑤ Transmitter – Top view 01020304050607080050100150200250300350Start signal     Message sequence signal     End signaltime(s)Voltage of sensors  Rx1Rx2246810121416182022−50050100150000111010001100Rx2: ORx2: SRx2: I101010011010000Rx1: YRx1: NRx1: ESymbolAverage voltage  Rx1Rx2Threshold value: 5and bit-0 (silence) at Tx2. We evaluate S-ILI ratio as follows

B. Proof of Theorem 3

13

(cid:19)

,

t=ts(cid:88)

t=ts(cid:88)

S-ILI Ratio =

sRx1(t) /

sRx2(t)

(23)

t=0

t=0

where sRxi(t) denotes the received signal (i.e., the voltage) at
receiver i (Rxi). In other words, we measured the signal at the
desired Rxi and normalize it by ILI term for the current symbol
duration. During our tests, we also measured the S-ILI and it
was 14.567, which means ILI signal has an average amplitude
of nearly the 1/14.567 of the received signal at the intended
antenna in the current symbol slot.

VII. CONCLUSIONS

Data rates in molecular communications are affected by
interference. Therefore, any enhancement in molecular com-
munications must give precise consideration to interference
effects. In this paper, we proposed a MIMO system for MCvD
that takes into account inter-symbol and inter-link interference.
Moreover, we proposed four symbol detection algorithms that
depend on the information set at the receiver. First, we mod-
eled the channel’s impulse response by applying least squares
curve ﬁtting to the simulation results obtained form our 3-D
MIMO simulator, where the received signal is the fraction
of the received molecules. We utilized the estimated function
(which gives the fraction of received molecules) to model
interferenceand ﬁnd the optimal thresholds for the detection
algorithms. In the performance analysis, we investigated the
effect on the SIR of varying topological conditions. The results
showed that decreasing the transmitter-receiver distance and
increasing the size of the receive antennas are more effective
at reducing the interference than is increasing the separation of
the antennas. We analytically and numerically investigated the
link-level performance of the proposed detection algorithms
while varying the number of emitted molecules and the symbol
duration. We also implemented the world’s ﬁrst molecular
MIMO testbed to verify the proposed concept and achieved
transmission rates 1.7 times higher than those obtained from
the molecular SISO system.

ACKNOWLEDGMENT

C.-B. Chae would like to thank S. Kim and C. Kim for their

helpful discussions.

A. Proof of Theorem 1

APPENDIX

The topological symmetry guarantees that the random vari-
ables S11[k] and S22[k] have equal statistical parameters for
a positive integer k. They are both binomial random values
with a success probability of Ak. The transmitter sends Q1
molecules for transmitting a bit-1. Therefore, the diagonal
entries of HHH ex follow a binomial distribution and are approx-
imated to the normal distribution as follows:

HHH ex(i, i) ∼ B(Q1, A0) ≈ N (Q1A0, Q1A0(1 − A0))

(24)
and the channel mean ¯HHH ex equals Q1A0EEE where EEE denotes
−1
a 2 × 2 identity matrix. It leads ¯HHH
ex = (1/Q1A0)EEE and ˆyyya
in (12) to become a multiplication of A0 and ˆyyyex in (13).

(cid:80)n

The coefﬁcients a and c are expressed in detail as:
0 + B2
0
0 − B2
0 )2

− A2
(A2

B2
0
4A2
0

a =

A2
0

+

·

(cid:18) 1

c = σ2
n

(cid:18) 1
(cid:18) 1

A2
0

i=1(A2
i + B2
i )
4
− A2
0 + B2
0
0 − B2
(A2
0 )2

(cid:19)
(cid:19)

.

A0 > B0 is trivial from the deﬁnition: hence, the equation

− A2
(A2

0 + B2
0
0 − B2
0 )2

A2
0

−B2
A2

0 − B2
0 )
0 − B2
0 )2

0 (3A2
0(A2

=

provides that c is always a negative value. The acceptable
interference condition leads to
0 − 2B2

0

a >

=

=

B2
0
4A2
0
B2
0
4A2
0
B2
0
4A2
0

− A2

(cid:18)

3
1 − (A2

0 − B2
0 (3A2
· B2
0 )
0 − B2
0(A2
4A2
0 )2
0 − B2
0 − 2B2
0 )(3A2
0 )
0 − B2
3(A2
0 )2

(cid:19)

· A2
0B2
0 + B4
0
0 − B2
3(A2

0 )2 > 0.

In terms of Q1, h(Q1) = 0 has only one positive root since a
is positive and c is negative.

REFERENCES

[1] T. Nakano, A. W. Eckford, and T. Haraguchi, Molecular communication.

Cambridge University Press, 2013.

[2] I. F. Akyildiz, F. Brunetti, and C. Blazquez, “Nanonetworks: A new
communication paradigm,” Elsevier Comput. Netw., vol. 52, no. 12, pp.
2260–2279, Aug. 2008.

[3] N. Farsad, H. B. Yilmaz, A. Eckford, C.-B. Chae, and W. Guo, “A com-
prehensive survey of recent advancements in molecular communication,”
arXiv preprint arXiv:1410.4258, Oct. 2014.

[4] B. Atakan, O. B. Akan, and S. Balasubramaniam, “Body area nanonet-
works with molecular communications in nanomedicine,” IEEE Com-
mun. Mag., vol. 50, no. 1, pp. 28–34, Jan. 2012.

[5] T. Nakano, M. J. Moore, F. Wei, A. V. Vasilakos, and J. Shuai, “Molecu-
lar communication and networking: Opportunities and challenges,” IEEE
Trans. Nanobiosci., vol. 11, no. 2, pp. 135–148, Jun. 2012.

[6] N.-R. Kim and C.-B. Chae, “Novel modulation techniques using iso-
mers as messenger molecules for nano communication networks via
diffusion,” IEEE J. Sel. Areas Commun., vol. 31, no. 12, pp. 847–856,
Dec. 2013.

[7] M. S. Kuran, H. B. Yilmaz, T. Tugcu, and B.

¨Ozerman, “Energy
model for communication via diffusion in nanonetworks,” Elsevier Nano
Commun. Netw., vol. 1, no. 2, pp. 86–95, Jun. 2010.

[8] N. Farsad, A. Eckford, and S. Hiyama, “Design and optimizing of
on-chip kinesin substrates for molecular communication,” IEEE Trans.
Nanotechnol., vol. 14, no. 4, pp. 699–708, July 2015.

[9] P. Lio and S. Balasubramaniam, “Opportunistic routing through conjuga-
tion in bacteria communication nanonetwork,” Elsevier Nano Commun.
Netw., vol. 3, no. 1, pp. 36–45, Mar. 2012.

[10] K. V. Srinivas, A. W. Eckford, and R. S. Adve, “Molecular communica-
tion in ﬂuid media: The additive inverse Gaussian noise channel,” IEEE
Trans. Inf. Theory, vol. 58, no. 7, pp. 4678–4692, Jul. 2012.

[11] N.-R. Kim, A. W. Eckford, and C.-B. Chae, “Symbol interval optimiza-
tion for molecular communication with drift,” IEEE Trans. Nanobiosci.,
vol. 13, no. 3, pp. 223–229, Sep. 2014.

[12] N. Farsad, W. Guo, and A. W. Eckford, “Tabletop molecular commu-
nication: Text messages through chemical signals,” PLoS One, vol. 8,
no. 12, p. e82935, Dec. 2013.

[13] N. Farsad, N.-R. Kim, A. W. Eckford, and C.-B. Chae, “Channel and
noise models for nonlinear molecular communication systems,” IEEE J.
Sel. Areas Commun., vol. 32, no. 12, pp. 2392–2401, Dec. 2014.

[14] H. B. Yilmaz, A. C. Heren, T. Tugcu, and C.-B. Chae, “Three-
dimensional channel characteristics for molecular communications with
an absorbing receiver,” IEEE Commun. Lett., vol. 18, no. 6, pp. 929–932,
Jun. 2014.

14

[15] M. Pierobon and I. F. Akyildiz, “Capacity of a diffusion-based molecular
communication system with channel memory and molecular noise,”
IEEE Trans. Inf. Theory, vol. 59, no. 2, pp. 942–954, Feb. 2013.

[16] M. U. Mahfuz, D. Makrakis, and H. T. Mouftah, “Strength-based
optimum signal detection in concentration-encoded pulse-transmitted
OOK molecular communication with stochastic ligand-receptor bind-
ing,” Elsevier Simul. Model. Pract. Theory, vol. 42, no. 0, pp. 189–209,
Mar. 2014.

[17] A. Noel, K. Cheung, and R. Schober, “Improving receiver performance
of diffusive molecular communication with enzymes,” IEEE Trans.
Nanobiosci., vol. 13, no. 1, pp. 31–43, Mar. 2014.

[18] H. B. Yilmaz and C.-B. Chae, “Arrival modeling for molecular commu-
nication via diffusion,” IET Electron. Lett., vol. 50, no. 23, pp. 1667–
1669, Nov. 2014.

[19] A. Akkaya, H. B. Yilmaz, C.-B. Chae, and T. Tugcu, “Effect of receptor
density and size on signal reception in molecular communication via
diffusion with an absorbing receiver,” IEEE Commun. Lett., vol. 19,
no. 2, pp. 155–158, Feb. 2015.

[20] A. C. Heren, H. B. Yilmaz, C.-B. Chae, and T. Tugcu, “Effect of
degradation in molecular communication: Impairment or enhancement?”
to appear in IEEE Trans. Molecular, Biological, and Multi-scale Comm.,
also available at arXiv:1410.7895, 2015.

[21] M. Pierobon and I. F. Akyildiz, “Diffusion-based noise analysis for
molecular communication in nanonetworks,” IEEE Trans. Signal Pro-
cess., vol. 59, no. 6, pp. 2532–2547, June 2011.

[22] C. T. Chou, “Molecular communication networks with general molecular
circuit receivers,” in Proc. ACM Int. Conf. on Nanoscale Computing and
Commun. (NANOCOM). ACM, Mar. 2014, pp. 1–9.

[23] M. S. Kuran, H. B. Yilmaz, T. Tugcu, and I. F. Akyildiz, “Modulation
techniques for communication via diffusion in nanonetworks,” in Proc.
IEEE Int. Conf. on Commun. (ICC), June 2011, pp. 1–5.

[24] H. B. Yilmaz and C.-B. Chae, “Simulation study of molecular com-
munication systems with an absorbing receiver: Modulation and ISI
mitigation techniques,” Elsevier Simul. Model. Pract. Theory, vol. 49,
pp. 136 – 150, Dec. 2014.

[25] B. Tepekule, A. E. Pusane, H. B. Yilmaz, C.-B. Chae, and T. Tugcu, “ISI
mitigation techniques in molecular communication,” to appear in IEEE
Trans. Molecular, Biological, and Multi-scale Comm., also available at
arXiv:1410.8313, 2015.

[26] G. Genc, H. B. Yilmaz, and T. Tugcu, “Reception enhancement with
protrusions in communication via diffusion,” in Proc. IEEE Int. Black
Sea Conf. on Commun. and Netw. (BlackSeaCom), Jul. 2013, pp. 89–93.
[27] B. Tepekule, A. Pusane, M. Kuran, and T. Tugcu, “A novel pre-
equalization method for molecular communication via diffusion in
nanonetworks,” IEEE Commun. Lett., vol. PP, no. 99, pp. 1–4, 2015.

[28] L.-S. Meng, P.-C. Yeh, K.-C. Chen, and I. F. Akyildiz, “On receiver
design for diffusion-based molecular communication,” IEEE Trans.
Signal Process., vol. 62, no. 22, pp. 6032–6044, Nov. 2014.

[29] ——, “MIMO communications based on molecular diffusion,” in Proc.
IEEE Glob. Telecomun. Conf. (GLOBECOM), Dec. 2012, pp. 5380–
5385.

[30] H. Luddens and E. R. Korpi, “Biological function of GABAA/ benzo-
diazepine receptor heterogeneity,” Elsevier J. Psychiatr. Res., vol. 29,
no. 2, pp. 77–94, Apr. 1995.

[31] H. ShahMohammadian, G. G. Messier, and S. Magierowski, “Blind
synchronization in diffusion-based molecular communication channels,”
IEEE Commun. Lett., vol. 17, no. 11, pp. 2156–2159, Nov. 2013.

[32] B. Koo, H. B. Yilmaz, A. Eckford, and C.-B. Chae, “Detection algo-
rithms for molecular MIMO,” in Proc. IEEE Int. Conf. on Commun.
(ICC), Jun. 2015.

[33] H. Arjmandi, A. Gohari, M. N. Kenari, and F. Bateni, “Diffusion-
based nanonetworking: A new modulation technique and performance
analysis,” IEEE Commun. Lett., vol. 17, no. 4, pp. 645–648, Apr. 2013.
[34] C. Lee, B. Koo, N.-R. Kim, H. B. Yilmaz, A. Eckford, and C.-B. Chae,
“Molecular MIMO communication link,” in Proc. IEEE Int. Conf. on
Comput. Commun. (INFOCOM), Apr. 2015.

[35] ——, “Demo: Molecular MIMO with drift,” in Proc. ACM MobiCom,

Sep. 2015.

