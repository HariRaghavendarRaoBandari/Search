6
1
0
2

 
r
a

M
7

 

 
 
]

.

R
P
h
t
a
m

[
 
 

1
v
5
4
9
1
0

.

3
0
6
1
:
v
i
X
r
a

Feedback control: two-sided

Markov-modulated Brownian motion with
instantaneous change of phase at boundaries

Guy Latouche∗

Giang T. Nguyen†

March 8, 2016

Abstract

We consider a Markov-modulated Brownian motion {Y (t), ρ(t)}
with two boundaries at 0 and b > 0, and allow for the controlling
Markov chain {ρ(t)} to instantaneously undergo a change of phase
upon hitting either of the two boundaries at semi-regenerative epochs
deﬁned to be the ﬁrst time the process reaches a boundary since it
last hits the other boundary. We call this process a ﬂexible Markov-
modulated Brownian motion.

Using the recently-established links between stochastic ﬂuid mod-
els and Markov-modulated Brownian motions, we determine important
characteristics of ﬁrst exit times of a Markov-modulated Brownian mo-
tion from an interval with a regulated boundary. These results allow
us to follow a Markov-regenerative approach and obtain the stationary
distribution of the ﬂexible process. This highlights the eﬀectiveness of
the regenerative approach in analyzing Markov-modulated Brownian
motions subject to more general boundary behaviours than the classic
regulated boundaries.

Keywords: Fluid queues, Markov-modulated Brownian motion, regen-
erative processes, ﬁnite buﬀer, stationary distribution, feedback.

Triomphe, 1050 Bruxelles, Belgium, latouche@ulb.ac.be.

∗Université Libre de Bruxelles, Département d’informatique, CP 212, Boulevard du
†The University of Adelaide, School of Mathematical Sciences, SA 5005, Australia,

giang.nguyen@adelaide.edu.au

1

1 Introduction
We analyze Markov-modulated Brownian motions (MMBMs) restricted to
the interval [0, b], the distinguishing feature being that the processes are
allowed to undergo an instantaneous change of phase upon hitting either
boundaries at semi-regenerative epochs. These correspond to the ﬁrst times
the process reaches a boundary after it hits the other boundary. We refer to
these processes as ﬂexible Markov-modulated Brownian motion.

The simplest example we have in mind is described as follows: consider
a buﬀer of ﬁnite capacity b serving as temporary storage for data in a com-
munication network. Assume that its content X(t) evolves in time like a
Brownian motion with parameters µ < 0 and σ2 > 0. Whenever the buﬀer
gets full, data may be lost. To reduce such losses, additional bandwidth is
allocated, or the input stream is throttled, or other measures are taken, such
that the mean drift becomes µ(cid:48) < µ. Once the buﬀer is emptied, the process
returns to its normal mode of operation, until it gets full again, etc. See Fig-
ure 1 for two sample trajectories. The graph at the top depicts a regulated
Brownian motion without change of parameters, the one at bottom depicts a
ﬂexible version of the process; we have marked with a thick line the interval
of time (0.46, 0.62) during which the drift is µ(cid:48).

b

0

b

0

0

0

0.5

0.5

1

1

Figure 1: Sample trajectory of a regulated Brownian motion (top) and of
a ﬂexible Brownian motion (bottom). The parameters are b = 4, µ = −1,
µ(cid:48) = −10, σ2 = 10.

In the general formulation, the evolution of the buﬀer is controlled by a
continuous-time Markov chain called the process of phases. Whenever the
buﬀer reaches a boundary for the ﬁrst time after it has visited the other
boundary, the phase is allowed to undergo an instantaneous change.
It is

2

clear that the epochs when change may occur at a boundary form a semi-
regenerative set of points.

The stationary distribution of a Markov-modulated Brownian motion re-
stricted to a strip [0, b] is well-analyzed, as long as the boundaries are ab-
sorbing or regulated as in Ivanovs [14]. Here, we determine the stationary
distribution of our ﬂexible MMBMs by following a Markov-regenerative ap-
proach. The usefulness of this approach has been repeatedly demonstrated
for ﬂuid queues (aka ﬁrst-order ﬂuid processes) as in da Silva Soares and La-
touche [8, 10], Latouche and Taylor [19], Bean and O’Reilly [1]. It has been
adapted in Latouche and Nguyen [18] to MMBMs with one reactive bound-
arys, by which we mean any boundary that is not absorbing or regulated.
As we shall demonstrate later, the eﬀectiveness of our method extends far
beyond the model analyzed here.

To determine the stationary distribution, the key ingredients needed are
the expected time spent in an interval [0, x] and in a given phase during
an excursion from 0 to b for the process regulated at 0, and from b to 0
for the process regulated at b, as well as the distribution of the phase upon
reaching a boundary. To obtain these quantities, we rely on the connections
between MMBMs and their approximating Markov-modulated ﬂuid models,
exempliﬁed in Latouche and Nguyen [16, 17, 18].

Our results are related to those in Bean et al. [2]: the authors analyze
sojourn times in speciﬁed intervals during various excursions for ﬂuid queues
with reactive boundaries. The main diﬀerences are that we consider jointly
the level and the phase, and that we deal with Markov modulated Brownian
motion. We should also mention the results in Breuer [4] about occupation
times before a two-sided exit; we discuss later in some detail the connection
with our results.

The paper is organized as follows. We give in the next section the techni-
cal deﬁnition of ﬂexible Markov-modulated Brownian motions and we outline
the Markov-regenerative approach for obtaining their stationary distribution.
Section 3 includes background material and notation required for the paper.
We determine in Sections 4 and 5 the ﬁrst passage probabilities from one
boundary to the other, and the expected time spent during these excursions.
In Section 6, we bring all partial results together and determine the sta-
tionary distribution of a ﬂexible MMBM. We give three numerical examples
in Section 7, we compare in Section 8 our results to the existing literature,
and we conclude in Section 9 with a discussion on the applicability of our
approach to more complex models.

3

2 Flexible Markov-modulated Brownian motion
A free-boundary Markov-modulated Brownian motion is a two-dimensional
Markov process {X(t), κ(t)}t≥0 such that

(cid:90) t

(cid:90) t

X(t) = X(0) +

µκ(s) ds +

σκ(s) dB(s),

0

0

where {B(t)}t≥0 is a standard Brownian motion and {κ(t)} is a continuous-
time Markov chain on the state space E = {1, . . . , m}, with generator Q. We
i )i∈E, respectively, the drift and
denote by ∆µ = diag(µi)i∈E and ∆2
variance matrices of the MMBM. We assume that σi > 0 for all i in order to
signiﬁcantly simplify the presentation.
A Markov-modulated Brownian motion {Z(t), κ(t)}t≥0 with two regulated

σ = diag(σ2

boundaries at 0 and at b > 0 is deﬁned as

Z(t) = X(t) + R0(t) − Rb(t),

where {R0(t)}t≥0 and {Rb(t)}t≥0 are nonnegative, continuous and almost
surely nondecreasing processes; R0(t) increases only when Z(t) is at zero and
Rb(t) only when Z(t) is at b. The regulators {R0(t)}t≥0 and {Rb(t)}t≥0 are
the minimal processes keeping Z(t) in [0, b].

Next, we allow the phase to change as a reaction to Z(t) reaching either
level b or level 0. The general idea is that the ﬂexible MMBM evolves like Z(t)
during a regeneration interval (θ, θ(cid:48)), but at time θ(cid:48) the phase immediately
switches to a new value according to the transition probability matrix P •,
in case Z(θ(cid:48)) = b, and according to another probability matrix P ◦ in case
Z(θ(cid:48)) = 0. The technical details follow.
Our pathwise construction of a ﬂexible MMBM {Y (t), ρ(t)}t≥0 starts
with a countably inﬁnite supply of independent copies of regulated MMBMs
{Zn(k; t), κn(k; t)}, such that κn(k; 0) = k, for n ≥ 0 and k ∈ E. We assume
that Zn(k; 0) = 0 if n is even, and Zn(k; 0) = b for odd n. All processes have
the same parameters:
lower and upper bounds 0 and b, generator Q, drift
and variance matrices ∆µ and ∆2
σ. Most of these processes will not be used,
but they allow us to maintain independence where our construction requires
it.
Without loss of generality, assume that Y (0) = 0 and ρ(0) = i ∈ E, and

let θ0 = 0. We deﬁne

Y (t) = Z0(i; t),

ρ(t) = κ0(i; t)

for 0 ≤ t < θ1,

where θ1 = inf{t > 0 : Z0(i; t) = b} is the ﬁrst hitting time to level b. Upon
hitting level b, the phase ρ instantaneously changes to some value j according

4

to the transition matrix P •, and we deﬁne

Y (t) = Z1(j; t − θ1),

ρ(t) = κ1(j; t − θ1)

for θ1 ≤ t < θ1 + h2,

where h2 = inf{t > 0 : Z1(j; t) = 0}. Upon hitting level 0, ρ changes to a
new value according to P ◦, and so on.
n ≥ 0 the following:

In general, starting with θ0 = 0 and ρ(0) = i, we recursively deﬁne for

in = ρ(θn),
hn+1 = inf{t > 0 : Zn(in; t) = b 1{n is even}},
θn+1 = θn + hn+1,
ρ(θn+1) is obtained from the row κn(in; hn+1) of the matrix P • if n is
even, and of P ◦ if n is odd,

and

Y (t) = ZN (ρ(θN ); t − S),

(1)
where N = arg max{s : θs ≤ t} and S = θN. As limn→∞ θn = ∞, this deﬁnes
{Y (t), ρ(t)} over the whole interval [0,∞).

ρ(t) = κN (ρ(θN ); t − S),

By construction,

θ2n+1 = inf{t > θ2n : Y (t) = b}
θ2n = inf{t > θ2n−1 : Y (t) = 0}

for n ≥ 0,

for n ≥ 1,

and {θn}n≥0 forms a set of semi-regenerative points for {Y (t), ρ(t)} on the
state space {0, b} × E. Because of the discontinuity introduced at the regen-
eration points, we shall need to deﬁne the two limits, from the left and from
the right,

ρ(θ−

n ) = lim
t↑θn

ρ(t),

ρ(θ+

n ) = lim
t↓θn

ρ(t);

the trajectories of {ρ(t)} are right-continuous, and so ρ(θn) = ρ(θ+

n ) for all n.
The semi-Markov kernel D(·) for the transitions between semi-regenerative

points is deﬁned as

D(x,i),(y,j)(t) = P[θn+1 − θn ≤ t, ρ(θ−

n+1) = j, Y (θn+1) = y |

(2)

Y (θn) = x, ρ(θ−

n ) = i],

(cid:21)

(cid:20)

0

D0(t)

Db(t)

0

5

where x, y ∈ {0, b} and i, j ∈ E. By construction, again, the structure of D
is

D(t) =

,

(3)

where Dx(·) records the transition probabilities from ρ(θ−
that Y (θn) = x.

n ) to ρ(θ−

n+1) given

We need to make some irreducibility assumption at this point, for the ar-
guments that follow to hold. In view of our elementary introductory example,
we should not automatically assume, as is usually done, that the generator Q
is irreducible: in that example, one may consider that there is one phase and
two distinct sets of parameters, one for the even-numbered and one for the
odd-numbered intervals. One may also view that there are two phases, one
with mean drift µ and one with mean drift µ(cid:48), and that there is no connection
between the two, except through the boundary feedback mechanism. For the
time being, we make the following assumption only and we give in Section 6
simple conditions for it to hold.

Assumption 2.1 The transition matrix D is irreducible. In other words,
for any pair of states (x, i) and (y, j), there is a path of positive probability
from (Y (0) = x, ρ(0) = i) to (Y (θn) = y, ρ(θn) = j), for some n.

Next, we deﬁne the matrix Θ(x) of expected sojourn times: for y = 0 or
b, i and j in E, and x ≥ 0, the component Θy;i,j(x) is the expected time spent
by the process in the set [0, x]×{j} during a regeneration interval [θn, θn+1),
conditionally given that Y (θn) = y and ρ(θ−
n ) = i. We display that matrix
as

(cid:20) Θ0(x)

Θb(x)

(cid:21)

.

Θ(x) =

By Çinlar [6, Sect.10.4, Prop.4.9], the joint stationary distribution Π(x) of
{Y (t), ρ(t)} is given by

Π(x) = (d θ)−1d Θ(x),

(4)
where θ = Θ(∞)1, with 1 a column vector of 1s, is the vector of expected
length of a regenerative interval, given the initial state, and d is the stationary
distribution of the phase immediately before the end of the next interval, that
is, dD(∞) = d, and d1 = 1.
In Theorem 2.2 below, we express Π(x) directly in terms of properties of
the regulated Brownian motion {Z(t), κ(t)}. For that purpose, we introduce
the transition probability matrices

(H0)ij = P[δb < ∞, κ(δb) = j|Z(0) = 0, κ(0) = i],
(Hb)ij = P[δ0 < ∞, κ(δ0) = j|Z(0) = b, κ(0) = i],

(5)
(6)
where δx = inf{t > 0 : Z(t) = x} is the ﬁrst passage time to level x, and we
deﬁne the matrices of expected sojourn times in the interval [0, x] during an

6

0

(cid:90) δb
(cid:90) δ0
(cid:3) with

0

excursion from level 0 to level b, and from level b to level 0:

(M0(x))ij = E[

(Mb(x))ij = E[

1{Z(s) ∈ [0, x], κ(s) = j} ds|Z(0) = 0, κ(0) = i],

1{Z(s) ∈ [0, x], κ(s) = j} ds|Z(0) = b, κ(0) = i].

(7)

(8)

Theorem 2.2 The stationary distribution Π(x) of the ﬂexible Markov-modulated
Brownian motion {Y (t), ρ(t)} is given by Π(x) = (ν m)−1νM (x), where

ν =(cid:2)ν 0 ν b

ν 0 = ν 0H0P •HbP ◦

ν b = ν 0H0P •,

ν 0 being unique up to a multiplicative constant,

(cid:20)M0(x)

(cid:21)

Mb(x)

,

M (x) =

and m = M (b)1.

Proof By our deﬁnition (2) of the semi-Markov kernel, starting from one of
the two boundaries at time θn, a new phase is chosen with the corresponding
matrix P ◦ or P •, and then a process stochastically identical to {Z(t)} evolves
until it reaches the other boundary. Thus, D0(∞) = P ◦H0 and Db(∞) =
P •Hb or, in matrix form,

The stationary probability vector d of D(∞), written as d =(cid:2)d0 db

Hb

0

.

(9)

(cid:3), sat-

0
0 P •

D(∞) =

(cid:20)P ◦

(cid:21)(cid:20) 0 H0

(cid:21)

isﬁes the equations

d0 = dbP •Hb,

db = d0P ◦H0,

or

d0 = d0P ◦H0P •Hb,

(10)
The matrix P ◦H0P •Hb is the transition probability matrix from a phase
immediately before a regeneration at level 0 to the phase immediately before
the next regeneration at 0; it is irreducible by Assumption 2.1 and so the
vector d0 is unique, up to a multiplicative constant.

db = d0P ◦H0.

By the same argument that leads to (9), we conclude that

(cid:20)Θ0(x)

(cid:21)

Θb(x)

(cid:20)P ◦

=

0
0 P •

(cid:21)(cid:20)M0(x)

(cid:21)

Mb(x)

,

7

and so, by (4),

Π(x) = c(cid:2)d0 db

(cid:3)(cid:20)P ◦

0
0 P •

(cid:21)(cid:20)M0(x)
(cid:21)

Mb(x)

for some normalizing constant c. The remainder of the proof is immediate
(cid:3)
once we deﬁne ν 0 = d0P ◦ and ν b = dbP•.
In consequence of Theorem 2.2, we need only to take into consideration a
simple MMBM with two regulated boundaries, and to focus on one excursion
from a boundary to the other. This we do in Sections 4 and 5. Before that,
we recall some basic properties of MMBMs.

of the matrix equation

∆2

σX 2 + 2∆µX + 2Q = 0,

3 Background material and notation
We analyze in Sections 4 and 5 a regulated process controlled by a phase
process with an irreducible generator Q and a unique set of parameters µ
and σ. Unlike the process deﬁned in Section 2, there is no reaction of the
phase when the buﬀer reaches a boundary and, to ensure that there is no
confusion with the matrices H and M deﬁned in (5–8), we use the symbols
H and M.

Two matrices play an important role in the analysis of MMBMs. They

are denoted as U and (cid:98)U in the present paper, and U and −(cid:98)U are solutions
with U being the minimal solution and −(cid:98)U being the maximal solution,
2∆µz + 2Q) in the negative half complex plane and the eigenvalues of −(cid:98)U
Both matrices are irreducible generators: (cid:98)U is the generator of the Markov

are the roots in the positive half-plane (see D’Auria et al. [12, Section 4] and
Latouche and Nguyen [16, Lemma 5.3]).
chain {κ(δx)}x≥0 and U is the generator of the Markov chain {κ(δ−x)}x≥0.
One recognizes three diﬀerent cases, based on the sign of the mean drift αµ,
where α is the stationary distribution of Q (αQ = 0, α1 = 1):

meaning that the eigenvalues of U are the roots of the polynomial det(∆2

U is nonsingular.

1. If αµ > 0, then (cid:98)U 1 = 0 and U 1 ≤ 0, with at least one strict inequality,
2. If αµ < 0, U 1 = 0 and (cid:98)U 1 ≤ 0, with at least one strict inequality, (cid:98)U
3. If αµ = 0, both U 1 and (cid:98)U 1 are equal to 0.

is nonsingular.

(11)

σz2 +

8

We prove in [16, 17] that Markov-modulated Brownian motions can be
approximated by a family of fast oscillating free-boundary ﬂuid processes
{X λ(t), βλ(t), κλ(t)}t≥0 parameterized by λ > 0, where {βλ(t), κλ(t)} is a
two-dimensional Markov process on the state space S = {1, 2} × E, with
generator

(cid:21)

λI

Q − λI

(cid:20) Q − λI
(cid:90) t

λI

X λ(t) =

C λ

βλ(u),κλ(u) du,

0

T λ =

,

(12)

and the level process {X λ(t)} is driven by the phase {βλ(t), κλ(t)} as follows

with

(cid:20) ∆µ +

C λ =

√
λ∆σ

∆µ − √

λ∆σ

(cid:21)

.

(13)

Consider the family of regulated processes {Z λ(t), βλ(t), κλ(t)} with bound-
aries at 0 and at b > 0, and initial phase βλ(0) equal to 1 or 2 with equal
probability 0.5, for all λ. By [16, Thm.3.1], the regulated MMBM {Z(t), κ(t)}
deﬁned in Section 2 is the weak limit of the projected process {Z λ(t), κλ(t)},
and the stationary distribution of the former arises as the limit of that of
the latter as λ → ∞. In consequence, the sojourn time matrix M(x) and
the ﬁrst passage probability matrix H are the limits of the corresponding
matrices for the projected process as λ → ∞.
We partition the state space into the subsets S+ and S−, where S+ =
{(i, j) ∈ S : cij > 0} and S− = {(i, j) ∈ S : cij < 0}. For suﬃciently
large λ, S+ = {(1, j) : j ∈ E} and S− = {(2, j) : j ∈ E}. Several matrices are
partitioned in a conformant manner. For instance, we write T λ as

(cid:20)T λ

(cid:21)

T λ =

++ T λ
+−
T λ
−+ T λ
−−

.

Two ﬁrst passage probabilities are needed in the next section. One is Ψλ
b ,
indexed by S+ ×S−, which records the probability that, starting from level 0
in a state of S+, Z λ returns to level 0 before reaching level b; the other matrix,
b is indexed by S+ × S+ and records the probability that level b is reached
Λλ
before a return to level 0:

(Ψλ
(Λλ

b )(1,i)(2,j) = P[δλ
b )(1,i)(2,j) = P[δλ

0 < δλ
b < δλ

b , κλ(δλ
0 , κλ(δλ

0 ) = j | Z λ(0) = 0, βλ(0) = 1, κλ(0) = i], (14)
b ) = j | Z λ(0) = 0, βλ(0) = 1, κλ(0) = i].

9

4 Transition probability matrices
Starting from any state in S at time 0, the process {Z λ(t), βλ(t), κλ(t)} is
necessarily in a state of S+ at time δλ
0 of ﬁrst passage
probability from level 0 to level b has the structure

b , and the matrix H λ

(cid:20)H λ

(cid:21)

H λ

0 =

++
H λ
−+

.

(We omit the subscript 0 for the sub-matrices in the following calculations as
there is no ambiguity.) Since βλ(0) is equal to 1 or 2 with equal probabilities,
we have

H0 = lim

++ + 0.5H λ

λ→∞(0.5H λ

(15)
Now, starting in a phase of S−, the ﬂuid remains at level 0 until it ﬁrst moves
to a phase of S+, with the transition probability matrix
−+ = (λI − Q)−1λI = (I − 1
λ

Q)−1,

−+).

(−T λ
−+ = (I − 1

−−)−1T λ
λ Q)−1H λ

so that H λ

++, and we see from (15) that
H0 = lim

(16)
Starting from level 0 in a phase of S+, the ﬂuid queue may move directly to
level b without returning to level 0, or it may return to level 0 before having
reached level b. Thus,

λ→∞ H λ
++.

H λ

++ = Λλ

b + Ψλ
= Λλ
b + Ψλ
= (I − Ψλ

b H λ
−+
b (I − 1
Q)−1H λ
λ
b (I − 1
Q)−1)−1Λλ
λ

++

b

and we ﬁnd that

H0 = lim

λ→∞(I − Ψλ

b )−1Λλ
b .

(17)

With this, we are in position to prove the following theorem.
Theorem 4.1 Consider an MMBM regulated at level 0. The matrix H0 of
ﬁrst passage probability from level 0 to level b is
H0 = (−Pb)−1Lb,

10

where Lb and Pb are solutions of the linear system

(cid:2)Lb Pb

(cid:3)(cid:20) I
e(cid:98)U b

(cid:21)

eU b
I

(cid:104)−(cid:98)U e(cid:98)U b U

(cid:105)

.

(18)

= ∆σ

The matrix Pb is a sub-generator and is nonsingular.

If αµ (cid:54)= 0, then the system (18) is nonsingular and its solution may be

written as

Lb = −∆σ(U +(cid:98)U )e(cid:98)U b(I − eU be(cid:98)U b)−1
Pb = ∆σ(U +(cid:98)U e(cid:98)U beU b)(I − e(cid:98)U beU b)−1.

(19)
(20)

(21)

In that case,

H0 = e(cid:98)U b + (e−U b − e(cid:98)U b)(U e−U b +(cid:98)U e(cid:98)U b)−1(cid:98)U e(cid:98)U b.

If αµ = 0, then the system (18) is singular and one needs the additional
equation

Lb(b1 − Q#µ) − PbQ#µ = σ

to completely characterize Lb and Pb, where Q# is the group inverse of Q.

Proof It results from [16, Lemma 5.5] that

Λλ

b =

1√
λ

Lb + O(

1
λ

),

Ψλ

b = I +

1√
λ

Pb + O(

1
λ

),

where (Lb, Pb) is a solution of (18) and that Pb is nonsingular. We readily
conclude from (17) that H0 = (−Pb)−1Lb. Furthermore, (19, 20) directly
result from [16, Eqn (33) and (34)] when αµ (cid:54)= 0.
If αµ = 0, then both eU b and e(cid:98)U b are stochastic matrices, the coeﬃcient
matrix of (18) is singular, and we need an additional equation. D’Auria et
[11] analyze ﬁrst exit probabilities for the MMBM process {X(t), κ(t)}
al.
and determine the exit probabilities from the interval [0, b]

P (x, 0) = P[δ0 < δb, κ(δ0)|X(0) = x],
P (x, b) = P[δb < δ0, κ(δb)|X(0) = x],

for 0 ≤ x ≤ b. Equations (56, 58) in [11] may be written as
(cid:104)
e(cid:98)U (b−x) eU x

(cid:2)P (x, b) P (x, 0)(cid:3)(cid:20) I
e(cid:98)U b

eU b
I

(cid:21)

=

(cid:105)

(22)

11

and

P (x, b)((b − x)1 + h) + P (x, 0)(−x1 + h) = h,

(23)

with h being any solution of the system Qh = −µ.
The matrix Q has one eigenvalue equal to zero and such solutions are
of the form h = −Q#µ + c1, where c is an arbitrary scalar, and Q# is the
unique solution of the linear system XQ = I − 1α, X1 = 0; that matrix is
called the group inverse of Q (Campbell and Meyer [5]). As Q is a generator,
Q# is also called the deviation matrix of the Markov process with generator
0 (eQu−1α) du.

Q (Coolen-Schrijner and van Doorn [7]), and one has Q# =(cid:82) ∞

In addition, it is shown in [16, Section 6.2] that

Lb = ∆σ lim
x→0

∂
∂x

P (x, b)

and

Pb = ∆σ lim
x→0

∂
∂x

P (x, 0).

Premultiplying both sides of (22) by ∆σ and taking the derivative, we obtain(18)
as x → 0. Similarly,

Lb(b1 + h) − ∆σP (0, b)1 + Pbh − ∆σP (0, 0)1 = 0,

follows from (23). As P (0, b) = 0 and P (0, 0) = I, the last equation is
identical to (21) if we chose h = −Q#µ. This completes the proof.
(cid:3)
We may follow a similar line of argument to determine the matrix Hb
of ﬁrst passage probabilities from the upper boundary to the boundary at
level 0, We may also, as an alternative, deﬁne the level-reversed process

{(cid:98)X(t), κ(t)}, where (cid:98)X(t) = −Z(t). For this process, the ﬂuid rate vector
becomes (cid:98)µ = −µ, the rôles of the matrices U and (cid:98)U are exchanged, and the
ﬁrst passage probability matrix (cid:98)H0 from 0 to b of the regulated process of
{(cid:98)Z(t)} is equal to Hb, the ﬁrst passage probability matrix of {Z(t)} from b

to 0. The proof of the corollary below is immediate and is omitted.

Corollary 4.2 Consider an MMBM regulated at level 0 and b. The matrix
Hb of ﬁrst passage probability from the boundary b to the boundary 0 is

Hb = (−(cid:98)Pb)−1(cid:98)Lb,
(cid:105)(cid:20) I
e(cid:98)U b

eU b
I

= ∆σ

(cid:21)

where

(cid:104)(cid:98)Pb (cid:98)Lb

(cid:104)(cid:98)U −U eU b(cid:105)
The matrix (cid:98)Pb is an irreducible subgenerator and is nonsingular.
If αµ (cid:54)= 0, then(cid:98)Lb = −∆σ(U +(cid:98)U )eU b(I − e(cid:98)U beU b)−1
(cid:98)Pb = ∆σ((cid:98)U + U eU be(cid:98)U b)(I − eU be(cid:98)U b)−1,

.

(24)

12

and

Hb = eU b + (e−(cid:98)U b − eU b)((cid:98)U e−(cid:98)U b + U eU b)−1U eU b.

If αµ = 0, then (cid:98)Lb and (cid:98)Pb are determined by the system (24) and the addi-

tional equation

(cid:98)Lb(b1 + Q#µ) + (cid:98)PbQ#µ = σ.

(25)
(cid:3)

5 Expected time in [0, x] during an excursion
We determine in this section the matrix M0(x) of expected sojourn time of
a regulated MMBM {Z(t), κ(t)} during an excursion from 0 to b. It soon
becomes clear that to do so, we need to deal at the same time with excursions
from b to 0 by the same process. The matrix of expected sojourn time in
[0, x] during such an excursion is denoted as Mb(x).
0 (x) to be the matrix of expected sojourn time of the rapidly
switching process {Z λ(t), βλ(t), κλ(t)}t≥0 in [0, x] during an excursion from
0 to b:

We deﬁne M λ

(M λ

0 (x))((cid:96),i)(k,j) = E[

1{Z λ(s) ∈ [0, x], βλ(s) = k, κλ(s) = j}
|Z λ(0) = 0, βλ(0) = (cid:96), κλ(0) = i],

(26)
where θλ = inf{t > 0 : Z λ(t) = b} is the ﬁrst passage time to level b. We
partition that matrix as

(cid:90) θλ

0

M λ

0 (x) =

0;++(x) M λ
0;−+(x) M λ

0;+−(x)
0;−−(x)

M λ

and, by an argument similar to the one that leads to (16), we ﬁnd that
M0(x) = limλ→∞(M λ

0;++(x) + M λ

0;+−(x)).

Next, we deﬁne M λ

b (x) to be the matrix of expected sojourn in [0, x]

during an excursion from b to 0 and we partition it as

M λ

b (x) =

b;++(x) M λ
b;−+(x) M λ

b;+−(x)
b;−−(x)

M λ

;

one shows that Mb(x) = limλ→∞(M λ
b;−+(x) + M λ
equations in the remainder of this section, we write

0;+ =(cid:2)M λ

M λ

0;+−(x)(cid:3)

0;++(x) M λ

b;−−(x)). To simplify our

b;− =(cid:2)M λ

M λ

b;−−(x)(cid:3) ,

b;−+(x) M λ

and

13

(cid:20)M λ

(cid:20)M λ

(cid:21)

(cid:21)

and we summarize as follows the discussion above:

(cid:21)

(cid:20)M0(x)Mb(x)
(cid:20)−P −1
−(cid:98)P −1

b

b

= lim
λ→∞

(cid:21)(cid:20) I
e(cid:98)Kb

(cid:21)

.

0;+(x)
b;−(x)

(cid:21)(cid:20)I
(cid:20)M λ
(cid:21)−1(cid:20)

M λ

I

(cid:21)
e(cid:98)K(b−x)F((cid:98)K; x)

F(K; x)

Theorem 5.1 If αµ (cid:54)= 0, then

(cid:21)

(cid:20)M0(x)Mb(x)

= 2

(27)

∆−1
σ ,

(28)

where

and

F(A; x) =

eAu du,

(29)

K = ∆σU ∆−1

σ + 2∆−2

σ ∆µ

0

and

(cid:98)K = ∆σ(cid:98)U ∆−1

σ − 2∆−2

σ ∆µ.

eKb
I

(cid:90) x

(cid:90) δλ

0 ∧δλ

b

To prove this, we we proceed in three preliminary steps: we express
0;+(x) and M λ
b;−(x) in terms of exit times from the interval (0, b), next
M λ
we analyze ﬁrst passage times for the unregulated ﬂuid process, and we es-
tablish a connection between the two. In the ﬁnal step we prove (28) through
a limiting argument.

Step A. We deﬁne the matrix N λ
hits either level 0 or level b, starting from 0 in a phase of S+:

0 (x) of sojourn time in [0, x] until {X λ(t)}

(N λ

0 (x))(1,i);(k,j) = E[

1{X λ(s) ∈ [0, x], βλ(s) = k, κλ(s) = j} ds

0

|X λ(0) = 0, βλ(0) = 1, κλ(0) = i],

(30)

for (1, i) ∈ S+, (k, j) ∈ S.

Lemma 5.2 The matrix M λ
the excursion [0, θλ] from level 0 to level b is given by

0;+(x) of expected sojourn time in [0, x] during

(cid:2)0 (−T λ

−−)−1(cid:3)),

(31)

0;+(x) = (I − Ψλ
M λ
b and N λ

b (−T λ

−−)−1T λ

−+)−1(N λ

0 (x) + Ψλ
b

where Ψλ

0 (x) are deﬁned in (14) and (30), respectively.
b ] ∪ [δλ

0 ∧ δλ

Proof We decompose the interval [0, θλ] as [0, δλ
obtain

0 ∧ δλ

b , θλ], and

M λ

0;+(x) = N λ

0 (x) + Ψλ
b

b (−T λ

−−)−1T λ

−+M λ

0;+(x).

(32)

(cid:2)0 (−T λ

−−)−1(cid:3) + Ψλ

14

To justify this, we observe that the process must accumulate time in [0, x]
until it hits one of the boundaries; this corresponds to the ﬁrst term in (32).
With probability Ψλ
b , the process has returned to level 0, where it accumu-
lates more time (the second term), and then leaves level 0 and accumulates
time during the remainder of the excursion (the third term). Equation (31)
(cid:3)
immediately follows.
The proof of the next lemma is omitted as it merely mimics the proof of
Lemma 5.2. For excursions that start in b, we deﬁne a new set of matrices:
the transition probability matrices

and the matrix N λ
level b, starting from level b in a phase of S−:

0 , κλ(δλ
b , κλ(δλ
b (x) of sojourn time in [0, x] until {X λ(t)} hits level 0 or

b )| Z λ(0) = b, βλ(0) = 2, κλ(0)]
0 )| Z λ(0) = b, βλ(0) = 2, κλ(0)]
(cid:90) δλ

on S− × S+,
on S− × S−,

(33)

0 ∧δλ

b

1{X λ(s) ∈ [0, x], βλ(s), κλ(s)} ds

0

|X λ(0) = b, βλ(0) = 2, κλ(0)]

(34)

N λ

b (x) = E[

(cid:98)Ψλ
(cid:98)Λλ

b = P[δλ
b = P[δλ

b < δλ
0 < δλ

on S− × S.
Lemma 5.3 The matrix M λ
excursion from level b to level 0 is given by
+−)−1(N λ

b;−(x) = (I −(cid:98)Ψλ

++)−1T λ

b (−T λ

M λ

b;−(x) of expected sojourn time in [0, x] during an

b (x) +(cid:98)Ψλ

b

(cid:2)0 (−T λ

++)−1(cid:3))

b and N λ

b (x) are deﬁned in (33) and (34), respectively.

(cid:3)

where (cid:98)Ψλ

Step B. Next, we characterize expected sojourn times during intervals
b ) for the unregulated process {X λ(t), βλ(t), κλ(t)}. We deﬁne
(0, δλ
the matrices

0 ) or (0, δλ

(cid:90) δλ

0

0

Γλ

0 (x)) = E[

1{X λ(s) ∈ [0, x], βλ(s), κλ(s)} ds
|X λ(0) = 0, βλ(0) = 1, κλ(0)],

indexed by S+ × S, and

(cid:98)Γλ

b (x) = E[

(cid:90) δλ

b

0

1{X λ(s) ∈ [0, x], βλ(s), κλ(s)} ds
|X λ(0) = b, βλ(0) = 2, κλ(0)],

15

to 0, starting from 0 in a phase of S+, while (cid:98)Γλ

indexed by S− × S. The matrix Γλ
0 (x) records the expected sojourn time
of {X λ(t), βλ(t), κλ(t)} in the interval [0, x] during an interval of ﬁrst return
b (x) corresponds to a ﬁrst
return to b, starting from level b in a phase of S−.

We can show that

(35)

(cid:90) x
eKλu du(cid:2)(C λ
= F(K λ; x)(cid:2)(C λ

0

Γλ

0 (x) =

−|−1(cid:3)
−|−1(cid:3) ,

+)−1 Ψλ|C λ
+)−1 Ψλ|C λ

where

+)−1T λ

++ + Ψλ|C λ

−|−1T λ

K λ = (C λ

(36)
and Ψλ, indexed by S+ × S−, is the matrix of ﬁrst return probability from
level 0 back to level 0; it is the minimal nonnegative solution of the Riccati
equation

−+

(C λ

+)−1T λ

+− + (C λ

+)−1T λ

++Ψλ + Ψλ|C λ

−|−1T λ

−− + Ψλ|C λ

−|−1T λ

−+Ψλ = 0.

(37)

For details, we refer to Rogers [21] and Latouche and Nguyen [17]. We give in
Appendix A a technical demonstration of (35); a simple justiﬁcation is that
(eKλu)s,s(cid:48) is, for any states s and s(cid:48) in S+, the expected number of crossings of
level u in phase s(cid:48) under taboo of the level 0, given that the process {X λ(t)}
starts in level 0 and phase s (Ramaswami [20]).
If αµ < 0, then all eigenvalues of K λ are in C<0, the set of complex
numbers with strictly negative real part, and K λ is nonsingular. If αµ ≥ 0,
then one eigenvalue is equal to 0, the others are in C<0, and K λ does not
have an inverse. Thus, the integral in (35) takes diﬀerent algebraic forms
according to the case.

Lemma 5.4 If all the eigenvalues of the matrix A are in C<0, then

F(A; x) = (−A)−1(I − eAx).

(38)

If A has all its eigenvalues in C<0, with the exception of one eigenvalue equal
to 0, then

F(A; x) = (−A#)(I − eAx) + xvaua,

(39)
where va and ua are the right- and left-eigenvectors of A associated to the
eigenvalue 0, and A# is the group inverse of A.

Proof The proof is by veriﬁcation that both sides of (38) and of (39) are
(cid:3)
equal for x = 0 and have the same derivative with respect to x.

16

The matrix(cid:98)Γλ
(cid:98)Γλ

where

,

(40)

b (x) =

b−x

b (x) is given by
e(cid:98)Kλu du

(cid:90) b
+)−1(cid:105)
(cid:104)|C λ
−|−1 (cid:98)Ψλ(C λ
+)−1(cid:105)
(cid:104)|C λ
= e(cid:98)Kλ(b−x)F((cid:98)K λ; x)
−|−1 (cid:98)Ψλ(C λ
−− +(cid:98)Ψλ(C λ
(cid:98)K λ = |C λ
−|−1T λ
−−(cid:98)Ψλ +(cid:98)Ψλ(C λ

++ +(cid:98)Ψλ(C λ

−|−1T λ

+)−1T λ

+)−1T λ

and (cid:98)Ψλ, indexed by S− × S, is the matrix of ﬁrst return probability from

level b back to level b. It is the minimal nonnegative solution of the equation

+)−1T λ

(41)

+−

|C λ

−|−1T λ

−+ + |C λ

(42)

To prove (40), we deﬁne the level-reversed process {(cid:98)X λ(t), βλ(t), κλ(t)} with
ﬂuid rate vector(cid:98)µ = −µ, and we observe that the time spent in [0, x] by the
We note for future reference that the eigenvalues of (cid:98)H λ are in C<0 if

process {X λ(t), βλ(t), κλ(t)} during an interval of ﬁrst return to b has the
same distribution as the time spent in [b − x, b] by the level-reversed process
during an interval of ﬁrst return to 0.

αµ > 0, otherwise the matrix has one eigenvalue equal to 0, with the others
in C<0.

+−(cid:98)Ψλ = 0.

In the third step, we establish a relation between (N λ

0 (x), N λ
b (x)), which leads us to an expression for the matrices M λ

b (x))
0;+(x)

Lemma 5.5 The matrix N λ(x) of mean sojourn times in (0, x) during the
interval (0, δλ

Step C.
and (Γλ
and M λ

0 (x),(cid:98)Γλ
b;−(x) as functions of K λ, (cid:98)K λ, Ψλ, and (cid:98)Ψλ.
(cid:35)(cid:20)N λ
(cid:21)
(cid:20)Γλ
(cid:98)Γλ
where K λ and (cid:98)K λ are given in (36) and (41).

(cid:34)
0 ∧ δλ
e(cid:98)Kλb(cid:98)Ψλ

b ) is a solution of the system

0 (x)
b (x)

eKλbΨλ

N λ

=

I

I

(cid:21)

0 (x)
b (x)

.

(43)

Proof The proof is similar to that of [9, Lemma 4.1] and we give below its
general outline only. First, observe that

Γλ
0 (x) = N λ

0 (x) + ΛbΓ∗(x),

17

where Γ∗(x) is the matrix of mean sojourn time in the interval (0, x) before
the unregulated process X λ(t) ﬁrst returns to level 0, starting from level b in
a phase of S+. Also,

Γ∗(x) = Ψλ(N λ

b (x) +(cid:98)ΨbΓ∗(x)) = (I − Ψλ(cid:98)Ψb)−1ΨλN λ
0 (x) + Λb(I − Ψλ(cid:98)Ψb)−1ΨλN λ

b (x).

b (x),

Γλ
0 (x) = N λ

and thus

Now, we recognise that

Λb(I − Ψλ(cid:98)Ψb)−1 = Λb(I + Ψλ(cid:98)Ψb + (Ψλ(cid:98)Ψb)2 + (Ψλ(cid:98)Ψb)3 + ··· )

is the matrix of expected number of visits to level b in a phase of S+, starting
from 0, before the ﬁrst return to level 0, and is thus equal to eKb (Ra-
maswami [20]). This gives the ﬁrst equation in (43); the second is similarly
(cid:3)
proved.

Remark 5.6 By [9, Lemma 4.2], the coeﬃcient matrix in (43) is nonsingu-
lar if αµ (cid:54)= 0, and so Lemma 5.5 completely characterizes N λ(x) for ﬂuid
processes with non-zero mean drift.

Proof of Theorem 5.1 By [16, Lemmas 5.1 and 5.2], we have

√
λ),
√

λ)

(cid:98)Ψλ = I + O(1/
(cid:98)K λ = (cid:98)K + O(1/
(cid:21)(cid:20)I
(cid:21)(cid:20)∆−1

σ

∆−1

σ

I

(cid:21)

I
I

+ O(

1
λ

)

e(cid:98)K(b−x)F((cid:98)K; x)

e(cid:98)K(b−x)F((cid:98)K; x)∆−1

σ

(cid:21)(cid:20)I

I

(cid:21)

I
I

+ O(

1
λ

).

(44)

since both C λ

λ∆σ + O(1). Therefore, (43) becomes

√
Ψλ = I + O(1/
λ),
√
K λ = K + O(1/
λ),

and so, by (35, 40),

(cid:21)

0 (x)
b (x)

(cid:20)Γλ
(cid:98)Γλ
(cid:20) I
e(cid:98)Kb

=

1√
λ

(cid:20)F(K; x)
(cid:21)
(cid:21)(cid:20)N λ
−| =
(cid:20)F(K; x)∆−1

0 (x)
b (x)

√

N λ

+ = |C λ

σ

eKb
I
1√
λ

=

By [17, Lemma 3.6],

18

values in C<0 and one eigenvalue equal to 0,

• if αµ < 0, then K has all eigenvalues in C<0 and (cid:98)K has m − 1 eigen-
• if αµ > 0, then (cid:98)K has all eigenvalues in C<0 and K has m − 1 eigen-
This entails that one of the two matrices eKb and e(cid:98)Kb has spectral radius
equal to one, with the other having spectral radius strictly less than one, so
(cid:20)N λ
that the left-most matrix in (44) is nonsingular when αµ (cid:54)= 0, and

values in C<0 and one eigenvalue equal to 0.

(cid:21)

(cid:20) I
e(cid:98)Kb
(cid:20)F(K; x)∆−1

1√
λ

eKb
I

σ

(cid:21)−1
e(cid:98)K(b−x)F((cid:98)K; x)∆−1

(cid:21)(cid:20)I

I

(cid:21)

I
I

0 (x)
b (x)

N λ

=

+ O(

).

(45)

1
λ

σ

√
λ(−Pb)−1 + O(1) by [16, Lemma
−+ = I + O(1/λ), by deﬁnition of T λ.

(46)

On the other hand, we have (I − Ψλ
5.5] and (T λ
Thus, (31) may be written as

b )−1 =
−−)−1 = O(1/λ), (−T λ
−−)−1T λ
√
0;+(x) = (
√

and similarly,

M λ

λ(−Pb)−1 + O(1))N λ

λ(−(cid:98)Pb)−1 + O(1))N λ

0 (x),

M λ

(cid:34)

b (x).

Equation (28) directly follows from (27, 45, 46, 47).

(47)
(cid:3)
It will be useful in Section 6 to have separate expressions for M0(x) and

b;−(x) = (

(cid:21)−1

(I − eKbe(cid:98)Kb)−1

Mb(x). Using
eKb
I

(cid:20) I
e(cid:98)Kb
M0(x) = 2(−Pb)−1(I − eKbe(cid:98)Kb)−1(F(K; x) − eKbe(cid:98)K(b−x)F((cid:98)K; x))∆−1
Mb(x) = 2(−(cid:98)Pb)−1(I − e(cid:98)KbeKb)−1e(cid:98)K(b−x)(F((cid:98)K; x) − e(cid:98)KxF(K; x))∆−1

we easily replace (28) by the pair of equations

(I − e(cid:98)KbeKb)−1

(cid:35)(cid:20) I
−e(cid:98)Kb

−eKb
I

,

(48)
(49)

σ ,
σ .

(cid:21)

=

The next corollary is obvious: we merely let x = b in (48, 49).
Corollary 5.7 If αµ (cid:54)= 0, then the expected time spent in the various phases
during an excursion from one boundary to the other is given by

M0(b) = 2(−Pb)−1(I − eKbe(cid:98)Kb)−1(F(K, b) − eKbF((cid:98)K; b))∆−1
Mb(b) = 2(−(cid:98)Pb)−1(I − e(cid:98)KbeKb)−1(F((cid:98)K, b) − e(cid:98)KbF(K; b))∆−1

σ
σ .

(cid:3)

19

Remark 5.8 In marked contrast to Theorem 4.1 and its Corollary 4.2, The-
orem 5.1 does not give an expression for M0(x) and Mb(x) if αµ = 0. In
that case, we might write, instead of (28), that M(x) is to be determined by

solving the system(cid:20) I
e(cid:98)Kb

eKb
I

(cid:21)(cid:20)PbM0(x)
(cid:21)
(cid:98)PbMb(x)

(cid:20)

(cid:21)
e(cid:98)K(b−x)F((cid:98)K; x)

F(K; x)

∆−1
σ ,

= −2

plus some additional equation. Unfortunately, this additional equation has
eluded us so far.

6 Stationary distribution of a ﬂexible MMBM
We have now obtained all the ingredients necessary to express the stationary
distribution of the ﬂexible MMBM {Y (t), ρ(t)} once we specify its parame-
ters.

It is natural to expect some of the parameters at least to take diﬀerent
values during the two legs of a regeneration cycle, from level 0 to level b and
back. We assume that the set E of phases is made up of two subsets, Eu and
Ed, and that the generator of {ρ(t)} is Q partitioned as follows:

(cid:20)Qu

(cid:21)

Q =

0
0 Qd

.

(50)

The idea is that Qu, on the state space Eu, describes the evolution of the
Markov environment during the up-leg, after a regeneration at level 0 until
the next regeneration at level b; Qd on the state space Ed controls the system
during a down-leg, from b to 0.

The other parameters are similarly partitioned and we write µ =(cid:2)µu µd
(cid:3)
(cid:3). The matrices P ◦ and P • control the transition from Ed
and σ =(cid:2)σu σd
(cid:20) I

to Eu upon hitting level 0 at the end of a down-leg, and from Eu to Ed upon
hitting b, and we write them as

(cid:20)0 P •

(cid:21)

(cid:21)

P ◦ =

0
P ◦
du 0

and

P • =

0

ud
I

.

The identity blocks on the diagonal do not play any role in the calculation
to follow, their role is to ensure that P ◦ and P • are stochastic matrices. We
assume that Qu and Qd are irreducible, and so Assumption 2.1 is satisﬁed.
Upon hitting 0 at a regeneration point and after choosing a new phase
with the matrix P ◦, the phase ρ is in Eu. Therefore, the vector ν 0 takes the

form ν 0 =(cid:2)ν 0;u 0(cid:3) and, for similar reasons, we have ν b =(cid:2)0 ν b;u

(cid:3).

20

As transitions from Eu to Ed or from Ed to Eu are possible at regeneration
points only, the matrices of ﬁrst passage probabilities from one level to the
other have the structure

(cid:20)H0;u

H0 =

0

0 H0;d

and

Hb =

(cid:21)

(cid:20)Hb;u

0

0 Hb;d

(cid:21)

(cid:21)

The only blocks that one needs to evaluate, however, are H0;u and Hb;d: the
value of H0;d is irrelevant as the process cannot leave level 0 in a phase of Ed
and Hb;u is irrelevant as well, for a similar reason.

Obviously, the matrices M0(x) and Mb(x) have the same structure

(cid:20)M0;u(x)

M0(x) =

0

0

M0;d(x)

and

Mb(x) =

(cid:20)Mb;u(x)

0

0

Mb;d(x)

(cid:21)

,

and we do not need to evaluate M0;d(x) or Mb;d(x).

Altogether, we may re-formulate Theorem 2.2 in a more detailed manner

as follows, using Theorem 4.1, Corollary 4.2, and equations (48, 49).

Theorem 6.1 The stationary distribution Π(x) of the ﬂexible Markov mod-
ulated Brownian motion is given by Π(x) = (ν∗ m∗)−1ν∗M∗(x). The vector

ν∗ is partitioned as ν∗ =(cid:2)ν 0;u ν b;d

(cid:3) where

ν 0;u = ν 0;uH0;uP •

udHb;dP ◦
du,

ν b;d = ν 0;uH0;uP •
ud,

with

H0;u = H0|Q=Qu,µ=µu,σ=σu

The matrix M∗(x) is partitioned as

and

(cid:20)M0;u(x)

Hb;d = Hb|Q=Qd,µ=µd,σ=σd

(cid:21)

.

Mb;d(x)

,

M∗(x) =

with
M0;u(x) = M0(x)|Q=Qu,µ=µu,σ=σu
The vector m∗ is given by m∗ = M∗(b)1.

and Mb;d(x) = Mb(x)|Q=Qd,µ=µd,σ=σd

.
(cid:3)

21

1

0

0

1

4

0

0

20

Figure 2: Cumulative stationary distribution functions for the single-phase
BM examples (left) and the cyclic-phases examples (right). The parameters
are clariﬁed in the text.
7
Illustration
Example 7.1 Single-phase Brownian motion. This is the example given
in the introduction: the environmental process has only one phase, possibly
characterized by diﬀerent parameters in alternating intervals between regen-
eration points. With one phase only, the calculations simplify considerably;

if µ is negative, then U = (cid:98)K = 0 and (cid:98)U = K = 2µ/σ2. Assuming that both

µu and µd are negative, we obtain from Theorem 6.1 that

Π(x) =

M0;u(x) + Mb;d(x)
M0;u(b) + Mb;d(b)

,

with
M0;u(x)+Mb;d(x) =

(cid:18) 1

(cid:19)

− 1
µu

µd

x+

σ2
d
2µ2
d

(1−e2µdx/σ2

d)− σ2
u
2µ2
u

e−2µub/σ2

u(1−e2µux/σ2
u).

If the parameters in the two types of intervals are equal, then further simpli-
ﬁcations yield the well-known truncated exponential distribution

Π(x) = (1 − e2µx/σ2)(1 − e2µb/σ2)−1.

The parameters for the three distributions shown on the left of Figure 2

are given in the table below.

Case

1
2
3

line
dotted
plain
dashed

µu σ2
u
10
-1
10
-1
-1
10

µd
-1
-10
-1

σ2
d
10
10
1

22

  123  123In Case 1, with a single set of parameters, the process is a regulated Brownian
motion with two boundaries, in Case 2 the drift is decreased to −10 when
the process reaches the upper boundary, and in Case 3 the drift remains the
same, but the variance is reduced.

As expected, the buﬀer content is stochastically smaller in Case 2 than
in Case 1: for instance, the 90th percentiles are 2.88 and 3.44 respectively.
We had expected that the buﬀer content would also be smaller in Case 3,
our argument being that, with a smaller variance, the negative drift would
be better felt, and the buﬀer content would go down faster. As one sees on
Figure 2 this is not the case and the buﬀer content is slightly larger in Case
3 (the 90th percentile is 3.48).

We give in the table below the expected total duration of excursions from
level 0 to level b and back from level b to level 0, and also the proportion
of time spent by the process in the regenerative intervals from 0 to b; this
quantity is Πu(b) = (ν∗m∗)−1ν 0;uM0;u(b)1.

Case M0;u(b) Mb;d(b) Πu(b)
1
0.63
0.86
2
3
0.38

1.25
0.35
3.50

2.13
2.13
2.13

Obviously, the time to move from 0 to b is the same in all cases, and
we do observe for Case 2 the eﬀect resulting from switching from µu = −1
to µd = −10. In Case 3, switching from σ2
d = 1 increases the
expected length of an excursion from b to 0 nearly by a factor 3.

u = 10 to σ2

Example 7.2 Cyclic environmental process. In this example, m = 8
and the process of phases evolves cyclically from 1 to 8 and back to 1. We
take Qu = Qd = Ω with Ωi,i+1 = λ, for i = 1, . . . , 7, Ω8,1 = λ, Ωii = −λ for
all i, the other elements are equal to 0. In the three cases to follow, we have
λ = 0.1, so the process moves from one phase to the next in 10 units of time
on average. The other parameters are µi = −1 for all i, and σi = 1 for all
i (cid:54)= 8 and σ8 = 10. Thus, the process is quite regular most of the time but
every 80 units of time, on average, the volatility becomes very high during
10 units of time.

In Case 1 (dotted line on the right-hand side graph of Figure 2), the
buﬀer is inﬁnite. One observes the eﬀect of the irregularity, infrequent but
very high, of the input process: the stationary expected buﬀer occupancy is
E[X∞] = 6.69, but the distribution has a very long tail, with P[X∞ > 20] =
0.12. Actually, this tail decreases at a rate equal to the maximal eigenvalue
of K, equal to −0.14 in the present example.

23

M0;u
Mb;d Case 2
Mb;d Case 3

1

109.20
19.49
2.00

2

99.20
19.45
2.00

3

89.20
19.34
2.00

4

79.20
19.03
2.00

5

69.20
18.22
2.00

6

59.20
16.36
1.99

7

49.20
12.66
1.97

8

39.24
6.34
1.53

Table 1: Cyclic environment, moments of ﬁrst passage time from one bound-
ary to the other.

In Case 2 (dashed line), the buﬀer is ﬁnite, with b = 20 and the other
parameters are the same as in Case 1. In Case 3 (plain line), µu and σu =
σd are the same as in Case 2, and µd = 10µu. One clearly see that the
buﬀer content is smallest in Case 3, the 90th percentile, for instance, is 5.40,
compared to 8.20 in Case 2.

It is interesting to examine in more details the behavior of the two pro-
cesses. The transition matrix H0;u is the same in both cases and the probabil-
ity mass is almost exclusively concentrated on the 8th column: the computed
values are (H0;u)i,8 = 0.9995 and (H0;u)i,1 = 0.0005, independently of i, the
remaining elements of the matrix being negligible.

We give in Table 1 the expected duration of transitions from one boundary
to the other. It appears clearly that to reach level b, starting from a phase
i (cid:54)= 8, the process must ﬁrst move to phase 8, with an expected time equal
to 10(8− i), and only then get a chance to reach b in a reasonable amount of
time. Furthermore, (M0;u)8 is much greater than the expected sojourn time
in phase 8. We interpret this as follows: starting from level 0 in phase 8, there
is a signiﬁcant probability that the process reaches level b before switching to
phase 1, but it is also possible the system will have to go through one cycle
(or more) before eventually reaching level b.

For Case 2, the eﬀect of σ8 is also noticeable in the expected duration of
excursions from b to 0, albeit to a lesser degree; for Case 3, these expected
durations are dominated by the large absolute value of µd.

Example 7.3 Video streaming application. This example is taken from
Gribaudo et al. [13]. We use it to illustrate changes in the system character-
istics resulting from global changes of the parameters.

There are ﬁve states; the video streaming application cycles between
buﬀering (States 1 and 3), playing (States 2 and 4), and ﬁnishing (State
5), leaving each state at the rates βB, βP and βF , respectively. The videos
are being played in a loop: when a video is ﬁnished, the application starts
another one. Video streaming packets arrive at rate λL with variance γL
when the network is congested (States 1 and 3), at rate λH with variance γH

24

1

0

0

1

Figure 3: Cumulative stationary distribution functions for Video Streaming
Application

otherwise (States 2 and 4). The packets are decoded at rate δ with variance γ.

The transition matrix for the phase process is

0

∗
0

0

Q =

αHL

βB
∗
0

αLH
0
∗
0



µ =(cid:2)λL λL − δ λH λH − δ −δ(cid:3) ,
σ2 =(cid:2)γL γL + γ γH γH + γ γ(cid:3) .

0
αLH βP
0
βB
∗
βP
∗
0

αHL

0

βF p1

βF p3

where the diagonal elements are such that Q1 = 0, and the rates and variance
vectors are

The distribution shown as a dotted line on Figure 3 is that of the regulated
MMBM, with parameters chosen from [13]: the buﬀer size is 1MB and is the
unit of volume, the time unit is 1 second, the parameters values are given in
the table below.

δ = γ = 0.5
αLH = αHL = 1/60
p1 = αHL/(αHL + αLH)

λL = γL = 0.25 λH = γH = 0.625
βB = βF = 0.1
p3 = 1 − p1

βP = 0.03

The other curves are deﬁned as follows:

Case 2, dashed line — the parameters are the same but the phase
transition matrices at regeneration epochs are P ◦ = P • = (1/m)1 1(cid:62);
thus, the phase is sampled at random at the end of each excursion from
one boundary to the other.

25

  1234Case 3, mixed dashed and dotted line — the variances are reduced
during excursions from b to 0, with σd = 0.1σu; all other parameters
remain the same and P ◦ = P • = I.
Case 4, plain line — the system cycles 10 times faster through its
three stages during excursions from b to 0, with (βP )d = (βF )d = 1,
(βP )d = 0.3; all other parameters remain the same and P ◦ = P • = I.
In addition to the distribution functions in Figure 3, we give below the me-
dian of the four distributions, and also the stationary probability Πu(b). We
observe that the buﬀer is more heavily utilized when the variances are re-
duced (Case 3), that is, it spends half of the time being above level 0.7. We
also observe that re-sampling the phases at regeneration epochs (Case 2) has
a signiﬁcant eﬀect.

1
Case
Median 0.50
0.51
Πu(b)

2
0.59
0.40

3
0.70
0.19

4
0.46
0.54

8 Comparison with existing literature
A related question is addressed in Breuer [4], where the author analyzes the
joint distribution of the random variables

and

ζ1(b; x, j) =

ζ2(b; x, j) =

1{X(s) < x, κ(s) = j} ds

1{X(s) > x, κ(s) = j} ds

(cid:90) δ0∧δb

0

(cid:90) δ0∧δb

0

for j ∈ E and 0 < x < b. These are the time spent in (0, x) × {j} and
(x, b) × {j} respectively, before the ﬁrst exit from the interval (0, b).
We need to introduce some more notation. Consider a vector r ≥ 0
indexed by E. Deﬁne the matrix U (r) as the minimal solution of the matrix
equation

σX 2 + 2∆µX + 2(Q − ∆r) = 0.
∆2

(51)
For r = 0, we have U (0) = U, the generator introduced at the beginning of

Section 3. Similarly, −(cid:98)U (r) is the maximal solution of (51).

26

We further deﬁne the random variables

T1(b; x) =

(r1)jζ1(b; x, j),

T2(b; x) =

(cid:88)

j∈E

(cid:88)

j∈E

(r2)jζ2(b; x, j),

where r1 and r2 are two nonnegative vectors. The functions

r1,r2(b; x|a) = E[e−T1(b;x)−T2(b;x)1{δb < δ0}, κ(δb)|X(0) = a, κ(0)]
E +

and

r1,r2(b; x|a) = E[e−T1(b;x)−T2(b;x)1{δ0 < δb}, κ(δ0)|X(0) = a, κ(0)],
E−

E +

for 0 < a < b, are the joint Laplace transforms of the ζ1s and ζ2s restricted on
the exit occurring at the upper or lower boundary, respectively, conditionally
given that the process starts from level a in the open interval (0, b).

From [4, Theorem 1, Lemmas 1 and 2], we ﬁnd after various adaptations

and, by symmetry, that

to our speciﬁc case and some simple manipulations that

r1,r2(b; x|x) = −2((cid:98)Px(r1) + Pb−x(r2))−1Lb−x(r2)
r1,r2(b; x|x) = −2((cid:98)Px(r1) + Pb−x(r2))−1(cid:98)Lx(r1).
Here, (cid:98)Px(r1) and (cid:98)Lx(r1) are given by (24) with U, (cid:98)U and b respectively
replaced by U (r1), (cid:98)U (r1) and x, and Pb−x(r2) and Lb−x(r2) are given by
(18) with U, (cid:98)U and b replaced by U (r2), (cid:98)U (r2) and b − x.

(52)

(53)

E−

Finally, we deﬁne the random variables

(cid:90) δy

ξ(y; x, j) =

1{Z(s) ≤ x, κ(s) = j} ds,

0

for y ≥ x, as the time spent in [0, x] × {j} by the regulated process until the
ﬁrst passage to level y, and we denote their joint Laplace transform, starting
from level 0, by

Ξr(y; x) = E[e−rξ(y;x)κ(δy)|Z(0 = 0, κ(0)].

Lemma 8.1 The joint Laplace transform Ξr(y; x) of the random variables
ξ(b; x, j), 1 ≤ j ≤ m, is given by

Ξr(b; x) = (I − Ξr(x; x)E−

r,0(b; x|x))−1Ξr(x; x)E +

r,0(b; x|x)

(54)

for b > x, with Ξr(x; x) = (−Px(r))−1Lx(r).

27

Proof We decompose the interval [0, δy] into three subintervals:

[0, δy] = [0, δx] ∪ [δx, δ∗] ∪ [δ∗, δb],

where δ∗ = inf{t > δx : Z(t) = 0 or Z(t) = b}. The sojourn times in
(0, x) × {j} during these intervals are conditionally independent, given the
phases, and so we have

Ξr(b; x) = Ξr(x; x)(E +

r,0(b; x|x) + E−

r,0(b; x|x)Ξr(b; x)),

from which (54) follows.

The given expression for Ξr(x; x) is a consequence of [3, Theorem 1]: we
adapt it to our speciﬁc case, taking into account the fact that Theorem 1
in [3] is stated for the level-reversed process, and performing some simple
(cid:3)
manipulations.
At ﬁrst, it looks like we might obtain M0(x) by diﬀerentiating both sides
of (54) with respect to r and by evaluating the result at r = 0. We would
need the derivatives with respect to r of the solutions of (51). Details would
still need to be worked out and in ﬁnal analysis, the expressions so obtained
would without doubt be much more involved than the very clean expressions
given in (28).

9 Conclusion and extensions
In this paper, we have illustrated one useful reason for approximating Markov-
modulated Brownian motions with stochastic ﬂuid queues. In particular, the
approximation allows for the analysis of MMBMs subject to boundary con-
ditions that are not the traditional regulation. This approach, coupled with
the regenerative method, may be adapted easily to other types of feedbacks,
such as a combination of absorption, stickiness, and instantaneous change of
phase whenever the process hits a boundary.

With the technique developed here, we might analyze systems for which
the so-called feedback only lasts for a ﬁnite amount of time. For instance,
rates change for an exponential amount of time, and then the system resumes
its normal mode of operations. The results from Sections 4 to 6 have to be
adapted, as the generator for the phase process between two regeneration
points is no longer irreducible.

A Expected time under a taboo
Although the statement of Theorem A.1 would seem to be well-known, we
do not know of a published formal proof, which is why we include it here.

28

Consider a ﬂuid queue with generator T for the environmental Markov pro-
cess and ﬂuid growth rates c. We denote by Ψ its matrix of ﬁrst return
+ T++ + Ψ|C−|−1T+−, where
probabilities to level 0, and we deﬁne K = C−1
C = ∆c.

Theorem A.1 The matrix Γ(x) of mean sojourn time in [0, x] before return
to the initial level 0, starting from a phase with positive growth, is given by

Γ(x) = F(K; x)(cid:2)C−1

+ Ψ|C−|−1(cid:3) ,

(55)

where F(K; x) =(cid:82) x

0 eKu du.

Proof

We need to consider separately the case when the stationary drift is

strictly negative from the case when it is positive or equal to zero.

A. Strictly negative drift
rent and the eigenvalues of K are all in C<0.

We deﬁne the complementary probability functions

In this case, the ﬂuid queue is positive recur-

[G(x, t)]ij = P[t < τ, X(t) > x, κ(t) = j | X(0) = 0, κ(0) = i],

where τ is the ﬁrst return time to level 0. Denote by Γ(x) the mean sojourn
time in (x,∞) before returning to the initial level 0:

(cid:90) ∞

Γ(x) =

G(x, u) du,

0

obviously, Γ(x) = Γ(0)−Γ(x). One veriﬁes by the usual argument (Karandikar
and Kulkarni [15]) that G(x, t) is the solution to the system of partial diﬀer-
ential equations

∂
∂t

G(x, t) +

∂
∂x

G(x, t)C = G(x, t)T

for x > 0.

Integrating both sides with respect to t from 0 to ∞ gives

[G(x, t)]∞

0 +

∂
∂x

Γ(x)C = Γ(x)T.

(56)

Note that

lim
t→∞ G(x, t) = 0,

G(x, t) = 0,

lim
t→0

29

the ﬁrst limit is due to the negative drift assumption, which implies that
τ < ∞ almost surely, the second holds because the ﬂuid queue does not have
enough time to grow beyond x by time t if t is small. Then, it is easy to
verify that the solution to (56) is given by

Γ(x) = AK−1eKx(cid:2)C−1

+ Ψ|C−|−1(cid:3)

(57)

for some matrix A to be determined.

Let us focus on the block Γ++(x) = AK−1eKxC−1

+ . For suﬃciently small

h, we may write that

Γ++(0) = hC−1

+ + Γ++(h) + o(h).

(58)

Indeed, the expected time spent above level 0 in a phase j is equal to the
time needed to reach level h in that phase, if κ(0) = j plus the time spent
above h in that phase. The third term in (58) accounts for the time spent in
oscillations between 0 and h whenever the ﬂuid drops below h. We get from
(58) that

Γ++(x)|x=0 = −C−1
+ ,

∂
∂x

from which we conclude that A = −I. Thus,

Γ(x) = (−K)−1(I − eKx)(cid:2)C−1
+ Ψ|C−|−1(cid:3)

= F(K; x)(cid:2)C−1

+ Ψ|C−|−1(cid:3)

by Lemma 5.4.

In this case, the ﬂuid queue is null-recurrent or

B. Nonnegative drift
transient, and K has one eigenvalue equal to zero.

time in (x,∞) is inﬁnite, and(cid:82) ∞

0 G(x, u) du diverges for any x.

We may not repeat the argument for Part A because the mean sojourn

To get around this problem, we shall kill the process after a random,
ﬁnite, interval of time and then use a limiting argument. We deﬁne ζ to be
an exponentially distributed random variable with rate ψ, and

G(cid:48)(x, t; ψ) = P[t < min{τ, ζ}, X(t) > x, κ(t) | X(0) = 0, κ(0)],

(cid:90) ∞

Γ(cid:48)(x; ψ) =

G(cid:48)(x, u; ψ) du.

0

As ζ < ∞ with probability one, Γ(cid:48)(x; ψ) < ∞ and we may retrace the
steps in Part A. In particular, the matrix Γ(cid:48)(x; ψ) of expected sojourn time
in (x,∞) under the taboo of 0 is given by

Γ(cid:48)(x; ψ) = (−Kψ)−1eKψx(cid:2)C−1

+ Ψψ|C−|−1(cid:3) ,

30

where Ψψ is the minimal nonnegative solution of the Riccati equation

|C−1

− |T ψ−+ + ΨψC−1

+ T ψ

++ + |C−1

+ T ψ

+−Ψψ = 0,

− |T ψ−−Ψψ + ΨψC−1
(cid:21)

T+−

T−− − ψI

,

(cid:20) T++ − ψI

T−+

with

and

T ψ =

Kψ = |C−1

− |T ψ−− + ΨψC−1

+ T ψ

+−.

In the limit as ψ → 0, the matrices Ψψ and Kψ respectively converge to Ψ
and K. Then,

Γ(x) = lim
ψ→0
= lim
ψ→0

(Γ(cid:48)(0; ψ) − Γ(cid:48)(x; ψ))

(cid:8)(−Kψ)−1(I − eKψb)(cid:9)(cid:2)C−1

+ Ψ|C−|−1(cid:3) .

In the last expression, Kψ converges to K which is singular; thus, we need
to exercise some care in evaluating the remaining limit.
The matrix K has one isolated eigenvalue equal to 0, and Kψ has an
isolated, real, maximal eigenvalue ωψ which converges to 0 as ψ → 0. Thus,
there exist some matrices S and Sψ such that

(cid:20) J

(cid:21)

0

K = S

S−1

and Kψ = Sψ

(cid:20) Jψ

(cid:21)

S−1
ψ ,

ωψ

where J is a matrix with all eigenvalues of K in C<0, Jψ is a matrix with
all eigenvalues of Kψ with real parts strictly less than ωψ, and Sψ → S and
Jψ → J as ψ → 0. We decompose the inverse of Kψ as

K−1

ψ = Sψ

S−1
ψ + Sψ

0

ω−1

ψ

S−1
ψ .

(59)

Note that the ﬁrst term on the right side of (59) converges to the group
inverse K # as ψ → 0 [5, Theorem 7.2.1]. Also,

(cid:20) 0

(cid:21)

lim
ψ→0

eKψx = lim
ψ→0

Sψ

(cid:20) eJx

(cid:21)

1

S−1
ψ = S

S−1 = eKx.

(cid:20) J−1

ψ

(cid:20) eJψx

(cid:21)

(cid:21)

eωψx

31

Thus,

lim
ψ→0

(−Kψ)−1(I − eKψx)
(−Kψ)−1Sψ

= lim
ψ→0

(cid:20) I − eJψx
(cid:20) 0

= −K #(I − eKx) − lim
Sψ
ψ→0
= −K #(I − eKx) + xvu,

(cid:21)

S−1

ψ

1 − eωψx

ψ (1 − eωφx)
ω−1

(cid:21)

S−1

ψ

where v and u are respectively the right and left eigenvectors of K for the
(cid:3)
eigenvalue 0. By Lemma 5.4 again, this completes the proof of (55).

Acknowledgements
The authors thank the Ministère de la Communauté française de Belgique
for supporting this research through the ARC grant AUWB-08/13–ULB 5,
they acknowledge the ﬁnancial support of the Australian Research Council
through the Discovery Grant DP110101663. Giang Nguyen also acknowl-
edges the support of ACEMS (ARC Centre of Excellence for Mathematical
and Statistical Frontiers).

References
[1] N. G. Bean and M. M. O’Reilly. Performance measures of a multi-layer
Markovian ﬂuid model. Annals of Operations Research, 160:99–120,
2008.

[2] N. G. Bean, M. M. O’Reilly, and P. Taylor. Hitting probabilities and
hitting times for stochastic ﬂuid ﬂows. The bounded model. Probabil-
ity in the Engineering and Informational Sciences, 23:121–147, 2009.
doi:10.1017/S0269964809000102.

[3] L. Breuer. Exit problems for reﬂected Markov-modulated Brownian

motion. J. Appl. Probab., 49:697–709, 2012.

[4] L. Breuer. Occupation times for Markov-modulated Brownian motion.

Journal of Applied Probability, 49:549–565, 2012.

[5] S. L. Campbell and C. D. Meyer. Generalized Inverses of Linear Trans-

formations. Dover Publications, New York, 1991. Republication.

32

[6] E. Çinlar. Introduction to Stochastic Processes. Prentice–Hall, Engle-

wood Cliﬀs, NJ, 1975.

[7] P. Coolen-Schrijner and E. A. van Doorn. The deviation matrix of
a continuous-time Markov chain. Probability in the Engineering and
Informational Sciences, 16:351–366, 2002.

[8] A. da Silva Soares and G. Latouche. A matrix-analytic approach to
ﬂuid queues with feedback control. International Journal of Simulation.
Systems, Science and Technology, 6:4–12, 2005.

[9] A. da Silva Soares and G. Latouche. Matrix-analytic methods for ﬂuid
queues with ﬁnite buﬀers. Performance Evaluation, 63:295–314, 2006.

[10] A. da Silva Soares and G. Latouche. Fluid queues with level dependent

evolution. European J. Oper. Res., 196:1041–1048, 2009.

[11] B. D’Auria, J. Ivanovs, O. Kella, and M. Mandjes. First passage process
of a Markov additive process with applications to reﬂection problems.
ArXiv e-prints, arXiv:1006.2965v1 [math.PR], 2010.

[12] B. D’Auria, J. Ivanovs, O. Kella, and M. Mandjes. Two-sided reﬂection
of Markov-modulated Brownian motion. Stochastic Models, 28:316–332,
2012. doi:10.1080/15326349.2012.672285.

[13] M. Gribaudo, D. Manini, B. Sericola, and M. Telek. Second order ﬂuid
models with general boundary behaviour. Annals of Operations Re-
search, 160:69–82, 2008.

[14] J. Ivanovs. Markov-modulated Brownian motion with two reﬂecting

barriers. J. Appl. Probab., 47:1034–1047, 2010.

[15] R. L. Karandikar and V. Kulkarni. Second-order ﬂuid ﬂow models:
Reﬂected Brownian motion in a random environment. Oper. Res, 43:77–
88, 1995.

[16] G. Latouche and G. T. Nguyen. Fluid approach to two-sided Markov-

modulated Brownian motion. Queueing Systems, 80:105–125, 2015.
doi: 10.1007/s11134-014-9432-8.

[17] G. Latouche and G. T. Nguyen. The morphing of ﬂuid queues into
Stochastic Systems, 5:62–86,

Markov-modulated Brownian motion.
2015.
doi: 10.1214/13-SSY133.

33

[18] G. Latouche and G. T. Nguyen. Slowing time: Markov-modulated Brow-
nian motion with a sticky boundary. Submitted, 2015. arXiv:1508.00922.

[19] G. Latouche and P. Taylor. A stochastic ﬂuid model for an ad hoc mobile

network. Queueing Systems, 63:109–129, 2009.

[20] V. Ramaswami. Matrix analytic methods for stochastic ﬂuid ﬂows. In
D. Smith and P. Hey, editors, Teletraﬃc Engineering in a Competitive
World (Proceedings of the 16th International Teletraﬃc Congress), pages
1019–1030. Elsevier Science B.V., Edinburgh, UK, 1999.

[21] L. C. G. Rogers. Fluid models in queueing theory and Wiener-Hopf

factorization of Markov chains. Ann. Appl. Probab., 4:390–413, 1994.

34

