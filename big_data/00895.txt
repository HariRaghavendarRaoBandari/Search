Personalized Cancer Therapy Design: Robustness vs. Optimality

Julia L. Fleck and Christos G. Cassandras

Division of Systems Engineering

and Center for Information and Systems Engineering

Boston University, MA 02446
jfleck@bu.edu,cgc@bu.edu

6
1
0
2

 
r
a

M
 
2

 
 
]

.

C
O
h
t
a
m

[
 
 

1
v
5
9
8
0
0

.

3
0
6
1
:
v
i
X
r
a

Abstract— Intermittent Androgen Suppression (IAS)

is a
treatment strategy for delaying or even preventing time to
relapse of advanced prostate cancer. IAS consists of alternating
cycles of therapy (in the form of androgen suppression) and off-
treatment periods. The level of prostate speciﬁc antigen (PSA) in
a patient’s serum is frequently monitored to determine when the
patient will be taken off therapy and when therapy will resume.
In spite of extensive recent clinical experience with IAS, the
design of an ideal protocol for any given patient remains one
of the main challenges associated with effectively implementing
this therapy. We use a threshold-based policy for optimal IAS
therapy design that is parameterized by lower and upper PSA
threshold values and is associated with a cost metric that
combines clinically relevant measures of therapy success. We
apply Inﬁnitesimal Perturbation Analysis (IPA) to a Stochastic
Hybrid Automaton (SHA) model of prostate cancer evolution
under IAS and derive unbiased estimators of the cost metric
gradient with respect to various model and therapy parameters.
These estimators are subsequently used for system analysis. By
evaluating sensitivity estimates with respect to several model
parameters, we identify critical parameters and demonstrate
that relaxing the optimality condition in favor of increased
robustness to modeling errors provides an alternative objective
to therapy design for at least some patients.

I. INTRODUCTION

Several recent attempts have been made to develop math-
ematical models that explain the progression of cancer in
patients undergoing therapy so as to improve (and possibly
optimize) the effectiveness of such therapy. As an example,
prostate cancer is known to be a multistep process, and pa-
tients who evolve into a state of metastatic disease are usually
submitted to hormone therapy in the form of continuous
androgen suppression (CAS) [12]. The initial response to
CAS is frequently positive, leading to a signiﬁcant decrease
in tumor size; unfortunately, most patients eventually develop
resistance and relapse.

Intermittent Androgen Suppression (IAS) is an alternative
treatment strategy for delaying or even preventing time to
relapse of advanced prostate cancer patients. IAS consists
of alternating cycles of therapy (in the form of androgen
suppression) and off-treatment periods. The level of prostate
speciﬁc antigen (PSA) in a patient’s serum is frequently mon-
itored to determine when the patient will be taken off therapy
and when therapy will resume. In spite of extensive recent
clinical experience with IAS, the design of an ideal protocol
for any given patient remains one of the main challenges
associated with effectively implementing this therapy [7].

The authors’ work is supported in part by NSF under grants CNS-
1239021, ECCS-1509084, and IIP-1430145, by AFOSR under grant
FA9550-15-1-0471, and by ONR under grant N00014-09-1-1051.

Various works have aimed at addressing this challenge,
and we brieﬂy review some of them. In [10] a model is
proposed in which prostate tumors are composed of two
subpopulations of cancer cells, one that is sensitive to an-
drogen suppression and another that is not, without directly
addressing the issue of IAS therapy design. The authors in [9]
modeled the evolution of a prostate tumor under IAS using
a hybrid dynamical system approach and applied numerical
bifurcation analysis to study the effect of different therapy
protocols on tumor growth and time to relapse. In [13] a
nonlinear model is developed to explain the competition
between different cancer cell subpopulations, while in [16]
a model based on switched ordinary differential equations is
proposed. The authors in [14] developed a piecewise afﬁne
system model and formulated the problem of personalized
prostate cancer treatment as an optimal control problem.
Patient classiﬁcation is performed in [7] using a feedback
control system to model the prostate tumor under IAS, and
in [8] this work is extended by deriving conditions for patient
relapse.

Most of the existing models provide insights into the
dynamics of prostate cancer evolution under androgen de-
privation, but fail to address the issue of therapy design.
Furthermore, previous works that suggest optimal treatment
schemes by classifying patients into groups have been based
on more manageable, albeit less accurate, approaches to non-
linear hybrid dynamical systems. Addressing this limitation,
the authors in [11] recently proposed a nonlinear hybrid
automaton model and performed δ-reachability analysis to
identify patient-speciﬁc treatment schemes. However, this
model did not account for noise and ﬂuctuations inherently
associated with cell population dynamics and monitoring of
clinical data. In contrast, in [15] a hybrid model of tumor
growth under IAS therapy is developed that incorporated
stochastic effects, but is not used for personalized therapy
design.

A ﬁrst attempt to deﬁne optimal personalized IAS therapy
schemes by applying Inﬁnitesimal Perturbation Analysis
(IPA) to stochastic models of prostate cancer evolution was
reported in [5]. An IPA-driven gradient-based optimization
algorithm was subsequently implemented in [6] to adaptively
adjust controllable therapy settings so as to improve IAS
therapy outcomes. The advantages of these IPA-based ap-
proaches stem from the fact that IPA efﬁciently yields sen-
sitivities with respect to controllable parameters in a therapy
(i.e., control policy), which is arguably the ultimate goal of
personalized therapy design. More generally, however, IPA
yields sensitivity estimates with respect to various model

parameters from actual data, thus allowing critical parameters
to be differentiated from others that are not.

In this paper we build upon the IPA-based methodology
from [5] and [6] and focus on the importance of accurate
modeling in conjunction with optimal therapy design. In
particular, by evaluating sensitivity estimates with respect
to several model parameters, we identify critical parameters
and verify the extent
to which the model from [5] is
robust to them. From a practical perspective, the goal of
this paper is to use IPA to explore the tradeoff between
system optimality and robustness (or, equivalently, fragility),
thus providing valuable insights on modeling and control
of cancer progression. Assuming that an underlying, and
most likely poorly understood, equilibrium of cancer cell
subpopulation dynamics exists at suboptimal therapy set-
tings, we verify that relaxing the optimality condition in
favor of increased robustness to modeling errors provides
an alternative objective to therapy design for at least some
patients.

In Section II we present a Stochastic Hybrid Automa-
ton (SHA) model of prostate cancer evolution, along with
a threshold-based policy for optimal IAS therapy design.
Section III reviews a general framework of IPA based on
which we derive unbiased IPA estimators for system analysis.
In Section IV we evaluate sensitivity estimates with respect
to several model parameters, identifying critical parameters
and verifying the extent to which our SHA model is robust
to them. We include ﬁnal remarks in Section V.

II. PROBLEM FORMULATION

A. Stochastic Model of Prostate Cancer Evolution

We consider a system composed of a prostate tumor under
IAS therapy, which is modeled as a Stochastic Hybrid Au-
tomaton (SHA). Details of the problem formulation are given
in [5], but a condensed description of the SHA modeling
framework is included here so as to make this paper as self-
contained as possible. By adopting a standard SHA deﬁnition
[3], a SHA model of prostate cancer evolution is deﬁned in
terms of the following:

A discrete state set Q = (cid:8)qON , qOF F(cid:9), where qON

(qOF F , respectively) is the on-treatment (off-treatment, re-
spectively) operational mode of the system. IAS therapy
is temporarily suspended when the size of the prostate
tumor decreases by a predetermined desirable amount. The
reduction in the size of the tumor is estimated in terms of the
patient’s prostate speciﬁc antigen (PSA) level, a biomarker
commonly used for monitoring the outcome of hormone
therapy. In this context, therapy is suspended when a patient’s
PSA level reaches a lower threshold value, and reinstated
once the size of cancer cell populations has increased con-
siderably, i.e., once the patient’s PSA level reaches an upper
threshold value.
A state space X = {x1 (t) , x2 (t) , x3 (t) , z1 (t) , z2 (t)},
deﬁned in terms of the biomarkers commonly monitored
during IAS therapy, as well as “clock” state variables that
measure the time spent by the system in each discrete
state. We assume that prostate tumors are composed of two
coexisting subpopulations of cancer cells, Hormone Sensitive
Cells (HSCs) and Castration Resistant Cells (CRCs), and

thus deﬁne a state vector x (t) = [x1 (t) , x2 (t) , x3 (t)] with
xi (t) ∈ R+, such that x1 (t) is the total population of HSCs,
x2 (t) is the total population of CRCs, and x3 (t) is the
concentration of androgen in the serum. Prostate cancer cells
secrete high levels of PSA, hence a common assumption
is that the serum PSA concentration can be modeled as a
linear combination of the cancer cell subpopulations. It is
also frequently assumed that both HSCs and CRCs secrete
PSA equivalently [9], and in this work we adopt
these
assumptions. Finally, we deﬁne variable zi (t) ∈ R+, i =
1, 2, where z1 (t) (z2 (t), respectively) is the “clock” state
variable corresponding to the time when the system is in
state qON (qOF F , respectively), and is reset to zero every
time a state transition occurs. Setting z (t) = [z1 (t) , z2 (t)],
the complete state vector is [x (t) , z (t)].
An admissible control set U = {0, 1}, such that the

control is deﬁned, at any time t, as:
u (x (t) , z (t)) ≡

if x1 (t) + x2 (t) < θ2, q (t) = qOF F
if x1 (t) + x2 (t) > θ1, q (t) = qON

(cid:26) 0

1

This is a simple form of hysteresis control

(cid:104)˜θ1, ˜θ2
(cid:105) ∈ Θ, where ˜θ1 ∈ (cid:104)˜θmin
(cid:105)

(1)
to ensure
that androgen deprivation will be suspended whenever a
patient’s PSA level drops below a minimum threshold value,
and that treatment will resume once the patient’s PSA level
reaches a maximum threshold value. To this end, IAS therapy
is viewed as a controlled process characterized by two
parameters: ˜θ =
, ˜θmax
is the lower threshold value of the patient’s PSA level,
is the upper threshold value of
the patient’s PSA level, with ˜θmax
. An illustrative
representation of such threshold-based IAS therapy scheme
is depicted in Fig. 1. Simulation driven by clinical data [1],[2]
was performed to generate the plot in Fig. 1, which shows a
typical proﬁle of PSA level variations along several treatment
cycles.

and ˜θ2 ∈ (cid:104)˜θmin

< ˜θmin

, ˜θmax

2

1

1

(cid:105)

1

2

2

Fig. 1.
(IAS) therapy

Schematic representation of Intermittent Androgen Suppression

An event set E = {e1, e2}, where e1 corresponds to the
condition [x1 (t) + x2 (t) = θ1 from above] (i.e., x1 (t−) +
x2 (t−) > θ1) and e2 corresponds to the condition
[x1 (t) + x2 (t) = θ2 from below] (i.e., x1 (t−) + x2 (t−) <
θ2), where the notation t− indicates the time instant imme-
diately preceding time t.
System dynamics describing the evolution of continuous
state variables over time, as well as the rules for discrete
continuous (time-driven) dynamics
state transitions. The
capture the prostate cancer cell population dynamics, which

are deﬁned in terms of their proliferation, apoptosis, and
conversion rates. As in [5], we incorporate stochastic effects
into the deterministic model from [11] as follows:

(cid:105)−1 · x1(t)
(cid:105)−1 · x1(t)
(cid:105) · x1(t)
(cid:17) − β2
(cid:105)
(cid:17)

x2(t)

(cid:104)
(cid:104)
(cid:104)

m1

(cid:16)
(cid:16)
(cid:16)

1 + e−(x3(t)−k1)k2
1 + e−(x3(t)−k3)k4
+ λ1

1 − x3(t)

(cid:17)

x3,0

˙x1(t) = α1
−β1

−(cid:104)
 − x3(t)

x3,0−x3(t)

˙x2(t) =

σ

+µ1 + ζ1(t)

α2

+m1

1 − d x3(t)
1 − x3(t)

x3,0

x3,0

σ + µ3 + ζ3(t)

+ µ3 + ζ3(t)

x1(t) + ζ2(t)
if x1(t) + x2(t) > θ1
and q(t) = qON
if x1(t) + x2(t) < θ2
and q(t) = qOF F

˙x3(t) =

(cid:26) 1
(cid:26) 1

0

0

˙z1(t) =

z1(t+) = 0

˙z2(t) =

z2(t+) = 0

if q(t) = qON
otherwise
if x1(t) + x2(t) = θ1
and q(t) = qON
if q(t) = qOF F
otherwise
if x1(t) + x2(t) = θ2
and q(t) = qOF F

where α1 and α2 are the HSC proliferation constant and
CRC proliferation constant, respectively; β1 and β2 are the
HSC apoptosis constant and CRC apoptosis constant, respec-
tively; k1 through k4 are HSC proliferation and apoptosis
exponential constants; m1 is the HSC to CRC conversion
constant; x3,0 corresponds to the patient-speciﬁc androgen
constant; σ is the androgen degradation constant; λ1 is
the HSC basal degradation rate; µ1 and µ3 are the HSC
basal production rate and androgen basal production rate,
respectively. Finally, {ζi(t)}, i = 1, 2, 3, are stochastic
processes which we allow to have arbitrary characteristics
and only assume them to be piecewise continuous w.p. 1. The
processes {ζi(t)}, i = 1, 2, represent noise and ﬂuctuations
inherently associated with cell population dynamics, while
{ζ3(t)} reﬂects randomness associated with monitoring clin-
ical data, more speciﬁcally, with monitoring the patient’s
androgen level.

It is clear from (2)-(4) that x1 (t) and x2 (t) are dependent
on x3 (t), whose dynamics are affected by mode transitions.
To make explicit the dependence of x1 (t) and x2 (t) on the
discrete state (mode) q (t), we let τk
be the time of
occurrence of the kth event (of any type), and denote the state
dynamics over any interevent interval
as

(cid:16)˜θ
(cid:17)
(cid:16)˜θ
(cid:17)

(cid:16)˜θ
(cid:17)(cid:17)

(cid:104)

, τk+1

τk

˙xn(t) = f xn

k (t), ˙zi(t) = f zi

k (t) , n = 1, . . . , 3, i = 1, 2

We include ˜θ as an argument to stress the dependence of
the event times on the controllable parameters, but we will
subsequently drop this for ease of notation as long as no
confusion arises.
We thus start by assuming q(t) = qON for t ∈ [τk, τk+1).
Solving (4) yields, for t ∈ [τk, τk+1),
k )e−(t−τk)/σ

x3(t) = x3(τ +

+e−t/σ ·(cid:82) t

τk

eε/σ [µ3 + ζ3(ε)] dε

It is then possible to deﬁne, for t ∈ [τk, τk+1),

k )e−(t−τk)/σ

+µ3σ[1 − e−(t−τk)/σ] + ˜ζ3(t)

(7)

hON(cid:16)

t, ˜ζ3(t)

(cid:17) ≡ x3(τ +
(cid:90) t

where, for notational simplicity, we let

τk

−(t−ε)/σζ3(ε)dε
e

˜ζ3(t) =

(8)
Next, let q(t) = qOF F for t ∈ [τk, τk+1), so that (4) implies
that, for t ∈ [τk, τk+1),
x3(t) = x3(τ +

k )e−(t−τk)/σ

+(µ3σ + x3,0)[1 − e−(t−τk)/σ] + ˜ζ3(t)
Similarly as above, we deﬁne, for t ∈ [τk, τk+1),

hOF F(cid:16)

t, ˜ζ3(t)

k )e−(t−τk)/σ

+(µ3σ + x3,0)[1 − e−(t−τk)/σ] + ˜ζ3(t)

(9)

(cid:17) ≡ x3(τ +
 hON(cid:16)
hOF F(cid:16)

(cid:17)
(cid:17)

It is then possible to rewrite (4) as follows:

x3(t) =

t, ˜ζ3(t)
t, ˜ζ3(t)

if q(t) = qON
if q(t) = qOF F

Although we include ˜ζ3(t) as an argument in (7 ) and (9)
to stress the dependence on the stochastic process, we will
subsequently drop this for ease of notation as long as no
confusion arises. Hence, substituting (7) and (9) into (2)-(3),
yields

(2)

(3)

(4)

(5)

(6)



(cid:110)
(cid:110)

α1

α1

+m1
x3,0
+µ1 + ζ1(t)

+m1
x3,0
+µ1 + ζ1(t)

α

(cid:2)1 + φON
(cid:16) hON (t)
(cid:2)1 + φOF F
(cid:16) hOF F (t)
(cid:16)
(cid:16)
(cid:16)
(cid:16)

α (t)(cid:3)−1 − β1
(cid:17) − (m1 + λ1)
(t)(cid:3)−1 − β1
(cid:17) − (m1 + λ1)
(cid:17) − β2
(cid:105)
(cid:17)
(cid:17) − β2
(cid:17)

1 − d hON (t)
1 − hON (t)

1 − d hOF F (t)
1 − hOF F (t)

(cid:105)

x3,0

x3,0

x3,0

x3,0

α2

+m1

α2

+m1

(cid:104)
(cid:104)



β

(cid:2)1 + φON
(t)(cid:3)−1
(cid:111) · x1(t)
(t)(cid:3)−1
(cid:2)1 + φOF F
(cid:111) · x1(t)

if q(t) = qON

β

if q(t) = qOF F

(10)

x2(t)

x1(t) + ζ2(t)

if q(t) = qON

x2(t)

x1(t) + ζ2(t)

if q(t) = qOF F

(11)

˙x1(t) =

˙x2(t) =

with

α (t) = e

β

φON
φON
φOF F
φOF F

α

β

(t) = e

(t) = e

(t) = e

−(hON (t)−k1)k2
−(hON (t)−k3)k4
−(hOF F (t)−k1)k2
−(hOF F (t)−k3)k4

The discrete (event-driven) dynamics are dictated by the
occurrence of events that cause state transitions. Based on the
event set E = {e1, e2} we have deﬁned, the occurrence of e1
results in a transition from qON to qOF F and the occurrence
of e2 results in a transition from qOF F to qON .
B. IAS Sensitivity Analysis

that

Recall

the main goal of this work is to perform
sensitivity analysis of (2)-(6) in order to identify critical
model parameters and verify the extent to which the SHA
model of prostate cancer evolution is robust to them. Of note,
several potentially critical parameters exist in the SHA model
from [5]. This work is a ﬁrst step towards analyzing their

(cid:17)

(cid:16)˜θ, t

relative importance, in which we select a subset of all model
parameters in order to illustrate the applicability of our IPA-
based methodology. The parameters we consider here are α1
and α2 (HSC proliferation constant and CRC proliferation
constant, respectively), as well as β1 and β2 (HSC apoptosis
constant and CRC apoptosis constant, respectively). These
constants are intrinsically related to the cancer cell subpop-
ulations’ net growth rate, whose value dictates how fast the
PSA threshold values will be reached, and ultimately how
soon treatment will be suspended or reinstated. As a result,
correctly estimating the values of αi and βi, i = 1, 2, is
presumably crucial for the purposes of personalized IAS
therapy design.

In this context, we deﬁne an extended parameter vector
, where ˜θ1 (˜θ2, respectively) corresponds
˜θ =
to the lower (upper, respectively) threshold value of the
patient’s PSA level, ˜θ3 (˜θ4, respectively) corresponds to the
HSC (CRC, respectively) proliferation constant, and ˜θ5 (˜θ6,
respectively) corresponds to the HSC (CRC, respectively)
apoptosis constant.

(cid:104)˜θ1, . . . , ˜θ6

Within the SHA framework presented above, an IAS

(cid:105)

u

(cid:104)

therapy can be viewed as a controlled process u
characterized by the parameter vector ˜θ, as in (1), whose
effect can be quantiﬁed in terms of performance metrics of
the form J
. Of note, only the ﬁrst two elements
in vector ˜θ are controllable, while the remaining parameters
are not.

(cid:16)˜θ, t

(cid:17)(cid:105)

As in [5], here we make use of a sample function deﬁned
in terms of complementary measures of therapy success.
In particular, we consider the most adequate IAS treatment
schemes to be those that (i) ensure PSA levels are kept as
low as possible; (ii) reduce the frequency of on and off-
treatment cycles. From a practical perspective, (i) translates
into the ability to successfully keep the size of cancer cell
populations under control, which is directly inﬂuenced by
the duration of the on and off-treatment periods. On the
other hand, (ii) aims at reducing the duration of on-treatment
periods, thus decreasing the exposure of patients to med-
ication and their side effects, and consequently improving
the patients’ quality of life throughout the treatment. Clearly
there is a trade-off between keeping tumor growth under
control and the cost associated with the corresponding IAS
therapy. The latter is related to the duration of the therapy
and could potentially include ﬁxed set up costs incurred
when therapy is reinstated. For simplicity, we disconsider
ﬁxed set up costs and take (ii) to be linearly proportional to
the length of the on-treatment cycles. Hence, we deﬁne our
sample function as the sum of the average PSA level and
the average duration of an on-treatment cycle over a ﬁxed
time interval [0, T ]. We also take into account that it may be
desirable to design a therapy scheme which favors (i) over
(ii) (or vice-versa) and thus associate weight W with (i) and
1 − W with (ii), where 0 ≤ W ≤ 1. Finally, to ensure that
the trade-off between (i) and (ii) is captured appropriately,
we normalize our sample function: we divide (i) by the value
of the patient’s PSA level at the start of the ﬁrst on-treatment
cycle (P SAinit), and normalize (ii) by T .

Recall that the total population size of prostate cancer
cells is assumed to reﬂect the serum PSA concentration, and
that we have deﬁned clock variables which measure the time
elapsed in each of the treatment modes, so that our sample
function can be written as

L (θ, x(0), z(0), T ) = W
T

dt

(12)

T(cid:82)

0

(cid:105)

P SAinit

(cid:104) x1(θ,t)+x2(θ,t)
T(cid:82)
(cid:16)˜θ, x(0), z(0), T

z1(t)
T dt

0

T

+ (1−W )

(cid:17)(cid:105)

where x(0) and z(0) are given initial conditions. We can
then deﬁne the overall performance metric as

(13)

J

(cid:17)

(cid:16)˜θ, x(0), z(0), T

(cid:104)
(cid:16)˜θ, x(0), z(0), T

= E

L

(cid:17)

(cid:16)˜θ
(cid:17)

(cid:16)˜θ
(cid:17)

(cid:16)˜θ
(cid:17)
(cid:16)˜θ
(cid:17)

by evaluating the sample gradient ∇L

We note that it is not possible to derive a closed-form
expression of J
without imposing limita-
tions on the processes {ζi(t)}, i = 1, . . . , 3. Nevertheless, by
assuming only that ζi(t), i = 1, . . . , 3, are piecewise contin-
uous w.p. 1, we can successfully apply the IPA methodology
developed for general SHS in [4] and obtain an estimate of
∇J
. We will
/d˜θi exist w.p. 1 for all
assume that the derivatives dL
˜θi ∈ R+. It is also simple to verify that L
is Lipschitz
continuous for ˜θi in R+. We will further assume that {ζi(t)},
i = 1, . . . , 3, are stationary random processes over [0, T ] and
that no two events can occur at the same time w.p. 1. Under
/d˜θi is
these conditions, it has been shown in [4] that dL
/d˜θi, i = 1, . . . , 6. Hence,
an unbiased estimator of dJ
our goal is to compute the sample gradient ∇L
using
data extracted from a sample path of the system (e.g., by
simulating a sample path of our SHA model using clinical
data), and use this value as an estimate of ∇J

(cid:16)˜θ
(cid:17)
(cid:16)˜θ
(cid:17)
(cid:16)˜θ
(cid:17)

(cid:16)˜θ
(cid:17)

.

III. INFINITESIMAL PERTURBATION ANALYSIS

For completeness, we provide here a brief overview of the
IPA framework developed for stochastic hybrid systems in
[4]. For such, we adopt a standard SHA deﬁnition [3]:

Gh = (Q, X, E, U, f, φ, Inv, guard, ρ, q0, x0)

(14)
where Q is a set of discrete states; X is a continuous state
space; E is a ﬁnite set of events; U is a set of admissible
controls; f is a vector ﬁeld, f : Q × X × U → X; φ is a
discrete state transition function, φ : Q × X × E → Q; Inv
is a set deﬁning an invariant condition (when this condition
is violated at some q ∈ Q, a transition must occur); guard
is a set deﬁning a guard condition, guard ⊆ Q × Q × X
(when this condition is satisﬁed at some q ∈ Q, a transition is
allowed to occur); ρ is a reset function, ρ : Q×Q×X×E →
X; q0 is an initial discrete state; x0 is an initial continuous
state.

Consider a sample path of the system over [0, T ] and
denote the time of occurrence of the kth event (of any type)
by τk (θ), where θ corresponds to the control parameter of
interest. Although we use the notation τk (θ) to stress the
dependency of the event time on the control parameter, we
will subsequently use τk to indicate the time of occurrence of
the kth event where no confusion arises. In order to further
simplify notation, we shall denote the state and event time

k ≡ ∂τk

derivatives with respect to parameter θ as x(cid:48)(t) ≡ ∂x(θ,t)
and τ(cid:48)
∂θ , respectively, for k = 1, ..., N. Additionally,
considering that the system is at some discrete mode during
an interval [τk, τk+1), we will denote its time-driven dynam-
ics over such interval as fk (x, θ, t). It is shown in [4] that
the state derivative satisﬁes

∂θ

with the following boundary condition:

(cid:48)

x

(t) =

d
dt

(cid:48)
x

∂x

∂fk(t)

k ) +(cid:2)fk−1(τ

−

∂fk(t)

∂θ

(t) +
k ) − fk(τ +
−

k )(cid:3) .τ

(cid:48)
k

(cid:48)
x

(cid:48)
k ) = x

(τ +

(τ

(15)

(16)

(cid:19)

(cid:21)−1

(cid:18) ∂gk

(cid:20) ∂gk
.fk−1(τ
∂x .fk−1(τ−

∂x

dθ

(τ +

(17)

k ) =

dρ (q, q(cid:48), x, e)

when x(θ, t) is continuous in t at t = τk. Otherwise,

(cid:48)
x
where ρ (q, q(cid:48), x, e) is the reset function deﬁned in (14).
Knowledge of τ(cid:48)
k is, therefore, needed in order to evaluate
(16). Following the framework in [4], there are three types of
events for a general stochastic hybrid system: (i) Exogenous
event. This type of event causes a discrete state transition
which is independent of parameter θ and, as a result, τ(cid:48)
k = 0.
(ii) Endogenous event. In this case, there exists a continu-
ously differentiable function gk : (cid:60)n × Θ → (cid:60) such that
τk = min{t > τk−1 : gk (x(θ, t), θ) = 0}, which leads to

.

+

(τ

∂φ

(cid:48)
.x

−
k )

−
k )

∂gk
∂x

k = −
(cid:48)
(18)
τ
k ) (cid:54)= 0. (iii) Induced event. Such an
where ∂gk
event is triggered by the occurrence of another event at time
τm ≤ τk and the expression of τ(cid:48)
k depends on the event time
derivative of the triggering event (τ(cid:48)
m) (details can be found
in [4]).

Thus, IPA captures how changes in θ affect the event times
and the state of the system. Since interesting performance
metrics are usually expressed in terms of τk and x(t), IPA
can ultimately be used to infer the effect that a perturbation
in θ will have on such metrics. We end this overview by
returning to our problem of personalized prostate cancer
therapy design and thus deﬁning the derivatives of the states
xn(˜θ, t) and zj(˜θ, t) and event times τk(˜θ) with respect to
˜θi, i = 1, . . . , 6, j = 1, 2, n = 1, . . . , 3, as follows:

j,i(t) ≡ ∂zj(˜θ, t)
(cid:48)

n,i(t) ≡ ∂xn(˜θ, t)
(cid:48)
(19)
x
In what follows, we derive the IPA state and event time
derivatives for the events identiﬁed in the SHA model of
prostate cancer progression.
A. State and Event Time Derivatives

k,i ≡ ∂τk(˜θ)
(cid:48)
∂ ˜θi

∂ ˜θi

∂ ˜θi

, z

, τ

We proceed by analyzing the state evolution of our SHA
model of prostate cancer progression considering each of
the states (qON and qOF F ) and events (e1 and e2) therein
deﬁned.

1. The system is in state qON over interevent time interval
[τk, τk+1). Using (15) for x1 (t), we obtain, for i = 1, . . . , 6,

d

dt x(cid:48)

1,i(t) = ∂f
+ ∂f

x(cid:48)
x(cid:48)
x1
x1
k (t)
k (t)
1(t) + ∂f
2(t)
∂x2
∂x1
z(cid:48)
z(cid:48)
x1
x1
x1
k (t)
2(t) + ∂f
k (t)
k (t)
1(t) + ∂f
∂ ˜θi
∂z2
∂z1
From (10), we have ∂f x1
= ∂f x1
= ∂f x1
k (t)
k (t)
k (t)
∂ ˜θi
∂x2
∂zj
i = 1, 2, 4, 6, j = 1, 2, and

= 0,

(cid:2)1 + φON

β

(t)(cid:3)−1

1 − hON (t)

(cid:2)1 + φON
α (t)(cid:3)−1 − β1
(cid:16)
(cid:17) − λ1
(cid:2)1 + φON
α (t)(cid:3)−1
(cid:2)1 + φON
(t)(cid:3)−1

x3,0

β

= α1
−m1

= x1
= −x1

∂f

x1
k (t)
∂x1

∂f

∂f

x1
k (t)
∂ ˜θ3
x1
k (t)
∂ ˜θ5

1,i(t) yields,

with

It is thus simple to verify that solving (15) for x(cid:48)
for t ∈ [τk, τk+1),
(cid:48)
(cid:48)
1,i(τ +
1,i(t) = x
x
(cid:48)
1,3(t) = x
x
(cid:48)
x
1,5(t) = x

k )eA1(t), i = 1, 2, 4, 6

(cid:48)
1,3(τ +
(cid:48)
1,5(τ +

(cid:20)

A1 (t) ≡(cid:82) t
−(cid:82) t

τk
m1
x3,0

τk

A2 (t) ≡ eA1(t)

A3 (t) ≡ eA1(t)

(cid:21)

α1

1+φON

β1
β (t)

k )eA1(t) + A2 (t)
k )eA1(t) + A3 (t)
α (t) −
(cid:20)
(cid:34)

x1 (t)
1 + φON
α (t)
− x1 (t)
1 + φON

(t)

β

(cid:90) t
(cid:90) t

τk

τk

1+φON

hON (t) dt − (m1 + λ1) (t − τk)

dt

(cid:21)
(cid:35)

−A1(t)
e

dt

In particular, at τ−
k+1:
−
(cid:48)
(cid:48)
1,i(τ +
k+1) = x
x
1,i(τ
(cid:48)
−
(cid:48)
k )eA(τk) + A2 (τk)
1,3(τ +
k+1) = x
1,3(τ
x
(cid:48)
−
(cid:48)
1,5(τ +
k )eA(τk) + A3 (τk)
x
1,5(τ
k+1) = x

k )eA(τk)

eA1(t)

dt

(25)

(20)
(21)
(22)

(23)

(24)

(26)
(27)
(28)

=

(32)

(33)

where A1 (τk), A2 (τk), and A3 (τk) are given from (23).
Similarly for x2 (t), we have from (11) that ∂f x2
k (t)
∂zj
∂f x2
k (t)
∂ ˜θi

∂f

= 0, i = 1, 2, 3, 5, j = 1, 2, and
1 − hON (t)
1 − d hON (t)

= m1

= α2

x3,0

∂f

(cid:17)
(cid:17) − β2

(cid:16)
(cid:16)

(cid:16)

x2
k (t)
∂x1
x2
k (t)
∂x2
x2
k (t)
∂ ˜θ4
x2
k (t)
∂ ˜θ6

∂f

∂f

(cid:17)

x3,0

1 − d hON (t)

x3,0

=
= −x2 (t)

x2 (t)

(cid:0)t, x

Combining the last four equations and solving for x(cid:48)
yields, for t ∈ [τk, τk+1),
(cid:48)
(cid:48)
2,i(τ +
k )eB1(t)+B2
2,i(t) = x
x
(cid:48)
(cid:48)
2,4(τ +
2,4(t) = x
(cid:48)
(cid:48)
2,6(τ +
2,6(t) = x

k ), A1 (t)(cid:1) ,
(cid:0)t, x
k ), B1 (t)(cid:1)
(cid:0)t, x
k ), B1 (t)(cid:1)
(cid:21)
(cid:19)

k )eB1(t) + B3
k )eB1(t) + B4

(cid:48)
1,4(τ +
(cid:48)
1,6(τ +

x
x
with

(cid:48)
1,i(τ +

(cid:90) t

(cid:20)

i = 1, 2, 3, 5
(29)
(30)
(31)

2,i(t)

α2

1 − d

hON (t)

x3,0

− β2

dt

B1 (t) ≡

τk

B2 (·) ≡ eB1(t)

B3 (·) ≡ eB1(t)

B4 (·) ≡ eB1(t)

(cid:18)
(cid:90) t
(cid:90) t
(cid:90) t

τk

τk

τk

G1 (t, τk) e

−B1(t)dt

G2 (t, τk) e

−B1(t)dt

(cid:16)

G3 (t, τk) e

1 − d hON (t)

G3 (t, τk)

x3,0

x3,0

(34)

(cid:17)

−B1(t)dt

1 − hON (t)

k )eA1(t),
1,4(t) ·

x(cid:48)
1,i(τ +
+e−B1(t)x(cid:48)

(cid:105)
, t ∈ [τk, τk+1).

(cid:16)
(cid:17)
(cid:17) − x2 (t)
(cid:0)τk, x
k ), A (τk)(cid:1) (35)
(cid:0)t, x
k ), B1 (τk)(cid:1) (36)
k ), B1 (τk)(cid:1) (37)
(cid:0)t, x
(cid:0)τk, x(cid:48)
k ), A (τk)(cid:1),
k ), B1 (τk)(cid:1)
(cid:0)t, x(cid:48)

(cid:48)
1,i(τ +
(cid:48)
1,4(τ +
(cid:48)
1,6(τ +

1,i(τ +
1,6(τ +

B2
B4

=

x3,0

(cid:17)

= m1

where G1 (t, τk)

(cid:16)
e−B1(t)(cid:104)

G2 (t, τk) = e−B1(t)x2 (t)
m1

1 − d hON (t)
,
1,6(t) · m1
x(cid:48)

(cid:16)
In particular, at τ−
(cid:48)
x
2,i(τ
(cid:48)
2,4(τ
x
(cid:48)
x
2,6(τ

−
(cid:48)
2,i(τ +
k+1) = x
−
(cid:48)
2,4(τ +
k+1) = x
−
(cid:48)
2,6(τ +
k+1) = x
where
1,4(τ +

k ), B1 (τk)(cid:1),

(cid:0)t, x(cid:48)

1 − d hON (t)
k+1:
k )eB1(τk) + B2
k )eB1(τk) + B3
k )eB1(τk) + B4
B1 (τk),

B3
are given from (32).

and

x3,0

Finally, for the “clock” state variable, from (5)-(6) we have
∂f zi
k (t)
= 0, n, j = 1, 2, i = 1, . . . , 6, so
∂xn

= ∂f zi
k (t)
∂ ˜θi

= ∂f zi

k (t)
∂zj

j,i(τ +

dt z(cid:48)
that d
Hence, z(cid:48)
[τk, τk+1).

j,i(t) = 0, j = 1, 2, i = 1, . . . , 6, for t ∈ [τk, τk+1).
k ), j = 1, 2, i = 1, . . . , 6, and t ∈
j,i(t) = z(cid:48)
2. The system is in state qOF F over interevent time interval
[τk, τk+1). Starting with x1 (t), based on (10) we once
again have ∂f x1
= 0, j = 1, 2,
i = 1, 2, 4, 6, but now

∂zj = ∂f x1
k (t)
∂ ˜θi

= ∂f x1

k (t)
∂x2

k (t)

(cid:2)1 + φOF F

β

(t)(cid:3)−1

= α1
− m1

α

1 − hOF F (t)

(cid:2)1 + φOF F
(t)(cid:3)−1 − β1
(cid:17) − λ1
(cid:16)
(cid:2)1 + φON
α (t)(cid:3)−1
(t)(cid:3)−1
(cid:2)1 + φON

x3,0

β

= x1
= −x1

∂f

x1
k (t)
∂x1

∂f

∂f

x1
k (t)
∂ ˜θ3
x1
k (t)
∂ ˜θ5

x

Therefore, (15) implies that, for t ∈ [τk, τk+1):
(cid:48)
k )eC1(t), i = 1, 2, 4, 6
1,i(t) = x
(cid:48)
(cid:48)
1,3(τ +
1,3(t) = x
x
(cid:21)
−
(cid:48)
(cid:48)
1,5(τ +
k+1) = x
1,5(τ

k )eC1(t) + C2 (t)
k )eC1(τk) + C3 (t)

(cid:48)
1,i(τ +

with

(cid:20)

x

C1 (t) ≡(cid:82) t
−(cid:82) t

m1
x3,0

τk

τk

C2 (t) ≡ eC1(t)

C3 (t) ≡ eC1(τk)

α1
α

1+φOF F

(cid:20)
(cid:90) t
(cid:90) τk+1

τk

(cid:34)

(t) −

β1

1+φOF F

(t)

β

hOF F (t) dt − (m1 + λ1) (t − τk)

x1 (t)
1 + φOF F

α

−C1(t)
e

(t)

dt

(cid:21)

dt

(cid:35)

−

x1 (t)
1 + φOF F

β

(t)

eC1(t)

dt(43)

τk

(cid:16)
(cid:16)

In particular, at τ−
k+1:
(cid:48)
−
(cid:48)
1,i(τ +
k+1) = x
1,i(τ
x
(cid:48)
−
(cid:48)
k )eC1(τk) + C2 (τk)
1,3(τ +
k+1) = x
1,3(τ
(cid:48)
−
(cid:48)
1,5(τ +
k )eC1(τk) + C3 (τk)
1,5(τ
k+1) = x

k )eC1(τk)

x
x

where C1 (τk), C2 (τk), and C3 (τk) are given from (41).

Similarly for x2(t), we have

(cid:17)
(cid:17) − β2

x2 (t)

∂f

∂f

∂f

∂f

x2
k (t)
∂x1
x2
k (t)
∂x2
x2
k (t)
∂ ˜θ4
x2
k (t)
∂ ˜θ6

= m1

= α2

(cid:16)

1 − hOF F (t)
1 − d hOF F (t)

x3,0

x3,0

(cid:17)

1 − d hOF F (t)

x3,0

=
= −x2 (t)

(cid:0)t, x

It is thus straightforward to verify that (15) yields, for t ∈
[τk, τk+1),
(cid:48)
(cid:48)
k )eD1(t)+D2
2,i(τ +
2,i(t) = x
x
(cid:48)
(cid:48)
2,4(τ +
2,4(t) = x
(cid:48)
(cid:48)
2,6(τ +
2,6(t) = x

k ), C1 (t)(cid:1) ,
k ), D1 (t)(cid:1)
(cid:0)t, x
k ), D1 (t)(cid:1)
(cid:0)t, x
(cid:19)
(cid:21)

(cid:48)
1,i(τ +
(cid:48)
1,4(τ +
(cid:48)
1,6(τ +

i = 1, 2, 4, 6
(47)
(48)
(49)

k )eD1(t) + D3
k )eD1(t) + D4

x
x
with

(cid:90) t

(cid:20)

1 − d

α2

hOF F (t)

− β2

dt

D1 (t) ≡

(38)
(39)
(40)

(41)

(42)

(44)
(45)
(46)

(50)

(51)

(52)

(cid:18)
(cid:90) t
(cid:90) t
(cid:90) t

τk

τk

τk

τk

D2 (·) ≡ eD1(t)

D3 (·) ≡ eD1(t)

D4 (·) ≡ eD1(t)

x3,0

G2 (t, τk) e

−D1(t)dt

G3 (t, τk) e

−D1(t)dt

G4 (t, τk) e

(cid:16)

−D1(t)dt
1 − hOF F (t)

(cid:17)

x3,0

(cid:16)

1 − d hOF F (t)
1,6(t)·m1

x3,0

(cid:17)
(cid:16)

where G2 (t, τk) = m1

G3 (t, τk)

(cid:16)
(cid:17)
m1
x2 (t), t ∈ [τk, τk+1).

=
1 − d hOF F (t)

x3,0

x2 (t)

, G4 (t, τk) = x(cid:48)

x(cid:48)
1,i(τ +
+ x(cid:48)

k )eC1(t),
·
1,4(t)
1 − d hOF F (t)

(cid:17)−

x3,0

k

k

−

−

in

(cid:48)
k,i

(cid:48)
k,i

(56)

k (τ

(cid:48)
1,i(τ

k ) = x

k (t)
∂zj

k (t)
∂xn

j,i(τ +

(cid:48)
1,i(τ +

(cid:48)
1,4(τ +
(cid:48)
1,6(τ +

k ), C (τk)(cid:1) (53)
k ), D1 (τk)(cid:1)
k ), D1 (τk)(cid:1)

In particular, at τ−
(cid:48)
x
2,i(τ
x
x

(cid:48)
−
2,i(τ +
k+1) = x
(cid:48)
(cid:48)
2,4(τ +
2,4(t) = x
(cid:48)
(cid:48)
2,6(τ +
2,6(t) = x

k+1:
k )eD1(τk) + D2
k )eD1(t) + D3
k )eD1(t) + D4

(cid:0)τk, x
(cid:0)t, x
(cid:0)t, x

k+1(τ +

k+1(τ +

(54)
(55)
where D1 (τk), D2 (·), D3 (·), and D4 (·) are given from (50).
Finally, for the “clock” state variable, based on (5)-(6) we
= ∂f zi
= 0, n, j = 1, 2,
dt z(cid:48)
j,i(t) = 0, j = 1, 2, i = 1, . . . , 6,
k ), j = 1, 2,

once again have ∂f zi
i = 1, . . . , 6, so that d
for t ∈ [τk, τk+1). As a result, z(cid:48)
i = 1, . . . , 6, and t ∈ [τk, τk+1).

= ∂f zi
k (t)
∂ ˜θi
j,i(t) = z(cid:48)

k+1(τ +
k (τ−

(57)
k+1(τ +
k )

k−1)e
+µ3σ[1 − e

(cid:48)
1,i(τ +
x
and
(cid:48)
2,i(τ +
x
where f x1

3. A state transition from qON to qOF F occurs at time
τk. This necessarily implies that event e1 took place at time
τk, i.e., q(t) = qON , t ∈ [τk−1, τk) and q(t) = qOF F , t ∈
[τk, τk+1). From (16) we have, for i = 1, . . . , 6,

k ) +(cid:2)f x1
k )(cid:3) · τ
k )(cid:3) · τ
k ) +(cid:2)f x2
(cid:48)
ultimately depend on hON(cid:0)τ−
(cid:1). Evaluating
(cid:1) and hOF F(cid:0)τ +
k ) = x
2,i(τ
k ) − f x2
k ) − f x1
k (τ−
(cid:1) from (7) over the appropriate time interval results
hON(cid:0)τ−
hON(cid:0)τ
(cid:1) = x3(τ +
(cid:1) = x3(τ +
and it follows directly from (9) that hOF F(cid:0)τ +

k ) − f x1
−
k ) − f x2
−
k (τ
k ) and f x2

−(τk−τk−1)/σ
−(τk−τk−1)/σ] + ˜ζ3(τk)

∆1
f (τk, ζ3 (τk)) =
− α1
+ β1
+ m1
x3,0

k ).
Moreover, by continuity of xn(t) (due to conservation of
k ) = xn(τ−
mass), xn(τ +
k ), n = 1, 2. Also, since we have
assumed that {ζi(t)}, i = 1, . . . , 3, is piecewise continuous
w.p.1 and that no two events can occur at the same time
w.p.1, ζi(τ−
(cid:110)
(cid:2)1 + φON
k )(cid:3)−1
k ) = ζi(τ +
k ), i = 1, . . . , 3. Hence, for x1(t),
f (τk) ≡ f x1
k ) − f x1
k (τ−
evaluating ∆1
k )(cid:3)−1 − β1
(cid:2)1 + φOF F
(cid:2)1 + φON
(cid:2)1 + φOF F
k )(cid:3)−1
α (τ
(cid:1) − x3(τk)(cid:3)(cid:111) · x1(τk)
(cid:2)hON(cid:0)τ
k ) ultimately depend on hON(cid:0)τ−
(cid:2)x3(τk) − hON(cid:0)τ
(cid:2)hON(cid:0)τ

α1
(τ +
(τ +
−
k
Finally, the term τ(cid:48)
k,i, which corresponds to the event time
derivative with respect to ˜θi at event time τk, is determined
using (18), as detailed in (63) later.

(cid:1) and hOF F(cid:0)τ +
k (τ−
A similar analysis applies to x2(t), so that f x2
k ) and
f x2
k+1(τ +
f (τk) ≡ f x2
k ) −
k (τ−
(cid:1)(cid:3) · x2(τk)
respectively. Hence, evaluating ∆2
(cid:1) − x3(τk)(cid:3) · x1(τk)
f x2
k+1(τ +

k ) from (11) yields
f (τk, ζ3 (τk)) = α2d
x3,0
− m1

k )(cid:3)−1

k ) yields

k+1(τ +

(cid:1),

(58)

∆2

−
k

−
k

(τ

−

−

k

k

k

α

β

k

β

−
k

x3,0

(59)

1,i(τ +

k ) − τ(cid:48)

In the case of the “clock” state variable, z1(t) is discon-
tinuous in t at t = τk, while z2(t) is continuous. Hence,
based on (17) and (5), we have that z(cid:48)
k ) = 0. From
(16) and (6), it is straightforward to verify that z(cid:48)
k ) =
2,i(τ−
z(cid:48)
4. A state transition from qOF F to qON occurs at time
τk. This necessarily implies that event e2 took place at time
τk, i.e., q(t) = qOF F , t ∈ [τk−1, τk) and q(t) = qON ,
t ∈ [τk, τk+1). The same reasoning as above holds, so that
(56)-(57) also apply. For x1(t), f x1
k ) can be

k,i, i = 1, . . . , 6.

k )− f x1

k (τ−

k+1(τ +

2,i(τ +

k

k

k

−
k

k−1)e

−(τk−τk−1)/σ

+(µ3σ + x3,0)[1 − e

−(τk−τk−1)/σ] + ˜ζ3(τk)

appropriate time interval results in

(cid:1). Evaluating hOF F(cid:0)τ−
(cid:1) = x3(τ +

k ).
As in the previous case, continuity due to conservation
k ) −

evaluated from (10) and ultimately depends on hOF F(cid:0)τ−
(cid:1)
and hON(cid:0)τ +
(cid:1) from (9) over the
hOF F(cid:0)τ
and it follows directly from (7) that hON(cid:0)τ +
(cid:1) = x3(τ +
f (τk) ≡ f x1
(cid:110)
(cid:2)1 + φOF F
k )(cid:3)−1
k )(cid:3)−1 − β1
(cid:2)1 + φOF F
k )(cid:3)−1
−
k )(cid:3)−1
(cid:1) − x3(τk)(cid:3)(cid:111) · x1(τk)
(cid:2)x3(τk) − hOF F(cid:0)τ
(cid:2)hOF F(cid:0)τ

f (τk) ≡ f x2
k ) −
k (τ−
(cid:1)(cid:3) · x2(τk)
k ) from (11), and making the appropriate simpliﬁca-
(cid:1) − x3(τk)(cid:3) · x1(τk)

of mass applies, so that evaluating ∆1
f x1
k+1(τ +
k ) yields
∆1
f (τk, ζ3 (τk)) =
− α1
+ β1
+ m1
x3,0

Similarly for x2(t), by evaluating ∆2
f x2
k+1(τ +
tions due to continuity, we obtain

(cid:2)1 + φON
(cid:2)1 + φON
(cid:2)hOF F(cid:0)τ

f (τk, ζ3 (τk)) = α2d
x3,0
− m1

α (τ +
(τ +
−
k

k (τ−

(60)

∆2

−
k

α1

(τ

(τ

−

k

α

β

β

−
k

x3,0

(61)

1,i(τ +

k )− τ(cid:48)
k ) = 0, i = 1, . . . , 6.
j,i(t) = z(cid:48)
k ) = z(cid:48)
j,i(τ +

In the case of the “clock” state variable, z1(t) is con-
tinuous in t at t = τk, while z2(t) is discontinuous. As
a result, based on (16) and (5), we have that z(cid:48)
k ) =
1,i(τ−
z(cid:48)
k,i. From (17) and (6), it is simple to verify that
z(cid:48)
2,i(τ +
k ), t ∈ [τk, τk+1), we
Note that, since z(cid:48)
j,i(τ +
j,i(τ−
will have that z(cid:48)
k−1), j = 1, 2, i = 1, . . . , 6.
Moreover, the sample path of our SHA consists of a se-
quence of alternating e1 and e2 events, which implies that
1,i(τ−
z(cid:48)
k ) =
0 if event e2 occurred at τk−1. Then, adopting the notation
p, p = {1, 2} such that p + p = 3, we have:

k ) = 0 if event e1 occurred at τk−1, while z(cid:48)

2,i(τ−

(cid:48)
p,i(τ +

k ) =

z

if event ep occurs at τk
otherwise

(62)

(cid:26) −τ(cid:48)

k,i

0

We now proceed with a general result which applies to
all events deﬁned for our SHA model. We denote the time
of occurrence of the jth state transition by τj, deﬁne its
j,i ≡
derivative with respect to the control parameters as τ(cid:48)
(τj) ≡ ˙xn(τj), n =

, i = 1, . . . , 6, and also deﬁne f xn

j

∂τj
∂ ˜θi
1, 2.
derivative τ(cid:48)
j = 1, 2, . . . with respect
i = 1, . . . , 6, satisﬁes:

Lemma 1. When an event ep, p = 1, 2, occurs, the
j,i, i = 1, . . . , 6, of state transition times τj,
to the control parameters ˜θi,



τ(cid:48)
j,i =

1−x(cid:48)
f x1
j−1(τ

−
j )−x(cid:48)
1,i(τ
−
j )+f x2

−
j )
2,i(τ
−
j−1(τ
j )

−
−x(cid:48)
j )−x(cid:48)
1,i(τ
−
f x1
j )+f x2
j−1(τ

2,i(τ
j−1(τ

−
j )
−
j )

if e1 occurs and i = 1
or e2 occurs and i = 2
if e1 occurs and i (cid:54)= 1
or e2 occurs and i (cid:54)= 2

(63)
Proof: The proof is omitted here, but can be found in

[5].
We note that the numerator in (63) is determined using
(26) and (35) if q(τ−
j ) =
qOF F . Moreover, the denominator in (63) is computed using

j ) = qON , or (44) and (53) if q(τ−

(10)-(11) and it is simple to verify that, if event e1 takes place
at time τj,
−
j ) + f x2
β1

j )(cid:3)−1 · x1(τj)

−
j ) = α1
(τ

f x1
j−1(τ

j−1(τ

−

−(cid:110)
(cid:20)

+

α2

(cid:2)1 + φON
(cid:18)

1 − d

β
hON (τ
x3,0

j )(cid:3)−1
(cid:19)

−
−
j )

(64)

α (τ

+ λ1
− β2

(cid:2)1 + φON
(cid:111) · x1(τj) + µ1
(cid:21)
(cid:2)1 + φOF F
(cid:111) · x1(τj) + µ1
j )(cid:3)−1
(cid:21)
(cid:19)

· x2(τj)

(τ

α

−
−
j )

+ λ1
− β2

· x2(τj)

j )(cid:3)−1 · x1(τj)

−

f x1
j−1(τ

+ ζ1(τj) + ζ2(τj)

−(cid:110)
(cid:20)

−
j ) + f x2
β1

(cid:2)1 + φOF F
(cid:18)

j−1(τ

+

α2

1 − d

(τ
β
hOF F (τ
x3,0

−
j ) = α1

and, if event e2 takes place at time τj,

+ ζ1(τj) + ζ2(τj)

B. Cost Derivative

(65)

Let us denote the total number of on and off-treatment
periods (complete or incomplete) in [0, T ] by KT . Also let
ξk denote the start of the kth period and ηk denote the end
of the kth period (of either type). Finally, let MT = (cid:98) KT
2 (cid:99)
be the total number of complete on-treatment periods, and
m denote the duration of the mth complete on-treatment
∆ON
period, where clearly

It was shown in [5] that the derivative of the sample
function L(˜θ) with respect to the control parameters satisﬁes:

m ≡ ηm − ξm, m = 1, 2, . . .
∆ON
(cid:82) ηk
KT(cid:80)
MT(cid:80)

(cid:20) x(cid:48)
·(cid:0)η(cid:48)

1,i(˜θ,t)+x(cid:48)
P SAinit

m,i − ξ(cid:48)

2,i(˜θ,t)

(cid:21)

(cid:1)

∆ON

k=1

dt

ξk

m
T

m=1

1 [KT is odd] · ξ(cid:48)

MT +1,i ·(cid:16) T−ξMT +1

m,i

T

(cid:17) (66)

dL(˜θ)
= W
d˜θi
T
+ (1−W )
− (1−W )

T

T

where 1 [·] is the usual indicator function and P SAinit is
the value of the patient’s PSA level at the start of the ﬁrst
on-treatment cycle.

The derivation of (66) is omitted here, but can be found
in [5]. We now proceed to present the results obtained from
our IPA-driven sensitivity analysis.

IV. RESULTS

The results shown here represent an initial study of sen-
sitivity analysis applied to a SHA model of prostate cancer
progression in which we consider only noise and ﬂuctuations
associated with cell population dynamics, and do not ac-
count for noise in the patient’s androgen level. Representing
randomness as Gaussian white noise, the authors in [15]
veriﬁed that variable time courses of the PSA levels were
produced without losing the tendency of the deterministic
system, thus yielding simulation results that were comparable
to the statistics of clinical data. For this reason, in this
work we take {ζi (t)}, i = 1, 2, to be Gaussian white noise
with zero mean and standard deviation of 0.001, similarly to
[15], although we remind the reader that our methodology
applies independently of the distribution chosen to represent
{ζi (t)}, i = 1, 2. We estimate the noise associated with cell
population dynamics at event times by randomly sampling
from a uniform distribution with zero mean and standard

deviation of 0.001. Simulations of the prostate cancer model
as a pure DES are thus run to generate sample path data to
which the IPA estimator is applied. In all results reported
here, we measure the sample path length in terms of the
number of days elapsed since the onset of IAS therapy, which
we choose to be T = 2500 days.

Three sets of simulations were performed: in the ﬁrst one
we consider the optimal therapy conﬁguration determined
for Patient #15 in [6] and vary the values of ˜θi, i = 3, . . . , 6
(one at a time). For the second, we use PSA threshold values
that yield a therapy of maximum cost and once again vary
the values of ˜θi, i = 3, . . . , 6 (one at a time). Finally, in
our third set of simulations, we let ˜θi, i = 3, . . . , 6, take the
nominal values from [11] and vary the values of ˜θ1 and ˜θ2
along their allowable ranges.

ters, dL
d˜θi
1, ˜θ∗

Table I presents the sensitivity of the model parame-
, i = 3, . . . , 6, around the optimal conﬁguration
= [1.5, 8.0] for the values of ˜θi, i = 3, . . . , 6, ﬁtted
to the model of Patient #15 in [11]. We note that the results
shown here are representative of the phenomena that may be
uncovered by this type of analysis, and were hence generated
using the model of a single patient. Moreover, while the use
of different patient models may potentially reveal additional
phenomena, the insights presented below are interesting in
their own right and thus set the stage for extending this
analysis to other patients.

(cid:104)˜θ∗

(cid:105)

2

SENSITIVITY OF MODEL PARAMETERS AROUND THE OPTIMAL THERAPY

TABLE I

CONFIGURATION

dL
dL
d ˜θ3
d ˜θ5
5.44 −0.25 −5.95

dL
d ˜θ4

dL
d ˜θ6
0.28

and dL
d˜θ4

≈ − dL
d˜θ5

From Table I, it can be seen that dL
d˜θ3

Recall that ˜θ3 and ˜θ4 correspond to the HSC proliferation
constant and CRC proliferation constant, respectively, while
˜θ5 and ˜θ6 are the HSC apoptosis constant and CRC apoptosis
constant, respectively. Several interesting remarks can be
made based on the above results;
in what follows, we
adopt the notation x ≈ y to indicate that x takes values
approximately equal to y.
≈
− dL
, which indicates that the sensitivities of proliferation
d˜θ6
and apoptosis constants are of the same order of magnitude
(in absolute value) for any given cancer cell subpopulation.
It is also possible to verify a large difference in the values of
the sensitivities across different subpopulations; in fact the
sensitivities of HSC proliferation and apoptosis constants are
approximately 21 times higher than those of CRC constants.
In other words, the system is more sensitive to changes in
the HSC constants than changes in the CRC constants, i.e.,
˜θ3 and ˜θ5 are more critical model parameters than ˜θ4 and
˜θ6. Additionally, dL
< 0 and
d˜θ3
> 0. A possible explanation for this has to do with the
dL
d˜θ5
fact that HSCs are the dominant subpopulation in a prostate
tumor under IAS therapy, which means that the size of this
subpopulation has a greater impact on the overall size of the
tumor, and consequently, on the value of the PSA level. As
a result, increasing ˜θ3 (or decreasing ˜θ5) leads to an increase
in the size of the HSC population, reﬂected in the PSA level,

> 0, while dL
d˜θ4

> 0 and dL
d˜θ6

thus increasing the overall cost. On the other hand, increasing
˜θ4 (or decreasing ˜θ6) directly increases the size of the CRC
population; however, since the conditions under which CRCs
thrive are those under which HSCs perish, an increase in the
size of the CRC population implies that the size of the HSC
population will decrease. Given that HSCs are the dominant
subpopulation, the PSA level would ultimately decrease, thus
decreasing the overall cost.

The effect of changes in ˜θi, i = 3, . . . , 6, on the sensitivity
of model parameters was analyzed next. As the values of
˜θi, i = 3, . . . , 6, were progressively altered, two scenarios
emerged: Scenario A - a set of model parameter values
was found for which the evolution of the prostate tumor is
permanently halted after one or two cycles of treatment, i.e.,
the simulated IAS therapy scheme is curative; Scenario B
- a set of model parameter values was found for which the
prostate tumor grows in an uncontrollable manner, i.e., the
simulated IAS therapy scheme is ineffective. Scenario A
occurred when ˜θ3 took on values that were at least 15%
smaller than the nominal value given in [11], or when ˜θ5 took
on values that were at least 30% smaller than the nominal
value given in [11]; no variations in either ˜θ4 or ˜θ6 lead
to such scenario. On the other hand, Scenario B occurred
when ˜θ3 took on values that were at least 15% higher than
the nominal value given in [11], or when ˜θ4 took on values
that were at least 10% higher than the nominal value given
in [11], or when ˜θ5 took on values that were at least 30%
higher than the nominal value given in [11], or when ˜θ6 took
on values that were at least 10% smaller than the nominal
value given in [11].

In practical terms, the above results indicate that if the
optimal IAS therapy (designed using the model of Patient
#15) were applied to a new patient whose HSC population
dynamics are slower than those of Patient #15 (i.e., the new
patient’s HSC proliferation constant is at least 15% smaller
than that of Patient #15; or the new patient’s HSC apoptosis
constant is at least 30% smaller than that of Patient #15),
then the size of the new patient’s tumor would remain stable
and under control after at most two treatment cycles. On the
other hand, if the optimal IAS therapy (designed using the
model of Patient #15) were applied to a new patient whose
HSC population dynamics are faster than those of Patient
#15, then the size of the new patient’s tumor would grow
uncontrollably.

In our second set of simulations, we let ˜θ1 and ˜θ2 take
suboptimal values and once again vary the values of ˜θi, i =
3, . . . , 6 (one at a time). Table II presents the sensitivity of the
model parameters, dL
, i = 3, . . . , 6, around the suboptimal
d˜θi
= [7.5, 15.0] for the values of ˜θ1, i =
conﬁguration
3, . . . , 6, ﬁtted to the model of Patient #15 in [11].

(cid:104)˜θ1, ˜θ2

(cid:105)

SENSITIVITY OF MODEL PARAMETERS AROUND A SUBOPTIMAL

TABLE II

THERAPY CONFIGURATION

dL
d ˜θ3
17.78

dL
d ˜θ4
0.014 −17.15 −0.016

dL
d ˜θ5

dL
d ˜θ6

Once again, the effect of changes in ˜θi, i = 3, . . . , 6, on
the sensitivity of model parameters was analyzed. Scenario
A occurred when ˜θ3 took on values that were at least 10%

smaller than the nominal value given in [11], or when ˜θ5 took
on values that were at least 20% larger than the nominal value
given in [11]; no variations in either ˜θ4 or ˜θ6 lead to such
scenario. Moreover, Scenario B did not emerge in any of the
simulations performed under this suboptimal conﬁguration.
In our third set of simulations, we investigate the behavior
of the model parameter sensitivities, dL
, i = 3, . . . , 6, across
d˜θi
different PSA threshold settings. In particular, we study how
the sensitivity values change as we move from an optimal
therapy setting towards various suboptimal settings. For such,
we let ˜θi, i = 3, . . . , 6, take the nominal values given in [11]
and vary the values of the lower and upper PSA thresholds
along

(cid:104)˜θmin

(cid:104)˜θmin

, respectively.

(cid:105)

(cid:105)

, ˜θmax

1

and

1

, ˜θmax

2

2

Figs. 2-5 show how the values of the sensitivities, dL
,
d˜θi
i = 3, . . . , 6, vary as a function of the values of the lower
and upper PSA thresholds ( dL
, respectively) for the
d˜θ1
model of Patient #15.

and dL
d˜θ2

Fig. 2. Sensitivity of ˜θ3 as a function of the values of ˜θ1 and ˜θ2 (Patient
#15)

Fig. 3. Sensitivity of ˜θ4 as a function of the values of ˜θ1 and ˜θ2 (Patient
#15)

Figs. 6-9 show how the values of the sensitivities, dL
,
d˜θi
i = 3, . . . , 6, vary as a function of the values of the lower
, respectively) for the
and upper PSA thresholds ( dL
d˜θ1
model of Patient #1.

and dL
d˜θ2

The above results lend themselves to the following dis-
cussion: ﬁrst, the values of the model parameter sensitivities,
, i = 3, . . . , 6, are neither monotonically increasing nor
dL
d˜θi
monotonically decreasing along the allowable ranges of dL
d˜θ1
and dL
; this is veriﬁed for both patients. Second, the system
d˜θ2

Fig. 4. Sensitivity of ˜θ5 as a function of the values of ˜θ1 and ˜θ2 (Patient
#15)

Fig. 5. Sensitivity of ˜θ6 as a function of the values of ˜θ1 and ˜θ2 (Patient
#15)

is more sensitive to parameters ˜θ3 and ˜θ5 (HSC proliferation
and apoptosis constants, respectively), and more robust to
˜θ4 and ˜θ6 (CRC proliferation and apoptosis constants, re-
spectively); again this is veriﬁed across different patients. A
possible explanation for this has to do with the fact that HSCs
are commonly assumed to be the dominant subpopulation is
a prostate tumor undergoing IAS therapy, which means that
the size of the this subpopulation has a greater impact on the
overall size of the tumor and, consequently, on the value of
the PSA level.

Additionally, note that two points are marked in Figs. 2-9:
a star marks the optimal therapy conﬁguration and a square
marks the values of ˜θ1 and ˜θ2 for which the sensitivities
, i = 3, . . . , 6, are minimal. In [6] the optimal therapy
dL
d˜θi

Fig. 6. Sensitivity of ˜θ3 as a function of the values of ˜θ1 and ˜θ2 (Patient
#1)

(cid:105)

(cid:105)

(cid:104)˜θ1, ˜θ2

tion in favor of increased system robustness could potentially
be worthwhile in at least some cases. In fact, for Patient
#1, moving from an optimal therapy setting to a slightly
suboptimal setting along ˜θ2 (namely
= [2.5, 9.0])
leads to a 9% increase in the cost of treatment. However,
the model parameter sensitivities at this setting decrease by
approximately 30% for ˜θ3 and ˜θ5 and by approximately 70%
for ˜θ4 and ˜θ6. If we move to a suboptimal setting along ˜θ1
(namely
= [3.5, 8.0]), the cost increases by 16%,
while the sensitivities decrease by approximately 50% for ˜θ3
and ˜θ5 and by approximately 90% for ˜θ4 and ˜θ6. In this case,
it seems advantageous to tradeoff optimality for increased
robustness.

(cid:104)˜θ1, ˜θ2

(cid:104)˜θ1, ˜θ2

It is interesting to note that the above analysis is not con-
sistently veriﬁed across different patients. In fact, for Patient
#15, a marked decrease in system fragility only occurs when
we move to a suboptimal setting along ˜θ1 (namely
=
[7.5, 8.0]), at which point the sensitivities decrease by ap-
proximately 70% for ˜θ3 and ˜θ5 and by approximately 99%
for ˜θ4 and ˜θ6. However, there is an increase in the cost value
of the order of 70%, which indicates that system optimality
is signiﬁcantly compromised. These results highlight
the
importance of applying our methodology on a patient-by-
patient basis. More generally, they validate recent efforts
favoring the development of personalized cancer therapies,
as opposed to traditional treatment schemes that are typically
generated over a cohort of patients and thus effective only
on average.

(cid:105)

V. CONCLUSIONS

We use a stochastic model of prostate cancer evolution un-
der IAS therapy to perform sensitivity analysis with respect
to several important model parameters. We ﬁnd the system
to be more sensitive to changes in the HSC proliferation and
apoptosis constants than changes in the CRC proliferation
and apoptosis constants. We also identify a set of model pa-
rameter values for which the simulated IAS therapy scheme
is essentially curative, as well as a set of model parameters
for which the prostate tumor grows in an uncontrollable
manner. Finally, we verify that relaxing optimality in favor
of increased system stability can potentially be of interest in
at least some cases.

This work is a ﬁrst attempt at investigating the tradeoff be-
tween optimality and system robustness/fragility in stochastic
models of cancer evolution. A subset of all model parameters
is selected and a case study of prostate cancer is used to
illustrate the applicability of our IPA-based methodology.
Nevertheless,
there exist several other potentially critical
parameters in the SHA model of prostate cancer evolution we
study, so that part of our ongoing work includes extending
this sensitivity analysis study to other model parameters. Ad-
ditionally, future work includes applying this methodology
to other types of cancer (e.g., breast cancer), as well as
other diseases that are known to progress in stages (e.g.,
tuberculosis).

REFERENCES

[1] N. Bruchovsky, L. Klotz, J. Crook, S. Malone, C. Ludgte, W. Morris,
M.E. Gleave, S.L. Goldenberg, and P.S. Rennie. Final results of

Fig. 7. Sensitivity of ˜θ4 as a function of the values of ˜θ1 and ˜θ2 (Patient
#1)

(cid:104)˜θ∗

1, ˜θ∗

2

(cid:105)

(cid:104)˜θ∗

(cid:105)

Fig. 8. Sensitivity of ˜θ5 as a function of the values of ˜θ1 and ˜θ2 (Patient
#1)

2

(cid:105)

1, ˜θ∗

conﬁgurations were found to be
= [1.5, 8.0] for
Patient #15 and
= [2.5, 8.0] for Patient #1. As it
can be seen in Figs. 2-9, these settings are not located in
the regions of minimum sensitivities. Of note, the sensi-
, i = 3, . . . , 6, take their minimum value at the
tivities dL
d˜θi
same suboptimal conﬁguration (namely
= [7.5, 8.0])
across different patients. This could potentially point
to
the existence of an underlying, and most likely as of yet
poorly understood, equilibrium of cancer cell subpopulation
dynamics at this suboptimal setting.

(cid:104)˜θ1, ˜θ2

Moreover, the tradeoff between system fragility and op-
timality seems more strongly applicable to ˜θ1, and less so
to ˜θ2; interestingly, the value of ˜θ∗
1 differed across patients,
while ˜θ∗
2 did not. In this sense, relaxing the optimality condi-

Fig. 9. Sensitivity of ˜θ6 as a function of the values of ˜θ1 and ˜θ2 (Patient
#1)

[3] C.G. Cassandras and S. Lafortune.

Systems. Springer, 2nd edition, 2008.

Introduction to Discrete Event

the Canadian prospective phase II trial of intermittent androgen
suppression for men in biochemical recurrence after radiotherapy for
locally advanced prostate cancer. Cancer, 107:389–395, 2006.

[2] N. Bruchovsky, L. Klotz, J. Crook, S. Malone, C. Ludgte, W. Morris,
M.E. Gleave, S.L. Goldenberg, and P.S. Rennie. Locally advanced
prostate cancer biochemical results from a prospective phase II
study of intermittent androgen suppression for men with evidence of
prostate-speciﬁc antigen recurrence after radiotherapy. Cancer, 109:
858–867, 2007.

[4] C.G. Cassandras, Y. Wardi, C.G. Panayiotou, and C. Yao. Perturbation
analysis and optimization of stochastic hybrid systems. European
Journal of Control, 6(6):642–664, 2010.

[5] J. L. Fleck and C. G. Cassandras. Inﬁnitesimal perturbation analysis
for personalized cancer therapy design. Proc. of 5th IFAC Conference
on Analysis and Design of Hybrid Systems, pages 205–210, 2015.

[6] J. L. Fleck and C. G. Cassandras. Optimal design of personalized
prostate cancer therapy using inﬁnitesimal perturbation analysis. Non-
linear Analysis: Hybrid Systems, under review.

[7] Y. Hirata, N. Bruchovsky, and K. Aihara. Development of a mathemat-
ical model that predicts the outcome of hormone therapy for prostate
cancer. J. Theor. Biology, 264:517–527, 2010.

[8] Y. Hirata, M. di Bernardo, N. Bruchovsky, and K. Aihara. Hybrid
optimal scheduling for intermittent androgen suppression of prostate
cancer. Chaos, 20:045125, 2010.

[9] A.M. Ideta, G. Tanaka, T. Takeuchi, and K. Aihara. A mathematical
model for intermittent androgen suppression for prostate cancer. J.
Nonlinear Sci., 18:593–614, 2008.

[10] T.L. Jackson. A mathematical investigation of the multiple pathways
to recurrent prostate cancer: comparison with experimental data.
Neoplasia, 6:697–704, 2004.

[11] B. Liu, S. Kong, S. Gao, P. Zuliani, and E.M. Clarke. Towards per-
sonalized cancer therapy using delta-reachability analysis. HSCC2015,
2015.

[12] D.L. Longo, A.S. Fauci, D.L. Kasper, S.L. Hauser, J.L. Jameson,
and J. Loscalzo, editors. Harrison’s principles of internal medicine.
McGraw-Hill, Medical Pub. Division, New York, 18th edition, 2012.
[13] T. Shimada and K. Aihara. A nonlinear model with competition be-
tween prostate tumor cells and its application to intermittent androgen
suppression therapy of prostate cancer. Mathematical Biosciences,
214:134–139, 2008.

[14] T. Suzuki, N. Bruchovsky, and K. Aihara. Piecewise afﬁne systems
modelling for optimizing therapy of prostate cancer. Philos. Trans. R.
Soc., 368:5045–5059, 2010.

[15] G. Tanaka, Y. Hirata, S.L. Goldenberg, N. Bruchovsky, and K. Aihara.
Mathematical modelling of prostate cancer growth and its application
to hormone therapy. Philos. Trans. R. Soc., 368:5029–5044, 2010.

[16] Y. Tao, Q. Guo, and K. Aihara. A mathematical model of prostate
J.

tumor growth under hormone therapy with mutation inhibitor.
Nonlinear Sci., 20:219–240, 2010.

