6
1
0
2

 
r
p
A
1

 

 
 
]

V
C
.
s
c
[
 
 

2
v
9
5
9
5
0

.

3
0
6
1
:
v
i
X
r
a

Eﬃcient Multi-Scale 3D CNN with fully connected CRF

for Accurate Brain Lesion Segmentation

Konstantinos Kamnitsasa, Christian Lediga, Virginia F.J. Newcombeb,c,

Joanna P. Simpsonb, Andrew D. Kaneb, David K. Menonb,c, Daniel

Rueckerta, Ben Glockera

aBiomedical Image Analysis Group, Imperial College London, UK

bUniversity Division of Anaesthesia, Department of Medicine, Cambridge University, UK

cWolfson Brain Imaging Centre, Cambridge University, UK

Abstract

We propose a dual pathway, 11-layers deep, three-dimensional Convolutional
Neural Network for the challenging task of brain lesion segmentation. The
devised architecture is the result of an in-depth analysis of the limitations of
current networks proposed for similar applications. To overcome the compu-
tational burden of processing 3D medical scans, we have devised an eﬃcient
and eﬀective dense training scheme which joins the processing of adjacent
image patches into one pass through the network while automatically adapt-
ing to the inherent class imbalance present in the data. Further, we analyze
the development of deeper, thus more discriminative 3D CNNs. In order to
incorporate both local and larger contextual information, we employ a dual
pathway architecture that processes the input images at multiple scales simul-
taneously. For post-processing of the network’s soft segmentation, we use a
3D fully connected Conditional Random Field which eﬀectively removes false
positives. Our pipeline is extensively evaluated on three challenging tasks of
lesion segmentation in multi-channel MRI patient data with traumatic brain
injuries, brain tumors, and ischemic stroke. We improve on the state-of-the-
art for all three applications, with top ranking performance on the public
benchmarks BRATS 2015 and ISLES 2015. Our method is computation-
ally eﬃcient, which allows its adoption in a variety of research and clinical
settings. The source code of our implementation is made publicly available.

Keywords: 3D Convolutional Neural Network, Fully Connected CRF,
Segmentation, Brain Lesions

April 4, 2016

1. Introduction

Segmentation and the subsequent quantitative assessment of lesions in
medical images provide valuable information for the analysis of neuropatholo-
gies and are important for planning of treatment strategies, monitoring of
disease progression, and prediction of patient outcome. For a better under-
standing of the pathophysiology of diseases, quantitative imaging can reveal
clues about the disease characteristics and eﬀects on particular anatomical
structures. For example, the associations of diﬀerent lesion types, their spa-
tial distribution and extent with acute and chronic sequelae after traumatic
brain injury (TBI) are still poorly understood (Maas et al. (2015)). However,
there is growing evidence that quantiﬁcation, of lesion volume for example,
may add insight into the functional outcome of patients (Ding et al. (2008);
Moen et al. (2012)). Exact locations of injuries relate to particular deﬁcits
depending on the brain structure that is aﬀected (Lehtonen et al. (2005);
Warner et al. (2010); Sharp et al. (2011)). Another example are brain tu-
mors, where accurate delineation and estimation of the relative volume of a
tumor’s sub-components are important for planning radiotherapy and treat-
ment follow-up (Wen et al. (2010)). More generally, volume and number
of lesions are biomarkers that have been shown to be related to cognitive
deﬁcits (Jokinen et al. (2009)) and are informative for assessing the eﬀective-
ness of diﬀerent therapies (Kappos et al. (2007)). For example, the volume
of white matter lesions (WMLs) is considered important in assessing stroke
(Ikram et al. (2010)). The functional deﬁcits caused by brain damage after
stroke are likely to be associated with the extent of the damage to particular
brain structures (Palmer and Carey (2013)). Further, in clinical research on
multiple sclerosis (MS), lesion load and lesion count are extracted from brain
MRI and used in models that aim to better understand disease progression
and eﬀectiveness of pharmaceutical treatment (Ge (2006); Rovira and Le´on
(2008)).

The quantitative analysis of lesions requires accurate lesion segmenta-
tion in multi-modal, three-dimensional images which is a challenging task
for a number of reasons. The heterogeneous appearance of lesions including
the large variability in location, size, shape and frequency make it diﬃcult
to devise eﬀective segmentation rules.
It is thus highly non-trivial to de-
lineate contusions, edema and haemorrhages in TBI (Irimia et al. (2012)),
or sub-components of brain tumors such as proliferating cells and necrotic
core (Menze et al. (2015)). The arguably most accurate segmentation results

2

can be obtained through manual delineation by a human expert which is
tedious, expensive, time-consuming, impractical in larger studies, and intro-
duces inter-observer variability. Additionally, for deciding whether a particu-
lar region is part of a lesion multiple image sequences with varying contrasts
need to be considered, and the level of expert knowledge and experience are
important factors that impact segmentation accuracy. Hence, in clinical rou-
tine often only qualitative, visual inspection, or at best crude measures like
approximate lesion volume and number of lesions are used (Yuh et al. (2012);
Wen et al. (2010)). In order to capture and better understand the complex-
ity of brain pathologies it is important to conduct large studies with many
subjects to gain the statistical power for drawing conclusions across a whole
patient population. The development of accurate, automatic segmentation
algorithms has therefore become a major research focus in medical image
computing with the potential to oﬀer objective, reproducible, and scalable
approaches to quantitative assessment of brain lesions.

Figure 1 illustrates some of the challenges that arise when devising a com-
putational approach for the task of automatic lesion segmentation. The ﬁgure
summarizes statistics and shows examples of brain lesions in the case of TBI,
but is representative of other pathologies such as brain tumors and ischemic
stroke. Lesions can occur at multiple sites, with varying shapes and sizes,
and their image intensity proﬁles largely overlap with non-aﬀected, healthy
parts of the brain or lesions which are not in the focus of interest. For exam-
ple, stroke and MS lesions have a similar hyper-intense appearance in FLAIR
sequences as other WMLs (Mitra et al. (2014); Schmidt et al. (2012)). It is
generally diﬃcult to derive statistical prior information about lesion shape
and appearance. On the other hand, in some applications there is an expec-
tation on the spatial conﬁguration of segmentation labels, for example there
is a hierarchical layout of sub-components in brain tumors. Ideally, a compu-
tational approach is able to adjust itself to application speciﬁc characteristics
by learning from a set of a few example images.

1.1. Related Work

A multitude of automatic lesion segmentation methods have been pro-
posed over the last decade, and several main categories of approaches can
be identiﬁed. One group of methods poses the lesion segmentation task as
an abnormality detection problem, for example by employing image regis-
tration. The early work of Prastawa et al. (2004) and more recent ones by
Schmidt et al. (2012) and Doyle et al. (2013) align the pathological scan to a

3

(a)

(b)

(c)

(d)

(e)

Figure 1: Heterogeneous appearance of TBI lesions poses challenges in de-
vising discriminative models. Lesion size varies signiﬁcantly with both large,
focal and small, diﬀused lesions (a,b). Alignment of manual lesion segmen-
tations reveals the wide spatial distribution of lesions in (c,d) with some
areas being more likely than others. (e) shows the average of the normal-
ized intensity histograms of diﬀerent MR channels over all the TBI cases in
our database, for healthy (green) and injured (red) tissue. One can observe
a large overlap between the distributions of healthy and non-healthy brain
tissue.

healthy atlas and lesions are detected based on deviations in tissue appear-
ance between the patient and the atlas image. Lesions, however, may cause
large structural deformations that may lead to incorrect segmentation due
to incorrect registration. Gooya et al. (2011); Parisot et al. (2012) alleviate
this problem by jointly solving the segmentation and registration tasks. Liu
et al. (2014) showed that registration together with a low-rank decomposi-
tion gives as a by-product the abnormal structures in the sparse components,
although, this may not be precise enough for detection of small lesions. Ab-
normality detection has also been proposed within image synthesis works.
Representative approaches are those of Weiss et al. (2013) using dictionary
learning and Ye et al. (2013) using a patch-based approach. The idea is to

4

010002000Intensity0.0000.0010.0020.003ProbabilityMPRAGELesionHealthy010002000IntensityFLAIR010002000IntensityT2010002000IntensityGE010002000IntensityPDsynthesize pseudo-healthy images that when compared to the patient scan
allow to highlight abnormal regions. In this context, Cardoso et al. (2015)
present a generative model for image synthesis that yields a probabilistic seg-
mentation of abnormalities. Another unsupervised technique is proposed by
Erihov et al. (2015), a saliency-based method that exploits brain asymmetry
in pathological cases. A common advantage of the above methods is that
they do not require a training dataset with corresponding manual annota-
tions. In general, these approaches are more suitable for detecting lesions
rather than accurately segmenting them.

Some of the most successful, supervised segmentation methods for brain
lesions are based on voxel-wise classiﬁers, such as Random Forests (RF).
Representative work is that of Geremia et al. (2010) on MS lesions, employ-
ing intensity features to capture the appearance of the region around each
voxel. Zikic et al. (2012) combine this with a generative Gaussian Mixture
Model (GMM) to obtain tissue-speciﬁc probabilistic priors (Van Leemput
et al. (1999)). This framework was adopted in multiple works, with repre-
sentative pipelines for brain tumors by Tustison et al. (2013) and TBI by Rao
et al. (2014). Both works incorporate morphological and contextual features
to better capture the heterogeneity of lesions. Rao et al. (2014) also incorpo-
rate brain structure segmentation results obtained from a multi-atlas label
propagation approach (Ledig et al. (2015)) to provide strong tissue-class pri-
ors to the Random Forests. Tustison et al. (2013) additionally use a Markov
Random Field (MRF) to incorporate spatial regularization. MRFs are com-
monly used to encourage spatial continuity of the segmentation (Schmidt
et al. (2012); Mitra et al. (2014); Dalca et al. (2014)). Although those meth-
ods have been very successful, it appears that their modeling capabilities still
have signiﬁcant limitations. This is conﬁrmed by the results of the most re-
cent challenges 1, and also by our own experience and experimentation with
such approaches.

At the same time, deep learning techniques have emerged as a powerful al-
ternative for supervised learning with great model capacity and the ability to
learn highly discriminative features for the task at hand. These features often
outperform hand-crafted and pre-deﬁned feature sets. In particular, Convo-
lutional Neural Networks (CNNs) (LeCun et al. (1998); Krizhevsky et al.
(2012)) have been applied with promising results on a variety of biomedical

1links: http://braintumorsegmentation.org/, www.isles-challenge.org

5

imaging problems. Ciresan et al. (2012) presented the ﬁrst GPU implemen-
tation of a two-dimensional CNN for the segmentation of neural membranes.
Most related to our own approach are the CNN based tumor segmentation
methods of Zikic et al. (2014); Davy et al. (2014); Havaei et al. (2015); Pereira
et al. (2015), with the latter being the best performing automatic approach in
the BRATS 2015 challenge (Menze et al. (2015)). These methods are based
on 2D CNNs that have been used extensively in computer vision applications
on natural images. Here, the segmentation of a 3D brain scan is achieved by
processing each 2D slice independently, which is arguably a non-optimal use
of the volumetric medical image data.

Fully 3D CNNs come with an increased number of parameters and sig-
niﬁcant memory and computational requirements. Previous work discusses
problems and apparent limitations when employing a 3D CNN on medical
imaging data (Prasoon et al. (2013); Li et al. (2014); Roth et al. (2014);
Dvok and Menze (2015)). To incorporate 3D contextual information, early
attempts used 2D CNNs on three orthogonal 2D patches (Prasoon et al.
(2013); Roth et al. (2014, 2015); Lyksborg et al. (2015)). In their work for
structural brain segmentation, Brebisson and Montana (2015) extracted large
2D patches from multiple scales of the image and combined them with small
single-scale 3D patches, in order to avoid the memory requirements of fully
3D networks.

One of the reasons that discouraged the use of 3D CNNs is the slow in-
ference due to the computationally expensive 3D convolutions. In contrast
to the 2D/3D hybrid variants (Roth et al. (2014); Brebisson and Montana
(2015)), 3D CNNs can fully exploit dense-inference (LeCun et al. (1998); Ser-
manet et al. (2013)), a technique that greatly decreases inference times and
which we will further discuss in section 2.1. By employing dense-inference
with 3D CNNs, Brosch et al. (2015) and Urban et al. (2014) reported com-
putation times of a few seconds and approximately a minute respectively for
the processing of a single brain scan. Even though the size of their devel-
oped networks was limited, a factor that is directly related to a network’s
representational power, their results on MS and brain tumor segmentation
respectively were very promising.

The segmentation performance of CNNs is signiﬁcantly inﬂuenced by the
strategy for extracting training samples. A commonly adopted approach is
training on image patches that are equally sampled from each class. This,
however, biases the classiﬁer towards rare classes and may result in over-
segmentation. To counter this, Cire¸san et al. (2013) and Havaei et al. (2015)

6

proposed two-stage training schemes, employing uniform sampling in the
second stage to capture the true class distribution. Alternatively, dense-
training (Long et al. (2015)) has been used to train a network on multiple or
all voxels of a single image per optimisation step (Urban et al. (2014); Brosch
et al. (2015); Ronneberger et al. (2015)). This can introduce severe class-
imbalance, similarly to uniform-sampling. Diﬀerent weighted loss functions
have been proposed in the two latter works to alleviate this problem.

1.2. Contributions

We present a fully automatic approach for lesion segmentation in multi-
modal brain MRI based on an 11-layers deep, multi-scale, 3D CNN with the
following main contributions:

1. We propose a novel, eﬃcient hybrid training scheme, utilizing dense
training (Long et al. (2015)) on large image segments, which automat-
ically adapts to class-imbalance of the segmentation problem at hand.
2. We analyze in depth the development of deeper, thus more discrimina-
tive, yet computationally eﬃcient 3D CNNs. We exploit the utilization
of small kernels, a design approach previously found beneﬁcial in 2D
networks (Simonyan and Zisserman (2014)) that impacts 3D CNNs
even more, and present adopted solutions that enable training deeper
networks.

3. We employ parallel convolutional pathways for multi-scale processing, a
solution to eﬃciently incorporate both local and contextual information
which greatly improves segmentation results.

4. We show results that demonstrate that our method outperforms the
state-of-the-art on a variety of highly challenging segmentation tasks,
with top ranking results in two MICCAI competitions, ISLES and
BRATS.

Furthermore, a detailed analysis of the network reveals valuable insights
into the powerful black box of deep learning with CNNs. For example, we
have found that our network is capable of learning very complex, high level
features that separate gray matter (GM), cerebrospinal ﬂuid (CSF) and other
anatomical structures to identify the image regions corresponding to lesions.
Additionally, we have extended the fully-connected Conditional Random
Field (CRF) model by Kr¨ahenb¨uhl and Koltun (2012) to 3D which we use
for ﬁnal post-processing of the CNN’s soft segmentation maps. This CRF

7

overcomes limitations of previous models as it can handle arbitrarily large
neighborhoods while preserving fast inference times. To the best of our
knowledge, this is the ﬁrst application of a fully connected CRF on medical
data.

To facilitate further research and encourage other researchers to build
upon our results, the source code of our lesion segmentation method including
the CNN and the 3D fully connected CRF is made publicly available on
https://biomedia.doc.ic.ac.uk/software/deepmedic/.

1.3. Overview

The rest of the article is organised as follows: In Sec. 2 we ﬁrst describe
the architectural choices we made to alleviate problems arising from the high
computational requirements of 3D CNNs in our goal to build a more powerful
network. We then describe the fully-connected CRF that we employ for
structural reﬁnement of the predicted segmentation. We conducted a series
of experiments to individually quantify the main contributions and examine
the components of our network architecture, which are presented in Sec. 3.
In Sec. 4 we provide a quantitative evaluation of our segmentation system on
datasets of TBI, brain tumour and stroke lesions. Finally, discussion of the
results and insights we acquired during this work follows in Sec. 5.

2. Method

Our proposed lesion segmentation method consists of two main compo-
nents, a 3D CNN that produces highly accurate, soft segmentation maps,
and a fully connected 3D CRF that imposes regularization constraints on
the CNN output and produces the ﬁnal hard segmentation labels. The main
contributions of our work are within the CNN component which we describe
ﬁrst in the following.

2.1. 3D CNNs for Dense Segmentation – Setting the Baseline

CNNs produce estimates for the voxel-wise segmentation labels by clas-
sifying each voxel in an image independently taking the neighborhood, i.e.
local and contextual image information, into account. This is achieved by
sequential convolutions of the input with multiple ﬁlters at the cascaded lay-
ers of the network. Each layer l ∈ [1, L] consists of Cl feature maps (FMs),
also referred to as channels. Every FM is a group of neurons that detects
a particular pattern, i.e. a feature, in the channels of the previous layer.

8

l

l

l

l = f ((cid:80)Cl−1

n=1 km,n

l

(cid:63) yn

l−1 + bm

, ..., km,Cl−1

l

. The images yn

, adding a learned bias bm

The pattern is deﬁned by the kernel weights associated with the FM. If the
neurons of the m-th FM in the l-th layer are arranged in a 3D grid, their
activations constitute the image ym
l ). This is the
result of convolving each of the previous layer’s channels with a 3-dimensional
kernel km,n
l and applying a non-linearity f . Each
kernel is a matrix of learned hidden weights Wm,n
0 , input
to the ﬁrst layer, correspond to the channels of the original input image, for
instance a multi-sequence 3D MRI scan of the brain. The concatenation of
the kernels kl = (km,1
) can be viewed as a 4-dimensional kernel
convolving the concatenated channels yl−1 = (y1
l−1 ), which then in-
tuitively expresses that the neurons of higher layers combine the patterns
extracted in previous layers, which results in the detection of increasingly
more complex patterns. The activations of the neurons in the last layer L
correspond to particular segmentation class labels, hence this layer is also
referred to as the classiﬁcation layer. The neurons are thus grouped in CL
FMs, one for each of the segmentation classes. Their activations are fed
into a position-wise softmax function that produces the predicted posterior
pc(x) = exp(yc
L(x)) for each class c, which form soft seg-
mentation maps with (pseudo-)probabilities. yc
L(x) is the activation of the
c-th classiﬁcation FM at position x ∈ N3. This baseline network is depicted
in Fig. 2.

L(x))/(cid:80)CL

l−1, ..., yCl−1

c=1 exp(yc

Figure 2: Our baseline CNN consists of four layers with 53 kernels for feature
extraction, leading to a receptive ﬁeld of size 173. The classiﬁcation layer is
implemented as convolutional with 13 kernels, which enables eﬃcient dense-
inference. When the network segments an input it predicts multiple voxels
simultaneously, one for each shift of its receptive ﬁeld over the input. Number
of FMs and their size depicted as (Number × Size).

The neighborhood of voxels in the input that inﬂuence the activation of
a neuron is its receptive ﬁeld. Its size increases with each subsequent layer

9

and is given by the 3-dimensional vector:

{x,y,z}
l

{x,y,z}
{x,y,z}
l−1 + (κ
l

− 1)τ

{x,y,z}
l

,

ϕ

= ϕ

(1)
where κl, τl ∈ N3 are vectors expressing the size of the kernels and stride of
the receptive ﬁeld at layer l. τl is given by the product of the strides of kernels
in layers preceding l.
In this work only unary strides are used, as larger
strides downsample the FMs (Springenberg et al. (2014)), which is unwanted
behaviour for accurate segmentation. Thus in our system τl = (1, 1, 1). The
receptive ﬁeld of a neuron in the classiﬁcation layer corresponds to the image
patch that inﬂuences the prediction for its central voxel. This is called the
CNN’s receptive ﬁeld, with ϕCN N = ϕL.

If input of size δin is provided, the dimensions of the FMs in layer l are

given by:

{x,y,z}
δ
l

= (cid:98)(δ

{x,y,z}
in

− ϕ

{x,y,z}
l

{x,y,z}
l

+ 1(cid:99)

)/τ

(2)

In the common patch-wise classiﬁcation setting, an input patch of size
δin = ϕCN N is provided and the network outputs a single prediction for its
central voxel. In this case the classiﬁcation layer consists of FMs with size
13. Networks that are implemented as fully-convolutionals are capable of
dense-inference, which is performed when input of size greater than ϕCN N
is provided (Sermanet et al. (2013)). In this case, the dimensions of FMs in-
crease according to Eq. (2). This includes the classiﬁcation FMs which then
output multiple predictions simultaneously, one for each stride of the CNN’s
receptive ﬁeld on the input (Fig. 2). This strategy signiﬁcantly reduces the
computational costs and memory loads since the otherwise repeated compu-
tations of convolutions on the same voxels in overlapping patches are avoided.
Optimal performance is achieved if the whole image is scanned in one for-
ward pass. If GPU memory constraints do not allow it, such as in the case
of large 3D networks where a large number of FMs need to be cached, the
volume is tiled in multiple image-segments, which are larger than individual
patches, but small enough to ﬁt into memory.

Before analyzing how we exploit the above dense-inference technique for
training, which is the ﬁrst main contribution of our work, we present the
commonly used setting in which CNNs are trained patch-by-patch. Random
patches of size ϕCN N are extracted from the training images. A batch is
formed out of B of these samples, which is then processed by the network for
one training iteration of Stochastic Gradient Descent (SGD). This step aims
to alter the network’s parameters Θ, such as weights and biases, in order

10

to maximize the log likelihood of the data or, equally, minimize the Cross
Entropy via the cost function:

J(Θ; Ii, ci) = − 1
B

B(cid:88)

i=1

log(cid:0)P (Y = ci|Ii, Θ)(cid:1) = − 1

B(cid:88)

i=1

B

log(pci) ,

(3)

where the pair (Ii, ci),∀i ∈ [1, B] is the i-th patch in the batch and the true
label of its central voxel, while the scalar value pci is the predicted poste-
rior for class ci. Regularization terms were omitted for simplicity. Multiple
sequential optimization steps over diﬀerent batches gradually lead to conver-
gence.

2.2. Dense Training on Image Segments and Class Balance

Larger training batch sizes B are preferred as they approximate the overall
data more accurately and lead to better estimation of the true gradient by
SGD. However, the memory requirement and computation time increase with
the batch size. This limitation is especially relevant for 3D CNNs, where only
a few dozens of patches can be processed within reasonable time on modern
GPUs.

the output is a posterior probability for multiple voxels V =(cid:81)

To overcome this problem, we devise a training strategy that exploits the
dense inference technique on image segments. Following from Eq. (2), if an
image segment of size greater than ϕCN N is given as input to our network,
i={x,y,z} δ(i)
L .
If the training batches are formed of B segments extracted from the training
images, the cost function (3) in the case of dense-training becomes:

JD(Θ; Is, cs) = − 1
B · V

log(pcv

s (xv)) ,

(4)

where Is and cs are the s-th segment of the batch and the true labels
of its V predicted voxels respectively. cv
s is the true label of the v-th voxel,
xv the corresponding position in the classiﬁcation FMs and pcv
s the output
of the softmax function. The eﬀective batch size is increased by a factor of
V without a corresponding increase in computational and memory require-
ments, as earlier discussed in Sec. 2.1. Notice that this is a hybrid scheme
between the dense training scheme on a whole image (Long et al. (2015)),
which is not applicable to large 3D CNNs due to memory limitations, and
the commonly used training on individual patches.

11

B(cid:88)

V(cid:88)

s=1

v=1

Figure 3: Consider a network with a 2D receptive ﬁeld of 32 (for illustration)
densely-applied on the depicted lesion-centred image segments of size 72 or
92. Relatively more background (green) is captured by larger segments and
around smaller lesions.

The sampling of input segments provides also a ﬂexible and automatic
way to balance the distribution of training samples from diﬀerent segmen-
tation classes which is an important issue that directly impacts the segmen-
tation accuracy. Speciﬁcally, we build the training batches by extracting
segments from the training images with 50% probability being centred on
a foreground or background voxel, alleviating class-imbalance. Note that
the predicted voxels V in a segment do not have to be of the same class,
something that occurs when a segment is sampled from a region near class
boundaries (Fig. 3). Hence, the sampling rate of the proposed hybrid method
elegantly adapts to the true distribution of the segmentation task’s classes.
Speciﬁcally, the smaller a labelled object, the more background voxels will
be captured within segments centred on the foreground voxel. Implicitly, the
yields a balance between sensitivity and speciﬁcity in the case of binary seg-
mentation tasks. In multi-class problems, the rate at which diﬀerent classes
are captured within a segment centred on foreground reﬂects the real rela-
tive distribution of the foreground classes, while adjusting their frequency
relatively to the background.

2.3. Building Deeper Networks

Deeper networks have greater discriminative power due to the additional
non-linearities and better quality of local optima (Choromanska et al. (2015)).
However, convolutions with 3D kernels are computationally expensive in com-
parison to the 2D variants, which hampers the addition of more layers. Ad-
ditionally, 3D architectures have a larger number of trainable parameters,
with each layer adding ClCl−1
l weights to the model. As men-

i={x,y,z} κ(i)

(cid:81)

12

{x,y,z}
tioned before, Cl is the number of FMs in layer l and κ
the size of its
l
kernel in the respective spatial dimension. Overall this makes the network
increasingly prone to over-ﬁtting.

In order to build a deeper 3D architecture, we adopt the sole use of small
33 kernels that are faster to convolve with and contain less weights. This
design approach was previously found beneﬁcial for classiﬁcation of natural
images (Simonyan and Zisserman (2014)) but its eﬀect is even more drastic
on 3D networks. When compared to common kernel choices of 53 (Zikic et al.
(2014); Urban et al. (2014); Prasoon et al. (2013)) and in our baseline CNN,
the smaller 33 kernels reduce the element-wise multiplications by a factor of
approximately 53/33 ≈ 4.6 while reducing the number of trainable param-
eters by the same factor. Thus deeper network variants that are implicitly
regularised and more eﬃcient can be designed by simply replacing each layer
of common architectures with more layers that use smaller kernels (Fig. 4).

Figure 4: The replacement of the depicted layer with 55 kernels (left) with
two successive layers using 33 kernels (right) introduces an additional non-
linearity without altering the CNN’s receptive ﬁeld. Additionally, the number
of weights is reduced from 200k to 86.4k and the required convolutions are
cheaper (see text). Number of FMs and their size depicted as (Number ×
Size).

(cid:81)

However, deeper networks are more diﬃcult to train. It has been shown
that the forward (neuron activations) and backwards (gradients) propagated
signal may explode or vanish if care is not given to retain its variance
(Glorot and Bengio (2010)). This occurs because at every successive layer
l, the variance of the signal is multiplied by nin
l =
l
Cl−1
is the number of weights through which a neuron of layer
l is connected to its input and var(Wl) is the variance of the layer’s weights.
To better preserve the signal in the initial training stage we adopt a scheme
recently derived for ReLu-based networks by He et al. (2015) and initialize
the kernel weights of our system by sampling from the normal distribution

· var(Wl), where nin

i={x,y,z} κ(i)

l

N (0,(cid:112)2/nin

l ).

13

A phenomenon of similar nature hinders the network’s performance is the
“internal covariate shift” (Ioﬀe and Szegedy (2015)). It occurs throughout
training, because the weight updates to deeper layers result in a continuously
changing distribution of signal at higher layers, which hinders the convergence
of their weights. Speciﬁcally, at training iteration t the weight updates may
cause deviation l,t to the variance of the weights. At the next iteration the
· (var(Wl,t) + l,t). Thus
signal will be ampliﬁed by nin
l
before inﬂuencing the signal, any deviation l,t is ampliﬁed by nin
l which is
exponential in the number of dimensions. For this reason the problem af-
fects training of 3D CNNs more severely than conventional 2D systems. For
countering it, we adopt the recently proposed Batch Normalisation (BN)
technique to all hidden layers (Ioﬀe and Szegedy (2015)), which allows nor-
malization of the FM activations at every optimization step in order to better
preserve the signal.

· var(Wl,t+1) = nin

l

2.4. Multi-Scale Processing via Parallel Convolutional Pathways

The segmentation of each voxel is performed by taking into account the
contextual information that is captured by the receptive ﬁeld of the CNN
when it is centred on the voxel. The spatial context is providing important
information for being able to discriminate voxels that otherwise appear very
similar when considering only local appearance. From Eq. (1) follows that an
increase of the CNN’s receptive ﬁeld requires bigger kernels or more convo-
lutional layers, which increases computation and memory requirements. An
alternative would be the use of pooling (LeCun et al. (1998)), which however
introduces spatial invariance, an undesirable characteristic for segmentation.
In order to incorporate both local and larger contextual information into
our 3D CNN, we add a second pathway that operates on down-sampled
images. Thus, our dual pathway 3D CNN simultaneously processes the input
image at multiple scales (Fig. 5). Higher level features such as the location
within the brain are learned in the second pathway, while the detailed local
appearance of structures is captured in the ﬁrst. As the two pathways are
decoupled in this architecture, arbitrarily large context can be processed
by the second pathway by simply adjusting the down-sampling factor FD.
The size of the pathways can be independently adjusted according to the
computational capacity and the task at hand, which may require relatively
more or less ﬁlters focused on the down-sampled context.

To preserve the capability of dense inference, spatial correspondence of the
activations in the FMs of the last convolutional layers of the two pathways,

14

Figure 5: Multi-scale 3D CNN with two convolutional pathways. The kernels
of the two pathways are here of size 53 (for illustration only to reduce the
number of layers in the ﬁgure). The neurons of the last layers of the two
pathways thus have receptive ﬁelds of size 173 voxels. The inputs of the two
pathways are centered at the same image location, but the second segment
is extracted from a down-sampled version of the image by a factor of 3.
The second pathway processes context in an actual area of size 513 voxels.
DeepMedic, our proposed 11-layers architecture, results by replacing each
layer of the depicted pathways with two that use 33 kernels (see Sec. 2.3).
Number of FMs and their size depicted as (Number × Size).

L1 and L2, should be ensured. In networks where only unary kernel strides
are used, such as the proposed architecture, this requires that for every FD
shifts of the receptive ﬁeld ϕL1 over the normal resolution input, only one
shift is performed by ϕL2 over the down-sampled input. Hence it is required
/FD(cid:101). From
= (cid:100)δ
that the dimensions of the FMs in L2 are δ
Eq. (2), the size of the input to the second pathway is δ
+
= ϕ
− 1 and similar is the relation between δin1 and δL1. These establish
{x,y,z}
δ
L2
the relation between the required dimensions of the input segments from the
two resolutions, which can then be extracted centered on the same image
location. The FMs of L2 are up-sampled to match the dimensions of L1’s
FMs and are then concatenated together. We add two more hidden layers for
combining the multi-scale features before the ﬁnal classiﬁcation, as shown in
Fig. 5. Integration of the multi-scale parallel pathways in architectures with
non-unary strides is discussed in Appendix A.

{x,y,z}
L1
{x,y,z}
in2

{x,y,z}
L2

{x,y,z}
L2

Combining multi-scale features has been found beneﬁcial in other recent
works (Long et al. (2015); Ronneberger et al. (2015)), in which whole 2D im-
ages are processed in the network by applying a few number of convolutions

15

and then down-sampling the FMs for further processing at various scales.
Our decoupled pathways allow arbitrarily large context to be provided while
avoiding the need to load large parts of the 3D volume into memory. Ad-
ditionally, our architecture extracts features completely independently from
the multiple resolutions. This way, the features learned by the ﬁrst pathway
retain ﬁnest details, as they are not involved in processing low resolution
context.

2.5. 3D Fully Connected CRF for Structured Prediction

Because neighboring voxels usually share substantial spatial context, the
soft segmentation label maps produced by the CNN tend to be very smooth,
even though neighborhood dependencies are not modeled directly. However,
local minima during training and noise in the input images can still result
in some spurious outputs, with small isolated regions or holes in the label
map. We employ a fully connected CRF (Kr¨ahenb¨uhl and Koltun (2012)) as
a post-processing step in order to “clean-up” the CNN results and to achieve
more structured predictions. As we describe below, this CRF is capable of
modeling arbitrarily large voxel-neighborhoods but is also computationally
eﬃcient, making it ideal for processing 3D multi-modal medical scans.

For an input image I and the label conﬁguration (segmentation) z, the

Gibbs energy in a CRF model is given by

(cid:88)

i

(cid:88)

ij,i(cid:54)=j

E(z) =

ψu(zi) +

ψp(zi, zj) .

(5)

The unary potential is the negative log-likelihood ψu(zi) = −logP (zi|I),
where in our case P (zi|I) is the output of the CNN for voxel i. In a fully
connected CRF, the pairwise potential is of form ψp(zi, zj) = µ(zi, zj)k(fi, fj)
between any pair of voxels, regardless of their spatial distance. The Pott’s
Model is commonly used as the label compatibility function between two
voxels, giving µ(zi, zj) = [zi (cid:54)= zj]. The corresponding energy penalty is given
by the function k, which is deﬁned over an arbitrary feature space, with fi, fj
being the feature vectors of the pair of voxels. Kr¨ahenb¨uhl and Koltun (2012)
made the important observation that if the penalty function is deﬁned as a
m=1 w(m)k(m)(fi, fj), the
model lends itself for very eﬃcient inference with mean ﬁeld approximation,
after expressing message passing as convolutions with the Gaussian kernels,
in the space of the feature vectors fi, fj.

linear combination of Gaussian kernels, k(fi, fj) =(cid:80)M

16

We extended the work of the original authors and implemented a 3D
version of the CRF for processing multi-modal scans. We make use of two
Gaussian kernels, which operate in the feature space deﬁned by the voxel
coordinates pi,d and the intensities of the c-th modality-channel Ii,c for voxel
i. The smoothness kernel, k(1)(fi, fj) = exp
, is de-
ﬁned by a diagonal covariance matrix with elements the conﬁgurable pa-
rameters σα,d, which express the size of neighborhoods that homogeneous
labels should be encouraged. The appearance kernel k(2)(fi, fj) = exp

(cid:16) −(cid:80)

(cid:16) −

|pi,d−pj,d|2

d={x,y,z}

(cid:17)

2σ2

α,d

−(cid:80)C

(cid:17)

(cid:80)

|pi,d−pj,d|2

|Ii,c−Ij,c|2

β,d

c=1

2σ2

d={x,y,z}

is deﬁned similarly. The additional
parameters σγ,c can be interpreted as how strongly to enforce homogeneous
appearance in the C input channels, when voxels in an area spatially deﬁned
by σβ,d are identically labelled. Finally, the conﬁgurable weights w(1), w(2)
deﬁne the relative strength of the two factors.

2σ2

γ,c

3. Analysis of Network Architecture

In this section we present a series of experiments in order to analyze the
impact of each of the main contributions and to justify the choices made
in the design of the proposed 11-layers, multi-scale 3D CNN architecture,
referred to as the DeepMedic. Starting from the CNN baseline as discussed
in Sec. 2.1, we ﬁrst explore the beneﬁt of our proposed dense training scheme
(cf. Sec. 2.2), then investigate the use of deeper models (cf. Sec. 2.3), and
ﬁnally evaluate the inﬂuence of the multi-scale dual pathway (cf. Sec. 2.4).

3.1. Experimental Setting

The following experiments are conducted using the TBI dataset with 61
multi-channel MRIs which is described in more detail later in Sec. 4.1. Here,
the images are randomly split into a validation and training set, with 15 and
46 images each. The same sets are used in all analyses. To monitor the
progress of segmentation accuracy during training, we extract 10k random
patches at regular intervals, with equal numbers extracted from each of the
validation images. The patches are uniformly sampled from the brain region
in order to approximate the true distribution of lesions and healthy tissue.
Full segmentation of the validation datasets is performed every ﬁve epochs
and the mean Dice similarity coeﬃcient (DSC) is determined. Details on the
conﬁguration of the networks are provided in Appendix B.

17

3.2. Eﬀect of Dense Training on Image Segments

Figure 6: Comparison of the commonly used methods for training on patches
uniformly sampled from the brain region (Puni) and equally sampled from
lesion and background (Peq) against our proposed scheme (S-d) on cubic
segments of side length d, also equally sampled from lesion and background.
We varied d to observe its eﬀect. From left to right: percentage of training
samples extracted from the lesion class, mean accuracy, sensitivity, speciﬁcity
calculated on uniformly sampled validation patches and, ﬁnally, the mean
DSC of the segmentation of the validation datasets. The progress throughout
training is plotted.

We compare our proposed dense training method with two other com-
monly used training schemes on the 5-layers baseline CNN (see Fig. 2). The
ﬁrst common scheme trains on 173 patches extracted uniformly from the
brain region, and the second scheme samples patches equally from the lesion
and background class. We refer to these schemes as Puni and Peq. The re-
sults shown in Fig. 6 show a correlation of sensitivity and speciﬁcity with
the percentage of training samples that come from the lesion class. Peq per-
forms poorly because of over-segmentation (high sensitivity, low speciﬁcity).
Puni has better classiﬁcation on the background class (high speciﬁcity), which
leads to high mean accuracy on the validation samples since the majority is
background, but not particularly high DSC scores due to under-segmentation
(low sensitivity).

To evaluate our dense training scheme, we trained multiple models with
varying sized image segments, equally sampled from lesions and background.
The tested sizes of the segments go from 193 upwards to 293. The models are
referred to as “S-d”, where d is the side length of the cubic segments. For
fair comparison, the batch sizes in all the experiments were adjusted to have
a similar memory footprint and lead to similar training times as compared

18

Figure 7: Mean accuracy over validation samples and DSC for the segmen-
tations of the validation images, as obtained from the shallower and deeper
network variants. Training of the plain “Deep” variant fails due to the sig-
nal vanishing at the initial stage of training (cf. Sec. 3.3). Deep+ performs
signiﬁcantly better than Shallow+ with similar computation time, thanks to
the use of small kernels in its design.

2. We observe a signiﬁcant performance increase
to training on Puni and Peq
for model S-19 over Peq. We account this partly to the eﬃcient increase of
the eﬀective batch size (B · V in Eq. (4)), but also to the altered distribution
of training samples. As we increase the size of the training segments further,
we quickly reach a balance between the sensitivity of Peq and the speciﬁcity
of Puni, which results in very much improved segmentation as expressed by
the DSC.

The segment size is a hyper-parameter in our model. We observe that
the increase in performance with increasing segment size quickly levels oﬀ,
and similar performance is obtained for a wide range of segment sizes, which
allows for easy conﬁguration. For the remaining experiments, all models were
trained on segments of size 253.

3.3. Eﬀect of Deeper Networks

The 5-layers baseline CNN, here referred to as the “Shallow” model, is
extended to 9-layers by replacing each convolutional layer that uses 53 ker-
nels with two layers that use 33 kernels. This model is referred to as “Deep”.

2Note that dense training on a whole image was impossible to apply on this 3D CNN
due to memory limitations, but was previously shown to give similar results as training
on uniformly sampled patches (Long et al. (2015)).

19

Figure 8: Mean accuracy over validation samples and DSC for the seg-
mentation of the validation images, as obtained by a single-scale model
(Deep+) and our dual pathway architecture (DeepMedic). We also trained
a single-scale model with larger capacity (BigDeep+), similar to the capac-
ity of DeepMedic. DeepMedic yields best performance by capturing greater
context, while BigDeep+ seems to suﬀer from over-ﬁtting.

Training the latter, however, utterly fails with the model making only predic-
tions corresponding to the background class. This problem is related to the
challenge of preserving the signal as it propagates through deep networks and
its variance gets multiplied with the variance of the weights, as previously
discussed in Sec. 2.3. One of the causes is that the weights of both models
have been initialized with the commonly used scheme of sampling from the
normal distribution N (0, 0.01) (cf. Krizhevsky et al. (2012)). In comparison,
the initialization scheme by He et al. (2015), derived for preserving the signal
in the initial stage of training, results in higher values and overcomes this
problem. Further preservation of the signal can be obtained by employing
Batch Normalization. This results in an enhanced 9-layers model which we
refer to as “Deep+”, and using the same enhancements on the Shallow model
yields “Shallow+”. The signiﬁcant performance improvement of Deep+ over
Shallow+, as shown in Fig. 7, is the result of the greater representational
power of the deeper network. The two models need similar computational
times, which highlights the beneﬁts of utilizing small kernels in the design
of 3D CNNs. Although the deeper model requires more sequential (layer by
layer) computations on the GPU, those are faster due to the smaller kernel
size.

20

3.4. Eﬀect of the Multi-Scale Dual Pathway

The ﬁnal version of the proposed network architecture, referred to as
“DeepMedic”, is built by extending the Deep+ model with a second convo-
lutional pathway that is identical to the ﬁrst one (cf. Fig. 5). Two hidden
layers are added for combining the multi-scale features before the classiﬁca-
tion layer, resulting in a deep network of 11-layers. The input segments to
the second pathway are extracted from the images down-sampled by a factor
of three. Thus, the network is capable of capturing context in a 513 area
of the original image through the 173 receptive ﬁeld of the lower-resolution
pathway, while only doubling the computational and memory requirements
over the single pathway CNN. In comparison, the most recent 2D CNN sys-
tems proposed for lesion segmentation (Havaei et al. (2015); Pereira et al.
(2015)) have a receptive ﬁeld limited to 332 voxels.

Figure 8 shows the improvement achieved with DeepMedic over the single
pathway model Deep+. In Fig. 9 we show two representative visual examples
of this improvement when using the multi-scale CNN. Finally, to conﬁrm that
the performance increase can be accounted to the additional context and not
the additional capacity of the network, we built a single-scale model with
twice as many FMs as Deep+ and two additional hidden layers, referred to
as “BigDeep+”. This model did not improve the performance, while showing
signs of over-ﬁtting.

4. Evaluation on Clinical Data

The proposed system consisting of the DeepMedic CNN architecture, op-
tionally coupled with a fully connected CRF, is evaluated on three diﬀerent
lesion segmentation tasks including challenging clinical data from patients
with traumatic brain injuries, brain tumors, and ischemic stroke. Quantita-
tive evaluation and comparisons with state-of-the-art are reported for each
of the tasks.

4.1. Traumatic Brain Injuries
4.1.1. Material and Pre-Processing

Sixty-six patients with moderate-to-severe TBI who required admission
to the Neurosciences Critical Care Unit at Addenbrooke’s Hospital, Cam-
bridge, UK, underwent imaging using a 3-Tesla Siemens Magnetom TIM Trio
within the ﬁrst week of injury. Ethical approval was obtained from the Local

21

Figure 9: (Rows) Two cases from the severe TBI dataset, showing represen-
tative improvements when using the multi-scale CNN approach. (Columns)
From left to right: the MRI FLAIR sequence with the manually labeled le-
sions, predicted soft segmentation map obtained from a single-scale model
(Deep+) and the prediction of the multi-scale DeepMedic model. The incor-
poration of greater context enables DeepMedic to identify when it processes
an area within larger lesions (top). Spurious false positives are signiﬁcantly
reduced across the image on the bottom.

Research Ethics Committee (LREC 97/290) and written assent via consul-
tee agreement was obtained for all patients. The structural MRI sequences
that are used in this work are isotropic MPRAGE (1mm×1mm×1mm),
axial FLAIR, T2 and Proton Density (PD) (0.7mm×0.7mm×5mm), and
Gradient-Echo (GE) (0.86mm×0.86mm×5mm). All visible lesions were
manually annotated on the FLAIR and GE sequences with separate label-
ing for each lesion type. In nine patients the presence of hyperintense white
matter lesions that were felt to be chronic in nature were also annotated.

22

Artifacts, for example, signal loss secondary to intraparenchymal pressure
probes, were also noted. For the purpose of this study we focus on binary
segmentation of all abnormalities within the brain tissue. Thus, we merged all
classes that correspond to intra-cerebral abnormalities into a single “lesion”
label. Extra-cerebral pathologies such as epidural and subdural hematoma
were treated as background. We excluded two datasets because of corrupted
FLAIR images, two cases because no lesions were found and one case be-
cause of a major scanning artifact corrupting the images. This results in a
total of 61 cases used for quantitative evaluation. Brain masks were obtained
using the ROBEX tool (Iglesias et al. (2011)). All images were resampled
to an isotropic 1mm3 resolution, with dimensions 193×229×193 and aﬃnely
registered (Studholme et al. (1999)) to MNI space using the atlas by Grabner
et al. (2006). No bias ﬁeld correction was used as preliminary results showed
that this can negatively aﬀect lesion appearance. Image intensities were nor-
malized to have zero-mean and unit variance, as it has been reported that
this improves CNN results (Jarrett et al. (2009)).

4.1.2. Experimental Setting

Network conﬁguration and training: The network architecture cor-
responds to the one described in Sec. 3.4, i.e. a dual-pathway, 11-layers
deep CNN. The training data is augmented by adding images reﬂected along
the sagittal axis. To make the network invariant to absolute intensities we
also shift the intensities of each MR channel c of every training segment by
ic = rcσc. rc is sampled for every segment from N (0, 0.1) and σc is the
standard deviation of intensities under the brain mask in the corresponding
image. The network is regularized using dropout (Hinton et al. (2012)) with a
rate of 2% on all convolutional layers, which is in addition to a 50% rate used
on the last two layers. The network is evaluated with 5-fold cross-validation
on the 61 subjects. Each training session requires approximately two days
on an NVIDIA GTX Titan X GPU.

CRF conﬁguration: The parameters of the fully connected CRF are
determined in a conﬁguration experiment using random-search and 15 ran-
domly selected subjects from the TBI database with predictions from a pre-
liminary CNN model. The 15 subjects are reshuﬄed into the 5-folds used for
subsequent evaluation.

Random Forest baseline: For comparison, we employ a context-sensitive

Random Forest, similar to the model presented by Zikic et al. (2012) for brain
tumors except that we apply the forest to the MR images without additional

23

tissue speciﬁc priors. We train a forest with 50 trees and maximum depth of
30. Training data points are approximately equally sampled from lesion and
background classes. Two hundred randomized cross-channel box features are
evaluated at each split node with maximum oﬀsets and box sizes of 20mm.
The same folds of training and test sets are used as for our CNN approach.

4.1.3. Results

Table 1: Performance of DeepMedic and an ensemble of three networks on
the TBI database. For comparison, we provide results for a Random Forest
baseline. Values correspond to the mean (and standard deviation). Num-
bers in bold indicate signiﬁcant improvement by the CRF post-processing,
according to a two-sided, paired t-test on the DSC metric (*p < 5 · 10−2,
**p < 10−4).

DSC

Precision

Sensitivity ASSD

Haussdorf

Random Forest
DeepMedic
DeepMedic+CRF
Ensemble
Ensemble+CRF

51.1(20.0)
62.3(16.4)
63.0(16.3)**
64.2(16.2)
64.5(16.3)*

50.1(24.4)
65.3(18.8)
67.7(18.2)
67.7(18.3)
69.8(17.8)

60.1(15.8)
64.4(16.3)
63.2(16.7)
65.3(16.3)
63.9(16.7)

8.29(6.76)
4.24(2.64)
4.02(2.54)
3.88(2.33)
3.72(2.29)

64.17(15.98)
56.50(15.88)
55.68(15.93)
54.38(15.45)
52.38(16.03)

Table 1 summarizes the results on TBI. Our CNN signiﬁcantly outper-
forms the Random Forest baseline, while the relatively overall low DSC values
indicate the diﬃculty of the task. Due to randomness during training the
local minima where a network converges are diﬀerent between training ses-
sions and some errors they produce diﬀer (Choromanska et al. (2015)). To
clear the unbiased errors of the network we form an ensemble of three similar
networks, aggregating their output by averaging. This ensemble yields bet-
ter performance in all metrics but also allows us to investigate the behaviour
of our network focusing only on the biased errors. Fig. 10 shows the DSC
obtained by the ensemble on each subject in relation to the manually seg-
mented and predicted lesion volume. The network is capable of segmenting
cases with very small lesions, although, performance is less robust in these
cases as even small errors have large inﬂuence on the DSC metric. Inves-
tigation of the predicted lesion volume, which is an important biomarker
for prognostication, shows that the network is neither biased towards the
lesion nor background class, with promising results even on cases with very
small lesions. Furthermore, we separately evaluate the inﬂuence of the post-
processing with the fully connected CRF. As shown in Table 1, the CRF

24

yields improvements for both the single network and the ensemble. Fig. 11
shows three representative cases.

Figure 10: (Top) DSC achieved by our ensemble of three networks on each of
the 61 TBI datasets. (Bottom) Manually segmented (black) and predicted
lesion volumes (red). Note here the logarithmic scale. Continuous lines
represent mean values. The outlying subject 12 presents small TBI lesions,
which are successfully segmented, but also vascular ischemia. Because it is
the only case in the database with the latter pathology, the networks fail to
segment it as such lesion was not seen during training.

4.2. Brain Tumor Segmentation
4.2.1. Material and Pre-Processing

For brain tumors, we evaluate our system on the data from the 2015
Brain Tumor Segmentation Challenge (BRATS) (Menze et al. (2015)). The
training set consists of 220 cases with high grade (HG) and 54 cases with
low grade (LG) glioma for which corresponding reference segmentations are
provided. The segmentations include the following tumor tissue classes: 1)
necrotic core, 2) edema, 3) non-enhancing and 4) enhancing core. The test
set consists of 110 cases of both HG and LG, but the grade is not revealed.
Reference segmentations for the test set are hidden and evaluation is carried
out via an online system. For evaluation, the four predicted labels are merged
into diﬀerent sets of whole tumor (all four classes), the core (classes 1,3,4),

25

Figure 11: Three examples from the application of our system on the TBI
database. It is capable of precise segmentation of both small and large lesions.
Second row depicts one of the common mistakes observed. A contusion near
the edge of the brain is under-segmented, possibly mistaken for background.
Bottom row shows one of the worst cases, representative of the challenges
in segmenting TBI. Post-surgical sub-dural debris is mistakenly captured by
the brain mask. The network partly segments the abnormality, which is not
a celebral lesion of interest.

and the enhancing tumor (class 4)3. For each subject, four MRI sequences are

3For interpretation of the results note that, to the best of our knowledge, cases where
the “enhancing tumor” class is not present in the manual segmentation are considered as
zeros for the calculation of average performance by the evaluation platform, lowering the
upper bound for this class.

26

available, FLAIR, T1, T1-contrast and T2. The datasets are pre-processed by
the organizers and provided as skull-stripped, registered to a common space
and resampled to isotropic 1mm3 resolution. Dimensions of each volume
are 240×240×155. We add minimal pre-processing of normalizing the brain-
tissue intensities of each sequence to have zero-mean and unit variance.

4.2.2. Experimental Setting

Network conﬁguration and training: We modify the DeepMedic ar-
chitecture to handle multi-class problems by extending the classiﬁcation layer
to ﬁve feature maps (four tumor classes plus background). The rest of the
conﬁguration remains unchanged. We enrich the dataset with sagittal re-
ﬂections. Opposite to the experiments on TBI, we do not employ the inten-
sity perturbation and dropout on convolutional layers, because the network
should not require as much regularisation thanks to the large size of the tumor
database. The network is trained on image segments extracted with equal
probability centred on the whole tumor and healthy tissue. The distribution
of the classes captured by our training scheme is provided in Appendix C.
In order to examine the behaviour of our network, we ﬁrst evaluated it on
the training data of the challenge. For this, we run a 5-fold cross validation
where each fold contains both HG and LG images. We then retrain the
network using all training images, before applying it on the test data. Each
training session lasts for approximately two days.

CRF conﬁguration: For the multi-class problem it is challenging to
ﬁnd a global set of parameters for the CRF which can consistently improve
the segmentation of all classes. So instead we merge the four predicted prob-
ability maps into a single “whole tumor” map for CRF post-processing. The
CRF then only reﬁnes the boundaries between tumor and background and
additionally removes isolated false positives. Similarly to the experiments on
TBI, the CRF is conﬁgured on a random subset of 44 HG and 18 LG training
images, which are then reshuﬄed into the subsequent 5-fold cross validation.

4.2.3. Results

Quantitative results from the application of the DeepMedic, the CRF and
an ensemble of three similar networks on the training data are presented in
Table 2. The latter two oﬀer an improvement, albeit fairly small since the
performance of DeepMedic is already rather high in this task. Also shown are
results from previous works, as reported on the online evaluation platform.
Various settings may vary among submissions, such as the pre-processing

27

Table 2: Average performance of our system on the training data of BRATS
2015 as computed on the online evaluation platform, and comparison to
other submissions visible at the time of manuscript submission. Presenting
only teams that submitted more than half of the 274 cases. Numbers in
bold indicate signiﬁcant improvement by the CRF, according to a two-sided,
paired t-test on the DSC metric (*p < 5 · 10−2, **p < 10−3).

DSC

Precision

Sensitivity

Whole

Core

Enh. Whole Core

Enh. Whole Core

Enh.

Cases

Ensemble+CRF
Ensemble
DeepMedic+CRF
DeepMedic
bakas1
peres1
anon1
thirs1
peyrj

90.1*
90.0
89.8**
89.7
88
87
84
80
80

75.4
75.5
75.0
75.0
77
73
67
66
60

72.8*
72.8
72.1*
72.0
68
68
55
58
57

91.9
90.3
91.5
89.7
90
89
90
84
87

85.7
85.5
84.4
84.2
84
74
76
71
79

75.5
75.4
75.9
75.6
68
72
59
53
59

89.1
90.4
89.1
90.5
89
86
82
79
77

71.7
71.9
72.1
72.3
76
77
68
66
53

74.4
74.3
72 .5
72.5
75
70
61
74
60

274
274
274
274
186
274
274
267
274

pipeline or the number of folds used for cross-validation. Still it appears
that our system performs favourably compared to previous state-of-the-art,
including the semi-automatic system of Bakas et al. (2015) (bakas1) who won
the latest challenge and the method of Pereira et al. (2015) (peres1), which
is based on grade-speciﬁc 2D CNNs and requires identiﬁcation of the grade
by the user. Visual segmentation examples obtained with our method are
shown in Fig. 12. DeepMedic behaves very well in preserving the hierarchical
structure of the tumor, which we account to the large context processed by
our multi-scale network.

Table 3 shows the results of our method on the BRATS test data. Re-
sults of other submissions are not accessible. The decrease in performance
is possibly due to the the inclusion of test images that vary signiﬁcantly
from the training data, such as cases acquired in clinical centers that did
not provide any of the training images, something that was conﬁrmed by
the organisers. Important to note is that the beneﬁt of removing the false
positive predictions with the CRF is much greater in this case.

28

Table 3: Average performance of our system on the 110 test cases of BRATS
2015, as computed on the online evaluation platform. Numbers in bold indi-
cate signiﬁcant improvement by the CRF, according to a two-sided, paired
t-test on the DSC metric (*p < 5 · 10−2, **p < 10−3). The decrease of the
mean DSC by the CRF and the ensemble for the “Core” class was not found
signiﬁcant.

DSC

Precision

Sensitivity

Whole

Core

Enh. Whole Core

Enh. Whole Core

Enh.

DeepMedic
DeepMedic+CRF
Ensemble
Ensemble+CRF

83.6
84.7**
84.5
84.9**

67.4
67.0
66.7
66.7

62.9
62.9
63.3
63.4*

82.3
85.0
83.3
85.3

84.6
84.8
86.1
86.1

64.0
63.4
63.2
63.4

88.5
87.6
88.9
87.7

61.6
60.7
59.9
60.0

65.6
66.2
67.3
67.4

4.3. Ischemic Stroke Lesion Segmentation
4.3.1. Material and Pre-Processing

We participated in the 2015 Ischemic Stroke Lesion Segmentation (ISLES)
challenge4, where our system achieved the best results among all participants
on sub-acute ischemic stroke lesions. In the training phase of the challenge, 28
datasets have been made available, along with manual segmentations. Each
dataset included T1, T1-contrast, FLAIR and DWI sequences. All images
were provided as skull-stripped and resampled to isotropic 1mm3 voxel reso-
lution. Each volume is of size 230×230×154. In the testing stage, teams were
provided with 36 datasets for evaluation. The test data were acquired in two
clinical centers, with one of them being the same that provided all training
images. Corresponding expert segmentations were hidden and results had
to be submitted to an online evaluation platform. Similar to BRATS, the
only pre-processing that we applied is the normalization of each image to the
zero-mean and unit variance.

4.3.2. Experimental Setting

Network Conﬁguration and Training: The conﬁguration of the net-
work employed is described in Kamnitsas et al. (2015). The main diﬀerence
with the conﬁguration used for TBI and tumors as employed above is the
relatively smaller number of FMs in the low-resolution pathway. This choice

4link:www.isles-challenge.org

29

Figure 12: Examples of DeepMedic’s segmentation from its evaluation on
the training datasets of BRATS 2015. cyan: necrotic core, green: oedema,
orange: non-enhancing core, red: enhancing core.
(top and middle) Sat-
isfying segmentation of the tumor, regardless motion artefacts in certain
sequences. (bottom) One of the worst cases of over-segmentation observed.
False segmentation of FLAIR hyper-intensities as oedema constitutes the
most common error of DeepMedic.

should not signiﬁcantly inﬂuence accuracy on the generally small SISS lesions
but it allowed us to lower the computational cost.

Similar to the other experiments, we evaluate our network with a 5-fold
cross validation on the training datasets. We use data augmentation with
sagittal reﬂections. For the testing phase of the challenge, we trained an en-
semble of three networks on all training cases and aggregate their predictions
by averaging.

30

CRF conﬁguration: The parameters of the CRF were conﬁgured via a

random search on the whole training dataset.

4.3.3. Results

The performance of our system on the training data is shown in Table 4.
Signiﬁcant improvement is achieved by the structural regularisation oﬀered
by the CRF, although it could be partially accounted for by overﬁtting the
training data during the CRF’s conﬁguration. Examples for visual inspection
are shown in Fig. 13.

Table 4: Performance of our system on the training data of the ISLES-SISS
2015 competition. Values correspond to the mean (and standard deviation).
Numbers in bold indicate signiﬁcant improvement by the CRF, according to
a two-sided, paired t-test on the DSC metric (p < 10−2).

DSC

Precision

Sensitivity ASSD

Haussdorf

DeepMedic
DeepMedic+CRF

64(23)
66(24)

68(24)
77(24)

65(23)
63(25)

6.99(9.91)
5.00(10.33 )

73.32(26.03)
55.93(28.55)

Table 5: Our ensemble of three networks, coupled with the fully connected
CRF obtained overall best performance among all participants in the testing
stage of the ISLES-SISS 2015 challenge. Shown is the performance of our
pipeline along with the second and third entries. Values correspond to the
mean (and standard deviation).

DSC

Precision

Sensitivity ASSD

Haussdorf

kamnk1(ours)
fengc1
halmh1

59(31)
55(30)
47(32)

68(33)
64(31)
47(34)

60(27)
57(33)
56(33)

7.87(12.63)
8.13(15.15)
14.61(20.17)

39.61(30.68)
25.02(22.02)
46.26(34.81)

For the testing phase of the challenge we formed an ensemble of three net-
works, coupled with the fully connected CRF. Our submission ranked ﬁrst,
indicating superior performance on this challenging task among 14 submis-
sions. Table 5 shows our results, along with the other two top entries (Feng
et al. (2015); Halme et al. (2015)). It is important to note the decrease of per-
formance in comparison to the training set. All methods performed worse
on the data coming from the second clinical center, including the method
of Feng et al. (2015) that is not machine-learning based. This highlights a
general diﬃculty with current approaches when applied on multi-center data.

31

Figure 13: Examples of segmentations performed by our system on the train-
ing datasets of (SISS) ISLES 2015. (top and middle) The system is capable of
satisfying segmentation of both large and smaller lesions. (bottom) Common
mistakes are performed due to the challenge of diﬀerentiating stroke lesions
from White Matter lesions.

4.4. Implementation Details

Our CNN is implemented using the Theano library (Bastien et al. (2012)).
The eﬃcient architecture of DeepMedic allows models to be trained on GPUs
with only 3GB of memory. Note that the dimensions of the volumes in the
processed databases do not allow dense training on whole volumes. Because
inference requires only a forward-pass and thus less memory, dense inference
on a whole volume is still possible in less than one minute, but requires 12GB
NVIDIA GTX Titan X GPU. Tiling the volume into multiple segments of
size 353 allows inference on 3GB GPUs in less than three minutes.

32

Our 3D fully connected CRF is implemented by extending the original
source code by Kr¨ahenb¨uhl and Koltun (2012). A CPU implementation is
fast, capable of processing a ﬁve-channel brain scan in under three minutes.
Further speed-up could be achieved with a GPU implementation, but was
not found necessary in the scope of this work.

5. Discussion and Conclusion

We have presented DeepMedic, a 3D CNN architecture for automatic le-
sion segmentation that surpasses state-of-the-art on challenging data. The
proposed novel training scheme is not only computationally eﬃcient but also
oﬀers an adaptive way of alleviating the inherent class-imbalance of seg-
mentation problems. We analyzed the beneﬁts of using small convolutional
kernels in 3D CNNs, which allowed us to develop a deeper and thus more
discriminative network, without increasing the computational cost and num-
ber of trainable parameters to avoid overﬁtting. We discussed the challenges
of training deep neural networks and the adopted solutions from the latest
advances in deep learning. Furthermore, we proposed an eﬃcient solution for
processing large image context by the use of parallel convolutional pathways
for multi-scale processing, alleviating one of the main computational limita-
tions of previous 3D CNNs. Finally, we presented the ﬁrst application of a
3D fully connected CRF on medical data, employed as a post-processing step
to reﬁne the network’s output, a method that has also been shown promising
for processing 2D natural images (Chen et al. (2014)). The design of the
proposed system is well suited for processing medical volumes thanks to its
generic 3D nature. The capabilities of DeepMedic and the employed CRF
for capturing 3D patterns exceed those of 2D networks and locally connected
random ﬁelds, models that have been commonly used in previous work. At
the same time, our system is very eﬃcient at inference time, which allows its
adoption in a variety of research and clinical settings.

The generic nature of our system allows its straightforward application
for diﬀerent lesion segmentation tasks without major adaptations. To the
best of our knowledge, our system achieves the highest reported accuracy
when applied on a cohort of patients with severe TBI. As a comparison, we
improved over the reported performance of the pipeline presented in Rao et al.
(2014). Important to note is that their work focused only on segmentation
of contusions, while our system has been shown capable of segmenting even
small and diﬀused pathologies. Additionally, our pipeline achieves state-of-

33

the-art performance on both public benchmarks of brain tumors (BRATS
2015) and stroke lesions (SISS ISLES 2015). We believe performance can
be further improved with task- and data-speciﬁc adjustments, for instance
in the pre-processing, but our results show the potential of this generically
designed segmentation system.

When applying our pipeline to new tasks, for example non-brain applica-
tions, the part that needs most attention is the reconﬁguration of the CRF.
The model improved our system’s performance with statistical signiﬁcance in
all investigated tasks, proving its ﬂexibility and potential. Finding optimal
parameters for each task, however, can be challenging in certain applica-
tions. This problem became most obvious on the task of multi-class tumor
segmentation. Because the substructures of the tumor vary signiﬁcantly in
appearance, we encountered diﬃculties in ﬁnding a global set of parameters
for the reﬁnement that yields improvements on all classes. Instead, we ap-
plied the CRF in a binary fashion, reﬁning only the boundaries of the whole
tumor while suppressing spurious false positives. This CRF model can be
conﬁgured with a separate set of parameters for each class. However the
increased size of the parameter space would make its conﬁguration partic-
ularly challenging. Recent work from Zheng et al. (2015) showed that this
particular CRF can be casted as a neural network and its parameters can be
learned with regular gradient descent. Training it in an end-to-end fashion
on top of a neural network would alleviate the discussed problems, and this
will be explored as part of future work.

The discriminative power of the learned features is indicated by the suc-
cess of recent CNN-based systems in matching human performance in do-
mains where it was previously considered too ambitious (He et al. (2015);
Silver et al. (2016)). Analysis of the automatically extracted information
could potentially provide novel insights and facilitate research on patholo-
gies for which little prior knowledge is currently available.
In an attempt
to illustrate this within DeepMedic on the lesion segmentation tasks, we ex-
plored what patterns have been learned automatically. For this, we visualize
the activations of DeepMedic’s FMs when processing a subject from our TBI
database. Many of the appearing patterns are diﬃcult to interpret, espe-
cially in deeper layers. However, in Fig. 14 we provide some examples that
seem to have an intuitive explanation. One of the most interesting ﬁndings
is that the network learns to identify the ventricles, CSF, white and gray
matter. This reveals that the diﬀerentiation of the tissue type is beneﬁcial
for lesion segmentation. This is in line with ﬁndings in the literature, where

34

Figure 14: (First row) GE scan and DeepMedic’s segmentation. (Second row)
FMs of earlier and (third row) deeper layers of the ﬁrst convolutional path-
way. (Fourth row) Features learnt in the low-resolution pathway. (Last row)
FMs of the two last hidden layers, which combine multi-resolution features
towards the ﬁnal segmentation.

35

the segmentation performance of traditional classiﬁers was signiﬁcantly im-
proved by incorporation of tissue priors (Van Leemput et al. (1999); Zikic
et al. (2012)).
It is intuitive that diﬀerent types of lesions aﬀect diﬀerent
parts of the brain depending on the underlying mechanisms of the pathol-
ogy. A rigorous analysis of spatial cues extracted by the network may reveal
correlations that are not well deﬁned yet.

Similarly intriguing is the information extracted by the neurons of the
low-resolution pathway. As they process greater image context, these neu-
rons gain additional localization capabilities. The activations of certain FMs
form ﬁelds in the surrounding areas of the brain, patterns which are pre-
served in the deepest hidden layers, which indicates that these are beneﬁcial
for the ﬁnal segmentation (see two last rows of Fig. 14). We believe that
such cues can be useful for providing a spatial bias to the system, for in-
stance that large TBI contusions tend to occur towards the front and sides of
the brain (see Fig. 1c). Furthermore, the interaction of the multi-resolution
features can be observed in FMs of the hidden layer that follows the concate-
nation of the pathways. The network learns to weight the output of the two
pathways, preserving low resolution in certain parts and show ﬁne details
in others (bottom row of Fig. 14, ﬁrst three FMs). Our assumption is that
the low-resolution pathway provides a rough localization of large patholo-
gies and brain areas that are challenging to segment, which reserves the rest
of the network’s capacity for learning detailed patterns associated with the
detection of smaller lesions, ﬁne structures, and complex, ambiguous areas.
The ﬁndings of the above exploration lead us to believe that great po-
tential lies into fusing the discriminative power of the “deep black box” with
the knowledge acquired over years of targeted biomedical research. Clinical
knowledge is available for certain pathologies, such as spatial priors for white
matter lesions. Previously engineered models have been proven eﬀective in
tackling fundamental imaging problems, such as brain extraction, tissue seg-
mentation and bias ﬁeld correction. We show that a network is capable of
automatically extracting some of this information. It would be interesting,
however, to investigate structured ways for incorporating such existing infor-
mation as priors into the network’s feature space, which should simplify the
optimization problem while letting a specialist guide the network towards an
optimal solution.

Although neural networks seem promising for medical image analysis,
better ways for making the inference process interpretable are required, which
would also allow us to better understand when the network fails, an important

36

aspect in biomedical applications. Although the output is bounded in the
[0, 1] range and commonly referred to as probability for convenience, it is
not a true probability in a Bayesian sense, but rather a value automatically
calibrated to maximize the cross entropy over the training samples. Research
towards Bayesian networks aims to alleviate this limitation. An example
is the recent work of Gal and Ghahramani (2015) who show that model
conﬁdence can be estimated via sampling the dropout mask.

A general point should be made about the performance drop observed
when our system is applied on test datasets of BRATS and ISLES in com-
parison to its cross-validated performance on the training data.
In both
cases, subsets of the test images were acquired in clinical centers diﬀerent
from the ones of training datasets. Diﬀerences in scanner type and acquisi-
tion protocols have signiﬁcant impact on the appearance of the images. The
issue of multi-center data heterogeneity is considered a major bottleneck for
enabling large-scale imaging studies. This is not speciﬁc to our approach, but
a general problem in medical image analysis. One possible way of alleviating
this problem is to learn a generative model for the data acquisition process,
and use this model in the data augmentation step. That way, the CNN could
be made invariant to the data heterogeneity. This is a direction we explore
as part of future work.

In order to facilitate further research in this area and to provide a baseline
for future evaluations, we make the source code of the entire system publicly
available.

Acknowledgements

This work is partially funded under the 7th Framework Programme by
the European Commission (TBIcare: http://www.tbicare.eu/; CENTER-
TBI: https://www.center-tbi.eu/). This work was further supported by a
Medical Research Council (UK) Program Grant (Acute brain injury: hetero-
geneity of mechanisms, therapeutic targets and outcome eﬀects [G9439390
ID 65883]), the UK National Institute of Health Research Biomedical Re-
search Centre at Cambridge and Technology Platform funding provided by
the UK Department of Health. KK is supported by the Imperial College
London PhD Scholarship Programme. VFJN is supported by a Health Foun-
dation/Academy of Medical Sciences Clinician Scientist Fellowship. DKM is
supported by an NIHR Senior Investigator Award. We gratefully acknowl-
edge the support of NVIDIA Corporation with the donation of two Titan X

37

GPUs for our research.

Appendix A. Additional Details on Multi-Scale Processing

The integration of multi-scale parallel pathways in architectures that use
solely unary kernel strides, such as the proposed, was described in Sec. 2.4.
The required up-sampling of the low-resolution features was performed with
simple repetition in our experiments. This was found suﬃcient, with the
following hidden layers learning to combine the multi-scale features. In the
case of architectures with strides greater than unary, the last convolutional
layers of the two pathways, L1 and L2, have receptive ﬁelds ϕL1 and ϕL2
with strides τL1 and τL2 respectively. To preserve spatial correspondence
of the multi-scale features and enable the network for dense inference, the
dimensions of the input segments should be chosen such that the FMs in L2
can be brought to the dimensions of the FMs in L1 after sequential resampling
by ↑ τL2, ↑ FD, ↓ τL1 or equivalent combinations. Here ↑ and ↓ represent up-
and down-sampling by the given factor. Because they are more reliant on
these operations, utilization of more elaborate, learnt upsampling schemes
(Long et al. (2015); Ronneberger et al. (2015); Noh et al. (2015)) should be
beneﬁcial in such networks.

Appendix B. Additional Details on Conﬁguration of the Networks

The main description of our system is presented in Sec. 2. All models in
this work use the PReLu non-linearity (He et al. (2015)). They are trained
using the RMSProp optimizer (Tieleman and Hinton (2012)) and Nesterov
momentum (Sutskever et al. (2013)) with value m = 0.6. L1 = 10−6 and
L2 = 10−4 regularisation is applied. We train the networks with dense-
training on batches of 10 segments, each of size 253. Exceptions are the
experiments in Sec 3.2, where the batch sizes were adjusted along with the
segment sizes, to achieve similar memory footprint and training time per
batch. The weights of our shallow, 5-layers networks are initialized by sam-
pling from a normal distribution N (0, 0.01) and their initial learning rate is
set to a = 10−4. Deeper models (and the “Shallow+” model in Sec 3.3) use
the weight initialisation scheme of He et al. (2015). The scheme increases
the signal’s variance in our settings, which leads to RMSProm decreasing the
eﬀective learning rate. To counter this, we accompany it with an increased
initial learning rate a = 10−3. Throughout training, the learning rate of all

38

models is halved whenever convergence plateaus. Dropout with 50% rate is
employed on the two last hidden layers of 11-layers deep models.

Appendix C. Distribution of Tumor Classes Captured in Training

Table C.1

Table C.1: Real distribution of the classes in the training data of BRATS
2015, along with the distribution captured by our proposed training scheme,
when segments of size 253 are extracted centred on the tumor and healthy
tissue with equal probability. Relative distribution of the foreground classes
is closely preserved and the imbalance in comparison to the healthy tissue is
automatically alleviated.

Healthy Necrosis

Edema Non-Enh.

Enh.Core

Real
Captured

92.42
58.65

0.43
2.48

4.87
24.98

1.02
6.40

1.27
7.48

References

Bakas, S., Zeng, K., Sotiras, A., Rathore, S., Akbari, H., Gaonkar, B., Rozy-
cki, M., Pati, S., Davatzikos, C., 2015. Segmentation of gliomas in multi-
modal magnetic resonance imaging volumes based on a hybrid generative-
discriminative framework. in proc of BRATS-MICCAI.

Bastien, F., Lamblin, P., Pascanu, R., Bergstra, J., Goodfellow, I. J., Berg-
eron, A., Bouchard, N., Bengio, Y., 2012. Theano: new features and speed
improvements. Deep Learning and Unsupervised Feature Learning NIPS
2012 Workshop.

Brebisson, A., Montana, G., 2015. Deep neural networks for anatomical brain
segmentation. In: Proceedings of the IEEE Conference on Computer Vi-
sion and Pattern Recognition Workshops. pp. 20–28.

Brosch, T., Yoo, Y., Tang, L. Y., Li, D. K., Traboulsee, A., Tam, R., 2015.
Deep convolutional encoder networks for multiple sclerosis lesion segmenta-
tion. In: Medical Image Computing and Computer-Assisted Intervention–
MICCAI 2015. Springer, pp. 3–11.

39

Cardoso, M. J., Sudre, C. H., Modat, M., Ourselin, S., 2015. Template-
based multimodal joint generative model of brain data. In: Information
Processing in Medical Imaging. Springer, pp. 17–29.

Chen, L.-C., Papandreou, G., Kokkinos, I., Murphy, K., Yuille, A. L., 2014.
Semantic image segmentation with deep convolutional nets and fully con-
nected crfs. arXiv preprint arXiv:1412.7062.

Choromanska, A., Henaﬀ, M., Mathieu, M., Arous, G. B., LeCun, Y., 2015.

The Loss Surfaces of Multilayer Networks. Aistats 38, 192—-204.

Ciresan, D., Giusti, A., Gambardella, L. M., Schmidhuber, J., 2012. Deep
neural networks segment neuronal membranes in electron microscopy im-
ages. In: Advances in neural information processing systems. pp. 2843–
2851.

Cire¸san, D. C., Giusti, A., Gambardella, L. M., Schmidhuber, J., 2013. Mito-
sis detection in breast cancer histology images with deep neural networks.
In: Medical Image Computing and Computer-Assisted Intervention–
MICCAI 2013. Springer, pp. 411–418.

Dalca, A. V., Sridharan, R., Cloonan, L., Fitzpatrick, K. M., Kanakis, A.,
Furie, K. L., Rosand, J., Wu, O., Sabuncu, M., Rost, N. S., et al., 2014.
Segmentation of cerebrovascular pathologies in stroke patients with spatial
and shape priors. In: Medical Image Computing and Computer-Assisted
Intervention–MICCAI 2014. Springer, pp. 773–780.

Davy, A., Havaei, M., Warder-Farley, D., Biard, A., Tran, L., Jodoin, P.-
M., Courville, A., Larochelle, H., Pal, C., Bengio, Y., 2014. Brain tumor
segmentation with deep neural networks. in proc of BRATS-MICCAI.

Ding, K., de la Plata, C. M., Wang, J. Y., Mumphrey, M., Moore, C., Harper,
C., Madden, C. J., McColl, R., Whittemore, A., Devous, M. D., et al.,
2008. Cerebral atrophy after traumatic white matter injury: correlation
with acute neuroimaging and outcome. Journal of neurotrauma 25 (12),
1433–1440.

Doyle, S., Vasseur, F., Dojat, M., Forbes, F., 2013. Fully automatic brain
tumor segmentation from multiple mr sequences using hidden markov ﬁelds
and variational em. Procs. NCI-MICCAI BraTS, 18–22.

40

Dvok, P., Menze, B., 2015. Structured prediction with convolutional neural
networks for multimodal brain tumor segmentation. in proc of BRATS-
MICCAI.

Erihov, M., Alpert, S., Kisilev, P., Hashoul, S., 2015. A cross saliency ap-
proach to asymmetry-based tumor detection. In: Medical Image Com-
puting and Computer-Assisted Intervention–MICCAI 2015. Springer, pp.
636–643.

Feng, C., Zhao, D., Huang, M., 2015. Segmentation of stroke lesions in multi-
spectral mr images using bias correction embedded fcm and three phase
level set. in proc of ISLES-MICCAI.

Gal, Y., Ghahramani, Z., 2015. Dropout as a bayesian approxima-
tion: Representing model uncertainty in deep learning. arXiv preprint
arXiv:1506.02142.

Ge, Y., 2006. Multiple sclerosis: the role of mr imaging. American Journal

of Neuroradiology 27 (6), 1165–1176.

Geremia, E., Menze, B. H., Clatz, O., Konukoglu, E., Criminisi, A., Ay-
ache, N., 2010. Spatial decision forests for ms lesion segmentation in multi-
channel mr images. In: Medical Image Computing and Computer-Assisted
Intervention–MICCAI 2010. Springer, pp. 111–118.

Glorot, X., Bengio, Y., 2010. Understanding the diﬃculty of training deep
feedforward neural networks. In: International conference on artiﬁcial in-
telligence and statistics. pp. 249–256.

Gooya, A., Pohl, K. M., Bilello, M., Biros, G., Davatzikos, C., 2011. Joint
segmentation and deformable registration of brain scans guided by a tu-
mor growth model. In: Medical Image Computing and Computer-Assisted
Intervention–MICCAI 2011. Springer, pp. 532–540.

Grabner, G., Janke, A. L., Budge, M. M., Smith, D., Pruessner, J., Collins,
D. L., 2006. Symmetric atlasing and model based segmentation: an appli-
cation to the hippocampus in older adults. In: Medical Image Computing
and Computer-Assisted Intervention–MICCAI 2006. Springer, pp. 58–66.

41

Halme, H., Korvenoja, A., Salli, E., 2015. Segmentation of stroke lesions
using spatial normalization, random forest classiﬁcation and contextual
clustering. in proc of ISLES-MICCAI.

Havaei, M., Davy, A., Warde-Farley, D., Biard, A., Courville, A., Bengio, Y.,
Pal, C., Jodoin, P.-M., Larochelle, H., 2015. Brain tumor segmentation
with deep neural networks. arXiv preprint arXiv:1505.03540.

He, K., Zhang, X., Ren, S., Sun, J., 2015. Delving deep into rectiﬁers: Sur-
passing human-level performance on imagenet classiﬁcation. In: Proceed-
ings of the IEEE International Conference on Computer Vision. pp. 1026–
1034.

Hinton, G. E., Srivastava, N., Krizhevsky, A., Sutskever, I., Salakhutdinov,
R. R., 2012. Improving neural networks by preventing co-adaptation of
feature detectors. arXiv preprint arXiv:1207.0580.

Iglesias, J. E., Liu, C.-Y., Thompson, P. M., Tu, Z., 2011. Robust brain
extraction across datasets and comparison with publicly available methods.
Medical Imaging, IEEE Transactions on 30 (9), 1617–1634.

Ikram, M. A., Vrooman, H. A., Vernooij, M. W., den Heijer, T., Hofman, A.,
Niessen, W. J., van der Lugt, A., Koudstaal, P. J., Breteler, M. M., 2010.
Brain tissue volumes in relation to cognitive function and risk of dementia.
Neurobiology of aging 31 (3), 378–386.

Ioﬀe, S., Szegedy, C., 2015. Batch normalization: Accelerating deep
network training by reducing internal covariate shift. arXiv preprint
arXiv:1502.03167.

Irimia, A., Wang, B., Aylward, S. R., Prastawa, M. W., Pace, D. F., Gerig,
G., Hovda, D. A., Kikinis, R., Vespa, P. M., Van Horn, J. D., 2012. Neu-
roimaging of structural pathology and connectomics in traumatic brain
injury: Toward personalized outcome prediction. NeuroImage: Clinical
1 (1), 1–17.

Jarrett, K., Kavukcuoglu, K., Ranzato, M., LeCun, Y., 2009. What is the
best multi-stage architecture for object recognition? In: Computer Vision,
2009 IEEE 12th International Conference on. IEEE, pp. 2146–2153.

42

Jokinen, H., Kalska, H., Ylikoski, R., Madureira, S., Verdelho, A., Van
Der Flier, W. M., Scheltens, P., Barkhof, F., Visser, M. C., Fazekas, F.,
et al., 2009. Longitudinal cognitive decline in subcortical ischemic vascular
disease–the ladis study. Cerebrovascular diseases 27 (4), 384–391.

Kamnitsas, K., Chen, L., Ledig, C., Rueckert, D., Glocker, B., 2015. Multi-
scane 3d convolutional neural networks for lesion segmentation in brain
mri. in proc of ISLES-MICCAI.

Kappos, L., Freedman, M. S., Polman, C. H., Edan, G., Hartung, H.-P.,
Miller, D. H., Montalb´an, X., Barkhof, F., Rad¨u, E.-W., Bauer, L., et al.,
2007. Eﬀect of early versus delayed interferon beta-1b treatment on dis-
ability after a ﬁrst clinical event suggestive of multiple sclerosis: a 3-year
follow-up analysis of the beneﬁt study. The Lancet 370 (9585), 389–397.

Kr¨ahenb¨uhl, P., Koltun, V., 2012. Eﬃcient inference in fully connected crfs

with gaussian edge potentials. arXiv preprint arXiv:1210.5644.

Krizhevsky, A., Sutskever, I., Hinton, G. E., 2012. Imagenet classiﬁcation
with deep convolutional neural networks. In: Advances in neural informa-
tion processing systems. pp. 1097–1105.

LeCun, Y., Bottou, L., Bengio, Y., Haﬀner, P., 1998. Gradient-based learning
applied to document recognition. Proceedings of the IEEE 86 (11), 2278–
2324.

Ledig, C., Heckemann, R. A., Hammers, A., Lopez, J. C., Newcombe, V. F.,
Makropoulos, A., L¨otj¨onen, J., Menon, D. K., Rueckert, D., 2015. Robust
whole-brain segmentation: application to traumatic brain injury. Medical
image analysis 21 (1), 40–58.

Lehtonen, S., Stringer, A. Y., Millis, S., Boake, C., Englander, J., Hart,
T., High, W., Macciocchi, S., Meythaler, J., Novack, T., et al., 2005. Neu-
ropsychological outcome and community re-integration following traumatic
brain injury: the impact of frontal and non-frontal lesions. Brain Injury
19 (4), 239–256.

Li, R., Zhang, W., Suk, H.-I., Wang, L., Li, J., Shen, D., Ji, S., 2014. Deep
learning based imaging data completion for improved brain disease diagno-
sis. In: Medical Image Computing and Computer-Assisted Intervention–
MICCAI 2014. Springer, pp. 305–312.

43

Liu, X., Niethammer, M., Kwitt, R., McCormick, M., Aylward, S., 2014.
Low-rank to the rescue–atlas-based analyses in the presence of patholo-
gies. In: Medical Image Computing and Computer-Assisted Intervention–
MICCAI 2014. Springer, pp. 97–104.

Long, J., Shelhamer, E., Darrell, T., 2015. Fully convolutional networks for
semantic segmentation. In: Proceedings of the IEEE Conference on Com-
puter Vision and Pattern Recognition. pp. 3431–3440.

Lyksborg, M., Puonti, O., Agn, M., Larsen, R., 2015. An ensemble of 2d
convolutional neural networks for tumor segmentation. In: Image Analysis.
Springer, pp. 201–211.

Maas, A. I., Menon, D. K., Steyerberg, E. W., Citerio, G., Lecky, F., Manley,
G. T., Hill, S., Legrand, V., Sorgner, A., Participants, C.-T., Investigators,
et al., 2015. Collaborative european neurotrauma eﬀectiveness research in
traumatic brain injury (center-tbi): a prospective longitudinal observa-
tional study. Neurosurgery 76 (1), 67–80.

Menze, B. H., Jakab, A., Bauer, S., Kalpathy-Cramer, J., Farahani, K.,
Kirby, J., Burren, Y., Porz, N., Slotboom, J., Wiest, R., et al., 2015. The
multimodal brain tumor image segmentation benchmark (brats). Medical
Imaging, IEEE Transactions on 34 (10), 1993–2024.

Mitra, J., Bourgeat, P., Fripp, J., Ghose, S., Rose, S., Salvado, O., Connelly,
A., Campbell, B., Palmer, S., Sharma, G., et al., 2014. Lesion segmenta-
tion from multimodal mri using random forest following ischemic stroke.
NeuroImage 98, 324–335.

Moen, K. G., Skandsen, T., Folvik, M., Brezova, V., Kvistad, K. A., Rydland,
J., Manley, G. T., Vik, A., 2012. A longitudinal mri study of traumatic
axonal injury in patients with moderate and severe traumatic brain injury.
Journal of Neurology, Neurosurgery & Psychiatry, jnnp–2012.

Noh, H., Hong, S., Han, B., 2015. Learning deconvolution network for seman-
tic segmentation. In: Proceedings of the IEEE International Conference on
Computer Vision. pp. 1520–1528.

Palmer, S., Carey, L. M., 2013. Biologically reliable white matter ﬁber trac-

tography: issues and solutions. Future Neurology 8 (6), 613–616.

44

Parisot, S., Duﬀau, H., Chemouny, S., Paragios, N., 2012. Joint tumor seg-
mentation and dense deformable registration of brain mr images. In: Medi-
cal Image Computing and Computer-Assisted Intervention–MICCAI 2012.
Springer, pp. 651–658.

Pereira, S., Adriano, P., Alves, V., Silva, C., 2015. Deep convolutional neural
networks for the segmentation of gliomas in multi-sequence mri. in proc of
BRATS-MICCAI.

Prasoon, A., Petersen, K., Igel, C., Lauze, F., Dam, E., Nielsen, M., 2013.
Deep feature learning for knee cartilage segmentation using a triplanar con-
volutional neural network. In: Medical Image Computing and Computer-
Assisted Intervention–MICCAI 2013. Springer, pp. 246–253.

Prastawa, M., Bullitt, E., Ho, S., Gerig, G., 2004. A brain tumor segmenta-
tion framework based on outlier detection. Medical image analysis 8 (3),
275–283.

Rao, A., Ledig, C., Newcombe, V., Menon, D., Rueckert, D., 2014. Contusion
segmentation from subjects with traumatic brain injury: a random forest
framework. In: Biomedical Imaging (ISBI), 2014 IEEE 11th International
Symposium on. IEEE, pp. 333–336.

Ronneberger, O., Fischer, P., Brox, T., 2015. U-net: Convolutional networks
for biomedical image segmentation. In: Medical Image Computing and
Computer-Assisted Intervention–MICCAI 2015. Springer, pp. 234–241.

Roth, H. R., Lu, L., Farag, A., Shin, H.-C., Liu, J., Turkbey, E. B., Sum-
mers, R. M., 2015. Deeporgan: Multi-level deep convolutional networks
for automated pancreas segmentation. In: Medical Image Computing and
Computer-Assisted Intervention–MICCAI 2015. Springer, pp. 556–564.

Roth, H. R., Lu, L., Seﬀ, A., Cherry, K. M., Hoﬀman, J., Wang, S., Liu,
J., Turkbey, E., Summers, R. M., 2014. A new 2.5 d representation for
lymph node detection using random sets of deep convolutional neural net-
work observations. In: Medical Image Computing and Computer-Assisted
Intervention–MICCAI 2014. Springer, pp. 520–527.

Rovira, `A., Le´on, A., 2008. Mr in the diagnosis and monitoring of multiple

sclerosis: an overview. European journal of radiology 67 (3), 409–414.

45

Schmidt, P., Gaser, C., Arsic, M., Buck, D., F¨orschler, A., Berthele, A.,
Hoshi, M., Ilg, R., Schmid, V. J., Zimmer, C., et al., 2012. An automated
tool for detection of ﬂair-hyperintense white-matter lesions in multiple scle-
rosis. Neuroimage 59 (4), 3774–3783.

Sermanet, P., Eigen, D., Zhang, X., Mathieu, M., Fergus, R., LeCun, Y.,
2013. Overfeat: Integrated recognition, localization and detection using
convolutional networks. arXiv preprint arXiv:1312.6229.

Sharp, D. J., Beckmann, C. F., Greenwood, R., Kinnunen, K. M., Bonnelle,
V., De Boissezon, X., Powell, J. H., Counsell, S. J., Patel, M. C., Leech, R.,
2011. Default mode network functional and structural connectivity after
traumatic brain injury. Brain 134 (8), 2233–2247.

Silver, D., Huang, A., Maddison, C. J., Guez, A., Sifre, L., van den Driessche,
G., Schrittwieser, J., Antonoglou, I., Panneershelvam, V., Lanctot, M.,
et al., 2016. Mastering the game of go with deep neural networks and tree
search. Nature 529 (7587), 484–489.

Simonyan, K., Zisserman, A., 2014. Very deep convolutional networks for

large-scale image recognition. arXiv preprint arXiv:1409.1556.

Springenberg, J. T., Dosovitskiy, A., Brox, T., Riedmiller, M., 2014. Striving
for simplicity: The all convolutional net. arXiv preprint arXiv:1412.6806.

Studholme, C., Hill, D. L., Hawkes, D. J., 1999. An overlap invariant entropy
measure of 3d medical image alignment. Pattern recognition 32 (1), 71–86.

Sutskever, I., Martens, J., Dahl, G., Hinton, G., 2013. On the importance of
initialization and momentum in deep learning. In: Proceedings of the 30th
international conference on machine learning (ICML-13). pp. 1139–1147.

Tieleman, T., Hinton, G., 2012. Lecture 6.5-rmsprop: Divide the gradient by
a running average of its recent magnitude. COURSERA: Neural Networks
for Machine Learning.

Tustison, N., Wintermark, M., Durst, C., Brian, A., 2013. ANTs and Arboles.

in proc of BRATS-MICCAI.

Urban, G., Bendszus, M., Hamprecht, F., Kleesiek, J., 2014. Multi-modal
brain tumor segmentation using deep convolutional neural networks. in
proc of BRATS-MICCAI.

46

Van Leemput, K., Maes, F., Vandermeulen, D., Suetens, P., 1999. Auto-
mated model-based tissue classiﬁcation of mr images of the brain. Medical
Imaging, IEEE Transactions on 18 (10), 897–908.

Warner, M. A., de la Plata, C. M., Spence, J., Wang, J. Y., Harper, C.,
Moore, C., Devous, M., Diaz-Arrastia, R., 2010. Assessing spatial rela-
tionships between axonal integrity, regional brain volumes, and neuropsy-
chological outcomes after traumatic axonal injury. Journal of neurotrauma
27 (12), 2121–2130.

Weiss, N., Rueckert, D., Rao, A., 2013. Multiple sclerosis lesion segmentation
using dictionary learning and sparse coding. In: Medical Image Computing
and Computer-Assisted Intervention–MICCAI 2013. Springer, pp. 735–
742.

Wen, P. Y., Macdonald, D. R., Reardon, D. A., Cloughesy, T. F., Sorensen,
A. G., Galanis, E., DeGroot, J., Wick, W., Gilbert, M. R., Lassman, A. B.,
et al., 2010. Updated response assessment criteria for high-grade gliomas:
response assessment in neuro-oncology working group. Journal of Clinical
Oncology 28 (11), 1963–1972.

Ye, D. H., Zikic, D., Glocker, B., Criminisi, A., Konukoglu, E., 2013.
Modality propagation: coherent synthesis of subject-speciﬁc scans with
data-driven regularization. In: Medical Image Computing and Computer-
Assisted Intervention–MICCAI 2013. Springer, pp. 606–613.

Yuh, E. L., Cooper, S. R., Ferguson, A. R., Manley, G. T., 2012. Quantitative
ct improves outcome prediction in acute traumatic brain injury. Journal
of neurotrauma 29 (5), 735–746.

Zheng, S., Jayasumana, S., Romera-Paredes, B., Vineet, V., Su, Z., Du,
D., Huang, C., Torr, P. H., 2015. Conditional random ﬁelds as recurrent
neural networks. In: Proceedings of the IEEE International Conference on
Computer Vision. pp. 1529–1537.

Zikic, D., Glocker, B., Konukoglu, E., Criminisi, A., Demiralp, C., Shotton,
J., Thomas, O., Das, T., Jena, R., Price, S., 2012. Decision forests for
tissue-speciﬁc segmentation of high-grade gliomas in multi-channel mr. In:
Medical Image Computing and Computer-Assisted Intervention–MICCAI
2012. Springer, pp. 369–376.

47

Zikic, D., Ioannou, Y., Brown, M., Criminisi, A., 2014. Segmentation of
brain tumor tissues with convolutional neural networks. in proc of BRATS-
MICCAI.

48

